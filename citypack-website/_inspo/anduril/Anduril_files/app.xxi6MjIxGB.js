// --------------------------------------
//   11/26/25 05:54PM
// --------------------------------------

(function(w){w._MINIFIED_=w._BUILT_=true})((typeof globalThis!=='undefined'?globalThis:this)||self);function RNG(seed){this.m=2147483648,this.a=1103515245,this.c=12345,this.state=seed||Math.floor(Math.random()*(this.m-1))}"undefined"==typeof console&&(window.console={},console.log=console.error=console.info=console.debug=console.warn=console.trace=function(){}),window.performance=window.performance&&window.performance.now?window.performance:Date,Date.now=Date.now||function(){return+new Date},window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(){const start=Date.now();return function(callback){window.setTimeout(()=>callback(Date.now()-start),1e3/60)}}()),window.defer=window.requestAnimationFrame,window.clearTimeout=function(){const _clearTimeout=window.clearTimeout;return function(ref){return window.Timer&&Timer.__clearTimeout(ref)||_clearTimeout(ref)}}(),window.requestIdleCallback=function(){const _requestIdleCallback=window.requestIdleCallback;return function(callback,max){return _requestIdleCallback?_requestIdleCallback(callback,max?{timeout:max}:null):defer(()=>{callback({didTimeout:!1})},0)}}(),window.onIdle=window.requestIdleCallback,"undefined"==typeof Float32Array&&(Float32Array=Array),Math.sign=function(x){return 0===(x=+x)||isNaN(x)?Number(x):x>0?1:-1},Math._round=Math.round,Math.round=function(value,precision=0){let p=Math.pow(10,precision);return Math._round(value*p)/p},Math._random=Math.random,Math.rand=Math.random=function(min=0,max=1,precision=0){return 0===arguments.length?Math._random():min===max?min:0==precision?Math.floor(Math._random()*(max+1-min)+min):Math.round(min+Math._random()*(max-min),precision)},RNG.prototype.nextFloat=function(){return this.state=(this.a*this.state+this.c)%this.m,this.state/(this.m-1)},Math._randomSeed=new RNG(1337),Math.randomSeed=function(min=0,max=1,precision=0){return 0===arguments.length?Math._randomSeed.nextFloat():min===max?min:0==precision?Math.floor(Math._randomSeed.nextFloat()*(max+1-min)+min):Math.round(min+Math._randomSeed.nextFloat()*(max-min),precision)},Math.PI2=2*Math.PI,Math.PI_HALF=Math.PI/2,Math.degrees=function(radians){return radians*(180/Math.PI)},Math.radians=function(degrees){return degrees*(Math.PI/180)},Math.clamp=function(value,min=0,max=1){return Math.min(Math.max(value,Math.min(min,max)),Math.max(min,max))},Math.map=Math.range=function(value,oldMin=-1,oldMax=1,newMin=0,newMax=1,isClamp){const newValue=(value-oldMin)*(newMax-newMin)/(oldMax-oldMin)+newMin;return isClamp?Math.clamp(newValue,Math.min(newMin,newMax),Math.max(newMin,newMax)):newValue},Math.mix=function(a,b,alpha){return a*(1-alpha)+b*alpha},Math.step=function(edge,value){return value<edge?0:1},Math.smoothStep=function(min,max,value){const x=Math.max(0,Math.min(1,(value-min)/(max-min)));return x*x*(3-2*x)},Math.fract=function(value){return value-Math.floor(value)},Math.lerp=function(target,value,alpha,calcHz=!0){return value+(target-value)*(alpha=calcHz?Math.framerateNormalizeLerpAlpha(alpha):Math.clamp(alpha))};{const mainThread=!!window.document;Math.framerateNormalizeLerpAlpha=function(t){return t=Math.clamp(t),mainThread?1-Math.exp(Math.log(1-t)*Render.FRAME_HZ_MULTIPLIER):t}}Math.mod=function(value,n){return(value%n+n)%n},Object.defineProperty(Array.prototype,"shuffle",{writable:!0,value:function(){let randomIndex,currentIndex=this.length;for(;0!=currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),currentIndex--,[this[currentIndex],this[randomIndex]]=[this[randomIndex],this[currentIndex]];return this}}),Array.storeRandom=function(arr){arr.randomStore=[]},Object.defineProperty(Array.prototype,"random",{writable:!0,value:function(range){let value=Math.random(0,this.length-1);if(arguments.length&&!this.randomStore&&Array.storeRandom(this),!this.randomStore)return this[value];if(range>this.length-1&&(range=this.length),range>1){for(;~this.randomStore.indexOf(value);)(value+=1)>this.length-1&&(value=0);this.randomStore.push(value),this.randomStore.length>=range&&this.randomStore.shift()}return this[value]}}),Object.defineProperty(Array.prototype,"remove",{writable:!0,value:function(element){if(!this.indexOf)return;const index=this.indexOf(element);return~index?this.splice(index,1):void 0}}),Object.defineProperty(Array.prototype,"last",{writable:!0,value:function(){return this[this.length-1]}}),window.Promise=window.Promise||{},Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function flat(){var depth=isNaN(arguments[0])?1:Number(arguments[0]);return depth?Array.prototype.reduce.call(this,function(acc,cur){return Array.isArray(cur)?acc.push.apply(acc,flat.call(cur,depth-1)):acc.push(cur),acc},[]):Array.prototype.slice.call(this)},writable:!0}),Promise.create=function(){const promise=new Promise((resolve,reject)=>{this.temp_resolve=resolve,this.temp_reject=reject});return promise.resolve=this.temp_resolve,promise.reject=this.temp_reject,delete this.temp_resolve,delete this.temp_reject,promise},Promise.catchAll=function(array){return Promise.all(array.map(promise=>promise&&"function"==typeof promise.catch?promise.catch(error=>{Promise.reject(error)}):promise))},Promise.timeout=function(promise,timeout){Array.isArray(promise)&&(promise=Promise.all(promise));var timeoutPromise=Promise.create(),ref=Timer.create(timeoutPromise.resolve,timeout);return Promise.race([promise,timeoutPromise]).finally(function(){Timer.__clearTimeout(ref)})},function(){function notRegExp(it){if(function isRegExp(it){if(!("object"==typeof it?null!==it:"function"==typeof it))return!1;var match=it["undefined"!=typeof Symbol?Symbol.match:"match"];return void 0!==match?!!match:"RegExp"===Object.prototype.toString.call(it).slice(8,-1)}(it))throw new Error("First argument to String.prototype.includes must not be a regular expression");return it}Object.defineProperty(String.prototype,"includes",{writable:!0,value:function(str){if(!Array.isArray(str))return!!~this.indexOf(notRegExp(str));for(let i=str.length-1;i>=0;i--)if(~this.indexOf(notRegExp(str[i])))return!0;return!1}})}(),Object.defineProperty(String.prototype,"equals",{writable:!0,value:function(str){let compare=String(this);if(!Array.isArray(str))return str===compare;for(let i=str.length-1;i>=0;i--)if(str[i]===compare)return!0;return!1}}),Object.defineProperty(String.prototype,"strpos",{writable:!0,value:function(str){return console.warn("strpos deprecated: use .includes()"),this.includes(str)}}),Object.defineProperty(String.prototype,"clip",{writable:!0,value:function(num,end=""){return this.length>num?this.slice(0,Math.max(0,num-end.length)).trim()+end:this.slice()}}),Object.defineProperty(String.prototype,"capitalize",{writable:!0,value:function(){return this.charAt(0).toUpperCase()+this.slice(1)}}),Object.defineProperty(String.prototype,"replaceAll",{writable:!0,value:function(find,replace){return this.split(find).join(replace)}}),Object.defineProperty(String.prototype,"replaceAt",{writable:!0,value:function(index,replacement){return this.substr(0,index)+replacement+this.substr(index+replacement.length)}}),(!window.fetch||!window.AURA&&location.protocol.includes("file"))&&(window.fetch=function(url,options){options=options||{};const promise=Promise.create(),request=new XMLHttpRequest;request.open(options.method||"get",url),url.includes(".ktx")&&(request.responseType="arraybuffer");for(let i in options.headers)request.setRequestHeader(i,options.headers[i]);function response(){let header,keys=[],all=[],headers={};return request.getAllResponseHeaders().replace(/^(.*?):\s*([\s\S]*?)$/gm,(m,key,value)=>{keys.push(key=key.toLowerCase()),all.push([key,value]),header=headers[key],headers[key]=header?`${header},${value}`:value}),{ok:1==(request.status/200|0),status:request.status,statusText:request.statusText,url:request.responseURL,clone:response,text:()=>Promise.resolve(request.responseText),json:()=>Promise.resolve(request.responseText).then(JSON.parse),xml:()=>Promise.resolve(request.responseXML),blob:()=>Promise.resolve(new Blob([request.response])),arrayBuffer:()=>Promise.resolve(request.response),headers:{keys:()=>keys,entries:()=>all,get:n=>headers[n.toLowerCase()],has:n=>n.toLowerCase()in headers}}}return request.onload=()=>{promise.resolve(response())},request.onerror=promise.reject,request.send(options.body),promise}),window.get=function(url,options={credentials:"same-origin"}){let promise=Promise.create();return options.method="GET",fetch(url,options).then(function handleResponse(e){e.text().then(text=>{let result=text;if(text.charAt(0).includes("[")||text.charAt(0).includes("{"))try{result=JSON.parse(text)}catch(err){}e.ok?promise.resolve(result):promise.reject(result)}).catch(()=>{promise.reject(e)})}).catch(promise.reject),promise},window.post=function(url,body={},options={}){let promise=Promise.create();return options.method="POST",body&&(options.body="object"==typeof body||Array.isArray(body)?JSON.stringify(body):body),options.headers||(options.headers={"content-type":"application/json"}),fetch(url,options).then(function handleResponse(e){e.text().then(text=>{let result=text;if(text.charAt(0).includes("[")||text.charAt(0).includes("{"))try{result=JSON.parse(text)}catch(err){}e.ok?promise.resolve(result):promise.reject(result)}).catch(()=>{promise.reject(e)})}).catch(promise.reject),promise},window.put=function(url,body,options={}){let promise=Promise.create();return options.method="PUT",body&&(options.body="object"==typeof body||Array.isArray(body)?JSON.stringify(body):body),fetch(url,options).then(function handleResponse(e){e.text().then(text=>{let result=text;if(text.charAt(0).includes("[")||text.charAt(0).includes("{"))try{result=JSON.parse(text)}catch(err){}e.ok?promise.resolve(result):promise.reject(result)}).catch(()=>{promise.reject(e)})}).catch(promise.reject),promise},"undefined"==typeof WeakRef&&function(){var targetProp="undefined"!=typeof Symbol?Symbol("WeakRefTarget"):"@@WeakRefTarget";function WeakRef(target){this[targetProp]=target}WeakRef.prototype.deref=function(){return this[targetProp]},window.WeakRef=WeakRef}(),window.Class=function(_class,_type,_static){const _this=this||window,isGlobal=_this===window,_name=_class.name||_class.toString().match(/function ?([^\(]+)/)[1];"function"==typeof _type&&(_static=_type,_type=null),_type=(_type||"").toLowerCase();let collection=isGlobal&&Global.RESERVED_CLASSES[_name]?Global.RESERVED_HYDRA_CLASSES:_this;_type?"static"==_type?collection[_name]=new _class:"singleton"==_type&&(collection[_name]=_class,function(){let _instance,_multitons;collection[_name].instance=function(){return _instance||(_instance=new _class(...arguments)),_instance},collection[_name].multiton=function(key){return _multitons||(_multitons={}),_multitons[key]||(_multitons[key]=new _class(...Array.prototype.slice.call(arguments,1))),_multitons[key]}}(),_static&&_static()):(collection[_name]=_class,_static&&_static()),isGlobal||(collection[_name]._namespace=_this.__namespace)},window.Inherit=function(child,parent){const args=[].slice.call(arguments,2),parentName=parent.name||parent.toString().match(/function ?([^\(]+)/)[1];if(Global.RESERVED_CLASSES[parentName]&&(parent=Global.RESERVED_HYDRA_CLASSES[parentName]),parent.apply(child,args),parent.inheritanceChain){for(let method in parent.inheritanceChain)if(child[method]){let name=method;do{name=`_${name}`}while(child[name]);child[name]=child[method]}Object.assign(child,parent.inheritanceChain)}const save=Object.assign({},child),addSuperMethods=()=>{for(let method in save)if(child[method]&&child[method]!==save[method]){if("destroy"==method&&!child.__element)throw"Do not override destroy directly, use onDestroy :: "+child.constructor.toString();let name=method;do{name=`_${name}`}while(child[name]);child[name]=save[method]}};child.__afterInitClass?child.__afterInitClass.push(addSuperMethods):defer(addSuperMethods)},window.Namespace=function(obj){"string"==typeof obj?window[obj]||(window[obj]={Class:Class,__namespace:obj}):(obj.Class=Class,obj.__namespace=obj.constructor.name||obj.constructor.toString().match(/function ([^\(]+)/)[1])},window.Global={RESERVED_CLASSES:{Element:Element,Image:Image},RESERVED_HYDRA_CLASSES:{}},window.THREAD=!1,Class(function Hydra(){const _this=this,_readyPromise=Promise.create();var _base,_callbacks=[];function initLoad(){return document&&window?window._NODE_?setTimeout(loaded,1):window._AURA_?window.Main?setTimeout(loaded,1):setTimeout(initLoad,1):void("loading"!==document.readyState?setTimeout(readyStateChange,1):document.addEventListener("readystatechange",readyStateChange)):setTimeout(initLoad,1)}function loaded(){if(window._HYDRA_BEFORE_READY){let promise=window._HYDRA_BEFORE_READY;return delete window._HYDRA_BEFORE_READY,promise.then(loaded)}_this.LOCAL=(!window._BUILT_||location.pathname.toLowerCase().includes("platform"))&&(location.hostname.indexOf("local")>-1||"127.0.0.1"===location.hostname||"10"==location.hostname.split(".")[0]||"192"==location.hostname.split(".")[0]||/atdev.online$/.test(location.hostname))&&(""==location.port||"3000"===location.port),_callbacks.forEach(cb=>cb()),_callbacks=null,_readyPromise.resolve(),window.Main&&_readyPromise.then(()=>Hydra.Main=new window.Main)}function readyStateChange(){"loading"!==document.readyState&&(document.removeEventListener("readystatechange",readyStateChange),loaded())}this.HASH=window.location.hash.slice(1),this.LOCAL=!window._BUILT_&&(location.hostname.indexOf("local")>-1||"127.0.0.1"===location.hostname||"10"==location.hostname.split(".")[0]||"192"==location.hostname.split(".")[0]||/atdev.online$/.test(location.hostname))&&(""==location.port||"3000"===location.port),initLoad(),this.__triggerReady=function(){_callbacks||loaded()},this.ready=function(callback){if(!callback)return _readyPromise;_callbacks?_callbacks.push(callback):callback()},this.absolutePath=function(path){if(window.AURA)return path;let base=window.HYDRA_BASE_PATH??_base;if(void 0===base)try{if(document.getElementsByTagName("base").length>0){var a=document.createElement("a");a.href=document.getElementsByTagName("base")[0].href,base=a.pathname,_base=base}}catch(e){_base=null}let pathname=base??location.pathname;pathname.includes("/index.html")&&(pathname=pathname.replace("/index.html",""));let port=Number(location.port)>1e3?`:${location.port}`:"";return path.startsWith("http://")||path.startsWith("https://")||path.startsWith("//")||path.startsWith("data:")||path.startsWith("blob:")?path:(location.protocol.length?location.protocol+"//":"")+(location.hostname+port+pathname+"/"+path).replace("//","/")}},"Static"),Class(function Utils(){var _queries={},_searchParams=new URLSearchParams(window.location.search);this.query=this.queryParams=function(key,value){if(void 0!==value&&(_queries[key]=value),void 0!==_queries[key])return _queries[key];if(_searchParams)"0"===(value=_searchParams.get(key))?value=0:"false"===value||null===value?value=!1:""===value&&(value=!0);else{let escapedKey=encodeURIComponent(key).replace(/[\.\+\*]/g,"\\$&");"0"==(value=decodeURIComponent(window.location.search.replace(new RegExp(`^(?:.*?[&?]${escapedKey}(?:=([^&]*)|[&$]))?.*$`,"i"),"$1")))?value=0:"false"==value?value=!1:value.length||(value=new RegExp(`[&?]${escapedKey}(?:[&=]|$)`,"i").test(window.location.search))}return _queries[key]=value,value},this.addQuery=function(query,value){if(_queries[query]===value)return _queries[query];let url=new URL(location.href);return url.searchParams.set(query,value),_searchParams=url.searchParams,window.history.replaceState({},document.title,url.toString()),_queries[query]=value},this.removeQuery=function(...queries){let url=new URL(location.href);queries.forEach(query=>{url.searchParams.delete(query),delete _queries[query]}),_searchParams=url.searchParams,window.history.replaceState({},document.title,url.toString())},this.addQueryToPath=function(path,hash){let q=_searchParams.toString();return q&&(path=`${path||""}?${q}`),hash?(hash.startsWith("#")&&(hash=hash.slice(1)),`${path||""}#${hash}`):path||""},this.addParam=function(url,param,value){let index=url.indexOf("?"),prefix=url.substring(0,index+1),suffix=url.substring(index+1),searchParams=new URLSearchParams(suffix);return searchParams.append(param,value),prefix+searchParams.toString()},this.removeParam=function(url,param){let index=url.indexOf("?"),prefix=url.substring(0,index+1),suffix=url.substring(index+1),searchParams=new URLSearchParams(suffix);return searchParams.delete(param),prefix+searchParams.toString()},this.getConstructorName=function(obj){return obj?(obj.___constructorName||(obj.___constructorName="function"==typeof obj?obj.name||obj.toString().match(/function ([^\(]+)/)?.[1]:obj.constructor.name||obj.constructor.toString().match(/function ([^\(]+)/)?.[1]),obj.___constructorName):obj},this.nullObject=function(object){if(object&&(object.destroy||object.div))for(var key in object)"boolean"==typeof object[key]&&"deleted"===key||void 0!==object[key]&&(object[key]=null);return null},this.cloneObject=function(obj){return JSON.parse(JSON.stringify(obj))},this.headsTails=function(n0,n1){return Math.random(0,1)?n1:n0},this.mergeObject=function(){for(var obj={},i=0;i<arguments.length;i++){var o=arguments[i];for(var key in o)obj[key]=o[key]}return obj},this.timestamp=this.uuid=function(){return Date.now()+"xx-4xx-yxx-xxx".replace(/[xy]/g,function(c){let r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)})},this.randomColor=function(){var color="#"+Math.floor(16777215*Math.random()).toString(16);return color.length<7&&(color=this.randomColor()),color},this.numberWithCommas=function(num){return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},this.padInt=function(num,digits,isLimit){isLimit&&(num=Math.min(num,Math.pow(10,digits)-1));let str=Math.floor(num).toString();return Math.pow(10,Math.max(0,digits-str.length)).toString().slice(1)+str},this.copyToClipboard=function(string){try{var el=document.createElement("textarea"),range=document.createRange();el.contentEditable=!0,el.readOnly=!0,el.value=string,document.body.appendChild(el),el.select(),range.selectNodeContents(el);var s=window.getSelection();return s.removeAllRanges(),s.addRange(range),el.setSelectionRange(0,string.length),document.execCommand("copy"),document.body.removeChild(el),!0}catch(e){return!1}},this.stringList=function(items=[],limit=0,options={}){if(0===items.length)return"";let output="",printed=0;"object"==typeof limit&&(options=limit,limit=0),options.oxford=!0===options.oxford,options.more=!1!==options.more&&(options.more?options.more:"more"),options.and=options.and?options.and:"&",options.comma=options.comma?options.comma:",",isNaN(options.limit)||(limit=options.limit),0===limit&&(limit=items.length);do{output=`${output}${items.shift()}${options.comma} `,printed++}while(items.length>1&&printed+1<limit);if(output=output.trim(),output=output.slice(0,output.length-1),1===items.length)output=`${output}${options.oxford&&printed>1?options.comma:""} ${options.and} ${items.shift()}`;else if(items.length>1&&options.more){let more=`${items.length} ${options.more}`;output=`${output}${options.oxford&&printed>1?options.comma:""} ${options.and} ${more}`}return output},this.debounce=function(callback,time=100,data){clearTimeout(callback.__interval),callback.__interval=Timer.create(_=>callback(data),time)},this.compareVersion=function(){const cache=new Map;return function(version1,version2){const key=`${version1}|${version2}`;if(cache.has(key))return cache.get(key);const v1parts=version1.split(".").map(Number),v2parts=version2.split(".").map(Number);let result=0;for(let i=0;i<3;i++){if(v1parts[i]>v2parts[i]){result=1;break}if(v1parts[i]<v2parts[i]){result=-1;break}}return cache.set(key,result),result}}(),this.hydraXVersion=function(version){return this.compareVersion(version,window.CREATED_WITH_HYDRAX||"1.0.0")}},"Static"),Class(function Render(){const _this=this,_render=[],_native=[],_drawFrame=[],_multipliers=[];let _renderIndex=null,_nativeIndex=null;var _last=performance.now(),_localTSL=0,_elapsed=0,_capLast=0,_sampleRefreshRate=[],_firstSample=!1,_saveRefreshRate=60,rAF=requestAnimationFrame,_refreshScale=1,_canCap=0,_screenHash=getScreenHash();function render(tsl){if(_last>=tsl)return void(THREAD||_this.isPaused||rAF(render));if(_native.length){let multiplier=60/_saveRefreshRate;for(_nativeIndex=_native.length-1;_nativeIndex>-1;_nativeIndex--){let callback=_native[_nativeIndex];try{callback(multiplier)}catch(error){handleRenderCallbackError(callback,error)}}_nativeIndex=null}if(_this.capFPS>0&&++_canCap>31){let delta=tsl-_capLast;if(_capLast=tsl,(_elapsed+=delta)<1e3/_this.capFPS)return void(THREAD||_this.isPaused||rAF(render));_this.REFRESH_RATE=_this.capFPS,_this.HZ_MULTIPLIER=60/_this.REFRESH_RATE*_refreshScale,_elapsed=0}if(_this.timeScaleUniform.value=1,_multipliers.length)for(let i=0;i<_multipliers.length;i++){let obj=_multipliers[i];_this.timeScaleUniform.value*=obj.value}_this.DT=tsl-_last,_last=tsl;let delta=_this.DT*_this.timeScaleUniform.value;if(delta=Math.min(200,delta),_sampleRefreshRate&&!_this.capFPS){let fps=1e3/_this.DT;if(_sampleRefreshRate.push(fps),_sampleRefreshRate.length>30){_sampleRefreshRate.sort((a,b)=>a-b);let rate=_sampleRefreshRate[Math.round(_sampleRefreshRate.length/2)];rate=_this.REFRESH_TABLE.reduce((prev,curr)=>Math.abs(curr-rate)<Math.abs(prev-rate)?curr:prev),_this.REFRESH_RATE=_saveRefreshRate=_firstSample?Math.max(_this.REFRESH_RATE,rate):rate,_this.HZ_MULTIPLIER=60/_this.REFRESH_RATE*_refreshScale,_sampleRefreshRate=null,_firstSample=!0}}for(_this.TIME=tsl,_this.DELTA=delta,_this.startFrame&&_this.startFrame(tsl,delta),_localTSL+=delta,_renderIndex=_render.length-1;_renderIndex>=0;_renderIndex--){var callback=_render[_renderIndex];if(callback)try{if(callback.fps){if(tsl-callback.last<1e3/callback.fps)continue;callback(++callback.frame),callback.last=tsl;continue}callback(tsl,delta)}catch(error){handleRenderCallbackError(callback,error)}else _render.splice(_renderIndex,1)}_renderIndex=null;for(let i=_drawFrame.length-1;i>-1;i--)_drawFrame[i](tsl,delta);_this.drawFrame&&_this.drawFrame(tsl,delta),_this.endFrame&&_this.endFrame(tsl,delta),THREAD||_this.isPaused||rAF(render)}function handleRenderCallbackError(callback,error){if(Hydra.LOCAL)throw error;let evt={callback:callback,error:error,preventStopRender:!1};Events.emitter._fireEvent(_this.RENDER_CALLBACK_ERROR,evt),evt.preventStopRender||_this.stop(callback)}function getScreenHash(){return window.screen?`${window.screen.width}x${window.screen.height}.${window.screen.pixelDepth}`:"none"}function checkMoveScreen(){var newScreen=getScreenHash();_screenHash!==newScreen&&(_screenHash=newScreen,_sampleRefreshRate=null,_firstSample=!1)}this.timeScaleUniform={value:1,type:"f",ignoreUIL:!0},this.REFRESH_TABLE=[30,60,72,90,100,120,144,240],this.REFRESH_RATE=60,this.HZ_MULTIPLIER=1,this.RENDER_CALLBACK_ERROR="render_callback_error",this.capFPS=null,THREAD||(rAF(render),setInterval(_=>_sampleRefreshRate=[],3e3),setInterval(checkMoveScreen,5e3)),this.now=function(){return _localTSL},this.setRefreshScale=function(scale){_refreshScale=scale,_sampleRefreshRate=[]},this.start=function(callback,fps,native){fps&&(callback.fps=fps,callback.last=-1/0,callback.frame=-1),native?~_native.indexOf(callback)||(_native.unshift(callback),null!==_nativeIndex&&(_nativeIndex+=1)):~_render.indexOf(callback)||(_render.unshift(callback),null!==_renderIndex&&(_renderIndex+=1))},this.stop=function(callback){let i=_render.indexOf(callback);i>=0&&(_render.splice(i,1),null!==_renderIndex&&i<_renderIndex&&(_renderIndex-=1)),i=_native.indexOf(callback),i>=0&&(_native.splice(i,1),null!==_nativeIndex&&i<_nativeIndex&&(_nativeIndex-=1))},this.tick=function(){THREAD&&(this.TIME=performance.now(),render(this.TIME))},this.forceRender=function(time){this.TIME=time,render(this.TIME)},this.Worker=function(_callback,_budget=4){Inherit(this,Component);let _scope=this,_elapsed=0;function loop(){if(!_scope.dead){for(;_elapsed<_budget;){if(_scope.dead||_scope.paused)return;const start=performance.now();_callback&&_callback(),_elapsed+=performance.now()-start}_elapsed=0}}this.startRender(loop),this.stop=function(){this.dead=!0,this.stopRender(loop)},this.pause=function(){this.paused=!0,this.stopRender(loop)},this.resume=function(){this.paused=!1,this.startRender(loop)},this.setCallback=function(cb){_callback=cb}},this.pause=function(){_this.isPaused=!0},this.resume=function(){_this.isPaused&&(_this.isPaused=!1,rAF(render))},this.useRAF=function(raf){_firstSample=null,_last=performance.now(),(rAF=raf)(render)},this.onDrawFrame=function(cb){_drawFrame.push(cb)},this.setTimeScale=function(v){_this.timeScaleUniform.value=v},this.getTimeScale=function(){return _this.timeScaleUniform.value},this.createTimeMultiplier=function(){let obj={value:1};return _multipliers.push(obj),obj},this.destroyTimeMultiplier=function(obj){_multipliers.remove(obj)},this.tweenTimeScale=function(value,time,ease,delay){return tween(_this.timeScaleUniform,{value:value},time,ease,delay,null,null,!0)},Object.defineProperty(_this,"FRAME_HZ_MULTIPLIER",{get:()=>60/(1e3/_this.DELTA)*_refreshScale,enumerable:!0})},"Static"),Class(function Timer(){const _this=this,_callbacks=[],_discard=[];var _defer=[],_nextDefer=[],_deferNextTicks=[];function loop(t,delta){for(let i=_discard.length-1;i>=0;i--){let obj=_discard[i];obj.callback=null,_callbacks.remove(obj)}_discard.length&&(_discard.length=0);let deferQueue=_nextDefer;[_defer,_nextDefer]=[_nextDefer,_defer];for(let i=_callbacks.length-1;i>=0;i--){let obj=_callbacks[i];obj?obj.paused||(obj.scaledTime?obj.current+=delta:obj.current+=Render.DT,obj.current>=obj.time&&(obj.callback&&obj.callback(),_discard.push(obj))):_callbacks.remove(obj)}for(let i=deferQueue.length-1;i>-1;i--)deferQueue[i]();deferQueue.length=0}function find(ref){for(let i=_callbacks.length-1;i>-1;i--)if(_callbacks[i].ref==ref)return _callbacks[i]}function handleDeferNextTick(e){if(null!=e&&e.source===window&&"_hydraDeferNextTick"===e.data&&(e.stopPropagation(),_deferNextTicks.length>0)){_deferNextTicks.shift()()}}Render.start(loop),window.addEventListener("message",handleDeferNextTick,!0),this.__clearTimeout=function(ref){const obj=find(ref);return!!obj&&(obj.callback=null,_callbacks.remove(obj),!0)},this.create=function(callback,time,scaledTime){if(window._NODE_)return setTimeout(callback,time);const obj={time:Math.max(1,time||1),current:0,ref:Utils.timestamp(),callback:callback,scaledTime:scaledTime};return _callbacks.unshift(obj),obj.ref},this.delayedCall=function(time){let promise=Promise.create();return _this.create(promise.resolve,time),promise},window.defer=this.defer=function(callback){let promise;return callback||(promise=Promise.create(),callback=promise.resolve),_nextDefer.unshift(callback),promise},window.deferNextTick=this.deferNextTick=function(callback){let promise;return callback||(promise=Promise.create(),callback=promise.resolve),_deferNextTicks.push(callback),callback.time=performance.now(),window.postMessage("_hydraDeferNextTick",window.location.origin),promise},this.pause=function(ref){const obj=find(ref);return!!obj&&(obj.paused=!0,!0)},this.resume=function(ref){const obj=find(ref);return!!obj&&(obj.paused=!1,!0)},this.isPending=function(ref){return!!find(ref)}},"static"),Class(function Events(){const _this=this;this.events={};const _e={},_linked=[];let _emitter;this.events.sub=function(obj,evt,callback){if("object"!=typeof obj&&(callback=evt,evt=obj,obj=null),!obj)return Events.emitter._addEvent(evt,callback.resolve?callback.resolve:callback,this),callback;let emitter=obj.events.emitter();return emitter._addEvent(evt,callback.resolve?callback.resolve:callback,this),emitter._saveLink(this),_linked.push(emitter),callback},this.events.wait=async function(obj,evt){const promise=Promise.create(),args=[obj,evt,e=>{_this.events.unsub(...args),promise.resolve(e)}];return"object"!=typeof obj&&args.splice(1,1),_this.events.sub(...args),promise},this.events.unsub=function(obj,evt,callback){if("object"!=typeof obj&&(callback=evt,evt=obj,obj=null),!obj)return Events.emitter._removeEvent(evt,callback.resolve?callback.resolve:callback);obj.events.emitter()._removeEvent(evt,callback.resolve?callback.resolve:callback)},this.events.fire=function(evt,obj,isLocalOnly){(obj=obj||_e).target=this,Events.emitter._check(evt),_emitter&&_emitter._fireEvent(evt,obj)||isLocalOnly||Events.emitter._fireEvent(evt,obj)},this.events.bubble=function(obj,evt){_this.events.sub(obj,evt,e=>_this.events.fire(evt,e))},this.events.destroy=function(){return Events.emitter._destroyEvents(this),_linked&&(_linked.forEach(emitter=>emitter._destroyEvents(this)),_linked.length=0),_emitter&&_emitter.links&&(_emitter.links.forEach(obj=>obj.events&&obj.events._unlink(_emitter)),_emitter=null),null},this.events.emitter=function(){return _emitter||(_emitter=Events.emitter.createLocalEmitter()),_emitter},this.events._unlink=function(emitter){_linked.remove(emitter)}},()=>{Events.emitter=new function Emitter(){const prototype=Emitter.prototype;if(this.events=[],void 0!==prototype._check)return;prototype._check=function(evt){if(void 0===evt)throw"Undefined event"},prototype._addEvent=function(evt,callback,object){this._check(evt),this.events.push({evt:evt,object:object,callback:callback})},prototype._removeEvent=function(eventString,callback){this._check(eventString);for(let i=this.events.length-1;i>=0;i--)this.events[i].evt===eventString&&this.events[i].callback===callback&&this._markForDeletion(i)},prototype._sweepEvents=function(){for(let i=0;i<this.events.length;i++)this.events[i].markedForDeletion&&(delete this.events[i].markedForDeletion,this.events.splice(i,1),--i)},prototype._markForDeletion=function(i){this.events[i].markedForDeletion=!0,this._sweepScheduled||(this._sweepScheduled=!0,defer(()=>{this._sweepScheduled=!1,this._sweepEvents()}))},prototype._fireEvent=function(eventString,obj){this._check&&this._check(eventString),obj=obj||_e;let called=!1;for(let i=0;i<this.events.length;i++){let evt=this.events[i];evt.evt!=eventString||evt.markedForDeletion||(evt.callback(obj),called=!0)}return called},prototype._destroyEvents=function(object){for(var i=this.events.length-1;i>=0;i--)this.events[i].object===object&&this._markForDeletion(i)},prototype._saveLink=function(obj){this.links||(this.links=[]),~this.links.indexOf(obj)||this.links.push(obj)},prototype.createLocalEmitter=function(){return new Emitter}},Events.broadcast=Events.emitter._fireEvent,Events.VISIBILITY="hydra_visibility",Events.HASH_UPDATE="hydra_hash_update",Events.COMPLETE="hydra_complete",Events.PROGRESS="hydra_progress",Events.CONNECTIVITY="hydra_connectivity",Events.UPDATE="hydra_update",Events.LOADED="hydra_loaded",Events.END="hydra_end",Events.FAIL="hydra_fail",Events.SELECT="hydra_select",Events.ERROR="hydra_error",Events.READY="hydra_ready",Events.RESIZE="hydra_resize",Events.CLICK="hydra_click",Events.HOVER="hydra_hover",Events.MESSAGE="hydra_message",Events.ORIENTATION="orientation",Events.BACKGROUND="background",Events.BACK="hydra_back",Events.PREVIOUS="hydra_previous",Events.NEXT="hydra_next",Events.RELOAD="hydra_reload",Events.UNLOAD="hydra_unload",Events.FULLSCREEN="hydra_fullscreen",Events.WEBGL_CONTEXT_LOSS="hydra_webgl_context_loss";const _e={};Hydra.ready(()=>{let timer;function handleResize(){clearTimeout(timer),timer=setTimeout(_=>{Events.emitter._fireEvent(Events.RESIZE)},16)}!function(){let _last,_lastTime=performance.now();function onfocus(){Render.blurTime=-1,"focus"!=_last&&Events.emitter._fireEvent(Events.VISIBILITY,{type:"focus"}),_last="focus"}function onblur(){Render.blurTime=Date.now(),"blur"!=_last&&Events.emitter._fireEvent(Events.VISIBILITY,{type:"blur"}),_last="blur"}Timer.create(function addVisibilityHandler(){let hidden,eventName;if([["msHidden","msvisibilitychange"],["webkitHidden","webkitvisibilitychange"],["hidden","visibilitychange"]].forEach(d=>{void 0!==document[d[0]]&&(hidden=d[0],eventName=d[1])}),!eventName){const root="ie"==Device.browser?document:window;return root.onfocus=onfocus,void(root.onblur=onblur)}document.addEventListener(eventName,()=>{const time=performance.now();time-_lastTime>10&&(!1===document[hidden]?onfocus():onblur()),_lastTime=time})},250),window.addEventListener("online",_=>Events.emitter._fireEvent(Events.CONNECTIVITY,{online:!0})),window.addEventListener("offline",_=>Events.emitter._fireEvent(Events.CONNECTIVITY,{online:!1})),window.onbeforeunload=_=>(Events.emitter._fireEvent(Events.UNLOAD),null)}(),window.Stage=window.Stage||{},window.addEventListener("resize",handleResize),window.addEventListener("orientationchange",handleResize),defer(handleResize),Events._fireResize=handleResize})}),Class(function Device(){var vid,_this=this;this.agent=navigator.userAgent.toLowerCase(),this.detect=function(match){return this.agent.includes(match)},this.touchCapable=!!navigator.maxTouchPoints,this.hoverCapable=window.matchMedia?.("(hover: hover)")?.matches||!this.touchCapable,this.pixelRatio=window.devicePixelRatio,this.system={},this.system.retina=window.devicePixelRatio>1,this.system.webworker=void 0!==window.Worker,window._NODE_||(this.system.geolocation=void 0!==navigator.geolocation),window._NODE_||(this.system.pushstate=void 0!==window.history.pushState),this.system.webcam=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices),this.system.language=window.navigator.userLanguage||window.navigator.language,this.system.webaudio=void 0!==window.AudioContext,this.system.xr={},this.system.detectXR=async function(){if(window.AURA)return _this.system.xr.vr=!0,void(_this.system.xr.ar=!0);if(!navigator.xr)return _this.system.xr.vr=!1,void(_this.system.xr.ar=!1);try{[_this.system.xr.vr,_this.system.xr.ar]=await Promise.all([navigator.xr.isSessionSupported("immersive-vr"),navigator.xr.isSessionSupported("immersive-ar")])}catch(e){}"android"==_this.system.os&&(_this.detect("oculus")||(_this.system.xr.vr=!1))};try{this.system.localStorage=void 0!==window.localStorage}catch(e){this.system.localStorage=!1}this.system.fullscreen=document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled,this.system.os=_this.detect(["ipad","iphone","ios"])||function detectIpad(){let aspect=Math.max(screen.width,screen.height)/Math.min(screen.width,screen.height);return _this.detect("mac")&&_this.touchCapable&&Math.abs(aspect-4/3)<Math.abs(aspect-1.6)}()?"ios":_this.detect(["android","kindle"])?"android":_this.detect(["blackberry"])?"blackberry":_this.detect(["mac os"])?"mac":_this.detect(["windows","iemobile"])?"windows":_this.detect(["linux"])?"linux":"unknown",this.system.version=function(){try{if("ios"==_this.system.os){if(_this.agent.includes("intel mac")){let split=_this.agent.split("version/")[1].split(" ")[0].split(".");return Number(split[0]+"."+split[1])}var num=_this.agent.split("os ")[1].split("_"),main=num[0],sub=num[1].split(" ")[0];return Number(main+"."+sub)}if("android"==_this.system.os){var version=_this.agent.split("android ")[1].split(";")[0];return version.length>3&&(version=version.slice(0,-2)),"."==version.charAt(version.length-1)&&(version=version.slice(0,-1)),Number(version)}if("windows"==_this.system.os)return _this.agent.includes("rv:11")?11:Number(_this.agent.split("windows phone ")[1].split(";")[0])}catch(e){}return-1}(),this.system.browser="ios"==_this.system.os?_this.detect(["twitter","fbios","instagram"])?"social":_this.detect(["crios"])?"chrome":_this.detect(["fxios"])?"firefox":_this.detect(["safari"])?"safari":"unknown":"android"==_this.system.os?_this.detect(["twitter","fb","facebook","instagram"])?"social":_this.detect(["chrome"])?"chrome":_this.detect(["firefox"])?"firefox":"browser":_this.detect(["msie"])||_this.detect(["trident"])&&_this.detect(["rv:"])||_this.detect(["windows"])&&_this.detect(["edge"])?"ie":_this.detect(["chrome"])?"chrome":_this.detect(["safari"])?"safari":_this.detect(["firefox"])?"firefox":"unknown",this.system.browserVersion=function(){try{if("chrome"==_this.system.browser)return _this.detect("crios")?Number(_this.agent.split("crios/")[1].split(".")[0]):Number(_this.agent.split("chrome/")[1].split(".")[0]);if("firefox"==_this.system.browser)return Number(_this.agent.split("firefox/")[1].split(".")[0]);if("safari"==_this.system.browser)return Number(_this.agent.split("version/")[1].split(".")[0].split(".")[0]);if("ie"==_this.system.browser)return _this.detect(["msie"])?Number(_this.agent.split("msie ")[1].split(".")[0]):_this.detect(["rv:"])?Number(_this.agent.split("rv:")[1].split(".")[0]):Number(_this.agent.split("edge/")[1].split(".")[0])}catch(e){return-1}}(),this.mobile=!(window._NODE_||!("ontouchstart"in window)&&!("onpointerdown"in window)||!_this.system.os.includes(["ios","android","magicleap"]))&&{},_this.detect("oculusbrowser")&&(this.mobile=!0),_this.detect("quest")&&(this.mobile=!0),this.mobile&&this.detect(["windows"])&&!this.detect(["touch"])&&(this.mobile=!1),this.mobile&&(this.mobile.tablet=Math.max(window.screen?screen.width:window.innerWidth,window.screen?screen.height:window.innerHeight)>1e3,this.mobile.phone=!this.mobile.tablet,this.mobile.pwa=!(!window.matchMedia||!window.matchMedia("(display-mode: standalone)").matches)||!!window.navigator.standalone,Hydra.ready(()=>{_this.mobile.native=!(!Mobile.NativeCore||!Mobile.NativeCore.active)||!!window._AURA_})),this.media={},this.media.audio=!!document.createElement("audio").canPlayType&&(_this.detect(["firefox","opera"])?"ogg":"mp3"),this.media.video=((vid=document.createElement("video")).setAttribute("muted",!0),vid.setAttribute("loop",!0),vid.setAttribute("autoplay",!0),vid.setAttribute("preload",!0),vid.setAttribute("playsinline",!0),vid.setAttribute("webkit-playsinline",!0),vid.autoplay=!0,vid.muted=!0,vid.src="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAG1wNDJpc28yYXZjMW1wNDEAAANObW9vdgAAAGxtdmhkAAAAAOA5QnjgOUJ4AAAD6AAAAEMAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAmt0cmFrAAAAXHRraGQAAAAD4DlCeOA5QngAAAABAAAAAAAAAEMAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAACAAAAAgAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAABDAAAAAAABAAAAAAHjbWRpYQAAACBtZGhkAAAAAOA5QnjgOUJ4AAFfkAAAF3BVxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAABjm1pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAU5zdGJsAAAAznN0c2QAAAAAAAAAAQAAAL5hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAACAAIABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAMWF2Y0MBTUAo/+EAGWdNQCjspLYC1BgYGQAAAwABAAK/IA8YMZYBAAVo6uEyyAAAABNjb2xybmNseAAGAAYABgAAAAAQcGFzcAAAAAEAAAABAAAAFGJ0cnQAAAAAAAF1IAABdSAAAAAYc3R0cwAAAAAAAAABAAAAAgAAC7gAAAAUc3RzcwAAAAAAAAABAAAAAQAAABxzdHNjAAAAAAAAAAEAAAABAAAAAgAAAAEAAAAcc3RzegAAAAAAAAAAAAAAAgAAAxAAAAAMAAAAFHN0Y28AAAAAAAAAAQAAA34AAABvdWR0YQAAAGdtZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAADppbHN0AAAAMql0b28AAAAqZGF0YQAAAAEAAAAASGFuZEJyYWtlIDEuNi4xIDIwMjMwMTIyMDAAAAAIZnJlZQAAAyRtZGF0AAAC9AYF///w3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE2NCByMzEwMCBlZDBmN2E2IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAyMiAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTIgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9NiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTEgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTEga2V5aW50PTMwMCBrZXlpbnRfbWluPTMwIHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9MzAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMi4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT0yMDAwMCB2YnZfYnVmc2l6ZT0yNTAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAABRliIQAK//+9q78yyt0fpUs1YVPgQAAAAhBmiFsQn/+Vg==",vid.play().then(()=>{}).catch(()=>{}),vid.addEventListener("canplaythrough",_=>{vid.paused&&_this.mobile&&(_this.mobile.lowPowerMode=!0),setTimeout(_=>vid.pause(),500)}),!!vid.canPlayType&&(vid.canPlayType("video/webm;")?"webm":"mp4")),this.media.webrtc=!!(window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection||window.oRTCPeerConnection||window.RTCPeerConnection),this.graphics={},this.graphics.webgl=function(){let DISABLED=!1;Object.defineProperty(_this.graphics,"webgl",{get:()=>{if(DISABLED)return!1;if(_this.graphics._webglContext)return _this.graphics._webglContext;let iOSContextLoss="ios"===_this.system.os&&_this.system.browserVersion>16.7&&_this.system.browserVersion<17.1;try{const names=["webgl2","webgl","experimental-webgl"],canvas=document.createElement("canvas");canvas.width=1,canvas.height=1;let gl,contextAttributes={};iOSContextLoss||(contextAttributes.powerPreference="high-performance"),canvas.addEventListener("webglcontextlost",()=>Events.emitter._fireEvent(Events.WEBGL_CONTEXT_LOSS),!1);for(let i=0;i<names.length&&("webgl2"===names[i]&&Utils.query("compat")||(gl=canvas.getContext(names[i],contextAttributes),!gl));i++);if(gl.isContextLost())return window.__WEBGL_CONTEXT_LOSS=!0,DISABLED=!0,!1;let output={gpu:"unknown"};if(iOSContextLoss&&(output.iOSContextLoss=iOSContextLoss),output.renderer=gl.getParameter(gl.RENDERER).toLowerCase(),output.version=gl.getParameter(gl.VERSION).toLowerCase(),output.glsl=gl.getParameter(gl.SHADING_LANGUAGE_VERSION).toLowerCase(),output.extensions=gl.getSupportedExtensions(),output.webgl2=output.version.includes(["webgl 2","webgl2"]),output.canvas=canvas,output.context=gl,"firefox"===_this.system.browser&&_this.system.browserVersion>=92)output.gpu=output.renderer;else{let info=gl.getExtension("WEBGL_debug_renderer_info");if(info){let gpu=info.UNMASKED_RENDERER_WEBGL;output.gpu=gl.getParameter(gpu).toLowerCase()}}return output.detect=function(matches){if(output.gpu&&output.gpu.toLowerCase().includes(matches))return!0;if(output.version&&output.version.toLowerCase().includes(matches))return!0;for(let i=0;i<output.extensions.length;i++)if(output.extensions[i].toLowerCase().includes(matches))return!0;return!1},output.webgl2||output.detect("instance")||window.AURA?(_this.graphics._webglContext=output,output):(DISABLED=!0,!1)}catch(e){return!1}},set:v=>{!1===v&&(DISABLED=!0)}})}(),this.graphics.metal=function(){if(!window.Metal)return!1;let output={};return output.gpu=Metal.device.getName().toLowerCase(),output.detect=function(matches){return output.gpu.includes(matches)},output}(),this.graphics.gpu=function(){if(!_this.graphics.webgl&&!_this.graphics.metal)return!1;let output={};return["metal","webgl"].forEach(name=>{_this.graphics[name]&&!output.identifier&&(output.detect=_this.graphics[name].detect,output.identifier=_this.graphics[name].gpu)}),output}(),this.graphics.canvas=!!document.createElement("canvas").getContext;const checkForStyle=function(){let _tagDiv;return function(prop){_tagDiv=_tagDiv||document.createElement("div");const vendors=["Khtml","ms","O","Moz","Webkit"];if(prop in _tagDiv.style)return!0;prop=prop.replace(/^[a-z]/,val=>val.toUpperCase());for(let i=vendors.length-1;i>=0;i--)if(vendors[i]+prop in _tagDiv.style)return!0;return!1}}();this.styles={},this.styles.filter=checkForStyle("filter"),this.styles.blendMode=checkForStyle("mix-blend-mode"),this.tween={},this.tween.transition=checkForStyle("transition"),this.tween.css2d=checkForStyle("transform"),this.tween.css3d=checkForStyle("perspective"),this.social=_this.agent.includes("instagram")?"instagram":_this.agent.includes("fban")||_this.agent.includes("fbav")||_this.agent.includes("fbios")?"facebook":(_this.agent.includes("twitter")||!(!document.referrer||!document.referrer.includes("//t.co/")))&&"twitter"},"Static"),Class(function Component(){if(this.initClass)return;Inherit(this,Events);const _this=this,_setters={},_flags={},_timers=[],_loops=[];var _onDestroy,_appStateBindings;function defineSetter(_this,prop){_setters[prop]={},Object.defineProperty(_this,prop,{set:function(v){_setters[prop]&&_setters[prop].s&&_setters[prop].s.call(_this,v),v=null},get:function(){if(_setters[prop]&&_setters[prop].g)return _setters[prop].g.apply(_this)}})}this.classes={},this.findParent=function(type){let p=_this.parent;for(;p;){if(p._cachedName||(p._cachedName=Utils.getConstructorName(p)),p._cachedName==type)return p;p=p.parent}},this.set=function(prop,callback){_setters[prop]||defineSetter(this,prop),_setters[prop].s=callback},this.get=function(prop,callback){_setters[prop]||defineSetter(this,prop),_setters[prop].g=callback},this.isPlayground=function(name){return!("boolean"!=typeof name||!Global.PLAYGROUND)||Global.PLAYGROUND&&Global.PLAYGROUND==(name||Utils.getConstructorName(_this))},this.initClass=function(clss){if(!clss)throw console.trace(),"unable to locate class";const clssName=Utils.getConstructorName(clss);if(Global.RESERVED_CLASSES[clssName]&&(clss=Global.RESERVED_HYDRA_CLASSES[clssName]),clss.instance)return clss.instance();const args=[].slice.call(arguments,1),child=Object.create(clss.prototype);if(child.parent=this,child.__afterInitClass=[],clss.apply(child,args),child.destroy){const id=Utils.timestamp();this.classes[id]=child,this.classes[id].__id=id}if(child.element){const last=arguments[arguments.length-1];Array.isArray(last)&&1==last.length&&last[0]instanceof child.element.constructor?last[0].add(child.element):this.element&&this.element.add&&null!==last&&this.element.add(child.element)}if(child.group){const last=arguments[arguments.length-1];this.group&&null!==last&&this.group.add(child.group),this.scene&&null!==last&&this.scene.add(child.group)}if("undefined"!=typeof Hydra&&Hydra.LOCAL){let key=Utils.getConstructorName(child);key&&(Component.HMR.has(key)||Component.HMR.set(key,[]),Component.HMR.get(key).push({ref:child,args:args}))}return child.__afterInitClass.forEach(callback=>{callback()}),delete child.__afterInitClass,child},this.delayedCall=function(callback,time,scaledTime){const timer=Timer.create(()=>{_this&&_this.destroy&&callback&&callback()},time,scaledTime);return _timers.push(timer),_timers.length>50&&_timers.shift(),timer},this.clearTimers=function(){for(let i=_timers.length-1;i>=0;i--)clearTimeout(_timers[i]);_timers.length=0},this.startRender=function(callback,fps,obj){"number"!=typeof fps&&(obj=fps,fps=void 0);for(let i=0;i<_loops.length;i++)if(_loops[i].callback==callback)return;let flagInvisible=_=>{_this._invisible||(_this._invisible=!0,_this.onInvisible&&_this.onInvisible())},loop=(a,b,c,d)=>{if(!_this.startRender)return!1;let p=_this;for(;p;){if(!1===p.visible)return flagInvisible();if(p.group&&!1===p.group.visible)return flagInvisible();p=p.parent}!1!==_this._invisible&&(_this._invisible=!1,_this.onVisible&&_this.onVisible());try{callback(a,b,c,d)}catch(error){let evt={callback:callback,error:error,component:_this,preventStopRender:!1};Events.emitter._fireEvent(Render.RENDER_CALLBACK_ERROR,evt),evt.preventStopRender||_this.stopRender(callback,obj)}return!0};_loops.push({callback:callback,loop:loop,obj:obj}),obj?obj==RenderManager.NATIVE_FRAMERATE?Render.start(loop,null,!0):RenderManager.schedule(loop,obj):Render.start(loop,fps)},this.onResize=function(callback,callInitial=!0){callInitial&&callback(),this.events.sub(Events.RESIZE,callback)},this.stopRender=function(callback,obj){for(let i=0;i<_loops.length;i++)if(_loops[i].callback==callback){let loop=_loops[i].loop;obj&&RenderManager.unschedule(loop,obj),Render.stop(loop),_loops.splice(i,1)}},this.clearRenders=function(){for(let i=0;i<_loops.length;i++){let{loop:loop,obj:obj}=_loops[i];obj?RenderManager.unschedule(loop,obj):Render.stop(loop)}_loops.length=0},this.wait=function(object,key,callback){const promise=Promise.create();let condition,appState;if("string"==typeof object&&(callback=key,key=object,object=_this),key?.includes?.("/")&&(appState=AppState),object.isAppState&&(appState=object),"number"==typeof object&&1===arguments.length)return _this.delayedCall(promise.resolve,object),promise;if("function"==typeof object&&1===arguments.length&&(condition=object,object=_this),"function"==typeof object&&"string"==typeof callback){let _object=object;object=key,key=callback,callback=_object}if(callback=callback||promise.resolve,condition||(appState?"!"===key?.charAt?.(0)?(key=key.slice(1),condition=()=>!appState.get(key)):condition=()=>!!appState.get(key):"!"===key?.charAt?.(0)?(key=key.slice(1),condition=()=>!(object[key]||"function"==typeof object.flag&&object.flag(key))):condition=()=>!!object[key]||!("function"!=typeof object.flag||!object.flag(key))),condition())callback();else{let stop;if(appState){let binding=_this.bindState(appState,key,test);stop=function(){binding.destroy()}}else stop=function(){Render.stop(test)},Render.start(test);function test(){if(!object||!_this.flag||null===object.destroy)return stop(test);condition()&&(callback(),stop(test))}}return promise},this.bindState=function(appState,key,...rest){if(appState.then)return(async()=>_this.bindState(await appState,key,...rest))();"object"!=typeof appState||appState.constructor!==Object||appState.isAppState||(appState=AppState.createLocal(appState)),_appStateBindings||(_appStateBindings=[]);let binding=(appState._bind||appState.bind).bind(appState)(key,...rest);return _appStateBindings.push(binding),binding._bindOnDestroy(()=>{_appStateBindings.remove(binding)}),binding},this.flag=function(name,value,time){if(void 0===value)return _flags[name];{_flags[name]=value;let timerKey=name+"_timer",timer=_flags[timerKey];timer&&(clearTimeout(timer),_flags[timerKey]=null),time&&(_flags[timerKey]=this.delayedCall(()=>{_flags[name]=!value,_flags[timerKey]=null},time))}},this.destroy=function(){this.removeDispatch&&this.removeDispatch(),this.onDestroy&&this.onDestroy(),this.fxDestroy&&this.fxDestroy(),_onDestroy&&(_onDestroy.forEach(cb=>cb()),_onDestroy=null);for(let key in _setters)delete _setters[key];for(let key in _flags)delete _flags[key];for(let id in this.classes){var clss=this.classes[id];clss&&clss.destroy&&clss.destroy()}if(this.classes=null,Hydra.LOCAL){let key=Utils.getConstructorName(this),array=Component.HMR.get(key);array&&array.remove(this)}if(this.clearRenders&&this.clearRenders(),this.clearTimers&&this.clearTimers(),this.element&&window.GLUI&&this.element instanceof GLUIObject&&this.element.remove(),this.events&&(this.events=this.events.destroy()),this.parent&&this.parent.__destroyChild&&this.parent.__destroyChild(this.__id),_appStateBindings)for(;_appStateBindings.length>0;)_appStateBindings[_appStateBindings.length-1].destroy?.();return Utils.nullObject(this)},this._bindOnDestroy=function(cb){_onDestroy||(_onDestroy=[]),_onDestroy.push(cb)},this.__destroyChild=function(name){delete this.classes[name]},this.navigate=function(route){let p=_this.parent;for(;p;)p.navigate&&p.navigate(route),p=p.parent}},_=>{Component.HMR=new Map,Component.HMR_INSTANCE_RELOADED="Component.HMR_INSTANCE_RELOADED"}),Class(function Model(){Inherit(this,Component),Namespace(this);const _this=this,_storage={},_requests={};let _data=0,_triggered=0;this.push=function(name,val){_storage[name]=val},this.pull=function(name){return _storage[name]},this.waitForData=this.promiseData=function(num=1){_data+=num},this.fulfillData=this.resolveData=function(){_triggered++,_triggered==_data&&(_this.dataReady=!0)},this.ready=function(callback){let promise=Promise.create();return callback&&promise.then(callback),_this.wait(_this,"dataReady").then(promise.resolve),promise},this.initWithData=function(data){for(var key in _this.STATIC_DATA=data,_this){var model=_this[key],init=!1;for(var i in data)i.toLowerCase().replace(/-/g,"")==key.toLowerCase()&&(init=!0,model.init&&model.init(data[i]));!init&&model.init&&model.init()}_this.init&&_this.init(data)},this.loadData=function(url,callback){let promise=Promise.create();callback||(callback=promise.resolve);var _this=this;return get(url+"?"+Utils.timestamp()).then(d=>{defer(()=>{_this.initWithData(d),callback(d)})}),promise},this.handleRequest=function(type,callback){_requests[type]=callback},this.makeRequest=this.request=async function(type,data,mockData={}){if("function"==typeof type&&(mockData=type,data=null,type=null),"function"==typeof data&&(mockData=data,data=null),"function"==typeof mockData&&(mockData=await mockData()),mockData?.reflow)return mockData;if(!_requests[type])return Array.isArray(mockData)?new StateArray(mockData):AppState.createLocal(mockData);let result=await _requests[type](data,mockData);if(Array.isArray(result)?result=new StateArray(result):"object"==typeof result&&(result instanceof StateArray||result.isAppState||(result=AppState.createLocal(result))),!(result instanceof StateArray||result.createLocal))throw`makeRequest ${type} must return either an AppState or StateArray`;return result}}),Class(function Data(){Inherit(this,Model)},"static"),Class(function Modules(){const _modules={},_constructors={};function exec(){for(let m in _modules)for(let key in _modules[m]){let module=_modules[m][key];module._ready||(module._ready=!0,module.exec&&module.exec())}}defer(exec),this.Module=function(module){let m=new module,name=module.toString().slice(0,100).match(/function ([^\(]+)/);name?(m._ready=!0,name=name[1],_modules[name]={index:m},_constructors[name]=module):(_modules[m.module]||(_modules[m.module]={}),_modules[m.module][m.path]=m)},this.require=function(path){let root;return path.includes("/")?(root=path.split("/")[0],path=path.replace(root+"/","")):(root=path,path="index"),function requireModule(root,path){let module=_modules[root];if(!module)throw`Module ${root} not found`;return module=module[path],module._ready||(module._ready=!0,module.exec&&module.exec()),module}(root,path).exports},this.getConstructor=function(name){return _constructors[name]},this.modulesReady=async function(){let modules=[...arguments].flat();await Promise.all(modules.map(name=>Modules.moduleReady(name)))},this.moduleReady=function(name){let promise=Promise.create(),check=function(){_modules[name]&&(Render.stop(check),promise.resolve())};return Render.start(check),promise},window.Module=this.Module,window._NODE_||(window.requireNative=window.require,window.require=this.require)},"Static"),Class(function StateWrapper(_array){const _this=this;Inherit(this,Component),this.bind=this.listen=function(key,callback){_array.forEach(async obj=>{await obj.wait("__ready"),_this.bindState(obj.state,key,data=>{callback({target:obj,data:data})})})}}),Class(function StateInitializer(Class,_ref,_params,_stateRef){Inherit(this,Component);const _this=this;var _initTime=Render.TIME;function parseState(state){return state.includes("/")||(state=_this.parent.fragName+"/"+state),state}function onInit(bool){if(_initTime=Render.TIME,bool){for(let key in _params)if(_params[key].includes?.("#x#")&&(_params[key]=_params[key].replace(/#x#/g,"")),_params[key].includes?.("_this.")){let path=_params[key].split("_this.")[1].split("."),value=_this.parent;for(let i=0;i<path.length&&(value=value[path[i]],value);i++);_params[key]=value}_this.parent[_ref]=_this.parent.initClass(Class,AppState.createLocal(_params))}else _this.parent[_ref]=_this.parent[_ref]?.destroy()}async function onInit3D(){await _this.wait(Math.max(1e3-(Render.TIME-_initTime),0)),await _this.wait(_=>!!_this.parent[_ref]);let ref=_this.parent[_ref];ref.nuke&&await Initializer3D.uploadNuke(ref.nuke);const group=ref.layout||ref.scene||ref.group||ref.element?.group;group&&await Initializer3D.uploadAllAsync(group)}this.ref=_ref,function(){if(!_stateRef.init)throw"StateInitializer required init parameter";_stateRef.init.includes?.("#x#")?eval(_stateRef.init.replace(/#x#/g,""))&&onInit(!0):"true"==_stateRef.init||1==_stateRef.init?onInit(!0):_this.bindState(AppState,parseState(_stateRef.init),onInit),_stateRef.init3d&&_this.bindState(AppState,parseState(_stateRef.init3d),onInit3D)}(),this.force=function(){AppState.set(parseState(_stateRef.init),!0)}}),Class(function Initialization(){this.initSync=async function(obj){await Initializer3D.uploadAll(obj)},this.initAsync=async function(obj){await Initializer3D.uploadAllAsync(obj)}}),Class(function FragUIHelper(_obj,_root){Inherit(this,Component);const _this=this,invalidDomAttrs=["refname","_innertext","_type","_placeholder","addto"],isGLUI=!!window.GLUI,_createdObjs=new Map;function isCustomComponentType(type){return!function isLowerCase(str){return str.charAt(0)==str.charAt(0).toLowerCase()}(type)&&"UI"!==type&&"GLObject"!==type&&"glObject"!==type&&"glObj"!==type&&"GLText"!==type&&"glText"!==type&&"HydraObject"!==type}function findStateObject(text){return text.match(/\$([a-zA-z]\w*)\./)[1]}function getPropByString(obj,propString){if(!propString)return obj;for(var props=propString.split("."),i=0,iLen=props.length-1;i<iLen;i++){var candidate=obj[props[i]];if(void 0===candidate)break;obj=candidate}return obj[props[i]]}function parseTextBindings(text){let match,binds=[];for(;match=text.match(/\$([a-zA-z]\w*)\./);){let split=text.split(match[0]);split[0]=split[0]+"@[",split[1]=split[1].split(" ");let name=split[1][0];split[1][0]+="]",split[1]=split[1].join(" "),text=split.join(""),binds.push(name)}return[binds,text]}function parseTextGlobalBindings(text){let match,binds=[];for(;match=text.match(/\$([a-zA-z]\w*)\/(\w+)/);){let split=text.split(match[0]);split[0]=split[0]+"@[",split[1]=split[1].split(" ");let name=match[0].slice(1).trim();split[1][0]=name,split[1][0]+="]",split[1]=split[1].join(" "),text=split.join(""),binds.push(name)}return[binds,text]}function parseCSSTransformStr(obj){let data={};return obj.split(",").forEach(param=>{let[a,b]=param.split(":");a=a.trim(),b=b?.trim?.(),isNaN(b)||(b=Number(b)),data[a]=b}),data}function doConstructor(obj){if(" "===obj._type||"\n"===obj._type)return document.createTextNode(obj._type);switch(obj._type){case"inlinetext":return document.createTextNode(obj._innerText);case"UI":return _this.parent.element||_this.parent.getDOMElement?.();case"GLObject":case"glObject":case"glObj":return obj.width&&obj.height&&obj.bg?$gl(Number(obj.width),Number(obj.height),obj.bg):$gl();case"GLText":case"glText":if(obj._innerText.match?.(/\$([a-zA-z]\w*)\./)){let{font:font,fontSize:fontSize,fontColor:fontColor,_innerText:_innerText,...options}=obj,state=findStateObject(obj._innerText);const stateAsNumber=Number(state);if(!isNaN(stateAsNumber))return $glText(obj._innerText,obj.font,Number(obj.fontSize),{color:fontColor,...options});let ref=state;if(ref.includes(".")){let split=ref.split(".");ref=split[0],split.shift(),state=split.join(".")}let[binds,text]=parseTextBindings(obj._innerText),$text=$glText(text,obj.font,Number(obj.fontSize),{color:fontColor,...options,waitForSetText:!0});return _this.wait(_this.parent,ref).then(_=>{_this.parent.bindState(ref==state?_this.parent[ref]:getPropByString(_this.parent[ref],state),binds,$text)}),$text}if(obj._innerText.match?.(/\$([a-zA-z]\w*)\/(\w+)/)){let[binds,text]=parseTextGlobalBindings(obj._innerText),{font:font,fontSize:fontSize,fontColor:fontColor,_innerText:_innerText,...options}=obj,$text=$glText(obj._innerText,obj.font,Number(obj.fontSize),{color:fontColor,...options});return _this.parent.bindState(AppState,binds,$text),$text}{let{font:font,fontSize:fontSize,fontColor:fontColor,_innerText:_innerText,...options}=obj;return $glText(obj._innerText,obj.font,Number(obj.fontSize),{color:fontColor,...options})}default:let $obj=$(obj.className||obj.refName||"h","HydraObject"!=obj._type?obj._type:"div");if(obj.width&&obj.height&&$obj.size(obj.width,obj.height),obj.font&&$obj.fontStyle(obj.font,Number(obj.fontSize),obj.fontColor),obj._innerText)if(obj._innerText.match?.(/\$([a-zA-z]\w*)\./)){let state=findStateObject(obj._innerText),ref=state;const stateAsNumber=Number(ref);if(!isNaN(stateAsNumber))return $obj.html(obj._innerText),$obj;if(ref.includes(".")){let split=state.split(".");ref=split[0],split.shift(),state=split.join(".")}_this.wait(_this.parent,ref).then(_=>{let[binds,text]=parseTextBindings(obj._innerText);$obj.html?.(text),_this.parent?.bindState(ref==state?_this.parent[ref]:getPropByString(_this.parent[ref],state),binds,$obj)})}else if(obj._innerText.match?.(/\$([a-zA-z]\w*)\/(\w+)/)){let[binds,text]=parseTextGlobalBindings(obj._innerText);$obj.html(text),_this.parent.bindState(AppState,binds,$obj)}else $obj.html(obj._innerText);return $obj}}function checkIfParentIs(obj,tagName){for(;obj.parentNode;){if(obj.parentNode?.tagName?.toLowerCase?.()===tagName.toLowerCase())return!0;obj=obj.parentNode}return!1}function applyValues(obj,$obj){const callObjKeyVal=key=>new Promise(resolve=>{const applyValue=val=>{if(!(isGLUI&&($obj instanceof GLUIObject||$obj instanceof GLUIText)&&("width"===key||"height"===key||"bg"===key)&&obj.width&&obj.height&&obj.bg))if("function"==typeof $obj[key])$obj[key](val);else{if($obj instanceof HydraObject&&!invalidDomAttrs.includes(key.toLowerCase()))if("className"===key){if("string"!=typeof val||"string"!=typeof $obj.div.className)return;$obj.classList().add(...val.split(/\s+/)),$obj.div.className.includes("$")&&$obj.div.classList.forEach(className=>{isDollarExpression(className)&&$obj.div.classList.remove(className)})}else $obj.attr(FragUIHelper.SVG_ALIAS.get(key)||key,val);$obj[key]=val}},callFn=async()=>{let val=obj[key];if("string"==typeof val){if(val.match(/\$([a-zA-z]\w*)\./)){let stateStr=findStateObject(val),state=_this.parent[stateStr];state||(await _this.wait(_this.parent,stateStr),state=_this.parent[stateStr]),state.then&&(state=await state);let[binds]=parseTextBindings(val);return _this.parent.bindState(state,binds,dataVal=>applyValue(dataVal))}if(val.match(/\$([a-zA-z]\w*)\/(\w+)/)){let[binds]=parseTextGlobalBindings(val);return _this.parent.bindState(AppState,binds,dataVal=>applyValue(dataVal))}if(isDollarExpression(val)&&"$element"!=val)return applyValue(_this.parent[val.slice(1)])}applyValue(val)};if(_this.parent.__afterInitClass)return _this.parent.__afterInitClass.push(()=>resolve(callFn()));resolve(callFn())});let handledInteract=!1;for(let key in obj)if("_type"!==key&&"refName"!==key&&"children"!==key&&"display"!==key){if("shader"==key)if($obj.text)$obj.text.onCreateMesh=mesh=>{let shader=mesh.shader;window[shader.vsName]&&(mesh.shaderClass=_this.parent.initClass(window[shader.vsName],mesh,shader))};else{let shader=_this.initClass(Shader,obj[key],{tMap:{value:null}});if(window[shader.vsName]){let mesh=$obj.mesh||{};mesh.shaderClass=_this.parent.initClass(window[shader.vsName],mesh,shader)}$obj.useShader(shader)}if(obj.width&&obj.height&&$obj.size&&$obj.size(obj.width,obj.height),"css"==key||"transform"==key)checkIfParentIs($obj.div,"svg")?$obj.attr(key,obj[key]):$obj[key](parseCSSTransformStr(obj[key]));else if("onClick"==key||"onHover"==key){if(!handledInteract&&(handledInteract=!0,obj.onClick||obj.onHover)){let handlerKeys=["onClick","onHover"],handlers={};_this.wait(()=>handlerKeys.every(handlerKey=>{let handler=obj[handlerKey];if(handlers[handlerKey]=handler,!handler)return!0;if("function"==typeof handler)return!0;if("string"!=typeof handler)throw new Error(`Unexpected ${handlerKey} type '${typeof handler}'`);return handler=_this.parent[handler.slice(1)],handlers[handlerKey]=handler,!!handler})).then(()=>{$obj.interact(handlers.onHover||GLUIObject.noop,handlers.onClick||GLUIObject.noop,obj.seoLink,obj.seoText)})}}else if("function"==typeof $obj[key]){if("size"==key){let size=obj.size.split(",");size.map(x=>Number(x)),$obj.size(size[0],size[1]);continue}1===obj[key]&&(obj[key]=void 0),callObjKeyVal(key)}else callObjKeyVal(key)}}function convertToUsableRef(str){str.startsWith("$")&&(str=str.slice(1));let ref=str,state=str;if(str.includes(".")){let split=str.split(".");state=split[0],split.shift(),ref=split.join(".")}return[state,ref]}function isDollarExpression(str){return str&&/^\$[a-zA-z]\w*/.test(str)}function create(obj,parent,isDeferredPhase=!1){if(" "===obj._type||"\n"===obj._type){let textNode=doConstructor(obj);return void(parent&&parent.div?parent.div.appendChild(textNode):parent&&parent.appendChild&&parent.appendChild(textNode))}if(isCustomComponentType(obj._type)){if(propsRequireDefer(obj)){if(!isDeferredPhase)return obj._placeholder=document.createElement("span"),void(parent.element||parent)?.add(obj._placeholder)}else if(isDeferredPhase)return createChildren(obj,_createdObjs.get(obj),isDeferredPhase);let paramsState,params={};for(let key in obj)if("_type"!==key&&"refName"!==key&&"children"!==key&&"display"!==key&&"_placeholder"!==key&&"conditional"!==key&&(params[key]=obj[key],params[key]))if(params[key].match?.(/\$([a-zA-z]\w*)\./)){let[state,ref]=convertToUsableRef(params[key]);if(state==ref)params[key]=_this.parent[state];else if(_this.parent[state]?.isAppState&&ref.indexOf(".")<0){let[binds,text]=parseTextBindings(params[key]),isInitialized=!1,binding=newValue=>{isInitialized=!0,paramsState?paramsState[key]=newValue:params[key]=newValue};binding._string=text,_this.parent.bindState(_this.parent[state],binds,binding),isInitialized||binding()}else params[key]=getPropByString(_this.parent[state],ref)}else if(params[key].match?.(/\$([a-zA-z]\w*)\/(\w+)/)){let[binds,text]=parseTextGlobalBindings(params[key]),isInitialized=!1,binding=newValue=>{isInitialized=!0,paramsState?paramsState[key]=newValue:params[key]=newValue};binding._string=text,_this.parent.bindState(AppState,binds,binding),isInitialized||binding()}else if("string"==typeof params[key]&&isDollarExpression(params[key])){let pk=params[key],value=_this.parent[pk.slice(1)];null==value?(params["wait_"+key]=_this.wait(_this.parent,pk.slice(1)).then(_=>_this.parent[pk.slice(1)]),params[key]=void 0):params[key]=value}"ViewState"==obj._type&&(params.__parent=parent,params?.view&&"string"==typeof params.view&&!window[params.view]?console.warn(`ViewState will attempt to create ${params.view}, but it doesn't exist, this will probably break.`):!params?.data&&obj?.data&&console.warn(`ViewState for ${obj.view} on ${_this.parent.fragName} has no data, will attempt to bind ${obj.data} after initialization.`));let $obj=_this.parent.initClass(window[obj._type],paramsState=AppState.createLocal(params),isDeferredPhase?null:[parent.element||parent]);if("ViewState"===obj._type&&!$obj.stateArray&&!paramsState.data&&obj.data){let match=obj.data.match(/(?:\$|_this(?:\.|\[\s*['"]?))([\w]+)(?:['"]?\s*\])?\.(.+)/);if(match){let[_,key,prop]=match;if(_this.parent?.[key]?.isAppState){let initBinding=_this.parent.bindState(_this.parent[key],prop,data=>{$obj.setSourceData(data),initBinding.destroy(),initBinding=null})}else console.warn(`${_this.parent.fragName}.${key} is not an AppState, cannot bind to ${key}.${prop}`)}else console.warn(`Could not parse binding for ${obj.data} on ${_this.parent.fragName}`)}if(isDeferredPhase){if($obj.element){obj._placeholder.replaceWith($obj.element.div);const $parent=parent.element||parent;$parent&&($parent._children.push($obj.element),$obj.element._parent=$parent),$obj.element.onMountedHook&&defer(_=>{$obj.element.onMountedHook(),delete $obj.element.onMountedHook})}else obj._placeholder.parentNode.removeChild(obj._placeholder);delete obj._placeholder}return _this.parent[obj.refName]=$obj,_createdObjs.set(obj,$obj),createChildren(obj,$obj,isDeferredPhase),void(params.css&&$obj.element.css(parseCSSTransformStr(params.css)))}if(isDeferredPhase)return createChildren(obj,_createdObjs.get(obj),isDeferredPhase);let $obj=doConstructor(obj);if(void 0!==obj.conditional&&_this.parent.state&&(_this.parent.state.get(obj.conditional)?$obj.show?.():$obj.hide?.(),_this.bindState(_this.parent.state,obj.conditional,bool=>{bool?$obj.show?.():$obj.hide?.()})),obj.addTo){let addTo=obj.addTo;"string"==typeof addTo&&(addTo=addTo.replace(/\$/g,"_this."),addTo=Function("_this",`"use strict";return (${addTo});`)(_this.parent)||_this.parent.element),addTo?.add($obj)}else parent&&parent.add($obj);applyValues(obj,$obj),$obj?.transform?.(),obj.refName&&(_this.parent[obj.refName]=$obj),_createdObjs.set(obj,$obj),createChildren(obj,$obj,isDeferredPhase)}async function createChildren(obj,$obj,isDeferredPhase=!1){obj.children.forEach(o=>create(o,$obj,isDeferredPhase)),!isDeferredPhase&&obj===_obj&&anyChildrenRequireDefer(obj)&&(await defer(),obj.children.forEach(o=>create(o,$obj,!0))),obj===_obj&&_createdObjs.clear()}function propsRequireDefer(obj){if(isCustomComponentType(obj._type))for(let key in obj){if("_type"===key||"refName"===key||"children"===key||"display"===key||"_placeholder"===key)continue;let param=obj[key];if(isDollarExpression(param)&&(!param?.startsWith?.("$data.")||!_this.parent.contexts.includes("ViewStateElement")))return!0}return!1}function anyChildrenRequireDefer(obj){return obj.children.some(o=>!!propsRequireDefer(o)||anyChildrenRequireDefer(o))}_obj.addTo||"UI"==_obj._type||(_obj.addTo=_this.parent.element),_root&&applyValues(_root,_this.parent.element),create(_obj)},_=>{FragUIHelper.SVG_ALIAS=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]])}),Class(function XComponent(){const _this=this;var _state;_this.state||Object.defineProperty(_this,"state",{set:function(v){throw"Don't override state!"},get:function(){return _state||((_state=AppState.createLocal())._bind=_state.bind,_state.bind=function(key,callback){_this.bindState(_state,key,callback)},_state.fire=function(key,value){_state.set(key,value,!0)},AppState.set(_this.fragName+"/state",_state),_state)}}),_this.createState=_=>this.state,_this.createFragment=this.initClass,_this._bindOnDestroy(_=>{_state?.destroy?.(),AppState.clearKeysMatching(_this.fragName+"/")})},_=>{XComponent.inheritanceChain={};const _this=XComponent.inheritanceChain;_this.fragName="overwritten in descendent",_this.contexts="overwritten in descendent",_this.help=function(){console.groupCollapsed(`Fragment ${this.fragName} Overview`),console.log(`Your context(s) are: ${this.contexts}`),console.log("You have access to the following $ methods:");for(let key in this)"_"!=key.charAt(0)&&(key.includes(["flag","initClass","classes","events","parent","findParent","bindState"])||console.log("$"+key));console.groupEnd()},_this.set=function(key,value){void 0===value&&(value=Utils.uuid()),key.includes("/")||(key=this.fragName+"/"+key),AppState.set(key,value)},_this.unset=function(key){key.includes("/")||(key=this.fragName+"/"+key),AppState.map.delete(key)},_this.fn=function(key,callback){if(callback&&"function"!=typeof callback)throw"$fn requires callback to be a function";if(!callback)return this.get(key);this.set(key,callback)},_this.fire=function(key,value){void 0===value&&(value=Utils.uuid()),key.includes("/")||(key=this.fragName+"/"+key),AppState.set(key,value,!0)},_this.bind=_this.listen=function(keys,callback,ref){if("function"==typeof ref&&("string"==typeof callback||Array.isArray(callback))){let rref=keys;keys=callback,callback=ref,ref=rref}return ref?(ref.state&&ref.state.isAppState&&(ref=ref.state),ref.isAppState?this.bindState(ref,keys,callback):this.events.sub(ref,keys,callback)):"string"==typeof keys&&keys.startsWith("hydra_")?this.events.sub(keys,callback):(Array.isArray(keys)?keys=keys.map(key=>key.includes("/")?key:`${this.fragName}/${key}`):keys.includes("/")||(keys=`${this.fragName}/${keys}`),this.bindState(AppState,keys,callback))},_this.get=function(key,noPromise){let state=AppState;key.isAppState&&(state=key,key=noPromise,noPromise=arguments[2]),state!=AppState||key.includes("/")||(key=this.fragName+"/"+key);let value=state.get(key);if(void 0!==value||noPromise)return value;{let timer,promise=Promise.create();const cb=_=>{value=state.get(key),void 0!==value&&(clearTimeout(timer),promise.resolve(value),Render.stop(cb))};return Render.start(cb,24),Hydra.LOCAL&&(timer=this.delayedCall(_=>{console.warn(`$get ${key} has timed out after 5 seconds`)},5e3)),promise}},_this.getSync=function(a,b,c){return void 0===b?this.get(a,!0):this.get(a,b,!0)},_this.createUIL=function(){let input=InputUIL.create.apply(this,arguments),appState=AppState.createLocal();arguments[arguments.length-1]==UIL.cms&&(input.CMS=!0);let promise=Promise.create();return appState.ready=_=>promise,input.onUpdate=key=>{let val=input.get(key);isNaN(val)||(val=Number(val)),appState.set(key,val),promise&&defer(_=>{promise?.resolve(),promise=null})},[input,appState]},_this.requestData=Data.makeRequest,_this.fulfillDataRequest=Data.request,Hydra.ready(_=>{_this.h=window.$,_this.gl=window.$gl,_this.glText=window.$glText}),_this.waitLayers=async function(){this.parent.layout?.getAllLayers&&(this.layers=await this.parent.layout.getAllLayers()),this.parent?.getAllLayers&&(this.layers=await this.parent.getAllLayers())}}),Class(function DerivedState(){Inherit(this,Component);const _this=this;var _cb,_map={};function update(){let truthy=!0;for(let key in _map)_map[key]||(truthy=!1);_cb?.(truthy)}this.bind=function(callback){_cb=callback,update()},this.isTruthy=function(){let truthy=!0;for(let key in _map)_map[key]||(truthy=!1);return truthy},this.truthy=function(state,key,validator){function test(val){_map[key]=null!=validator?"function"==typeof validator?validator(val):validator&&!!val:!!val,update()}"string"==typeof state&&(validator=key,key=state,state=null),key.includes("/")||state||(key=_this.parent.fragName+"/"+key),_map[key]=!1,state=state||AppState,test(),_this.bindState(state,key,test)},this.eq=function(state,key,statement){function test(val){_map[key]=statement==val,update()}"string"==typeof state&&(statement=key,key=state,state=null),key.includes("/")||state||(key=_this.parent.fragName+"/"+key),_map[key]=!1,state=state||AppState,test(),_this.bindState(state,key,test)},this.neq=function(state,key,statement){function test(val){_map[key]=statement!=val,update()}"string"==typeof state&&(statement=key,key=state,state=null),key.includes("/")||state||(key=_this.parent.fragName+"/"+key),_map[key]=!1,state=state||AppState,_this.bindState(state,key,test),test()}}),Class(function LinkedList(){var prototype=LinkedList.prototype;this.length=0,this.first=null,this.last=null,this.current=null,this.prev=null,"function"==typeof Symbol?(this.prevKey=Symbol("prev"),this.nextKey=Symbol("next")):(this.prevKey="__prev",this.nextKey="__next"),void 0===prototype.push&&(prototype.push=function(obj){obj[this.nextKey]&&this.remove(obj),this.first?(obj[this.nextKey]=this.first,obj[this.prevKey]=this.last,this.last[this.nextKey]=obj,this.last=obj):(this.first=obj,this.last=obj,obj[this.prevKey]=obj,obj[this.nextKey]=obj),this.length++},prototype.remove=function(obj){obj&&obj[this.nextKey]&&(this.length<=1?this.empty():(obj==this.first?(this.first=obj[this.nextKey],this.last[this.nextKey]=this.first,this.first[this.prevKey]=this.last):obj==this.last?(this.last=obj[this.prevKey],this.last[this.nextKey]=this.first,this.first[this.prevKey]=this.last):(obj[this.prevKey][this.nextKey]=obj[this.nextKey],obj[this.nextKey][this.prevKey]=obj[this.prevKey]),this.length--),obj[this.prevKey]=null,obj[this.nextKey]=null)},prototype.empty=function(){this.first=null,this.last=null,this.current=null,this.prev=null,this.length=0},prototype.start=function(){return this.current=this.first,this.prev=this.current,this.current},prototype.next=function(){if(this.current&&(this.current=this.current[this.nextKey],1!=this.length&&this.prev[this.nextKey]!=this.first))return this.prev=this.current,this.current},prototype.destroy=function(){return Utils.nullObject(this),null})}),Class(function ObjectPool(_type,_number=10){var _pool=[];this.array=_pool,function(){if(_type)for(var i=0;i<_number;i++)_pool.push(new _type)}(),this.get=function(){return _pool.shift()||(_type?new _type:null)},this.empty=function(){_pool.length=0},this.put=function(obj){obj&&!_pool.includes(obj)&&_pool.push(obj)},this.insert=function(array){void 0===array.push&&(array=[array]);for(var i=0;i<array.length;i++)this.put(array[i])},this.length=function(){return _pool.length},this.randomize=function(){let array=_pool;for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]]}},this.destroy=function(){for(let i=_pool.length-1;i>=0;i--)_pool[i].destroy&&_pool[i].destroy();return _pool=null}}),Class(function Gate(){var _list=[],_map={};this.create=function(name){let promise=Promise.create();name?_map[name]=promise:_list.push(promise)},this.open=function(name){name&&(_map[name]||(_map[name]=Promise.create()),_map[name].resolve());let promise=_list.shift();promise&&promise.resolve()},this.wait=function(name){return _list.length||name?name?(_map[name]||(_map[name]=Promise.create()),_map[name]):_list[_list.length-1]||Promise.resolve():Promise.resolve()}},"static"),Class(function Assets(){const _this=this,_support={webp:!1,avif:!1};let _getPathHooks;function AssetList(arr){return arr.__proto__=AssetList.prototype,arr}function getPath(path){if(path.includes("~"))return _this.BASE_PATH+path.replace("~","");if(path.includes("//")||path.startsWith("data:")||path.startsWith("blob:"))return path;if(path=function parseResolution(path){if(!window.ASSETS||!ASSETS.RES)return path;var res=ASSETS.RES[path],ratio=Math.min(Device.pixelRatio,3);if(!res)return path;if(!res["x"+ratio])return path;var split=path.split("/"),file=split[split.length-1];return split=file.split("."),path.replace(file,split[0]+"-"+ratio+"x."+split[1])}(path),_this.replacementPaths)for(let pathKey in _this.replacementPaths)if(path.startsWith(pathKey))return path=path.replace(pathKey,_this.replacementPaths[pathKey]);if(_this.dictionary)for(let pathKey in _this.dictionary)if(_this.dictionary[pathKey].includes(path.split("?")[0]))return pathKey+path;return this.CDN&&!~path.indexOf(this.CDN)&&(path=this.CDN+path),path}this.__loaded=[],this.FLIPY=!0,this.CDN=window.HYDRA_ASSETS_CDN??"",this.CORS="anonymous",this.disableFallbackImage=!1,this.IMAGES={},this.VIDEOS={},this.AUDIOS={},this.SDF={},this.JSON={push:function(prop,value){this[prop]=value,Object.defineProperty(this,prop,{get:()=>JSON.parse(JSON.stringify(value))})}},Object.defineProperty(this.JSON,"push",{enumerable:!1,writable:!0}),this.SVG={},AssetList.prototype=new Array,AssetList.prototype.filter=function(items){for(let i=this.length-1;i>=0;i--)this[i].includes(items)||this.splice(i,1);return this},AssetList.prototype.exclude=function(items){for(let i=this.length-1;i>=0;i--)this[i].includes(items)&&this.splice(i,1);return this},AssetList.prototype.prepend=function(prefix){for(let i=this.length-1;i>=0;i--)this[i]=prefix+this[i];return this},AssetList.prototype.append=function(suffix){for(let i=this.length-1;i>=0;i--)this[i]=this[i]+suffix;return this},this.list=function(){return window.ASSETS||console.warn("ASSETS list not available"),new AssetList(window.ASSETS.slice(0)||[])},this.BASE_PATH=window.HYDRA_ASSETS_BASE_PATH||"",this.getPath=getPath,this.registerPathReplacement=function(path,replacedPath){_this.replacementPaths||(_this.replacementPaths={}),_this.replacementPaths[path]=replacedPath},this.registerPath=function(path,assets){_this.dictionary||(_this.dictionary={}),_this.dictionary[path]=assets},this.registerGetPathHook=function(hook){_getPathHooks||(_getPathHooks=new Set,_this.getPath=function(path){for(const hook of _getPathHooks){let result=hook(path,getPath);if(result)return result}return getPath(path)}),_getPathHooks.add(hook)},this.unregisterGetPathHook=function(hook){_getPathHooks&&(_getPathHooks.delete(hook),0===_getPathHooks.size&&(_getPathHooks=null,_this.getPath=getPath))},this.loadImage=function(path,isStore){const img=new Image;img.crossOrigin=this.CORS;let src=_this.getPath(path);this.disableFallbackImage&&path.includes("assets/images/_scenelayout/uv.jpg")&&(src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7");const promise=Promise.create(),onLoad=()=>promise.resolve(img),onError=e=>promise.reject(e);return img.addEventListener("load",onLoad,{once:!0}),img.addEventListener("error",onError,{once:!0}),promise.finally(()=>{img.removeEventListener("load",onLoad),img.removeEventListener("error",onError)}),img.src=src,img.promise=promise,img.loadPromise=()=>promise,isStore&&(this.IMAGES[path]=img),img},this.decodeImage=function(path,params,promise){promise||(promise=Promise.create());let img=_this.loadImage(path);return img.promise.then(()=>promise.resolve(img)).catch(()=>_this.decodeImage("assets/images/_scenelayout/uv.jpg",params,promise)),promise};const _supportsNextGen=function(){const testImages={webp:"data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",avif:"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="};function checkSupport(format){return new Promise(resolve=>{const img=new Image;img.onload=()=>resolve(!0),img.onerror=()=>resolve(!1),img.src=testImages[format]})}return Promise.all([checkSupport("webp").then(supported=>_support.webp=supported),checkSupport("avif").then(supported=>_support.avif=supported)])}();this.supportsWebP=function(){return _support.webp},this.supportsAvif=function(){return _support.avif},this.waitForSupportedImage=function(){return _supportsNextGen},this.perfImage=function(path,prefer="webp"){let result=path;if(path.includes([".jpg",".jpeg",".png"])){const basePath=path.substring(0,path.lastIndexOf("."));_support.avif&&"avif"===prefer?result=`${basePath}.avif`:_support.webp&&(result=`${basePath}.webp`)}return result}},"static"),Class(function AssetLoader(_assets,_callback,ASSETS=Assets){Inherit(this,Events);const _this=this;let _total=_assets.length,_loaded=0,_lastFiredPercent=0;function loadAsset(){let path=_assets.splice(_assets.length-1,1)[0];const name=path.split("assets/").last().split(".")[0],ext=path.split(".").last().split("?")[0].toLowerCase();let timeout=Timer.create(function timedOut(){console.warn("Asset timed out",path)},AssetLoader.TIMEOUT);if(!Assets.preventCache&&~Assets.__loaded.indexOf(path))return loaded();if(ext.includes(["jpg","jpeg","png","gif"])){let image=ASSETS.loadImage(path);return image.complete?loaded():(image.onload=loaded,void(image.onerror=loaded))}function loaded(){timeout&&clearTimeout(timeout),increment(),_assets.length&&loadAsset()}ext.includes(["mp4","webm"])?fetch(path).then(async response=>{let blob=await response.blob();Assets.VIDEOS[name]=URL.createObjectURL(blob),loaded()}).catch(e=>{console.warn(e),loaded()}):ext.includes(["mp3"])?fetch(path).then(async response=>{let blob=await response.blob();Assets.AUDIOS[name]=URL.createObjectURL(blob),loaded()}).catch(e=>{console.warn(e),loaded()}):"js"!==ext?get(Assets.getPath(path),Assets.HEADERS).then(data=>{Assets.__loaded.push(path),"json"==ext&&ASSETS.JSON.push(name,data),"svg"==ext&&(ASSETS.SVG[name]=data),"fnt"==ext&&(ASSETS.SDF[name.split("/")[1]]=data),ext.includes(["fs","vs","glsl"])&&window.Shaders&&Shaders.parse(data,path),loaded()}).catch(e=>{console.warn(e),loaded()}):function loadJsLib(path){const scriptSrc=Assets.getPath(path);let promise=AssetLoader.JS_LIBS_PROMISES.get(scriptSrc);if(promise)return promise;promise=Promise.create(),AssetLoader.JS_LIBS_PROMISES.set(scriptSrc,promise);const scr=document.createElement("script");return scr.onload=promise.resolve,scr.onerror=promise.reject,scr.src=scriptSrc,document.head.appendChild(scr),promise}(path).then(()=>{loaded()}).catch(e=>{console.warn(e),loaded()})}function increment(){let percent=Math.max(_lastFiredPercent,Math.min(1,++_loaded/_total));_this.events.fire(Events.PROGRESS,{percent:percent}),_lastFiredPercent=percent,_loaded>=_total&&defer(complete)}function complete(){_this.completed||(_this.completed=!0,defer(()=>{_callback&&_callback(),_this.events.fire(Events.COMPLETE)}))}!function(){if(!Array.isArray(_assets))throw"AssetLoader requires array of assets to load";_assets=_assets.slice(0).reverse(),function init(){if(!_assets.length)return complete();for(let i=0;i<AssetLoader.SPLIT;i++)_assets.length&&loadAsset()}()}(),this.loadModules=function(){if(!window._BUILT_)return;this.add(1);let module=window._ES5_?"es5-modules":"modules",src=window._CACHE_?"assets/js/"+module+"."+window._CACHE_+".js":"assets/js/"+module+".js";src=Assets.getPath(src);let s=document.createElement("link");return s.href=src,s.rel="preload",s.as="script",document.head.appendChild(s),s=document.createElement("script"),s.src=src,s.async=!0,document.head.appendChild(s),AssetLoader.waitForLib("_MODULES_").then(_=>_this.trigger(1))},this.add=function(num){_total+=num||1},this.trigger=function(num){for(let i=0;i<(num||1);i++)increment()}},()=>{AssetLoader.SPLIT=2,AssetLoader.TIMEOUT=5e3,AssetLoader.JS_LIBS_PROMISES=new Map,AssetLoader.loadAllAssets=function(callback){let promise=Promise.create();return callback||(callback=promise.resolve),promise.loader=new AssetLoader(Assets.list(),()=>{callback&&callback(),promise.loader&&promise.loader.destroy&&(promise.loader=promise.loader.destroy())}),promise},AssetLoader.loadAssets=function(list,callback){let promise=Promise.create();return callback||(callback=promise.resolve),promise.loader=new AssetLoader(list,()=>{callback&&callback(),promise.loader&&promise.loader.destroy&&(promise.loader=promise.loader.destroy())}),promise},AssetLoader.waitForLib=function(name,callback){let promise=Promise.create();return callback||(callback=promise.resolve),Render.start(function check(){window[name]&&(Render.stop(check),callback&&callback())}),promise},AssetLoader.waitForModules=function(){return AssetLoader.waitForLib(window._BUILT_?"_MODULES_":"zUtils3D")}}),Class(function LibLoader(){Inherit(this,Component);const modules={},sanitizeLibName=libName=>{if(!libName||"string"!=typeof libName)throw new Error("Library name must be a non-empty string");const sanitized=libName.trim();if(sanitized.includes("/")||sanitized.includes("\\")||sanitized.includes("..")||sanitized.startsWith("http")||sanitized.startsWith("//"))throw new Error("Library name cannot contain paths or URLs");return sanitized};this.import=async function(libName,autoLoadScript=!0){const prom=Promise.create();try{if(libName=sanitizeLibName(libName),!modules[libName]&&autoLoadScript)await this.preloadESM(libName);else if(!modules[libName]&&!autoLoadScript)throw new Error(`Lib ${libName} is not loaded. Please call preloadESM() with the lib name.`);if(!modules[libName])throw new Error(`Lib ${libName} is not loaded. Please use import() with the last parameter of true, or call preloadESM() with the lib name.`);prom.resolve(modules[libName])}catch(err){prom.reject(err)}return prom},this.preloadESM=async function(libName){let prefix=`assets/js/lib/${libName=sanitizeLibName(libName)}`,libPath=Assets.list().find(p=>p.startsWith(prefix)&&p.endsWith(".esm.js"));libPath=libPath?libPath.slice(14):`${libName}.esm.js`,prefix=window._BUILT_?"../js/lib/":"../lib/",libPath=Assets.getPath(`${prefix}${libPath}`);try{const module=await import(libPath);modules[libName]=module}catch(err){throw console.error(err),new Error(`LibLoader encountered an error while loading ${libName}. Please check the console for more details.`)}}},"static"),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).goober={})}(this,function(e){let t={data:""},n=e=>"undefined"!=typeof window?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||t,o=/(?:([A-Z0-9-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(})/gi,r=/\/\*[^]*?\*\/|\s\s+|\n/g,l=(e,t)=>{let n,o="",r="",a="";for(let s in e){let c=e[s];"object"==typeof c?(n=t?t.replace(/([^,])+/g,e=>s.replace(/([^,])+/g,t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)):s,r+="@"==s[0]?"f"==s[1]?l(c,s):s+"{"+l(c,"k"==s[1]?"":t)+"}":l(c,n)):"@"==s[0]&&"i"==s[1]?o=s+" "+c+";":(s=s.replace(/[A-Z]/g,"-$&").toLowerCase(),a+=l.p?l.p(s,c):s+":"+c+";")}return a[0]?(n=t?t+"{"+a+"}":a,o+n+r):o+r},a={},s=e=>{let t="";for(let n in e)t+=n+("object"==typeof e[n]?s(e[n]):e[n]);return t},c=(e,t,n,c,i)=>{let f="object"==typeof e?s(e):e,p=a[f]||(a[f]=(e=>{let t=0,n=11;for(;t<e.length;)n=101*n+e.charCodeAt(t++)>>>0;return"go"+n})(f));if(!a[p]){let t="object"==typeof e?e:(e=>{let t,n=[{}];for(;t=o.exec(e.replace(r,""));)t[4]&&n.shift(),t[3]?n.unshift(n[0][t[3]]=n[0][t[3]]||{}):t[4]||(n[0][t[1]]=t[2]);return n[0]})(e);a[p]=l(i?{["@keyframes "+p]:t}:t,n?"":"."+p)}return((e,t,n)=>{-1==t.data.indexOf(e)&&(t.data=n?e+t.data:t.data+e)})(a[p],t,c),p};function f(e){let t=this||{},o=e.call?e(t.p):e;return c(o.unshift?o.raw?((e,t,n)=>e.reduce((e,o,r)=>{let a=t[r];if(a&&a.call){let e=a(n),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;a=t?"."+t:e&&"object"==typeof e?e.props?"":l(e,""):e}return e+o+(null==a?"":a)},""))(o,[].slice.call(arguments,1),t.p):o.reduce((e,n)=>n?Object.assign(e,n.call?n(t.p):n):e,{}):o,n(t.target),t.g,t.o,t.k)}let p,d,u,g=f.bind({g:1}),b=f.bind({k:1});e.css=f,e.extractCss=e=>{let t=n(e),o=t.data;return t.data="",o},e.glob=g,e.keyframes=b,e.setup=function(e,t,n,o){l.p=t,p=e,d=n,u=o},e.styled=function(e,t){let n=this||{};return function(){let o=arguments;function r(l,a){let s=Object.assign({},l),c=s.className||r.className;n.p=Object.assign({theme:d&&d()},s),n.o=/ *go\d+/.test(c),s.className=f.apply(n,o)+(c?" "+c:""),t&&(s.ref=a);let i=s.as||e;return u&&i[0]&&u(s),p(i,s)}return t?t(r):r}}}),function(i,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((i=i||self).gooberPrefixer={})}(this,function(i){var n=new Map([["align-self","-ms-grid-row-align"],["color-adjust","-webkit-print-color-adjust"],["column-gap","grid-column-gap"],["gap","grid-gap"],["grid-template-columns","-ms-grid-columns"],["grid-template-rows","-ms-grid-rows"],["justify-self","-ms-grid-column-align"],["margin-inline-end","-webkit-margin-end"],["margin-inline-start","-webkit-margin-start"],["overflow-wrap","word-wrap"],["padding-inline-end","-webkit-padding-end"],["padding-inline-start","-webkit-padding-start"],["row-gap","grid-row-gap"],["scroll-margin-bottom","scroll-snap-margin-bottom"],["scroll-margin-left","scroll-snap-margin-left"],["scroll-margin-right","scroll-snap-margin-right"],["scroll-margin-top","scroll-snap-margin-top"],["scroll-margin","scroll-snap-margin"],["text-combine-upright","-ms-text-combine-horizontal"]]);i.prefix=function(i,r){let t="";const e=n.get(i);e&&(t+=`${e}:${r};`);const o=function(i){var n=/^(?:(text-(?:decoration$|e|or|si)|back(?:ground-cl|d|f)|box-d|(?:mask(?:$|-[ispro]|-cl)))|(tab-|column(?!-s)|text-align-l)|(ap)|(u|hy))/i.exec(i);return n?n[1]?1:n[2]?2:n[3]?3:5:0}(i);1&o&&(t+=`-webkit-${i}:${r};`),2&o&&(t+=`-moz-${i}:${r};`),4&o&&(t+=`-ms-${i}:${r};`);const a=function(i,n){var r=/^(?:(pos)|(background-i)|((?:max-|min-)?(?:block-s|inl|he|widt))|(dis))/i.exec(i);return r?r[1]?/^sti/i.test(n)?1:0:r[2]?/^image-/i.test(n)?1:0:r[3]?"-"===n[3]?2:0:/^(inline-)?grid$/i.test(n)?4:0:0}(i,r);return 1&a?t+=`${i}:-webkit-${r};`:2&a?t+=`${i}:-moz-${r};`:4&a&&(t+=`${i}:-ms-${r};`),t+=`${i}:${r};`,t}}),function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports,require("goober")):"function"==typeof define&&define.amd?define(["exports","goober"],o):o((e=e||self).gooberGlobal={},e.goober)}(this,function(e,o){let n=o.css.bind({g:1});e.createGlobalStyles=function(){const e=o.styled.call({g:1},"div").apply(null,arguments);return function(o){return e(o),null}},e.glob=n}),Hydra.ready(function(){let box;function updateSocialStage(){Mobile.isAllowNativeScroll||(document.body.parentElement.scrollTop=document.body.scrollTop=0),document.documentElement.style.width=document.body.style.width=`${Stage.width}px`,document.documentElement.style.height=document.body.style.height=`${Stage.height}px`}window.__window=$(window),window.__document=$(document),window.__body=$(document.getElementsByTagName("body")[0]),window.Stage=window.Stage&&window.Stage.style?$(window.Stage):__body.create("#Stage"),Object.defineProperties(Stage,{width:{get(){if(window.visualViewport)return Math.round(window.visualViewport.width*window.visualViewport.scale);let width;return box&&(width=box.getBoundingClientRect().width),width||window.innerWidth||document.body.clientWidth||document.documentElement.offsetWidth}},height:{get(){if(Stage.isNormalMobileScroll){let height=Stage.div.offsetHeight;if(height)return height}if(window.visualViewport)return Math.round(window.visualViewport.height*window.visualViewport.scale);let height;return box&&(height=box.getBoundingClientRect().height),height??(window.innerHeight||document.body.clientHeight||document.documentElement.offsetHeight)}}}),"social"!==Device.system.browser||"ios"!==Device.system.os||window.visualViewport||(box=document.createElement("div"),box.style.position="fixed",box.style.top=box.style.left=box.style.right=box.style.bottom="0px",box.style.zIndex="-1",box.style.opacity="0",box.style.pointerEvents="none",document.body.appendChild(box),Events.emitter._addEvent(Events.RESIZE,updateSocialStage,Stage)),"social"===Device.system.browser&&(Stage.height>=screen.height||Stage.width>=screen.width)&&setTimeout(updateSocialStage,1e3),window.HYDRA_MOBILE_SCROLL&&Device.mobile?(Stage.isNormalMobileScroll=!0,Stage.size("100%","100vh")):Stage.size("100%"),Stage.__useFragment=!0}),Class(function HydraCSS(){var _tag,_obj,_style,_needsUpdate,_this=this;function objToCSS(key){let pattern=/[A-Z]/,result="";for(;key;){let match=pattern.exec(key);if(!match){result+=key;break}result+=key.slice(0,match.index),result+="-",result+=key.charAt(match.index).toLowerCase(),key=key.slice(match.index+1)}return result}function setHTML(){_tag.innerHTML=_style,_needsUpdate=!1}Hydra.ready(function(){_obj={},_style="",(_tag=document.createElement("style")).type="text/css",document.getElementsByTagName("head")[0].appendChild(_tag)}),this._read=function(){return _style},this._write=function(css){_style=css,_needsUpdate||(_needsUpdate=!0,defer(setHTML))},this.style=function(selector,obj={}){_obj[selector]||(_obj[selector]={}),Object.assign(_obj[selector],obj),function render(){var s="";for(let selector in _obj){let obj=_obj[selector];for(var key in s+=`${selector} {`,obj){var prop=objToCSS(key),val=obj[key];"string"!=typeof val&&"opacity"!=key&&(val+="px"),s+=prop+":"+val+"!important;"}s+="}"}_this._write(s)}()},this.get=function(selector,prop){if(!_obj[selector])return prop?null:{};let obj=Object.assign({},_obj[selector]);return prop?obj[prop]:obj},this.textSize=function($obj){var $clone=$obj.clone();$clone.css({position:"relative",cssFloat:"left",styleFloat:"left",marginTop:-99999,width:"",height:""}),__body.addChild($clone);var width=$clone.div.offsetWidth,height=$clone.div.offsetHeight;return $clone.remove(),{width:width,height:height}},this.prefix=function(style,singlePropertyIfShorthand){if(style=style.charAt(0).toLowerCase()+style.slice(1),_this.styles.vendor){singlePropertyIfShorthand&&(singlePropertyIfShorthand=singlePropertyIfShorthand.charAt(0).toLowerCase()+singlePropertyIfShorthand.slice(1));let prefixed=_this.vendor+objToCSS(singlePropertyIfShorthand||style);try{let styles=window.getComputedStyle(document.documentElement,"");if(Array.prototype.indexOf.call(styles,prefixed)>=0)return _this.styles.vendor+style.capitalize()}catch(e){}}return style},this.prefixCSS=function(style,singlePropertyIfShorthand){if(_this.styles.vendor){let prefixed=_this.vendor+(singlePropertyIfShorthand||style);try{let styles=window.getComputedStyle(document.documentElement,"");if(Array.prototype.indexOf.call(styles,prefixed)>=0)return prefixed}catch(e){}}return style},this._toCSS=objToCSS},"Static"),Class(function HydraObject(_selector,_type,_exists,_useFragment){this._children=new LinkedList,this.__useFragment=_useFragment,this._initSelector(_selector,_type,_exists)},()=>{var prototype=HydraObject.prototype;const svgElements=["svg","path","rect","circle","filter","clippath","clipPath","ellipse","image","mask","polygon","g","animate","line","linearGradient","marker","mpath","polyline","set","stop","text","defs","use"],_mountedCallbacksProp="function"==typeof Symbol?Symbol("mountedCallbacks"):"_mountedCallbacks",_unmountedCallbacksProp="function"==typeof Symbol?Symbol("unmountedCallbacks"):"_unmountedCallbacks",_onceMountedCallbacksProp="function"==typeof Symbol?Symbol("onceMountedCallbacks"):"_onceMountedCallbacks",_resizeCallbacksProp="function"==typeof Symbol?Symbol("resizeCallbacks"):"_resizeCallbacks",_skipResizeCallbacksProp="function"==typeof Symbol?Symbol("skipResizeCallbacks"):"_skipResizeCallbacks",_inDOMProp="function"==typeof Symbol?Symbol("inDOM"):"_inDOM",_isObservingResizeProp="function"==typeof Symbol?Symbol("isObservingResize"):"_isObservingResize",_initialCallbackFiredProp="function"==typeof Symbol?Symbol("initialCallbackFired"):"_initialCallbackFired",_currentSizeProp="function"==typeof Symbol?Symbol("currentSize"):"_currentSize";let _observerBusy=!1;const _observer=new ResizeObserver(entries=>{_observerBusy=!0,entries.forEach(entry=>{const target=entry.target,hydraObject=target.hydraObject;if(!hydraObject)return void _observer.unobserve(target);hydraObject[_currentSizeProp]=entry;let resizeCallbacks=hydraObject[_resizeCallbacksProp],skipResizeCallbacks=hydraObject[_skipResizeCallbacksProp];if(resizeCallbacks)for(let i=0;i<resizeCallbacks.length;i++){let callback=resizeCallbacks[i];callback?skipResizeCallbacks?.has(callback)||callback(entry,hydraObject):(resizeCallbacks.splice(i,1),i-=0)}skipResizeCallbacks&&skipResizeCallbacks.clear(),hydraObject[_initialCallbackFiredProp]=!0,checkInDom(target,entry.contentRect||entry.contentBoxSize),resizeCallbacks?.length||hydraObject[_mountedCallbacksProp]?.length||hydraObject[_unmountedCallbacksProp]?.length||hydraObject[_onceMountedCallbacksProp]?.size||(_observer.unobserve(target),hydraObject[_inDOMProp]=null,hydraObject[_isObservingResizeProp]=!1,hydraObject[_initialCallbackFiredProp]=!1)}),_observerBusy=!1});function checkInDom(target,size=target.getBoundingClientRect()){const hydraObject=target.hydraObject;if(!hydraObject)return void _observer.unobserve(target);let mountedCallbacks=hydraObject[_mountedCallbacksProp],unmountedCallbacks=hydraObject[_unmountedCallbacksProp],onceMountedCallbacks=hydraObject[_onceMountedCallbacksProp],inDOM=!(!size.width&&!size.height);if(!inDOM){let parent=target.parentNode;for(;parent;){if(parent===document.documentElement){inDOM=!0;break}parent.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&defer(()=>checkInDom(target)),parent=parent.parentNode}}if(hydraObject[_inDOMProp]!==inDOM){hydraObject[_inDOMProp]=inDOM;let callbacks=inDOM?mountedCallbacks:unmountedCallbacks;if(callbacks)for(let i=0;i<callbacks.length;i++){const callback=callbacks[i];callback?callback(hydraObject):(callbacks.splice(i,1),i-=1)}inDOM&&onceMountedCallbacks&&(onceMountedCallbacks.forEach(callback=>{callback(hydraObject)}),onceMountedCallbacks.clear())}}function unsubResizeObserver(prop,callback){let callbacks=this[prop];if(!callbacks)return;let i=0;for(;i=callbacks.indexOf(callback,i),!(i<0);)_observerBusy?(callbacks[i]=null,i+=1):callbacks.splice(i,1);0===callbacks.length&&(this[prop]=null,this[_mountedCallbacksProp]?.length||this[_unmountedCallbacksProp]?.length||this[_resizeCallbacksProp]?.length||!this[_isObservingResizeProp]||(_observer.unobserve(this.div),this[_inDOMProp]=null,this[_isObservingResizeProp]=!1,this[_initialCallbackFiredProp]=!1))}function subResizeObserver(prop,callback,callInitial=!0){let callbacks=this[prop];if(callbacks||(callbacks=[],this[prop]=callbacks),!(callbacks.indexOf(callback)>=0)){if(callbacks.push(callback),!callInitial&&!this[_initialCallbackFiredProp]){let skipResizeCallbacks=this[_skipResizeCallbacksProp];skipResizeCallbacks||(skipResizeCallbacks=new Set,this[_skipResizeCallbacksProp]=skipResizeCallbacks),skipResizeCallbacks.add(callback)}return!!this[_isObservingResizeProp]||(_observer.observe(this.div),this[_isObservingResizeProp]=!0,!1)}}const _wrappedProp="function"==typeof Symbol?Symbol("wrapped"):"_wrapped";function makeSizeChangeCallback(callback,dimension,callInitial=!0){if(callback[_wrappedProp]?.[dimension])return callback[_wrappedProp][dimension];let currentValue,wrapped=function(entry){const value=(entry.contentRect||entry.contentBoxSize)[dimension];value!==currentValue&&(callInitial||void 0!==currentValue)&&callback(value),currentValue=value},callbacks=callback[_wrappedProp]||{};return callbacks[dimension]=wrapped,callback[_wrappedProp]=callbacks,wrapped}prototype._initSelector=function(_selector,_type,_exists){if(_selector&&"string"!=typeof _selector)this.div=_selector;else{var first=_selector?_selector.charAt(0):null,name=_selector?_selector.slice(1):null;if("."!=first&&"#"!=first&&(name=_selector,first="."),_exists){if("#"!=first)throw"Hydra Selectors Require #ID";this.div=document.getElementById(name)}else this._type=_type||"div",svgElements.includes(this._type)?(this.div=document.createElementNS("http://www.w3.org/2000/svg",this._type),"svg"===this._type&&this.div.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink")):this.div=document.createElement(this._type),first&&("#"===first?this.div.id=name:"unnamed"!==name&&("object"==typeof this.div.className&&"baseVal"in this.div.className?this.div.className.baseVal=name:this.div.className=name))}this.div.hydraObject=this},prototype.add=function(child,before=null){this.div;var _this=this,doInsertChild=function(childDiv){before&&(before.element&&before.element instanceof HydraObject?before=before.element.div:before.div?before=before.div:before.nodeName||(before=null)),before&&before.parentNode!==_this.div&&(before=null),_this.div.insertBefore(childDiv,before)},insertChild=function(childDiv){_this.__useFragment?(_this._fragment||(_this._fragment=document.createDocumentFragment(),defer(function(){if(!_this._fragment||!_this.div)return void delete _this._fragment;const hydraObjectsWithMountedHooks=Array.prototype.map.call(_this._fragment.childNodes,childDiv=>childDiv.hydraObject).filter($child=>$child?.onMountedHook);if(Array.prototype.every.call(_this._fragment.childNodes,childDiv=>!childDiv._fragmentBefore))_this.div.appendChild(_this._fragment);else for(;_this._fragment.childNodes.length;)childDiv=_this._fragment.childNodes[0],before=childDiv._fragmentBefore,delete childDiv._fragmentBefore,doInsertChild(childDiv);delete _this._fragment,defer(_=>{hydraObjectsWithMountedHooks.forEach($child=>{$child.onMountedHook&&($child.onMountedHook(),delete $child.onMountedHook)})})})),_this._fragment.appendChild(childDiv),childDiv._fragmentBefore=before):(doInsertChild(childDiv),childDiv.hydraObject?.onMountedHook&&defer(_=>{childDiv.hydraObject?.onMountedHook&&(childDiv.hydraObject.onMountedHook(),delete childDiv.hydraObject.onMountedHook)}))};return child.element&&child.element instanceof HydraObject?(insertChild(child.element.div),this._children.push(child.element),child.element._parent=this,child.element.div.parentNode=this.div):child.div?(insertChild(child.div),this._children.push(child),child._parent=this,child.div.parentNode=this.div):child.nodeName&&(insertChild(child),child.parentNode=this.div),this},prototype.clone=function(){return $(this.div.cloneNode(!0))},prototype.create=function(name,type){var $obj=$(name,type);return this.add($obj),$obj},prototype.empty=function(){for(var child=this._children.start();child;){var next=this._children.next();child&&child.remove&&child.remove(),child=next}return this.div.innerHTML="",this},prototype.parent=function(){return this._parent},prototype.children=function(isHydraChildren=!1){let children=this.div.children?this.div.children:this.div.childNodes;if(isHydraChildren){children=[];for(var child=this._children.start();child;)child&&(children.push(child),child=this._children.next())}return children},prototype.removeChild=function(object,keep){try{object.div.parentNode.removeChild(object.div)}catch(e){}keep||this._children.remove(object)},prototype.remove=function(param){param&&console.warn("HydraObject.remove removes ITSELF from its parent. use removeChild instead"),this._onDestroy&&this._onDestroy.forEach(cb=>cb()),this.removed=!0,this.clearInteract(),this.clearBind();var parent=this._parent;parent&&!parent.removed&&parent.removeChild&&parent.removeChild(this,!0);for(var child=this._children.start();child;){var next=this._children.next();child&&child.remove&&child.remove(),child=next}this._children.destroy(),this.div.hydraObject=null,Utils.nullObject(this)},prototype.destroy=function(){this[_inDOMProp]&&(this[_inDOMProp]=null),this[_isObservingResizeProp]&&(_observer.unobserve(this.div),this[_isObservingResizeProp]=!1),this[_mountedCallbacksProp]=null,this[_unmountedCallbacksProp]=null,this[_resizeCallbacksProp]=null,this[_initialCallbackFiredProp]=!1,this.remove()},prototype._bindOnDestroy=function(cb){this._onDestroy||(this._onDestroy=[]),this._onDestroy.push(cb)},prototype.onResize=function(callback,callInitial=!0){if(subResizeObserver.call(this,_resizeCallbacksProp,callback,callInitial)){if(!callInitial)return;let entry=this[_currentSizeProp];entry&&callback(entry,this)}},prototype.offResize=function(callback){unsubResizeObserver.call(this,_resizeCallbacksProp,callback)},prototype.onWidthChange=function(callback,callInitial=!0){this.onResize(makeSizeChangeCallback(callback,"width",callInitial))},prototype.offWidthChange=function(callback){let wrapped=callback[_wrappedProp]?.width;wrapped&&(this.offResize(wrapped),callback[_wrappedProp].width=null)},prototype.onHeightChange=function(callback,callInitial=!0){this.onResize(makeSizeChangeCallback(callback,"height",callInitial))},prototype.offHeightChange=function(callback){let wrapped=callback[_wrappedProp]?.height;wrapped&&(this.offResize(wrapped),callback[_wrappedProp].height=null)},prototype.onMount=function(callback){subResizeObserver.call(this,_mountedCallbacksProp,callback),this[_inDOMProp]&&callback(this)},prototype.offMount=function(callback){unsubResizeObserver.call(this,_mountedCallbacksProp,callback)},prototype.onFirstMount=function(callback){if(this[_inDOMProp])return void callback(this);let callbacks=this[_onceMountedCallbacksProp];callbacks||(callbacks=new Set,this[_onceMountedCallbacksProp]=callbacks),callbacks.add(callback),this[_isObservingResizeProp]||(_observer.observe(this.div),this[_isObservingResizeProp]=!0)},prototype.offFirstMount=function(callback){let callbacks=this[_onceMountedCallbacksProp];callbacks&&callbacks.delete(callback)},prototype.onUnmount=function(callback){subResizeObserver.call(this,_unmountedCallbacksProp,callback),this[_inDOMProp]||callback(this)},prototype.offUnmount=function(callback){unsubResizeObserver.call(this,_unmountedCallbacksProp,callback)},prototype.mounted=function(){let promise=Promise.create();return this.onFirstMount(promise.resolve),promise},Object.defineProperty(prototype,"inDOM",{get:function(){return this[_inDOMProp]}}),window.$=function(selector,type,exists){return selector&&"string"!=typeof selector&&selector.hydraObject?selector.hydraObject:new HydraObject(selector,type,exists)},$.fn=HydraObject.prototype}),function(){const cursorLockIdProp="function"==typeof Symbol?Symbol("cursorLockId"):"_cursorLockId";$.fn.text=function(text){return void 0!==text?(this.__cacheText!=text&&(this.div.textContent=text),this.__cacheText=text,this):this.div.textContent},$.fn.html=function(text,force){return"string"!=typeof text||text.includes("<")||force?void 0!==text?(this.div.innerHTML=text,this):this.div.innerHTML:this.text(text)},$.fn.hide=function(){return this.div.style.display="none",this},$.fn.show=function(){return this.div.style.display="",this},$.fn.visible=function(){return this.div.style.visibility="visible",this},$.fn.invisible=function(){return this.div.style.visibility="hidden",this},$.fn.setZ=function(z){return this.div.style.zIndex=z,this},$.fn.clearAlpha=function(){return this.div.style.opacity="",this},$.fn.size=function(w,h,noScale){return"string"==typeof w?(void 0===h?h="100%":"string"!=typeof h&&(h+="px"),this.div.style.width=w,this.div.style.height=h):(this.div.style.width=w+"px",this.div.style.height=h+"px",noScale||(this.div.style.backgroundSize=w+"px "+h+"px")),this.width=w,this.height=h,this},$.fn.mouseEnabled=function(bool){return this.div.style.pointerEvents=bool?"auto":"none",this},$.fn.fontStyle=function(family,size,color,style){var font={};return family&&(font.fontFamily=family),size&&(font.fontSize=size),color&&(font.color=color),style&&(font.fontStyle=style),this.css(font),this},$.fn.font=function(font){return this.css("font",font),this},$.fn.bg=function(src,x,y,repeat){return src?(src.includes(".")&&(src=Assets.getPath(src)),src.includes(".")?this.div.style.backgroundImage="url("+src+")":this.div.style.backgroundColor=src,void 0!==x&&(x="number"==typeof x?x+"px":x,y="number"==typeof y?y+"px":y,this.div.style.backgroundPosition=x+" "+y),repeat&&(this.div.style.backgroundSize="",this.div.style.backgroundRepeat=repeat),"cover"!=x&&"contain"!=x||(this.div.style.backgroundSize=x,this.div.style.backgroundPosition=void 0!==y?y+" "+repeat:"center"),this):this},$.fn.svgMask=function(src){return src?(src.includes(".")&&(src=Assets.getPath(src)),this.div.style.maskImage=`url(${src})`,this.div.style.webkitMaskImage=`url(${src})`,this):this},$.fn.center=function(x,y,noPos){var css={};return void 0===x?(css.left="50%",css.top="50%",css.marginLeft=-this.width/2,css.marginTop=-this.height/2):(x&&(css.left="50%",css.marginLeft=-this.width/2),y&&(css.top="50%",css.marginTop=-this.height/2)),noPos&&(delete css.left,delete css.top),this.css(css),this},$.fn.max=function(width,height){let w,h;return void 0!==width&&(w="number"==typeof width?width+"px":width,this.div.style.maxWidth=w),void 0!==height?(h="number"==typeof height?height+"px":height,this.div.style.maxHeight=h):(h=w,this.div.style.maxHeight=h),this},$.fn.min=function(width,height){let w,h;return void 0!==width&&(w="number"==typeof width?width+"px":width,this.div.style.minWidth=w),void 0!==height?(h="number"==typeof height?height+"px":height,this.div.style.minHeight=h):(h=w,this.div.style.minHeight=h),this},$.fn.flex=function(inline){return this.div.style.display=inline?"inline-flex":"flex",this.div.style.justifyContent="center",this.div.style.alignItems="center",this.div.classList.add("relative-children"),this},$.fn.order=function(opts={}){let s=this.div.style;return"none"===opts.flexWrap&&(opts.flexWrap="nowrap"),opts.direction&&(s.flexDirection=opts.direction),opts.wrap&&(s.flexWrap=opts.wrap),opts.order&&(s.order=opts.order),this},$.fn.align=function(opts={}){let s=this.div.style;function flex(str,contentMode=!1){return"start"===str?"flex-start":"end"===str?"flex-end":"between"===str?contentMode?"space-between":"flex-between":"around"===str?contentMode?"space-around":"flex-around":"none"===str?"nowrap":str}return opts.justify&&(s.justifyContent=flex(opts.justify)),opts.items&&(s.alignItems=flex(opts.items)),opts.self&&(s.alignSelf=flex(opts.self)),opts.content&&(s.alignContent=flex(opts.content,!0)),this},$.fn.flexibility=function(opts={}){let s=this.div.style;return"undefined"!==opts.grow&&(s.flexGrow=opts.grow),"undefined"!==opts.shrink&&(s.flexGrow=opts.shrink),void 0!==opts.basis&&(s.flexBasis="number"==typeof opts.basis?opts.basis+"px":opts.basis),this},$.fn.mask=function(arg){let maskPrefix="Moz"===HydraCSS.styles.vendor?"mask":HydraCSS.prefix("Mask");return this.div.style[maskPrefix]=(arg.includes(".")?"url("+arg+")":arg)+" no-repeat",this.div.style[maskPrefix+"Size"]="contain",this},$.fn.blendMode=function(mode,bg){return bg?this.div.style["background-blend-mode"]=mode:this.div.style["mix-blend-mode"]=mode,this};const DEFAULT_UNITS={animationDelay:"ms",animationDuration:"ms",transitionDelay:"ms",transitionDuration:"ms",perspectiveOriginX:"%",perspectiveOriginY:"%",transformOrigin:"%",transformOriginX:"%",transformOriginY:"%",transformOriginZ:"%",rotate:"deg",animationIterationCount:!1,aspectRatio:!1,borderImageSlice:!1,borderImageWidth:!1,columnCount:!1,counterIncrement:!1,counterReset:!1,flex:!1,flexGrow:!1,flexShrink:!1,fontSizeAdjust:!1,fontWeight:!1,lineHeight:!1,navIndex:!1,opacity:!1,order:!1,orphans:!1,tabSize:!1,widows:!1,zIndex:!1,scale:!1,strokeDasharray:!1,strokeDashoffset:!1,strokeWidth:!1};function clsxToVal(mix){var k,y,str="";if("string"==typeof mix||"number"==typeof mix)str+=mix;else if("object"==typeof mix)if(Array.isArray(mix)){var len=mix.length;for(k=0;k<len;k++)mix[k]&&(y=toVal(mix[k]))&&(str&&(str+=" "),str+=y)}else for(y in mix)mix[y]&&(str&&(str+=" "),str+=y);return str}$.fn.css=function(obj,value){if("boolean"==typeof value&&(value=null),"object"!=typeof obj){if(value)return this.div.style[obj]=value,this;var style=this.div.style[obj];if("number"!=typeof style){if(!style)return!1;style.includes("px")&&(style=Number(style.slice(0,-2))),"opacity"==obj&&(style=isNaN(Number(this.div.style.opacity))?1:Number(this.div.style.opacity))}return style||(style=0),style}TweenManager._clearCSSTween(this);for(let type in obj){let val=obj[type];if("string"==typeof val||"number"==typeof val){if("number"==typeof val){let unit=DEFAULT_UNITS[type];!1!==unit&&(val+=unit||"px")}"position"==type&&"sticky"==val&&"safari"==Device.system.browser&&(val="-webkit-sticky"),this.div.style[type]=val}}return this},$.fn.transform=function(props){if(Hydra.LOCAL&&props&&!this.__warningShown&&!props._mathTween&&(this.__lastTransform&&performance.now()-this.__lastTransform<20&&(this.__warningCount=++this.__warningCount||1,props.__warningCount2=++props.__warningCount2||1,this.__warningCount>10&&props.__warningCount2!==this.__warningCount&&(console.warn("Are you using .transform() in a loop? Avoid creating a new object {} every frame. Ex. assign .x = 1; and .transform();"),console.log(this),this.__warningShown=!0)),this.__lastTransform=performance.now()),TweenManager._clearCSSTween(this),Device.tween.css2d){if(props)for(var key in props)"number"!=typeof props[key]&&"string"!=typeof props[key]||(this[key]=props[key]);else props=this;var transformString=TweenManager._parseTransform(props);this.__transformCache!=transformString&&(this.div.style[HydraCSS.styles.vendorTransform]=transformString,this.__transformCache=transformString)}return this},$.fn.willChange=function(props){if("boolean"==typeof props)this._willChangeLock=!0===props;else if(this._willChangeLock)return;var string="string"==typeof props;this._willChange&&!string||"null"==typeof props?(this._willChange=!1,this.div.style["will-change"]=""):(this._willChange=!0,this.div.style["will-change"]=string?props:HydraCSS.transformProperty+", opacity")},$.fn.backfaceVisibility=function(visible){this.div.style[HydraCSS.prefix("BackfaceVisibility")]=visible?"visible":"hidden"},$.fn.enable3D=function(perspective,x,y){return Device.tween.css3d?(this.div.style[HydraCSS.prefix("TransformStyle")]="preserve-3d",perspective&&(this.div.style[HydraCSS.prefix("Perspective")]=perspective+"px"),void 0!==x&&(x="number"==typeof x?x+"px":x,y="number"==typeof y?y+"px":y,this.div.style[HydraCSS.prefix("PerspectiveOrigin")]=x+" "+y),this):this},$.fn.disable3D=function(){return this.div.style[HydraCSS.prefix("TransformStyle")]="",this.div.style[HydraCSS.prefix("Perspective")]="",this},$.fn.transformPoint=function(x,y,z){var origin="";return void 0!==x&&(origin+="number"==typeof x?x+"px ":x+" "),void 0!==y&&(origin+="number"==typeof y?y+"px ":y+" "),void 0!==z&&(origin+="number"==typeof z?z+"px":z),this.div.style[HydraCSS.prefix("TransformOrigin")]=origin,this},$.fn.tween=function(props,time,ease,delay,callback,manual){"boolean"==typeof delay?(manual=delay,delay=0,callback=null):"function"==typeof delay&&(callback=delay,delay=0),"boolean"==typeof callback&&(manual=callback,callback=null),delay||(delay=0);var usePromise=null;callback&&callback instanceof Promise&&(usePromise=callback,callback=callback.resolve);var tween=TweenManager._detectTween(this,props,time,ease,delay,callback,manual);return usePromise||tween},$.fn.clearTransform=function(){return"number"==typeof this.x&&(this.x=0),"number"==typeof this.y&&(this.y=0),"number"==typeof this.z&&(this.z=0),"number"==typeof this.scale&&(this.scale=1),"number"==typeof this.scaleX&&(this.scaleX=1),"number"==typeof this.scaleY&&(this.scaleY=1),"number"==typeof this.rotation&&(this.rotation=0),"number"==typeof this.rotationX&&(this.rotationX=0),"number"==typeof this.rotationY&&(this.rotationY=0),"number"==typeof this.rotationZ&&(this.rotationZ=0),"number"==typeof this.skewX&&(this.skewX=0),"number"==typeof this.skewY&&(this.skewY=0),this.div.style[HydraCSS.styles.vendorTransform]="",this.__transformCache="",this},$.fn.clearTween=function(){return this._cssTween&&this._cssTween.stop(),this._mathTween&&this._mathTween.stop(),this},$.fn.stopTween=function(){return console.warn(".stopTween deprecated. use .clearTween instead"),this.clearTween()},$.fn.keypress=function(callback){this.div.onkeypress=function(e){(e=e||window.event).code=e.keyCode?e.keyCode:e.charCode,callback&&callback(e)}},$.fn.keydown=function(callback){this.div.onkeydown=function(e){(e=e||window.event).code=e.keyCode,callback&&callback(e)}},$.fn.keyup=function(callback){this.div.onkeyup=function(e){(e=e||window.event).code=e.keyCode,callback&&callback(e)}},$.fn.attr=function(attr,value){return"string"!=typeof attr?this:void 0===value?this.div.getAttribute(attr):(!1===value||null===value?this.div.removeAttribute(attr):this.div.setAttribute(attr,value),this)},$.fn.val=function(value){return void 0===value?this.div.value:(this.div.value=value,this)},$.fn.change=$.fn.onChange=function(callback){var _this=this;this.div.onchange=this.div.onblur=function(){callback({object:_this,value:_this.div.value||""})}},$.fn.svgSymbol=function(id,width,height){var config=SVG.getSymbolConfig(id),svgHTML='<svg viewBox="0 0 '+config.width+" "+config.height+'" width="'+width+'" height="'+height+'"><use xlink:href="#'+config.id+'" x="0" y="0" /></svg>';this.html(svgHTML,!0)},$.fn.svg=async function(url){let promise=Promise.create();return fetch(Assets.getPath(url)).then(async res=>{let svgHTML=await res.text();this.html(svgHTML,!0),promise.resolve()}),promise},$.fn.overflowScroll=function(dir){var x=!!dir.x,y=!!dir.y,overflow={};return(!x&&!y||x&&y)&&(overflow.overflow="auto"),!x&&y&&(overflow.overflowY="auto",overflow.overflowX="hidden"),x&&!y&&(overflow.overflowX="auto",overflow.overflowY="hidden"),Device.mobile&&(overflow["-webkit-overflow-scrolling"]="touch",Mobile._addOverflowScroll(this)),this.css(overflow)},$.fn.removeOverflowScroll=function(){return this.css({overflow:"hidden",overflowX:"",overflowY:"","-webkit-overflow-scrolling":""}),Device.mobile&&Mobile._removeOverflowScroll(this),this},$.fn.accessible=function(type="label",tabIndex=-1){switch(tabIndex>-1&&this.attr("tabindex",tabIndex),type){case"label":this.attr("aria-label",this.div.textContent);break;case"hidden":this.attr("aria-hidden",!0)}return this},$.fn.tabIndex=function(tabIndex){return this.attr("tabindex",tabIndex),this},$.fn.createObserver=function(callback,{isViewport:isViewport=!1,...options}={}){isViewport&&(options.root=this.div);const observer=this._observer=new IntersectionObserver(array=>{array.forEach(entry=>{entry.object=entry.target.hydraObject}),callback(array)},options);return this._bindOnDestroy(()=>{observer.disconnect()}),this},$.fn.observe=function(obj=this){return this._observer?.observe(obj.div),this},$.fn.unobserve=function(obj=this){return this._observer?.unobserve(obj.div),this},$.fn.cursor=function(cursor,lock){if(!Device.mobile){if(lock){lock[cursorLockIdProp]||(lock[cursorLockIdProp]={});let id=lock[cursorLockIdProp];this.cursorLock||(this.cursorLock=new Map),"auto"==cursor?this.cursorLock.delete(id):this.cursorLock.set(id,cursor)}return this.cursorLock&&"auto"==cursor&&this.cursorLock.forEach(v=>{cursor=v}),this.css("cursor",cursor),this}},$.fn.classList=function(){return this.div.classList},$.fn.clsx=function(...args){for(var tmp,x,i=0,str="",len=args.length;i<len;i++)(tmp=args[i])&&(x=clsxToVal(tmp))&&(str&&(str+=" "),str+=x);return str.length&&this.div.classList.add(...str.split(/\s+/).filter(Boolean)),this},$.fn.goob=function(styles){let _styles;return _styles="string"==typeof styles?goober.css`${styles}`:goober.css(styles),this.goobClass=_styles,this.div.classList.add(_styles),this},$.fn.glob=function(styles){let key=styles.replace("\n","").slice(0,100);goober.globbed||(goober.globbed={}),goober.globbed[key]||(goober.glob(styles),goober.globbed[key]=1)},$.fn.href=function(str){return this.attr("href",str),this},$.fn.target=function(str){return this.attr("target",str),this},$.fn.ariaLabel=function(str){return this.attr("aria-label",str),this},$.fn.alt=function(str){return this.attr("alt",str),this},$.fn.src=function(str){return this.attr("src",str&&Assets.getPath(str)),this},$.fn.display=function(bool){bool?$this.show():$this.hide()},$.fn.type=function(str){return this.attr("type",str),this},$.fn.id=function(str){return this.attr("id",str),this},$.fn.htmlFor=function(str){return this.attr("for",str),this},$.fn.ariaLabelledBy=function(str){return this.attr("aria-labelledby",str),this},$.fn.checked=function(bool){return this.attr("checked",bool),this},$.fn.min=function(num){return this.attr("min",num),this},$.fn.max=function(num){return this.attr("max",num),this},$.fn.step=function(num){return this.attr("step",num),this},$.fn.value=function(any){return this.attr("value",any),this},$.fn.title=function(str){return this.attr("title",str),this},$.fn.minlength=function(num){return this.attr("minlength",num),this},$.fn.maxlength=function(num){return this.attr("maxlength",num),this},$.fn.rows=function(num){return this.attr("rows",num),this},$.fn.readonly=function(bool){return this.attr("readonly",bool),this}}(),function(){var windowsPointer=!!window.MSGesture,convertTouchEvent=function(e){var touchEvent={x:0,y:0};if(e.windowsPointer)return e;if(!e)return touchEvent;if(e.touches||e.changedTouches?e.touches.length?(touchEvent.x=e.touches[0].clientX,touchEvent.y=e.touches[0].clientY):(touchEvent.x=e.changedTouches[0].clientX,touchEvent.y=e.changedTouches[0].clientY):(touchEvent.x=e.clientX,touchEvent.y=e.clientY),Mobile.ScreenLock&&Mobile.ScreenLock.isActive&&Mobile.orientationSet&&Mobile.orientation!==Mobile.orientationSet){if(90==window.orientation||0===window.orientation){var x=touchEvent.y;touchEvent.y=touchEvent.x,touchEvent.x=Stage.width-x}if(-90==window.orientation||180===window.orientation){var y=touchEvent.x;touchEvent.x=touchEvent.y,touchEvent.y=Stage.height-y}}return touchEvent};function addSharedEventListener(_this,unique,evt,callback,fn,options){_this._events=_this._events||{};let key=`${unique}_${evt}`;_this._events[key]=_this._events[key]||{options:options,destroy:addTrackedEventListener(_this,evt,fn,options),callbacks:[]},_this._events[key].callbacks.push({callback:callback,target:_this.div})}function callSharedEventListenerCallbacks(_this,unique,evt,e){let{callbacks:callbacks}=_this._events[`${unique}_${evt}`];for(let i=0;i<callbacks.length;i++){let{callback:callback,target:target}=callbacks[i];callback&&(target==e.currentTarget&&callback(e))}}function addTrackedEventListener(_this,evt,callback,options){evt=function(evt){if(windowsPointer)switch(evt){case"touchstart":return"pointerdown";case"touchmove":return"MSGestureChange";case"touchend":return"pointerup"}return evt}(evt),_this._cleanups=_this._cleanups||new Set;let cleanup=()=>{_this.div.removeEventListener(evt,callback,options),_this._cleanups.delete(cleanup)};return _this._cleanups.add(cleanup),_this.div.addEventListener(evt,callback,options),cleanup}$.fn.click=function(callback){var _this=this;return addSharedEventListener(_this,"click","click",callback,function click(e){return!!_this.div&&(!Mouse._preventClicks&&(e.object="hit"==_this.div.className?_this.parent():_this,e.action="click",callSharedEventListenerCallbacks(_this,"click","click",e),void(Mouse.autoPreventClicks&&Mouse.preventClicks())))},!0),this.div.style.cursor="pointer",this},$.fn.hover=function(callback){var _time,_this=this,_over=!1;function hover(e){if(!_this.div)return!1;var time=performance.now(),original=e.toElement||e.relatedTarget;if(_time&&time-_time<5)return _time=time,!1;switch(_time=time,e.object="hit"==_this.div.className?_this.parent():_this,e.type){case"mouseout":case"mouseleave":e.action="out";break;default:e.action="over"}if(_over){if(Mouse._preventClicks)return!1;if("over"==e.action)return!1;if("out"==e.action&&isAChild(_this.div,original))return!1;_over=!1}else{if("out"==e.action)return!1;_over=!0}callSharedEventListenerCallbacks(_this,"hover","mouseover",e)}function isAChild(div,object){for(var len=div.children.length-1,i=len;i>-1;i--)if(object==div.children[i])return!0;for(i=len;i>-1;i--)if(isAChild(div.children[i],object))return!0}return addSharedEventListener(_this,"hover","mouseover",callback,hover,!0),addSharedEventListener(_this,"hover","mouseout",callback,hover,!0),this},$.fn.press=function(callback){var _this=this;function press(action,e){if(!_this.div)return!1;e.object="hit"==_this.div.className?_this.parent():_this,e.action=action,callback&&callback(e)}return this.bind("touchstart",e=>press("down",e),!0),this.bind("touchend",e=>press("up",e),!0),this},$.fn.bind=function(evt,callback){var _this=this;if(windowsPointer&&this==__window)return Stage.bind(evt,callback);"touchstart"==evt?Device.mobile||(Device.touchCapable?this.bind("mousedown",callback):evt="mousedown"):"touchmove"==evt?(Device.mobile||(Device.touchCapable?this.bind("mousemove",callback):evt="mousemove"),windowsPointer&&!this.div.msGesture&&(this.div.msGesture=new MSGesture,this.div.msGesture.target=this.div)):"touchend"==evt&&(Device.mobile||(Device.touchCapable?this.bind("mouseup",callback):evt="mouseup"));var target=this.div;return addSharedEventListener(_this,"bind",evt,callback,function touchEvent(e){windowsPointer&&target.msGesture&&"touchstart"==evt&&target.msGesture.addPointer(e.pointerId);var touch=convertTouchEvent(e);if(windowsPointer){var windowsEvt=e;(e={}).preventDefault=()=>windowsEvt.preventDefault(),e.stopPropagation=()=>windowsEvt.stopPropagation(),e.x=Number(windowsEvt.clientX),e.y=Number(windowsEvt.clientY),e.target=windowsEvt.target,e.currentTarget=windowsEvt.currentTarget,e.path=[];for(var node=e.target;node;)e.path.push(node),node=node.parentElement||null;e.windowsPointer=!0}else e.x=touch.x,e.y=touch.y;callSharedEventListenerCallbacks(_this,"bind",evt,e)},{capture:!0,passive:!1}),this},$.fn.unbind=function(evt,callback){return windowsPointer&&this==__window?Stage.unbind(evt,callback):("touchstart"==evt?Device.mobile||(Device.touchCapable?this.unbind("mousedown",callback):evt="mousedown"):"touchmove"==evt?Device.mobile||(Device.touchCapable?this.unbind("mousemove",callback):evt="mousemove"):"touchend"==evt&&(Device.mobile||(Device.touchCapable?this.unbind("mouseup",callback):evt="mouseup")),function removeSharedEventListener(_this,unique,evt,callback){if(!_this._events)return;let key=`${unique}_${evt}`,binding=_this._events[key];if(binding){let{callbacks:callbacks}=binding;for(let i=0;i<callbacks.length;i++)if(callbacks[i].callback===callback){callbacks.splice(i,1);break}callbacks.length||(binding.destroy(),_this._events[key]=null)}}(this,"bind",evt,callback),this)},$.fn.interact=function(overCallback,clickCallback,seoLink,seoText,zIndex,options){const position=getComputedStyle(this.div).position;if(position&&"static"!==position||this.css({position:"relative"}),!this.hit){"object"==typeof arguments[arguments.length-1]&&(options=arguments[arguments.length-1],[overCallback,clickCallback,seoLink,seoText,zIndex]=Array.prototype.slice.call(arguments,0,-1),options.overCallback&&(overCallback=options.overCallback),options.clickCallback&&(clickCallback=options.clickCallback),options.seoLink&&(seoLink=options.seoLink),options.seoText&&(seoText=options.seoText),options.zIndex&&(zIndex=options.zIndex)),options||(options={}),this.hit=$(".hit",seoLink?"a":void 0),this.hit.css({width:"100%",height:"100%",zIndex:zIndex||99999,top:0,left:0,position:"absolute"}),this.add(this.hit);var _this=this;seoLink&&(this.hit.attr("href","#"===seoLink||seoLink.includes("mailto:")?seoLink:Hydra.absolutePath(seoLink)),this.hit.text(seoText||this.div.textContent),this.hit.css({fontSize:0}),this.hit.accessible(),"function"==typeof overCallback&&(this.hit.div.onfocus=_=>overCallback({action:"over",object:this}),this.hit.div.onblur=_=>overCallback({action:"out",object:this})),this.hit.div.onclick=e=>{e.preventDefault(),e.object=_this,e.action="click",clicked(e)}),options.role&&(this.hit.attr("role",options.role),"button"===options.role&&(this.hit.div.onkeydown=e=>{switch(e.key){case" ":case"Spacebar":e.preventDefault(),e.stopPropagation(),e.object=_this,e.action="click",clicked(e)}}))}let time=Render.TIME;function clicked(e){const timeout=options.clickTimeout??250;clickCallback&&Render.TIME-time>timeout&&clickCallback(e),time=Render.TIME}Device.mobile?this.hit.touchClick(overCallback,clicked):this.hit.hover(overCallback).click(clicked)},$.fn.clearInteract=function(){this.hit&&(this.hit=this.hit.destroy())},$.fn.disableInteract=function(){this.hit&&this.hit.css({pointerEvents:"none"})},$.fn.enableInteract=function(){this.hit&&this.hit.css({pointerEvents:"auto"})},$.fn.clearBind=function(){this._cleanups&&(this._cleanups.forEach(cleanup=>cleanup()),this._cleanups=null,this._events=null)},$.fn.touchSwipe=function(callback,distance){if(!window.addEventListener)return this;var _startX,_startY,_removeTouchMove,_this=this,_distance=distance||75,_moving=!1,_move={};function touchMove(e){if(!_this.div)return!1;if(_moving){var touch=convertTouchEvent(e),dx=_startX-touch.x,dy=_startY-touch.y;_move.direction=null,_move.moving=null,_move.x=null,_move.y=null,_move.evt=e,Math.abs(dx)>=_distance?(touchEnd(),_move.direction=dx>0?"left":"right"):Math.abs(dy)>=_distance?(touchEnd(),_move.direction=dy>0?"up":"down"):(_move.moving=!0,_move.x=dx,_move.y=dy),callback&&callback(_move,e)}}function touchEnd(e){if(!_this.div)return!1;_startX=_startY=_moving=!1,_removeTouchMove&&(_removeTouchMove(),_removeTouchMove=null)}return Device.mobile&&(addTrackedEventListener(_this,"touchstart",function touchStart(e){var touch=convertTouchEvent(e);if(!_this.div)return!1;1==e.touches.length&&(_startX=touch.x,_startY=touch.y,_moving=!0,_removeTouchMove=addTrackedEventListener(_this,"touchmove",touchMove,{passive:!0}))},{passive:!0}),addTrackedEventListener(_this,"touchend",touchEnd,{passive:!0}),addTrackedEventListener(_this,"touchcancel",touchEnd,{passive:!0})),this},$.fn.touchClick=function(hover,click){if(!window.addEventListener)return this;var _time,_move,_this=this,_start={},_touch={};function setTouch(e){var touch=convertTouchEvent(e);e.touchX=touch.x,e.touchY=touch.y,_start.x=e.touchX,_start.y=e.touchY}return Device.mobile&&(addTrackedEventListener(_this,"touchstart",function touchStart(e){if(!_this.div)return!1;_time=performance.now(),e.action="over",e.object="hit"==_this.div.className?_this.parent():_this,setTouch(e),hover&&!_move&&hover(e)},{passive:!0}),addTrackedEventListener(_this,"touchend",function touchEnd(e){if(!_this.div)return!1;var time=performance.now();if(_touch=convertTouchEvent(e),_move=function findDistance(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return Math.sqrt(dx*dx+dy*dy)}(_start,_touch)>25,e.object="hit"==_this.div.className?_this.parent():_this,setTouch(e),_time&&time-_time<750){if(Mouse._preventClicks)return!1;click&&!_move&&(e.action="click",click&&!_move&&click(e),Mouse.autoPreventClicks&&Mouse.preventClicks())}hover&&(e.action="out",Mouse._preventFire||hover(e));_move=!1},{passive:!0})),this}}(),Class(function Element(type="div"){Inherit(this,Component);var name=Utils.getConstructorName(this);this.__element=!0,this.element=$("."+name,type),this.element.__useFragment=!0,this.destroy=function(){this.element&&this.element.remove&&(this.element=this.element.remove()),this._destroy&&this._destroy()}},_=>{let Element=Global.RESERVED_HYDRA_CLASSES.Element;Element.inheritanceChain={};const _this=Element.inheritanceChain;_this.querySelector=async function(selector){if(await defer(),Array.isArray(selector)){let values=[];return selector.forEach(s=>{values.push($(this.element.div.querySelector(s)))}),values}return $(this.element.div.querySelector(selector))},_this.querySelectorAll=async function(selector){await defer();let list=this.element.div.querySelectorAll(selector),values=[];for(let i=0;i<list.length;i++)values.push($(list[i]));return values}}),Hydra.ready(()=>{TweenManager.Transforms=["scale","scaleX","scaleY","x","y","z","rotation","rotationX","rotationY","rotationZ","skewX","skewY","perspective"],TweenManager.CubicEases=[{name:"easeOutCubic",curve:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"},{name:"easeOutQuad",curve:"cubic-bezier(0.250, 0.460, 0.450, 0.940)"},{name:"easeOutQuart",curve:"cubic-bezier(0.165, 0.840, 0.440, 1.000)"},{name:"easeOutQuint",curve:"cubic-bezier(0.230, 1.000, 0.320, 1.000)"},{name:"easeOutSine",curve:"cubic-bezier(0.390, 0.575, 0.565, 1.000)"},{name:"easeOutExpo",curve:"cubic-bezier(0.190, 1.000, 0.220, 1.000)"},{name:"easeOutCirc",curve:"cubic-bezier(0.075, 0.820, 0.165, 1.000)"},{name:"easeOutBack",curve:"cubic-bezier(0.175, 0.885, 0.320, 1.275)"},{name:"easeInCubic",curve:"cubic-bezier(0.550, 0.055, 0.675, 0.190)"},{name:"easeInQuad",curve:"cubic-bezier(0.550, 0.085, 0.680, 0.530)"},{name:"easeInQuart",curve:"cubic-bezier(0.895, 0.030, 0.685, 0.220)"},{name:"easeInQuint",curve:"cubic-bezier(0.755, 0.050, 0.855, 0.060)"},{name:"easeInSine",curve:"cubic-bezier(0.470, 0.000, 0.745, 0.715)"},{name:"easeInExpo",curve:"cubic-bezier(0.950, 0.050, 0.795, 0.035)"},{name:"easeInCirc",curve:"cubic-bezier(0.600, 0.040, 0.980, 0.335)"},{name:"easeInBack",curve:"cubic-bezier(0.600, -0.280, 0.735, 0.045)"},{name:"easeInOutCubic",curve:"cubic-bezier(0.645, 0.045, 0.355, 1.000)"},{name:"easeInOutQuad",curve:"cubic-bezier(0.455, 0.030, 0.515, 0.955)"},{name:"easeInOutQuart",curve:"cubic-bezier(0.770, 0.000, 0.175, 1.000)"},{name:"easeInOutQuint",curve:"cubic-bezier(0.860, 0.000, 0.070, 1.000)"},{name:"easeInOutSine",curve:"cubic-bezier(0.445, 0.050, 0.550, 0.950)"},{name:"easeInOutExpo",curve:"cubic-bezier(1.000, 0.000, 0.000, 1.000)"},{name:"easeInOutCirc",curve:"cubic-bezier(0.785, 0.135, 0.150, 0.860)"},{name:"easeInOutBack",curve:"cubic-bezier(0.680, -0.550, 0.265, 1.550)"},{name:"easeInOut",curve:"cubic-bezier(.42,0,.58,1)"},{name:"linear",curve:"linear"}],TweenManager.useCSSTrans=function(props,ease,object){return!(props.math||"string"==typeof ease&&ease.includes(["Elastic","Bounce"])||object.multiTween||TweenManager._inspectEase(ease).path||!Device.tween.transition)},TweenManager._detectTween=function(object,props,time,ease,delay,callback){return TweenManager.useCSSTrans(props,ease,object)?new CSSTransition(object,props,time,ease,delay,callback):new FrameTween(object,props,time,ease,delay,callback)},TweenManager._parseTransform=function(props){var unitRequiresCSSTween=["%","vw","vh","em"],transforms="",translate="";if(props.perspective>0&&(transforms+="perspective("+props.perspective+"px)"),void 0!==props.x||void 0!==props.y||void 0!==props.z){var x=props.x||0,y=props.y||0,z=props.z||0;translate+=x+("string"==typeof props.x&&props.x.includes(unitRequiresCSSTween)?"":"px")+", ",translate+=y+("string"==typeof props.y&&props.y.includes(unitRequiresCSSTween)?"":"px"),Device.tween.css3d?transforms+="translate3d("+(translate+=", "+z+"px")+")":transforms+="translate("+translate+")"}return void 0!==props.scale?transforms+="scale("+props.scale+")":(void 0!==props.scaleX&&(transforms+="scaleX("+props.scaleX+")"),void 0!==props.scaleY&&(transforms+="scaleY("+props.scaleY+")")),void 0!==props.rotation&&(transforms+="rotate("+props.rotation+"deg)"),void 0!==props.rotationX&&(transforms+="rotateX("+props.rotationX+"deg)"),void 0!==props.rotationY&&(transforms+="rotateY("+props.rotationY+"deg)"),void 0!==props.rotationZ&&(transforms+="rotateZ("+props.rotationZ+"deg)"),void 0!==props.skewX&&(transforms+="skewX("+props.skewX+"deg)"),void 0!==props.skewY&&(transforms+="skewY("+props.skewY+"deg)"),transforms},TweenManager._clearCSSTween=function(obj){obj&&!obj._cssTween&&obj.div._transition&&!obj.persistTween&&(obj.div.style[HydraCSS.styles.vendorTransition]="",obj.div._transition=!1,obj._cssTween=null)},TweenManager._isTransform=function(key){return TweenManager.Transforms.indexOf(key)>-1},TweenManager._getAllTransforms=function(object){for(var obj={},i=TweenManager.Transforms.length-1;i>-1;i--){var tf=TweenManager.Transforms[i],val=object[tf];0===val||"number"!=typeof val&&"string"!=typeof val||(obj[tf]=val)}return obj};const prefix=function(){let pre="",dom="";try{var styles=window.getComputedStyle(document.documentElement,"");return pre=(Array.prototype.slice.call(styles).join("").match(/-(moz|webkit|ms)-/)||""===styles.OLink&&["","o"])[1],dom="WebKit|Moz|MS|O".match(new RegExp("("+pre+")","i"))[1],{unprefixed:"ie"==Device.system.browser&&!Device.detect("msie 9"),dom:dom,lowercase:pre,css:"-"+pre+"-",js:("ie"==Device.system.browser?pre[0]:pre[0].toUpperCase())+pre.substr(1)}}catch(e){return{unprefixed:!0,dom:"",lowercase:"",css:"",js:""}}}();HydraCSS.vendor=prefix.css,HydraCSS.styles={},HydraCSS.styles.vendor=prefix.unprefixed?"":prefix.js,HydraCSS.styles.vendorTransition=HydraCSS.prefixCSS("transition","transition-property"),HydraCSS.styles.vendorTransform=HydraCSS.prefixCSS("transform"),HydraCSS.transformProperty=HydraCSS.prefixCSS("transform"),HydraCSS.tween={},HydraCSS.tween.complete=prefix.unprefixed?"transitionend":prefix.lowercase+"TransitionEnd"}),Class(function CSSTransition(_object,_props,_time,_ease,_delay,_callback){const _this=this;let _transformProps,_transitionProps,_clear=_props.clear;function killed(){return!_this||_this.kill||!_object||!_object.div}delete _props.clear,this.playing=!0,function(){if("number"!=typeof _time)throw"CSSTween Requires object, props, time, ease";!function initProperties(){var transform=TweenManager._getAllTransforms(_object),properties=[];for(var key in _props)TweenManager._isTransform(key)?(transform.use=!0,transform[key]=_props[key],delete _props[key]):properties.push(key);transform.use&&(properties.push(HydraCSS.transformProperty),delete transform.use);properties.forEach((prop,index)=>{prop.match(/[A-Z]/)&&(properties[index]=prop.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase())}),_transformProps=transform,_transitionProps=properties}(),async function initCSSTween(values){if(killed())return;_object._cssTween&&(_object._cssTween.kill=!0);_object._cssTween=_this,_object.div._transition=!0;var strings=function buildStrings(time,ease,delay){for(var props="",str="",len=_transitionProps.length,i=0;i<len;i++){var transitionProp=_transitionProps[i];props+=(props.length?", ":"")+transitionProp,str+=(str.length?", ":"")+transitionProp+" "+time+"ms "+TweenManager._getEase(ease)+" "+delay+"ms"}return{props:props,transition:str}}(_time,_ease,_delay);_object.willChange(strings.props);var time=values?values.time:_time,delay=values?values.delay:_delay,props=values?values.props:_props,transformProps=values?values.transform:_transformProps,singleFrame=1e3/Render.REFRESH_RATE;if(_this.time=_time,_this.delay=_delay,await Timer.delayedCall(3*singleFrame),killed())return;if(_object.div.style[HydraCSS.styles.vendorTransition]=strings.transition,_this.playing=!0,"safari"==Device.system.browser){if(Device.system.browserVersion<11&&await Timer.delayedCall(singleFrame),killed())return;_object.css(props),_object.transform(transformProps)}else _object.css(props),_object.transform(transformProps);Timer.create(function(){killed()||(!function clearCSSTween(props,transformProps){if(killed())return;if(_this.playing=!1,_object._cssTween=null,_object.willChange(null),_clear){const clear="string"==typeof _clear?_clear.split(",").map(key=>key.trim()):[...props,...Object.keys(transformProps)].filter(k=>"clear"!==k);clear.forEach(key=>_object.div.style.removeProperty(key)),_object.div.style.removeProperty("transition"),Object.keys(transformProps).forEach(key=>{clear.includes(key)&&delete _object[key]}),_object.transform()}_object=_props=null,Utils.nullObject(_this)}(_transitionProps,transformProps),_callback&&_callback(),_this.completePromise&&_this.completePromise.resolve())},time+delay)}()}(),this.stop=function(){this.playing&&(this.kill=!0,this.playing=!1,_object.div.style[HydraCSS.styles.vendorTransition]="",_object.div._transition=!1,_object.willChange(null),_object._cssTween=null,Utils.nullObject(this))},this.onComplete=function(callback){return _callback=callback,this},this.promise=function(){return _this.completePromise||(_this.completePromise=Promise.create()),_this.completePromise}}),Class(function FrameTween(_object,_props,_time,_ease,_delay,_callback,_manual){var _endValues,_transformEnd,_transformStart,_startValues,_isTransform,_isCSS,_transformProps,_cssTween,_transformTween,_start,_update,_this=this;function copy(obj){let newObj={};for(let key in obj)"number"==typeof obj[key]&&(newObj[key]=obj[key]);return newObj}function clear(){_object._cssTweens&&_object._cssTweens.remove(_this),_this.playing=!1,_object._cssTween=null,_object=_props=null}function update(){if(!function killed(){return _this.kill||!_object||!_object.div||!_object.css}()){if(_isCSS&&_object.css(_props),_isTransform)if(_object.multiTween){for(var key in _transformProps)"number"==typeof _transformProps[key]&&(_object[key]=_transformProps[key]);_object.transform()}else _object.transform(_transformProps);_start&&(_start(),_start=null),_update&&_update()}}function tweenComplete(){_this.playing&&(clear(),_callback&&_callback(),_this.completePromise&&_this.completePromise.resolve())}this.playing=!0,_this.object=_object,_this.props=_props,_this.time=_time,_this.ease=_ease,_this.delay=_delay,defer(function(){if(_this.overrideValues){let values=_this.overrideValues(_this,_object,_props,_time,_ease,_delay);values&&(_this.props=_props=values.props||_props,_this.time=_time=values.time||_time,_this.ease=_ease=values.ease||_ease,_this.delay=_delay=values.delay||_delay)}if("object"==typeof _ease&&(_ease="easeOutCubic"),_object&&_props){if(_this.object=_object,"number"!=typeof _time)throw"FrameTween Requires object, props, time, ease";!function initValues(){_props.math&&delete _props.math;Device.tween.transition&&_object.div&&_object.div._transition&&(_object.div.style[HydraCSS.styles.vendorTransition]="",_object.div._transition=!1);_this.time=_time,_this.delay=_delay,_endValues={},_transformEnd={},_transformStart={},_startValues={},_object.multiTween||(void 0===_props.x&&(_props.x=_object.x),void 0===_props.y&&(_props.y=_object.y),void 0===_props.z&&(_props.z=_object.z));for(var key in _props)if(key.includes(["damping","spring"]))_endValues[key]=_props[key],_transformEnd[key]=_props[key];else if(TweenManager._isTransform(key))_isTransform=!0,_transformStart[key]=_object[key]??("scale"==key?1:0),_transformEnd[key]=_props[key];else{_isCSS=!0;var v=_props[key];"string"==typeof v?_object.div.style[key]=v:"number"==typeof v&&(_startValues[key]=_object.css?Number(_object.css(key)):0,_endValues[key]=v)}}(),function startTween(){!_object._cssTween||_manual||_object.multiTween||(_object._cssTween.kill=!0);_this.time=_time,_this.delay=_delay,_object.multiTween&&(_object._cssTweens||(_object._cssTweens=[]),_object._cssTweens.push(_this));_object._cssTween=_this,_this.playing=!0,_props=copy(_startValues),_transformProps=copy(_transformStart),_isCSS&&(_cssTween=tween(_props,_endValues,_time,_ease,_delay,null,_manual).onUpdate(update).onComplete(tweenComplete));_isTransform&&(_transformTween=tween(_transformProps,_transformEnd,_time,_ease,_delay,null,_manual).onComplete(_isCSS?null:tweenComplete).onUpdate(_isCSS?null:update))}()}}),this.stop=function(){this.playing&&(_cssTween&&_cssTween.stop&&_cssTween.stop(),_transformTween&&_transformTween.stop&&_transformTween.stop(),clear())},this.interpolate=function(elapsed){_cssTween&&_cssTween.interpolate(elapsed),_transformTween&&_transformTween.interpolate(elapsed),update()},this.getValues=function(){return{start:_startValues,transformStart:_transformStart,end:_endValues,transformEnd:_transformEnd}},this.setEase=function(ease){_cssTween&&_cssTween.setEase(ease),_transformTween&&_transformTween.setEase(ease)},this.onStart=function(callback){return _start=callback,this},this.onUpdate=function(callback){return _update=callback,this},this.onComplete=function(callback){return _callback=callback,this},this.promise=function(){return _this.completePromise||(_this.completePromise=Promise.create()),_this.completePromise}}),Class(function Interaction(_object){Inherit(this,Events);const _this=this;var _touchId,_velocity=[],_moved=0,_time=performance.now();function Vec2(){this.x=0,this.y=0,this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}var _vec2Pool=new ObjectPool(Vec2,10);let _distance,_timeDown,_timeMove;function loop(){_moved++>10&&(_this.velocity.x=_this.velocity.y=0,_this.delta.x=_this.delta.y=0)}function down(e){if(!e.multiscreenSimulated){const hitCondition=!!_this.hitReturn&&("hit"==e.target.className&&e.target.hydraObject!=_object);if(_this.isTouching&&!_this.multiTouch&&null!==_touchId&&e.touches){for(let i=0;i<e.touches.length;++i)if(e.touches[i].identifier===_touchId)return;_touchId=null,_this.isTouching=!1}if(_this.isTouching&&!_this.multiTouch||hitCondition||Interaction.hitIsBound(e.target,_object))return}_this.isTouching=!0;let x=e.x,y=e.y;e.changedTouches&&!_touchId&&(x=e.changedTouches[0].clientX,y=e.changedTouches[0].clientY,_touchId=e.changedTouches[0].identifier),e.touches&&"number"==typeof e.touches[0].force&&(e.force=e.touches[0].force),e.x=_this.x=x,e.y=_this.y=y,_this.hold.x=_this.last.x=x,_this.hold.y=_this.last.y=y,_this.delta.x=_this.move.x=_this.velocity.x=0,_this.delta.y=_this.move.y=_this.velocity.y=0,_distance=0,_this.events.fire(Interaction.START,e,!0),_timeDown=_timeMove=Render.TIME}function move(e){if(!_this.isTouching&&!_this.unlocked)return;let now=performance.now();if(now-_time<16)return;_time=now;let x=e.x,y=e.y;if(e.touches)for(let i=0;i<e.touches.length;i++){let touch=e.touches[i];touch.identifier==_touchId&&(x=touch.clientX,y=touch.clientY)}_this.isTouching&&(_this.move.x=x-_this.hold.x,_this.move.y=y-_this.hold.y),e.touches&&"number"==typeof e.touches[0].force&&(e.force=e.touches[0].force),e.x=_this.x=x,e.y=_this.y=y,_this.delta.x=x-_this.last.x,_this.delta.y=y-_this.last.y,_this.last.x=x,_this.last.y=y,_moved=0,_distance+=_this.delta.length();let delta=Render.TIME-(_timeMove||Render.TIME);if(_timeMove=Render.TIME,delta>.01){let velocity=_vec2Pool.get();velocity.x=Math.abs(_this.delta.x)/delta,velocity.y=Math.abs(_this.delta.y)/delta,_velocity.push(velocity),_velocity.length>5&&_vec2Pool.put(_velocity.shift())}_this.velocity.x=_this.velocity.y=0;for(let i=0;i<_velocity.length;i++)_this.velocity.x+=_velocity[i].x,_this.velocity.y+=_velocity[i].y;_this.velocity.x/=_velocity.length,_this.velocity.y/=_velocity.length,_this.velocity.x=_this.velocity.x||0,_this.velocity.y=_this.velocity.y||0,_this.events.fire(Interaction.MOVE,e,!0),_this.isTouching&&_this.events.fire(Interaction.DRAG,e,!0)}function up(e){if(e&&e.changedTouches&&e.touches.length){let someTouchIdentified=!1;for(let i=0;i<e.changedTouches.length;i++)e.changedTouches[i].identifier===_touchId&&(someTouchIdentified=!0);if(!someTouchIdentified)return}if(!_this.isTouching&&!_this.unlocked)return;_this.isTouching=!1,_this.move.x=0,_this.move.y=0,Math.max(.001,Render.TIME-(_timeMove||Render.TIME))>=40&&(_this.delta.x=0,_this.delta.y=0),_distance<20&&Render.TIME-_timeDown<1e3&&!e.isLeaveEvent&&!e.multiscreenSimulated&&_this.events.fire(Interaction.CLICK,e,!0),_this.events.fire(Interaction.END,e,!0),_touchId=null,Device.mobile&&(_this.velocity.x=_this.velocity.y=0)}function leave(){_this.ignoreLeave||(_this.delta.x=0,_this.delta.y=0,up({isLeaveEvent:!0}))}this.x=0,this.y=0,this.hold=new Vec2,this.last=new Vec2,this.delta=new Vec2,this.move=new Vec2,this.velocity=new Vec2,this.hitReturn=!0,function(){if(!_object instanceof HydraObject)throw"Interaction.Input requires a HydraObject";!function addHandlers(){_object==Stage||_object==__window?Interaction.bind("touchstart",down):(_object.bind("touchstart",down),Interaction.bindObject(_object));Interaction.bind("touchmove",move),Interaction.bind("touchend",up),Interaction.bind("leave",leave)}(),Render.start(loop)}(),this.destroy=function(){Interaction.unbind("touchstart",down),Interaction.unbind("touchmove",move),Interaction.unbind("touchend",up),Interaction.unbind("leave",leave),Render.stop(loop),Interaction.unbindObject(_object),_object&&_object.unbind&&_object.unbind("touchstart",down)},this._manualMove=move,this._manualDown=down,this._manualUp=up},()=>{Namespace(Interaction),Interaction.CLICK="interaction_click",Interaction.START="interaction_start",Interaction.MOVE="interaction_move",Interaction.DRAG="interaction_drag",Interaction.END="interaction_end";const _objects=[],_events={touchstart:[],touchmove:[],touchend:[],leave:[]};function touchMove(e){_events.touchmove.forEach(c=>c(e))}function touchStart(e){_events.touchstart.forEach(c=>c(e))}function touchEnd(e){_events.touchend.forEach(c=>c(e))}function leave(e){e.leave=!0,_events.leave.forEach(c=>c(e))}Hydra.ready(async()=>{await defer(),__window.bind("touchstart",touchStart),__window.bind("touchmove",touchMove),__window.bind("touchend",touchEnd),__window.bind("touchcancel",touchEnd),__window.bind("contextmenu",touchEnd),__window.bind("mouseleave",leave),__window.bind("mouseout",leave)}),Interaction.bind=function(evt,callback){_events[evt].push(callback)},Interaction.unbind=function(evt,callback){_events[evt].remove(callback)},Interaction.bindObject=function(obj){_objects.push(obj)},Interaction.unbindObject=function(obj){_objects.remove(obj)},Interaction.hitIsBound=function(element,boundObj){let obj=element.hydraObject;if(!obj)return!1;for(;obj;){if(obj!=boundObj&&_objects.includes(obj))return!0;obj=obj._parent}return!1}}),Class(function Mouse(){Inherit(this,Events);const _this=this;this.x=0,this.y=0,this.normal={x:0,y:0},this.tilt={x:0,y:0},this.inverseNormal={x:0,y:0},this.resetOnRelease=!1;const _offset={x:0,y:0};function init(){_this.x=Stage.width/2,_this.y=Stage.height/2,defer(_=>{_this.resetOnRelease&&Device.mobile&&(_this.x=Stage.width/2,_this.y=Stage.height/2)}),_this.input=new Interaction(__window),_this.input.unlocked=!0,_this.events.sub(_this.input,Interaction.START,start),_this.events.sub(_this.input,Interaction.MOVE,update),_this.events.sub(_this.input,Interaction.END,end),_this.hold=_this.input.hold,_this.last=_this.input.last,_this.delta=_this.input.delta,_this.move=_this.input.move,_this.velocity=_this.input.velocity,defer(()=>{_this.events.sub(Events.RESIZE,resize),resize()})}function start(e){_this.down=!0,update(e)}function update(e){_this.force&&(e=_this.force),_this.x=e.x,_this.y=e.y,Stage.width&&Stage.height&&(_this.normal.x=e.x/Stage.width-_offset.x,_this.normal.y=e.y/Stage.height-_offset.y,_this.tilt.x=2*_this.normal.x-1,_this.tilt.y=1-2*_this.normal.y,_this.inverseNormal.x=_this.normal.x,_this.inverseNormal.y=1-_this.normal.y)}function end(e){_this.down=!1,Device.mobile&&_this.resetOnRelease&&update({x:Stage.width/2,y:Stage.height/2})}function resize(){Stage.css("top")&&(_offset.y=Stage.css("top")/Stage.height),Stage.css("left")&&(_offset.x=Stage.css("left")/Stage.width)}Hydra.ready(init),_this.update=update},"Static"),Class(function Keyboard(){Inherit(this,Component);var _this=this;function addListeners(){__window.keydown(keydown),__window.keyup(keyup),__window.keypress(keypress),window.addEventListener("focus",onFocus)}function keydown(e){_this.pressing.includes(e.key)||_this.pressing.push(e.key),_this.events.fire(_this.DOWN,e),2==_this.pressing.length&&_this.pressing.includes("Meta")&&_this.pressing.includes("Shift")&&(_this.pressing.length=0)}function keyup(e){_this.pressing.remove(e.key),_this.events.fire(_this.UP,e)}function keypress(e){_this.events.fire(_this.PRESS,e)}function onFocus(){_this.pressing.length=0}this.pressing=[],_this.DOWN="keyboard_down",_this.PRESS="keyboard_press",_this.UP="keyboard_up",Hydra.ready(addListeners)},"static"),Class(function Mobile(){Inherit(this,Component),Namespace(this);const _this=this;var $html,$featureDetects,_is100vh=!1;function preventNativeScroll(e){if(_this.isAllowNativeScroll)return;let target=e.target;if(target.closest("label, input, textarea, select, a, button, [contenteditable]"))return;let prevent=target.hydraObject;for(;target.parentNode&&prevent;)target._scrollParent&&(prevent=!1),target=target.parentNode;prevent&&e.preventDefault()}function resize(){updateOrientation(),checkResizeRefresh(),updateMobileFullscreen(),_this.isAllowNativeScroll||(document.body.scrollTop=0)}function updateOrientation(){_this.orientation=Stage.width>Stage.height?"landscape":"portrait",_this.orientationSet&&(window.Fullscreen?.isOpen||Device.mobile?.pwa)&&window.screen&&window.screen.orientation&&window.screen.orientation.lock(_this.orientationSet)}Hydra.ready(()=>{if(Device.mobile){if(Stage.isNormalMobileScroll&&(_this.isAllowNativeScroll=!0,_this.isPreventResizeReload=!1),(Hydra.LOCAL||location.hostname.includes(["atdev","xr.activetheory.app"])||Utils.query("eruda"))&&async function setupMobileConsole(){try{var script=document.createElement("script");script.src="https://cdn.jsdelivr.net/npm/eruda",document.body.append(script),script.onload=function(){eruda.init(),console.log("Eruda console successfully initialized")}}catch(error){console.error("Error initializing Eruda:",error)}}(),function initFeatureDetects(){$featureDetects=__body.create("feature-detects")}(),function addHandlers(){_this.events.sub(Events.RESIZE,resize),Device.mobile.native||Stage.isNormalMobileScroll||window.addEventListener("touchstart",preventNativeScroll,{passive:!1})}(),Device.mobile?.phone&&!Device.mobile.native&&!Stage.isNormalMobileScroll){$html=$(document.documentElement);let ios="safari"===Device.system.browser;ios?$html.div.classList.add("ios"):$html.div.classList.add("mob"),_is100vh=!0,ios&&(__body.css({height:"100%"}).div.scrollTop=0),updateMobileFullscreen()}Device.mobile.native&&Stage.css({width:"100vw",height:"100vh"})}});const checkResizeRefresh=function(){let _lastWidth;return function(){_this.isPreventResizeReload||_lastWidth!=Stage.width&&(_lastWidth=Stage.width,("ios"===Device.system.os||"android"==Device.system.os&&Device.system.version>=7)&&(!Device.mobile.tablet||Math.max(Stage.width,Stage.height)>800||window.location.reload()))}}();function updateMobileFullscreen(){if(!Stage.isNormalMobileScroll&&$html){let vh100=$featureDetects.div.offsetHeight;$html.div.offsetHeight!==Stage.height?Stage.height===vh100?($html.css({height:""}),Stage.css({height:"100%"}),_is100vh=!0):($html.css({height:Stage.height}),Stage.css({height:Stage.height}),_is100vh=!1):_is100vh||Stage.height!==vh100||($html.css({height:""}),Stage.css({height:"100%"}),_is100vh=!0)}}this.vibrate=function(duration){navigator.vibrate&&navigator.vibrate(duration)},this.fullscreen=function(){if(Device.mobile&&!Device.mobile.native&&!Device.mobile.pwa&&!Dev.emulator){if(!window.Fullscreen)throw"Mobile.fullscreen requires Fullscreen module";"android"!==Device.system.os||Device.detect("oculus")||(__window.bind("touchend",()=>{Fullscreen.open()}),_this.ScreenLock&&_this.ScreenLock.isActive&&Events._fireResize())}},this.setOrientation=function(orientation,isForce){if(_this.System&&_this.NativeCore.active)return _this.System.orientation=_this.System[orientation.toUpperCase()];if(_this.orientationSet=orientation,updateOrientation(),isForce){if(!_this.ScreenLock)throw"Mobile.setOrientation isForce argument requires ScreenLock module";"any"===orientation?_this.ScreenLock.unlock():_this.ScreenLock.lock()}},this.isKeyboardOpen=function(){return Device.mobile&&document.activeElement?.tagName?.toLowerCase()?.includes?.(["textarea","input"])},this.allowNativeScroll=function(enabled=!0){_this.isAllowNativeScroll=enabled;let action=enabled?"unset":"";[$(document.documentElement),__body,Stage].forEach($el=>$el.css({touchAction:action,MSContentZooming:action,MSTouchAction:action}))},this.preventResizeReload=function(){_this.isPreventResizeReload=!0},this._addOverflowScroll=function($obj){$obj.div._scrollParent=!0,Device.mobile.native||($obj.div._preventEvent=function(e){e.stopPropagation()},$obj.bind("touchmove",$obj.div._preventEvent))},this._removeOverflowScroll=function($obj){$obj.unbind("touchmove",$obj.div._preventEvent)},this.get("phone",()=>{throw"Mobile.phone is removed. Use Device.mobile.phone"}),this.get("tablet",()=>{throw"Mobile.tablet is removed. Use Device.mobile.tablet"}),this.get("os",()=>{throw"Mobile.os is removed. Use Device.system.os"}),function(){var _props=["--safe-area-inset-top","--safe-area-inset-right","--safe-area-inset-bottom","--safe-area-inset-left"];function getSafeAreaInset(index){if(!$featureDetects)return 0;let style=getComputedStyle($featureDetects.div);return parseInt(style.getPropertyValue(_props[index]))||0}_this.getSafeAreaInsets=()=>_props.map((_,i)=>getSafeAreaInset(i)),_this.getSafeAreaInsetTop=()=>getSafeAreaInset(0),_this.getSafeAreaInsetRight=()=>getSafeAreaInset(1),_this.getSafeAreaInsetBottom=()=>getSafeAreaInset(2),_this.getSafeAreaInsetLeft=()=>getSafeAreaInset(3),Object.defineProperties(_this,{safeAreaInsets:{get:()=>_props.map((_,i)=>getSafeAreaInset(i))},safeAreaInsetTop:{get:()=>getSafeAreaInset(0)},safeAreaInsetRight:{get:()=>getSafeAreaInset(1)},safeAreaInsetBottom:{get:()=>getSafeAreaInset(2)},safeAreaInsetLeft:{get:()=>getSafeAreaInset(3)},vh100:{get:()=>$featureDetects?$featureDetects.div.offsetHeight:0}})}()},"Static"),Class(function PushState(_isHash){Inherit(this,Component);const _this=this;let _store,_useInternal,_root="";function getState(){return _useInternal?new String(_store):_isHash?String(window.location.hash.slice(3)):("/"!==_root&&""!==_root?location.pathname.split(_root)[1]:location.pathname.slice(1))||""}function handleStateChange(state,forced){if(state===_store&&!forced)return;if(_this.flag("isInitializingUseInternal"))return;if(_this.isLocked&&!forced){if(!_store)return;return void(_useInternal||(_isHash?window.location.hash="!/"+_store:window.history.pushState(null,null,Utils.addQueryToPath(_root+_store))))}let prevValue=_store;_store=state,_this.events.fire(Events.UPDATE,{prevValue:prevValue,value:state,split:state.split("/")}),_this.onStateUpdate?.({prevValue:prevValue,value:state,split:state.split("/")})}"boolean"!=typeof _isHash&&(_isHash=Hydra.LOCAL||!Device.system.pushstate),this.isLocked=!1,_this.flag("isNotBlocked",!0),function addHandlers(){const handler=()=>handleStateChange(getState());_isHash?window.addEventListener("hashchange",handler,!1):window.addEventListener("popstate",handler,!1),_this._bindOnDestroy(()=>{_isHash?window.removeEventListener("hashchange",handler,!1):window.removeEventListener("popstate",handler,!1)})}(),_store=getState(),_this.flag("isInitializing",!0),deferNextTick(()=>{_this.flag("isInitializing",!1)}),this.getState=this._getState=function(){return Device.mobile.native?Storage.get("app_state")||"":getState()},this.setRoot=function(root){_root="/"===root.charAt(0)?root:"/"+root},this.setState=this._setState=async function(state,forced){if("/"==state.charAt(0)&&(state=state.slice(1)),_this.events.fire(PushState.SET_STATE),await _this.wait("isNotBlocked"),Device.mobile.native&&Storage.set("app_state",state),state!==_store||forced)return _useInternal?_store=state:_isHash?window.location.hash="!/"+state:window.history.pushState(null,null,Utils.addQueryToPath(_root+state)),_this.fireChangeWhenSet&&handleStateChange(getState(),forced),_store=state,!0},this.enableBlocker=function(){_this.flag("isNotBlocked",!1)},this.disableBlocker=function(){_this.flag("isNotBlocked",!0)},this.replaceState=function(state){state!==_store&&(_useInternal?_store=state:_isHash?window.location.hash="!/"+state:window.history.replaceState(null,null,Utils.addQueryToPath(_root+state)),_this.fireChangeWhenSet?handleStateChange(getState(),!0):_store=state)},this.setTitle=function(title){document.title=title},this.lock=function(){this.isLocked=!0,_this.events.fire(PushState.LOCK)},this.unlock=function(){this.isLocked=!1,_this.events.fire(PushState.UNLOCK)},this.useHash=function(){_isHash=!0},this.useInternal=function(){_this.flag("isInitializing")&&""!==_store&&(_this.flag("isInitializingUseInternal",!0),_this.replaceState(""),deferNextTick(()=>{_this.flag("isInitializingUseInternal",!1)})),_useInternal=!0}},_=>{PushState.SET_STATE="push_state_set_state",PushState.LOCK="push_state_lock",PushState.UNLOCK="push_state_unlock"}),Class(function Router(_isHash,_rootPath){Inherit(this,PushState,_isHash);const _this=this;var _debounce,_prevView,_nextView,_404Route,_prevRoute,_callbacks=[],_routesFlattened=[];function matchRoute(path){let params,matchedRoute;for(let i=0;i<2&&(matchedRoute=_routesFlattened.find(route=>{const result=route.matcher.exec({pathname:`/${path}`});return!(!result||!result.pathname)&&(params=result.pathname.groups,!0)}),!matchedRoute)&&path.endsWith("/");++i)path=path.slice(0,-1);return!!matchedRoute&&{...matchedRoute.route,params:params,matchedPath:path}}function handleState(e){let value=e?.value,isInit=!1;if(value||(isInit=!0,value=_this.getState()),_this.virtualRoutes)return AppState.set("Router/state",String(value),isInit&&!value);let route=null,cb=null;if(_this.lock(),_callbacks.forEach(callback=>{route||(route=matchRoute(value),cb=callback)}),route&&(value=route.matchedPath),route&&route.redirect){let redirectedRoute=matchRoute(route.redirect);if(redirectedRoute){if(route.updateURL)return _this.unlock(),void _this.setState(route.redirect);route=redirectedRoute,value=redirectedRoute.matchedPath}}route||(value="404",route=_404Route),AppState.set("Router/state",String(value)),AppState.set("Router/route",route),async function doRoute(route,path,callback){if(_nextView=route?.view,"$"==_nextView?.charAt?.(0)){let ref=_nextView.slice(1);if(_this[ref])_nextView=_this[ref];else for(let key in _this.classes){let obj=_this.classes[key];obj.ref==ref&&obj.force(),_nextView=_this[ref]}_nextView&&(_nextView.visible=!0)}await(callback?.(_prevView,_nextView,path,route.params,route)),await(_nextView?.onRouteChange?.({params:route.params,path:path,name:route.name,children:route.children,meta:route.meta})),_prevView=_nextView,AppState.set("Router/previous",_prevRoute?.path),AppState.set("Router/previousRoute",_prevRoute),_this.currentRoute={...route},_this.unlock(),_prevRoute=route}(route,value,cb)}function handleInstanceReloaded({oldInstance:oldInstance,newInstance:newInstance}){_prevView===oldInstance&&(_prevView=newInstance),_routesFlattened.forEach(({route:route})=>{route.view===oldInstance&&(route.view=newInstance)});let route=AppState.get("Router/route");route?.view===oldInstance&&(route.view=newInstance)}function addChildrenRoutes(element,parentPath){element.children&&element.children.length&&element.children.forEach(child=>{const path=`${parentPath}/${child.path}`;_routesFlattened.push({path:`${parentPath}/${child.path}`,route:child,matcher:new URLPattern({pathname:path})}),addChildrenRoutes(child,path)})}_this.currentRoute=null,_this.fireChangeWhenSet=!0,function setRootPath(val){let rootPath;rootPath="string"==typeof _rootPath?_rootPath:Hydra.LOCAL?"":"/",_this.setRoot(rootPath)}(),function initEvents(){_this.events.sub(_this,Events.UPDATE,handleState),_this.events.sub(Component.HMR_INSTANCE_RELOADED,handleInstanceReloaded)}(),this._initFragRoutes=function(array){array.forEach(obj=>{obj.view&&(obj.view=_this[obj.view.slice(1)]),obj.lazyView&&(obj.view=obj.lazyView)}),this.registerRoutes(_this.onRouteChange,array)},this.registerRoutes=function(callback,list){if(list.forEach(element=>{if(element.path.startsWith("/"))throw new Error("router paths should not start with /");if(element.redirect&&element.redirect.startsWith("/"))throw new Error("redirect paths must not start with /");const path=`/${element.path}`;_routesFlattened.push({path:path,route:element,matcher:new URLPattern({pathname:path})}),addChildrenRoutes(element,path),"404"===element.path&&(_404Route=element)}),!_404Route)throw new Error('Error: no 404 route defined.  Please define a route whos path is "404" ');_callbacks.push(callback),clearTimeout(_debounce),_debounce=_this.delayedCall(handleState,1)},this.navigate=function(path){_this.isLocked||(path.startsWith("/")&&(path=path.substring(1)),Utils.debounce(()=>{_this.setState(path)},10))},this.replace=function(path){path.startsWith("/")&&(path=path.substring(1)),Utils.debounce(()=>{_this.replaceState(path)},10)}}),(()=>{"use strict";var t=/[$_\p{ID_Start}]/u,e=/[$_\u200C\u200D\p{ID_Continue}]/u;function n(t,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(t)}function s(s,r=!1){const i=[];let a=0;for(;a<s.length;){const o=s[a],h=function(t){if(!r)throw new TypeError(t);i.push({type:"INVALID_CHAR",index:a,value:s[a++]})};if("*"!==o)if("+"!==o&&"?"!==o)if("\\"!==o)if("{"!==o)if("}"!==o)if(":"!==o)if("("!==o)i.push({type:"CHAR",index:a,value:s[a++]});else{let t=1,e="",r=a+1,o=!1;if("?"===s[r]){h(`Pattern cannot start with "?" at ${r}`);continue}for(;r<s.length;){if(!n(s[r],!1)){h(`Invalid character '${s[r]}' at ${r}.`),o=!0;break}if("\\"!==s[r]){if(")"===s[r]){if(t--,0===t){r++;break}}else if("("===s[r]&&(t++,"?"!==s[r+1])){h(`Capturing groups are not allowed at ${r}`),o=!0;break}e+=s[r++]}else e+=s[r++]+s[r++]}if(o)continue;if(t){h(`Unbalanced pattern at ${a}`);continue}if(!e){h(`Missing pattern at ${a}`);continue}i.push({type:"PATTERN",index:a,value:e}),a=r}else{let n="",r=a+1;for(;r<s.length;){const i=s.substr(r,1);if(!(r===a+1&&t.test(i)||r!==a+1&&e.test(i)))break;n+=s[r++]}if(!n){h(`Missing parameter name at ${a}`);continue}i.push({type:"NAME",index:a,value:n}),a=r}else i.push({type:"CLOSE",index:a,value:s[a++]});else i.push({type:"OPEN",index:a,value:s[a++]});else i.push({type:"ESCAPED_CHAR",index:a++,value:s[a++]});else i.push({type:"MODIFIER",index:a,value:s[a++]});else i.push({type:"ASTERISK",index:a,value:s[a++]})}return i.push({type:"END",index:a,value:""}),i}function r(t,e={}){const n=s(t),{prefixes:r="./"}=e,a=`[^${i(e.delimiter||"/#?")}]+?`,o=[];let h=0,p=0,c="",u=new Set;const f=t=>{if(p<n.length&&n[p].type===t)return n[p++].value},l=()=>f("MODIFIER")||f("ASTERISK"),m=t=>{const e=f(t);if(void 0!==e)return e;const{type:s,index:r}=n[p];throw new TypeError(`Unexpected ${s} at ${r}, expected ${t}`)},d=()=>{let t,e="";for(;t=f("CHAR")||f("ESCAPED_CHAR");)e+=t;return e},g=e.encodePart||(t=>t);for(;p<n.length;){const t=f("CHAR"),e=f("NAME");let n=f("PATTERN");if(e||n||!f("ASTERISK")||(n=".*"),e||n){let s=t||"";-1===r.indexOf(s)&&(c+=s,s=""),c&&(o.push(g(c)),c="");const i=e||h++;if(u.has(i))throw new TypeError(`Duplicate name '${i}'.`);u.add(i),o.push({name:i,prefix:g(s),suffix:"",pattern:n||a,modifier:l()||""});continue}const s=t||f("ESCAPED_CHAR");if(s)c+=s;else if(f("OPEN")){const t=d(),e=f("NAME")||"";let n=f("PATTERN")||"";e||n||!f("ASTERISK")||(n=".*");const s=d();m("CLOSE");const r=l()||"";if(!e&&!n&&!r){c+=t;continue}if(!e&&!n&&!t)continue;c&&(o.push(g(c)),c=""),o.push({name:e||(n?h++:""),pattern:e&&!n?a:n,prefix:g(t),suffix:g(s),modifier:r})}else c&&(o.push(g(c)),c=""),m("END")}return o}function i(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function a(t){return t&&t.sensitive?"u":"ui"}function o(t,e,n={}){const{strict:s=!1,start:r=!0,end:o=!0,encode:h=t=>t}=n,p=`[${i(n.endsWith||"")}]|$`,c=`[${i(n.delimiter||"/#?")}]`;let u=r?"^":"";for(const n of t)if("string"==typeof n)u+=i(h(n));else{const t=i(h(n.prefix)),s=i(h(n.suffix));if(n.pattern)if(e&&e.push(n),t||s)if("+"===n.modifier||"*"===n.modifier){const e="*"===n.modifier?"?":"";u+=`(?:${t}((?:${n.pattern})(?:${s}${t}(?:${n.pattern}))*)${s})${e}`}else u+=`(?:${t}(${n.pattern})${s})${n.modifier}`;else"+"===n.modifier||"*"===n.modifier?u+=`((?:${n.pattern})${n.modifier})`:u+=`(${n.pattern})${n.modifier}`;else u+=`(?:${t}${s})${n.modifier}`}if(o)s||(u+=`${c}?`),u+=n.endsWith?`(?=${p})`:"$";else{const e=t[t.length-1],n="string"==typeof e?c.indexOf(e[e.length-1])>-1:void 0===e;s||(u+=`(?:${c}(?=${p}))?`),n||(u+=`(?=${c}|${p})`)}return new RegExp(u,a(n))}function h(t,e,n){return t instanceof RegExp?function(t,e){if(!e)return t;const n=/\((?:\?<(.*?)>)?(?!\?)/g;let s=0,r=n.exec(t.source);for(;r;)e.push({name:r[1]||s++,prefix:"",suffix:"",modifier:"",pattern:""}),r=n.exec(t.source);return t}(t,e):Array.isArray(t)?function(t,e,n){const s=t.map(t=>h(t,e,n).source);return new RegExp(`(?:${s.join("|")})`,a(n))}(t,e,n):function(t,e,n){return o(r(t,n),e,n)}(t,e,n)}var p={delimiter:"",prefixes:"",sensitive:!0,strict:!0},c={delimiter:".",prefixes:"",sensitive:!0,strict:!0},u={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function f(t,e){return t.startsWith(e)?t.substring(e.length,t.length):t}function l(t){return!(!t||t.length<2||"["!==t[0]&&("\\"!==t[0]&&"{"!==t[0]||"["!==t[1]))}var m=["ftp","file","http","https","ws","wss"];function d(t){if(!t)return!0;for(const e of m)if(t.test(e))return!0;return!1}function g(t){switch(t){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function x(t){if(""===t)return t;if(/^[-+.A-Za-z0-9]*$/.test(t))return t.toLowerCase();throw new TypeError(`Invalid protocol '${t}'.`)}function S(t){if(""===t)return t;const e=new URL("https://example.com");return e.username=t,e.username}function w(t){if(""===t)return t;const e=new URL("https://example.com");return e.password=t,e.password}function k(t){if(""===t)return t;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(t))throw new TypeError(`Invalid hostname '${t}'`);const e=new URL("https://example.com");return e.hostname=t,e.hostname}function y(t){if(""===t)return t;if(/[^0-9a-fA-F[\]:]/g.test(t))throw new TypeError(`Invalid IPv6 hostname '${t}'`);return t.toLowerCase()}function P(t){if(""===t)return t;if(/^[0-9]*$/.test(t)&&parseInt(t)<=65535)return t;throw new TypeError(`Invalid port '${t}'.`)}function R(t){if(""===t)return t;const e=new URL("https://example.com");return e.pathname="/"!==t[0]?"/-"+t:t,"/"!==t[0]?e.pathname.substring(2,e.pathname.length):e.pathname}function b(t){return""===t?t:new URL(`data:${t}`).pathname}function $(t){if(""===t)return t;const e=new URL("https://example.com");return e.search=t,e.search.substring(1,e.search.length)}function I(t){if(""===t)return t;const e=new URL("https://example.com");return e.hash=t,e.hash.substring(1,e.hash.length)}var C=["protocol","username","password","hostname","port","pathname","search","hash"],E="*";function L(t,e){if("string"!=typeof t)throw new TypeError("parameter 1 is not of type 'string'.");const n=new URL(t,e);return{protocol:n.protocol.substring(0,n.protocol.length-1),username:n.username,password:n.password,hostname:n.hostname,port:n.port,pathname:n.pathname,search:""!=n.search?n.search.substring(1,n.search.length):void 0,hash:""!=n.hash?n.hash.substring(1,n.hash.length):void 0}}function v(t,e,n){let s;if("string"==typeof e.baseURL)try{s=new URL(e.baseURL),t.protocol=s.protocol?s.protocol.substring(0,s.protocol.length-1):"",t.username=s.username,t.password=s.password,t.hostname=s.hostname,t.port=s.port,t.pathname=s.pathname,t.search=s.search?s.search.substring(1,s.search.length):"",t.hash=s.hash?s.hash.substring(1,s.hash.length):""}catch{throw new TypeError(`invalid baseURL '${e.baseURL}'.`)}if("string"==typeof e.protocol&&(t.protocol=function(t,e){var n;return t=(n=t).endsWith(":")?n.substr(0,n.length-1):n,e||""===t?t:x(t)}(e.protocol,n)),"string"==typeof e.username&&(t.username=function(t,e){if(e||""===t)return t;const n=new URL("https://example.com");return n.username=t,n.username}(e.username,n)),"string"==typeof e.password&&(t.password=function(t,e){if(e||""===t)return t;const n=new URL("https://example.com");return n.password=t,n.password}(e.password,n)),"string"==typeof e.hostname&&(t.hostname=function(t,e){return e||""===t?t:l(t)?y(t):k(t)}(e.hostname,n)),"string"==typeof e.port&&(t.port=function(t,e,n){return g(e)===t&&(t=""),n||""===t?t:P(t)}(e.port,t.protocol,n)),"string"==typeof e.pathname){if(t.pathname=e.pathname,s&&!function(t,e){return!(!t.length||"/"!==t[0]&&(!e||t.length<2||"\\"!=t[0]&&"{"!=t[0]||"/"!=t[1]))}(t.pathname,n)){const e=s.pathname.lastIndexOf("/");e>=0&&(t.pathname=s.pathname.substring(0,e+1)+t.pathname)}t.pathname=function(t,e,n){if(n||""===t)return t;if(e&&!m.includes(e))return new URL(`${e}:${t}`).pathname;const s="/"==t[0];return t=new URL(s?t:"/-"+t,"https://example.com").pathname,s||(t=t.substring(2,t.length)),t}(t.pathname,t.protocol,n)}return"string"==typeof e.search&&(t.search=function(t,e){if(t=f(t,"?"),e||""===t)return t;const n=new URL("https://example.com");return n.search=t,n.search?n.search.substring(1,n.search.length):""}(e.search,n)),"string"==typeof e.hash&&(t.hash=function(t,e){if(t=f(t,"#"),e||""===t)return t;const n=new URL("https://example.com");return n.hash=t,n.hash?n.hash.substring(1,n.hash.length):""}(e.hash,n)),t}function A(t){return t.replace(/([+*?:{}()\\])/g,"\\$1")}function T(t,e){const n=`[^${s=e.delimiter||"/#?",s.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}]+?`;var s;const r=/[$_\u200C\u200D\p{ID_Continue}]/u;let i="";for(let s=0;s<t.length;++s){const a=t[s],o=s>0?t[s-1]:null,h=s<t.length-1?t[s+1]:null;if("string"==typeof a){i+=A(a);continue}if(""===a.pattern){if(""===a.modifier){i+=A(a.prefix);continue}i+=`{${A(a.prefix)}}${a.modifier}`;continue}const p="number"!=typeof a.name,c=void 0!==e.prefixes?e.prefixes:"./";let u=""!==a.suffix||""!==a.prefix&&(1!==a.prefix.length||!c.includes(a.prefix));if(!u&&p&&a.pattern===n&&""===a.modifier&&h&&!h.prefix&&!h.suffix)if("string"==typeof h){const t=h.length>0?h[0]:"";u=r.test(t)}else u="number"==typeof h.name;if(!u&&""===a.prefix&&o&&"string"==typeof o&&o.length>0){const t=o[o.length-1];u=c.includes(t)}u&&(i+="{"),i+=A(a.prefix),p&&(i+=`:${a.name}`),".*"===a.pattern?p||o&&"string"!=typeof o&&!o.modifier&&!u&&""===a.prefix?i+="(.*)":i+="*":a.pattern===n?p||(i+=`(${n})`):i+=`(${a.pattern})`,a.pattern===n&&p&&""!==a.suffix&&r.test(a.suffix[0])&&(i+="\\"),i+=A(a.suffix),u&&(i+="}"),i+=a.modifier}return i}var U=class{constructor(t={},e){this.regexp={},this.keys={},this.component_pattern={};try{if("string"==typeof t){const n=new class{constructor(t){this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=0,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=t}get result(){return this.internalResult}parse(){for(this.tokenList=s(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,"END"===this.tokenList[this.tokenIndex].type){if(0===this.state){this.rewind(),this.isHashPrefix()?this.changeState(9,1):this.isSearchPrefix()?(this.changeState(8,1),this.internalResult.hash=""):(this.changeState(7,0),this.internalResult.search="",this.internalResult.hash="");continue}if(2===this.state){this.rewindAndSetState(5);continue}this.changeState(10,0);break}if(this.groupDepth>0){if(!this.isGroupClose())continue;this.groupDepth-=1}if(this.isGroupOpen())this.groupDepth+=1;else switch(this.state){case 0:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(1));break;case 1:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();let t=7,e=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(t=2,e=3):this.shouldTreatAsStandardURL&&(t=2),this.changeState(t,e)}break;case 2:this.isIdentityTerminator()?this.rewindAndSetState(3):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(5);break;case 3:this.isPasswordPrefix()?this.changeState(4,1):this.isIdentityTerminator()&&this.changeState(5,1);break;case 4:this.isIdentityTerminator()&&this.changeState(5,1);break;case 5:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(6,1):this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 6:this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 7:this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 8:this.isHashPrefix()&&this.changeState(9,1)}}}changeState(t,e){switch(this.state){case 0:case 2:case 10:break;case 1:this.internalResult.protocol=this.makeComponentString();break;case 3:this.internalResult.username=this.makeComponentString();break;case 4:this.internalResult.password=this.makeComponentString();break;case 5:this.internalResult.hostname=this.makeComponentString();break;case 6:this.internalResult.port=this.makeComponentString();break;case 7:this.internalResult.pathname=this.makeComponentString();break;case 8:this.internalResult.search=this.makeComponentString();break;case 9:this.internalResult.hash=this.makeComponentString()}this.changeStateWithoutSettingComponent(t,e)}changeStateWithoutSettingComponent(t,e){this.state=t,this.componentStart=this.tokenIndex+e,this.tokenIndex+=e,this.tokenIncrement=0}rewind(){this.tokenIndex=this.componentStart,this.tokenIncrement=0}rewindAndSetState(t){this.rewind(),this.state=t}safeToken(t){return t<0&&(t=this.tokenList.length-t),t<this.tokenList.length?this.tokenList[t]:this.tokenList[this.tokenList.length-1]}isNonSpecialPatternChar(t,e){const n=this.safeToken(t);return n.value===e&&("CHAR"===n.type||"ESCAPED_CHAR"===n.type||"INVALID_CHAR"===n.type)}isProtocolSuffix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}nextIsAuthoritySlashes(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")}isIdentityTerminator(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")}isPasswordPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPortPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPathnameStart(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")}isSearchPrefix(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if("?"!==this.tokenList[this.tokenIndex].value)return!1;const t=this.safeToken(this.tokenIndex-1);return"NAME"!==t.type&&"PATTERN"!==t.type&&"CLOSE"!==t.type&&"ASTERISK"!==t.type}isHashPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")}isGroupOpen(){return"OPEN"==this.tokenList[this.tokenIndex].type}isGroupClose(){return"CLOSE"==this.tokenList[this.tokenIndex].type}isIPv6Open(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")}isIPv6Close(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")}makeComponentString(){const t=this.tokenList[this.tokenIndex],e=this.safeToken(this.componentStart).index;return this.input.substring(e,t.index)}computeShouldTreatAsStandardURL(){const t={};Object.assign(t,p),t.encodePart=x;const e=h(this.makeComponentString(),void 0,t);this.shouldTreatAsStandardURL=d(e)}}(t);if(n.parse(),t=n.result,e){if("string"!=typeof e)throw new TypeError("'baseURL' parameter is not of type 'string'.");t.baseURL=e}else if("string"!=typeof t.protocol)throw new TypeError("A base URL must be provided for a relative constructor string.")}else if(e)throw new TypeError("parameter 1 is not of type 'string'.");if(!t||"object"!=typeof t)throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");const n={pathname:E,protocol:E,username:E,password:E,hostname:E,port:E,search:E,hash:E};let i;for(i of(this.pattern=v(n,t,!0),g(this.pattern.protocol)===this.pattern.port&&(this.pattern.port=""),C)){if(!(i in this.pattern))continue;const t={},e=this.pattern[i];switch(this.keys[i]=[],i){case"protocol":Object.assign(t,p),t.encodePart=x;break;case"username":Object.assign(t,p),t.encodePart=S;break;case"password":Object.assign(t,p),t.encodePart=w;break;case"hostname":Object.assign(t,c),l(e)?t.encodePart=y:t.encodePart=k;break;case"port":Object.assign(t,p),t.encodePart=P;break;case"pathname":d(this.regexp.protocol)?(Object.assign(t,u),t.encodePart=R):(Object.assign(t,p),t.encodePart=b);break;case"search":Object.assign(t,p),t.encodePart=$;break;case"hash":Object.assign(t,p),t.encodePart=I}try{const n=r(e,t);this.regexp[i]=o(n,this.keys[i],t),this.component_pattern[i]=T(n,t)}catch{throw new TypeError(`invalid ${i} pattern '${this.pattern[i]}'.`)}}}catch(t){throw new TypeError(`Failed to construct 'URLPattern': ${t.message}`)}}test(t={},e){let n,s={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if("string"!=typeof t&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(void 0===t)return!1;try{s=v(s,"object"==typeof t?t:L(t,e),!1)}catch(t){return!1}for(n in this.pattern)if(!this.regexp[n].exec(s[n]))return!1;return!0}exec(t={},e){let n={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if("string"!=typeof t&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(void 0===t)return;try{n=v(n,"object"==typeof t?t:L(t,e),!1)}catch(t){return null}let s,r={};for(s in r.inputs=e?[t,e]:[t],this.pattern){let t=this.regexp[s].exec(n[s]);if(!t)return null;let e={};for(let[n,r]of this.keys[s].entries())if("string"==typeof r.name||"number"==typeof r.name){let s=t[n+1];e[r.name]=s}r[s]={input:n[s]||"",groups:e}}return r}get protocol(){return this.component_pattern.protocol}get username(){return this.component_pattern.username}get password(){return this.component_pattern.password}get hostname(){return this.component_pattern.hostname}get port(){return this.component_pattern.port}get pathname(){return this.component_pattern.pathname}get search(){return this.component_pattern.search}get hash(){return this.component_pattern.hash}};globalThis.URLPattern||(globalThis.URLPattern=U),window.URLPattern=U})();{var iGLUI;Class(function AppState(_default){this.map=new Map,this.bindings=new Map;const reservedKeys=["map","bindings","onUpdate","readonly","origin"];_default&&this.setAll(_default);const prototype=AppState.prototype;void 0===prototype.set&&(prototype.set=function(key,value,force){const _this=this;if(_this.readonly)return console.warn("This AppState is locked and can not make changes");_this.map.set(key,value),_this.onUpdate&&_this.onUpdate(key,value);let array=_this.bindings.get(key);if(array){if(array._updating)return void(array._reentered=!0);reenter:for(;;){let len=array.length;array._updating=!0;for(let i=0;i<len;i++)array[i]._updating=!0;for(let i=0;i<len;i++){let b=array[i];if(b&&b.update){if(b._updating){if(b.update(key,value,force),b._updating=!1,array._reentered){array._reentered=!1,value=_this.get(key);continue reenter}b.update&&array.length===len&&array[i]===b||(i=-1,len=array.length)}}else array.splice(i,1),i-=1,len=array.length}break}array._updating=!1}},prototype.get=function(key){return this.map.get(key)},prototype.getMap=function(){return this.map},prototype.toJSON=function(){return Object.fromEntries(this.map)},prototype.bind=function(keys,...rest){const _this=this;if(!rest.length)return{state:_this,key:keys};Array.isArray(keys)||(keys=[keys]);const obj=1===rest.length?rest[0]:rest;let binding=new StateBinding(keys,obj,this);return keys.forEach(key=>{_this.bindings.has(key)?_this.bindings.get(key).push(binding):_this.bindings.set(key,[binding]);let value=_this.map.get(key);void 0!==value&&binding.update(key,value)}),binding},prototype.createLocal=function(obj){let appState=new AppState(obj);return new Proxy(appState,{set:(target,property="",value)=>(reservedKeys.includes(property)?appState[property]=value:appState.set(property,value),!0),get:(target,property)=>target[property]?target[property]:appState.get(property),has:(target,property)=>!!target[property]||target.map.has(property),ownKeys:target=>[...Reflect.ownKeys(target),...target.map.keys()],getOwnPropertyDescriptor(target,property){let descriptor=Object.getOwnPropertyDescriptor(target,property);return descriptor||(target.map.has(property)?{value:target.map.get(property),writable:!0,configurable:!0,enumerable:!0}:void 0)},delete(target,property){Object.hasOwnProperty.call(target,property)?delete target[property]:target.map.has(property)&&target.map.delete(property)}})},prototype.setAll=function(obj){const _this=this;for(let key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&!reservedKeys.includes(key)&&_this.set(key,obj[key])},prototype.lock=function(){this.readonly=!0},prototype.unlock=function(){this.readonly=!1},prototype.clearKeysMatching=function(str){let keys=this.map.keys();for(let key of keys)key.startsWith(str)&&this.map.delete(key)},prototype.isAppState=!0)},"static");const unsetValue="function"==typeof Symbol?Symbol("unset"):{"@@unset":!0};class StateBinding{constructor(_keys,_obj,_ref){if(this._keys=_keys,this._obj=_obj,this._string="",this._oldValue=unsetValue,this._type="",this._bindingLookup="",this._ref=_ref,void 0===iGLUI&&(iGLUI=!!window.GLUI),_obj instanceof HTMLElement)"INPUT"==_obj.nodeName?this._string=_obj.value:this._string=_obj.innerText,this._type="HTMLElement";else if("function"==typeof DOMAttribute&&_obj instanceof DOMAttribute)this._string=_obj.value,this._name=_obj.name,this._belongsTo=_obj.belongsTo,this._bindingLookup=_obj.bindingLookup,this._type="DOMAttribute";else if("function"==typeof Sprite&&_obj instanceof Sprite)this._string=_obj.id,this._type="Sprite";else if(_obj instanceof HydraObject)"input"==_obj._type?this._string=_obj.val():this._string=_obj.text(),this._type="HydraObject";else if(iGLUI&&_obj instanceof GLUIText)this._string=_obj.getTextString(),this._type="GLUIText";else{if(_obj.createLocal&&(this._type="appState"),_obj.onStateChange&&(this._type="class"),"function"==typeof _obj&&(this._type="function"),Array.isArray(_obj)&&_obj.every(el=>"function"==typeof el)){this._type="piped";const lastFunctionInChain=this._obj.pop();this._operators=this._obj,this._obj=lastFunctionInChain,this._count=0}_obj.appStateTemplateString&&"string"==typeof _obj.appStateTemplateString&&(this._string=_obj.appStateTemplateString)}}parse(key,value){if(!this._string||!this._string.includes("@["))return value;const _this=this;let string=this._string;return this._keys.forEach(key=>{string=string.replace(`@[${key}]`,_this._ref.get(key))}),string}async operateOnValue(value){return await this._operators.reduce(async(prev,fn)=>{const prevResolved=await prev;return(await fn)(prevResolved,this._count++,this)},value)}update(key,value,force){let newValue=this.parse(key,value);if(Object.is(newValue,this._oldValue)&&(!value||!value.push)&&!force)return;let oldValue=this._oldValue;this._oldValue=newValue;try{switch(this._type){case"HTMLElement":"input"==this._obj._type?this._obj.value=newValue:this._obj.innerText=newValue;break;case"DOMAttribute":this._obj.belongsTo.setAttribute(this._obj.name,this._obj.value.replace(this._obj.bindingLookup,newValue));break;case"Sprite":this._obj.id=newValue;break;case"HydraObject":"input"==this._obj._type?this._obj.val(newValue):this._obj.html(newValue);break;case"GLUIText":this._obj.setText(newValue);break;case"function":oldValue!==unsetValue?this._obj(newValue,oldValue):this._obj(newValue);break;case"piped":this.operateOnValue(newValue).then(val=>this._obj(val),reject=>null);break;case"class":this._obj.onStateChange(newValue);break;case"appState":this._obj.set(key,newValue)}}catch(err){throw console.error("AppState binding failed to execute. You should probably be using _this.bindState instead"),console.error(err),err}return!0}_bindOnDestroy(cb){this._onDestroy||(this._onDestroy=[]),this._onDestroy.push(cb)}destroy(){this._onDestroy&&this._onDestroy.forEach(cb=>cb()),this._keys.forEach(key=>{let array=this._ref.bindings.get(key);if(array){for(let i=0;i<array.length;i++){array[i]===this&&(array.splice(i,1),i-=1)}0===array.length&&this._ref.bindings.delete(key)}}),Utils.nullObject(this)}}window.StateBinding=StateBinding}Class(function StateArray(_src=[],_filterFn=null){Inherit(this,Events);const _this=this;var _data=[];function wrap(obj){if("object"!=typeof obj||Array.isArray(obj))throw"StateArray entries must be {objects}!";if(obj._uid||(obj._uid=Utils.uuid()),obj.createLocal)return obj;let state=AppState.createLocal(obj);return state.origin=obj,state}if(Object.defineProperty(_this,"length",{get:function(){return _data.length}}),this.setFilter=function(fn,refresh=!0){_filterFn=fn,refresh&&this.refresh(_data.filter(fn))},this.push=function(obj){if(_filterFn&&!_filterFn(obj))return;let state=wrap(obj);return _data.push(state),function setInterfaceAtIndex(index){void 0===_this[index]&&Object.defineProperty(_this,index,{set:function(v){for(let key in v)_data[index].set(key,v[key])},get:function(){return _data[index]}})}(_data.length-1),_this.events.fire(Events.UPDATE,{type:"add",state:state}),state},this.remove=function(obj){for(let i=0;i<_data.length;i++){let state=_data[i];state.origin!==obj&&state!==obj||(_data.splice(i,1),_this.events.fire(Events.UPDATE,{type:"remove",state:state},!0))}},this.update=async function(obj){var _found=!1;for(let i=0;i<_data.length;i++){var state=_data[i];if(state.origin._uid===obj._uid||state._uid===obj._uid)return await state.setAll(obj),_this.events.fire(Events.UPDATE,{type:"modify",state:state,index:i}),_found=!0}return _found},this.forEach=function(cb){_data.forEach(function(...args){return cb.apply(this,args)})},this.find=function(cb){return _data.find(function(...args){return cb.apply(this,args)})},this.insertAtIdx=function(idx,obj){if(obj._uid||(obj=wrap(obj)),!_data[Math.abs(idx)])throw"There is no item at index "+idx+" in this StateArray";_data.splice(idx,0,obj);const newData=_data.filter(()=>!0);this.refresh(newData)},this.map=function(cb){let array=[];return _data.forEach(function(...args){return array.push(cb.apply(this,args))}),array},this.find=function(cb){return _data.find(function(...args){return cb.apply(this,args)})},this.toJSON=function(){let array=[];return _data.forEach(appState=>{array.push(appState.toJSON())}),array},this.getMap=function(){let array=[];return _data.forEach(appState=>{array.push(appState.getMap())}),array},this.indexOf=function(obj){for(let i=0;i<_data.length;i++){let state=_data[i];if(state.origin===obj||state===obj)return i}},this.refresh=function(array){Array.isArray(array)||array instanceof StateArray||(array=[array]),_this.events.fire(StateArray.REFRESH,{type:"refresh"},!0);let i=_data.length;for(;i--;){let state=_data.pop();_this.events.fire(Events.UPDATE,{type:"remove",state:state},!0)}_data.length=0,array.forEach(_this.push)},this.sort=function(cb){let array=[];_data.forEach(d=>array.push(d)),array.sort(cb),_this.refresh(array)},this.reorder=function(uidArray){for(let i=0;i<uidArray.length;i++)if(!_data.some(d=>d._uid===uidArray[i]))return void console.warn(`UID ${uidArray[i]} not found in StateArray ${_this}`);_data.sort((a,b)=>uidArray.indexOf(a._uid)-uidArray.indexOf(b._uid)),_this.events.fire(Events.UPDATE,{type:"reorder",state:uidArray},!0)},this.includes=function(obj){return this.indexOf(obj)>-1},this.reflow=function(){this.refresh(_data.map(d=>d.origin))},!Array.isArray(_src))throw"StateArray can only take an array as a parameter";_src.forEach(_this.push)},_=>{StateArray.REFRESH="state_array_refresh"}),Class(function ViewState(ViewClass,...rest){Inherit(this,Component);const _this=this;var _stateArray,_params,_dynamicViewClass,_callbacks={},_bindings=[],_removals=[];"object"==typeof ViewClass&&(ViewClass.view||ViewClass.wait_view)&&(ViewClass=(_params=ViewClass).view,rest=[_params],delete _params.view,_this.listen=function(key,callback){_bindings.push(key),_callbacks[key]=callback},_this.onAddView=_params.onAddView,_this.onRemoveView=_params.onRemoveView);var _instances=this.views=[];function remove(data){_this.animating=!0;for(let i=0;i<_instances.length;i++){let inst=_instances[i];if(data==inst.data){let promise=_this.onRemoveView?.(inst,i)||inst.onRemoveView?.(i);promise&&promise.then&&(_removals.push(promise),_this.disableAutoDestroy||promise.then(_=>inst.destroy?.())),_instances.splice(i,1),0===_instances.length&&_this.onEmpty?.(),promise&&promise.then||_this.disableAutoDestroy||!inst.destroy||inst.destroy();break}}if(ViewState.clearScheduled(data,_this),_removals.length){let removals=_removals.slice();Promise.all(removals).then(_=>{removals.forEach(removal=>{_removals.remove(removal)}),0===_removals.length&&(_this.animating=!1)})}}function findParentHelper(instance){let p=instance.parent;for(;p;){if(p._cachedName||(p._cachedName=Utils.getConstructorName(p)),"ViewState"===p._cachedName&&p.stateArray?._visualEditingHelpers)return p.stateArray._visualEditingHelpers;p=p.parent}}async function dataUpdate(e){switch(e.type){case"add":for(;_removals.length;)await Promise.all(_removals);_this.dataFilter(e.state)&&ViewState.schedule(_this,_dynamicViewClass?ViewClass(e.state):ViewClass,e.state,_stateArray.indexOf(e.state),rest);break;case"remove":remove(e.state);break;case"modify":_this.dataFilter(e.state)?function update(data,index){var _exists=!1;for(let i=0;i<_instances.length;i++){let inst=_instances[i];if(data._uid===inst.data._uid)return _this.onUpdateView?.(_instances[i],i),void(_exists=!0)}_exists||ViewState.schedule(_this,_dynamicViewClass?ViewClass(data):ViewClass,data,_stateArray.indexOf(data))}(e.state,e.index):remove(e.state);break;case"reorder":if(!Array.isArray(e.state)||!e.state.length)return;if(_this.parent.group&&_this.parent.group.add)return void console.warn("Swapping items in a Group's ViewState is not yet supported");if(_this.parent.element&&_this.parent.element.add){for(let i=0;i<e.state.length;i++)if(!_instances.some(inst=>inst.data._uid===e.state[i]))return void console.warn(`View with uid ${e.state[i]} not found in ViewState ${_this}`);_instances.sort((a,b)=>e.state.indexOf(a.data._uid)-e.state.indexOf(b.data._uid)),_instances.forEach((inst,index)=>inst.index=index);let divParent=_instances[0].element.parent().div;_instances.map(inst=>divParent.appendChild(inst.element.div))}}}this.hmr=function(view){for(_dynamicViewClass||(ViewClass=window[view]);_instances.length;)remove(_instances[0].data);this.setSourceData(_stateArray)},this.setSourceData=function(array){if(void 0===_dynamicViewClass&&(_dynamicViewClass="function"==typeof ViewClass&&!!_this.parent.contexts),"string"==typeof ViewClass&&(ViewClass=window[ViewClass]),!Array.isArray(array)||array instanceof StateArray||(array=new StateArray(array)),!(array instanceof StateArray||Array.isArray(array)))throw"ViewState::setSourceData must be instance of StateArray";if(_stateArray=_this.stateArray=array,_this.events.sub(array,Events.UPDATE,dataUpdate),array.forEach(state=>{_this.dataFilter(state)&&ViewState.schedule(_this,_dynamicViewClass?ViewClass(state):ViewClass,state,_stateArray.indexOf(state),rest)}),_this.parent.contexts.includes("Element")&&array?._visualEditingHelpers&&!array.find(item=>!item.hasOwnProperty("_key"))){let helpers=array._visualEditingHelpers;_params.__parent.attr("data-sanity",helpers.attr())}},this.dataFilter=function(data){return!0},this.onInitialize=function(instance){let unfilteredIndex=_stateArray.indexOf(instance.data),filteredIndex=-1;for(let i=0;i<_instances.length;++i){let data=_instances[i].data;if(_stateArray.indexOf(data)>unfilteredIndex){filteredIndex=i;break}}if(filteredIndex<0&&(filteredIndex=_instances.length),instance.element&&_this.parent.element&&_this.parent.element.add){let before=null;filteredIndex<_instances.length&&_instances[filteredIndex].element&&(before=_instances[filteredIndex]),_this.parent.element.add(instance.element,before)}if(_instances.splice(filteredIndex,0,instance),_this.listen&&instance.state&&_bindings.forEach(key=>{_this.bindState(instance.state,key,data=>{_callbacks[key]?.({target:instance,data:data})})}),_params?.__parent&&_params.__parent.add(instance),(instance.group||instance.mesh)&&_this.parent.group?.add(instance.group||instance.mesh),_this.onAddView?.(instance,filteredIndex),instance.contexts?.includes("Element")&&findParentHelper(instance)&&instance.data.hasOwnProperty("_key")){if(instance.contexts.includes("'figure'"))return;let helpers=findParentHelper(instance);instance.element.attr("data-sanity",helpers.attr([`_key=="${instance.data._key}"`]))}},_params?.data&&this.setSourceData(_params.data),(_params?.wait_data||_params?.wait_view)&&Promise.all([_params.wait_data||_params.data,_params.wait_view||_params.view]).then(([data,view])=>{_params.data=data,_params.view=view,ViewClass=view,_this.setSourceData(data)})},_=>{const queue=[],worker=new Render.Worker(_=>{let obj=queue.shift();if(obj){let{ref:ref,ViewClass:ViewClass,data:data,index:index,additionalArgs:additionalArgs}=obj;if(!ref.initClass)return;let args=[];additionalArgs.forEach(arg=>{args.push(...arg)});let inst=ref.initClass(ViewClass,data,index,...args,null);inst.data=data,ref.onInitialize(inst)}else worker.pause()},2);worker.pause(),ViewState.clearScheduled=function(data,ref){for(let i=0;i<queue.length;i++){let obj=queue[i];if(obj.data===data&&obj.ref==ref)return queue.splice(i,1)}},ViewState.schedule=function(ref,ViewClass,data,index,...rest){ref.initClass&&(queue.push({ref:ref,ViewClass:ViewClass,data:data,index:index,additionalArgs:rest}),worker.resume())}}),Class(function ViewStateElement(){this.viewStateElement=!0}),Class(function Dev(){const _this=this;let _inter,_timerName;function handleRenderCallbackError(info){if(window.RemoteLogger)return void Events.emitter._removeEvent(Render.RENDER_CALLBACK_ERROR,handleRenderCallbackError);let{callback:callback,error:error}=info;console.error("Error in render callback",callback,error)}Events.emitter._addEvent(Render.RENDER_CALLBACK_ERROR,handleRenderCallbackError),this.emulator=Device.mobile&&navigator.platform&&navigator.platform.toLowerCase().includes(["mac","windows"]),this.expose=function(name,val,force){(Hydra.LOCAL||force)&&(window[name]=val)},this.unsupported=function(needsAlert){needsAlert&&alert("Hi! This build is not yet ready for this device, things may not work as expected. Refer to build schedule for when this device will be supported.")},this.checkForLeaks=function(flag,array){if(window.AURA)return;let exceptions=["_ga","_typeface_js","_xdc_","_babelPolyfill","$jscomp","_sentryDebugIds","_injected"];window.HYDRA_LEAKS_EXCEPTIONS&&(exceptions=exceptions.concat(window.HYDRA_LEAKS_EXCEPTIONS));var matchArray=function(prop){if(!array)return!1;for(var i=0;i<array.length;i++)if(prop.includes(array[i]))return!0;return!1};clearInterval(_inter),flag&&(_inter=setInterval(function(){for(var prop in window)if(!prop.includes("webkit")){var obj;try{obj=window[prop]}catch(e){}if(obj&&"function"!=typeof obj&&prop.length>2){if(prop.includes(exceptions)||matchArray(prop))continue;var char1=prop.charAt(0),char2=prop.charAt(1);if(("_"==char1||"$"==char1)&&char2!==char2.toUpperCase())throw console.log(window[prop]),"Hydra Warning:: "+prop+" leaking into global scope"}}},1e3))},this.startTimer=function(name){_timerName=name||"Timer",console.time&&!window._NODE_?console.time(_timerName):_timer=performance.now()},this.stopTimer=function(){console.time&&!window._NODE_?console.timeEnd(_timerName):console.log("Render "+_timerName+": "+(performance.now()-_timer))},this.writeFile=function(file,data){let promise=Promise.create(),protocol=location.protocol,port="https:"===protocol?":8018":":8017",url=protocol+"//"+location.hostname+port+(_this.filesPath||location.pathname)+file;return post(url,data,{headers:{"content-type":"text/plain"}}).then(e=>{"OK"!=e?(console.warn(`Unable to write to ${file}`),promise.reject()):promise.resolve()}),promise},this.execUILScript=async function(name,data){if(!Hydra.LOCAL)return;let protocol=location.protocol,port="https:"===protocol?":8018":":8017",url=`${protocol}//${location.hostname}${port}${_this.pathName||location.pathname}/uil/${name}`,response=await post(url,data,{headers:{"Content-Type":"text/plain"}});if("ERROR"===response||!1===response.success)throw response;return response},this.auditCompressedTextures=function(){let compressedKeys=[],changes=0;UILStorage.getKeys().forEach(key=>{let json,element=UILStorage.get(key);if("string"==typeof element)try{json=JSON.parse(element)}catch(e){}else"object"==typeof element&&(json=element);json?.src&&(!0===json.compressed?console.warn(`The texture ${json.src} is a ktx1 asset. Please convert it to ktx2.`):"ktx2"===json.compressed&&compressedKeys.push({key:key,src:json.src.split("?")[0]}))}),UILStorage.getKeys().forEach(key=>{let json,element=UILStorage.get(key);if("string"==typeof element)try{json=JSON.parse(element)}catch(e){}else"object"==typeof element&&(json=element);json?.src&&compressedKeys.find(el=>json.src.split("?")[0]===el.src.split("?")[0])&&"ktx2"!==json.compressed&&(changes++,console.log(`Changed ${json.src.split("?")[0]} in ${key} to use ktx2 compression.`),UILStorage.set(key,{...json,src:json.src.split("?")[0],compressed:"ktx2",useCompressed:!0}),Events.emitter._fireEvent(UILControlImage.AUDIT))}),changes?console.warn("Changes to UIL from auditCompressedTextures will not be saved until saving UIL and refreshing. Use Cmd+S or Ctrl+S to save and refresh any open SceneLayouts."):console.log("auditCompressedTextures did not find any textures that had instances using both uncompressed and compressed versions.")},Hydra.LOCAL&&_this.checkForLeaks(!0)},"static"),Class(function Service(){Inherit(this,Component);var _sw,_this=this;function getSWAssets(){if(!window.ASSETS.SW||_this.cached)return[];var assets=window.ASSETS.SW;return assets.forEach((asset,i)=>{asset.includes(".js")&&(asset=assets[i].replace(".js",".js?"+window._CACHE_))}),assets}function handleRegistration(e){}function handleReady(e){_this.isReady=!0,_this.events.fire(Events.READY,e,!0),_sw=navigator.serviceWorker.controller,function checkCache(){Storage.get("service_cache")!=window._CACHE_&&_this.post("clearCache")}()}function handleError(e){e&&(_this.events.fire(Events.ERROR,e,!0),_this.active=!1)}function handleMessage(e){var data=e.data;data.evt&&_this.events.fire(data.evt,data)}this.active=!1,this.ready=!1,this.cached=!1,this.offline=!1,this.disabled=!1,this.ready=function(){return this.wait(this,"isReady")},this.init=function(){Hydra.ready(()=>{!("serviceWorker"in navigator)||Hydra.LOCAL&&""==location.port||window.process||_this.disabled||function initWorker(){_this.active=!0,navigator.serviceWorker.register(`${window._SW_PATH_?window._SW_PATH_:""}sw.js`).then(handleRegistration).then(handleReady).then(handleError)}()})},this.cache=function(assets=[]){assets=Array.from(assets);_this.active&&_this.wait(_this,"ready",function(){_this.post("upload",{assets:assets,cdn:Assets.CDN,hostname:location.hostname,sw:getSWAssets(),offline:_this.offline}),Storage.set("service_cache",window._CACHE_),_this.cached=!0})},this.post=function(fn,data={}){if(!_this.active)return;_this.wait(_this,"ready",function(){let mc=new MessageChannel;mc.port1.onmessage=handleMessage,data.fn=fn,_sw&&_sw.postMessage(data,[mc.port2])})}},"static"),Class(function Storage(){var _storage,_this=this,_sessionData={};function cookie(key,value,expires){var options;if(arguments.length>1&&(null===value||"object"!=typeof value)){if((options={}).path="/",options.expires=expires||1,null===value&&(options.expires=-1),"number"==typeof options.expires){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}return document.cookie=[encodeURIComponent(key),"=",options.raw?String(value):encodeURIComponent(String(value)),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}var result,decode=(options=value||{}).raw?function(s){return s}:decodeURIComponent;return(result=new RegExp("(?:^|; )"+encodeURIComponent(key)+"=([^;]*)").exec(document.cookie))?decode(result[1]):null}this.noTracking=!1,function testStorage(){try{if(window.localStorage)try{window.localStorage.test=1,window.localStorage.removeItem("test"),_storage=!0}catch(e){_storage=!1}else _storage=!1}catch(e){_storage=!1}}(),this.setCookie=function(key,value,expires){cookie(key,value,expires)},this.getCookie=function(key){return cookie(key)},this.set=function(key,value){_this.noTracking?_sessionData[key]=value:(null!=value&&"object"==typeof value&&(value=JSON.stringify(value)),_storage?null===value?window.localStorage.removeItem(key):window.localStorage[key]=value:cookie(key,value,365))},this.get=function(key){if(_this.noTracking)return _sessionData[key];var val,char0;(val=_storage?window.localStorage[key]:cookie(key))&&(val.charAt&&(char0=val.charAt(0)),"{"!=char0&&"["!=char0||(val=JSON.parse(val)),"true"!=val&&"false"!=val||(val="true"==val));return val}},"Static"),Class(function Thread(_class){Inherit(this,Component);var _this=this,_worker,_callbacks,_path,_mvc,_msg={};const IGNORE_START="/*!hydra-thread-ignore*/",IGNORE_END="/*!end-hydra-thread-ignore*/";function init(){let file=window._ES5_?"/hydra-thread-es5.js":"/hydra-thread.js";_callbacks={},_worker=new Worker(Assets.getPath(Thread.PATH+file))}function importClasses(){importClass(Utils),importClass(Component),importClass(Events),importClass(_class,!0),importES5()}function importClass(_class,scoped){if(_class){var code,namespace;if(scoped){code=(code=_class.toString().replace("{","!!!")).split("!!!")[1];let ignores=[];for(;;){let startIndex=code.indexOf(IGNORE_START);if(startIndex<0)break;let endIndex=code.indexOf(IGNORE_END);endIndex<0&&(endIndex=code.length),ignores.push(code.substring(startIndex,endIndex)),code=code.substring(0,startIndex)+code.substring(endIndex)}for(;code.includes("this.");){var name=code.slice(code.indexOf("this.")).split("this.")[1].split(/\s*=/)[0];code=code.replace("this","self"),createMethod(name)}code=(code=code.slice(0,-1)).replace(/_self/g,"_this");let index=0;ignores.forEach(ignored=>{let endIndex=code.indexOf(IGNORE_END,index);code=code.substring(0,endIndex)+ignored+code.substring(endIndex),index=endIndex+ignored.length+IGNORE_END.length})}else if("function"!=typeof _class){if((code=_class.constructor.toString()).includes("[native"))return;namespace=_class._namespace?_class._namespace+".":"",code=namespace+"Class("+code+', "static");'}else namespace=_class._namespace?_class._namespace+".":"",code=namespace+"Class("+_class.toString()+");";Hydra.LOCAL&&(code+=`\n//# sourceURL=hydra-thread/${Utils.getConstructorName(_class)}.js`),_worker.postMessage({code:code})}}function createMethod(name){_this[name]=function(message={},callback,buffer){let promise;return Array.isArray(callback)&&(buffer=callback,callback=void 0),Array.isArray(buffer)&&((message={msg:message,transfer:!0}).buffer=buffer),void 0===callback&&(promise=Promise.create(),callback=promise.resolve),_this.send(name,message,callback),promise}}function importES5(){window._ES5_&&(["_createSuper","_isNativeReflectConstruct"].forEach(name=>{let code=window[name].toString();code.includes("[native")||_worker.postMessage({code:code})}),_worker.postMessage({code:"function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}"}))}function addListeners(){_worker.addEventListener("message",workerMessage)}function workerMessage(e){if(e.data.console)console.log(e.data.message);else if(e.data.id){(callback=_callbacks[e.data.id])&&callback(e.data.message),delete _callbacks[e.data.id]}else if(e.data.emit){(callback=_callbacks[e.data.evt])&&callback(e.data.msg)}else{var callback;(callback=_callbacks.transfer)&&callback(e.data)}}init(),importClasses(),addListeners(),this.on=function(evt,callback){_callbacks[evt]=callback},this.off=function(evt){delete _callbacks[evt]},this.loadFunction=function(){let names=[],load=code=>{var split=(code=(code=code.toString()).replace("(","!!!")).split("!!!"),name=split[0].split(" ")[1];code="self."+name+" = function("+split[1],Hydra.LOCAL&&(code+=`\n//# sourceURL=hydra-thread/function/${name}.js`),_worker.postMessage({code:code}),createMethod(name),names.push(name)};for(var i=0;i<arguments.length;i++)load(arguments[i]);return names},this.importScript=function(path){_worker.postMessage({path:Thread.absolutePath(path),importScript:!0})},this.importCode=function(code){_worker.postMessage({code:code})},this.importClass=function(){for(var i=0;i<arguments.length;i++){importClass(arguments[i])}},this.importModules=this.importModule=function(){for(var i=0;i<arguments.length;i++){let code=Modules.getConstructor(arguments[i]).toString();_worker.postMessage({code:`Module(${code})`})}},this.importES6Class=function(name){if(window._ES5_){let Class=window[name],base=Class.toString(),proto=[],sup,matches=/(_this\w+)\s*=\s*(_super\w+)\.call/g.exec(base);if(matches){let superVar=matches[2],superConstructor=Object.getPrototypeOf(Class);if(!superConstructor.toString().includes("[native")){let superName=Utils.getConstructorName(superConstructor);sup=`_inherits(${name}, ${superName}); var ${superVar} = _createSuper(${name});`}}Object.getOwnPropertyNames(Class.prototype).forEach(fn=>{"constructor"!=fn&&Class.prototype[fn]&&proto.push({key:fn,string:Class.prototype[fn].toString()})}),_worker.postMessage({es5:base,name:name,proto:proto,sup:sup})}else{let es6=`(${eval(name)})`;Hydra.LOCAL&&(es6+=`\n//# sourceURL=hydra-thread/${name}.js`),_worker.postMessage({es6:es6,name:name})}},this.send=function(name,message,callback){if("string"==typeof name){(message=message||{}).fn=name}else callback=message,message=name;Thread.UNIQUE_ID>999999&&(Thread.UNIQUE_ID=1);var id=Thread.UNIQUE_ID++;callback&&(_callbacks[id]=callback),message.transfer?(message.msg.id=id,message.msg.fn=message.fn,message.msg.transfer=!0,_worker.postMessage(message.msg,message.buffer)):(_msg.message=message,_msg.id=id,_worker.postMessage(_msg))},this.onDestroy=function(){_worker.terminate&&_worker.terminate()}},()=>{var _shared;Thread.PATH=window._THREAD_PATH_||"assets/js/hydra",Thread.UNIQUE_ID=1,Thread.absolutePath=Hydra.absolutePath,Thread.cluster=function(){return new function(){let index=0,array=[];this.push=function(thread){array.push(thread)},this.get=function(){let thread=array[index];return index++,index>=array.length&&(index=0),thread},this.array=array}},Thread.upload=function(...args){let name;Thread.shared();for(let i=0;i<_shared.array.length;i++)name=_shared.array[i].loadFunction(...args);return name},Thread.uploadClass=function(...args){let name;Thread.shared();for(let i=0;i<_shared.array.length;i++)name=_shared.array[i].importClass(...args);return name},Thread.shared=function(list){if(!_shared){_shared=Thread.cluster();let hardware=navigator.hardwareConcurrency||4,count=Math.max(Math.min(hardware,8),4);for(let i=0;i<count;i++)_shared.push(new Thread)}return list?_shared:_shared.get()}}),Class(function TweenManager(){Namespace(this);var _this=this,_tweens=[];let _updateIndex=null;function updateTweens(time,dt){for(_updateIndex=_tweens.length-1;_updateIndex>=0;_updateIndex--){let tween=_tweens[_updateIndex];tween?.update?tween.update(dt):_tweens.splice(_updateIndex,1)}_updateIndex=null}function findEase(name){for(var eases=_this.CubicEases,i=eases.length-1;i>-1;i--)if(eases[i].name==name)return eases[i];return!1}this.CubicEases=[],Render.start(updateTweens),this._addMathTween=function(tween){_tweens.push(tween)},this._removeMathTween=function(tween){let i=_tweens.indexOf(tween);i>=0&&(_tweens.splice(i,1),null!==_updateIndex&&i<_updateIndex&&(_updateIndex-=1))},this._getEase=function(name,values){var ease=findEase(name);return!!ease&&(values?ease.path?ease.path.solve:ease.values:ease.curve)},this._inspectEase=function(name){return findEase(name)},this.tween=function(object,props,time,ease,delay,complete,isManual,scaledTime){return"number"!=typeof delay&&(scaledTime=isManual,isManual=complete,complete=delay,delay=0),new MathTween(object,props,time,ease,delay,complete,isManual,scaledTime)},this.clearTween=function(object){if(object._mathTween&&object._mathTween.stop&&object._mathTween.stop(),object._mathTweens){for(var tweens=object._mathTweens,i=0;i<tweens.length;i++){var tw=tweens[i];tw&&tw.tween&&tw.tween.stop&&tw.tween.stop()}object._mathTweens=null}},this.addCustomEase=function(ease){var add=!0;if("object"!=typeof ease||!ease.name||!ease.curve)throw"TweenManager :: addCustomEase requires {name, curve}";for(var i=_this.CubicEases.length-1;i>-1;i--)ease.name==_this.CubicEases[i].name&&(add=!1);if(add){if("m"==ease.curve.charAt(0).toLowerCase()){if(!window.EasingPath)throw"Using custom eases requires easingpath module";ease.path=new EasingPath(ease.curve)}else ease.values=function stringToValues(str){for(var values=str.split("(")[1].slice(0,-1).split(","),i=0;i<values.length;i++)values[i]=parseFloat(values[i]);return values}(ease.curve);_this.CubicEases.push(ease)}return ease},Math.interpolate=function(start,end,alpha,ease){const fn=_this.Interpolation.convertEase(ease);return Math.mix(start,end,"function"==typeof fn?fn(alpha):_this.Interpolation.solve(fn,alpha))},window.tween=this.tween,window.clearTween=this.clearTween},"Static"),TweenManager.Class(function Interpolation(){const _this=this;function calculateBezier(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT}function getSlope(aT,aA1,aA2){return 3*A(aA1,aA2)*aT*aT+2*B(aA1,aA2)*aT+C(aA1)}function A(aA1,aA2){return 1-3*aA2+3*aA1}function B(aA1,aA2){return 3*aA2-6*aA1}function C(aA1){return 3*aA1}this.convertEase=function(ease){var fn=function(){switch(ease){case"easeInQuad":return TweenManager.Interpolation.Quad.In;case"easeInCubic":return TweenManager.Interpolation.Cubic.In;case"easeInQuart":return TweenManager.Interpolation.Quart.In;case"easeInQuint":return TweenManager.Interpolation.Quint.In;case"easeInSine":return TweenManager.Interpolation.Sine.In;case"easeInExpo":return TweenManager.Interpolation.Expo.In;case"easeInCirc":return TweenManager.Interpolation.Circ.In;case"easeInElastic":return TweenManager.Interpolation.Elastic.In;case"easeInBack":return TweenManager.Interpolation.Back.In;case"easeInBounce":return TweenManager.Interpolation.Bounce.In;case"easeOutQuad":return TweenManager.Interpolation.Quad.Out;case"easeOutCubic":return TweenManager.Interpolation.Cubic.Out;case"easeOutQuart":return TweenManager.Interpolation.Quart.Out;case"easeOutQuint":return TweenManager.Interpolation.Quint.Out;case"easeOutSine":return TweenManager.Interpolation.Sine.Out;case"easeOutExpo":return TweenManager.Interpolation.Expo.Out;case"easeOutCirc":return TweenManager.Interpolation.Circ.Out;case"easeOutElastic":return TweenManager.Interpolation.Elastic.Out;case"easeOutBack":return TweenManager.Interpolation.Back.Out;case"easeOutBounce":return TweenManager.Interpolation.Bounce.Out;case"easeInOutQuad":return TweenManager.Interpolation.Quad.InOut;case"easeInOutCubic":return TweenManager.Interpolation.Cubic.InOut;case"easeInOutQuart":return TweenManager.Interpolation.Quart.InOut;case"easeInOutQuint":return TweenManager.Interpolation.Quint.InOut;case"easeInOutSine":return TweenManager.Interpolation.Sine.InOut;case"easeInOutExpo":return TweenManager.Interpolation.Expo.InOut;case"easeInOutCirc":return TweenManager.Interpolation.Circ.InOut;case"easeInOutElastic":return TweenManager.Interpolation.Elastic.InOut;case"easeInOutBack":return TweenManager.Interpolation.Back.InOut;case"easeInOutBounce":return TweenManager.Interpolation.Bounce.InOut;case"linear":return TweenManager.Interpolation.Linear.None}}();if(!fn){var curve=TweenManager._getEase(ease,!0);fn=curve||TweenManager.Interpolation.Cubic.Out}return fn},this.solve=function(values,elapsed){return values[0]==values[1]&&values[2]==values[3]?elapsed:calculateBezier(function getTForX(aX,mX1,mX2){for(var aGuessT=aX,i=0;i<4;i++){var currentSlope=getSlope(aGuessT,mX1,mX2);if(0==currentSlope)return aGuessT;aGuessT-=(calculateBezier(aGuessT,mX1,mX2)-aX)/currentSlope}return aGuessT}(elapsed,values[0],values[2]),values[1],values[3])},this.Linear={None:function(k){return k}},this.Quad={In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){return(k*=2)<1?.5*k*k:-.5*(--k*(k-2)-1)}},this.Cubic={In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k:.5*((k-=2)*k*k+2)}},this.Quart={In:function(k){return k*k*k*k},Out:function(k){return 1- --k*k*k*k},InOut:function(k){return(k*=2)<1?.5*k*k*k*k:-.5*((k-=2)*k*k*k-2)}},this.Quint={In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k*k*k:.5*((k-=2)*k*k*k*k+2)}},this.Sine={In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return.5*(1-Math.cos(Math.PI*k))}},this.Expo={In:function(k){return 0===k?0:Math.pow(1024,k-1)},Out:function(k){return 1===k?1:1-Math.pow(2,-10*k)},InOut:function(k){return 0===k?0:1===k?1:(k*=2)<1?.5*Math.pow(1024,k-1):.5*(2-Math.pow(2,-10*(k-1)))}},this.Circ={In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1- --k*k)},InOut:function(k){return(k*=2)<1?-.5*(Math.sqrt(1-k*k)-1):.5*(Math.sqrt(1-(k-=2)*k)+1)}},this.Elastic={In:function(k,a=1,p=.4){var s;return 0===k?0:1===k?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),-a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))},Out:function(k,a=1,p=.4){var s;return 0===k?0:1===k?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1)},InOut:function(k,a=1,p=.4){var s;return 0===k?0:1===k?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),(k*=2)<1?a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*-.5:a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*.5+1)}},this.Back={In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=2.5949095;return(k*=2)<1?k*k*((s+1)*k-s)*.5:.5*((k-=2)*k*((s+1)*k+s)+2)}},this.Bounce={In:function(k){return 1-_this.Bounce.Out(1-k)},Out:function(k){return k<1/2.75?7.5625*k*k:k<2/2.75?7.5625*(k-=1.5/2.75)*k+.75:k<2.5/2.75?7.5625*(k-=2.25/2.75)*k+.9375:7.5625*(k-=2.625/2.75)*k+.984375},InOut:function(k){return k<.5?.5*_this.Bounce.In(2*k):.5*_this.Bounce.Out(2*k-1)+.5}}},"Static"),Class(function MathTween(_object,_props,_time,_ease,_delay,_callback,_manual,_scaledTime){var _startTime,_startValues,_endValues,_easeFunction,_paused,_newEase,_spring,_damping,_start,_update,_currentTime,_this=this,_elapsed=0;function clear(){if(!_object&&!_props)return!1;_object._mathTween=null,TweenManager._removeMathTween(_this),Utils.nullObject(_this),_object._mathTweens&&_object._mathTweens.remove(_this._tweenWrapper)}_this.object=_object,_this.props=_props,_this.time=_time,_this.ease=_ease,_this.delay=_delay,defer(function(){if(!_this.stopped){if(_this.overrideValues){let values=_this.overrideValues(_this,_object,_props,_time,_ease,_delay);values&&(_this.props=_props=values.props||_props,_this.time=_time=values.time||_time,_this.ease=_ease=values.ease||_ease,_this.delay=_delay=values.delay||_delay)}if(_object&&_props){if(_this.object=_object,"number"!=typeof _time)throw"MathTween Requires object, props, time, ease";!function start(){_object.multiTween||!_object._mathTween||_manual||TweenManager.clearTween(_object);_manual||TweenManager._addMathTween(_this);_this.time=_time,_this.delay=_delay;let propString=function getPropString(){let string="";for(let key in _props)"number"==typeof _props[key]&&(string+=key+" ");return string}();_object._mathTween=_this,_object.multiTween&&(_object._mathTweens||(_object._mathTweens=[]),_object._mathTweens.forEach(t=>{t.props==propString&&t.tween.stop()}),_this._tweenWrapper={props:propString,tween:_this},_object._mathTweens.push(_this._tweenWrapper));_ease||(_ease="linear");"string"==typeof _ease&&(_ease=TweenManager.Interpolation.convertEase(_ease),_easeFunction="function"==typeof _ease);_startTime=_scaledTime?Render.now():performance.now(),_currentTime=_startTime,_startTime+=_delay,_endValues=_props,_startValues={},_props.spring&&(_spring=_props.spring);_props.damping&&(_damping=_props.damping);for(var prop in _this.startValues=_startValues,_endValues)"number"==typeof _object[prop]&&(_startValues[prop]=_object[prop])}()}}}),this.update=function(dt){if(_paused)return;if((_currentTime+=_scaledTime?dt:Render.DT)<_startTime)return;_elapsed=(_elapsed=(_currentTime-_startTime)/_time)>1?1:_elapsed;let delta=this.interpolate(_elapsed);_start&&(_start(delta),_start=null),_update&&_update(delta),1==_elapsed&&(_callback&&_callback(),_this.completePromise&&_this.completePromise.resolve(),clear())},this.pause=function(){_paused=!0},this.resume=function(){_paused=!1},this.stop=function(){return _this.stopped=!0,clear(),null},this.setEase=function(ease){_newEase!=ease&&(_newEase=ease,_ease=TweenManager.Interpolation.convertEase(ease),_easeFunction="function"==typeof _ease)},this.getValues=function(){return{start:_startValues,end:_endValues}},this.interpolate=function(elapsed){var delta=_easeFunction?_ease(elapsed,_spring,_damping):TweenManager.Interpolation.solve(_ease,elapsed);for(var prop in _startValues)if("number"==typeof _startValues[prop]&&"number"==typeof _endValues[prop]){var start=_startValues[prop],end=_endValues[prop];_object[prop]=start+(end-start)*delta}return delta},this.onStart=function(callback){return _start=callback,this},this.onUpdate=function(callback){return _update=callback,this},this.onComplete=function(callback){return _callback=callback,this},this.promise=function(){return _this.completePromise||(_this.completePromise=Promise.create()),_this.completePromise},this.setElapsed=function(elapsed){_startTime=performance.now(),_currentTime=_startTime+_time*elapsed},Object.defineProperty(_this,"scaledTime",{get:()=>_scaledTime,set(scaledTime){if(!!_scaledTime!==(scaledTime=!!scaledTime)&&(_scaledTime=scaledTime,0===_elapsed)){let alreadyDelayed=(_scaledTime?performance.now():Render.now())-_startTime;_startTime=_scaledTime?Render.now():performance.now(),_currentTime=_startTime-=alreadyDelayed,_startTime+=_delay}}})}),Class(function TweenTimeline(){Inherit(this,Component);const _this=this;let _tween,_total=0;const _tweens=[];function calculate(){_tweens.sort(function(a,b){const ta=a.time+a.delay;return b.time+b.delay-ta});const first=_tweens[0];_total=first.time+first.delay}function loop(){let time=_this.elapsed*_total;for(let i=_tweens.length-1;i>-1;i--){let t=_tweens[i],relativeTime=time-t.delay,elapsed=Math.clamp(relativeTime/t.time,0,1);t.interpolate(elapsed)}_this.events.fire(Events.UPDATE,_this,!0)}this.elapsed=0,this.get("timeRemaining",()=>_total-_this.elapsed*_total),this.add=function(object,props,time,ease,delay=0){let tween;return(object instanceof MathTween||object instanceof FrameTween)&&(props=object.props,time=object.time,ease=object.ease,delay=object.delay,object=object.object),tween=object instanceof HydraObject?new FrameTween(object,props,time,ease,delay,null,!0):new MathTween(object,props,time,ease,delay,null,!0),_tweens.push(tween),defer(calculate),tween},this.tween=function(to,time,ease,delay,callback){return _this.clearTween(),_tween=tween(_this,{elapsed:to},time,ease,delay).onUpdate(loop).onComplete(callback),_tween},this.clearTween=function(){_tween&&_tween.stop&&_tween.stop()},this.start=function(){_this.startRender(loop)},this.stop=function(){_this.stopRender(loop)},this.update=function(){loop()},this.seek=function(elapsed){_this.elapsed=elapsed,loop()},this.onDestroy=function(){_this.clearTween(),Render.stop(loop);for(var i=0;i<_tweens.length;i++)_tweens[i].stop()}}),window.ASSETS=["assets/js/lib/HydraExternalLibs.json","assets/js/lib/algolia.RvQFYHDZ.esm.js","assets/js/lib/basis_transcoder.js","assets/js/lib/basis_transcoder.wasm","assets/js/lib/firebase-app.js","assets/js/lib/firebase-auth.js","assets/js/lib/firebase-database.js","assets/js/lib/firebase-storage.js","assets/js/lib/lenis.js","assets/js/lib/lenis.min.js","assets/js/lib/sanity.9fEH06yE.esm.js","assets/js/lib/theatrejs.js","assets/js/lib/xxhash-wasm.js","assets/data/cssError.json","assets/data/timeline-FXSceneSlice_BaracudaB100.json","assets/data/timeline-FXSceneSlice_BarracudaB250.json","assets/data/timeline-FXSceneSlice_BarracudaB500.json","assets/data/timeline-FXSceneSlice_BoltScene.json","assets/data/timeline-FXSceneSlice_CopperheadScene.json","assets/data/timeline-FXSceneSlice_CopperheadScene_m.json","assets/data/timeline-FXSceneSlice_DiveLDScene.json","assets/data/timeline-FXSceneSlice_DiveLDScene_m.json","assets/data/timeline-FXSceneSlice_DiveXLScene.json","assets/data/timeline-FXSceneSlice_DiveXLScene_m.json","assets/data/timeline-FXSceneSlice_FuryScene.json","assets/data/timeline-FXSceneSlice_Ghost.json","assets/data/timeline-FXSceneSlice_GhostScene.json","assets/data/timeline-FXSceneSlice_MenaceIScene.json","assets/data/timeline-FXSceneSlice_MenaceIScene_m.json","assets/data/timeline-FXSceneSlice_MenaceTScene.json","assets/data/timeline-FXSceneSlice_MenaceTScene_m.json","assets/data/timeline-FXSceneSlice_MenaceXScene.json","assets/data/timeline-FXSceneSlice_MenaceXScene_m.json","assets/data/timeline-FXSceneSlice_MenaceZScene.json","assets/data/timeline-FXSceneSlice_MenaceZScene_m.json","assets/data/timeline-FXSceneSlice_PulsarScene.json","assets/data/timeline-FXSceneSlice_RoadrunnerScene.json","assets/data/timeline-FXSceneSlice_SentryScene.json","assets/data/timeline-FXSceneSlice_SentryScene_m.json","assets/data/timeline-SpiralGraph.json","assets/data/uil.json","assets/shaders/compiled.vs"],ASSETS.SW=["assets/fonts/Elios-Regular.woff","assets/fonts/Elios-Regular.woff2","assets/fonts/HelveticaNowDisplay-Black.woff","assets/fonts/HelveticaNowDisplay-Black.woff2","assets/fonts/HelveticaNowDisplay-Bold.woff","assets/fonts/HelveticaNowDisplay-Bold.woff2","assets/fonts/HelveticaNowDisplay-ExtBlk.woff","assets/fonts/HelveticaNowDisplay-ExtBlk.woff2","assets/fonts/HelveticaNowDisplay-ExtLt.woff","assets/fonts/HelveticaNowDisplay-ExtLt.woff2","assets/fonts/HelveticaNowDisplay-ExtraBold.woff","assets/fonts/HelveticaNowDisplay-ExtraBold.woff2","assets/fonts/HelveticaNowDisplay-Hairline.woff","assets/fonts/HelveticaNowDisplay-Hairline.woff2","assets/fonts/HelveticaNowDisplay-Light.woff","assets/fonts/HelveticaNowDisplay-Light.woff2","assets/fonts/HelveticaNowDisplay-Medium.woff","assets/fonts/HelveticaNowDisplay-Medium.woff2","assets/fonts/HelveticaNowDisplay-Regular.json","assets/fonts/HelveticaNowDisplay-Regular.png","assets/fonts/HelveticaNowDisplay-Regular.woff","assets/fonts/HelveticaNowDisplay-Regular.woff2","assets/fonts/HelveticaNowDisplay-Thin.woff","assets/fonts/HelveticaNowDisplay-Thin.woff2","assets/js/app.js"],Class(function Config(){Inherit(this,Model);const _this=this;function getPathHook(path,getPath){return _this.ASSETS_MANIFEST[getPath(path)]}Object.assign(_this,window._CONFIG_),"ENV"in _this||(_this.ENV=Hydra.LOCAL?"development":"production"),"DEV"in _this||(_this.DEV=Hydra.LOCAL||"local"===_this.ENV||"development"===_this.ENV),"PROD"in _this||(_this.PROD="production"===_this.ENV),_this.CONTENT_URL||(_this.CONTENT_URL=location.origin),_this.SANITY_STUDIO_URL||(_this.SANITY_STUDIO_URL="https://anduril.sanity.studio"),_this.ASSETS_MANIFEST||(_this.ASSETS_MANIFEST={}),Assets.registerGetPathHook(getPathHook),Service.disabled=!0,_this.dataReady=!0},"static"),Module(function Product3DNodeConfig(){this.exports={getConfig:function getConfig(index,sceneName){try{if(Stage.width>Stage.height){let focus=function getFocus(index,sceneName){switch(sceneName){case"DiveXLScene":return[.11,.4,.6,.8][index];case"DiveLDScene":return[.11,.55,.8][index];case"CopperheadScene":return[.11,.11,.5,.7][index];case"MenaceIScene":return[.55,.4,.8][index];case"SentryScene":return[.2,.38,.52,.75][index];case"MenaceTScene":return[.4,.6,.8][index];case"MenaceXScene":return[.3,.5,.5][index];case"FuryScene":return[.41,.2,.2,.71,.71][index];case"BoltScene":return[.15,.45,.75,.75][index];case"BaracudaB100":case"BarracudaB250":return[.2,.2,.4,.8][index];case"BarracudaB500":return[.2,.8,.2,.4][index];case"Ghost":return[.21,.4,.7,.92][index];case"RoadrunnerScene":return[.2,.45,.75,.75][index];case"PulsarScene":return[.175,.45,.75,.175][index];case"EagleEyeScene":return[.2,.2,.45,.45,.72,.72][index];default:return-1}}(index,sceneName),angles=function getAngles(index,sceneName){switch(sceneName){case"DiveXLScene":return[[[-37,40],190,-35,-170][index]];case"DiveLDScene":return[[135,[-55,20],-160][index]];case"CopperheadScene":return[[-40,160,-160,130][index]];case"MenaceIScene":return[[-40,160,120][index]];case"SentryScene":return[[-50,-40,130,140][index]];case"MenaceTScene":return[[-140,160,-130][index]];case"MenaceXScene":return[[-20,-30,150][index]];case"FuryScene":return[[-20,-30,-140,-30,140][index]];case"BoltScene":return[[-30,-145,145,-140][index]];case"BaracudaB100":case"BarracudaB250":return[[-30,-160,-150,-150][index]];case"BarracudaB500":return[[-30,-70,150,-150][index]];case"Ghost":return[[-120,-160,115,160][index]];case"RoadrunnerScene":return[[-50,135,120,165][index]];case"PulsarScene":return[[45,140,30,-55][index]];case"EagleEyeScene":return[[-120,-70,20,-80,-80,-120][index]];default:return[0]}}(index,sceneName),distances=function getDistances(index,sceneName){switch(sceneName){case"DiveXLScene":return[[[17,17],10,20,12][index]];case"DiveLDScene":return[[10,[10,25],15][index]];case"CopperheadScene":return[[10,10,10,10][index]];case"MenaceIScene":return[[10,10,25][index]];case"SentryScene":return[[18,14,10,15][index]];case"MenaceTScene":return[[10,10,10][index]];case"MenaceXScene":return[[5,10,15][index]];case"FuryScene":return[[10,10,15,10,10][index]];case"BoltScene":return[[15,12,18,12][index]];case"BaracudaB100":case"BarracudaB250":return[[15,15,20,25][index]];case"BarracudaB500":return[[15,20,15,15][index]];case"Ghost":return[[12,18,12,12][index]];case"RoadrunnerScene":return[[14,16,16,8][index]];case"PulsarScene":return[[12,20,8,10][index]];case"EagleEyeScene":return[[10,10,10,10,10,10][index]];default:return[0]}}(index,sceneName),{x:x,y:y}=function getPosition(index,sceneName){switch(sceneName){case"DiveXLScene":return[{x:"53.5%",y:"29%"},{x:"45%",y:"70%"},{x:"40%",y:"35%"},{x:"65%",y:"75%"}][index];case"DiveLDScene":return[{x:"60%",y:"65%"},{x:"51%",y:"29%"},{x:"43%",y:"72%"}][index];case"CopperheadScene":return[{x:"40%",y:"33%"},{x:"50%",y:"72%"},{x:"50%",y:"75%"},{x:"55%",y:"70%"}][index];case"MenaceIScene":return[{x:"40%",y:"30%"},{x:"45%",y:"72%"},{x:"72%",y:"70%"}][index];case"SentryScene":return[{x:"58%",y:"25%"},{x:"32%",y:"42%"},{x:"55%",y:"75%"},{x:"60%",y:"60%"}][index];case"MenaceTScene":return[{x:"35%",y:"72%"},{x:"55%",y:"78%"},{x:"35%",y:"72%"}][index];case"MenaceXScene":return[{x:"52%",y:"28%"},{x:"35%",y:"35%"},{x:"55%",y:"75%"}][index];case"FuryScene":return[{x:"40%",y:"40%"},{x:"40%",y:"35%"},{x:"53%",y:"68%"},{x:"45%",y:"30%"},{x:"50%",y:"70%"}][index];case"BoltScene":return[{x:"43%",y:"25%"},{x:"40%",y:"70%"},{x:"70%",y:"65%"},{x:"50%",y:"75%"}][index];case"BaracudaB100":return[{x:"40%",y:"25%"},{x:"55%",y:"80%"},{x:"40%",y:"80%"},{x:"50%",y:"80%"}][index];case"BarracudaB250":return[{x:"45%",y:"25%"},{x:"55%",y:"78%"},{x:"40%",y:"80%"},{x:"50%",y:"80%"}][index];case"BarracudaB500":return[{x:"45%",y:"25%"},{x:"45%",y:"40%"},{x:"60%",y:"75%"},{x:"40%",y:"80%"}][index];case"Ghost":return[{x:"34%",y:"65%"},{x:"45%",y:"75%"},{x:"65%",y:"55%"},{x:"55%",y:"70%"}][index];case"RoadrunnerScene":return[{x:"38%",y:"35%"},{x:"60%",y:"75%"},{x:"65%",y:"45%"},{x:"52%",y:"80%"}][index];case"PulsarScene":return[{x:"63%",y:"30%"},{x:"62%",y:"65%"},{x:"60%",y:"40%"},{x:"38%",y:"25%"}][index];case"EagleEyeScene":return[{x:"35%",y:"60%"},{x:"30%",y:"37%"},{x:"60%",y:"30%"},{x:"27%",y:"50%"},{x:"30%",y:"40%"},{x:"35%",y:"60%"}][index]}}(index,sceneName),direction=function getDirection(index,sceneName){switch(sceneName){case"DiveXLScene":case"BoltScene":case"BaracudaB100":case"BarracudaB250":case"BarracudaB500":case"Ghost":case"RoadrunnerScene":case"PulsarScene":return index%2==0?"left":"right";default:return"left"}}(index,sceneName),origin=function getOrigin(index,sceneName){if("FuryScene"===sceneName)return["bottom left","top right","bottom center","bottom right","top center"][index];return"center center"}(index,sceneName),offsets=function getLineOffset(index,sceneName){if("DiveXLScene"===sceneName)return 0===index?[{offsetX:"-43%",offsetY:"9%"},{offsetX:"30%",offsetY:"12%"}]:[{offsetX:0,offsetY:0},{offsetX:0,offsetY:0}];return[{offsetX:0,offsetY:0},{offsetX:0,offsetY:0}]}(index,sceneName);return"object"==typeof angles[0]&&(angles=[...angles[0]]),"object"==typeof distances[0]&&(distances=[...distances[0]]),{focus:focus,angles:angles,distances:distances,x:x,y:y,direction:direction,origin:origin,offsets:offsets}}let focus=function getFocusMobile(index,sceneName){switch(sceneName){case"DiveXLScene":return[.11,.4,.6,.8][index];case"DiveLDScene":return[.11,.55,.8][index];case"CopperheadScene":return[.11,.11,.5,.7][index];case"MenaceIScene":return[.55,.4,.8][index];case"SentryScene":return[.2,.38,.52,.75][index];case"MenaceTScene":return[.4,.6,.8][index];case"MenaceXScene":return[.3,.5,.5][index];case"FuryScene":return[.41,.2,.2,.71,.71][index];case"BoltScene":return[.15,.45,.75,.75][index];case"BaracudaB100":case"BarracudaB250":return[.2,.2,.4,.8][index];case"BarracudaB500":return[.2,.8,.2,.4][index];case"Ghost":return[.21,.4,.72,.92][index];case"RoadrunnerScene":return[.2,.45,.75,.75][index];case"PulsarScene":return[.175,.45,.75,.175][index];case"EagleEyeScene":return[.2,.2,.45,.45,.72,.72][index];default:return-1}}(index,sceneName),angles=function getAnglesMobile(index,sceneName){switch(sceneName){case"DiveXLScene":return[[[-30,30],190,-25,-170][index]];case"DiveLDScene":return[[180,[-55,20],-160][index]];case"CopperheadScene":return[[40,160,-160,160][index]];case"MenaceIScene":return[[-40,160,210][index]];case"SentryScene":return[[-60,14,170,195][index]];case"MenaceTScene":return[[-25,200,200][index]];case"MenaceXScene":return[[-40,-30,150][index]];case"FuryScene":return[[20,10,-150,20,150][index]];case"BoltScene":return[[-10,-160,-15,-160][index]];case"BaracudaB100":case"BarracudaB250":return[[-30,-160,-150,-150][index]];case"BarracudaB500":return[[-20,-30,170,-170][index]];case"Ghost":return[[-165,-15,175,165][index]];case"RoadrunnerScene":return[[-5,145,-17,165][index]];case"PulsarScene":return[[-185,170,-170,-18][index]];case"EagleEyeScene":return[[-190,10,20,-170,10,160][index]];default:return[0]}}(index,sceneName),distances=function getDistancesMobile(index,sceneName){switch(sceneName){case"DiveXLScene":return[[[14,14],25,37,12][index]];case"DiveLDScene":return[[25,[12,28],25][index]];case"CopperheadScene":return[[25,21,20,20][index]];case"MenaceIScene":return[[10,10,30][index]];case"SentryScene":return[[40,44,20,30][index]];case"MenaceTScene":return[[30,20,10][index]];case"MenaceXScene":return[[18,20,15][index]];case"FuryScene":return[[35,30,45,25,25][index]];case"BoltScene":return[[25,20,45,30][index]];case"BaracudaB100":case"BarracudaB250":return[[25,25,20,30][index]];case"BarracudaB500":return[[30,35,25,35][index]];case"Ghost":return[[28,32,38,30][index]];case"RoadrunnerScene":return[[25,34,20,15][index]];case"PulsarScene":return[[45,45,25,18][index]];case"EagleEyeScene":return[[25,25,25,25,25,25][index]];default:return[0]}}(index,sceneName),{x:x,y:y}=function getPositionMobile(index,sceneName){switch(sceneName){case"DiveXLScene":return[{x:"55%",y:"26%"},{x:"42%",y:"85%"},{x:"39%",y:"15%"},{x:"65%",y:"72%"}][index];case"DiveLDScene":return[{x:"52%",y:"88%"},{x:"53%",y:"27%"},{x:"44%",y:"82%"}][index];case"CopperheadScene":return[{x:"60%",y:"22%"},{x:"42%",y:"82%"},{x:"50%",y:"85%"},{x:"55%",y:"85%"}][index];case"MenaceIScene":return[{x:"36%",y:"30%"},{x:"46%",y:"86%"},{x:"40%",y:"80%"}][index];case"SentryScene":return[{x:"45%",y:"16%"},{x:"50%",y:"12%"},{x:"50%",y:"95%"},{x:"40%",y:"80%"}][index];case"MenaceTScene":return[{x:"32%",y:"25%"},{x:"55%",y:"70%"},{x:"45%",y:"80%"}][index];case"MenaceXScene":return[{x:"41%",y:"18%"},{x:"35%",y:"24%"},{x:"58%",y:"75%"}][index];case"FuryScene":return[{x:"50%",y:"18%"},{x:"55%",y:"18%"},{x:"50%",y:"90%"},{x:"55%",y:"20%"},{x:"50%",y:"90%"}][index];case"BoltScene":return[{x:"47%",y:"12%"},{x:"42%",y:"80%"},{x:"50%",y:"-8%"},{x:"50%",y:"96%"}][index];case"BaracudaB100":case"BarracudaB250":return[{x:"45%",y:"10%"},{x:"55%",y:"90%"},{x:"50%",y:"90%"},{x:"50%",y:"90%"}][index];case"BarracudaB500":return[{x:"50%",y:"5%"},{x:"50%",y:"10%"},{x:"50%",y:"95%"},{x:"50%",y:"100%"}][index];case"Ghost":return[{x:"45%",y:"98%"},{x:"45%",y:"20%"},{x:"55%",y:"95%"},{x:"55%",y:"90%"}][index];case"RoadrunnerScene":return[{x:"48%",y:"0%"},{x:"60%",y:"90%"},{x:"45%",y:"5%"},{x:"52%",y:"90%"}][index];case"PulsarScene":return[{x:"45%",y:"100%"},{x:"50%",y:"95%"},{x:"50%",y:"95%"},{x:"45%",y:"10%"}][index];case"EagleEyeScene":return[{x:"50%",y:"86%"},{x:"48%",y:"8%"},{x:"62%",y:"10%"},{x:"45%",y:"88%"},{x:"50%",y:"10%"},{x:"58%",y:"85%"}][index]}}(index,sceneName),direction=function getDirectionMobile(index,sceneName){switch(sceneName){case"DiveXLScene":case"BaracudaB100":case"BarracudaB250":case"BarracudaB500":case"Ghost":case"RoadrunnerScene":case"PulsarScene":return index%2==0?"left":"right";default:return"left"}}(index,sceneName),origin=function getOriginMobile(index,sceneName){switch(sceneName){case"DiveXLScene":return["bottom center","top left","bottom left","top right"][index];case"DiveLDScene":return["top center","bottom center","top center"][index];case"CopperheadScene":return["bottom left","top right","top right","top left"][index];case"MenaceIScene":return["bottom left","top left","top left"][index];case"SentryScene":return["bottom left","bottom center","top left","top left"][index];case"MenaceTScene":return["bottom left","top center","top left"][index];case"MenaceXScene":return["bottom left","bottom left","top center"][index];case"FuryScene":return["bottom center","bottom center","top center","bottom center","top center"][index];case"BoltScene":return["bottom center","top left","top left","top right"][index];default:return"center center"}}(index,sceneName),offsets=[{offsetX:0,offsetY:0},{offsetX:0,offsetY:0}];return"object"==typeof angles[0]&&(angles=[...angles[0]]),"object"==typeof distances[0]&&(distances=[...distances[0]]),{focus:focus,angles:angles,distances:distances,x:x,y:y,direction:direction,origin:origin,offsets:offsets}}catch(error){return console.warn("no config found for node",index,"in",sceneName,error),{focus:-1,angles:[0],distances:[0],x:{x:"50%",y:"50%"},y:{x:"50%",y:"50%"},direction:"left"}}}}}),Class(function Antimatter(_num,_config,_renderer=World.RENDERER,_pointData=null){Inherit(this,AntimatterFBO);var _geometry,_this=this,_drawLimit=_num,_size=function findSize(){return _config.pot?Math.pow(2,Math.ceil(Math.log(Math.sqrt(_num))/Math.log(2))):Math.ceil(Math.sqrt(_num))}();async function createBuffer(){let{geometry:geometry,vertices:vertices,attribs:attribs,usedDepth:usedDepth,key:key}=await AntimatterUtil.createBufferArray(_size,_num,_config,_pointData);_this.key=key,_this.vertices=_this.cloneVertices?vertices.clone():vertices,(_geometry=geometry.clone(!0)).drawRange.end=_drawLimit,_this.vertices.geometry=_geometry,_this.attribs=_this.random=attribs,_this.textureUsedDepth=usedDepth,_this.init(_geometry,_renderer,_size)}defer(createBuffer),this.createFloatArray=function(components=3){return new Float32Array(_size*_size*components)},this.createFloatArrayAsync=async function(components=3,freshCopy){let{array:array}=await AntimatterUtil.createFloatArray(_size*_size*components,freshCopy);return array},this.ready=function(callback){return _this.wait(_this,"vertices")},this.useShader=function(vs,fs,params){"object"==typeof fs&&(params=fs,fs=null),this.vertexShader=vs,this.fragmentShader=fs||vs,this.uniforms=params},this.createMesh=this.getMesh=function(){let shader=_this.createShader(_this.fragmentShader||"AntimatterBasicFrag");return _this.mesh=new Points(_geometry,shader),_this.mesh.frustumCulled=!1,_this.shader=shader,_this.geometry=_geometry,_this.mesh},this.createShader=function(fs){let uniforms=_this.uniforms||{};const nuke=function findNuke(){let p=_this.parent;for(;p;){if(p.nuke)return p.nuke;p=p.parent}for(p=_this.parent;p;){if(p.nuke)return p.nuke;p=p.group?p.group._parent:p.parent||p._parent}return World.NUKE}();_this._nuke=nuke;let obj={tPos:{type:"t",value:_this.vertices.texture,ignoreUIL:!0},tPrevPos:{type:"t",value:_this.vertices.texture,ignoreUIL:!0},uDPR:{value:nuke?.dpr||1,ignoreUIL:!0}};for(let key in uniforms)obj[key]=uniforms[key];let shader=new Shader(_this.vertexShader||"AntimatterPosition",fs,obj),vs=shader.vertexShader;if(vs&&!vs.includes("uniform sampler2D tPos")){let split=vs.split("__ACTIVE_THEORY_LIGHTS__"),defined="uniform sampler2D tPos;";shader.vertexShader=split[0]+"\n"+defined+"\n__ACTIVE_THEORY_LIGHTS__\n"+split[1]}return shader._parentnuke=nuke,shader},this.getLookupArray=function(){return new Float32Array(_this.vertices.geometry.attributes.position.array)},this.getRandomArray=function(){return _geometry.attributes.random.array},this.overrideShader=function(original){let shader=original.clone();shader._parentnuke=_this._nuke,original.copyUniformsTo(shader),shader.uniforms.tPos={type:"t",value:_this.vertices.texture,ignoreUIL:!0},shader.uniforms.tPrevPos={type:"t",value:_this.vertices.texture,ignoreUIL:!0},shader.uniforms.uDPR={value:shader?._parentnuke?.dpr||1,ignoreUIL:!0},_this.shader=shader,_this.mesh.shader=shader},this.upload=async function(needsMesh){if(_this.preventRender=!0,_geometry.distributeBufferData=!0,await _this.ready(),_this.vertices?.destroy&&(await _this.vertices.uploadAsync(),await defer(),_this.random?.destroy&&(await _this.random.uploadAsync(),await defer(),_this.mesh&&needsMesh&&(_this.mesh.upload(),await _geometry.uploadBuffersAsync()),_this.destroy))){for(let key in _this.shader.uniforms){let uniform=_this.shader.uniforms[key];uniform.value&&(uniform.value.uploadAsync?await uniform.value.uploadAsync():uniform.value.upload&&(uniform.value.upload(),await defer()))}await _this.wait(100);for(let i=0;i<_this.passes.length;i++)await _this.passes[i].upload();_this.preventRender=!1}},this.uploadSync=async function(needsMesh){await _this.ready(),_this.customClass&&_this.customClass.loaded&&await _this.customClass.loaded();for(let i=0;i<4;i++)_this.update()},this.get("particleCount",_=>_num),this.get("textureSize",_=>_size),this.get("powerOf2",_=>Math.pow(2,Math.ceil(Math.log(Math.sqrt(_num))/Math.log(2))))}),Class(function AntimatterAttribute(_data,_components){Inherit(this,Component);var _this=this,_size=Math.sqrt(_data.length/(_components||3));this.size=_size,this.count=_size*_size,this.buffer=_data,this.texture=new DataTexture(_data,_size,_size,4==_components?Texture.RGBAFormat:Texture.RGBFormat,Texture.FLOAT),this.set("needsUpdate",function(){_this.texture&&(_this.texture.needsUpdate=!0)}),this.bufferData=function(data,components){_this.buffer=data,components!=_components?(_this.texture.destroy(),_this.texture=new DataTexture(data,_size,_size,4==components?Texture.RGBAFormat:Texture.RGBFormat,Texture.FLOAT)):(_this.texture.data=data,_this.texture.needsUpdate=!0),_components=components,_data=data},this.upload=function(){_this.texture.upload()},this.uploadAsync=function(){return _this.texture.distributeTextureData=!0,_this.texture.upload(),_this.texture.uploadAsync()},this.clone=function(){return new AntimatterAttribute(_data,_components)},this.onDestroy=function(){_this.texture&&_this.texture.destroy&&_this.texture.destroy()}}),Class(function AntimatterFBO(){var _this,_gpuGeom,_renderer,_size,_prevRT,_scene,_mesh,_camera,_copy,_geometry;Inherit(this,Component);var _output={type:"t",value:null,ignoreUIL:!0},_prevOutput={type:"t",value:null,ignoreUIL:!0};function copy(input,output){World.RENDERER.blit(input,output)||(_copy.visible=!0,_mesh.visible=!1,_copy.shader.uniforms.tMap.value=input,_renderer.renderSingle(_copy,_camera,output),_copy.visible=!1,_mesh.visible=!0)}this.passes=[],this.init=function(geometry,renderer,size){_this=this,_gpuGeom=geometry.attributes.position.array,_renderer=renderer,_size=size,function initPasses(){_camera=World.CAMERA,_geometry=World.QUAD,_scene=new Scene,(_mesh=new Mesh(_geometry,null)).frustumCulled=!1,_mesh.noMatrices=!0,_mesh.transient=!0,_scene.add(_mesh);let copyShader=AntimatterFBO.getCopyShader();(_copy=new Mesh(_geometry,copyShader)).noMatrices=!0,_scene.add(_copy),_copy.visible=!1}()},this.getGPUGeom=function(){return _gpuGeom},this.addPass=function(pass,index){_this=this,pass.init||pass.initialize(_size),"number"!=typeof index?_this.passes.push(pass):_this.passes.splice(index,0,pass)},this.findPass=function(name){_this=this;for(var i=0;i<_this.passes.length;i++){var pass=_this.passes[i];if(pass.name==name)return pass}},this.removePass=function(pass){_this=this,"number"==typeof pass?_this.passes.splice(pass):_this.passes.remove(pass)},this.update=function(){if((_this=this).mesh&&!_this.preventRender){var output=_output.value||_this.vertices.texture;_this.storeVelocity&&(_prevRT?(copy(_output.value,_prevRT),_prevOutput.value=_prevRT):(_prevOutput.value=output,(_prevRT=_this.passes[0].getRT(0).clone()).upload()));for(var i=0;i<_this.passes.length;i++){var pass=_this.passes[i],needsInit=!pass.init,firstRender=!pass.first;needsInit&&pass.initialize(_size),pass.first=!0,_mesh.shader=pass.shader,_mesh.shader.uniforms.tInput.value=firstRender?_this.vertices.texture:pass.output,pass.ready||(_mesh.shader.uniforms.tInput.value=_this.vertices.texture);var rt=firstRender?pass.getRT(0):pass.getWrite();output=pass.output;_renderer.renderSingle(_scene.children[0],_camera,rt),copy(rt,output),pass.swap()}output&&(_output.value=output,_this.mesh.shader.uniforms.tPos.value=_output.value,_this.mesh.shader.uniforms.tPrevPos.value=_prevOutput.value,_this.mesh.shader.uniforms.uDPR.value=_this.mesh?.shader?._parentnuke?.dpr||1)}},this.onDestroy=function(){_this.vertices&&_this.vertices.destroy&&_this.vertices.destroy(),_this.attribs&&_this.attribs.destroy&&_this.attribs.destroy(),AntimatterUtil.clearCacheEntry(_this.key),_this.passes.forEach(function(pass){pass.first=!1,_this.persistPasses||pass&&pass.destroy&&pass.destroy()}),_this.mesh.destroy(),_copy.shader.mesh=null,_copy.shader=null,_scene.destroy()},this.getOutput=function(){return _output},this.getPrevOutput=function(){return _prevOutput}},function(){var _shader;AntimatterFBO.getCopyShader=function(){return _shader||((_shader=new Shader("ScreenQuad")).addUniforms({tMap:{type:"t",value:null}}),_shader._attachmentData={format:Texture.RGBAFormat,type:Texture.FLOAT,attachments:1}),_shader}}),Class(function AntimatterPass(_shader,_uni,_clone){Inherit(this,Component);var _this=this;this.UILPrefix="am_"+_shader;const _uniforms={tInput:{type:"t",value:null,ignoreUIL:!0},fSize:{type:"f",value:64,ignoreUIL:!0}};var _rts=[],_read=0,_write=0;function prepareShader(code,type){if("vs"==type)return code;let header=["uniform sampler2D tInput;","uniform float fSize;","varying vec2 vUv;",Shaders.getShader("antimatter.glsl")].join("\n"),mainAt=code.indexOf("void main()"),before=code.slice(0,mainAt),after=code.slice(mainAt);return code=before+header+after,_this.onCreateShader&&(code=_this.onCreateShader(code)),code}function initRT(size){var type="ios"==Device.system.os&&Renderer.type==Render.WEBGL1?Texture.HALF_FLOAT:Texture.FLOAT,parameters={minFilter:Texture.NEAREST,magFilter:Texture.NEAREST,format:Texture.RGBAFormat,type:type},rt=new RenderTarget(size,size,parameters);return rt.texture.generateMipmaps=!1,rt}this.uniforms=_uniforms,this.output=initRT(64),this.name=_shader,this.id=Utils.timestamp(),this.ready=!1,function(){if(_uni)for(var key in _uni.unique&&(_this.UILPrefix+="_"+_uni.unique.replace("/","_"),delete _uni.unique),_uni.customCompile&&(_this.customCompile=_uni.customCompile||"",delete _uni.customCompile),_uni)_uniforms[key]=_uni[key]}(),this.addInput=function(name,attribute){var uniform="object"!=typeof attribute||attribute.height||"string"!=typeof attribute.type?attribute instanceof AntimatterAttribute?{type:"t",value:attribute.texture,ignoreUIL:!0}:attribute instanceof AntimatterPass?{type:"t",value:attribute.output,ignoreUIL:!0}:{type:"t",value:attribute,ignoreUIL:!0}:attribute;let lookup=UILStorage.parse(_this.UILPrefix+name);lookup&&(uniform.value=lookup.value);let uniforms=_shader&&_shader.uniforms?_shader.uniforms:_uniforms;return uniforms[name]=uniform,uniform.ignoreUIL=!0,uniforms[name]},this.addUniforms=function(object){let uniforms=_shader&&_shader.uniforms?_shader.uniforms:_uniforms;for(let key in object){let uniform=object[key],lookup=UILStorage.parse(_this.UILPrefix+key);if(lookup){if(Array.isArray(lookup.value))switch(lookup.value.length){case 2:lookup.value=(new Vector2).fromArray(lookup.value);break;case 3:lookup.value=(new Vector3).fromArray(lookup.value);break;case 4:lookup.value=(new Vector4).fromArray(lookup.value)}uniform.value=lookup.value}uniforms[key]=uniform}},this.getRT=function(index){return _rts[index]},this.getRead=function(){return _rts[_read]},this.getWrite=function(){return _rts[_write]},this.setRead=function(index){_read=index},this.setWrite=function(index){_write=index},this.swap=function(){++_write>2&&(_write=0,_this.ready=!0),++_read>2&&(_this.onInit&&(_this.onInit(),_this.onInit=null),_read=0)},this.initialize=function(size){if(!_this.init){_this.init=!0;for(var i=0;i<3;i++)_rts.push(initRT(size));_this.output.setSize(size,size),_shader instanceof Shader||((_shader=_this.initClass(Shader,"AntimatterPass",_shader,{customCompile:_this.customCompile}))._attachmentData={format:Texture.RGBAFormat,type:Texture.FLOAT,attachments:1},_shader.preCompile=prepareShader,_shader.addUniforms(_uniforms),_this.uniforms=_shader.uniforms,_shader.UILPrefix=_this.UILPrefix,_shader.id=Utils.timestamp()),_this.shader=_shader,_shader.uniforms.fSize.value=size}},this.setUniform=function(key,value){_uniforms[key]||(_uniforms[key]={value:value}),_uniforms[key].value=value,_shader&&_shader.uniforms&&(_shader.uniforms[key].value=value)},this.getUniform=function(key){return _shader&&_shader.uniforms?_shader.uniforms[key].value:null},this.tween=function(key,value,time,ease,delay,callback,update){return tween(_shader.uniforms[key],{value:value},time,ease,delay,callback,update)},this.clone=function(){return new AntimatterPass(_shader,_uni)},this.onDestroy=function(){_rts.forEach(function(rt){rt&&rt.destroy&&rt.destroy()})},this.upload=async function(){_shader.upload(),await defer();for(let i=0;i<_rts.length;i++)_rts[i].upload(),await defer();for(let key in _shader.uniforms){let uniform=_shader.uniforms[key];uniform.value&&(uniform.value.uploadAsync?await uniform.value.uploadAsync():uniform.value.upload&&(uniform.value.upload(),await defer()))}}}),Class(function AntimatterSpawn(_proton,_group,_input){Inherit(this,Component);const _this=this;var _life,_pass,_velocity,_color,_index=-1,_total=_proton.particleCount,_releasedA=[],_releasedB=[],_temp0=[],_temp1=[],_temp2=[],_vec=new Vector3;function loop(){let count=_releasedA.length;for(let i=count-1;i>-1;i--){let index=_releasedA[i];_life.buffer[4*index+0]=0}_releasedA.length=0,count&&(_life.needsUpdate=!0);let hold=_releasedA;_releasedA=_releasedB,_releasedB=hold}!async function(){await async function initPass(){let[lifeBuffer,velocityBuffer]=await Promise.all([_proton.antimatter.createFloatArrayAsync(4,!0),_proton.antimatter.createFloatArrayAsync(3,!0)]);_life=_this.initClass(AntimatterAttribute,lifeBuffer,4),_velocity=_this.initClass(AntimatterAttribute,velocityBuffer,3),_pass=_this.initClass(AntimatterPass,"AntimatterSpawn",{unique:_input.prefix,uMaxCount:_proton.behavior.uniforms.uMaxCount,tAttribs:_proton.behavior.uniforms.tAttribs,tLife:{value:_life,ignoreUIL:!0},uSetup:{value:1,ignoreUIL:!0},decay:{value:1},HZ:{value:Render.HZ_MULTIPLIER,ignoreUIL:!0},decayRandom:{value:new Vector2(1,1)}}),ShaderUIL.add(_pass,_group).setLabel("Life Shader"),_pass.onInit=_=>{_pass.setUniform("uSetup",0),_this.canEmit=!0},_proton.behavior.addInput("tSpawn",_pass),_proton.behavior.addInput("tVelocity",_velocity),_proton.shader.addUniforms({tLife:{value:_pass.output}}),_proton.antimatter.addPass(_pass,0),_this.lifeOutput=_pass.output}(),_this.startRender(loop)}(),this.emit=function(position,velocity,color){if(!_this.canEmit)return;if(velocity&&position.length!=velocity.length)throw"Position and velocity need to be the same length";if(color&&position.length!=color.length)throw"Position and color need to be the same length";let count=position.length/3;for(let i=0;i<count;i++){let index=++_index;_index>=_total&&(_index=-1),_life.buffer[4*index+0]=1,_life.buffer[4*index+1]=position[3*i+0],_life.buffer[4*index+2]=position[3*i+1],_life.buffer[4*index+3]=position[3*i+2],velocity&&(_velocity.buffer[3*index+0]=velocity[3*i+0],_velocity.buffer[3*index+1]=velocity[3*i+1],_velocity.buffer[3*index+2]=velocity[3*i+2]),color&&_color&&(_color.buffer[3*index+0]=color[3*i+0],_color.buffer[3*index+1]=color[3*i+1],_color.buffer[3*index+2]=color[3*i+2]),_releasedB.push(index)}_life.needsUpdate=!0,velocity&&(_velocity.needsUpdate=!0),color&&_color&&(_color.needsUpdate=!0)},this.release=function(pos,count=1,radius=0,velocity,color){if(!_this.canEmit)return;let positions=_temp0,velocities=velocity?_temp1:null,colors=color?_temp2:null,radX=Array.isArray(radius)?radius[0]:radius,radY=Array.isArray(radius)?radius[1]:radius,radZ=Array.isArray(radius)?radius[2]:radius;for(let i=0;i<count;i++)pos.spherical?(_vec.set(Math.random(-1,1,4),Math.random(-1,1,4),Math.random(-1,1,4)).normalize().multiplyScalar(radX),positions[3*i+0]=pos.x+_vec.x,positions[3*i+1]=pos.y+_vec.y,positions[3*i+2]=pos.z+_vec.z):(positions[3*i+0]=pos.x+Math.random(-1,1,4)*radX,positions[3*i+1]=pos.y+Math.random(-1,1,4)*radY,positions[3*i+2]=pos.z+Math.random(-1,1,4)*radZ),velocities&&(velocities[3*i+0]=velocity.x,velocities[3*i+1]=velocity.y,velocities[3*i+2]=velocity.z),colors&&(colors[3*i+0]=color.r,colors[3*i+1]=color.g,colors[3*i+2]=color.b);_this.emit(positions,velocities,colors),_temp0.length=0,_temp1.length=0,_temp2.length=0},this.upload=async function(){await(_life?.uploadAsync()),await(_velocity?.uploadAsync())},this.useColor=async function(shader){let colorBuffer=await _proton.antimatter.createFloatArrayAsync(3,!0);_color=_this.initClass(AntimatterAttribute,colorBuffer,3),shader||(shader=_proton.shader),shader.addUniforms({tColor:{value:_color}}),_proton.behavior.addInput("tColor",_color)},this.applyToShader=function(shader){shader.uniforms.tLife=_proton.shader.uniforms.tLife,_velocity&&(shader.uniforms.tVelocity={value:_velocity}),_color&&(shader.uniforms.tColor={value:_color})},this.ready=function(){return this.wait("canEmit")},this.get("total",_=>_total),this.get("index",_=>_index),this.set("index",i=>_index=i)}),Class(function AntimatterUtil(){Inherit(this,Component);var _thread,_this=this,_promises={};function createBufferArrayAntimatter(e,id){let size=e.size,num=e.num,position=new Float32Array(size*size*3);if(window.NativeUtils)NativeUtils.fillBufferUV(position,num,size);else{let h=.5/size;for(let i=0;i<num;i++)position[3*i+0]=h+i%size/size,position[3*i+1]=h+Math.floor(i/size)/size,position[3*i+2]=i}let{w:w,h:h,d:d}=e.dimensions,usedDepth=num/(size*size),grid=0==w[0]&&0==w[1]&&0==h[0]&&0==h[1];var vertices=new Float32Array(size*size*4);if(window.NativeUtils)grid?NativeUtils.fillBufferGrid(vertices,num,size,usedDepth):NativeUtils.fillBufferRange(vertices,num,w[0],w[1],h[0],h[1],d[0],d[1]);else for(let i=0;i<num;i++)null!=e.pointData?(vertices[4*i+0]=e.pointData.positions[3*i+0],vertices[4*i+1]=e.pointData.positions[3*i+1],vertices[4*i+2]=e.pointData.positions[3*i+2]):grid?(vertices[4*i+0]=Math.range(i%size,0,size,-1,1),vertices[4*i+1]=Math.range(i/size,size*usedDepth*usedDepth,0,-1,1)):(vertices[4*i+0]=Math.random(w[0],w[1],10),vertices[4*i+1]=Math.random(h[0],h[1],10),vertices[4*i+2]=Math.random(d[0],d[1],10)),vertices[4*i+3]=1;var attribs=new Float32Array(size*size*4);if(null!=e.pointData&&e.pointData.random)for(let i=0;i<num;i++)attribs[4*i+0]=e.pointData.random[4*i+0],attribs[4*i+1]=e.pointData.random[4*i+1],attribs[4*i+2]=e.pointData.random[4*i+2],attribs[4*i+3]=e.pointData.random[4*i+3];else if(window.NativeUtils)NativeUtils.fillBufferRandom(attribs,attribs.length);else for(let i=0;i<num;i++)attribs[4*i+0]=Math.random(0,1,10),attribs[4*i+1]=Math.random(0,1,10),attribs[4*i+2]=Math.random(0,1,10),attribs[4*i+3]=Math.random(0,1,10);resolve({geometry:position,vertices:vertices,attribs:attribs,usedDepth:usedDepth},id,[position.buffer,vertices.buffer,attribs.buffer])}function createFloatArrayAntimatter({size:size},id){let array=new Float32Array(size);resolve({array:array},id,[array.buffer])}this.cache=!0,this.createBufferArray=function(size,num,config={},_pointData=null){let key;if(_thread||function initThread(){_thread=!0,Thread.upload(createBufferArrayAntimatter),Thread.upload(createFloatArrayAntimatter)}(),_this.cache&&(key=`buffer_${JSON.stringify(config)}_${size}_${num}`,_promises[key]))return _promises[key];let promise=Promise.create();key&&(_promises[key]=promise);let buffers=[];return _pointData?.positions.buffer&&buffers.push(_pointData?.positions.buffer),Thread.shared().createBufferArrayAntimatter({size:size,num:num,dimensions:config,pointData:_pointData},buffers).then(data=>{data.attribs=new AntimatterAttribute(data.attribs,4),data.vertices=new AntimatterAttribute(data.vertices,4);let geometry=data.geometry;data.geometry=new Geometry,data.geometry.addAttribute("position",new GeometryAttribute(geometry,3)),data.geometry.addAttribute("random",new GeometryAttribute(data.attribs.buffer,4)),data.geometry.attributes.random.destroyDataAfterUpload=!1,data.key=key,promise.resolve(data)}),promise},this.createFloatArray=function(size,freshCopy){if(freshCopy||!_this.cache)return Thread.shared().createFloatArrayAntimatter({size:size});if(_promises[`float_size${size}`])return _promises[`float_size${size}`];return _promises[`float_size${size}`]=Thread.shared().createFloatArrayAntimatter({size:size})},this.clearCacheEntry=function(key){_this.cache&&key&&delete _promises[key]}},"static"),Class(function BalanceText(){Inherit(this,Component);const _this=this;_this.TEXT_WRAP_BALANCE_SUPPORT=!1,_this.TEXT_WRAP_BALANCE_SUPPORT="undefined"!=typeof CSS&&"function"==typeof CSS.supports&&CSS.supports("text-wrap","balance"),_this.relayout=(wrapper,ratio=1,useParent=!1)=>{const container=useParent?wrapper.parentElement:wrapper;if(!container)return;const computedStyle=window.getComputedStyle(wrapper);if(_this.TEXT_WRAP_BALANCE_SUPPORT&&"balance"===computedStyle.textWrap)return void(Hydra.LOCAL&&!_this.flag("notified")&&(console.warn("Balanced text is supported by this browser, no need to use BalanceText here"),_this.flag("notified",!0)));const charBuffer=1.5*parseFloat(computedStyle.fontSize||0),update=width=>wrapper.style.maxWidth=`${Math.ceil(width)}px`;wrapper.style.maxWidth="";const width=container.clientWidth,height=container.clientHeight;let middle,lower=width/2-.25,upper=width+.5,maxTry=0;if(width){for(;lower+1<upper&&maxTry<2e3;)middle=Math.round((lower+upper)/2),update(middle),container.clientHeight===height?upper=middle:lower=middle,maxTry++;update(upper*ratio+width*(1-ratio)+charBuffer)}}},"static");class CubicPoly{constructor(x0,x1,t0,t1){this.init(x0,x1,t0,t1)}init(x0,x1,t0,t1){this.c0=x0,this.c1=t0,this.c2=-3*x0+3*x1-2*t0-t1,this.c3=2*x0-2*x1+t0+t1}initCatmullRom(x0,x1,x2,x3,tension){this.init(x1,x2,tension*(x2-x0),tension*(x3-x1))}initNonuniformCatmullRom(x0,x1,x2,x3,dt0,dt1,dt2){let t1=(x1-x0)/dt0-(x2-x0)/(dt0+dt1)+(x2-x1)/dt1,t2=(x2-x1)/dt1-(x3-x1)/(dt1+dt2)+(x3-x2)/dt2;t1*=dt1,t2*=dt1,this.init(x1,x2,t1,t2)}calc(t){let t2=t*t,t3=t2*t;return this.c0+this.c1*t+this.c2*t2+this.c3*t3}}Class(function Curve(_input,_type){Inherit(this,Component);const _this=this;var _curve;function initFromFlatArray(array){let points=[];for(let i=0;i<array.length;i+=3)points.push(new Vector3(array[i+0],array[i+1],array[i+2]));_this.points=points,initCurve(points)}function initFromVecArray(points){_this.points=points,initCurve(points)}function initFromSplineData(data){if("bezier"===data.metadata.type){_type="cubicBezier";let pointsAndTangents=[];for(let i=0;i<data.points.length/3;++i){let point=(new Vector3).fromArray(data.points,3*i),tangent0=(new Vector3).fromArray(data.tangents,6*i),tangent1=(new Vector3).fromArray(data.tangents,6*i+3);tangent0.add(point),tangent1.add(point),i>0&&pointsAndTangents.push(tangent0),pointsAndTangents.push(point),i<data.points.length/3-1&&pointsAndTangents.push(tangent1)}initFromVecArray(pointsAndTangents)}else{if("linear"!==data.metadata.type)throw new Error(`Unsupported spline type "${data.metadata.type}"`);_type="line",initFromFlatArray(data.points)}}function initCurve(input){switch(_type){case"line":_curve=new CurvePath;for(let i=0;i<input.length-1;i+=1){let newCurve=new LineCurve(input[i],input[i+1]);_curve.add(newCurve)}break;case"cubicBezier":_curve=new CurvePath;for(let i=0;i<input.length-3;i+=3){let p0=input[i],p1=input[i+1],p2=input[i+2],p3=input[i+3],newCurve=new CubicBezierCurve(p0,p1,p2,p3);_curve.add(newCurve)}break;default:_curve=new CatmullRomCurve(input)}}this.root=new Group,Array.isArray(_input)&&Array.isArray(_input[0])?function initFromArray(){let points=[];for(let i=0;i<_input.length;i++)points.push((new Vector3).fromArray(_input[i]));_this.points=points,initCurve(points)}():Array.isArray(_input)&&_input[0]instanceof Vector3?initFromVecArray(_input):Array.isArray(_input)&&"number"==typeof _input[0]?initFromFlatArray(_input):_input instanceof CurvePath?_curve=_input:function initFromObj(obj){if("string"==typeof obj){let name=obj;if(!(obj=Assets.JSON[obj]))throw`No curve ${name} found`;obj.curves=obj.curves[0]}else{if(obj.curves&&Array.isArray(obj.curves)&&obj.curves[0].metadata)return initFromSplineData(obj.curves[0]);if(obj.metadata)return initFromSplineData(obj);obj.curves=Array.isArray(obj.curves[0])?obj.curves[0]:obj.curves}for(var data=obj.curves,points=[],j=0;j<data.length;j+=3)points.push(new Vector3(data[j+0],data[j+1],data[j+2]));initCurve(points)}(_input),this.debug=function(){let points=_curve.getPoints(50),geometry=(new Geometry).setFromPoints(points),shader=Utils3D.getTestShader(4095),curveObject=new Line(geometry,shader);return _this.root.add(curveObject),_this.root},this.getPointAt=function(t){t=Math.max(0,Math.min(1,t)),!window.THREAD&&this.root.matrixDirty&&this.root.updateMatrixWorld();let pos=_curve.getPointAt(t);return!window.THREAD&&pos.applyMatrix4&&pos.applyMatrix4(this.root.matrixWorld),pos},this.getPoint=function(t){t=Math.max(0,Math.min(1,t)),!window.THREAD&&this.root.matrixDirty&&this.root.updateMatrixWorld();let pos=_curve.getPoint(t);return!window.THREAD&&pos.applyMatrix4&&pos.applyMatrix4(this.root.matrixWorld),pos},this.getTangent=function(t){t=Math.max(0,Math.min(1,t)),!window.THREAD&&this.root.matrixDirty&&this.root.updateMatrixWorld();let pos=_curve.getTangent(t);return!window.THREAD&&pos.applyMatrix4&&pos.applyMatrix4(this.root.matrixWorld),pos},this.applyDataTexture=function(shader,subdivisions){if(!_this.dataTexture){let size=(num=>{var values=[2,4,8,16,32,64,128,256,512,1024,2048,4096];for(let i=0;i<values.length;i++){var p2=values[i];if(p2*p2>=num)return p2}})(subdivisions),total=size*size,buffer=new Float32Array(3*total);for(let i=0;i<total;i++){let percent=i/(total-1),pos=_this.getPoint(percent);buffer[3*i+0]=pos.x,buffer[3*i+1]=pos.y,buffer[3*i+2]=pos.z}_this.dataTexture=new DataTexture(buffer,size,size,Texture.RGBFormat,Texture.FLOAT)}shader.addUniforms({tCurve:{value:_this.dataTexture},uCurveSize:{value:_this.dataTexture.width}})},this.onDestroy=function(){_this.dataTexture&&_this.dataTexture.destroy()},this.set("closed",v=>{_curve.closed=v}),this.get("curve",_=>_curve)},_=>{Curve.parseFile=async function(data){"string"==typeof data&&(data=await get(Assets.getPath(data)));let curves=[];return data.curves.forEach(array=>{curves.push(new Curve({curves:[array]}))}),curves},Curve.loadOnThread=function(thread){thread._curveLoaded||(thread._curveLoaded=!0,thread.importES6Class("CubicPoly"),thread.importES6Class("Curve3D"),thread.importES6Class("CurvePath"),thread.importES6Class("CatmullRomCurve"),thread.importES6Class("CubicBezierCurve"),thread.importES6Class("LineCurve"),thread.importClass(Curve))}});class Curve3D{constructor(){this.arcLengthDivisions=200}getPointAt(u){let t=this.getUtoTmapping(u);return this.getPoint(t)}getPoints(divisions=5){let points=[];for(let d=0;d<=divisions;d++)points.push(this.getPoint(d/divisions));return points}getSpacedPoints(divisions=5){let points=[];for(let d=0;d<=divisions;d++)points.push(this.getPointAt(d/divisions));return points}getLength(){let lengths=this.getLengths();return lengths[lengths.length-1]}getLengths(divisions=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===divisions+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let current,p,cache=[],last=this.getPoint(0),sum=0;for(cache.push(0),p=1;p<=divisions;p++)current=this.getPoint(p/divisions),sum+=current.distanceTo(last),cache.push(sum),last=current;return this.cacheArcLengths=cache,cache}updateArtLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(u,distance){let targetArcLength,arcLengths=this.getLengths(),i=0,il=arcLengths.length;targetArcLength=distance||u*arcLengths[il-1];let comparison,low=0,high=il-1;for(;low<=high;)if(i=Math.floor(low+(high-low)/2),comparison=arcLengths[i]-targetArcLength,comparison<0)low=i+1;else{if(!(comparison>0)){high=i;break}high=i-1}if(i=high,arcLengths[i]===targetArcLength)return i/(il-1);let lengthBefore=arcLengths[i];return(i+(targetArcLength-lengthBefore)/(arcLengths[i+1]-lengthBefore))/(il-1)}getTangent(t){let t1=t-1e-4,t2=t+1e-4;t1<0&&(t1=0),t2>1&&(t2=1);let pt1=this.getPoint(t1);return this.getPoint(t2).clone().sub(pt1).normalize()}getTangentAt(u){let t=this.getUtoTmapping(u);return this.getTangent(t)}computeFrenetFrames(segments,closed){let i,u,theta,normal=new Vector3,tangents=[],normals=[],binormals=[],vec=new Vector3,mat=new Matrix4;for(i=0;i<=segments;i++)u=i/segments,tangents[i]=this.getTangentAt(u),tangents[i].normalize();normals[0]=new Vector3,binormals[0]=new Vector3;let min=Number.MAX_VALUE,tx=Math.abs(tangents[0].x),ty=Math.abs(tangents[0].y),tz=Math.abs(tangents[0].z);for(tx<=min&&(min=tx,normal.set(1,0,0)),ty<=min&&(min=ty,normal.set(0,1,0)),tz<=min&&normal.set(0,0,1),vec.crossVectors(tangents[0],normal).normalize(),normals[0].crossVectors(tangents[0],vec),binormals[0].crossVectors(tangents[0],normals[0]),i=1;i<=segments;i++)normals[i]=normals[i-1].clone(),binormals[i]=binormals[i-1].clone(),vec.crossVectors(tangents[i-1],tangents[i]),vec.length()>Number.EPSILON&&(vec.normalize(),theta=Math.acos(Math.clamp(tangents[i-1].dot(tangents[i]),-1,1)),normals[i].applyMatrix4(mat.makeRotationAxis(vec,theta))),binormals[i].crossVectors(tangents[i],normals[i]);if(!0===closed)for(theta=Math.acos(Math.clamp(normals[0].dot(normals[segments]),-1,1)),theta/=segments,tangents[0].dot(vec.crossVectors(normals[0],normals[segments]))>0&&(theta=-theta),i=1;i<=segments;i++)normals[i].applyMatrix4(mat.makeRotationAxis(tangents[i],theta*i)),binormals[i].crossVectors(tangents[i],normals[i]);return{tangents:tangents,normals:normals,binormals:binormals}}}Class(function CurveLayer(_input,_group){Inherit(this,Object3D);const _this=this;var _config,_curve,_debug;function getJSONPath(){let path=_config.get("json");return path.includes("assets/geometry")||(path="assets/geometry/"+path),path.includes(".json")||(path+=".json"),path}!async function(){(_config=InputUIL.create(_input.prefix+"curve",_group)).setLabel("Curve"),_config.add("json"),_config.addToggle("debug"),_config.get("json")&&await async function initCurve(path){let data=_this.data=await get(Assets.getPath(path));_curve=_this.initClass(Curve,data),Global.PLAYGROUND&&((_debug=_curve.debug()).visible=_config.get("debug"),_this.add(_debug))}(getJSONPath()),_config.onUpdate=_=>{_debug&&(_debug.visible=Global.PLAYGROUND&&_config.get("debug"))},_config.onUpdate(),_this.flag("loaded",!0)}(),this.getData=async function(){return _config.get("json")||console.warn("No json path set on CurveLayer :: Promise won't resolve"),await _this.wait("data"),_this.data},this.getJSONPath=function(){return _config.get("json")||console.warn("No json path set on CurveLayer"),getJSONPath()},this.getCurve=async function(){return await _this.wait("loaded"),_curve}}),Class(function CurveTweener(){var _v1,_m,_e;this.create=function(object3d,curve,direction=1){object3d.rotation.order="YXZ";let value=0,yaw=0,y=object3d.rotation.y;return{get value(){return value},set value(v){value=v;let t=Math.clamp(direction<1?1-value:value),point=curve.getPointAt(t),tangent=curve.curve.getTangentAt(t);direction<1&&tangent.negate(),_v1||(_v1=new Vector3),_m||(_m=new Matrix4),_e||(_e=new Euler(0,0,0,"YXZ"));let eye=_v1.setScalar(0);_m.lookAt(eye,tangent,object3d.up),object3d.position.copy(point),_e.setFromRotationMatrix(_m),y=_e.y,object3d.rotation.y=y+yaw},get pitch(){return Math.degrees(object3d.rotation.x)},set pitch(x){object3d.rotation.x=Math.radians(x)},get roll(){return Math.degrees(object3d.rotation.z)},set roll(z){object3d.rotation.z=Math.radians(z)},get yaw(){return Math.degrees(yaw)},set yaw(nextYaw){yaw=Math.radians(nextYaw),object3d.rotation.y=y+yaw}}}},"static");class CubicBezierCurve extends Curve3D{constructor(v0,v1,v2,v3){super(),this.type="CubicBezierCurve",this.v0=v0||new Vector3,this.v1=v1||new Vector3,this.v2=v2||new Vector3,this.v3=v3||new Vector3}getPoint(t,optionalTarget){var point=optionalTarget||new Vector3,v0=this.v0,v1=this.v1,v2=this.v2,v3=this.v3;return point.set(this.cubicBezier(t,v0.x,v1.x,v2.x,v3.x),this.cubicBezier(t,v0.y,v1.y,v2.y,v3.y),this.cubicBezier(t,v0.z,v1.z,v2.z,v3.z)),point}copy(source){return this.copy.call(this,source),this.v0.copy(source.v0),this.v1.copy(source.v1),this.v2.copy(source.v2),this.v3.copy(source.v3),this}cubicBezierP0(t,p){var k=1-t;return k*k*k*p}cubicBezierP1(t,p){var k=1-t;return 3*k*k*t*p}cubicBezierP2(t,p){return 3*(1-t)*t*t*p}cubicBezierP3(t,p){return t*t*t*p}cubicBezier(t,p0,p1,p2,p3){return this.cubicBezierP0(t,p0)+this.cubicBezierP1(t,p1)+this.cubicBezierP2(t,p2)+this.cubicBezierP3(t,p3)}}class CatmullRomCurve extends Curve3D{constructor(points=[]){if(super(),this.tmp=new Vector3,this.px=new CubicPoly,this.py=new CubicPoly,this.pz=new CubicPoly,points.length<2)throw"CatmullRomCurve: Points array needs at least two entries.";this.points=points,this.closed=!1}getLength(){const tmp=this.tmp;let length=0;return this.points.forEach((p,i)=>{0!==i&&(tmp.subVectors(p,this.points[i-1]),length+=tmp.length())}),length}getPoint(t,target){let p0,p1,p2,p3,tmp=this.tmp,px=this.px,py=this.py,pz=this.pz,points=this.points,l=points.length,point=(l-(this.closed?0:1))*t,intPoint=Math.floor(point),weight=point-intPoint;if(this.closed?intPoint+=intPoint>0?0:(Math.floor(Math.abs(intPoint)/points.length)+1)*points.length:0===weight&&intPoint===l-1&&(intPoint=l-2,weight=1),this.closed||intPoint>0?p0=points[(intPoint-1)%l]:(tmp.subVectors(points[0],points[1]).add(points[0]),p0=tmp),p1=points[intPoint%l],p2=points[(intPoint+1)%l],this.closed||intPoint+2<l?p3=points[(intPoint+2)%l]:(tmp.subVectors(points[l-1],points[l-2]).add(points[l-1]),p3=tmp),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){let pow="chordal"===this.type?.5:.25,dt0=Math.pow(p0.distanceToSquared(p1),pow),dt1=Math.pow(p1.distanceToSquared(p2),pow),dt2=Math.pow(p2.distanceToSquared(p3),pow);dt1<1e-4&&(dt1=1),dt0<1e-4&&(dt0=dt1),dt2<1e-4&&(dt2=dt1),px.initNonuniformCatmullRom(p0.x,p1.x,p2.x,p3.x,dt0,dt1,dt2),py.initNonuniformCatmullRom(p0.y,p1.y,p2.y,p3.y,dt0,dt1,dt2),pz.initNonuniformCatmullRom(p0.z,p1.z,p2.z,p3.z,dt0,dt1,dt2)}else if("catmullrom"===this.type){let tension=void 0!==this.tension?this.tension:.5;px.initCatmullRom(p0.x,p1.x,p2.x,p3.x,tension),py.initCatmullRom(p0.y,p1.y,p2.y,p3.y,tension),pz.initCatmullRom(p0.z,p1.z,p2.z,p3.z,tension)}if(!target)return new Vector3(px.calc(weight),py.calc(weight),pz.calc(weight));target.set(px.calc(weight),py.calc(weight),pz.calc(weight))}}Class(function ImageDecoder(){Inherit(this,Component);var _ktx1Settings,_this=this;this.scale=1,this.disableFallbackImage=!1;var _offscreen={},doDecodeImage="createImageBitmap"in window?(path,params)=>Thread.shared().decodeImage({path:path,params:params}):(path,params)=>Assets.decodeImage(path,params);function decodeImage(data,id){(async()=>{try{let e=await fetch(data.path,{mode:"cors"});if(200!=e.status)throw`Image not found: ${data.path}`;let blob=await e.blob(),obj={imageOrientation:"flipY",crossOrigin:"anonymous"};data.params&&!1===data.params.premultiplyAlpha&&(obj.premultiplyAlpha="none"),obj.imageOrientation=data.params&&!1===data.params.flipY?void 0:"flipY";let bitmap=await createImageBitmap(blob,obj),message={post:!0,id:id,message:bitmap};self.postMessage(message,[bitmap])}catch(e){resolve({fail:`${data.path} could not be decoded: ${e.message||e}`},id)}})()}function decodeCubeLUT(data,id){(async()=>{try{let cube=await get(data.path,{mode:"cors"});cube=cube.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let cubesize=findNumberAfterString(cube,"LUT_3D_SIZE",!0),domain_min=findNumberAfterString(cube,"DOMAIN_MIN"),domain_max=findNumberAfterString(cube,"DOMAIN_MAX");cube=removeCubeHeader(cube,"TITLE"),cube=removeCubeHeader(cube,"LUT_3D_SIZE"),cube=removeCubeHeader(cube,"DOMAIN_MIN"),cube=removeCubeHeader(cube,"DOMAIN_MAX");let rgba=[];if(cube.split(/\s+/).filter(substr=>substr.length>0).forEach((element,index)=>{rgba.push(+element),(index+1)%3==0&&index!==4*Math.pow(cubesize,3)-1&&rgba.push(1)}),rgba.forEach((e,i)=>{domain_min&&domain_max&&(rgba[i]=Math.map(rgba[i],domain_min,domain_max,0,1)),rgba[i]=Math.clamp(Math.round(255*rgba[i]),0,255)}),rgba.length!==cubesize**3*4)throw`LUT .cube at ${data.path} has length mismatch: claims cube size of ${cubesize} but has ${rgba.length} elements.`;let imgBmp=new Uint8Array(rgba);resolve({imgBmp:imgBmp,cubesize:cubesize},id)}catch(e){resolve({fail:`${data.path} could not be decoded: ${e.message||e}`},id)}})()}function decodeKtx1CompressedImage(data,id){(async()=>{let ext;data.settings.dxt?ext="dxt":data.settings.etc?ext="astc":data.settings.pvrtc?ext="pvrtc":data.settings.astc&&(ext="astc");let fileName=data.path.split("/");fileName=fileName[fileName.length-1];let e=await fetch(`${data.path}/${fileName}-${ext}.ktx`);if(200!=e.status)throw`Image not found :: ${data.path}`;let arrayBuffer=await e.arrayBuffer(),header=new Int32Array(arrayBuffer,12,13),gliFormat=(header[1],header[2],header[3],header[4]),baseWidth=(header[5],header[6]),baseHeight=header[7],width=baseWidth,height=baseHeight,numberOfArrayElements=header[9],numberOfFaces=header[10],miplevels=header[11],buffers=[],compressedData=[],sizes=[],cube=6===numberOfFaces&&0===numberOfArrayElements,dataOffset=64+header[12];for(let level=0;level<miplevels;level++){let imageSize=new Int32Array(arrayBuffer,dataOffset,1)[0];dataOffset+=4,cube&&(imageSize*=6);let byteArray=new Uint8Array(arrayBuffer,dataOffset,imageSize);dataOffset+=imageSize,dataOffset+=3-(imageSize+3)%4,sizes.push(width),width=Math.max(1,.5*width),height=Math.max(1,.5*height);let clone=new Uint8Array(byteArray);compressedData.push(clone),buffers.push(clone.buffer)}resolve({gliFormat:gliFormat,compressedData:compressedData,sizes:sizes,width:baseWidth,height:baseHeight,cube:cube},id,buffers)})().catch(e=>{console.log(e.toString()),resolve({fail:`${data.path} could not be decoded: ${e.message||e}`},id)})}function renderOnQuad(image,compressionExtensions){let aspect=image.width/image.height,width=Math.round(aspect>1?128:128*aspect),height=Math.round(aspect>1?128/aspect:128);const gl=new OffscreenCanvas(width,height).getContext("webgl");if(!gl)throw new Error("Unable to initialize offscreen WebGL canvas");function loadShader(gl,shaderSource,shaderType){const shader=gl.createShader(shaderType);gl.shaderSource(shader,shaderSource),gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){const lastError=gl.getShaderInfoLog(shader);throw gl.deleteShader(shader),new Error("Shader compile error: "+lastError)}return shader}let vs=loadShader(gl,"\nattribute vec4 a_position;\nvarying vec2 v_texcoord;\n\nvoid main() {\n    gl_Position = a_position;\n    v_texcoord = a_position.xy * 0.5 + 0.5;\n}",gl.VERTEX_SHADER),fs=loadShader(gl,"\nprecision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\n\nvoid main() {\n    gl_FragColor = texture2D(u_texture, v_texcoord);\n}",gl.FRAGMENT_SHADER),program=function createProgram(gl,shaders){const program=gl.createProgram();if(shaders.forEach(function(shader){gl.attachShader(program,shader)}),gl.linkProgram(program),!gl.getProgramParameter(program,gl.LINK_STATUS)){const lastError=gl.getProgramInfoLog(program);throw gl.deleteProgram(program),shaders.forEach(function(shader){gl.deleteShader(shader)}),new Error("Shader link error:"+lastError)}return program}(gl,[vs,fs]);var positionLocation=gl.getAttribLocation(program,"a_position"),positionBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,positionBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,3,-1,-1,3]),gl.STATIC_DRAW),gl.viewport(0,0,gl.canvas.width,gl.canvas.height),gl.clear(gl.COLOR_BUFFER_BIT);const tex=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,tex),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0);let ext={};compressionExtensions.forEach(str=>{switch(str){case"astc":ext.astc=gl.getExtension("WEBGL_compressed_texture_astc");break;case"atc":ext.atc=gl.getExtension("WEBGL_compressed_texture_atc");break;case"etc":ext.etc=gl.getExtension("WEBGL_compressed_texture_etc");break;case"etc1":ext.etc1=gl.getExtension("WEBGL_compressed_texture_etc1");break;case"pvrtc":ext.pvrtc=gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"s3tc":ext.s3tc=gl.getExtension("WEBGL_compressed_texture_s3tc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"bptc":ext.bptc=gl.getExtension("EXT_texture_compression_bptc");break;case"s3tc_srgb":ext.s3tc_srgb=gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")}});let index=image.sizes.findIndex(e=>e.width<=128&&e.height<=128);gl.compressedTexImage2D(gl.TEXTURE_2D,0,image.gliFormat,image.sizes[index].width,image.sizes[index].height,0,image.compressedData[index]),gl.useProgram(program),gl.bindBuffer(gl.ARRAY_BUFFER,positionBuffer),gl.enableVertexAttribArray(positionLocation),gl.vertexAttribPointer(positionLocation,2,gl.FLOAT,!1,0,0),gl.drawArrays(gl.TRIANGLES,0,3),gl.useProgram(null);let data=new Uint8Array(65536);return gl.readPixels(0,0,128,128,gl.RGBA,gl.UNSIGNED_BYTE,data),data}function findDominantColors(e,id){function calculateCenterColor(colors){let center=new ColorLAB;return colors.forEach(color=>{center.l+=color.l,center.a+=color.a,center.b+=color.b}),colors.length&&(center.l/=colors.length,center.a/=colors.length,center.b/=colors.length),center}try{let data;if(e.compressionExtensions)data=renderOnQuad(e.image,e.compressionExtensions);else if(e.image){let aspect=e.image.width/e.image.height,max=128,width=Math.round(aspect>1?max:max*aspect),height=Math.round(aspect>1?max/aspect:max),ctx=new OffscreenCanvas(width,height).getContext("2d");ctx.drawImage(e.image,0,0,width,height),data=ctx.getImageData(0,0,width,height).data}else data=e.data;let count=data.length/4,colors=[],j=0;for(let i=0;i<count;++i)data[j+3]>25&&colors.push((new ColorLAB).setRGB(data[j]/255,data[j+1]/255,data[j+2]/255)),j+=4;let results=function kmeans(colors,k,minDiff){let clusters=function getInitialClusters(colors,k){const sums=colors.map(color=>[color.l+color.a+color.b,color]);sums.sort((a,b)=>a[0]-b[0]);const centroids=[...Array(k)].map((_,i)=>{const shardSize=Math.floor(sums.length/k);return calculateCenterColor(sums.slice(shardSize*i,i===k-1?sums.length:shardSize*(i+1)).map(sum=>sum[1]))});for(let i=0;i<centroids.length-1;++i){const color=centroids[i],nextColor=centroids[i+1];color.l===nextColor.l&&color.a===nextColor.a&&color.b===nextColor.b&&(centroids.splice(i+1,1),i-=1)}return centroids.map(color=>[color,[]])}(colors,k);k=clusters.length;for(let i=1;;i++){let lists=[...Array(k)].map(()=>[]);for(let j=0;j<colors.length;j++){let c=colors[j],smallestDistance=1/0,idx=0;for(let i=0;i<k;i++){let distance=c.deltaECIE94(clusters[i][0]);distance<smallestDistance&&(smallestDistance=distance,idx=i)}lists[idx].push(c)}let diff=0;for(let i=0;i<k;i++){let old=clusters[i],center=calculateCenterColor(lists[i]),newCluster=[center,lists[i]],dist=old[0].deltaECIE94(center);clusters[i]=newCluster,diff=diff>dist?diff:dist}if(diff<minDiff||50===i)break}return clusters}(colors,"number"==typeof e.numColors?e.numColors:4,1/255).filter(cluster=>cluster[1].length);results.sort((a,b)=>b[1].length-a[1].length),results=results.map(result=>result[0].getRGB()),resolve({colors:results},id)}catch(e){throw resolve({fail:e.message||e},id),e}}function findNumberAfterString(source,str,toInt=!1){const regex=new RegExp(str+"\\D*([0-9]*\\.?[0-9]+)"),num=source.match(regex);return num&&num[1]?toInt?parseInt(num[1]):parseFloat(num[1]):null}function removeCubeHeader(source,str){const regex=new RegExp(str+"[\\s\\S]*?(\\n+)"),match=source.match(regex);if(match){const newlineIndex=match.index+match[0].length-1;return source.slice(newlineIndex+1)}return source}function checkCapabilities(){if(void 0===_offscreen["2d"]&&(_offscreen["2d"]="OffscreenCanvas"in window&&!!new OffscreenCanvas(1,1).getContext("2d")),void 0===_offscreen.webgl&&(_offscreen.webgl="OffscreenCanvas"in window&&!!new OffscreenCanvas(1,1).getContext("webgl"),_offscreen.webgl)){let compressionExtensions=["compressed_texture","texture_compression"],enabledExtensions=Device.graphics.webgl?.extensions||[],dedupe={};_offscreen.compressionExtensions=enabledExtensions.map(ext=>compressionExtensions.map(name=>{let index=ext.indexOf(name);if(!(index<0))return index+=name.length,"_"===ext.charAt(index)&&(index+=1),ext.substring(index)}).find(Boolean)).filter(ext=>!(!ext||dedupe[ext])&&(dedupe[ext]=!0))}}!async function(){await Hydra.ready(),Thread.upload(decodeImage),Thread.upload(decodeCubeLUT),Thread.upload(findNumberAfterString),Thread.upload(removeCubeHeader),Thread.upload(renderOnQuad),Thread.upload(findDominantColors),Thread.upload(decodeKtx1CompressedImage)}(),this.decode=async function(path,params={}){let fallback=Thread.absolutePath(Assets.getPath("assets/images/_scenelayout/uv.jpg"));if(path=Thread.absolutePath(Assets.getPath(path)),void 0===_ktx1Settings){_ktx1Settings={dxt:!!Renderer.extensions.s3tc,etc:!!Renderer.extensions.etc1,pvrtc:!!Renderer.extensions.pvrtc,astc:!!Renderer.extensions.astc};let found=!1;for(let key in _ktx1Settings)!0===_ktx1Settings[key]&&(found=!0);found||(_ktx1Settings=null)}let bitmap,compressedIdentifier=/-compressedKtx2?/.exec(path)?.[0],compressed=!!compressedIdentifier&&(compressedIdentifier.endsWith("2")?"ktx2":"ktx1");if((Utils.query("noKtx")||!_ktx1Settings&&"ktx1"===compressed)&&(path=path.replace(compressedIdentifier,""),compressed=!1),/\.ktx2(?:\?|#|$)/.test(path)&&(compressed="ktx2",Utils.query("noKtx")&&(params.uncompressed=!0)),compressed&&params.hintUsingPixelData&&(checkCapabilities(),_offscreen.webgl||("ktx2"===compressed?params.uncompressed=!0:(path=path.replace(compressedIdentifier,""),compressed=!1))),compressed)try{if(path=path.substring(0,path.lastIndexOf(".")),bitmap="ktx1"===compressed?await Thread.shared().decodeKtx1CompressedImage({path:path,params:params,settings:_ktx1Settings}):await Ktx2Transcoder.transcode({path:`${path}.ktx2`,params:params}),!bitmap.fail)return bitmap}catch(e){bitmap={fail:e.message}}else bitmap=await doDecodeImage(path,params);if(bitmap.fail&&!this.disableFallbackImage){const fallbackBitmap=await doDecodeImage(fallback,params);fallbackBitmap.fail||(bitmap=fallbackBitmap)}if(bitmap.fail)throw new Error(bitmap.fail);return function process(bitmap,scale){if(1==scale*_this.scale)return bitmap;let pow2=Math.isPowerOf2(bitmap.width,bitmap.height),canvas=document.createElement("canvas");return canvas.context=canvas.getContext("2d"),canvas.width=Math.round(bitmap.width*_this.scale*scale),canvas.height=Math.round(bitmap.height*_this.scale*scale),pow2&&scale*_this.scale<1&&(canvas.width=canvas.height=Math.floorPowerOf2(Math.max(canvas.width,canvas.height))),canvas.context.drawImage(bitmap,0,0,canvas.width,canvas.height),canvas}(bitmap,params.scale||1)},this.decodeCubeLUT=async function(path,params){let fallback=Thread.absolutePath(Assets.getPath("assets/images/_scenelayout/invert.cube"));path=Thread.absolutePath(Assets.getPath(path));try{let bitmap=await Thread.shared().decodeCubeLUT({path:path,params:params});if(bitmap.fail&&!this.disableFallbackImage&&(bitmap=await Thread.shared().decodeCubeLUT({path:fallback,params:params}),bitmap.fail))throw"could not decode "+path;return{imgBmp:bitmap.imgBmp,cubesize:bitmap.cubesize}}catch(e){throw"could not decode "+path}},this.decodeAndMergeTextureArrays=async function(paths,params){paths=paths.map(path=>Thread.absolutePath(Assets.getPath(path))),Utils.query("noKtx")&&(params.uncompressed=!0);let bitmap=await Ktx2Transcoder.transcodeAndMergeTextureArrays({paths:paths,params:params});if(bitmap.fail)throw new Error(bitmap.fail);return bitmap},this.parseColors=async function(image,numColors=4){let result;if(checkCapabilities(),image.sizes)if(_offscreen.webgl)result=await Thread.shared().findDominantColors({image:image,numColors:numColors,compressionExtensions:_offscreen.compressionExtensions});else{let index=image.sizes.findIndex(e=>e.width<=128&&e.height<=128);index=Math.max(0,index);let data=(image=await _this.decode(image.path+"-compressedKtx2",{uncompressed:!0})).compressedData[index];result=await Thread.shared().findDominantColors({data:data,numColors:numColors},[data.buffer])}else if(_offscreen["2d"]){let buffers=[];image instanceof HTMLImageElement&&(image=await createImageBitmap(image),buffers.push(image)),result=await Thread.shared().findDominantColors({image:image,numColors:numColors},buffers)}else{let canvas=document.createElement("canvas");canvas.context=canvas.getContext("2d");let aspect=image.width/image.height,max=128;canvas.width=Math.round(aspect>1?max:max*aspect),canvas.height=Math.round(aspect>1?max/aspect:max),canvas.context.drawImage(image,0,0,canvas.width,canvas.height);let data=canvas.context.getImageData(0,0,canvas.width,canvas.height).data;result=await Thread.shared().findDominantColors({data:data,numColors:numColors},[data.buffer])}if(result.fail)throw new Error(result.fail);return result.colors.map(color=>(new Color).copy(color))}},"static"),Class(function Ktx2Transcoder(){Inherit(this,Component);const _this=this;var _transcoderReady,_basisAssets=["~assets/js/lib/basis_transcoder.js","~assets/js/lib/basis_transcoder.wasm"].map(Assets.getPath).map(Thread.absolutePath);async function initBasisTranscoder(){if(_transcoderReady)await _transcoderReady;else{_transcoderReady=Promise.create();let[js,wasmBinary]=await Promise.all(_basisAssets.map(async(path,i)=>{let response=await fetch(path);return 0===i?response.text():response.arrayBuffer()})),formats=function getSupportedFormats(){let supported={astc:!!Renderer.extensions.astc,etc1:!!Renderer.extensions.etc1,etc2:!!Renderer.extensions.etc,dxt:!!Renderer.extensions.s3tc,bptc:!!Renderer.extensions.bptc,pvrtc:!!Renderer.extensions.pvrtc,uncompressed:!0};Renderer.type===Renderer.WEBGL2&&(supported.etc1=!1);let formats={};return Object.keys(supported).filter(id=>supported[id]).forEach(id=>{let format={id:id,needsPowerOfTwo:!1};switch(formats[id]=format,id){case"astc":format.gliFormat=[Renderer.extensions.astc.COMPRESSED_RGBA_ASTC_4x4_KHR,Renderer.extensions.astc.COMPRESSED_RGBA_ASTC_4x4_KHR];break;case"bptc":format.gliFormat=[Renderer.extensions.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT,Renderer.extensions.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT];break;case"dxt":format.gliFormat=[Renderer.extensions.s3tc.COMPRESSED_RGB_S3TC_DXT1_EXT,Renderer.extensions.s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT];break;case"etc2":format.gliFormat=[Renderer.extensions.etc.COMPRESSED_RGB8_ETC2,Renderer.extensions.etc.COMPRESSED_RGBA8_ETC2_EAC];break;case"etc1":format.gliFormat=[Renderer.extensions.etc.COMPRESSED_RGB_ETC1_WEBGL];break;case"pvrtc":format.gliFormat=[Renderer.extensions.pvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,Renderer.extensions.pvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG],format.needsPowerOfTwo=!0;break;case"uncompressed":format.gliFormat=[Renderer.context.RGBA,Renderer.context.RGBA]}}),formats}(),threads=Thread.shared(!0).array;await Promise.all(threads.map(async thread=>{thread.importCode(js),thread.loadFunction(initKtx2TranscoderThread),thread.loadFunction(function transcodeKtx2(){}),thread.loadFunction(function fetchAndMergeKtx2TextureArrays(){}),await thread.initKtx2TranscoderThread({wasmBinary:wasmBinary,formats:formats})})),_transcoderReady.resolve(),_this.flag("transcoderLoaded",!0)}}function initKtx2TranscoderThread(e,id){var _formats;async function transcodeKtx2({path:path,params:params},id){try{let{buffers:buffers,...result}=await fetchAndTranscodeKtx2(path,params);resolve({path:path,...result},id,buffers)}catch(e){console.log(e.toString()),resolve({fail:`${path} could not be decoded: ${e.message||e}`},id)}}async function fetchAndMergeKtx2TextureArrays({paths:paths,params:params},id){try{let results=await Promise.all(paths.map(async path=>fetchAndTranscodeKtx2(path,params)));for(let i=1;i<results.length;++i){let result=results[i];["width","height","gliFormat","cube"].forEach(prop=>{if(result[prop]!==results[0][prop])throw new Error(`Layer ${prop} mismatch between ${paths[i]} and ${paths[0]}`)})}let{buffers:buffers,layers:layers,compressedData:compressedData,...result}=results[0];buffers.length=0,layers=0;for(let i=0;i<compressedData.length;++i){let totalLength=0;for(let j=0;j<results.length;++j)totalLength+=results[j].compressedData[i].byteLength,0===i&&(layers+=results[j].layers);let combined=new Uint8Array(totalLength),offset=0;for(let j=0;j<results.length;++j){let data=results[j].compressedData[i];combined.set(data,offset),offset+=data.byteLength}compressedData[i]=combined,buffers[i]=combined.buffer}resolve({path:paths[0],paths:paths,...result,layers:layers,compressedData:compressedData,isTextureArray:!0},id,buffers)}catch(e){console.log(e.toString()),resolve({fail:`${paths[0]} could not be decoded: ${e.message||e}`},id)}}async function fetchAndTranscodeKtx2(path,params){let ktx2File;try{let response=await fetch(path);if(200!==response.status)throw new Error(`Image not found :: ${path}`);let arrayBuffer=await response.arrayBuffer();if(ktx2File=new BasisModule.KTX2File(new Uint8Array(arrayBuffer)),!ktx2File.isValid())throw new Error("Invalid or unsupported .ktx2 file");let ktxheader=ktx2File.getHeader(),basisFormat=ktx2File.isUASTC()?"uastc":"etc1s",baseWidth=ktx2File.getWidth(),baseHeight=ktx2File.getHeight(),baseDepth=ktxheader.pixelDepth,layers=Math.max(1,ktx2File.getLayers()||1),levels=ktx2File.getLevels(),faceCount=ktx2File.getFaces(),hasAlpha=ktx2File.getHasAlpha(),premultiplyAlpha=!!(1&ktx2File.getDFDFlags());if(!baseWidth||!baseHeight||!levels)throw new Error("Invalid texture");let isLUT=params.isTexture3D&&ktxheader.vkFormat&&baseDepth;if(levels>1&&!isLUT){let level0Info=ktx2File.getImageLevelInfo(0,0,0);(level0Info.origWidth%4!=0||level0Info.origHeight%4!=0)&&(console.warn(`${path} should use multiple-of-four dimensions. Falling back to uncompressed RGBA.`),params.uncompressed=!0)}let{transcoderFormat:transcoderFormat,gliFormat:gliFormat,uncompressed:uncompressed}=function getTranscoderFormat(basisFormat,width,height,hasAlpha,params){let format;format=params.uncompressed?_formats.uncompressed:_formats[basisFormat].find(format=>!(hasAlpha&&format.transcoderFormat.length<2||format.needsPowerOfTwo&&!Math.isPowerOf2(width,height)));let uncompressed="uncompressed"===format.id;uncompressed&&!params.uncompressed&&console.warn("No suitable compressed texture format found. Decoding to RGBA32.");let which=hasAlpha?1:0;return{transcoderFormat:format.transcoderFormat[which],gliFormat:format.gliFormat[which],uncompressed:uncompressed}}(basisFormat,baseWidth,baseHeight,hasAlpha,params);if(!ktx2File.startTranscoding())throw new Error("startTranscoding failed");let buffers=[],compressedData=[],sizes=[],cube=6===faceCount;if(isLUT){const channelCount=4;let data=new Uint8Array(arrayBuffer.slice(baseWidth*baseHeight*baseDepth*ktxheader.typeSize*channelCount*-1));compressedData.push(data),buffers.push(data.buffer),sizes.push({baseWidth:baseWidth,baseHeight:baseHeight,baseDepth:baseDepth})}else for(let level=0;level<levels;level++){let totalLength=0,transcodedSizes=[],levelInfo=ktx2File.getImageLevelInfo(level,0,0),width=levelInfo.origWidth,height=levelInfo.origHeight;0!==level||uncompressed||(width=levelInfo.width,height=levelInfo.height,baseWidth=width,baseHeight=height);for(let layer=0;layer<layers;++layer)for(let faceIndex=0;faceIndex<faceCount;++faceIndex){let byteLength=ktx2File.getImageTranscodedSizeInBytes(level,layer,faceIndex,transcoderFormat);transcodedSizes.push(byteLength),totalLength+=byteLength}let data=new Uint8Array(totalLength),dataIndex=0,dataOffset=0;for(let layer=0;layer<layers;++layer)for(let faceIndex=0;faceIndex<faceCount;++faceIndex){let byteLength=transcodedSizes[dataIndex],faceData=data.subarray(dataOffset,dataOffset+byteLength);if(!ktx2File.transcodeImage(faceData,level,layer,faceIndex,transcoderFormat,0,-1,-1))throw new Error("transcodeImage failed");dataIndex+=1,dataOffset+=byteLength}compressedData.push(data),buffers.push(data.buffer),sizes.push({width:width,height:height})}return{gliFormat:gliFormat,compressedData:compressedData,sizes:sizes,width:baseWidth,height:baseHeight,depth:baseDepth,layers:layers,isTextureArray:layers>1||ktx2File.getLayers()>0,cube:cube,premultiplyAlpha:premultiplyAlpha,uncompressed:uncompressed,buffers:buffers}}finally{ktx2File&&(ktx2File.close(),ktx2File.delete())}}var BasisModule={wasmBinary:e.wasmBinary,onRuntimeInitialized:function(){BasisModule.initializeBasis(),function initFormats(formats){Object.keys(formats).forEach(id=>{let format=formats[id];switch(id){case"astc":format.transcoderFormat=[BasisModule.transcoder_texture_format.cTFASTC_4x4_RGBA.value,BasisModule.transcoder_texture_format.cTFASTC_4x4_RGBA.value];break;case"bptc":format.transcoderFormat=[BasisModule.transcoder_texture_format.cTFBC7_RGBA.value,BasisModule.transcoder_texture_format.cTFBC7_RGBA.value];break;case"dxt":format.transcoderFormat=[BasisModule.transcoder_texture_format.cTFBC1_RGB.value,BasisModule.transcoder_texture_format.cTFBC3_RGBA.value];break;case"etc2":format.transcoderFormat=[BasisModule.transcoder_texture_format.cTFETC1_RGB.value,BasisModule.transcoder_texture_format.cTFETC2_RGBA.value];break;case"etc1":format.transcoderFormat=[BasisModule.transcoder_texture_format.cTFETC1_RGB.value];break;case"pvrtc":format.transcoderFormat=[BasisModule.transcoder_texture_format.cTFPVRTC1_4_RGB.value,BasisModule.transcoder_texture_format.cTFPVRTC1_4_RGBA.value];break;case"uncompressed":format.transcoderFormat=[BasisModule.transcoder_texture_format.cTFRGBA32.value,BasisModule.transcoder_texture_format.cTFRGBA32.value]}}),_formats={uastc:[formats.astc,formats.bptc,formats.etc2,formats.etc1,formats.dxt,formats.pvrtc,formats.uncompressed].filter(Boolean),etc1s:[formats.etc2,formats.etc1,formats.bptc,formats.dxt,formats.pvrtc,formats.uncompressed].filter(Boolean),uncompressed:formats.uncompressed}}(e.formats),self.transcodeKtx2=transcodeKtx2,self.fetchAndTranscodeKtx2=fetchAndTranscodeKtx2,self.fetchAndMergeKtx2TextureArrays=fetchAndMergeKtx2TextureArrays,delete self.initKtx2TranscoderThread,resolve(id)}};BASIS(BasisModule)}_this.transcode=async function({path:path,params:params}){_this.flag("transcoderLoaded")||await initBasisTranscoder();let result=await Thread.shared().transcodeKtx2({path:path,params:params});if(result.fail)throw new Error(result.fail);return result},_this.transcodeAndMergeTextureArrays=async function({paths:paths,params:params}){_this.flag("transcoderLoaded")||await initBasisTranscoder();let result=await Thread.shared().fetchAndMergeKtx2TextureArrays({paths:paths,params:params});if(result.fail)throw new Error(result.fail);return result}},"static"),Class(function BaseCamera(_input,_group){Inherit(this,Object3D);const _this=this;var _debugCamera,_type="perspective",_manualRender=!1;function resize(){if(_this.overrideResize)"function"==typeof _this.overrideResize&&_this.overrideResize();else switch(_type){case"perspective":_this.camera.aspect=getAspect(),_this.camera.updateProjectionMatrix();break;case"orthographic":if(_this.width||_this.height)_this.camera.setViewport(_this.width,_this.height);else{let stage=findStage(),m=900/stage.height/100;_this.camera.setViewport(stage.width*m,stage.height*m)}}}function findStage(){return Utils3D.findNuke(_this)?.stage||Stage}function getAspect(){let stage=findStage();return stage.width/stage.height}function loop(){if(_this._loop?.(),_this.group.updateMatrixWorld(!0),_debugCamera&&_debugCamera.visible){Utils3D.decompose(_this.camera,_debugCamera);let viewportHeight,active=AppState.get("playground_camera_active");viewportHeight=active.isOrthographicCamera?(active.top-active.bottom)/active.zoom:Utils3D.getHeightFromCamera(active,_this.camera.position.distanceTo(active.position)),_debugCamera.scale.setScalar(.025*viewportHeight/.1)}RenderManager.fire(_this)}this.camera=new PerspectiveCamera(30,getAspect(),.1,1e3),this.group.add(this.camera),this.playgroundLock=function(camera=Camera.instance()){if(!Global.PLAYGROUND)return;Utils.getConstructorName(_this.parent).includes(Global.PLAYGROUND.split("/")[0])&&RenderManager.type==RenderManager.NORMAL&&camera.lock(_this.camera)},this.lock=function(camera){if("orthographic"==_type&&!camera.worldCamera.isOrthographicCamera)return console.error("You can't lock an orthographic camera to the main camera. Use an FXScene .setCamera");let p=_this.parent;for(;p;){if(p.cameraController){camera=p.cameraController;break}p=p.parent}if(!camera){let p=_this.parent;for(;p;){if(p.useCamera&&p.nuke)return p.useCamera(_this);p=p.parent}}camera=camera||Camera.instance(),RenderManager.type==RenderManager.NORMAL&&camera.lock(_this.camera,_this)},this.transition=function(time,ease,delay,camera=Camera.instance()){"object"==typeof delay&&(camera=delay,delay=0);let p=_this.parent;for(;p;){if(p.cameraController){camera=p.cameraController;break}p=p.parent}let promise=Promise.create();return camera.transition(_this.camera,time,ease,delay||0),_this.delayedCall(_=>promise.resolve(),time+(delay||0)),promise},this.manualTransition=function(camera=Camera.instance()){return camera.manualTransition(_this.camera)},this.setFOV=function(fov){"orthographic"!==_type&&fov!=this.camera.fov&&(this.camera.fov=fov,this.camera.updateProjectionMatrix())},this.setHorizontalFOV=function(hfov){const fov=2*Math.atan(Math.tan(hfov/2*Math.PI/180)/this.camera.aspect)*180/Math.PI;_this.setFOV(fov)},this.getFOV=function(){return this.camera.fov},this.useOrthographic=function(w,h){"orthographic"!==_type&&(isNaN(w)||(this.width=w),isNaN(h)||(this.height=h),this.camera&&this.group.remove(this.camera),this.camera=new OrthographicCamera,this.group.add(this.camera),this.camera.position.z=1,_type="orthographic",resize())},this.usePerspective=function(){"perspective"!==_type&&(this.camera&&this.group.remove(this.camera),this.camera=new PerspectiveCamera,this.group.add(this.camera),_type="perspective",resize())},this.useCurve=function(curve){return _this.camera.curve=curve,this},_this.get("zoom",()=>_this.camera.zoom),_this.set("zoom",zoom=>{_this.camera.zoom=zoom,_this.camera.updateProjectionMatrix()}),_this.get("near",()=>_this.camera.near),_this.set("near",near=>{_this.camera.near=near,_this.camera.updateProjectionMatrix()}),_this.get("far",()=>_this.camera.far),_this.set("far",far=>{_this.camera.far=far,_this.camera.updateProjectionMatrix()}),this.get("manualRender",()=>_manualRender),this.set("manualRender",value=>{(value=!!value)!==_manualRender&&((_manualRender=value)?_this.stopRender(loop):_this.startRender(loop))}),this.update=function(){_manualRender||!Hydra.LOCAL||_this.flag("manualRenderWarned")||(console.warn("Set manualRender to true if using GazeCamera.update()"),_this.flag("manualRenderWarned",!0)),loop()},_this.setProjectionProperties=function({fov:fov,near:near,far:far,zoom:zoom}){let needsUpdate=!1;"orthographic"!==_type&&void 0!==fov&&fov!==this.camera.fov&&(this.camera.fov=fov,needsUpdate=!0),void 0!==near&&near!==this.camera.near&&(this.camera.near=near,needsUpdate=!0),void 0!==far&&far!==this.camera.far&&(this.camera.far=far,needsUpdate=!0),void 0!==zoom&&zoom!==this.camera.zoom&&(this.camera.zoom=zoom,needsUpdate=!0),needsUpdate&&_this.camera.updateProjectionMatrix()},this.setAspectRatio=function(ratio){_this.camera.aspect=ratio,_this.camera.updateProjectionMatrix(),_this.overrideResize=!0},function init(){if(_this.startRender(loop),_this.onResize(resize),defer(resize),_input){_this.prefix=_input.prefix;let cameraUIL=CameraUIL.add(_this,_group);cameraUIL.setLabel("Camera"),_this.group._cameraUIL=cameraUIL}Global.PLAYGROUND&&AppState.bind("playground_camera_active",active=>{_this.group._parent&&(active?(_debugCamera||((_debugCamera=new Mesh(new BoxGeometry(.1,.1,.2),new Shader("DebugCamera",{uColor:{value:new Color("#ffffff")},transparent:!0,depthTest:!1}))).renderOrder=9999,_this.delayedCall(_=>_this.group._parent.add(_debugCamera),50)),_debugCamera.visible=!0):_debugCamera&&(_debugCamera.visible=!1))})}()}),Class(function Camera(_worldCamera){Inherit(this,Component);const _this=this;var _prevCamera,_lockCamera,_curve,_manual,_scheduleSlot,_calc=new Vector3,_target=new Group,_anim={weight:0,weight2:0},_cameraTarget=(new Vector3,new Group),_cameraTarget2=new Group;function loop(){_scheduleSlot||render()}function render(){if(_manual&&(_anim.weight2=_manual.value),_anim.weight+=(_anim.weight2-_anim.weight)*_this.lerp,_prevCamera){if(_prevCamera.updateMatrixWorld(),_lockCamera.updateMatrixWorld(),_curve){_curve.lerpPos||(_curve.lerpPos=(new Vector3).copy(_prevCamera.getWorldPosition())),_curve.lerpOffset||(_curve.lerpOffset=(new Vector3).copy(_curve.getPointAt(1)).multiplyScalar(-2).add(_lockCamera.getWorldPosition()));let pos=_calc.copy(_curve.getPointAt(_anim.weight)).add(_curve.lerpOffset).add(_lockCamera.getWorldPosition());_curve.lerpPos.lerp(pos,_curve.lerp||1,!1),_target.position.copy(_curve.lerpPos),_anim.weight>=1&&(_curve=_curve.lerpPos=_curve.lerpOffset=null,_this.onCurveComplete&&_this.onCurveComplete())}else _target.position.copy(_prevCamera.getWorldPosition()).lerp(_lockCamera.getWorldPosition(),_anim.weight,!1);_target.quaternion.copy(_prevCamera.getWorldQuaternion()).slerp(_lockCamera.getWorldQuaternion(),_anim.weight,!1);let needsUpdate=!1,zoom=Math.mix(_prevCamera.zoom,_lockCamera.zoom,_anim.weight);_worldCamera.zoom!==zoom&&(_worldCamera.zoom=zoom,needsUpdate=!0);let fov=!_worldCamera.isOrthographicCamera&&Math.mix(_prevCamera.fov,_lockCamera.fov,_anim.weight);fov&&_worldCamera.fov!==fov&&(_worldCamera.fov=fov,needsUpdate=!0);let near=Math.mix(_prevCamera.near,_lockCamera.near,_anim.weight);_worldCamera.near!==near&&(_worldCamera.near=near,needsUpdate=!0);let far=Math.mix(_prevCamera.far,_lockCamera.far,_anim.weight);_worldCamera.far!==far&&(_worldCamera.far=far,needsUpdate=!0),_worldCamera.aspect!==_lockCamera.aspect&&(_worldCamera.aspect=_lockCamera.aspect,needsUpdate=!0),needsUpdate&&_worldCamera.updateProjectionMatrix(),_cameraTarget.position.lerp(_target.position,_this.lerp2,!1),_cameraTarget.quaternion.slerp(_target.quaternion,_this.lerp2,!1)}else if(_lockCamera){_lockCamera.updateMatrixWorld(),Utils3D.decompose(_lockCamera,_cameraTarget);let needsUpdate=!1;_lockCamera.zoom&&_worldCamera.zoom!=_lockCamera.zoom&&(_worldCamera.zoom=_lockCamera.zoom,needsUpdate=!0),_worldCamera.isOrthographicCamera||_worldCamera.fov==_lockCamera.fov||(_worldCamera.fov=_lockCamera.fov,needsUpdate=!0),_worldCamera.near!==_lockCamera.near&&(_worldCamera.near=_lockCamera.near,needsUpdate=!0),_worldCamera.far!==_lockCamera.far&&(_worldCamera.far=_lockCamera.far,needsUpdate=!0),_worldCamera.aspect!==_lockCamera.aspect&&(_worldCamera.aspect=_lockCamera.aspect,needsUpdate=!0),needsUpdate&&_worldCamera.updateProjectionMatrix()}(_prevCamera||_lockCamera)&&(_cameraTarget2.position.lerp(_cameraTarget.position,_this.finalLerp,!1),_cameraTarget2.quaternion.slerp(_cameraTarget.quaternion,_this.finalLerp,!1),_worldCamera.position.lerp(_cameraTarget2.position,_this.finalLerp,!1),_worldCamera.quaternion.slerp(_cameraTarget2.quaternion,_this.finalLerp,!1)),_worldCamera.updateMatrixWorld(),RenderManager.fire(_this)}this.lerp=1,this.lerp2=1,this.worldCamera=_worldCamera,this.finalLerp=1,this.multiTween=!0,function(){if(RenderManager.type!=RenderManager.NORMAL)return _worldCamera=void 0,void(_this.worldCamera=_worldCamera);_worldCamera.controllingCamera=_this,_this.startRender(loop,RenderManager.AFTER_LOOPS)}(),this.lock=function(camera,scheduleSlot){camera instanceof Camera?(scheduleSlot=camera,camera=camera.worldCamera):camera.controllingCamera&&(scheduleSlot=camera.controllingCamera),_lockCamera=camera,_prevCamera=null,_worldCamera&&(_scheduleSlot&&_this.stopRender(render,_scheduleSlot),(_scheduleSlot=scheduleSlot)&&_this.startRender(render,_scheduleSlot),_lockCamera.zoom&&(_worldCamera.zoom=_lockCamera.zoom),_worldCamera.isOrthographicCamera||(_worldCamera.fov=_lockCamera.fov),_worldCamera.updateProjectionMatrix(),render())},this.transition=function(camera,duration=1e3,ease="easeInOutCubic",scheduleSlotOrDelay){let delay,scheduleSlot;return"number"==typeof scheduleSlotOrDelay?delay=scheduleSlotOrDelay:scheduleSlotOrDelay&&(scheduleSlot=scheduleSlotOrDelay),camera instanceof Camera?(scheduleSlot=camera,camera=camera.worldCamera):camera.controllingCamera&&(scheduleSlot=camera.controllingCamera),_curve&&(_curve=_curve.lerpPos=_curve.lerpOffset=null),camera.curve&&((_curve=camera.curve).lerpPos=camera.lerpPos),_prevCamera===camera?(duration*=.5*Math.smoothStep(.5,1,_anim.weight)+.5,_anim.weight=1-_anim.weight):_anim.weight=0,_manual=void 0,scheduleSlot&&_worldCamera&&(_scheduleSlot&&_this.stopRender(render,_scheduleSlot),_scheduleSlot=scheduleSlot,_this.startRender(render,_scheduleSlot)),_anim.weight2=_anim.weight,_prevCamera=_lockCamera,_lockCamera=camera,tween(_anim,{weight2:1},duration,ease,delay)},this.manualTransition=function(camera){return this.transition(camera).stop(),_manual={value:0}},this.setPrevCamera=function(camera){_prevCamera=camera.camera||camera},this.get("worldCamera",_=>_worldCamera),this.get("lockCamera",_=>_lockCamera),this.set("debugScale",s=>{undefined}),this.createLocal=function(camera){let needsResize=!1;camera||(camera=World.CAMERA.clone(),needsResize=!0);let instance=new Camera(camera.camera||camera);return needsResize&&instance.onResize(()=>{instance.overrideResize?"function"==typeof instance.overrideResize&&instance.overrideResize():instance.lockCamera||(camera.aspect=Stage.width/Stage.height,camera.updateProjectionMatrix())}),instance}},"singleton"),Class(function GazeCamera(_input,_group){Inherit(this,BaseCamera);const _this=this;var _strength={v:1},_cacheObj={},_move=new Vector3,_position=new Vector3,_wobble=new Vector3,_rotation=0,_wobbleAngle=Math.radians(Math.rand(0,360)),_innerGroup=new Group,_viewportFocusOffset=new Vector3,_hasViewportFocusOffset=!1,_quaternion=new Quaternion,_useCustomMove=!1,_prevMoveX=0;const V3_ZERO=new Vector3(0);this.strength=1,this.moveXY=new Vector2(4,4),this.position=new function Position(){Inherit(this,Component);var _x=0,_y=0,_z=0;this.get("x",_=>_x),this.get("y",_=>_y),this.get("z",_=>_z),this.set("x",x=>{_x=x}),this.set("y",y=>{_y=y}),this.set("z",z=>{_z=z,_move.z=_z,_this.camera.position.copy(_move),_position.copy(_move)}),this.set=function(x,y,z,noCopy){_x=x,_y=y,_z=z,_move.z=z,noCopy||_this.camera.position.copy(_move),_position.copy(_move)},this.toArray=function(){return[_x,_y,_z]},this.fromArray=function(array){_x=array[0],_y=array[1],_z=array[2],_move.set(_x,_y,_z),_this.camera.position.copy(_move),_position.copy(_move)},this.copy=function(vec){_x=vec.x,_y=vec.y,_z=vec.z,_move.set(_x,_y,_z),_this.camera.position.copy(_move),_position.copy(_move)}},this.lerpSpeed=.05,this.lerpSpeed2=1,this.lookAt=new Vector3(0,0,0),this.cameraRotation=new Euler,this.viewportFocus=new Vector2(0,0),this.deltaRotate=0,this.deltaLerp=1,this.wobbleSpeed=1,this.wobbleStrength=0,this.wobbleZ=1,this.zoomOffset=0,function(){if(_input){_this.prefix=_input.prefix;let cameraUIL=CameraUIL.add(_this,_group);cameraUIL.setLabel("Camera"),_this.group._cameraUIL=cameraUIL}_innerGroup.add(_this.camera),_this.group.add(_innerGroup)}(),this.orbit=function(time=1e3,ease="easeInOutSine"){return tween(_strength,{v:1},time,ease)},this.still=function(time=300,ease="easeInOutSine"){return tween(_strength,{v:0},time,ease)};var _v1=new Vector3,_v2=new Vector3,_v3=new Vector3;this.move=function(vec){let moveDiff=_v1.subVectors(_move,_this.position),positionDiff=_v2.subVectors(_move,_position),cameraPosDiff=_v3.subVectors(_this.camera.position,_position);_this.position.set(vec.x,vec.y,vec.z,!0),_move.copy(vec).add(moveDiff),_position.copy(_move).add(positionDiff),_this.camera.position.copy(_position).add(cameraPosDiff)},this.get("useCustomMove",()=>_useCustomMove),this.set("useCustomMove",value=>{value?(_useCustomMove=!0,_this.customMove||(_this.customMove=new Vector2)):_useCustomMove=!1}),this._loop=function loop(){_hasViewportFocusOffset&&_this.camera.position.sub(_viewportFocusOffset);let moveX=0,moveY=0;_useCustomMove?(moveX=Math.clamp(_this.customMove.x,-1,1),moveY=Math.clamp(_this.customMove.y,-1,1)):_this.useAccelerometer&&Mobile.Accelerometer&&Mobile.Accelerometer.connected?(moveX=Math.range(Mobile.Accelerometer.x,-2,2,-1,1,!0),moveY=0):(moveX=Stage.width&&Math.range(Mouse.x,0,Stage.width,-1,1,!0),moveY=Stage.height&&Math.range(Mouse.y,0,Stage.height,-1,1,!0)),_move.x=_this.position.x+moveX*_strength.v*_this.moveXY.x*_this.strength,_move.y=_this.position.y+moveY*_strength.v*_this.moveXY.y*_this.strength;let deltaX=moveX-_prevMoveX;_prevMoveX=moveX;let rotateStrength=Stage.width&&Math.range(Math.abs(deltaX)/Stage.width,0,.02,0,1,!0);if(_rotation=Math.lerp(Math.radians(_this.deltaRotate)*rotateStrength*Math.sign(deltaX),_rotation,.02*_this.deltaLerp*_strength.v),_innerGroup.rotation.z=Math.lerp(_rotation,_innerGroup.rotation.z,.07*_this.deltaLerp),_move.z=_this.position.z,_position.lerp(_move,_this.lerpSpeed2),_position.z+=_this.zoomOffset,_this.camera.position.lerp(_position,_this.lerpSpeed),_this.camera.lookAt(_this.lookAt),(Math.abs(_this.cameraRotation.x)>Base3D.DIRTY_EPSILON||Math.abs(_this.cameraRotation.y)>Base3D.DIRTY_EPSILON||Math.abs(_this.cameraRotation.z)>Base3D.DIRTY_EPSILON)&&(_quaternion.setFromEuler(_this.cameraRotation),_this.camera.quaternion.multiply(_quaternion)),function focusViewport(){let nextHasViewportFocusOffset=Math.abs(_this.viewportFocus.x)>1e-4||Math.abs(_this.viewportFocus.y)>1e-4;nextHasViewportFocusOffset!==_hasViewportFocusOffset&&(nextHasViewportFocusOffset||_viewportFocusOffset.setScalar(0),_hasViewportFocusOffset=nextHasViewportFocusOffset);if(!_hasViewportFocusOffset)return;let localCamera=_cacheObj,camera=_this.camera;camera.matrixDirty&&camera.updateMatrix();localCamera.matrixWorld=camera.matrix,localCamera.projectionMatrix=camera.projectionMatrix,_viewportFocusOffset.copy(_this.lookAt).project(localCamera),isFinite(_viewportFocusOffset.x)||_viewportFocusOffset.set(0,0,0);_viewportFocusOffset.x-=_this.viewportFocus.x,_viewportFocusOffset.y-=_this.viewportFocus.y,_viewportFocusOffset.unproject(localCamera),_viewportFocusOffset.sub(_this.lookAt),_this.camera.position.add(_viewportFocusOffset)}(),_this.wobbleStrength>0){let t=Render.TIME;_wobble.x=Math.cos(_wobbleAngle+t*(75e-5*_this.wobbleSpeed))*(_wobbleAngle+200*Math.sin(t*(95e-5*_this.wobbleSpeed))),_wobble.y=Math.sin(Math.asin(Math.cos(_wobbleAngle+t*(85e-5*_this.wobbleSpeed))))*(150*Math.sin(_wobbleAngle+t*(75e-5*_this.wobbleSpeed))),_wobble.x*=2*Math.sin(_wobbleAngle+t*(75e-5*_this.wobbleSpeed)),_wobble.y*=1.75*Math.cos(_wobbleAngle+t*(65e-5*_this.wobbleSpeed)),_wobble.x*=1.1*Math.cos(_wobbleAngle+t*(75e-5*_this.wobbleSpeed)),_wobble.y*=1.15*Math.sin(_wobbleAngle+t*(25e-5*_this.wobbleSpeed)),_wobble.z=Math.sin(_wobbleAngle+.0025*_wobble.x)*(100*_this.wobbleZ),_wobble.multiplyScalar(.001*_this.wobbleStrength*_strength.v),_innerGroup.position.lerp(_wobble,.07),_this.flag("hasWobble",!0)}else _this.flag("hasWobble")&&(_innerGroup.position.lerp(V3_ZERO,.07),_innerGroup.position.length()<.001&&(_innerGroup.position.set(0,0,0),_this.flag("hasWobble",!1)))}});class Base3D{constructor(){this.position=new Vector3D,this.rotation=new Euler,this.quaternion=new Quaternion,this.scale=new Vector3D(1,1,1),this._parent=null,this.up=new Vector3(0,1,0),this.isObject3D=!0,this.children=[],this.childrenLength=0,this.modelViewMatrix=new Matrix4,this.normalMatrix=new Matrix3,this.normalMatrixWorld=new Matrix3,this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.matrixDirty=!0,this.decomposeDirty=!0,this.visible=!0,this.hidden=!1,this.castShadow=!1,this.frustumCulled=!0,this.occlusionCulled=!1,this._renderOrder=0,this.worldPos=new Vector3,this.worldQuat=new Quaternion;const _this=this;this.quaternion.onChange(_=>{_this.matrixDirty=!0,_this.decomposeDirty=!0,_this.onMatrixDirty&&_this.onMatrixDirty(),_this.rotation.setFromQuaternion(_this.quaternion,void 0,!1)}),this.rotation.onChange(_=>{_this.matrixDirty=!0,_this.decomposeDirty=!0,_this.onMatrixDirty&&_this.onMatrixDirty(),_this.quaternion.setFromEuler(_this.rotation,!1)}),this.scale.onChange(_=>{_this.matrixDirty=!0,_this.decomposeDirty=!0,_this.onMatrixDirty&&_this.onMatrixDirty()}),this.position.onChange(_=>{_this.matrixDirty=!0,_this.decomposeDirty=!0,_this.onMatrixDirty&&_this.onMatrixDirty()})}get renderOrder(){return this._renderOrder}set renderOrder(value){this._renderOrder=value;let p=this._parent;for(;p;)p instanceof Scene&&(p.displayNeedsUpdate=!0),p=p._parent;for(let i=0;i<this.children.length;i++)this.children[i].renderOrder+=value}applyMatrix(matrix){return this.matrix.multiplyMatrices(matrix,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale),this}applyQuaternion(q){return this.quaternion.premultiply(q),this}setRotationFromAxisAngle(axis,angle){this.quaternion.setFromAxisAngle(axis,angle)}setRotationFromMatrix(m){this.quaternion.setFromRotationMatrix(m)}setRotationFromQuaternion(q){this.quaternion.copy(q)}localToWorld(v){return v.applyMatrix4(this.matrixWorld)}worldToLocal(v){let m1=this.M1||new Matrix4;return this.M1=m1,v.applyMatrix4(m1.getInverse(this.matrixWorld))}lookAt(x,y,z){let m1=this.M1||new Matrix4;this.M1=m1;let v=this.V1||new Vector3;this.V1=v,x.isVector3?v.copy(x):v.set(x,y,z),this.isCamera?m1.lookAt(this.position,v,this.up):m1.lookAt(v,this.position,this.up),this.quaternion.setFromRotationMatrix(m1)}add(object){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}if(object===this)return this;if(object&&object.isScene)throw"You can't add a scene to a group";if(object&&object.isObject3D?(null!==object._parent&&object._parent.remove(object),object._parent=this,this.children.push(object),this.childrenLength=this.children.length):console.error("Object is not instance of Object3D",object),this.isScene)this.displayNeedsUpdate=!0;else{let p=this._parent;for(;p;)p instanceof Scene&&(p.displayNeedsUpdate=!0),p=p._parent}return this}attach(object){this.updateMatrixWorld(!0);let m1=this.M1||new Matrix4;this.M1=m1;const worldInverse=this.M1.getInverse(this.matrixWorld);null!==object._parent&&(object._parent.updateMatrixWorld(!0),worldInverse.multiply(object._parent.matrixWorld)),object.applyMatrix(worldInverse),this.add(object),object.updateMatrixWorld(!0)}remove(object){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}if(this.isScene)this.displayNeedsUpdate=!0;else{let p=this._parent;for(;p;)p instanceof Scene&&(p.displayNeedsUpdate=!0),p=p._parent}this.children.remove(object),this.childrenLength=this.children.length}getWorldPosition(target,sleep){let v=this.V1||new Vector3;this.V1=v,target||(target=v),sleep||this.updateMatrixWorld();let el=this.matrixWorld.elements;return target.x=el[12],target.y=el[13],target.z=el[14],target}getWorldScale(target){let v=this.V1S||new Vector3;this.V1S=v;let v2=this.V12||new Vector3;this.V2=v2;let q=this.Q1||new Quaternion;return this.Q1=q,target||(target=v2),this.updateMatrixWorld(),this.matrixWorld.decompose(v,q,target),target}getWorldQuaternion(target){let v=this.V1Q||new Vector3;this.V1Q=v;let q=this.Q1||new Quaternion;return this.Q1=q,target||(target=q),this.updateMatrixWorld(),this.matrixWorld.decompose(v,target,v),target}traverse(callback){callback(this);let children=this.children;for(let i=0;i<children.length;i++)children[i].traverse(callback)}updateMatrix(){if(!1!==this.matrixAutoUpdate){if(this.matrix.compose(this.position,this.quaternion,this.scale),this.pivot){var px=this.pivot.x,py=this.pivot.y,pz=this.pivot.z,te=this.matrix.elements;te[12]+=px-te[0]*px-te[4]*py-te[8]*pz,te[13]+=py-te[1]*px-te[5]*py-te[9]*pz,te[14]+=pz-te[2]*px-te[6]*py-te[10]*pz}this.matrixWorldNeedsUpdate=!0}}updateMatrixWorld(force){if(!1===this.matrixAutoUpdate)return;if(!force&&!this.determineVisible())return;(this.determineDirty()||force)&&!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==force||(null===this._parent||this.determineNoTransform()?this.matrixWorld.copy(this.matrix):(this.matrixWorld.multiplyMatrices(this._parent.matrixWorld,this.matrix),RenderStats.active&&RenderStats.update("updateMatrixWorld")),this.decomposeDirty=!0,this.matrixWorldNeedsUpdate=!1);const children=this.children;for(let i=this.childrenLength-1;i>-1;i--)children[i].updateMatrixWorld(force);this.matrixDirty=!1}clone(recursive){return(new this.constructor).copy(this,recursive)}copy(source,recursive){if(this.name=source.name,this.up.copy(source.up),this.position.copy(source.position),this.quaternion.copy(source.quaternion),this.scale.copy(source.scale),this.matrix.copy(source.matrix),this.matrixWorld.copy(source.matrixWorld),this.matrixAutoUpdate=source.matrixAutoUpdate,this.matrixWorldNeedsUpdate=source.matrixWorldNeedsUpdate,this.visible=source.visible,this.castShadow=source.castShadow,this.receiveShadow=source.receiveShadow,this.frustumCulled=source.frustumCulled,this.renderOrder=source.renderOrder,!0===recursive)for(let i=0;i<source.children.length;i++){let child=source.children[i];this.add(child.clone())}return this}render(){}determineVisible(){if(!this.visible||this.hidden)return!1;let p=this._parent;for(;p;){if(!p.visible||p.hidden)return!1;p=p._parent}return!0}determineDirty(){let p=this._parent;for(;p;){if(p.matrixDirty)return!0;p=p._parent}return this.matrixDirty}determineNoTransform(){return this._parent?this._parent.determineNoTransform()&&this.matrix.isIdentity():this.matrix.isIdentity()}translateX(distance){this.xAxis||(this.xAxis=new Vector3(1,0,0)),this.translateOnAxis(this.xAxis,distance)}translateY(distance){this.yAxis||(this.yAxis=new Vector3(0,1,0)),this.translateOnAxis(this.yAxis,distance)}translateZ(distance){this.zAxis||(this.zAxis=new Vector3(0,0,1)),this.translateOnAxis(this.zAxis,distance)}translateOnAxis(axis,distance){let v=this.V1||new Vector3;return this.V1=v,v.copy(axis).applyQuaternion(this.quaternion),this.position.add(v.multiplyScalar(distance)),this}upload(){this.shader&&(this.shader.upload(this,this.geometry),this.shader.shadow&&this.shader.shadow.upload(this,this.geometry)),this.geometry&&this.geometry.upload(this,this.shader)}destroy(){let i=0;for(;i<this.children.length;){let child=this.children[i];child.deleted?i+=1:(child.destroy(),child.deleted=!0)}this.geometry&&this.geometry.destroy&&this.geometry.destroy(this),this.shader&&this.shader.destroy&&this.shader.destroy(this),this.hitDestroy&&this.hitDestroy(),this.physics?.destroy&&this.physics.destroy(),this._gl&&this._gl.ubo&&this._gl.ubo.destroy(),this._gl&&this._gl.vao&&this._gl.vao.destroy(),this._gl&&(this._gl=null),this._parent&&this._parent.remove(this),this.parent&&this.parent.__destroyChild&&this.parent.__destroyChild(this.__id),this.deleted=!0}}Base3D.DIRTY_EPSILON=1e-4,Class(function Renderer(_params={}){Inherit(this,Component);const _this=this;var _canvas,_gl,_width,_height,_anisotropy,_clearColor,_projScreenMatrix,_frustum,_ubo,_dpr=1,_resolution=new Vector2,_m0=new Matrix4,_m1=new Matrix4,_time={value:0},_stencilActive=!1;function initCameraUBO(camera){camera._ubo=new UBO(0,_gl),camera._ubo.push({value:camera.projectionMatrix}),camera._ubo.push({value:camera.matrixWorldInverse}),camera._ubo.push({value:camera.worldPos}),camera._ubo.push({value:camera.worldQuat}),camera._ubo.push({value:_resolution}),camera._ubo.push(_time),camera._ubo.push(Render.timeScaleUniform),camera._ubo.upload()}function sortFrontToBack(array,sortOrder,camera){for(let i=array.length-1;i>-1;i--){let obj=array[i];obj.__sortVec||(obj.__sortVec=new Vector3),sortOrder==Scene.FRONT_TO_BACK_BOUNDING&&obj.geometry&&obj.geometry.boundingSphere?obj.__sortVec.copy(obj.geometry.boundingSphere.center):obj.__sortVec.setFromMatrixPosition(camera.modelViewMatrix)}array.sort((a,b)=>b.__sortVec.z-a.__sortVec.z)}function projectObject(object,camera,scene){if(object.isOcclusionMesh&&scene.displayNeedsUpdate&&scene.toRender[0].push(object),object.doNotProject)return;let isVisible=!1;if(void 0!==object.shader){let visible=object.determineVisible()&&object.shader.visible&&!object.shader.neverRender&&!object.hidden;visible&&(object.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld),object.normalMatrix.getNormalMatrix(object.modelViewMatrix),object.normalMatrixWorld.getNormalMatrix(object.matrixWorld),null!==object._occlusionMesh&&object.isMesh&&this.useOcclusionQuery&&(object.updateOcclusionMesh(),object._occlusionMesh.matrixWorld.copy(object.matrixWorld),object._occlusionMesh.normalMatrix.copy(object.normalMatrix),object._occlusionMesh.modelViewMatrix.copy(object.modelViewMatrix))),isVisible=visible,(scene.displayNeedsUpdate||object.shader.transparent&&!scene.disableAutoSort&&visible)&&object.getWorldPosition(object.worldPos),scene.displayNeedsUpdate&&scene.toRender[object.shader.transparent?1:0].push(object)}else isVisible=object.visible&&!object.hidden;if(isVisible||scene.displayNeedsUpdate)for(let i=object.childrenLength-1;i>-1;i--)projectObject(object.children[i],camera,scene)}function attachSceneUniforms(object,scene,camera){if(Shader.renderer.appendUniform(object.shader,"normalMatrix",object.normalMatrix),Shader.renderer.appendUniform(object.shader,"normalMatrixWorld",object.normalMatrixWorld),Shader.renderer.appendUniform(object.shader,"modelMatrix",object.matrixWorld),Shader.renderer.appendUniform(object.shader,"modelViewMatrix",object.modelViewMatrix),_ubo?camera._ubo.bind(object.shader._gl.program,"global"):(Shader.renderer.appendUniform(object.shader,"projectionMatrix",camera.projectionMatrix),Shader.renderer.appendUniform(object.shader,"viewMatrix",camera.matrixWorldInverse),Shader.renderer.appendUniform(object.shader,"cameraPosition",camera.worldPos),Shader.renderer.appendUniform(object.shader,"cameraQuaternion",camera.worldQuat),Shader.renderer.appendUniform(object.shader,"resolution",_resolution),Shader.renderer.appendUniform(object.shader,"time",_time.value),Shader.renderer.appendUniform(object.shader,"timeScale",Render.timeScaleUniform.value)),_this.shadows&&object.shader.receiveShadow&&!_this.overridePreventShadows){let lights=Lighting.getShadowLights();object._gl||(object._gl={}),object._gl.shadowData||(object._gl.shadowData={combined:new Float32Array(16*lights.length)});for(let i=0;i<lights.length;i++){let light=lights[i];_m1.multiplyMatrices(light.shadow.camera.matrixWorldInverse,object.matrixWorld),_m0.multiplyMatrices(light.shadow.camera.projectionMatrix,_m1),_m0.toArray(object._gl.shadowData.combined,16*i)}scene._shadowData&&scene._shadowData.count&&(object.shader.uniforms.shadowMap.value=scene._shadowData[_this.overridePreventShadows?"emptyMaps":"maps"],Shader.renderer.appendUniform(object.shader,"shadowMatrix",object._gl.shadowData.combined,"matrix"),Shader.renderer.appendUniform(object.shader,"shadowLightPos",scene._shadowData.pos,"vec3"),Shader.renderer.appendUniform(object.shader,"shadowSize",scene._shadowData.size,"float"))}}function attachShadowUniforms(object,scene,light){light._mvm||(light._mvm=new Matrix4),light._nm||(light._nm=new Matrix3),light._mvm.multiplyMatrices(light.shadow.camera.matrixWorldInverse,object.matrixWorld),light._nm.getNormalMatrix(object.modelViewMatrix),Shader.renderer.appendUniform(object.shader.shadow,"normalMatrix",light._nm),Shader.renderer.appendUniform(object.shader.shadow,"modelMatrix",object.matrixWorld),Shader.renderer.appendUniform(object.shader.shadow,"modelViewMatrix",light._mvm),_ubo?(object.shader._gl||object.shader.upload(),light.shadow.camera._ubo.bind(object.shader._gl.program,"global")):(Shader.renderer.appendUniform(object.shader.shadow,"projectionMatrix",light.shadow.camera.projectionMatrix),Shader.renderer.appendUniform(object.shader.shadow,"viewMatrix",light.shadow.camera.matrixWorldInverse))}function loop(t,dt){_time.value+=.001*dt}function render(scene,camera,rt){rt&&rt.width?(_resolution.set(rt.width,rt.height),rt.multisample?RenderTarget.renderer.bind(rt._rtMultisample):RenderTarget.renderer.bind(rt)):(Renderer.overrideViewport||(_gl.viewport(0,0,_width*_dpr,_height*_dpr),_resolution.set(_canvas.width,_canvas.height)),_this.autoClear&&(_gl.clearColor(Renderer.CLEAR[0],Renderer.CLEAR[1],Renderer.CLEAR[2],Renderer.CLEAR[3]),_gl.clear(_gl.COLOR_BUFFER_BIT|_gl.DEPTH_BUFFER_BIT))),camera.getWorldPosition(camera.worldPos),camera.getWorldQuaternion(camera.worldQuat),_frustum.setFromCamera(camera),_ubo&&(camera._ubo?camera._ubo.update():initCameraUBO(camera));for(let l=0;l<2;l++){let len=scene.toRender[l].length;for(let i=0;i<len;i++){let object=scene.toRender[l][i];if(object.onBeforeRender&&object.onBeforeRender(),object._drawing=!1,object.determineVisible()&&object.shader.visible&&!object.shader.neverRender&&!object.neverRender&&(_this.useOcclusionQuery&&object._occlusionGroup&&(object._occlusionGroup.updateOcclusionBoundingBox(),object._occlusionGroup.updateOcclusionVisibility(object?._gl?.occluded)),_this.useOcclusionQuery&&object.isOcclusionMesh&&_this.type==Renderer.WEBGL2&&object._queryMesh.occlusionCulled&&(object.shader.draw(object,object.geometry),attachSceneUniforms(object,scene,camera),object.geometry.draw(object,object.shader,!0)),!1===object.frustumCulled||!0===_frustum.intersectsObject(object))){if(object._drawing=!0,object.shader.nullRender||object?._gl?.occluded||object.isOcclusionMesh)continue;let doubleSideTransparency=object.shader.side===Shader.DOUBLE_SIDE_TRANSPARENCY;doubleSideTransparency&&(object.shader.side=Shader.BACK_SIDE),object.shader.draw(object,object.geometry),attachSceneUniforms(object,scene,camera),object.geometry.draw(object,object.shader),doubleSideTransparency&&(object.shader.side=Shader.FRONT_SIDE,object.shader.draw(object,object.geometry),attachSceneUniforms(object,scene,camera),object.geometry.draw(object,object.shader),object.shader.side=Shader.DOUBLE_SIDE_TRANSPARENCY)}}}rt&&rt.width&&(!rt.cube&&rt.texture.generateMipmaps&&(_gl.bindTexture(_gl.TEXTURE_2D,rt.texture._gl),_gl.generateMipmap(_gl.TEXTURE_2D),_gl.bindTexture(_gl.TEXTURE_2D,null)),rt.cube&&rt.texture.generateMipmaps&&(_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,rt.texture._gl),_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP),_gl.texParameteri(_gl.TEXTURE_CUBE_MAP,_gl.TEXTURE_MIN_FILTER,_gl.LINEAR_MIPMAP_LINEAR),_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,null)),rt.multisample?(_this.blit(rt._rtMultisample,rt),RenderTarget.renderer.unbind(rt._rtMultisample)):RenderTarget.renderer.unbind(rt))}this.autoClear=!0,this.shadows=Renderer.SHADOWS_MED,this.useOcclusionQuery=!1,Renderer.instance=_this,Renderer.CLEAR=[0,0,0,1],function initContext(){let contextAttributes={antialias:void 0!==_params.antialias&&_params.antialias,powerPreference:_params.powerPreference,preserveDrawingBuffer:_params.preserveDrawingBuffer,xrCompatible:_params.xrCompatible,alpha:void 0!==_params.alpha&&_params.alpha,premultipliedAlpha:void 0===_params.premultipliedAlpha||_params.premultipliedAlpha,stencil:_params.stencil};if(Device.graphics.webgl.iOSContextLoss&&delete contextAttributes.powerPreference,_this.stencil=!!_params.stencil,(_canvas=_params.canvas||document.createElement("canvas")).addEventListener("webglcontextlost",()=>Events.emitter._fireEvent(Events.WEBGL_CONTEXT_LOSS),!1),_params.gl?(_gl=_params.gl,_this.type=Device.graphics.webgl.version.includes(["webgl 2","webgl2"])?Renderer.WEBGL2:Renderer.WEBGL1):Device.graphics.webgl?["webgl2","webgl","experimental-webgl"].forEach(name=>{_gl||"webgl2"==name&&_params.forceWebGL1||(_gl=_canvas.getContext(name,contextAttributes),_this.type=_gl&&"webgl2"==name?Renderer.WEBGL2:Renderer.WEBGL1)}):(_gl=new NoGLPolyfill,_this.type=Renderer.WEBGL2),!_gl)throw"Error! Could not create WebGL context";_this.domElement=_canvas,_canvas.style.background="black",Renderer.type=_this.type,Renderer.context=_this.context=_gl}(),function setExtensions(){_this.extensions={},_this.type!=Renderer.WEBGL2?(_this.extensions.VAO=_gl.getExtension("OES_vertex_array_object"),_this.extensions.instancedArrays=_gl.getExtension("ANGLE_instanced_arrays"),_this.extensions.standardDerivatives=_gl.getExtension("OES_standard_derivatives"),_this.extensions.elementIndexUint=_gl.getExtension("OES_element_index_uint"),_this.extensions.depthTextures=_gl.getExtension("WEBGL_depth_texture"),_this.extensions.drawBuffers=_gl.getExtension("WEBGL_draw_buffers"),_this.extensions.halfFloat=_gl.getExtension("OES_texture_half_float"),_this.extensions.float=_gl.getExtension("OES_texture_float"),_this.extensions.colorBufferFloat=_gl.getExtension("WEBGL_color_buffer_float"),_this.extensions.lod=_gl.getExtension("EXT_shader_texture_lod"),_this.extensions.minMax=_gl.getExtension("EXT_blend_minmax")):(_this.extensions.disjointTimerQuery=_gl.getExtension("EXT_disjoint_timer_query_webgl2"),_this.extensions.colorBufferFloat=_gl.getExtension("EXT_color_buffer_float"),_this.extensions.oculusMultiview=_gl.getExtension("OCULUS_multiview"),_this.extensions.oculusMultiview2=_gl.getExtension("OVR_multiview2")),_this.extensions.filterFloat=_gl.getExtension("OES_texture_float_linear"),_this.extensions.anisotropy=_gl.getExtension("EXT_texture_filter_anisotropic")||_gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),_this.extensions.astc=_gl.getExtension("WEBGL_compressed_texture_astc"),_this.extensions.atc=_gl.getExtension("WEBGL_compressed_texture_atc"),_this.extensions.etc=_gl.getExtension("WEBGL_compressed_texture_etc"),_this.extensions.etc1=_gl.getExtension("WEBGL_compressed_texture_etc1"),_this.extensions.pvrtc=_gl.getExtension("WEBGL_compressed_texture_pvrtc")||_gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),_this.extensions.s3tc=_gl.getExtension("WEBGL_compressed_texture_s3tc")||_gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),_this.extensions.bptc=_gl.getExtension("EXT_texture_compression_bptc"),_this.extensions.s3tc_srgb=_gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),Renderer.extensions=_this.extensions}(),function initRenderers(){Geometry.renderer=new GeometryRendererWebGL(_gl),Texture.renderer=new TextureRendererWebGL(_gl),Shader.renderer=new ShaderRendererWebGL(_gl),RenderTarget.renderer=new FBORendererWebGL(_gl)}(),function initMath(){_projScreenMatrix=new Matrix4,new Vector3,_frustum=new Frustum}(),function initUBO(){_this.type==Renderer.WEBGL2&&(_ubo=!0),Renderer.UBO=_ubo}(),_this.startRender(loop),this.render=function(scene,camera,rt,forceToScreen,specialFbo){_this.preventRender||(scene.displayNeedsUpdate&&(scene.toRender[0].length=0,scene.toRender[1].length=0),_this.modifyCameraBeforeRender&&(camera.renderCamera||(camera.renderCamera=camera.clone()),camera.renderCamera.copy(camera),camera=camera.renderCamera,_this.modifyCameraBeforeRender(camera)),scene.updateMatrixWorld(),camera.parent||camera.updateMatrixWorld(),projectObject(scene,camera,scene),(scene.displayNeedsUpdate||scene.opaqueSortOrder==Scene.FRONT_TO_BACK)&&function sortOpaque(array,sortOrder,camera){for(let i=array.length-1;i>-1;i--){let obj=array[i];obj.shader._gl||obj.shader.upload(obj,obj.geometry)}sortOrder==Scene.FRONT_TO_BACK?sortFrontToBack(array,sortOrder,camera):array.sort((a,b)=>{if(a.renderOrder!==b.renderOrder)return a.renderOrder-b.renderOrder;let aid=a.shader._gl._id,bid=b.shader._gl._id;return aid!==bid?aid-bid:a.id-b.id})}(scene.toRender[0],scene.opaqueSortOrder,camera),(scene.displayNeedsUpdate||scene.toRender[1].length&&!scene.disableAutoSort)&&function sortTransparent(array,sortOrder,camera){RenderStats.update("SortTransparent",array.length),sortOrder==Scene.FRONT_TO_BACK||sortOrder==Scene.FRONT_TO_BACK_BOUNDING?sortFrontToBack(array,sortOrder,camera):array.sort((a,b)=>a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.worldPos.z!==b.worldPos.z?a.worldPos.z-b.worldPos.z:a.id-b.id)}(scene.toRender[1],scene.transparentSortOrder,camera),_this.shadows&&!_this.overridePreventShadows&&!_this.pauseShadowRendering&&scene.hasShadowLight&&function renderShadows(scene,camera){let render=(light,lightIndex)=>{RenderTarget.renderer.bind(light.shadow.rt),RenderStats.update("ShadowLights"),light.shadow.camera.updateMatrixWorld(),camera.getWorldPosition(camera.worldPos),_frustum.setFromCamera(camera),_ubo&&(light.shadow.camera._ubo?light.shadow.camera._ubo.update():initCameraUBO(light.shadow.camera));for(let l=0;l<2;l++)for(let i=0;i<scene.toRender[l].length;i++){let object=scene.toRender[l][i];object.onBeforeRenderShadow&&object.onBeforeRenderShadow(light,lightIndex)||!0===object.castShadow&&object.determineVisible()&&object.shader.visible&&!object.shader.neverRender&&!object.neverRender&&(!1!==object.frustumCulled&&!0!==_frustum.intersectsObject(object)||(object.shader.shadow||Lighting.initShadowShader(object),object.shader.shadow.draw(object,object.geometry),attachShadowUniforms(object,0,light),object.geometry.draw(object,object.shader.shadow),_ubo&&light.shadow.camera._ubo.unbind(),RenderStats.update("ShadowMesh")))}RenderTarget.renderer.unbind(light.shadow.rt)},lights=Lighting.getShadowLights();scene._shadowData||(scene._shadowData={maps:[],emptyMaps:[],size:new Float32Array(lights.length),pos:new Float32Array(3*lights.length),count:lights.length}),scene._shadowData.count!=lights.length&&(scene._shadowData.size=new Float32Array(lights.length),scene._shadowData.pos=new Float32Array(3*lights.length),scene._shadowData.count=lights.length);for(let i=0;i<lights.length;i++){let light=lights[i];light.prepareRender(),scene._shadowData.maps[i]=light.shadow.rt.depth,scene._shadowData.emptyMaps[i]=Utils3D.getEmptyTexture(),scene._shadowData.size[i]=light.shadow.size,light.position.toArray(scene._shadowData.pos,3*i)}for(let i=0;i<lights.length;i++){let light=lights[i];!light.shadow.frozen&&light.determineVisible()&&render(light,i)}}(scene,camera),specialFbo&&_gl.bindFramebuffer(_gl.FRAMEBUFFER,specialFbo),rt&&!rt.vrRT||!_this.vrRenderingPath||forceToScreen?rt||!_this.arRenderingPath||forceToScreen?render(scene,camera,rt):_this.arRenderingPath(render,scene,camera):_this.vrRenderingPath(scene,camera,_projScreenMatrix,_frustum,attachSceneUniforms,rt),specialFbo&&_gl.bindFramebuffer(_gl.FRAMEBUFFER,null),scene.displayNeedsUpdate=!1,Shader.renderer.resetState())},this.renderSingle=function(object,camera,rt){if(_this.preventRender)return;rt?(_resolution.set(rt.width,rt.height),rt.multisample?RenderTarget.renderer.bind(rt._rtMultisample):RenderTarget.renderer.bind(rt)):(Renderer.overrideViewport||(_gl.viewport(0,0,_width*_dpr,_height*_dpr),_resolution.set(_canvas.width,_canvas.height)),_this.autoClear&&(_gl.clearColor(Renderer.CLEAR[0],Renderer.CLEAR[1],Renderer.CLEAR[2],Renderer.CLEAR[3]),_gl.clear(_gl.COLOR_BUFFER_BIT|_gl.DEPTH_BUFFER_BIT))),camera.getWorldPosition(camera.worldPos),camera.getWorldQuaternion(camera.worldQuat),object.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld),object.normalMatrix.getNormalMatrix(object.modelViewMatrix),object.normalMatrixWorld.getNormalMatrix(object.matrixWorld),object.getWorldPosition(object.worldPos),_ubo&&(camera._ubo?camera.pauseUBO||camera._ubo.update():initCameraUBO(camera));let doubleSideTransparency=object.shader.side===Shader.DOUBLE_SIDE_TRANSPARENCY;doubleSideTransparency&&(object.shader.side=Shader.BACK_SIDE,object.shader._renderFrontFirst&&(object.shader.side=Shader.FRONT_SIDE)),object.shader.draw(object,object.geometry),object.noMatrices||(Shader.renderer.appendUniform(object.shader,"normalMatrix",object.normalMatrix),Shader.renderer.appendUniform(object.shader,"normalMatrixWorld",object.normalMatrixWorld),Shader.renderer.appendUniform(object.shader,"modelMatrix",object.matrixWorld),Shader.renderer.appendUniform(object.shader,"modelViewMatrix",object.modelViewMatrix)),_ubo?camera._ubo.bind(object.shader._gl.program,"global"):(Shader.renderer.appendUniform(object.shader,"projectionMatrix",camera.projectionMatrix),Shader.renderer.appendUniform(object.shader,"viewMatrix",camera.matrixWorldInverse),Shader.renderer.appendUniform(object.shader,"cameraPosition",camera.worldPos),Shader.renderer.appendUniform(object.shader,"cameraQuaternion",camera.worldQuat),Shader.renderer.appendUniform(object.shader,"resolution",_resolution),Shader.renderer.appendUniform(object.shader,"time",_time.value),Shader.renderer.appendUniform(object.shader,"timeScale",Render.timeScaleUniform.value)),object.geometry.draw(object,object.shader),doubleSideTransparency&&(object.shader.side=Shader.FRONT_SIDE,object.shader._renderFrontFirst&&(object.shader.side=Shader.BACK_SIDE),object.shader.draw(object,object.geometry),object.geometry.draw(object,object.shader),object.shader.side=Shader.DOUBLE_SIDE_TRANSPARENCY),_ubo&&camera._ubo.unbind(),rt&&(rt.texture.generateMipmaps&&(_gl.bindTexture(_gl.TEXTURE_2D,rt.texture._gl),_gl.generateMipmap(_gl.TEXTURE_2D),_gl.bindTexture(_gl.TEXTURE_2D,null)),rt.multisample?(_this.blit(rt._rtMultisample,rt),RenderTarget.renderer.unbind(rt._rtMultisample)):RenderTarget.renderer.unbind(rt)),Shader.renderer.resetState()},this.setClearColor=function(color,alpha=1){_clearColor=new Color(color),Renderer.CLEAR=[_clearColor.r,_clearColor.g,_clearColor.b,alpha]},this.setClearAlpha=function(alpha){Renderer.CLEAR[3]=alpha},this.getClearColor=function(){return _clearColor||(_clearColor=new Color(0,0,0)),_clearColor},this.getClearAlpha=function(){return Renderer.CLEAR[3]},this.setPixelRatio=function(dpr){_dpr=dpr,this.setSize(_width,_height)},this.setSize=function(width,height){_width=width,_height=height,_canvas.width=width*_dpr,_canvas.height=height*_dpr,_canvas.style.width=`${width}px`,_canvas.style.height=`${height}px`,_resolution.set(_canvas.width,_canvas.height)},this.getMaxAnisotropy=function(){return Device.graphics.webgl&&_this.extensions.anisotropy?(_anisotropy||(_anisotropy=_gl.getParameter(_this.extensions.anisotropy.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),_anisotropy):0},this.readPixels=function(rt,x=0,y=0,width,height,array,type=_gl.UNSIGNED_BYTE,format=_gl.RGBA){width||(width=rt?rt.width:1),height||(height=rt?rt.height:1),width=Math.round(width),height=Math.round(height),type=type||_gl.UNSIGNED_BYTE;let w=Math.round(width-x),h=Math.round(height-y);return array||(array=new Uint8Array(w*h*4)),_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt?rt._gl:null),_gl.readPixels(x,y,width,height,format,type,array),_gl.bindFramebuffer(_gl.FRAMEBUFFER,null),array},this.readPixelsAsync=async function(rt,x=0,y=0,width,height,array,type=_gl.UNSIGNED_BYTE,format=_gl.RGBA){if(_this.type!=Renderer.WEBGL2)return console.warn("readPixelsAsync is not supported in WebGL1, using readPixels instead"),this.readPixels(rt,x,y,width,height,array,type,format);width||(width=rt?rt.width:1),height||(height=rt?rt.height:1),width=Math.round(width),height=Math.round(height),type=type||_gl.UNSIGNED_BYTE;let w=Math.round(width-x),h=Math.round(height-y);array||(array=new Uint8Array(w*h*4)),_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt?rt._gl:null);const bufpak=_gl.createBuffer();_gl.bindBuffer(_gl.PIXEL_PACK_BUFFER,bufpak),_gl.bufferData(_gl.PIXEL_PACK_BUFFER,array.byteLength,_gl.STREAM_READ),_gl.readPixels(0,0,width,height,format,type,0),_gl.bindFramebuffer(_gl.FRAMEBUFFER,null);var sync=_gl.fenceSync(_gl.SYNC_GPU_COMMANDS_COMPLETE,0);if(!sync)return null;_gl.flush();try{return await function clientWaitAsync(sync,flags=0,fps=30){const promise=Promise.create();var check=function(){var res=_gl.clientWaitSync(sync,flags,0);if(res==_gl.WAIT_FAILED)return _this.stopRender(check),void promise.reject();res!=_gl.TIMEOUT_EXPIRED?(_this.stopRender(check),promise.resolve()):_this.startRender(check,fps)};return check(),promise}(sync,0),_gl.bindBuffer(_gl.PIXEL_PACK_BUFFER,bufpak),_gl.getBufferSubData(_gl.PIXEL_PACK_BUFFER,0,array),array}finally{_gl.deleteSync(sync),_gl.bindBuffer(_gl.PIXEL_PACK_BUFFER,bufpak),_gl.deleteBuffer(bufpak),_gl.bindBuffer(_gl.PIXEL_PACK_BUFFER,null)}},this.blit=function(input,output,mask=_gl.COLOR_BUFFER_BIT){if(_this.type!=Renderer.WEBGL2)return!1;input._gl||input.upload(),output._gl||output.upload();let prevReadFBO=_gl.getParameter(_gl.READ_FRAMEBUFFER_BINDING),prevDrawFBO=_gl.getParameter(_gl.DRAW_FRAMEBUFFER_BINDING);if(_gl.bindFramebuffer(_gl.READ_FRAMEBUFFER,input._gl),_gl.bindFramebuffer(_gl.DRAW_FRAMEBUFFER,output._gl),input===output._rtMultisample&&(output.depth&&(mask|=_gl.DEPTH_BUFFER_BIT),output.stencil&&(mask|=_gl.STENCIL_BUFFER_BIT)),_gl.blitFramebuffer(0,0,input.width,input.height,0,0,output.width,output.height,mask,_gl.NEAREST),input===output._rtMultisample&&output.multi){let attachments=output.attachments;for(let i=1;i<attachments.length;i++){let texture=attachments[i];_gl.readBuffer(_gl[`COLOR_ATTACHMENT${i}`]),_gl.bindFramebuffer(_gl.DRAW_FRAMEBUFFER,texture._blitFramebuffer),_gl.blitFramebuffer(0,0,input.width,input.height,0,0,output.width,output.height,mask,_gl.NEAREST)}_gl.readBuffer(_gl.COLOR_ATTACHMENT0)}return _gl.bindFramebuffer(_gl.READ_FRAMEBUFFER,prevReadFBO),_gl.bindFramebuffer(_gl.DRAW_FRAMEBUFFER,prevDrawFBO),!0},this.setupStencilMask=function(ref=1){_stencilActive||(_gl.enable(_gl.STENCIL_TEST),_gl.clear(_gl.STENCIL_BUFFER_BIT|_gl.DEPTH_BUFFER_BIT)),_stencilActive=!0,_gl.stencilFunc(_gl.ALWAYS,ref,255),_gl.stencilOp(_gl.KEEP,_gl.KEEP,_gl.REPLACE),_gl.stencilMask(255),_gl.colorMask(!1,!1,!1,!1),_gl.disable(_gl.DEPTH_TEST)},this.setupStencilDraw=function(mode,ref=1){_gl.colorMask(!0,!0,!0,!0),_gl.enable(_gl.DEPTH_TEST),_gl.stencilFunc("inside"==mode?_gl.EQUAL:_gl.NOTEQUAL,ref,255),_gl.stencilOp(_gl.KEEP,_gl.KEEP,_gl.KEEP)},this.clearStencil=function(){_gl.disable(_gl.STENCIL_TEST),_stencilActive=!1},this.clearDepth=function(rt){rt&&!rt._gl&&rt.upload(),rt&&_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt._gl),_gl.clear(_gl.DEPTH_BUFFER_BIT),rt&&_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)},this.clearColor=function(rt){rt&&!rt._gl&&rt.upload(),rt&&_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt._gl),_gl.clearColor(Renderer.CLEAR[0],Renderer.CLEAR[1],Renderer.CLEAR[2],Renderer.CLEAR[3]),_gl.clear(_gl.COLOR_BUFFER_BIT),rt&&_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)},this.get("resolution",_=>_resolution),this.get("time",_=>_time),this.get("canvas",_=>_canvas)},_=>{Renderer.WEBGL1="webgl1",Renderer.WEBGL2="webgl2",Renderer.STATIC_SHADOWS="static_shadows",Renderer.SHADOWS_LOW="shadows_low",Renderer.SHADOWS_MED="shadows_med",Renderer.SHADOWS_HIGH="shadows_high",Renderer.ID=0});class CameraBase3D extends Base3D{constructor(){super(),this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.isCamera=!0}copy(source,recursive){return Base3D.prototype.copy.call(this,source,recursive),this.matrixWorldInverse.copy(source.matrixWorldInverse),this.projectionMatrix.copy(source.projectionMatrix),this}updateMatrixWorld(force){Base3D.prototype.updateMatrixWorld.call(this,force),this.offsetMatrixWorld&&this.matrixWorld.multiply(this.offsetMatrixWorld),this.matrixWorldInverse.getInverse(this.matrixWorld)}clone(){return(new this.constructor).copy(this)}destroy(){this._interaction3d&&(this._interaction3d.destroy(),this._interaction3d=null),super.destroy()}}class CubeCamera extends Base3D{constructor(near=.1,far=1e3,cubeResolution=512){super();this.px=new PerspectiveCamera(90,1,near,far),this.px.up.set(0,-1,0),this.px.lookAt(new Vector3(1,0,0)),this.add(this.px),this.nx=new PerspectiveCamera(90,1,near,far),this.nx.up.set(0,-1,0),this.nx.lookAt(new Vector3(-1,0,0)),this.add(this.nx),this.py=new PerspectiveCamera(90,1,near,far),this.py.up.set(0,0,1),this.py.lookAt(new Vector3(0,1,0)),this.add(this.py),this.ny=new PerspectiveCamera(90,1,near,far),this.ny.up.set(0,0,-1),this.ny.lookAt(new Vector3(0,-1,0)),this.add(this.ny),this.pz=new PerspectiveCamera(90,1,near,far),this.pz.up.set(0,-1,0),this.pz.lookAt(new Vector3(0,0,1)),this.add(this.pz),this.nz=new PerspectiveCamera(90,1,near,far),this.nz.up.set(0,-1,0),this.nz.lookAt(new Vector3(0,0,-1)),this.add(this.nz),this.rt=new CubeRenderTarget(cubeResolution,cubeResolution)}render(scene=World.SCENE,renderer=World.RENDERER){let rt=this.rt;this.updateMatrixWorld(!0),this.beforeRender&&this.beforeRender(this.px),rt.activeFace=0,renderer.render(scene,this.px,rt),this.afterRender&&this.afterRender(rt),this.beforeRender&&this.beforeRender(this.nx),rt.activeFace=1,renderer.render(scene,this.nx,rt),this.afterRender&&this.afterRender(rt),this.beforeRender&&this.beforeRender(this.py),rt.activeFace=2,renderer.render(scene,this.py,rt),this.afterRender&&this.afterRender(rt),this.beforeRender&&this.beforeRender(this.ny),rt.activeFace=3,renderer.render(scene,this.ny,rt),this.afterRender&&this.afterRender(rt),this.beforeRender&&this.beforeRender(this.pz),rt.activeFace=4,renderer.render(scene,this.pz,rt),this.afterRender&&this.afterRender(rt),this.beforeRender&&this.beforeRender(this.nz),rt.activeFace=5,renderer.render(scene,this.nz,rt),this.afterRender&&this.afterRender(rt)}}class OrthographicCamera extends CameraBase3D{constructor(left,right,top,bottom,near,far){super(),this.isOrthographicCamera=!0,this.zoom=1,this.left=left,this.right=right,this.top=top,this.bottom=bottom,this.near=void 0!==near?near:.1,this.far=void 0!==far?far:2e3,this.position.z=1,this.updateProjectionMatrix()}clone(){return(new OrthographicCamera).copy(this)}copy(source,recursive){return CameraBase3D.prototype.copy.call(this,source,recursive),this.left=source.left,this.right=source.right,this.top=source.top,this.bottom=source.bottom,this.near=source.near,this.far=source.far,this.zoom=source.zoom,this.view=null===source.view?null:Object.assign({},source.view),this}updateProjectionMatrix(){let dx=(this.right-this.left)/(2*this.zoom),dy=(this.top-this.bottom)/(2*this.zoom),cx=(this.right+this.left)/2,cy=(this.top+this.bottom)/2,left=cx-dx,right=cx+dx,top=cy+dy,bottom=cy-dy;this.projectionMatrix.makeOrthographic(left,right,top,bottom,this.near,this.far)}setViewport(width,height){this.left=width/-2,this.right=width/2,this.top=height/2,this.bottom=height/-2,this.updateProjectionMatrix()}}class PerspectiveCamera extends CameraBase3D{constructor(fov,aspect,near,far){super(),this.type="PerspectiveCamera",this.fov=fov||50,this.zoom=1,this.near=near||.1,this.far=far||2e3,this.focus=10,this.aspect=aspect||1,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}clone(){return(new PerspectiveCamera).copy(this)}copy(source,recursive){return CameraBase3D.prototype.copy.call(this,source,recursive),this.fov=source.fov,this.zoom=source.zoom,this.near=source.near,this.far=source.far,this.focus=source.focus,this.aspect=source.aspect,this.filmGauge=source.filmGauge,this.filmOffset=source.filmOffset,this}setFocalLength(focalLength){let vExtentSlope=.5*this.getFilmHeight()/focalLength;this.fov=Math.degrees(2*Math.atan(vExtentSlope)),this.updateProjectionMatrix()}getFocalLength(){let vExtentSlope=Math.tan(Math.radians(.5*this.fov));return.5*this.getFilmHeight()/vExtentSlope}getEffectiveFOV(){return Math.degrees(2*Math.atan(Math.tan(Math.radians(.5*this.fov))/this.zoom))}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}updateProjectionMatrix(){let near=this.near,top=near*Math.tan(Math.radians(.5*this.fov))/this.zoom,height=2*top,width=this.aspect*height,left=-.5*width,skew=(this.view,this.filmOffset);0!==skew&&(left+=near*skew/this.getFilmWidth()),this.projectionMatrix.makePerspective(left,left+width,top,top-height,near,this.far)}}class Geometry{constructor(){this.attributes=Geometry.createAttributes(this),this.drawRange={start:0,end:0},this.boundingBox=null,this.boundingSphere=null,this.index=null,this.maxInstancedCount=void 0,this.keepAlive=!1,this.id=Utils.timestamp()}draw(mesh,shader,isQuery=!1){Geometry.renderer.draw(this,mesh,shader,isQuery)}upload(mesh,shader){Geometry.renderer.upload(this,mesh,shader)}destroy(mesh){Geometry.renderer.destroy(this,mesh)}addAttribute(name,attribute){attribute.meshPerAttribute>=1&&(this.isInstanced=!0,this.maxInstancedCount=attribute.count),"position"===name&&(attribute.destroyDataAfterUpload=!1),this.attributes[name]=attribute}setIndex(attribute){this.index=attribute.array||attribute}toNonIndexed(){let geometry2=new Geometry,indices=this.index,attributes=this.attributes;for(let name in attributes){let attribute=attributes[name],array=attribute.array,itemSize=attribute.itemSize,array2=new array.constructor(indices.length*itemSize),index=0,index2=0;for(let i=0,l=indices.length;i<l;i++){index=indices[i]*itemSize;for(let j=0;j<itemSize;j++)array2[index2++]=array[index++]}geometry2.addAttribute(name,new GeometryAttribute(array2,itemSize))}return geometry2}normalizeNormals(){let vector=this._V1||new Vector3;this._V1=vector;let x,y,z,normals=this.attributes.normal;for(let i=0,il=normals.count;i<il;i++)x=3*i+0,y=3*i+1,z=3*i+2,vector.x=normals.array[x],vector.y=normals.array[y],vector.z=normals.array[z],vector.normalize(),normals.array[x]=vector.x,normals.array[y]=vector.y,normals.array[z]=vector.z}computeFaceNormals(){let cb=new Vector3,ab=new Vector3;for(let f=0,fl=this.faces.length;f<fl;f++){let face=this.faces[f],vA=this.vertices[face.a],vB=this.vertices[face.b],vC=this.vertices[face.c];cb.subVectors(vC,vB),ab.subVectors(vA,vB),cb.cross(ab),cb.normalize(),face.normal.copy(cb)}}computeVertexNormals(){let index=this.index,attributes=this.attributes,groups=this.groups||[];if(attributes.position){let positions=attributes.position.array;if(void 0===attributes.normal)this.addAttribute("normal",new GeometryAttribute(new Float32Array(positions.length),3));else{let array=attributes.normal.array;for(let i=0,il=array.length;i<il;i++)array[i]=0}let vA,vB,vC,normals=attributes.normal.array,pA=new Vector3,pB=new Vector3,pC=new Vector3,cb=new Vector3,ab=new Vector3;if(index){let indices=index.array;0===groups.length&&this.addGroup(0,indices.length);for(let j=0,jl=groups.length;j<jl;++j){let group=groups[j],start=group.start;for(let i=start,il=start+group.count;i<il;i+=3)vA=3*indices[i+0],vB=3*indices[i+1],vC=3*indices[i+2],pA.fromArray(positions,vA),pB.fromArray(positions,vB),pC.fromArray(positions,vC),cb.subVectors(pC,pB),ab.subVectors(pA,pB),cb.cross(ab),normals[vA]+=cb.x,normals[vA+1]+=cb.y,normals[vA+2]+=cb.z,normals[vB]+=cb.x,normals[vB+1]+=cb.y,normals[vB+2]+=cb.z,normals[vC]+=cb.x,normals[vC+1]+=cb.y,normals[vC+2]+=cb.z}}else for(let i=0,il=positions.length;i<il;i+=9)pA.fromArray(positions,i),pB.fromArray(positions,i+3),pC.fromArray(positions,i+6),cb.subVectors(pC,pB),ab.subVectors(pA,pB),cb.cross(ab),normals[i]=cb.x,normals[i+1]=cb.y,normals[i+2]=cb.z,normals[i+3]=cb.x,normals[i+4]=cb.y,normals[i+5]=cb.z,normals[i+6]=cb.x,normals[i+7]=cb.y,normals[i+8]=cb.z;this.normalizeNormals(),attributes.normal.needsUpdate=!0}}computeBoundingBox(){this.boundingBox||(this.boundingBox=new Box3);let position=this.attributes.position;position?this.boundingBox.setFromBufferAttribute(position):this.boundingBox.makeEmpty()}computeBoundingSphere(){let box=new Box3,vector=new Vector3;this.boundingSphere||(this.boundingSphere=new Sphere);let position=this.attributes.position;if(position){let center=this.boundingSphere.center;box.setFromBufferAttribute(position),box.getCenter(center);let maxRadiusSq=0;for(let i=0,il=position.count;i<il;i++)vector.fromBufferAttribute(position,i),maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(vector));this.boundingSphere.radius=Math.sqrt(maxRadiusSq),isNaN(this.boundingSphere.radius)&&console.error("Bounding Sphere came up NaN, broken position buffer.",this)}}merge(geometry){let Float32ArrayConcat=(first,second)=>{let firstLength=first.length,result=new Float32Array(firstLength+second.length);return result.set(first),result.set(second,firstLength),result},attributes=this.attributes;if(this.index){let indices=geometry.index,offset=attributes.position.count;for(let i=0,il=indices.length;i<il;i++)indices[i]=offset+indices[i];this.index=((first,second)=>{let firstLength=first.length,result=new(Geometry.arrayNeedsUint32(second)?Uint32Array:Uint16Array)(firstLength+second.length);return result.set(first),result.set(second,firstLength),result})(this.index,indices)}for(let key in attributes)void 0!==geometry.attributes[key]&&(attributes[key].array=Float32ArrayConcat(attributes[key].array,geometry.attributes[key].array),attributes[key].count=attributes[key].array.length/attributes[key].itemSize);return this}clone(noCopy){return(new Geometry).copy(this,noCopy)}copy(source,noCopy){this.index=null,this.boundingBox=null,this.boundingSphere=null,this.index=source.index;let attributes=source.attributes;for(let name in attributes){let attribute=attributes[name];attribute.array.deleted&&!attribute.array.length&&(attribute.array.copyHasWarned||(console.error(`Attempt to copy/clone a deleted geometry attribute ${name}`,this),attribute.array.copyHasWarned=!0)),this.addAttribute(name,attributes[name].clone(noCopy))}let boundingBox=source.boundingBox;boundingBox&&boundingBox.clone&&(this.boundingBox=boundingBox.clone());let boundingSphere=source.boundingSphere;return boundingSphere&&boundingSphere.clone&&(this.boundingSphere=boundingSphere.clone()),this}center(){let offset=new Vector3;return this.computeBoundingBox(),this.boundingBox.getCenter(offset).negate(),this.applyMatrix((new Matrix4).makeTranslation(offset.x,offset.y,offset.z)),this}applyMatrix(matrix){let position=this.attributes.position;position&&(matrix.applyToBufferAttribute(position),position.needsUpdate=!0);let normal=this.attributes.normal;if(normal){(new Matrix3).getNormalMatrix(matrix).applyToBufferAttribute(normal),normal.needsUpdate=!0}return this.boundingBox&&this.computeBoundingBox(),this.boundingSphere&&this.computeBoundingSphere(),this}scale(x,y,z){this.applyMatrix((new Matrix4).makeScale(x,y,z))}setFromPoints(points){let position=[];for(let i=0,l=points.length;i<l;i++){let point=points[i];position.push(point.x,point.y,point.z||0)}return this.addAttribute("position",new GeometryAttribute(new Float32Array(position),3)),this}instanceFrom(geom){return geom.clone()}uploadBuffersAsync(){return Geometry.renderer.uploadBuffersAsync(this)}toJSON(){let attributes={};for(let key in this.attributes){let attribute=this.attributes[key];attributes[key]={type:"Float32Array",itemSize:attribute.itemSize,array:Array.from(attribute.array)}}let json={metadata:{type:"BufferGeometry"},data:{attributes:attributes}};return this.index&&(json.data.index={type:Utils.getConstructorName(this.index),array:Array.from(this.index)}),json}}class GeometryAttribute{constructor(_array,_itemSize,_meshPerAttribute,_dynamic=!1){this.array=_array,this.itemSize=_itemSize,this.count=void 0!==_array?_array.length/_itemSize:0,this.dynamic=_dynamic,this.updateRange={offset:0,count:-1},this.meshPerAttribute=_meshPerAttribute,this.destroyDataAfterUpload=!!Geometry.defaultDestroyDataAfterUpload}setArray(array){let newCount=void 0!==array?array.length/this.itemSize:0;newCount!=this.count&&(this.needsNewBuffer=!0),this.array=array,this.count=newCount,this.needsUpdate=!0}clone(noCopy){return noCopy?this:(this.array.deleted&&!this.array.length&&(this.array.copyHasWarned||(console.error("Attempt to copy/clone a deleted geometry attribute",this),this.array.copyHasWarned.hasWarned=!0)),new GeometryAttribute(new Float32Array(this.array),this.itemSize,this.meshPerAttribute))}getX(index){return this.array[index*this.itemSize]}setX(index,x){return this.array[index*this.itemSize]=x,this}getY(index){return this.array[index*this.itemSize+1]}setY(index,y){return this.array[index*this.itemSize+1]=y,this}getZ(index){return this.array[index*this.itemSize+2]}setZ(index,z){return this.array[index*this.itemSize+2]=z,this}getW(index){return this.array[index*this.itemSize+3]}setW(index,w){return this.array[index*this.itemSize+3]=w,this}setXY(index,x,y){return index*=this.itemSize,this.array[index+0]=x,this.array[index+1]=y,this}setXYZ(index,x,y,z){return index*=this.itemSize,this.array[index+0]=x,this.array[index+1]=y,this.array[index+2]=z,this}setXYZW(index,x,y,z,w){return index*=this.itemSize,this.array[index+0]=x,this.array[index+1]=y,this.array[index+2]=z,this.array[index+3]=w,this}releaseData(){this.dynamic||(this.array=this.array.slice(0,0),this.array.deleted=!0)}}class InterleavedBuffer{constructor(array,stride){this.array=array,this.stride=stride,this.count=array?array.length/stride:0,this.isInterleaved=!0,this.needsUpdate=!1,this.dynamic=!1,this.updateRange={offset:0,count:-1}}setArray(array){let newCount=void 0!==array?array.length/this.stride:0;newCount!==this.count&&(this.needsNewBuffer=!0),this.array=array,this.count=newCount,this.needsUpdate=!0}}class InterleavedGeometryAttribute{constructor(interleavedBuffer,itemSize,offset){this.data=interleavedBuffer,this.itemSize=itemSize,this.offset=offset,this.isInterleaved=!0}get count(){return this.data.count}}class Group extends Base3D{constructor(){super(),this.isGroup=!0,this._occlusionMesh=null}generateOcclusionMesh(){this._bbVertices=[];for(let i=0;i<8;i++)this._bbVertices.push(new Vector3);if(!this.occlusionCulled){this.occlusionCulled=!0;let occShader=new Shader("OcclusionMaterial",{bbMin:{value:new Vector3(0,0,0)},bbMax:{value:new Vector3(1,1,1)}});occShader.wireframe=!0;let _occlusionMesh=new Mesh(World.BOX,occShader);_occlusionMesh.occlusionCulled=!0,_occlusionMesh._occlusionGroup=this,_occlusionMesh.renderOrder=-1e3,_occlusionMesh.hideByOcclusion=!0,_occlusionMesh._occlusionMesh.renderOrder=1e3,this.add(_occlusionMesh),this._occlusionMesh=_occlusionMesh,this.bb=new Box3}}updateOcclusionBoundingBox(){this.bb.makeEmpty();const _this=this;_this.children.forEach(child=>{if(void 0===child._occlusionGroup){child.updateOcclusionMesh();let bb=child._geometry.boundingBox,m=bb.min,M=bb.max;_this._bbVertices[0].set(m.x,m.y,m.z),_this._bbVertices[1].set(m.x,m.y,M.z),_this._bbVertices[2].set(m.x,M.y,m.z),_this._bbVertices[3].set(M.x,m.y,m.z),_this._bbVertices[4].set(M.x,M.y,m.z),_this._bbVertices[5].set(M.x,m.y,M.z),_this._bbVertices[6].set(m.x,M.y,M.z),_this._bbVertices[7].set(M.x,M.y,M.z),_this._bbVertices.forEach(vertex=>{vertex.applyMatrix4(child.matrix),_this.bb.min.x=Math.min(_this.bb.min.x,vertex.x),_this.bb.min.y=Math.min(_this.bb.min.y,vertex.y),_this.bb.min.z=Math.min(_this.bb.min.z,vertex.z),_this.bb.max.x=Math.max(_this.bb.max.x,vertex.x),_this.bb.max.y=Math.max(_this.bb.max.y,vertex.y),_this.bb.max.z=Math.max(_this.bb.max.z,vertex.z)})}}),this._occlusionMesh?.shader?.set("bbMin",this.bb.min),this._occlusionMesh?.shader?.set("bbMax",this.bb.max),this._occlusionMesh?._occlusionMesh?.shader?.set("bbMin",this.bb.min.add(new Vector3(-.01,-.01,-.01))),this._occlusionMesh?._occlusionMesh?.shader?.set("bbMax",this.bb.max.add(new Vector3(.01,.01,.01))),this._occlusionMesh.position.copy(this.bb.max.clone().add(this.bb.min).multiplyScalar(.5))}updateOcclusionVisibility(doHide){this.children.forEach(child=>{void 0===child._occlusionGroup&&(child.hideByOcclusion=doHide)})}}class BaseLight extends Base3D{constructor(color=16777215,intensity=1,distance=9999){super(),this.color=new Color(color),this.data=new Vector4,this.data2=new Vector4,this.data3=new Vector4,this.properties=new Vector4(intensity,distance,0,0)}destroy(){this.shadow&&(Lighting.removeFromShadowGroup(this),this.shadow.destroy())}prepareRender(){this.shadow.camera.position.copy(this.position),this.shadow.camera.lookAt(this.shadow.target),this.shadow.camera.position.setScalar(0)}set castShadow(bool){(this.shadow||bool)&&(this.shadow||(this.shadow=new Shadow(this)),this.shadow.enabled=bool,this.silentShadow||(bool?Lighting.addToShadowGroup(this):Lighting.removeFromShadowGroup(this)))}set intensity(v){this.properties.x=v}get intensity(){return this.properties.x}set distance(v){this.properties.y=v}get distance(){return this.properties.y}set bounce(v){this.properties.z=v}get bounce(){return this.properties.z}}class Line extends Base3D{constructor(geometry,shader){super(),this.geometry=geometry,this.shader=shader,this.isLine=!0,this.id=Renderer.ID++}clone(){return new Line(this.geometry,this.shader).copy(this)}}class Mesh extends Base3D{constructor(geometry,shader,isQuery=!1){super(),shader||window.THREAD||(shader=new Shader("TestMaterial")),this._geometry=geometry,this._shader=shader&&shader.shader?shader.shader:shader,this.isMesh=!0;if(this.occlusionMesh=null,!isQuery&&!window.THREAD&&Renderer.useOcclusionQuery){let occShader=new Shader("OcclusionMaterial",{bbMin:{value:new Vector3},bbMax:{value:new Vector3}});occShader.side=Shader.DOUBLE_SIDE;let _occlusionMesh=new Mesh(World.BOX,occShader,!0);_occlusionMesh.occlusionCulled=!1,_occlusionMesh.doNotProject=!0,_occlusionMesh._queryMesh=this,_occlusionMesh.isOcclusionMesh=!0,this.add(_occlusionMesh),this._occlusionMesh=_occlusionMesh,this._occlusionDirty=!0}this.id=Utils.timestamp(),shader&&(this._shader.mesh=this)}clone(){return new Mesh(this._geometry,this.shader).copy(this)}set geometry(g){Geometry.renderer.resetMeshGeom(this),this._geometry=g}get geometry(){return this._geometry}set shader(shader){this._shader=shader&&shader.shader?shader.shader:shader}get shader(){return this._shader}isInsideOf(mesh){return this.box3||(this.box3=new Box3),this.box3.setFromObject(this),mesh.isMeshInside(this)}isMeshInside(mesh){return this.box3||(this.box3=new Box3),this.box3.setFromObject(this),mesh.box3.intersectsBox(this.box3)}updateOcclusionMesh(force){if(this.occlusionCulled&&!Renderer.useOcclusionQuery&&(this._occlusionDirty||force)){this._geometry.computeBoundingBox();let bb=this._geometry.boundingBox;this._occlusionMesh?.shader?.set("bbMin",bb.min.add(new Vector3(-.01,-.01,-.01))),this._occlusionMesh?.shader?.set("bbMax",bb.max.add(new Vector3(.01,.01,.01))),this._occlusionMesh.renderOrder=this.renderOrder+1e3,this._occlusionDirty=!1}}}class Points extends Base3D{constructor(geometry,shader){super(),this._geometry=geometry,this.shader=shader,this.isPoints=!0,this.id=Renderer.ID++,shader&&(this.shader.mesh=this)}clone(){return new Points(this._geometry,this.shader).copy(this)}set geometry(g){Geometry.renderer.resetMeshGeom(this),this._geometry=g}get geometry(){return this._geometry}}class Scene extends Base3D{constructor(){super(),this.autoUpdate=!0,this.toRender=[[],[]],this._displayNeedsUpdate=!0,this.isScene=!0,this.changes=[]}set displayNeedsUpdate(v){!0===v&&this.changes.forEach(cb=>cb()),this._displayNeedsUpdate=v}get displayNeedsUpdate(){return this._displayNeedsUpdate}bindSceneChange(cb){this.changes.push(cb)}destroy(){this.toRender[0].length=0,this.toRender[1].length=0,this.changes.length=0,super.destroy()}}Class(function FBORendererWebGL(_gl){const WEBGL2=Renderer.type==Renderer.WEBGL2;let _maxSamples=WEBGL2&&_gl.getParameter(_gl.MAX_SAMPLES);const{getFormat:getFormat,getInternalFormat:getInternalFormat,getProperty:getProperty,getType:getType,getFloatParams:getFloatParams}=require("GLTypes");function prepareTexture(texture){texture._gl=_gl.createTexture(),_gl.bindTexture(_gl.TEXTURE_2D,texture._gl),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_WRAP_S,getProperty(texture.wrapS)),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_WRAP_T,getProperty(texture.wrapT)),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_MAG_FILTER,getProperty(texture.magFilter)),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_MIN_FILTER,getProperty(texture.minFilter)),texture.needsUpdate=!1}function texImageDB(rt,texture){if(texture.type.includes("float")){let{internalformat:internalformat,format:format,type:type}=getFloatParams(texture);_gl.texImage2D(_gl.TEXTURE_2D,0,internalformat,rt.width,rt.height,0,format,type,null)}else _gl.texImage2D(_gl.TEXTURE_2D,0,getFormat(texture),rt.width,rt.height,0,getFormat(texture),getType(texture),null);_gl.bindTexture(_gl.TEXTURE_2D,null)}function getRenderBufferInternalFormat(texture){return texture.type.includes("float")?getFloatParams(texture).internalformat:getInternalFormat(texture)}this.upload=function(rt){if(!rt._gl){if(rt.cube)return function uploadCube(rt){rt._gl=_gl.createFramebuffer(),_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt._gl);let texture=rt.texture;texture._gl=_gl.createTexture(),texture.cube=!0,texture.needsUpdate=!1,_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture._gl);for(let i=0;i<6;i++)_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,getFormat(texture),rt.width,rt.height,0,getFormat(texture),_gl.UNSIGNED_BYTE,null);_gl.texParameteri(_gl.TEXTURE_CUBE_MAP,_gl.TEXTURE_WRAP_S,getProperty(texture.wrapS)),_gl.texParameteri(_gl.TEXTURE_CUBE_MAP,_gl.TEXTURE_WRAP_T,getProperty(texture.wrapT)),_gl.texParameteri(_gl.TEXTURE_CUBE_MAP,_gl.TEXTURE_MAG_FILTER,getProperty(texture.magFilter)),_gl.texParameteri(_gl.TEXTURE_CUBE_MAP,_gl.TEXTURE_MIN_FILTER,getProperty(texture.minFilter)),rt._depthBuffer=_gl.createRenderbuffer(),_gl.bindRenderbuffer(_gl.RENDERBUFFER,rt._depthBuffer),_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_COMPONENT16,rt.width,rt.height),_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,rt._depthBuffer),_gl.bindFramebuffer(_gl.FRAMEBUFFER,null),_gl.bindTexture(_gl.TEXTURE_2D,null),_gl.bindRenderbuffer(_gl.RENDERBUFFER,null)}(rt);if(rt.texture.isTexture3D)return function upload3DTexture(rt){rt.texture.upload();let colorAttachments=[];rt._gl=_gl.createFramebuffer(),_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt._gl);for(let i=0;i<rt.indices.length;i++){let key="COLOR_ATTACHMENT"+i;colorAttachments.push(_gl[key]),_gl.framebufferTextureLayer(_gl.FRAMEBUFFER,_gl[key],rt.texture._gl,0,rt.indices[i])}_gl.drawBuffers(colorAttachments),_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)}(rt);if(rt._gl=_gl.createFramebuffer(),!rt.depth&&!rt.disableDepth)if(rt._depthBuffer=_gl.createRenderbuffer(),_gl.bindRenderbuffer(_gl.RENDERBUFFER,rt._depthBuffer),rt.internalMultisample){let samples=Math.min(_maxSamples,rt._samplesAmount);_gl.renderbufferStorageMultisample(_gl.RENDERBUFFER,samples,rt.stencil?_gl.DEPTH24_STENCIL8:_gl.DEPTH_COMPONENT24,rt.width,rt.height)}else _gl.renderbufferStorage(_gl.RENDERBUFFER,rt.stencil?WEBGL2?_gl.DEPTH24_STENCIL8:_gl.DEPTH_STENCIL:WEBGL2?_gl.DEPTH_COMPONENT24:_gl.DEPTH_COMPONENT16,rt.width,rt.height);if(RenderCount.add(`fbo_${Math.round(rt.width)}x${Math.round(rt.height)}`,rt),_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt._gl),rt.multi)if(WEBGL2){let colorAttachments=[];for(let i=0;i<rt.attachments.length;i++){let key="COLOR_ATTACHMENT"+i,texture=rt.attachments[i];colorAttachments.push(_gl[key]),prepareTexture(texture),texImageDB(rt,texture),_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl[key],_gl.TEXTURE_2D,texture._gl,0),rt.multisample&&i>0&&(texture._blitFramebuffer=_gl.createFramebuffer(),_gl.bindFramebuffer(_gl.FRAMEBUFFER,texture._blitFramebuffer),_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_2D,texture._gl,0))}_gl.drawBuffers(colorAttachments)}else{let ext=Renderer.extensions.drawBuffers,colorAttachments=[];for(let i=0;i<rt.attachments.length;i++){let key="COLOR_ATTACHMENT"+i+"_WEBGL",texture=rt.attachments[i];colorAttachments.push(ext[key]),prepareTexture(texture),texImageDB(rt,texture),_gl.framebufferTexture2D(_gl.FRAMEBUFFER,ext[key],_gl.TEXTURE_2D,texture._gl,0)}ext.drawBuffersWEBGL(colorAttachments)}else if(rt.internalMultisample){let samples=Math.min(_maxSamples,rt._samplesAmount);if(rt.parent.multi){let colorAttachments=[],attachments=rt.parent.attachments;for(let i=0;i<attachments.length;i++){let key="COLOR_ATTACHMENT"+i,texture=attachments[i];colorAttachments.push(_gl[key]),texture._colorBuffer=_gl.createRenderbuffer(),_gl.bindRenderbuffer(_gl.RENDERBUFFER,texture._colorBuffer),_gl.renderbufferStorageMultisample(_gl.RENDERBUFFER,samples,getRenderBufferInternalFormat(texture),rt.width,rt.height),_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl[key],_gl.RENDERBUFFER,texture._colorBuffer),_gl.bindRenderbuffer(_gl.RENDERBUFFER,null)}_gl.drawBuffers(colorAttachments)}else rt._colorBuffer=_gl.createRenderbuffer(),_gl.bindRenderbuffer(_gl.RENDERBUFFER,rt._colorBuffer),_gl.renderbufferStorageMultisample(_gl.RENDERBUFFER,samples,getRenderBufferInternalFormat(rt.texture),rt.width,rt.height),_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,_gl.RENDERBUFFER,rt._colorBuffer)}else{if(prepareTexture(rt.texture),rt.texture.type.includes("float")){let{internalformat:internalformat,format:format,type:type}=getFloatParams(rt.texture);_gl.texImage2D(_gl.TEXTURE_2D,0,internalformat,rt.width,rt.height,0,format,type,null)}else _gl.texImage2D(_gl.TEXTURE_2D,0,getFormat(rt.texture),rt.width,rt.height,0,getFormat(rt.texture),getType(rt.texture),null);_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_2D,rt.texture._gl,0)}if(rt.depth){prepareTexture(rt.depth);let iformat=rt.stencil?WEBGL2?_gl.DEPTH24_STENCIL8:_gl.DEPTH_STENCIL:WEBGL2?_gl.DEPTH_COMPONENT24:_gl.DEPTH_COMPONENT,type=rt.stencil?WEBGL2?_gl.UNSIGNED_INT_24_8:Renderer.extensions.depthTextures.UNSIGNED_INT_24_8_WEBGL:_gl.UNSIGNED_INT;_gl.texImage2D(_gl.TEXTURE_2D,0,iformat,rt.width,rt.height,0,rt.stencil?_gl.DEPTH_STENCIL:_gl.DEPTH_COMPONENT,type,null),_gl.framebufferTexture2D(_gl.FRAMEBUFFER,rt.stencil?_gl.DEPTH_STENCIL_ATTACHMENT:_gl.DEPTH_ATTACHMENT,_gl.TEXTURE_2D,rt.depth._gl,0)}else rt.disableDepth||(rt.internalMultisample,_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,rt.stencil?_gl.DEPTH_STENCIL_ATTACHMENT:_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,rt._depthBuffer));_gl.bindFramebuffer(_gl.FRAMEBUFFER,null),_gl.bindTexture(_gl.TEXTURE_2D,null),_gl.bindRenderbuffer(_gl.RENDERBUFFER,null)}},this.bind=function(rt){rt._gl||this.upload(rt),_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt._gl),rt.cube&&_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_CUBE_MAP_POSITIVE_X+rt.activeFace,rt.texture._gl,0),rt.scissor&&(_gl.enable(_gl.SCISSOR_TEST),_gl.scissor(rt.scissor.x,rt.scissor.y,rt.scissor.width,rt.scissor.height)),_gl.viewport(rt.viewport.x,rt.viewport.y,rt.width,rt.height),rt.customViewport&&_gl.viewport(rt.customViewport.x,rt.customViewport.y,rt.customViewport.z,rt.customViewport.w),Renderer.instance.autoClear&&(_gl.clearColor(Renderer.CLEAR[0],Renderer.CLEAR[1],Renderer.CLEAR[2],Renderer.CLEAR[3]),rt.sharedRenderbuffer?rt.clearDepth?_gl.clear(_gl.COLOR_BUFFER_BIT|_gl.DEPTH_BUFFER_BIT):_gl.clear(_gl.COLOR_BUFFER_BIT):_gl.clear(_gl.COLOR_BUFFER_BIT|_gl.DEPTH_BUFFER_BIT|_gl.STENCIL_BUFFER_BIT))},this.unbind=function(rt){rt.scissor&&_gl.disable(_gl.SCISSOR_TEST),_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)},this.resize=function(rt){if(rt.texture._gl&&rt._gl){if(_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt._gl),rt.multi)for(let i=0;i<rt.attachments.length;i++){let texture=rt.attachments[i];if(_gl.bindTexture(_gl.TEXTURE_2D,texture._gl),texture.type.includes("float")){let{internalformat:internalformat,format:format,type:type}=getFloatParams(texture);_gl.texImage2D(_gl.TEXTURE_2D,0,internalformat,rt.width,rt.height,0,format,type,null)}else _gl.texImage2D(_gl.TEXTURE_2D,0,getFormat(texture),rt.width,rt.height,0,getFormat(texture),getType(texture),null)}else if(rt.internalMultisample){let samples=Math.min(_maxSamples,rt._samplesAmount);if(rt.parent.multi){let attachments=rt.parent.attachments;for(let i=0;i<attachments.length;i++){let texture=attachments[i];_gl.bindRenderbuffer(_gl.RENDERBUFFER,texture._colorBuffer),_gl.renderbufferStorageMultisample(_gl.RENDERBUFFER,samples,getRenderBufferInternalFormat(texture),rt.width,rt.height),_gl.bindRenderbuffer(_gl.RENDERBUFFER,null)}}else _gl.bindRenderbuffer(_gl.RENDERBUFFER,rt._colorBuffer),_gl.renderbufferStorageMultisample(_gl.RENDERBUFFER,samples,getRenderBufferInternalFormat(rt.texture),rt.width,rt.height),_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,_gl.RENDERBUFFER,rt._colorBuffer)}else if(_gl.bindTexture(_gl.TEXTURE_2D,rt.texture._gl),rt.texture.type.includes("float")){let{internalformat:internalformat,format:format,type:type}=getFloatParams(rt.texture);_gl.texImage2D(_gl.TEXTURE_2D,0,internalformat,rt.width,rt.height,0,format,type,null)}else _gl.texImage2D(_gl.TEXTURE_2D,0,getFormat(rt.texture),rt.width,rt.height,0,getFormat(rt.texture),getType(rt.texture),null);if(rt.depth){_gl.bindTexture(_gl.TEXTURE_2D,rt.depth._gl);let iformat=rt.stencil?WEBGL2?_gl.DEPTH24_STENCIL8:_gl.DEPTH_STENCIL:WEBGL2?_gl.DEPTH_COMPONENT24:_gl.DEPTH_COMPONENT,type=rt.stencil?WEBGL2?_gl.UNSIGNED_INT_24_8:Renderer.extensions.depthTextures.UNSIGNED_INT_24_8_WEBGL:_gl.UNSIGNED_INT;_gl.texImage2D(_gl.TEXTURE_2D,0,iformat,rt.width,rt.height,0,rt.stencil?_gl.DEPTH_STENCIL:_gl.DEPTH_COMPONENT,type,null),_gl.framebufferTexture2D(_gl.FRAMEBUFFER,rt.stencil?_gl.DEPTH_STENCIL_ATTACHMENT:_gl.DEPTH_ATTACHMENT,_gl.TEXTURE_2D,rt.depth._gl,0)}else if(!rt.disableDepth)if(_gl.bindRenderbuffer(_gl.RENDERBUFFER,rt._depthBuffer),rt.internalMultisample){let samples=Math.min(_maxSamples,rt._samplesAmount);_gl.renderbufferStorageMultisample(_gl.RENDERBUFFER,samples,rt.stencil?_gl.DEPTH24_STENCIL8:_gl.DEPTH_COMPONENT24,rt.width,rt.height)}else _gl.renderbufferStorage(_gl.RENDERBUFFER,rt.stencil?WEBGL2?_gl.DEPTH24_STENCIL8:_gl.DEPTH_STENCIL:WEBGL2?_gl.DEPTH_COMPONENT24:_gl.DEPTH_COMPONENT16,rt.width,rt.height);_gl.bindTexture(_gl.TEXTURE_2D,null),_gl.bindFramebuffer(_gl.FRAMEBUFFER,null),_gl.bindRenderbuffer(_gl.RENDERBUFFER,null)}},this.destroy=function(rt){rt._gl&&_gl.deleteFramebuffer(rt._gl),rt._depthBuffer&&_gl.deleteRenderbuffer(rt._depthBuffer),Texture.renderer.destroy(rt.texture),rt._gl&&RenderCount.remove(`fbo_${Math.round(rt.width)}x${Math.round(rt.height)}`),rt.multi&&rt.attachments.forEach(t=>{t._colorBuffer&&_gl.deleteRenderbuffer(t._colorBuffer),t._blitFramebuffer&&_gl.deleteFramebuffer(t._blitFramebuffer),Texture.renderer.destroy(t)}),rt._gl=null,rt._depthBuffer=null}}),Class(function GeometryRendererWebGL(_gl){const _this=this;var _cache={},_isDebbugingShader=Utils.query("displayShaderError");const WEBGL2=Renderer.type==Renderer.WEBGL2,{getGLTypeForTypedArray:getGLTypeForTypedArray}=require("GLTypes");function updateBuffer(attrib,geom,attributeName){if(!attrib._gl)return;attrib.needsUpdate=!1,_gl.bindBuffer(_gl.ARRAY_BUFFER,attrib._gl.buffer),RenderStats.update("BufferUpdates");let array=attrib.array;if(checkAttributeArray(array,geom,attributeName)){let updateRange=attrib.updateRange;if(-1===updateRange.count)attrib.needsNewBuffer?(_gl.bufferData(_gl.ARRAY_BUFFER,attrib.array,_gl.DYNAMIC_DRAW),attrib.needsNewBuffer=!1):_gl.bufferSubData(_gl.ARRAY_BUFFER,0,array),maybeDestroyAttributeData(geom,attributeName);else if(Array.isArray(updateRange)){for(let i=updateRange.length-1;i>-1;i--){let{offset:offset,count:count}=updateRange[i];_gl.bufferSubData(_gl.ARRAY_BUFFER,offset*array.BYTES_PER_ELEMENT,array.subarray(offset,offset+count))}updateRange.length=0}else _gl.bufferSubData(_gl.ARRAY_BUFFER,updateRange.offset*array.BYTES_PER_ELEMENT,array.subarray(updateRange.offset,updateRange.offset+updateRange.count))}_gl.bindBuffer(_gl.ARRAY_BUFFER,null)}function renderingCount(count,mode,instanceCount=1){if(RenderStats.active)switch(mode){case _gl.TRIANGLES:RenderStats.update("Triangles",instanceCount*(count/3));break;case _gl.LINES:RenderStats.update("Lines",instanceCount*(count/2));break;case _gl.LINE_STRIP:RenderStats.update("LineStrip",instanceCount*(count-1));break;case _gl.LINE_LOOP:RenderStats.update("LineLoop",instanceCount*count);break;case _gl.POINTS:RenderStats.update("Points",instanceCount*count)}}function releaseVAO(mesh){if(!(mesh&&mesh._gl&&mesh._gl.vao))return;let cache=_cache[mesh._gl.lookup];cache?(cache.count--,0==cache.count&&(cache.vao.destroy(),delete _cache[mesh._gl.lookup])):mesh._gl.vao.destroy(),delete mesh._gl.vao}function maybeDestroyAttributeData(geom,key){if(!1!==geom.destroyDataAfterUpload)if("index"===key)(geom.index.destroyDataAfterUpload||geom.destroyDataAfterUpload)&&(geom.index=geom.index.slice(0,0),geom.index.deleted=!0);else{let attrib=geom.attributes[key];if(attrib.dynamic&&(attrib.destroyDataAfterUpload=!1),!attrib.destroyDataAfterUpload&&!geom.destroyDataAfterUpload)return;"position"===key&&(geom.boundingSphere||geom.computeBoundingSphere(),geom.boundingBox||geom.computeBoundingBox()),attrib.releaseData()}}function checkAttributeArray(array,geom,attributeName){return!(array.deleted&&!array.length)||(array.hasWarned||(console.error(`Attempt to update deleted geometry attribute ${attributeName}`,geom),array.hasWarned=!0),!1)}this.draw=function(geom,mesh,shader,isQuery){geom._gl&&!geom.needsUpdate&&mesh._gl&&mesh._gl.geomInit||this.upload(geom,mesh,shader),RenderStats.active&&RenderStats.update("DrawCalls",1,shader.vsName+"|"+shader.fsName,mesh);let hasInterleavedBuffers=!1;for(let i=geom._attributeKeys.length-1;i>-1;i--){let key=geom._attributeKeys[i],attrib=geom._attributeValues[i];if(mesh._gl.program==shader._gl.program&&void 0!==mesh._gl[key]||(mesh._gl[key]=_gl.getAttribLocation(shader._gl.program,key)),-1!==mesh._gl[key]){if(attrib.isInterleaved&&!hasInterleavedBuffers){hasInterleavedBuffers=!0;for(let j=geom._attributeKeys.length-1;j>-1;j--){let attrib=geom._attributeValues[j];attrib.isInterleaved&&attrib.data.dynamic&&(attrib.data.needsUpdate=!0)}}attrib.isInterleaved&&attrib.data.needsUpdate?updateBuffer(attrib.data,geom,key):(attrib.needsUpdate||attrib.dynamic)&&updateBuffer(attrib,geom,key)}}if(mesh._gl.program=shader._gl.program,geom.indexNeedsUpdate){if(checkAttributeArray(geom.index,geom,"index")){if(geom._gl.indexType=geom.index instanceof Uint16Array?_gl.UNSIGNED_SHORT:_gl.UNSIGNED_INT,geom._gl.indexLength=geom.index.length,_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geom._gl.index),geom.indexUpdateRange){let updateRange=geom.indexUpdateRange;_gl.bufferSubData(_gl.ELEMENT_ARRAY_BUFFER,updateRange.offset*geom.index.BYTES_PER_ELEMENT,geom.index.subarray(updateRange.offset,updateRange.offset+updateRange.count))}else _gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,geom.index,_gl.STATIC_DRAW);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,null),maybeDestroyAttributeData(geom,"index")}geom.indexNeedsUpdate=!1}mesh._gl.vao.bind();let mode=mesh._gl.mode;mode||(mesh._gl.mode=mode=function getMode(mesh,shader){return mesh.isPoints?_gl.POINTS:mesh.isLine?_gl.LINE_STRIP:shader.wireframe?_gl.LINE_LOOP:_gl.TRIANGLES}(mesh,shader));let drawStart=geom.drawRange.start||0,drawEnd=geom.drawRange.end||(geom.index?geom._gl.indexLength:geom.attributes.position.count);if(geom.index&&(drawStart*=geom._gl.indexType===_gl.UNSIGNED_SHORT?2:4),isQuery&&WEBGL2){let queryMesh=mesh._queryMesh;return void(void 0!==queryMesh._gl&&(queryMesh._gl.queryInProgress&&_gl.getQueryParameter(queryMesh._gl.query,_gl.QUERY_RESULT_AVAILABLE)&&(queryMesh._gl.occluded=!_gl.getQueryParameter(queryMesh._gl.query,_gl.QUERY_RESULT),queryMesh._gl.queryInProgress=!1),queryMesh._gl.queryInProgress||(_gl.beginQuery(_gl.ANY_SAMPLES_PASSED_CONSERVATIVE,queryMesh._gl.query),_gl.colorMask(!1,!1,!1,!1),_gl.depthMask(!1),geom.index?(_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geom._gl.index),_gl.drawElements(mode,drawEnd,geom._gl.indexType,drawStart)):_gl.drawArrays(mode,drawStart,drawEnd),_gl.colorMask(!0,!0,!0,!0),_gl.depthMask(!0),_gl.endQuery(_gl.ANY_SAMPLES_PASSED_CONSERVATIVE),queryMesh._gl.queryInProgress=!0)))}if(geom.isInstanced){let maxInstancedCount=mesh.maxInstancedCount?Math.min(mesh.maxInstancedCount,geom.maxInstancedCount):geom.maxInstancedCount;shader.maxInstancedCount&&(maxInstancedCount=Math.min(maxInstancedCount||9999,shader.maxInstancedCount)),WEBGL2?geom.index?_gl.drawElementsInstanced(mode,drawEnd,geom._gl.indexType,drawStart,maxInstancedCount):_gl.drawArraysInstanced(mode,drawStart,drawEnd,maxInstancedCount):geom.index?Renderer.extensions.instancedArrays.drawElementsInstancedANGLE(mode,drawEnd,geom._gl.indexType,drawStart,maxInstancedCount):Renderer.extensions.instancedArrays.drawArraysInstancedANGLE(mode,drawStart,drawEnd,maxInstancedCount),renderingCount(geom.index?geom._gl.indexLength:drawEnd,mode,maxInstancedCount)}else mesh.hideByOcclusion||(geom.index?_gl.drawElements(mode,drawEnd,geom._gl.indexType,drawStart):_gl.drawArrays(mode,drawStart,drawEnd),renderingCount(geom.index?geom._gl.indexLength:drawEnd,mode,1));_isDebbugingShader&&_gl.getError()!=_gl.NO_ERROR&&console.log(mesh,shader),mesh._gl.vao.unbind(),WEBGL2&&"undefined"!=typeof RenderMonitor&&RenderMonitor.active&&shader?.renderTimeQuery?.endTest?.()},this.upload=function(geom,mesh,shader,hotload){if(!mesh)return;geom._gl||(geom._gl={id:Utils.timestamp()}),mesh._gl||(mesh._gl={}),mesh._gl.geomInit=!0,geom.uploaded=!0,!mesh.isOcclusionMesh&&WEBGL2&&(mesh._gl.query=_gl.createQuery(),mesh._gl.queryInProgress=!1,mesh._gl.occluded=!1);const KEY=`${geom._gl.id}_${shader._gl._id}`;let cached=_cache[KEY];if(cached&&!hotload)return cached.count++,mesh._gl.vao=cached.vao,void(mesh._gl.lookup=KEY);Utils.query("debugUpload")&&console.log("?debugUpload  upload geometry",geom),RenderCount.add("geometry"),releaseVAO(mesh),mesh._gl.vao=new VAO(_gl),geom.distributeBufferData||RenderCount.add("geom_upload",geom);for(let i=geom._attributeKeys.length-1;i>-1;i--){let key=geom._attributeKeys[i],attrib=geom._attributeValues[i],location=mesh._gl.program===shader._gl.program&&mesh._gl[key]||_gl.getAttribLocation(shader._gl.program,key);if(mesh._gl[key]=location,attrib._gl)continue;attrib._gl={};let{array:array,dynamic:dynamic}=attrib;attrib.isInterleaved&&(attrib.data._gl||(attrib.data._gl=attrib._gl),attrib._gl=attrib.data._gl,array=attrib.data.array,dynamic=attrib.data.dynamic),checkAttributeArray(array,geom,key)&&(attrib._gl.buffer||(attrib._gl.buffer=_gl.createBuffer(),attrib._gl.bufferUploaded=!geom.distributeBufferData,checkAttributeArray(array,geom,key)&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,attrib._gl.buffer),_gl.bufferData(_gl.ARRAY_BUFFER,geom.distributeBufferData?array.length*array.BYTES_PER_ELEMENT:array,dynamic?_gl.DYNAMIC_DRAW:_gl.STATIC_DRAW),_gl.bindBuffer(_gl.ARRAY_BUFFER,null),attrib.needsNewBuffer&&(attrib.needsNewBuffer=!1)),geom.distributeBufferData||maybeDestroyAttributeData(geom,key)),attrib.needsUpdate=!1)}geom.index&&(geom._gl.index||checkAttributeArray(geom.index,geom,"index")&&(geom._gl.index=_gl.createBuffer(),geom._gl.indexType=geom.index instanceof Uint16Array?_gl.UNSIGNED_SHORT:_gl.UNSIGNED_INT,geom._gl.indexLength=geom.index.length,_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geom._gl.index),_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,geom.index,_gl.STATIC_DRAW),_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,null),maybeDestroyAttributeData(geom,"index"))),mesh._gl.vao.bind();for(let i=geom._attributeKeys.length-1;i>-1;i--){let array,key=geom._attributeKeys[i],attrib=geom._attributeValues[i],location=mesh._gl[key];if(-1==location)continue;let stride=0,offset=0;if(attrib.isInterleaved){array=attrib.data.array;let bytes=array.BYTES_PER_ELEMENT;stride=attrib.data.stride*bytes,offset=attrib.offset*bytes}else array=attrib.array;_gl.bindBuffer(_gl.ARRAY_BUFFER,attrib._gl.buffer),array instanceof Float32Array?_gl.vertexAttribPointer(location,attrib.itemSize,_gl.FLOAT,!1,stride,offset):_gl.vertexAttribIPointer(location,attrib.itemSize,getGLTypeForTypedArray(array),!1,stride,offset),_gl.enableVertexAttribArray(location),geom.isInstanced&&(WEBGL2?_gl.vertexAttribDivisor(location,attrib.meshPerAttribute):Renderer.extensions.instancedArrays.vertexAttribDivisorANGLE(location,attrib.meshPerAttribute))}geom.index&&_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geom._gl.index),mesh._gl.vao.unbind(),_cache[KEY]={count:1,vao:mesh._gl.vao},mesh._gl.lookup=KEY},this.destroy=function(geom,mesh){if(!geom.keepAlive){for(let i=geom._attributeKeys.length-1;i>-1;i--){geom._attributeKeys[i];let attrib=geom._attributeValues[i];attrib._gl&&(_gl.deleteBuffer(attrib._gl.buffer),attrib._gl=null)}geom._gl?.index&&_gl.deleteBuffer(geom._gl.index),delete geom._gl,geom.uploaded=!1,RenderCount.remove("geometry")}releaseVAO(mesh)},this.resetMeshGeom=function(mesh){mesh._gl&&(mesh._gl.geomInit=!1)},this.getUploadBuffersStepper=function(geom){let uploadedSome;geom.distributeBufferData=!0;let chunk,i,amt,attributeIndex=0,isUploadingAttribute=!1;return function(){if(geom._gl&&geom._gl.uploadedAsync)return!0;if(attributeIndex>geom._attributeKeys.length-1)return!0;let key=geom._attributeKeys[attributeIndex],attrib=geom._attributeValues[attributeIndex];if(isUploadingAttribute){let array=attrib.array,buffer=attrib._gl.buffer,offset=i*chunk,subarray=array.subarray(offset,offset+chunk);if(!attrib._gl)return!0;if(subarray.length&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,buffer),_gl.bufferSubData(_gl.ARRAY_BUFFER,offset*array.BYTES_PER_ELEMENT,subarray),_gl.bindBuffer(_gl.ARRAY_BUFFER,null)),++i===amt){if(attrib.needsUpdate=!1,maybeDestroyAttributeData(geom,key),attributeIndex===geom._attributeKeys.length-1)return geom._gl.uploadedAsync=!0,uploadedSome&&RenderCount.add("geom_uploadAsync",geom),!0;attributeIndex++,isUploadingAttribute=!1}}else{if(!attrib._gl){let{array:array,dynamic:dynamic}=attrib;attrib._gl={},attrib.isInterleaved&&(attrib.data._gl||(attrib.data._gl=attrib._gl),attrib._gl=attrib.data._gl,array=attrib.data.array,dynamic=attrib.data.dynamic),attrib._gl.buffer||(attrib._gl.buffer=_gl.createBuffer(),attrib._gl.bufferUploaded=!geom.distributeBufferData,checkAttributeArray(array,geom,key)&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,attrib._gl.buffer),_gl.bufferData(_gl.ARRAY_BUFFER,array.length*array.BYTES_PER_ELEMENT,dynamic?_gl.DYNAMIC_DRAW:_gl.STATIC_DRAW),_gl.bindBuffer(_gl.ARRAY_BUFFER,null))),attrib.needsUpdate=!1,geom.needsUpdate=!0}if(attrib._gl.bufferUploaded)return attributeIndex===geom._attributeKeys.length-1?(geom._gl.uploadedAsync=!0,uploadedSome&&RenderCount.add("geom_uploadAsync",geom),!0):void attributeIndex++;attrib._gl.bufferUploaded=!0,uploadedSome=!0;let array=attrib.array;amt=4;for(;amt--,array.length%amt!=0;);chunk=array.length/amt,i=0,isUploadingAttribute=!0}}},this.uploadBuffersAsync=async function(geom){let stepper=_this.getUploadBuffersStepper(geom),promise=Promise.create(),worker=new Render.Worker(function(){stepper()&&(promise.resolve(),worker.stop())});return promise}}),Class(function ShaderRendererWebGL(_gl){const _this=this;var _pool={},_programID=0,_cached={},_uboCache={};const PROFILER=!!window.OptimizationProfiler,WEBGL2=Renderer.type==Renderer.WEBGL2,GLOBAL_UNIFORMS=["normalMatrix","modelMatrix","modelViewMatrix","projectionMatrix","viewMatrix","cameraPosition","cameraQuaternion","resolution","time","shadowMatrix","shadowLightPos","shadowSize"],DEPTH_FUNC_KEYS={[Shader.DEPTH_FUNC_NEVER]:"NEVER",[Shader.DEPTH_FUNC_LESS]:"LESS",[Shader.DEPTH_FUNC_EQUAL]:"EQUAL",[Shader.DEPTH_FUNC_LEQUAL]:"LEQUAL",[Shader.DEPTH_FUNC_GREATER]:"GREATER",[Shader.DEPTH_FUNC_NOTEQUAL]:"NOTEQUAL",[Shader.DEPTH_FUNC_GEQUAL]:"GEQUAL",[Shader.DEPTH_FUNC_ALWAYS]:"ALWAYS"};function toTypedArray(uni){uni.value;return uni._gl||(uni._gl={}),uni._gl.array&&uni._gl.array.length==uni.value.length?uni._gl.array.set(uni.value):uni._gl.array=new Float32Array(uni.value),uni._gl.array}function createShader(str,type,name="Shader"){let shader=_gl.createShader(type);return void 0!==window.SPECTOR&&(shader.__SPECTOR_Metadata={name:name}),_gl.shaderSource(shader,str),_gl.compileShader(shader),Hydra.LOCAL&&(_gl.getShaderParameter(shader,_gl.COMPILE_STATUS)||(!function logPrettyShaderError(shader){const shaderSrc=_gl.getShaderSource(shader).split("\n").map((line,index)=>`${index}: ${line}`),shaderLog=_gl.getShaderInfoLog(shader),splitShader=shaderLog.split("\n"),dedupe={},lineNumbers=splitShader.map(line=>parseFloat(line.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(n=>!(!n||dedupe[n])&&(dedupe[n]=!0,!0)),logArgs=[""];lineNumbers.forEach(number=>{shaderSrc[number-1]=`%c${shaderSrc[number-1]}%c`,logArgs.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const fragmentSourceToLog=shaderSrc.join("\n");logArgs[0]=fragmentSourceToLog,console.error(shaderLog),console.groupCollapsed("click to view full shader code"),console.warn(...logArgs),console.groupEnd()}(shader),_gl.deleteShader(shader))),shader}function createProgram(shader){shader.vertexShader||Shader.runPreProcess(shader),_this.multiViewOverride&&_this.multiViewOverride(shader);let vsCode=shader.onBeforeCompile(shader.vertexShader,"vs"),fsCode=shader.onBeforeCompile(shader.fragmentShader,"fs");PROFILER&&OptimizationProfiler.active&&([vsCode,fsCode]=OptimizationProfiler.override(shader,vsCode,fsCode)),RenderCount.add("shader",shader);let vs=createShader(vsCode,_gl.VERTEX_SHADER,`${shader.vsName} - ${shader.UILPrefix}`),fs=createShader(fsCode,_gl.FRAGMENT_SHADER,`${shader.fsName} - ${shader.UILPrefix}`);Hydra.LOCAL&&window.GLSLLinter&&GLSLLinter.lint(shader,vsCode,fsCode);let program=_gl.createProgram();return _gl.attachShader(program,vs),_gl.attachShader(program,fs),_gl.linkProgram(program),Hydra.LOCAL&&(_gl.getProgramParameter(program,_gl.LINK_STATUS)||(console.warn(`Shader: ${shader.vsName} | ${shader.vsName}`),console.error(`Could not compile WebGL program. ${shader.vsName} ${shader.fsName} \n\n`+_gl.getProgramInfoLog(program)))),_gl.deleteShader(vs),_gl.deleteShader(fs),program}function setupShaders(shader){for(let i=shader._uniformKeys.length-1;i>-1;i--){let key=shader._uniformKeys[i],uniform=shader._uniformValues[i];if(void 0===shader._gl[key]&&uniform)if(uniform.ubo)if(WEBGL2){if(_uboCache[shader.UILPrefix]&&!shader.ubo&&(shader.ubo=_uboCache[shader.UILPrefix]),_uboCache[shader.UILPrefix]){shader._gl[key]="U";continue}shader.ubo||(shader.ubo=new UBO(1,_gl)),shader.ubo.push(uniform),shader._gl[key]="U"}else shader._gl[key]=_gl.getUniformLocation(shader._gl.program,key);else WEBGL2&&uniform.lightUBO?(shader._gl[key]="U",shader.uboLight=!0):shader._gl[key]=_gl.getUniformLocation(shader._gl.program,key)}shader.ubo&&!_uboCache[shader.UILPrefix]&&(_uboCache[shader.UILPrefix]=shader.ubo),shader._gl.setupGlobals||(shader._gl.setupGlobals=!0,GLOBAL_UNIFORMS.forEach(key=>{shader._gl[key]=_gl.getUniformLocation(shader._gl.program,key)})),shader.uboLight&&_gl.getUniformBlockIndex(shader._gl.program,"lights"),WEBGL2&&_gl.getUniformBlockIndex(shader._gl.program,"global")}function findUniformType(uniform){return"string"==typeof uniform.type?uniform.type:"boolean"==typeof uniform.value?"b":null===uniform.value||uniform.value instanceof Texture||uniform.value.texture||uniform.value.rt&&uniform.value.rt.texture?"t":uniform.value instanceof Vector2?"v2":uniform.value instanceof Vector3||uniform.value instanceof Vector3D?"v3":uniform.value instanceof Vector4?"v4":uniform.value instanceof Matrix4?"m4":uniform.value instanceof Matrix3?"m3":uniform.value instanceof Color?"c":uniform.value instanceof Quaternion?"q":Array.isArray(uniform.value)&&uniform.value[0]instanceof Texture?"tv":"f"}function uniformTextureArray(uni,uLoc,shader){let array=shader._gl.texArray||[];array.length=0,shader._gl.texArray=array;for(let i=0;i<uni.value.length;i++){array.push(shader._gl.texIndex);let texture=uni.value[i];!1===texture.loaded&&(texture=Utils3D.getEmptyTexture()),(void 0===texture._gl||texture.needsReupload)&&Texture.renderer.upload(texture),_gl.activeTexture(_gl["TEXTURE"+shader._gl.texIndex++]),_gl.bindTexture(_gl.TEXTURE_2D,texture._gl)}_gl.uniform1iv(uLoc,array)}this.upload=function(shader){if(PROFILER&&OptimizationProfiler.active&&OptimizationProfiler.setupShader(shader),!shader._gl){shader._gl={};let key=`${shader.vsName}_${shader.fsName}_${shader.customCompile}`,cached=_pool[key];cached?(shader._gl.program=cached.program,shader._gl._id=cached.id,shader.onBeforePrecompilePromise.resolve(),cached.count++,Hydra.LOCAL&&_pool[key].references.push(shader)):(shader._gl.program=createProgram(shader),shader._gl._id=_programID++,_pool[key]={count:1,program:shader._gl.program,id:shader._gl._id},Shader.registerPreProcess(shader),Hydra.LOCAL&&(_pool[key].references=[shader]))}setupShaders(shader),shader.ubo&&shader.ubo.upload(),Renderer.type==Renderer.WEBGL1&&FXLayer.exists||(shader.vertexShader=shader.fragmentShader="")},this.findCachedProgram=function(shader){let key=`${shader.vsName}_${shader.fsName}_${shader.customCompile}`,cached=_pool[key];return!!cached&&(shader._gl={},shader._gl.program=cached.program,shader._gl._id=cached.id,Shader.addAutoUniforms(shader),shader.onBeforePrecompilePromise.resolve(),_uboCache[shader.UILPrefix]&&(shader.ubo=shader.UILPrefix),cached.count++,Hydra.LOCAL&&_pool[key].references.push(shader),!0)},this.draw=function(shader){void 0===shader._gl&&this.upload(shader),WEBGL2&&"undefined"!=typeof RenderMonitor&&RenderMonitor.active&&(shader.renderTimeQuery||(shader.renderTimeQuery=RenderMonitor.createQuery(_gl,shader)),shader.renderTimeQuery.beginTest?.()),shader._gl.texIndex=0,shader._gl.program!=_cached.program&&(_gl.useProgram(shader._gl.program),_cached.program=shader._gl.program),shader.ubo&&shader.ubo.bind(shader._gl.program,"ubo"),shader.uboLight&&Lighting.bindUBO(shader._gl.program);for(let i=shader._uniformKeys.length-1;i>-1;i--){let key=shader._uniformKeys[i],uni=shader._uniformValues[i];if(!uni)continue;let uLoc=shader._gl[key];if(void 0===uLoc&&(setupShaders(shader),uLoc=shader._gl[key]),null!==uLoc&&-1!==uLoc&&"U"!==uLoc){if(null===uni.value&&(uni.value=Utils3D.getEmptyTexture()),Hydra.LOCAL&&void 0===uni.value)throw`Uniform ${key} value is undefined. | ${shader.vsName} ${shader.fsName}`;switch(uni.type||(uni.type=findUniformType(uni)),uni.type){case"f":_gl.uniform1f(uLoc,uni.value);break;case"i":_gl.uniform1i(uLoc,Math.floor(uni.value));break;case"b":_gl.uniform1i(uLoc,uni.value);break;case"v2":_gl.uniform2f(uLoc,uni.value.x,uni.value.y);break;case"v3":_gl.uniform3f(uLoc,uni.value.x,uni.value.y,uni.value.z);break;case"c":_gl.uniform3f(uLoc,uni.value.r,uni.value.g,uni.value.b);break;case"q":case"v4":_gl.uniform4f(uLoc,uni.value.x,uni.value.y,uni.value.z,uni.value.w);break;case"v3v":_gl.uniform3fv(uLoc,toTypedArray(uni));break;case"v4v":_gl.uniform4fv(uLoc,toTypedArray(uni));break;case"v2v":_gl.uniform2fv(uLoc,toTypedArray(uni));break;case"fv":_gl.uniform1fv(uLoc,toTypedArray(uni));break;case"m4":_gl.uniformMatrix4fv(uLoc,!1,uni.value.elements);break;case"m3":_gl.uniformMatrix3fv(uLoc,!1,uni.value.elements);break;case"tv":uniformTextureArray(uni,uLoc,shader);break;case"t":let texture=uni.value;texture.isTexture||(uni.value.rt&&(texture=uni.value.rt.overrideTexture||uni.value.rt.texture),uni.value.texture&&(texture=uni.value.texture)),!1===texture.loaded&&(texture=Utils3D.getEmptyTexture());let texIndex=shader._gl.texIndex++;uni.value.vrRT&&(shader._gl.vrRT=!0,uni.value._glTexIndex=texIndex),Texture.renderer.draw(texture,uLoc,key,texIndex)}}}if(!shader.glCustomState){if(shader.polygonOffset){let key=shader.polygonOffsetFactor+"_"+shader.polygonOffsetUnits;_cached.polygonOffset!=key&&(_gl.enable(_gl.POLYGON_OFFSET_FILL),_gl.polygonOffset(shader.polygonOffsetFactor,shader.polygonOffsetUnits)),_cached.polygonOffset=key}else _cached.polygonOffset&&_gl.disable(_gl.POLYGON_OFFSET_FILL),_cached.polygonOffset=!1;if(shader.transparent||shader.opacity?(_cached.transparent||_gl.enable(_gl.BLEND),_cached.transparent=!0):(_cached.transparent&&_gl.disable(_gl.BLEND),_cached.transparent=!1),_cached.blending!=shader.blending){switch(shader.blending){case Shader.ADDITIVE_BLENDING:_gl.blendEquation(_gl.FUNC_ADD),_gl.blendFunc(_gl.SRC_ALPHA,_gl.ONE);break;case Shader.PREMULTIPLIED_ALPHA_BLENDING:_gl.blendEquation(_gl.FUNC_ADD),_gl.blendFunc(_gl.ONE,_gl.ONE_MINUS_SRC_ALPHA);break;case Shader.REVERSE_PREMULTIPLIED_ALPHA_BLENDING:_gl.blendEquation(_gl.FUNC_ADD),_gl.blendFunc(_gl.ONE_MINUS_DST_ALPHA,_gl.ONE);break;case Shader.ADDITIVE_COLOR_ALPHA:_gl.blendEquation(_gl.FUNC_ADD),_gl.blendFunc(_gl.ONE,_gl.ONE);break;case Shader.MULTIPLY_BLENDING:_gl.blendEquation(_gl.FUNC_ADD),_gl.blendFunc(_gl.DST_COLOR,_gl.ZERO);break;case Shader.MAX:_gl.blendEquation(WEBGL2?_gl.MAX:Renderer.extensions.minMax.MAX_EXT),_gl.blendFunc(_gl.ONE,_gl.ONE);break;case Shader.MIN:_gl.blendEquation(WEBGL2?_gl.MIN:Renderer.extensions.minMax.MIN_EXT),_gl.blendFunc(_gl.ONE,_gl.ONE);break;default:_gl.blendEquationSeparate(_gl.FUNC_ADD,_gl.FUNC_ADD),_gl.blendFuncSeparate(_gl.SRC_ALPHA,_gl.ONE_MINUS_SRC_ALPHA,_gl.ONE,_gl.ONE_MINUS_SRC_ALPHA)}_cached.blending=shader.blending}shader.depthTest?(_cached.depthTest||_gl.enable(_gl.DEPTH_TEST),_cached.depthTest=!0):(_cached.depthTest&&_gl.disable(_gl.DEPTH_TEST),_cached.depthTest=!1);let depthFunc=_gl[DEPTH_FUNC_KEYS[shader.depthFunc||Shader.DEPTH_FUNC_LESS]];if(_cached.depthFunc!==depthFunc&&(_gl.depthFunc(depthFunc),_cached.depthFunc=depthFunc),shader.stencilTest)if(_cached.stencilTest||_gl.enable(_gl.STENCIL_TEST),_cached.stencilTest=!0,shader.stencilMask)_gl.stencilFunc(_gl.ALWAYS,1,255),_gl.stencilOp(_gl.KEEP,_gl.KEEP,_gl.REPLACE),_gl.stencilMask(255),_gl.colorMask(!1,!1,!1,!1),_gl.disable(_gl.DEPTH_TEST);else{_gl.colorMask(!0,!0,!0,!0),_gl.enable(_gl.DEPTH_TEST);let mode="inside";_gl.stencilFunc("inside"==mode?_gl.EQUAL:_gl.NOTEQUAL,1,255),_gl.stencilOp(_gl.KEEP,_gl.KEEP,_gl.KEEP)}else _cached.stencilTest&&_gl.disable(_gl.STENCIL_TEST),_cached.stencilTest=!1;switch(shader.side){case Shader.BACK_SIDE:_cached.side!=Shader.BACK_SIDE&&(_gl.enable(_gl.CULL_FACE),_gl.cullFace(_gl.FRONT),_cached.side=Shader.BACK_SIDE);break;case Shader.DOUBLE_SIDE:_cached.side!=Shader.DOUBLE_SIDE&&(_gl.disable(_gl.CULL_FACE),_cached.side=Shader.DOUBLE_SIDE);break;default:_cached.side!=Shader.FRONT_SIDE&&(_gl.enable(_gl.CULL_FACE),_gl.cullFace(_gl.BACK),_cached.side=Shader.FRONT_SIDE)}if(_cached.depthMask!=shader.depthWrite&&(_gl.depthMask(!!shader.depthWrite),_cached.depthMask=shader.depthWrite),shader.colorMask&&shader.colorMask.push)_gl.colorMask(shader.colorMask[0]||!1,shader.colorMask[1]||!1,shader.colorMask[2]||!1,shader.colorMask[3]||!1);else switch(shader.colorMask){case Shader.COLOR_MASK_NONE:_cached.colorMask!=shader.colorMask&&(_gl.colorMask(!0,!0,!0,!0),_cached.colorMask=shader.colorMask);break;case Shader.COLOR_MASK_RGB:_cached.colorMask!=shader.colorMask&&(_gl.colorMask(!1,!1,!1,!0),_cached.colorMask=shader.colorMask);break;case Shader.COLOR_MASK_RGBA:_cached.colorMask!=shader.colorMask&&(_gl.colorMask(!1,!1,!1,!1),_cached.colorMask=shader.colorMask)}}if(shader.customState)for(let i=0;i<shader.customState.length;i++){let obj=shader.customState[i];_gl[obj.fn].apply(_gl,obj.params)}},this.destroy=function(shader){delete shader._gl,shader.ubo&&shader.ubo.destroy()},this.appendUniform=function(shader,key,value,hint){let loc=shader._gl[key];if(void 0===loc&&(loc=loc=_gl.getUniformLocation(shader._gl.program,key)),null!==loc)if(value.isMatrix4)_gl.uniformMatrix4fv(loc,!1,value.elements);else if(value.isMatrix3)_gl.uniformMatrix3fv(loc,!1,value.elements);else if(value.isVector4)_gl.uniform4f(loc,value.x,value.y,value.z,value.w);else if(value.isQuaternion)_gl.uniform4f(loc,value.x,value.y,value.z,value.w);else if(value.isVector3)_gl.uniform3f(loc,value.x,value.y,value.z);else if(value.isVector2)_gl.uniform2f(loc,value.x,value.y);else if(value instanceof Float32Array)switch(hint){case"matrix":_gl.uniformMatrix4fv(loc,!1,value);break;case"float":_gl.uniform1fv(loc,value);break;case"vec3":_gl.uniform3fv(loc,value)}else if(Array.isArray(value)){let array=shader._gl.texArray||[];array.length=0,shader._gl.texArray=array;for(let i=0;i<value.length;i++)array.push(shader._gl.texIndex),_gl.activeTexture(_gl["TEXTURE"+shader._gl.texIndex++]),_gl.bindTexture(_gl.TEXTURE_2D,value[i]._gl);_gl.uniform1iv(loc,array)}else _gl.uniform1f(loc,value)},this.resetState=function(){_cached.depthMask||(_gl.depthMask(!0),_cached.depthMask=!0),_cached.depthTest||_gl.enable(_gl.DEPTH_TEST),_cached.depthTest=!0,_cached.depthFunc!==_gl.LESS&&_gl.depthFunc(_gl.LESS),_cached.depthFunc=_gl.LESS,_cached.colorMask!=Shader.COLOR_MASK_NONE&&(_gl.colorMask(!0,!0,!0,!0),_cached.colorMask=Shader.COLOR_MASK_NONE),_cached.program=null},this.clearState=function(){_cached={}},this.hotReload=function(file){file=file.split(".")[0].trim();for(let key in _pool)if(key.includes(file)&&!["|instance","|Line3D","|MergedLine"].find(part=>key.includes(part))){let obj=_pool[key],rootShader=obj.references[0];for(let i=0;i<obj.references.length;i++){let shader=obj.references[i];0===i?(shader.restoreFS=shader.restoreVS=null,shader.resetProgram(),shader._gl={},shader._gl.program=createProgram(shader),shader._gl._id=_programID++,obj.program=shader._gl.program,obj.id=shader._gl._id):(shader.destroy(),shader.restoreFS=rootShader.restoreFS,shader.restoreVS=rootShader.restoreVS,shader.vertexShader=rootShader.vertexShader,shader.fragmentShader=rootShader.fragmentShader,shader._gl={},shader._gl.program=obj.program,shader._gl._id=obj.id),setupShaders(rootShader)}}},this.hotReloadClearProgram=function(id){for(let key in _pool)key.includes(id)&&delete _pool[key]}}),Class(function TextureRendererWebGL(_gl){const _this=this;var _state={};const FLOAT_DATA=new Float32Array([0,0,0,0]),UINT_DATA=new Uint32Array([0,0,0,0]),INT_DATA=new Int32Array([0,0,0,0]),DATA=new Uint8Array([0,0,0,0]),{getFormat:getFormat,getProperty:getProperty,getType:getType,getFloatParams:getFloatParams,getInternalFormat:getInternalFormat}=require("GLTypes");function setTextureParams(texture,textureType=_gl.TEXTURE_2D){let format=getFormat(texture),internalFormat=getInternalFormat(texture),type=getType(texture),data=DATA;switch(texture.type){case Texture.FLOAT:data=FLOAT_DATA;break;case Texture.UNSIGNED_INTEGER:data=UINT_DATA;break;case Texture.INTEGER:data=INT_DATA;break;case Texture.HALF_FLOAT:data=null}textureType!=_gl.TEXTURE_2D||texture.compressed||_gl.texImage2D(textureType,0,internalFormat,1,1,0,format,type,data),_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,getProperty(texture.wrapS)),_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,getProperty(texture.wrapT)),_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,getProperty(texture.magFilter)),_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,getProperty(texture.minFilter)),texture.data||texture.format!=Texture.RGBAFormat?1==_state.premultiply&&(_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_state.premultiply=!1):!1===texture.premultiplyAlpha||texture.compressed&&texture.image?.uncompressed?(_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_state.premultiply=!1):(_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),_state.premultiply=!0),texture.anisotropy>1&&_gl.texParameterf(textureType,Renderer.extensions.anisotropy.TEXTURE_MAX_ANISOTROPY_EXT,texture.anisotropy)}function updateDynamic(texture){if(texture.isDataTexture){if(!0===texture.flipY?_state.flipY||(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,!0),_state.flipY=!0):_state.flipY&&(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,!1),_state.flipY=!1),_state.premultiply&&(_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_state.premultiply=!1),!texture.glFormat){let{internalformat:internalformat,format:format,type:type}=getFloatParams(texture);texture.iformat=internalformat,texture.glFormat=format,texture.glType=type}_gl.texSubImage2D(_gl.TEXTURE_2D,0,0,0,texture.width,texture.height,texture.glFormat,texture.glType,texture.data)}else if(_state.flipY||(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,!0),_state.flipY=!0),texture.format==Texture.RGBAFormat?!1===texture.premultiplyAlpha||texture.compressed&&texture.image?.uncompressed?(_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_state.premultiply=!1):(_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),_state.premultiply=!0):_state.premultiply&&(_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_state.premultiply=!1),texture.glFormat||(texture.glFormat=getFormat(texture)),texture.image&&texture.compressed){let data=texture.image.compressedData;for(let i=0;i<data.length;i++){let size=texture.image.sizes[i];if(texture.image.isTextureArray){let layers=texture.image.layers||1;texture.image.uncompressed?_gl.texImage3D(_gl.TEXTURE_2D_ARRAY,i,_gl.RGBA,size.width,size.height,layers,0,_gl.RGBA,_gl.UNSIGNED_BYTE,data[i]):_gl.compressedTexImage3D(_gl.TEXTURE_2D_ARRAY,i,texture.image.gliFormat,size.width||size,size.height||size,layers,0,data[i])}else texture.image.uncompressed?_gl.texImage2D(_gl.TEXTURE_2D,i,_gl.RGBA,size.width,size.height,0,_gl.RGBA,_gl.UNSIGNED_BYTE,data[i]):_gl.compressedTexImage2D(_gl.TEXTURE_2D,i,texture.image.gliFormat,size.width||size,size.height||size,0,data[i])}data.length=0}else{try{_gl.texImage2D(_gl.TEXTURE_2D,0,texture.glFormat,texture.glFormat,getType(texture),texture.image)}catch(e){}texture.generateMipmaps&&!texture.compressed&&_gl.generateMipmap(_gl.TEXTURE_2D)}}function getTextureTarget(texture,_gl){return texture.cube?_gl.TEXTURE_CUBE_MAP:texture.isTexture3D?_gl.TEXTURE_3D:texture.isTextureArray?_gl.TEXTURE_2D_ARRAY:texture.EXT_OES?_gl.TEXTURE_EXTERNAL_OES:_gl.TEXTURE_2D}this.draw=function(texture,loc,key,id){_gl.activeTexture(_gl[`TEXTURE${id}`]),(void 0===texture._gl||texture.needsReupload)&&this.upload(texture),_gl.bindTexture(getTextureTarget(texture,_gl),texture._gl),_gl.uniform1i(loc,id),(texture.dynamic||texture.needsUpdate)&&updateDynamic(texture),texture.needsUpdate=!1},this.upload=function(texture){if(texture._gl&&!texture.needsReupload&&!texture.needsUpdate)return;let format=getFormat(texture);if(Utils.query("debugUpload")&&console.log("?debugUpload  upload texture",texture),texture.cube){if(texture.compressed){if(1!==texture.cube.length)throw"Compressed cube texture requires 1 file with 6 faces"}else if(6!==texture.cube.length)throw"Cube texture requires 6 images";return function uploadCube(texture){if(void 0===texture._gl){texture._gl=_gl.createTexture(),_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture._gl);let needsFlipY=!0===texture.flipY;needsFlipY!==!!_state.flipY&&(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,needsFlipY),_state.flipY=needsFlipY),setTextureParams(texture,_gl.TEXTURE_CUBE_MAP)}let format=getFormat(texture);if(texture.compressed){let image=texture.cube[0];for(let i=0;i<image.compressedData.length;i++){let size=image.sizes[i],data=image.compressedData[i],faceLength=data.length/6;for(let j=0;j<6;j++)if(image.uncompressed){let view=new Uint8Array(data.buffer,j*faceLength,faceLength);_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+j,i,_gl.RGBA,size.width,size.height,0,_gl.RGBA,_gl.UNSIGNED_BYTE,view)}else{let view=new DataView(data.buffer,j*faceLength,faceLength);_gl.compressedTexImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+j,i,image.gliFormat,size.width||size,size.height||size,0,view)}}}else{for(let i=0;i<6;i++)_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,format,format,getType(texture),texture.cube[i]);_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP)}texture.needsUpdate=texture.needsReupload=!1,texture.onUpdate&&texture.onUpdate()}(texture)}if(texture.isTexture3D)return function uploadTexture3D(texture){if(void 0===texture._gl){let format=getFormat(texture),internalFormat=getInternalFormat(texture),type=getType(texture);texture._gl=_gl.createTexture(),_gl.bindTexture(_gl.TEXTURE_3D,texture._gl),_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,!1),_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_gl.texParameteri(_gl.TEXTURE_3D,_gl.TEXTURE_WRAP_S,getProperty(texture.wrapS)),_gl.texParameteri(_gl.TEXTURE_3D,_gl.TEXTURE_WRAP_T,getProperty(texture.wrapT)),_gl.texParameteri(_gl.TEXTURE_3D,_gl.TEXTURE_WRAP_R,getProperty(texture.wrapR)),_gl.texParameteri(_gl.TEXTURE_3D,_gl.TEXTURE_MAG_FILTER,getProperty(texture.magFilter)),_gl.texParameteri(_gl.TEXTURE_3D,_gl.TEXTURE_MIN_FILTER,getProperty(texture.minFilter)),_gl.texImage3D(_gl.TEXTURE_3D,0,internalFormat,texture.width,texture.height,texture.depth,0,format,type,texture.image),texture.needsUpdate=texture.needsReupload=!1,texture.onUpdate&&texture.onUpdate()}}(texture);let texType=getTextureTarget(texture,_gl);if(void 0===texture._gl?(texture._gl=_gl.createTexture(),RenderCount.add("texture"),_gl.bindTexture(texType,texture._gl),setTextureParams(texture,texType)):_gl.bindTexture(texType,texture._gl),texture.isDataTexture||texture.type&&texture.type.includes("float")){!0===texture.flipY?_state.flipY||(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,!0),_state.flipY=!0):_state.flipY&&(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,!1),_state.flipY=!1),_gl.pixelStorei(_gl.UNPACK_ALIGNMENT,1);let{internalformat:internalformat,format:format,type:type}=getFloatParams(texture);if("ie"===Device.system.browser)try{_gl.texImage2D(_gl.TEXTURE_2D,0,internalformat,texture.width,texture.height,0,format,type,texture.distributeTextureData?null:texture.data)}catch(e){console.log(e)}else _gl.texImage2D(_gl.TEXTURE_2D,0,internalformat,texture.width,texture.height,0,format,type,texture.distributeTextureData?null:texture.data);texture.destroyDataAfterUpload&&(texture.data=null,delete texture.data,texture.onDataDestroyed?.())}else{let needsFlipY=!texture.compressed&&!1!==texture.flipY;if(needsFlipY!==!!_state.flipY&&(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,needsFlipY),_state.flipY=needsFlipY),texture.image&&texture.compressed){let data=texture.image.compressedData;if(texture.distributeTextureData){let size=texture.image.sizes[0];if(texture.image.isTextureArray){let layers=texture.image.layers||1;_gl.texStorage3D(_gl.TEXTURE_2D_ARRAY,data.length,texture.image.uncompressed?_gl.RGBA8:texture.image.gliFormat,size.width||size,size.height||size,layers)}else _gl.texStorage2D(_gl.TEXTURE_2D,data.length,texture.image.uncompressed?_gl.RGBA8:texture.image.gliFormat,size.width||size,size.height||size)}else{for(let i=0;i<data.length;i++){let size=texture.image.sizes[i];if(texture.image.isTextureArray){let layers=texture.image.layers||1;texture.image.uncompressed?_gl.texImage3D(_gl.TEXTURE_2D_ARRAY,i,_gl.RGBA,size.width,size.height,layers,0,_gl.RGBA,_gl.UNSIGNED_BYTE,data[i]):_gl.compressedTexImage3D(_gl.TEXTURE_2D_ARRAY,i,texture.image.gliFormat,size.width||size,size.height||size,layers,0,data[i])}else texture.image.uncompressed?_gl.texImage2D(_gl.TEXTURE_2D,i,_gl.RGBA,size.width,size.height,0,_gl.RGBA,_gl.UNSIGNED_BYTE,data[i]):_gl.compressedTexImage2D(_gl.TEXTURE_2D,i,texture.image.gliFormat,size.width||size,size.height||size,0,data[i])}data.length=0}}else if(texture.image&&!(texture.image instanceof HTMLVideoElement))try{_gl.texImage2D(_gl.TEXTURE_2D,0,format,format,getType(texture),texture.image)}catch(e){console.log("error loading texture",e,texture.image)}texture.distributeTextureData||RenderCount.add("tex_upload",texture)}(texture.image||texture.data)&&texture.generateMipmaps&&!texture.compressed&&_gl.generateMipmap(_gl.TEXTURE_2D),texture.needsUpdate=texture.needsReupload=!1,texture.onUpdate&&texture.onUpdate()},this.manualUpdateDynamic=function(texture){(void 0===texture._gl||texture.needsReupload)&&this.upload(texture),_gl.bindTexture(getTextureTarget(texture,_gl),texture._gl),updateDynamic(texture)},this.uploadAsync=function(texture){let{format:format,type:type}=getFloatParams(texture);if(texture._uploadAsyncPromise)return texture._uploadAsyncPromise;texture._uploadAsyncPromise=Promise.create(),RenderCount.add("tex_uploadAsync",texture),texture._gl||(texture.distributeTextureData=!0,_this.upload(texture));let rowsPerCall,bytesPerRow,bytesPerCall,isDataTexture=texture.isDataTexture||texture.type&&texture.type.includes("float"),rowIndex=0,levelIndex=0,layerIndex=0;if(!(isDataTexture||texture.image&&texture.compressed))throw new Error("uploadAsync requires data texture or compressed texture");if(isDataTexture){let chunks=Math.ceil(texture.data.length/1048576);rowsPerCall=Math.ceil(texture.height/chunks),bytesPerRow=Math.ceil(texture.data.length/texture.height),bytesPerCall=bytesPerRow*rowsPerCall}let worker=new Render.Worker(function workerUploadAsync(){let needsFlipY;needsFlipY=isDataTexture?!0===texture.flipY:!texture.compressed&&!1!==texture.flipY,needsFlipY!==!!_state.flipY&&(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,needsFlipY),_state.flipY=needsFlipY);let finished=!1,texType=getTextureTarget(texture,_gl);if(_gl.bindTexture(texType,texture._gl),isDataTexture){let rowsThisCall=Math.min(rowsPerCall,texture.height-rowIndex),dataOffset=bytesPerRow*rowIndex,subarray=texture.data.subarray(dataOffset,dataOffset+bytesPerCall);_gl.texSubImage2D(_gl.TEXTURE_2D,0,0,rowIndex,texture.width,rowsThisCall,format,type,subarray),rowIndex+=rowsPerCall,finished=rowIndex>=texture.height}else{let data=texture.image.compressedData[levelIndex],size=texture.image.sizes[levelIndex],width=size.width||size,height=size.height||size;if(texture.image.isTextureArray){let layers=texture.image.layers||1,bytesPerLayer=data.length/layers,layersPerCall=Math.clamp(Math.floor(1048576/bytesPerLayer),1,layers-layerIndex),dataOffset=layerIndex*bytesPerLayer,bytesPerCall=layersPerCall*bytesPerLayer,subarray=data.subarray(dataOffset,dataOffset+bytesPerCall);texture.image.uncompressed?_gl.texSubImage3D(_gl.TEXTURE_2D_ARRAY,levelIndex,0,0,layerIndex,width,height,layersPerCall,_gl.RGBA,_gl.UNSIGNED_BYTE,subarray):_gl.compressedTexSubImage3D(_gl.TEXTURE_2D_ARRAY,levelIndex,0,0,layerIndex,width,height,layersPerCall,texture.image.gliFormat,subarray),layerIndex+=layersPerCall,layerIndex>=layers&&(layerIndex=0,levelIndex++)}else{let multipleOf4Height=4*Math.ceil(height/4),bytesPerRow=data.length/multipleOf4Height,rowsPerCall=Math.floor(1048576/bytesPerRow),rowsThisCall=Math.clamp(4*Math.ceil(rowsPerCall/4),0,multipleOf4Height-rowIndex),bytesThisCall=rowsThisCall*bytesPerRow,dataOffset=bytesPerRow*rowIndex,subarray=data.subarray(dataOffset,dataOffset+bytesThisCall);texture.image.uncompressed?_gl.texSubImage2D(_gl.TEXTURE_2D,levelIndex,0,rowIndex,width,rowsThisCall,format,type,subarray):_gl.compressedTexSubImage2D(_gl.TEXTURE_2D,levelIndex,0,rowIndex,width,Math.min(height-rowIndex,rowsThisCall),texture.image.gliFormat,subarray),rowIndex+=rowsThisCall,rowIndex>=multipleOf4Height&&(rowIndex=0,levelIndex++)}finished=levelIndex>=texture.image.compressedData.length}_gl.bindTexture(texType,null),finished&&(worker.stop(),texture._uploadAsyncPromise.resolve())});return texture._uploadAsyncPromise},this.destroy=function(texture){texture._gl&&(_gl.deleteTexture(texture._gl),RenderCount.remove("texture"),RenderCount.add("tex_destroy",texture)),texture.data&&(texture.data=null,delete texture.data),delete texture._gl}});class RenderTarget{constructor(width,height,options={}){this.width=width,this.height=height,this.options=options,this.viewport=new Vector2(0,0),void 0===options.minFilter&&(options.minFilter=Texture.LINEAR),this.stencil="boolean"==typeof options.stencil&&options.stencil,options.sharedRenderbuffer&&(this.sharedRenderbuffer=!0,this.clearDepth="boolean"!=typeof options.clearDepth||options.clearDepth,this._depthBuffer=options.sharedRenderbuffer.rt._depthBuffer),this.texture=new Texture(null),this.texture.generateMipmaps=options.generateMipmaps,this.texture.rt=this,this.texture.width=width,this.texture.height=height,this.texture.minFilter=options.minFilter||Texture.LINEAR,this.texture.magFilter=options.magFilter||Texture.LINEAR,this.texture.wrapS=options.wrapS||Texture.CLAMP_TO_EDGE,this.texture.wrapT=options.wrapT||Texture.CLAMP_TO_EDGE,this.texture.format=options.format||Texture.RGBFormat,options.type&&(this.texture.type=options.type),options.multisample&&(Renderer.type?Renderer.type==Renderer.WEBGL2:Device.graphics.webgl.webgl2)&&(options.multisample=!1,this.multisample=!0,this._rtMultisample=new RenderTarget(width,height,options),this._rtMultisample.internalMultisample=!0,this._rtMultisample.parent=this,this._rtMultisample._samplesAmount=void 0===options.samplesAmount?100:options.samplesAmount),this.isRT=!0}setSize(width,height){this.width=width,this.height=height,this.texture.width=width,this.texture.height=height,this.viewport.set(0,0),RenderTarget.renderer.resize(this),!this.multisample||this._rtMultisample.width===width&&this._rtMultisample.height===height||(this._rtMultisample.destroy(),this._rtMultisample=new RenderTarget(width,height,this.options),this._rtMultisample.internalMultisample=!0,this._rtMultisample.parent=this,this._rtMultisample._samplesAmount=void 0===this.options.samplesAmount?100:this.options.samplesAmount)}clone(){return new RenderTarget(this.width,this.height,{...this.options}).copy(this)}copy(source){this.width=source.width,this.height=source.height;let options={...this.options};return this.options=options,this.viewport.copy(source.viewport),this.stencil=source.stencil,source.sharedRenderbuffer&&(this.sharedRenderbuffer=!0,this.clearDepth=source.clearDepth,this._depthBuffer=source._depthBuffer),this.texture=source.texture.clone(),source.multisample&&(options.multisample=!1,this.multisample=!0,this._rtMultisample=new RenderTarget(this.width,this.height,options),this._rtMultisample.internalMultisample=!0,this._rtMultisample.parent=this,this._rtMultisample._samplesAmount=source._rtMultisample._samplesAmount),this}createDepthTexture(){return this.depth=new Texture(null),this.depth.generateMipmaps=!1,this.depth.minFilter=Texture.NEAREST,this.depth.magFilter=Texture.NEAREST,this.depth.wrapS=Texture.CLAMP_TO_EDGE,this.depth.wrapT=Texture.CLAMP_TO_EDGE,this._gl&&RenderTarget.renderer.destroy(this),this.depth}destroy(){RenderTarget.renderer.destroy(this)}upload(){this._gl||RenderTarget.renderer.upload(this),this._rtMultisample&&this._rtMultisample.upload()}}class MultiRenderTarget extends RenderTarget{constructor(width,height,options={}){super(width,height,options),this.multi=!0,this.attachments=[this.texture]}}class CubeRenderTarget extends RenderTarget{constructor(width,height,options={}){super(width,height,options),this.activeFace=0,this.cube=!0}}Class(function Shader(_vertexShader,_fragmentShader,_params,_onBeforeBuild,_postfix){"object"==typeof _vertexShader&&(_fragmentShader=_vertexShader.uniforms,_vertexShader=_vertexShader.name);const _this=this;this.uniforms=Shader.createUniforms(this),this.side=Shader.FRONT_SIDE,this.blending=Shader.NORMAL_BLENDING,this.colorMask=Shader.COLOR_MASK_NONE,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=1,this.depthTest=!0,this.depthWrite=!0,this.depthFunc=Shader.DEPTH_FUNC_LESS,this.stencilTest=!1,this.stencilMask=!1,this.wireframe=!1,this.transparent=!1,this.visible=!0,this.persists=!1,this.precision="high",this.customCompile=_params?.customCompile||"",this.onBeforePrecompilePromise=Promise.create(),"string"!=typeof _fragmentShader&&(_params=_fragmentShader,_fragmentShader=_vertexShader),_params=_params||{},_this.vsParam=_vertexShader,_this.fsParam=_fragmentShader,_this.params=_params,_this.onBeforeBuild=_onBeforeBuild,_this.vsName=_vertexShader,_this.fsName=(_fragmentShader||_vertexShader)+(_postfix||""),_params.vsName&&(_this.vsName=_params.vsName,delete _params.vsName),_params.precision&&(_this.precision=_params.precision),_params.receiveShadow&&(_this.receiveLight=!0,World.RENDERER.shadows&&(_this.precision="high"));let vs=_vertexShader,fs=_fragmentShader;_params.uilFrom&&(vs=_params.uilFrom,fs=_params.uilFrom,delete _params.uilFrom),_this.UILPrefix=_params.UILPrefix||`${vs}/${fs}/${_params.unique?_params.unique+"/":""}`,Shader.parseParams(_params,_this),Shader.renderer.findCachedProgram(_this)||Shader.hasAlreadyPreProcessed(_this)||Shader.runPreProcess(_this)},_=>{Shader.FRONT_SIDE="shader_front_side",Shader.BACK_SIDE="shader_back_side",Shader.DOUBLE_SIDE="shader_double_side",Shader.DOUBLE_SIDE_TRANSPARENCY="shader_double_side_trasparency",Shader.ADDITIVE_BLENDING="shader_additive_blending",Shader.NORMAL_BLENDING="shader_normal_blending",Shader.PREMULTIPLIED_ALPHA_BLENDING="shader_premultiplied_alpha_blending",Shader.ADDITIVE_COLOR_ALPHA="shader_additive_color_alpha",Shader.MULTIPLY_BLENDING="shader_multiply_blending",Shader.REVERSE_PREMULTIPLIED_ALPHA_BLENDING="shader_reverse_premultiplied_alpha_blending",Shader.MAX="shader_max",Shader.MIN="shader_min",Shader.CUSTOM_DEPTH="shader_custom_depth",Shader.COLOR_MASK_RGB="shader_colormask_rgb",Shader.COLOR_MASK_RGBA="shader_colormask_rgba",Shader.COLOR_MASK_NONE="shader_colormask_none",Shader.DEPTH_FUNC_NEVER="shader_depth_func_never",Shader.DEPTH_FUNC_LESS="shader_depth_func_less",Shader.DEPTH_FUNC_EQUAL="shader_depth_func_equal",Shader.DEPTH_FUNC_LEQUAL="shader_depth_func_lequal",Shader.DEPTH_FUNC_GREATER="shader_depth_func_greater",Shader.DEPTH_FUNC_NOTEQUAL="shader_depth_func_notequal",Shader.DEPTH_FUNC_GEQUAL="shader_depth_func_gequal",Shader.DEPTH_FUNC_ALWAYS="shader_depth_func_always",Shader.BEFORE_DESTROY="shader_destroy",Shader.parseParams=function(_params,_this){for(let key in _params)if("receiveShadow"==key)_this.receiveShadow=_params[key];else if("receiveLight"==key)_this.receiveLight=_params[key];else if(_params[key]&&void 0!==_params[key].value)window.UILStorage&&UILStorage.hasData()?(_this.uniforms[key]=UILStorage.parse(_this.UILPrefix+key,_params[key].value)||_params[key],_params[key].ubo&&(_this.uniforms[key].ubo=!0)):_this.uniforms[key]=_params[key];else{if("unique"==key)continue;_this[key]=_params[key]}},Shader.runPreProcess=function(shader){if(shader.vertexShader=Shader.process(Shaders.getShader(shader.vsParam+".vs"),"vs",shader,shader.onBeforeBuild),shader.fragmentShader=Shader.process(Shaders.getShader(shader.fsParam+".fs"),"fs",shader,shader.onBeforeBuild),shader.vertexShader.includes("//js")&&!window[shader.vsName]){let code=shader.vertexShader.split("\n"),adders=[];code.forEach(line=>{if(line.includes("//js")){let name=line.split(" ")[2].replace(";",""),value=line.split("//js ")[1].replace(";","");adders.push(obj=>{obj[name]={value:eval?.(value)}})}else if(/uniform\s+sampler2D/.test(line)){let name=line.split(" ")[2].replace(";","");if(name.includes("sampler"))return;adders.push(obj=>{obj[name]||(obj[name]={value:null},line.includes("repeat")&&(obj[name].getTexture=Utils3D.getRepeatTexture),line.includes("ignoreUIL")&&(obj[name].ignoreUIL=!0))})}}),window[shader.vsName]=function(_mesh,_shader){let uniforms={};adders.forEach(addTo=>addTo(uniforms)),_shader.addUniforms(uniforms)}}};let shaderAutoUniforms={};function getLightingCode(_this){if(!_this.receiveShadow&&Shader.shouldReceiveShadow(_this)&&(_this.receiveShadow=!0),!_this.receiveLight||_this.isShadow)return"";let numLights=Lighting.getLighting(_this).position.length/4;return 0==numLights?Lighting.getShadowUniforms(_this):[`#define NUM_LIGHTS ${numLights}`,"uniform lights {",`vec4 lightPos[${numLights}];`,`vec4 lightColor[${numLights}];`,`vec4 lightData[${numLights}];`,`vec4 lightData2[${numLights}];`,`vec4 lightData3[${numLights}];`,`vec4 lightProperties[${numLights}];`,"};"].join("\n")+Lighting.getShadowUniforms(_this)}Shader.process=function(code,type,_this,_onBeforeBuild){const WEBGL2=Renderer.type==Renderer.WEBGL2;if(!code)throw"No shader found! "+_this.vsName+" | "+_this.fsName;const externalOES=code.includes("samplerExternalOES")&&window.AURA&&"android"==Device.system.os,standardDeriv=!WEBGL2&&code.includes(["fwidth","dFdx","dFdy"]),drawBuffers=!WEBGL2&&code.includes(["gl_FragData","#drawbuffer"])&&window.World&&World.NUKE.useDrawBuffers;let levelOfDetail=!WEBGL2&&code.includes(["textureGrad","textureProjGrad","texture2DGrad","textureCubeGrad","texture2DProjGrad"]);levelOfDetail||WEBGL2||"fs"!==type||(levelOfDetail=code.includes(["textureLod","texture2DLod","textureCubeLod","texture2DProjLod"]));const layoutsDefined=code.includes("layout");let header,autoUniforms;header="vs"==type?["#version 300 es",externalOES?"#extension GL_OES_EGL_image_external_essl3 : require":"",levelOfDetail?"#extension GL_EXT_shader_texture_lod : enable":"",`precision ${_this.precision}p float;`,`precision ${_this.precision}p int;`,WEBGL2?`precision ${_this.precision}p sampler3D;`:"",WEBGL2?`precision ${_this.precision}p sampler2DArray;`:"",WEBGL2?`precision ${_this.precision}p usampler2D;`:"",WEBGL2?`precision ${_this.precision}p isampler2D;`:"","attribute vec2 uv;","attribute vec3 position;","attribute vec3 normal;","uniform mat3 normalMatrix;","uniform mat3 normalMatrixWorld;","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform global {","mat4 projectionMatrix;","mat4 viewMatrix;","vec3 cameraPosition;","vec4 cameraQuaternion;","vec2 resolution;","float time;","float timeScale;","};"].join("\n"):["#version 300 es",externalOES?"#extension GL_OES_EGL_image_external_essl3 : require":"",standardDeriv?"#extension GL_OES_standard_derivatives : enable":"",drawBuffers?"#extension GL_EXT_draw_buffers : require":"",levelOfDetail?"#extension GL_EXT_shader_texture_lod : enable":"",`precision ${_this.precision}p float;`,`precision ${_this.precision}p int;`,WEBGL2?`precision ${_this.precision}p sampler3D;`:"",WEBGL2?`precision ${_this.precision}p sampler2DArray;`:"",WEBGL2?`precision ${_this.precision}p usampler2D;`:"",WEBGL2?`precision ${_this.precision}p isampler2D;`:"","uniform mat3 normalMatrix;","uniform mat3 normalMatrixWorld;","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform global {","mat4 projectionMatrix;","mat4 viewMatrix;","vec3 cameraPosition;","vec4 cameraQuaternion;","vec2 resolution;","float time;","float timeScale;","};",layoutsDefined?"":"out vec4 FragColor;"].join("\n"),header+="\n__ACTIVE_THEORY_LIGHTS__\n\n",window.AURA&&(header+="#define AURA\n"),_this.defines&&_this.defines.forEach(d=>header+=`#define ${d.toUpperCase()}\n`),_onBeforeBuild&&(code=_onBeforeBuild(code,type));let split=code.split("\n");for(let i=split.length-1;i>-1;i--){let line=split[i];if(line.includes("uniform sampler2D")){let name=line.split(" ")[2].replace(";","").trim();_this.uniforms[name]||(autoUniforms||(autoUniforms={}),autoUniforms[name]={value:null},line.includes("repeat")&&(autoUniforms[name].getTexture=Utils3D.getRepeatTexture),line.includes("ignoreUIL")&&(autoUniforms[name].ignoreUIL=!0))}}if(autoUniforms){shaderAutoUniforms[`${_this.vsName}_${_this.vsName}_${_this.customCompile}`]=autoUniforms;for(let key in autoUniforms)_this.uniforms[key]={...autoUniforms[key]}}return code=header+code},Shader.addAutoUniforms=function(_this){let autoUniforms=shaderAutoUniforms[`${_this.vsName}_${_this.vsName}_${_this.customCompile}`];if(autoUniforms)for(let key in autoUniforms)_this.uniforms[key]={...autoUniforms[key]}};const prototype=Shader.prototype,isResettingProgramProp="function"==typeof Symbol?Symbol("isResettingProgram"):"_isResettingProgram";prototype.copyUniformsTo=function(shader,linked,ignore){for(let key in this.uniforms)void 0!==this.uniforms[key]&&(ignore&&ignore.includes?.(key)||(shader.uniforms[key]=linked?this.uniforms[key]:{type:this.uniforms[key].type,value:this.uniforms[key].value}))},prototype.replicateUniformsTo=function(shader){shader.uniforms=this.uniforms,shader._uniformKeys=this._uniformKeys,shader._uniformValues=this._uniformValues},prototype.addUniforms=function(uniforms){uniforms.UILPrefix&&(this.UILPrefix=uniforms.UILPrefix,delete uniforms.UILPrefix);for(let key in uniforms)this.hotReloading&&this.uniforms[key]||(this.uniforms[key]=uniforms[key])},prototype.draw=function(mesh,geom){this.receiveLight&&!this.__lighting&&Lighting.getLighting(this),Shader.renderer.draw(this,mesh,geom)},prototype.upload=function(mesh,geom){!this.receiveShadow&&Shader.shouldReceiveShadow(this)&&(this.receiveShadow=!0),Shader.renderer.upload(this,mesh,geom),this.receiveShadow&&!this.shadow&&Lighting.initShadowShader(this,mesh)};let _destroyEvt={};prototype.destroy=function(){this.persists||(this[isResettingProgramProp]||(_destroyEvt.shader=this,Events.emitter._fireEvent(Shader.BEFORE_DESTROY,_destroyEvt),_destroyEvt.shader=null),Shader.renderer.destroy(this),this.shadow&&this.shadow.destroy()),this.receiveLight&&Lighting.destroyShader(this)},prototype.onBeforeCompile=function(code,type){const WEBGL2=Renderer.type==Renderer.WEBGL2;"}"!=(code=code.trim())[code.length-1]&&(code+="\n}");let p=this.mesh,scene=World.SCENE;for(this._hierarchyClue&&(p=this._hierarchyClue);p;)p instanceof Scene&&(scene=p),p=p._parent;scene.nuke&&scene.nuke.onBeforeShaderCompile?scene.nuke.onBeforeShaderCompile(this.mesh):this.onBeforePrecompilePromise.resolve(),this.receiveShadow&&(this.receiveLight=!0);let varyings=[],uniforms=[];(code=code.split("\n")).forEach((line,index)=>{"fs"==type&&line.includes("#drawbuffer")&&(line.includes("#drawbuffer Color")?code[index]=line.replace("#drawbuffer Color",""):code[index]=""),line.includes("varying")&&varyings.push(line.trim()),line.includes("uniform")&&uniforms.push(line.trim())}),code=code.join("\n");const process=function(array){let replace,counts=[];array.forEach(value=>{let count=0;array.forEach(v2=>{value==v2&&count++}),count>1&&(replace||(replace=[]),replace.includes(value)||(replace.push(value),counts.push(count)))}),replace&&replace.forEach((value,i)=>{let count=counts[i];for(let j=0;j<count-1;j++){let index=code.lastIndexOf(value);code=code.substring(0,index)+code.substring(index+value.length)}})};process(varyings),process(uniforms),"fs"==type&&(WEBGL2?code.includes("gl_FragColor")&&(code=code.replace(/gl_FragColor/g,"FragColor")):code.includes("#applyShadow")&&(code=code.replace("#applyShadow",""))),code=code.replace("__ACTIVE_THEORY_LIGHTS__",getLightingCode(this)),"fs"==type&&code.includes("SHADOW_MAPS")&&(code=require("GLSLOptimizer")(code.replaceAll("SHADOW_COUNT",Lighting.getShadowCount(this)))),this.preCompile&&(code=this.preCompile(code,type));let converter=require("ShaderCode");return code=WEBGL2?converter.convertWebGL2(code,type):converter.convertWebGL1(code,type)},prototype.set=function(key,value,ref){let _this=ref||this;return _this.uniforms[key]?(void 0!==value&&(TweenManager.clearTween(_this.uniforms[key]),_this.uniforms[key].value=value,_this.ubo&&(_this.ubo.needsUpdate=!0)),_this.uniforms[key].value):console.warn(`No key ${key} found on shader`,_this)},prototype.get=function(key,ref){let _this=ref||this;return _this.uniforms[key]&&_this.uniforms[key].value},prototype.tween=function(key,value,time,ease,delay,callback,update,scaledTime){return"number"==typeof value?tween(this.uniforms[key],{value:value},time,ease,delay,callback,update,null,scaledTime):tween(this.uniforms[key].value,value,time,ease,delay,callback,update,null,scaledTime)},prototype.clone=function(noShadows,postfix){const _this=this;noShadows&&(_this.params.receiveShadow=!1);let shader=new Shader(_this.vsParam,_this.fsParam,_this.params,null,postfix);for(let key in _this)key.includes(["vsName","fsName","uniforms","_uniform","_gl"])||"function"==typeof _this[key]||(shader[key]=_this[key]);for(let key in _this.uniforms)shader.uniforms[key]={type:_this.uniforms[key].type,value:_this.uniforms[key].value};return shader},prototype.resetProgram=function(){this[isResettingProgramProp]=!0,this.shadow&&(this.shadow[isResettingProgramProp]=!0),this.destroy(),this[isResettingProgramProp]=!1,this.shadow&&(this.shadow[isResettingProgramProp]=!1),this.vertexShader=this.restoreVS||Shader.process(Shaders.getShader(this.vsName+".vs"),"vs",this,this.onBeforeBuild),this.fragmentShader=this.restoreFS||Shader.process(Shaders.getShader(this.fsName+".fs"),"fs",this,this.onBeforeBuild),this.shadow=null};var _shaderShadowMap={},_emptyShadowMap;Object.defineProperty(prototype,"receiveShadow",{set:function(v){_shaderShadowMap[this.vsName+"_"+this.fsName]=v,this._receiveShadow=v,v&&!this.uniforms.shadowMap&&(_emptyShadowMap||(_emptyShadowMap=[Utils3D.getEmptyTexture()]),this.uniforms.shadowMap={value:_emptyShadowMap})},get:function(){return this._receiveShadow}});let shaders={};Shader.hasAlreadyPreProcessed=function(shader){let key=`${shader.vsName}_${shader.vsName}_${shader.customCompile}`;return shaders[key]},Shader.registerPreProcess=function(shader){let key=`${shader.vsName}_${shader.vsName}_${shader.customCompile}`;shaders[key]=!0},Shader.shouldReceiveShadow=function(shader){return _shaderShadowMap[shader.vsName+"_"+shader.fsName]}}),Shader.createUniforms=function(shader){let uniforms={},handler={set(target,property,value){target[property]=value,shader._uniformKeys.length=0,shader._uniformValues.length=0;for(let key in uniforms)shader._uniformKeys.push(key),shader._uniformValues.push(uniforms[key]);return!0}};return shader._uniformValues=[],shader._uniformKeys=[],new Proxy(uniforms,handler)};class Texture{constructor(img){this.magFilter=Texture.LINEAR,this.minFilter=Texture.LINEAR_MIPMAP,this.format=Texture.RGBAFormat,this.wrapS=this.wrapT=Texture.CLAMP_TO_EDGE,this._image=img,this.needsUpdate=!0,this.generateMipmaps=!0,this.anisotropy=1,this.type=Texture.UNSIGNED_BYTE,this.isTexture=!0,img&&img.onCreateTexture&&img.onCreateTexture(this)}set image(img){this._image=img,img&&img.onCreateTexture&&img.onCreateTexture(this)}get image(){return this._image}upload(){this._gl||Texture.renderer.upload(this)}uploadAsync(){return this.isDataTexture||this.type&&this.type.includes("float")||this.compressed?Texture.renderer.uploadAsync(this):this.upload()}destroy(){Texture.renderer.destroy(this),this._image=null}clone(){let texture=new Texture(this.img);return texture.format=this.format,texture.type=this.type,texture.anisotropy=this.anisotropy,texture.wrapS=this.wrapS,texture.wrapT=this.wrapT,texture.generateMipmaps=this.generateMipmaps,texture.minFilter=this.minFilter,texture.magFilter=this.magFilter,texture}}class DataTexture extends Texture{constructor(data,width,height,format,type,filter=null){super(),format&&(this.format=format),this.width=width,this.height=height,this.data=data,this.minFilter=this.magFilter=filter||Texture.NEAREST,this.generateMipmaps=!1,this.type=type||Texture.FLOAT,this.isDataTexture=!0,this.destroyDataAfterUpload=!1}uploadAsync(){return Texture.renderer.uploadAsync(this)}}class Texture3D extends Texture{constructor(image,width,height,depth,format,type,filter=null){super(),this.format=format||Texture.RGBAFormat,this.width=width,this.height=height,this.depth=depth,this.image=image,this.minFilter=this.magFilter=filter||Texture.LINEAR,this.wrapS=this.wrapT=this.wrapR=Texture.CLAMP_TO_EDGE,this.generateMipmaps=!1,this.type=type||Texture.FLOAT,this.isTexture3D=!0}}Texture.NEAREST="texture_nearest",Texture.CLAMP_TO_EDGE="texture_clamp",Texture.REPEAT="texture_repeat",Texture.MIRROR_REPEAT="texture_mirror_repeat",Texture.LINEAR="texture_linear",Texture.LINEAR_MIPMAP="texture_linear_mip",Texture.LINEAR_MIPMAP_NEAREST="texture_linear_mip_nearest",Texture.NEAREST_MIPMAP="texture_nearest_mip",Texture.RFormat="texture_rFormat",Texture.RGFormat="texture_rgFormat",Texture.RGBFormat="texture_rgbFormat",Texture.RGBAFormat="texture_rgbaFormat",Texture.UNSIGNED_BYTE="texture_unsigned_byte",Texture.DEPTH="texture_depth",Texture.FLOAT="texture_float",Texture.HALF_FLOAT="texture_half_float",Texture.UNSIGNED_INTEGER="texture_unsigned_integer",Texture.INTEGER="texture_integer",Module(function GLSLOptimizer(){this.exports=function(code){return function unrollLoops(string){return string.replace(/#pragma unroll_loop[\s]+?for \(int i \= (\d+)\; i < (\d+)\; i\+\+\) \{([\s\S]+?)(?=\})\}/g,function replace(match,start,end,snippet){let unroll="";for(let i=parseInt(start);i<parseInt(end);i++)unroll+=snippet.replace(/\[i\]/g,"["+i+"]");return unroll})}(code)}}),Module(function GLTypes(){function getFormat(texture){let _gl=Renderer.context,integer=texture.type===Texture.UNSIGNED_INTEGER||texture.type===Texture.INTEGER;switch(texture.format){case Texture.RGBAFormat:return integer?_gl.RGBA_INTEGER:_gl.RGBA;case Texture.RGBFormat:return integer?_gl.RGB_INTEGER:_gl.RGB;case Texture.RGFormat:return integer?_gl.RG_INTEGER:_gl.RG;case Texture.RFormat:return integer?_gl.RED_INTEGER:_gl.RED}}function getInternalFormat(texture){let _gl=Renderer.context;if(Renderer.type!==Renderer.WEBGL2)return texture.format===Texture.RGBAFormat?_gl.RGBA:_gl.RGB;switch(texture.format){case Texture.RGBAFormat:switch(texture.type){case Texture.FLOAT:return _gl.RGBA32F;case Texture.HALF_FLOAT:return _gl.RGBA16F;case Texture.UNSIGNED_INTEGER:return _gl.RGBA32UI;case Texture.INTEGER:return _gl.RGBA32I;case Texture.UNSIGNED_BYTE:return _gl.RGBA8}break;case Texture.RGBFormat:switch(texture.type){case Texture.FLOAT:return _gl.RGB32F;case Texture.HALF_FLOAT:return _gl.RGB16F;case Texture.UNSIGNED_INTEGER:return _gl.RGB32UI;case Texture.INTEGER:return _gl.RGB32I;case Texture.UNSIGNED_BYTE:return _gl.RGB8}break;case Texture.RGFormat:switch(texture.type){case Texture.FLOAT:return _gl.RG32F;case Texture.HALF_FLOAT:return _gl.RG16F;case Texture.UNSIGNED_INTEGER:return _gl.RG32UI;case Texture.INTEGER:return _gl.RG32I;case Texture.UNSIGNED_BYTE:return _gl.RG8}break;case Texture.RFormat:switch(texture.type){case Texture.FLOAT:return _gl.R32F;case Texture.HALF_FLOAT:return _gl.R16F;case Texture.UNSIGNED_INTEGER:return _gl.R32UI;case Texture.INTEGER:return _gl.R32I;case Texture.UNSIGNED_BYTE:return _gl.R8}}}function getType(texture){let _gl=Renderer.context;switch(texture.type){case Texture.FLOAT:return _gl.FLOAT;case Texture.HALF_FLOAT:return Renderer.type==Renderer.WEBGL2?_gl.HALF_FLOAT:Renderer.extensions.halfFloat.HALF_FLOAT_OES;case Texture.UNSIGNED_INTEGER:return _gl.UNSIGNED_INT;case Texture.INTEGER:return _gl.INT;default:return _gl.UNSIGNED_BYTE}}this.exports={getFormat:getFormat,getInternalFormat:getInternalFormat,getProperty:function getProperty(property){let _gl=Renderer.context;switch(property){case Texture.NEAREST:return _gl.NEAREST;case Texture.LINEAR:return _gl.LINEAR;case Texture.LINEAR_MIPMAP:return _gl.LINEAR_MIPMAP_LINEAR;case Texture.NEAREST_MIPMAP:return _gl.NEAREST_MIPMAP_LINEAR;case Texture.LINEAR_MIPMAP_NEAREST:return _gl.LINEAR_MIPMAP_NEAREST;case Texture.CLAMP_TO_EDGE:return _gl.CLAMP_TO_EDGE;case Texture.REPEAT:return _gl.REPEAT;case Texture.MIRROR_REPEAT:return _gl.MIRRORED_REPEAT}},getType:getType,getFloatParams:function getFloatParams(texture){return{internalformat:getInternalFormat(texture),format:getFormat(texture),type:getType(texture)}},getGLTypeForTypedArray:function getGLTypeForTypedArray(typedArray){let _gl=Renderer.context;return typedArray instanceof Float32Array?_gl.FLOAT:typedArray instanceof Int32Array?_gl.INT:typedArray instanceof Uint32Array?_gl.UNSIGNED_INT:typedArray instanceof Int16Array?_gl.SHORT:typedArray instanceof Uint16Array?_gl.UNSIGNED_SHORT:typedArray instanceof Int8Array?_gl.BYTE:typedArray instanceof Uint8Array||typedArray instanceof Uint8ClampedArray?_gl.UNSIGNED_BYTE:_gl.FLOAT}}}),Class(function MatrixWasm(){const _this=this;let registry,_oom=!1;window.FinalizationRegistry&&(registry=new FinalizationRegistry(heldValue=>{wasmExports.free_matrix(heldValue.ptr),_oom=!1}));let _memory,wasmExports,_matrices=new Set,_loggedOutOfMemory=!1;let promise=Promise.create();(async function loadWasm(){try{return await async function doLoadWasm(bytes){const module=await WebAssembly.compile(bytes);let initial=4;"firefox"===Device.system.browser&&(initial=64);function emscripten_resize_heap(newSize){const pageSize=65536,currentPages=_memory.buffer.byteLength/pageSize,requiredPages=Math.ceil(newSize/pageSize);if(!(requiredPages>currentPages))return!1;{const pagesToGrow=requiredPages-currentPages;try{return _memory.grow(pagesToGrow),_oom=!1,_matrices.forEach(weakRef=>{let ref=weakRef.deref();if(ref){const ptr=ref.elements.ptr,elements=new Float32Array(_memory.buffer,ptr,16);elements.ptr=ptr,ref.elements=elements,registry?.unregister(ref),registry?.register(ref,ref.elements,ref)}else _matrices.delete(weakRef)}),!0}catch(error){return _oom=!0,_loggedOutOfMemory||(_loggedOutOfMemory=!0,console.error("MatrixWasm failed to resize heap",error)),!1}}}_memory=new WebAssembly.Memory({initial:initial,maximum:64});const moduleImports={env:{memory:_memory,emscripten_resize_heap:emscripten_resize_heap}},instance=await WebAssembly.instantiate(module,moduleImports);return instance.exports.__wasm_call_ctors(),instance.exports}(function decodeBase64(base64){const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let i=0;i<64;i++)lookup[chars.charCodeAt(i)]=i;let i,encoded1,encoded2,encoded3,encoded4,bufferLength=.75*base64.length,len=base64.length,p=0;"="===base64[base64.length-1]&&(bufferLength--,"="===base64[base64.length-2]&&bufferLength--);const arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4)encoded1=lookup[base64.charCodeAt(i)],encoded2=lookup[base64.charCodeAt(i+1)],encoded3=lookup[base64.charCodeAt(i+2)],encoded4=lookup[base64.charCodeAt(i+3)],bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return arraybuffer}("AGFzbQEAAAABHAZgAX8Bf2AAAX9gAX8AYAAAYAN/f38AYAJ/fwACLwIDZW52FmVtc2NyaXB0ZW5fcmVzaXplX2hlYXAAAANlbnYGbWVtb3J5AgEEgIACAwoJAwECBAUAAQIABAUBcAEBAQYHAX8BQYAUCweaAQkRX193YXNtX2NhbGxfY3RvcnMAAQ9hbGxvY2F0ZV9tYXRyaXgAAgtmcmVlX21hdHJpeAADEW11bHRpcGx5X21hdHJpY2VzAAQKZ2V0SW52ZXJzZQAFGV9faW5kaXJlY3RfZnVuY3Rpb25fdGFibGUBAAlzdGFja1NhdmUABwxzdGFja1Jlc3RvcmUACApzdGFja0FsbG9jAAkKqzYJAgAL8B4BC38jAEEQayIKJAACQEGICCgCACIFQQl2IgBBA3EEQAJAIABBf3NBAXFBCWoiCEEDdCIBQbAIaiIAIAFBuAhqKAIAIgEoAggiAkYEQEGICCAFQX4gCHdxNgIADAELIAIgADYCDCAAIAI2AggLIAFBCGohACABIAhBA3QiCEEDcjYCBCABIAhqIgEgASgCBEEBcjYCBAwBCwJAAkACQAJAAkACQAJAQZAIKAIAIgZByABPDQAgAARAAkAgAEEJdEGAeHFoIgFBA3QiAEGwCGoiAiAAQbgIaigCACIAKAIIIgNGBEBBiAggBUF+IAF3cSIFNgIADAELIAMgAjYCDCACIAM2AggLIABBywA2AgQgAEHIAGoiAyABQQN0IgFByABrIghBAXI2AgQgACABaiAINgIAIAYEQCAGQXhxQbAIaiECQZwIKAIAIQECfyAFQQEgBkEDdnQiBHFFBEBBiAggBCAFcjYCACACDAELIAIoAggLIQQgAiABNgIIIAQgATYCDCABIAI2AgwgASAENgIICyAAQQhqIQBBnAggAzYCAEGQCCAINgIADAgLQYwIKAIAIglFDQAgCWhBAnRBuApqKAIAIgMoAgRBeHFByABrIQEgAyECA0ACQCACKAIQIgBFBEAgAigCFCIARQ0BCyAAKAIEQXhxQcgAayICIAEgASACSyICGyEBIAAgAyACGyEDIAAhAgwBCwsgAygCGCEHIAMgAygCDCIARwRAQZgIKAIAGiADKAIIIgIgADYCDCAAIAI2AggMBwsgAygCFCICBH8gA0EUagUgAygCECICRQ0CIANBEGoLIQQDQCAEIQggAiIAQRRqIQQgACgCFCICDQAgAEEQaiEEIAAoAhAiAg0ACyAIQQA2AgAMBgtBkAgoAgAiAEHIAE8EQEGcCCgCACEBAkAgAEHIAGsiAkEQTwRAIAFByABqIgMgAkEBcjYCBCAAIAFqIAI2AgAgAUHLADYCBAwBCyABIABBA3I2AgQgACABaiIAIAAoAgRBAXI2AgRBACECC0GQCCACNgIAQZwIIAM2AgAgAUEIaiEADAcLQZQIKAIAIgNByABLBEBBlAggA0HIAGsiATYCAEGgCEGgCCgCACIAQcgAaiICNgIAIAIgAUEBcjYCBCAAQcsANgIEIABBCGohAAwHC0EAIQACf0HgCygCAARAQegLKAIADAELQewLQn83AgBB5AtCgKCAgICABDcCAEHgCyAKQQxqQXBxQdiq1aoFczYCAEH0C0EANgIAQcQLQQA2AgBBgCALIgFB9wBqIgVBACABayIIcSIEQcgATQ0GQcALKAIAIgEEQEG4CygCACICIARqIgcgAk0NByABIAdJDQcLAkBBxAstAABBBHFFBEACQAJAAkACQEGgCCgCACIBBEBByAshAANAIAEgACgCACICTwRAIAIgACgCBGogAUsNAwsgACgCCCIADQALC0EAEAYiA0F/Rg0DIAQhBUHkCygCACIAQQFrIgEgA3EEQCAEIANrIAEgA2pBACAAa3FqIQULIAVByABNDQNBwAsoAgAiAARAQbgLKAIAIgEgBWoiAiABTQ0EIAAgAkkNBAsgBRAGIgAgA0cNAQwFCyAFIANrIAhxIgUQBiIDIAAoAgAgACgCBGpGDQEgAyEACyAAQX9GDQEgBUH4AE8EQCAAIQMMBAtB6AsoAgAiAUH3ACAFa2pBACABa3EiARAGQX9GDQEgASAFaiEFIAAhAwwDCyADQX9HDQILQcQLQcQLKAIAQQRyNgIACyAEEAYhA0EAEAYhACADQX9GDQQgAEF/Rg0EIAAgA00NBCAAIANrIgVB8ABNDQQLQbgLQbgLKAIAIAVqIgA2AgBBvAsoAgAgAEkEQEG8CyAANgIACwJAQaAIKAIAIgEEQEHICyEAA0AgAyAAKAIAIgIgACgCBCIEakYNAiAAKAIIIgANAAsMAwtBmAgoAgAiAEEAIAAgA00bRQRAQZgIIAM2AgALQQAhAEHMCyAFNgIAQcgLIAM2AgBBqAhBfzYCAEGsCEHgCygCADYCAEHUC0EANgIAA0AgAEEDdCIBQbgIaiABQbAIaiICNgIAIAFBvAhqIAI2AgAgAEEBaiIAQSBHDQALQZQIIAVBKGsiAEF4IANrQQdxIgFrIgI2AgBBoAggASADaiIBNgIAIAEgAkEBcjYCBCAAIANqQSg2AgRBpAhB8AsoAgA2AgAMAwsgASADTw0BIAEgAkkNASAAKAIMQQhxDQEgACAEIAVqNgIEQaAIIAFBeCABa0EHcSIAaiICNgIAQZQIQZQIKAIAIAVqIgMgAGsiADYCACACIABBAXI2AgQgASADakEoNgIEQaQIQfALKAIANgIADAILQQAhAAwEC0GYCCgCACADSwRAQZgIIAM2AgALIAMgBWohAkHICyEAAkADQCACIAAoAgBHBEAgACgCCCIADQEMAgsLIAAtAAxBCHFFDQMLQcgLIQADQAJAIAEgACgCACICTwRAIAIgACgCBGoiAiABSw0BCyAAKAIIIQAMAQsLQZQIIAVBKGsiAEF4IANrQQdxIgRrIgg2AgBBoAggAyAEaiIENgIAIAQgCEEBcjYCBCAAIANqQSg2AgRBpAhB8AsoAgA2AgAgASACQScgAmtBB3FqQS9rIgAgACABQRBqSRsiBEEbNgIEIARB0AspAgA3AhAgBEHICykCADcCCEHQCyAEQQhqNgIAQcwLIAU2AgBByAsgAzYCAEHUC0EANgIAIARBGGohAANAIABBBzYCBCAAQQhqIQMgAEEEaiEAIAIgA0sNAAsgASAERg0AIAQgBCgCBEF+cTYCBCABIAQgAWsiA0EBcjYCBCAEIAM2AgACfyADQf8BTQRAIANBeHFBsAhqIQACf0GICCgCACICQQEgA0EDdnQiA3FFBEBBiAggAiADcjYCACAADAELIAAoAggLIQIgACABNgIIIAIgATYCDEEMIQNBCAwBC0EfIQAgA0H///8HTQRAIANBJiADQQh2ZyIAa3ZBAXEgAEEBdGtBPmohAAsgASAANgIcIAFCADcCECAAQQJ0QbgKaiECAkACQEGMCCgCACIEQQEgAHQiBXFFBEBBjAggBCAFcjYCACACIAE2AgAgASACNgIYDAELIANBGSAAQQF2a0EAIABBH0cbdCEAIAIoAgAhBANAIAQiAigCBEF4cSADRg0CIABBHXYhBCAAQQF0IQAgAiAEQQRxakEQaiIFKAIAIgQNAAsgBSABNgIAIAEgAjYCGAtBCCEDIAEhAiABIQBBDAwBCyACKAIIIgAgATYCDCACIAE2AgggASAANgIIQQAhAEEYIQNBDAsgAWogAjYCACABIANqIAA2AgALQZQIKAIAIgBByABNDQBBlAggAEHIAGsiATYCAEGgCEGgCCgCACIAQcgAaiICNgIAIAIgAUEBcjYCBCAAQcsANgIEIABBCGohAAwDC0GECEEwNgIAQQAhAAwCCyAAIAM2AgAgACAAKAIEIAVqNgIEIANBeCADa0EHcWoiCEHLADYCBCACQXggAmtBB3FqIgcgCEHIAGoiBmshBAJAQaAIKAIAIAdGBEBBoAggBjYCAEGUCEGUCCgCACAEaiIBNgIAIAYgAUEBcjYCBAwBC0GcCCgCACAHRgRAQZwIIAY2AgBBkAhBkAgoAgAgBGoiATYCACAGIAFBAXI2AgQgASAGaiABNgIADAELIAcoAgQiAkEDcUEBRgRAIAJBeHEhBSAHKAIMIQECQCACQf8BTQRAIAJBA3YhAyAHKAIIIgAgAUYEQEGICEGICCgCAEF+IAN3cTYCAAwCCyAAIAE2AgwgASAANgIIDAELIAcoAhghCQJAIAEgB0cEQEGYCCgCABogBygCCCICIAE2AgwgASACNgIIDAELAkAgBygCFCICBH8gB0EUagUgBygCECICRQ0BIAdBEGoLIQADQCAAIQMgAiIBQRRqIQAgASgCFCICDQAgAUEQaiEAIAEoAhAiAg0ACyADQQA2AgAMAQtBACEBCyAJRQ0AAkAgBygCHCIAQQJ0QbgKaiICKAIAIAdGBEAgAiABNgIAIAENAUGMCEGMCCgCAEF+IAB3cTYCAAwCCyAJQRBBFCAJKAIQIAdGG2ogATYCACABRQ0BCyABIAk2AhggBygCECICBEAgASACNgIQIAIgATYCGAsgBygCFCICRQ0AIAEgAjYCFCACIAE2AhgLIAQgBWohBCAFIAdqIgcoAgQhAgsgByACQX5xNgIEIAYgBEEBcjYCBCAEIAZqIAQ2AgAgBEH/AU0EQCAEQXhxQbAIaiEBAn9BiAgoAgAiAkEBIARBA3Z0IgRxRQRAQYgIIAIgBHI2AgAgAQwBCyABKAIICyEEIAEgBjYCCCAEIAY2AgwgBiABNgIMIAYgBDYCCAwBC0EfIQEgBEH///8HTQRAIARBJiAEQQh2ZyIBa3ZBAXEgAUEBdGtBPmohAQsgBiABNgIcIAZCADcCECABQQJ0QbgKaiECAkACQEGMCCgCACIAQQEgAXQiB3FFBEBBjAggACAHcjYCACACIAY2AgAgBiACNgIYDAELIARBGSABQQF2a0EAIAFBH0cbdCEBIAIoAgAhAANAIAAiAigCBEF4cSAERg0CIAFBHXYhACABQQF0IQEgAiAAQQRxakEQaiIHKAIAIgANAAsgByAGNgIAIAYgAjYCGAsgBiAGNgIMIAYgBjYCCAwBCyACKAIIIgEgBjYCDCACIAY2AgggBkEANgIYIAYgAjYCDCAGIAE2AggLIAhBCGohAAwBCwJAIAdFDQACQCADKAIcIgRBAnRBuApqIgIoAgAgA0YEQCACIAA2AgAgAA0BQYwIIAlBfiAEd3E2AgAMAgsgB0EQQRQgBygCECADRhtqIAA2AgAgAEUNAQsgACAHNgIYIAMoAhAiAgRAIAAgAjYCECACIAA2AhgLIAMoAhQiAkUNACAAIAI2AhQgAiAANgIYCwJAIAFBD00EQCADIAFByABqIgBBA3I2AgQgACADaiIAIAAoAgRBAXI2AgQMAQsgA0HLADYCBCADQcgAaiIIIAFBAXI2AgQgASAIaiABNgIAIAYEQCAGQXhxQbAIaiECQZwIKAIAIQACf0EBIAZBA3Z0IgQgBXFFBEBBiAggBCAFcjYCACACDAELIAIoAggLIQQgAiAANgIIIAQgADYCDCAAIAI2AgwgACAENgIIC0GcCCAINgIAQZAIIAE2AgALIANBCGohAAsgCkEQaiQAIAAL5AsBB38CQCAAIgNFDQAgA0EIayICIANBBGsoAgAiAUF4cSIDaiEEAkAgAUEBcQ0AIAFBAnFFDQEgAiACKAIAIgBrIgJBmAgoAgBJDQEgACADaiEDAkACQEGcCCgCACACRwRAIAIoAgwhASAAQf8BTQRAIABBA3YhByACKAIIIgUgAUYEQEGICEGICCgCAEF+IAd3cTYCAAwFCyAFIAE2AgwgASAFNgIIDAQLIAIoAhghBiABIAJHBEAgAigCCCIAIAE2AgwgASAANgIIDAMLIAIoAhQiAAR/IAJBFGoFIAIoAhAiAEUNAiACQRBqCyEFA0AgBSEHIAAiAUEUaiEFIAEoAhQiAA0AIAFBEGohBSABKAIQIgANAAsgB0EANgIADAILIAQoAgQiAUEDcUEDRw0CQZAIIAM2AgAgBCABQX5xNgIEIAIgA0EBcjYCBCAEIAM2AgAMAwtBACEBCyAGRQ0AAkAgAigCHCIFQQJ0QbgKaiIAKAIAIAJGBEAgACABNgIAIAENAUGMCEGMCCgCAEF+IAV3cTYCAAwCCyAGQRBBFCAGKAIQIAJGG2ogATYCACABRQ0BCyABIAY2AhggAigCECIABEAgASAANgIQIAAgATYCGAsgAigCFCIARQ0AIAEgADYCFCAAIAE2AhgLIAIgBE8NACAEKAIEIgBBAXFFDQACQAJAAkACQCAAQQJxRQRAQaAIKAIAIARGBEBBoAggAjYCAEGUCEGUCCgCACADaiIDNgIAIAIgA0EBcjYCBCACQZwIKAIARw0GQZAIQQA2AgBBnAhBADYCAAwGC0GcCCgCACAERgRAQZwIIAI2AgBBkAhBkAgoAgAgA2oiAzYCACACIANBAXI2AgQgAiADaiADNgIADAYLIABBeHEgA2ohAyAEKAIMIQEgAEH/AU0EQCAEKAIIIQUgAEEDdiEEIAEgBUYEQEGICEGICCgCAEF+IAR3cTYCAAwFCyAFIAE2AgwgASAFNgIIDAQLIAQoAhghBiABIARHBEBBmAgoAgAaIAQoAggiACABNgIMIAEgADYCCAwDCyAEKAIUIgAEfyAEQRRqBSAEKAIQIgBFDQIgBEEQagshBQNAIAUhByAAIgFBFGohBSABKAIUIgANACABQRBqIQUgASgCECIADQALIAdBADYCAAwCCyAEIABBfnE2AgQgAiADQQFyNgIEIAIgA2ogAzYCAAwDC0EAIQELIAZFDQACQCAEKAIcIgVBAnRBuApqIgAoAgAgBEYEQCAAIAE2AgAgAQ0BQYwIQYwIKAIAQX4gBXdxNgIADAILIAZBEEEUIAYoAhAgBEYbaiABNgIAIAFFDQELIAEgBjYCGCAEKAIQIgAEQCABIAA2AhAgACABNgIYCyAEKAIUIgBFDQAgASAANgIUIAAgATYCGAsgAiADQQFyNgIEIAIgA2ogAzYCACACQZwIKAIARw0AQZAIIAM2AgAMAQsgA0H/AU0EQCADQXhxQbAIaiEBAn9BiAgoAgAiAEEBIANBA3Z0IgNxRQRAQYgIIAAgA3I2AgAgAQwBCyABKAIICyEDIAEgAjYCCCADIAI2AgwgAiABNgIMIAIgAzYCCAwBC0EfIQEgA0H///8HTQRAIANBJiADQQh2ZyIBa3ZBAXEgAUEBdGtBPmohAQsgAiABNgIcIAJCADcCECABQQJ0QbgKaiEEAn8CQAJ/QYwIKAIAIgBBASABdCIFcUUEQEGMCCAAIAVyNgIAQRghASAEIQVBCAwBCyADQRkgAUEBdmtBACABQR9HG3QhASAEKAIAIQUDQCAFIgAoAgRBeHEgA0YNAiABQR12IQUgAUEBdCEBIAAgBUEEcWpBEGoiBCgCACIFDQALQRghASAAIQVBCAshAyACIQAgAgwBCyAAKAIIIgUgAjYCDEEIIQEgAEEIaiEEQRghA0EACyEHIAQgAjYCACABIAJqIAU2AgAgAiAANgIMIAIgA2ogBzYCAEGoCEGoCCgCAEEBayICQX8gAhs2AgALC4gCAQR7IAIgAf0JAgwgAP0AAjAiA/3mASAB/QkCCCAA/QACICIE/eYBIAH9CQIAIAD9AAIAIgX95gEgAP0AAhAiBiAB/QkCBP3mAf3kAf3kAf3kAf0LAgAgAiADIAH9CQIc/eYBIAQgAf0JAhj95gEgBSAB/QkCEP3mASAGIAH9CQIU/eYB/eQB/eQB/eQB/QsCECACIAMgAf0JAiz95gEgBCAB/QkCKP3mASAFIAH9CQIg/eYBIAYgAf0JAiT95gH95AH95AH95AH9CwIgIAIgAyAB/QkCPP3mASAEIAH9CQI4/eYBIAUgAf0JAjD95gEgBiAB/QkCNP3mAf3kAf3kAf3kAf0LAjAL1ggCKX0BeyABKgIMIgIgASoCFCINIAEqAiAiC5QiESABKgI4IgiUIAEqAhAiDCABKgI0IhKUIhMgASoCKCIJlCABKgIkIhQgASoCMCIOlCIZIAEqAhgiB5QgByALIBKUIhqUkyANIA6UIhsgCZSTkpIgDCAUlCIcIAiUkyIVlCABKgIIIgogHCABKgI8IgOUIBsgASoCLCIElCAaIAEqAhwiBZQgBSAZlJOSIBMgBJSTIBEgA5STkiIWlCABKgIAIg8gDSAJlCIfIAOUIAcgEpQiICAElCAUIAiUIiEgBZQgBSAJIBKUIiKUk5IgDSAIlCIjIASUkyAHIBSUIiQgA5STkiIXlCABKgIEIhAgByALlCIlIAOUIAwgCJQiJiAElCAJIA6UIicgBZQgBSALIAiUIiiUkyAHIA6UIikgBJSTkpIgDCAJlCIqIAOUkyIYlJKSkiIGQwAAAABbBEAgAEGAgID8AzYCKCAAQYCAgPwDNgI8IAD9DAAAAAAAAAAAAAAAAAAAgD/9CwIIIABBgICA/AM2AgAgAP0MAAAAAAAAAAAAAAAAAAAAAP0LAhggACAr/QsCLCAAQwAAAAA4AgQPCyAAIBVDAACAPyAGlSIGlDgCMCAAIBYgBpQ4AiAgACAYIAaUOAIQIAAgFyAGlDgCACAAIA8gDZQiFSAJlCAQIAuUIhYgB5QgHCAKlCAKIBGMlJKSIA8gFJQiFyAHlJMgECAMlCIYIAmUk5IgBpQ4AjwgACAYIAiUIA8gEpQiHSAHlCAbIAqUIAogE4yUkiAQIA6UIh4gB5STkpIgFSAIlJMgBpQ4AjggACAXIAiUIB4gCZQgGiAKlCAKIBmMlJKSIB0gCZSTIBYgCJSTkiAGlDgCNCAAIBggBJQgFyAFlCARIAKUIAIgHIyUkiAWIAWUk5KSIBUgBJSTIAaUOAIsIAAgFSADlCAeIAWUIBMgApQgAiAbjJSSkiAdIAWUkyAYIAOUk5IgBpQ4AiggACAWIAOUIB0gBJQgGSAClCACIBqMlJIgHiAElJOSkiAXIAOUkyAGlDgCJCAAIA8gB5QiESAElCAKIAuUIgsgBZQgKiAClCACICWUk5IgDyAJlCITIAWUkyAKIAyUIgwgBJSTkiAGlDgCHCAAIAwgA5QgDyAIlCIMIAWUICkgApQgAiAmlJMgCiAOlCIOIAWUk5KSIBEgA5STIAaUOAIYIAAgEyADlCAOIASUICggApQgAiAnlJOSIAwgBJSTIAsgA5STkiAGlDgCFCAAIAogDZQiDSAElCAQIAmUIgkgBZQgJCAClCACIB+UkyAKIBSUIgsgBZSTkpIgECAHlCIHIASUkyAGlDgCDCAAIAcgA5QgCiASlCIHIAWUICMgApQgAiAglJOSIBAgCJQiCCAFlJMgDSADlJOSIAaUOAIIIAAgCyADlCAIIASUICIgApQgAiAhlJMgByAElJOSkiAJIAOUkyAGlDgCBAtPAQJ/QYAIKAIAIgEgAEEHakF4cSICaiEAAkAgAkEAIAAgAU0bRQRAIAA/AEEQdE0NASAAEAANAQtBhAhBMDYCAEF/DwtBgAggADYCACABCwQAIwALBgAgACQACxAAIwAgAGtBcHEiACQAIAALCwgBAEGBCAsBCg=="))}catch(e){Hydra.LOCAL&&console.debug("Error loading matrix.wasm, falling back to javascript implementation",e)}})().then(exports=>{promise.resolve(),exports&&(wasmExports=exports,_this.multiply=function(a,b,c){return _this.allocate(a),_this.allocate(b),_this.allocate(c),"number"==typeof a.elements.ptr&&"number"==typeof b.elements.ptr&&"number"==typeof c.elements.ptr&&(wasmExports.multiply_matrices(a.elements.ptr,b.elements.ptr,c.elements.ptr),!0)},_this.getInverse=function(out,m){return _this.allocate(out),_this.allocate(m),"number"==typeof out.elements.ptr&&"number"==typeof m.elements.ptr&&(wasmExports.getInverse(out.elements.ptr,m.elements.ptr),!0)})});const _identity=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);_this.allocate=function(ref){if("number"==typeof ref.elements?.ptr)return!0;if(_oom)return!1;if(!wasmExports)return!1;try{const ptr=wasmExports.allocate_matrix();if(0===ptr)return _oom=!0,!1;const elements=new Float32Array(_memory.buffer,ptr,16);return elements.set(ref.elements||_identity,0),elements.ptr=ptr,ref.elements=elements,registry?.register(ref,ref.elements,ref),_matrices.add(new WeakRef(ref)),!0}catch(e){return _oom=!0,_loggedOutOfMemory||(_loggedOutOfMemory=!0,console.error("MatrixWasm allocate error",e)),!1}},_this.ready=function(){return promise}},"static"),Module(function ShaderCode(){let textureExpression=/texture(2D|Cube)?(\w+)?\s*\(/g;function removeUBO(code,name){let uniforms=code.split(`uniform ${name} {`)[1];uniforms=uniforms.split("};")[0],uniforms=uniforms.split("\n"),uniforms.forEach(u=>{(u=u.trim()).length&&(code=code.replace(u,"uniform "+u))});let split=code.split(`uniform ${name} {`);return split[1]=split[1].replace("};",""),code=(code=split.join("")).replace(`uniform ${name} {`,"")}this.exports={convertWebGL1:function convertWebGL1(code,type){return(code=(code=code.replace("#version 300 es","")).replace("out vec4 FragColor;","")).includes("samplerExternalOES")&&(code=code.replace("samplerExternalOES","sampler2D")),(code=code.replace(textureExpression,function(match,samplerType,suffix="",offset,origCode){if(!samplerType){let name=origCode.substring(offset+match.length).split(",",1)[0]?.trim();name&&(samplerType=new RegExp(`sampler(\\w+)\\s+${name}`).exec(origCode)?.[1]),samplerType||(samplerType="2D")}if(suffix.endsWith("EXT")&&(suffix=suffix.slice(0,-3)),"vs"===type&&["Lod","ProjLod"].includes(suffix))return`texture${samplerType}${suffix}(`;if(["Lod","Grad","ProjLod","ProjGrad"].includes(suffix)){if(Renderer.extensions.lod)return`texture${samplerType}${suffix}EXT(`;suffix.endsWith("Lod")&&(suffix=suffix.slice(0,-3))}return`texture${samplerType}${suffix}(`})).includes("uniform global {")&&(code=removeUBO(code,"global")),code.includes("uniform ubo {")&&(code=removeUBO(code,"ubo")),code.includes("uniform lights {")&&(code=removeUBO(code,"lights")),code},convertWebGL2:function convertWebGL2(code,type){return!(code=(code="vs"==type?(code=code.replace(/attribute/g,"in")).replace(/varying/g,"out"):code.replace(/varying/g,"in")).replace(textureExpression,function(match,samplerType,suffix=""){return suffix.endsWith("EXT")&&(suffix=suffix.slice(0,-3)),`texture${suffix}(`})).includes("samplerExternalOES")||"android"==Device.system.os&&window.AURA||(code=code.replace("samplerExternalOES","sampler2D")),Renderer.UBO?(code.includes("uniform global {")&&(code=code.replace("uniform global","layout(std140) uniform global")),code.includes("uniform ubo {")&&(code=code.replace("uniform ubo","layout(std140) uniform ubo")),Lighting.UBO?code.includes("uniform lights {")&&(code=code.replace("uniform lights","layout(std140) uniform lights")):code.includes("uniform lights {")&&(code=removeUBO(code,"lights"))):(code.includes("uniform global {")&&(code=removeUBO(code,"global")),code.includes("uniform ubo {")&&(code=removeUBO(code,"ubo")),code.includes("uniform lights {")&&(code=removeUBO(code,"lights"))),code}}});class UBO{constructor(location,gl=Renderer.context){this.gl=gl,this.arrays=[];for(let i=0;i<30;i++)this.arrays.push([]);this.arrayIndex=0,this.objects=[],this.location=location,this.data=null,this.lastUpdate=0}_getSize(uniform){let obj=uniform.value;return Array.isArray(obj)?uniform.components?obj.length/uniform.components*16:16*obj.length:obj instanceof Vector2?8:obj instanceof Vector3||obj instanceof Vector4||obj instanceof Color?16:obj instanceof Matrix4?64:obj instanceof Matrix3?48:obj instanceof Quaternion?16:4}_getValues(uniform){let obj=uniform.value;return Array.isArray(obj)?obj:obj instanceof Vector2?this._array(obj.x,obj.y):obj instanceof Vector3?this._array(obj.x,obj.y,obj.z):obj instanceof Matrix4||obj instanceof Matrix3?obj.elements:obj instanceof Color?this._array(obj.r,obj.g,obj.b):obj instanceof Quaternion?this._array(obj.x,obj.y,obj.z,obj.w):this._array(obj)}_array(){this.arrayIndex++>=this.arrays.length-1&&(this.arrayIndex=0);let array=this.arrays[this.arrayIndex];return array.length=0,array.push.apply(array,arguments),array}clear(){for(let i=0;i<this.arrays.length;i++)this.arrays[i].length=0}calculate(){let len=this.objects.length,chunk=16,tsize=0,offset=0,size=0;for(let i=0;i<len;i++){let obj=this.objects[i];size=this._getSize(obj),tsize=chunk-size,tsize<0&&chunk<16?(offset+=chunk,i>0&&(this.objects[i-1].chunkLen+=chunk),chunk=16):tsize<0&&16==chunk||(0==tsize?chunk=16:chunk-=size),obj.offset=offset/4,obj.chunkLen=size/4,obj.dataLen=size/4,offset+=size}return offset%16!=0&&(this.objects[this.objects.length-1].chunkLen+=chunk/4,offset+=chunk),offset/4}compileData(){let i,array=this._array(),len=this.calculate();for(i=0;i<len;i++)array[i]=0;for(i=0;i<this.objects.length;i++){let obj=this.objects[i],values=this._getValues(obj);for(let j=0;j<values.length;j++)array[obj.offset+j]=values[j]}return array}upload(){if(this.data)return;let gl=Renderer.context,array=this.compileData();array.length&&(this.data=new Float32Array(array),this.buffer=gl.createBuffer(),gl.bindBuffer(gl.UNIFORM_BUFFER,this.buffer),gl.bufferData(gl.UNIFORM_BUFFER,this.data,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.UNIFORM_BUFFER,null),gl.bindBufferBase(gl.UNIFORM_BUFFER,this.location,this.buffer))}bind(program,name){this.data||this.upload(),this.needsUpdate&&this.update();let location,gl=Renderer.context;location=program==this.lastProgram&&name==this.lastName&&void 0!==this.lastLocation?this.lastLocation:gl.getUniformBlockIndex(program,name),location>99999||-1==location||(gl.uniformBlockBinding(program,location,this.location),gl.bindBufferBase(gl.UNIFORM_BUFFER,this.location,this.buffer),this.lastProgram=program,this.lastName=name,this.lastLocation=location)}update(){if(this.data||this.upload(),!this.data)return;let gl=Renderer.context,array=this.compileData();array.length!=this.data.length&&(this.data=new Float32Array(array),this.upload()),this.data.set(array),gl.bindBuffer(gl.UNIFORM_BUFFER,this.buffer),gl.bufferSubData(gl.UNIFORM_BUFFER,0,this.data),gl.bindBuffer(gl.UNIFORM_BUFFER,null),this.needsUpdate=!1}unbind(){}push(){if(this.data)throw"Can't modify UBO after initial upload!";for(let i=0;i<arguments.length;i++)this.objects.push(arguments[i])}destroy(){this.gl.deleteBuffer(this.buffer)}}class VAO{constructor(gl){this.gl=gl,this.WEBGL2=Renderer.type==Renderer.WEBGL2,this.WEBGL2?this.vao=gl.createVertexArray():this.vao=Renderer.extensions.VAO.createVertexArrayOES()}bind(){const gl=this.gl;this.WEBGL2?gl.bindVertexArray(this.vao):Renderer.extensions.VAO.bindVertexArrayOES(this.vao)}unbind(){const gl=this.gl;this.WEBGL2?gl.bindVertexArray(null):Renderer.extensions.VAO.bindVertexArrayOES(null)}destroy(){const gl=this.gl;this.WEBGL2?gl.deleteVertexArray(this.vao):Renderer.extensions.VAO.deleteVertexArrayOES(this.vao),this.vao=null}}class BoxGeometry extends Geometry{constructor(width=1,height=1,depth=1,widthSegments=1,heightSegments=1,depthSegments=1){super(),widthSegments=Math.floor(widthSegments),heightSegments=Math.floor(heightSegments),depthSegments=Math.floor(depthSegments);let indices=[],vertices=[],normals=[],uvs=[],numberOfVertices=0;function buildPlane(u,v,w,udir,vdir,width,height,depth,gridX,gridY,materialIndex){let ix,iy,segmentWidth=width/gridX,segmentHeight=height/gridY,widthHalf=width/2,heightHalf=height/2,depthHalf=depth/2,gridX1=gridX+1,gridY1=gridY+1,vertexCounter=0,vector=new Vector3;for(iy=0;iy<gridY1;iy++){let y=iy*segmentHeight-heightHalf;for(ix=0;ix<gridX1;ix++){let x=ix*segmentWidth-widthHalf;vector[u]=x*udir,vector[v]=y*vdir,vector[w]=depthHalf,vertices.push(vector.x,vector.y,vector.z),vector[u]=0,vector[v]=0,vector[w]=depth>0?1:-1,normals.push(vector.x,vector.y,vector.z),uvs.push(ix/gridX),uvs.push(1-iy/gridY),vertexCounter+=1}}for(iy=0;iy<gridY;iy++)for(ix=0;ix<gridX;ix++){let a=numberOfVertices+ix+gridX1*iy,b=numberOfVertices+ix+gridX1*(iy+1),c=numberOfVertices+(ix+1)+gridX1*(iy+1),d=numberOfVertices+(ix+1)+gridX1*iy;indices.push(a,b,d),indices.push(b,c,d)}numberOfVertices+=vertexCounter}buildPlane("z","y","x",-1,-1,depth,height,width,depthSegments,heightSegments,0),buildPlane("z","y","x",1,-1,depth,height,-width,depthSegments,heightSegments,1),buildPlane("x","z","y",1,1,width,depth,height,widthSegments,depthSegments,2),buildPlane("x","z","y",1,-1,width,depth,-height,widthSegments,depthSegments,3),buildPlane("x","y","z",1,-1,width,height,depth,widthSegments,heightSegments,4),buildPlane("x","y","z",-1,-1,width,height,-depth,widthSegments,heightSegments,5),this.setIndex(new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices)),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertices),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(normals),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvs),2))}}class CircleGeometry extends Geometry{constructor(radius=1,segments=8,thetaStart=0,thetaLength=2*Math.PI){super();var i,s,indices=[],vertices=[],normals=[],uvs=[],vertex=new Vector3,uv=new Vector2;for(vertices.push(0,0,0),normals.push(0,0,1),uvs.push(.5,.5),s=0,i=3;s<=segments;s++,i+=3){var segment=thetaStart+s/segments*thetaLength;vertex.x=radius*Math.cos(segment),vertex.y=radius*Math.sin(segment),vertices.push(vertex.x,vertex.y,vertex.z),normals.push(0,0,1),uv.x=(vertices[i]/radius+1)/2,uv.y=(vertices[i+1]/radius+1)/2,uvs.push(uv.x,uv.y)}for(i=1;i<=segments;i++)indices.push(i,i+1,0);this.setIndex(new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices)),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertices),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(normals),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvs),2))}}class CylinderGeometry extends Geometry{constructor(radiusTop=1,radiusBottom=1,height=1,radialSegments=8,heightSegments=1,openEnded=!1,thetaStart=0,thetaLength=2*Math.PI,planarMapping=!1){super(),radialSegments=Math.floor(radialSegments),heightSegments=Math.floor(heightSegments);let indices=[],vertices=[],normals=[],uvs=[],index=0,indexArray=[],halfHeight=height/2;function generateCap(top){let x,centerIndexStart,centerIndexEnd,uv=new Vector2,vertex=new Vector3,radius=!0===top?radiusTop:radiusBottom,sign=!0===top?1:-1,signV=planarMapping?1:sign;for(centerIndexStart=index,x=1;x<=radialSegments;x++)vertices.push(0,halfHeight*sign,0),normals.push(0,sign,0),uvs.push(.5,.5),index++;for(centerIndexEnd=index,x=0;x<=radialSegments;x++){let theta=x/radialSegments*thetaLength+thetaStart,cosTheta=Math.cos(theta),sinTheta=Math.sin(theta);vertex.x=radius*sinTheta,vertex.y=halfHeight*sign,vertex.z=radius*cosTheta,vertices.push(vertex.x,vertex.y,vertex.z),normals.push(0,sign,0),uv.x=.5*cosTheta+.5,uv.y=.5*sinTheta*signV+.5,uvs.push(uv.x,uv.y),index++}for(x=0;x<radialSegments;x++){let c=centerIndexStart+x,i=centerIndexEnd+x;!0===top?indices.push(i,i+1,c):indices.push(i+1,i,c)}}!function generateTorso(){let x,y,uv=new Vector2,normal=new Vector3,vertex=new Vector3,slope=(radiusBottom-radiusTop)/height;for(y=0;y<=heightSegments;y++){let indexRow=[],v=y/heightSegments,radius=v*(radiusBottom-radiusTop)+radiusTop;for(x=0;x<=radialSegments;x++){let u=x/radialSegments,theta=u*thetaLength+thetaStart,sinTheta=Math.sin(theta),cosTheta=Math.cos(theta);vertex.x=radius*sinTheta,vertex.y=-v*height+halfHeight,vertex.z=radius*cosTheta,vertices.push(vertex.x,vertex.y,vertex.z),normal.set(sinTheta,slope,cosTheta).normalize(),normals.push(normal.x,normal.y,normal.z),planarMapping?(uv.x=.5*cosTheta+.5,uv.y=.5*sinTheta+.5,uvs.push(uv.x,uv.y)):uvs.push(u,1-v),indexRow.push(index++)}indexArray.push(indexRow)}for(x=0;x<radialSegments;x++)for(y=0;y<heightSegments;y++){let a=indexArray[y][x],b=indexArray[y+1][x],c=indexArray[y+1][x+1],d=indexArray[y][x+1];indices.push(a,b,d),indices.push(b,c,d)}}(),!1===openEnded&&(radiusTop>0&&generateCap(!0),radiusBottom>0&&generateCap(!1)),this.setIndex(new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices)),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertices),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(normals),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvs),2))}}class ConeGeometry extends CylinderGeometry{constructor(radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){super(0,radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength)}}class PlaneGeometry extends Geometry{constructor(width=1,height=1,widthSegments=1,heightSegments=1){super();let ix,iy,width_half=width/2,height_half=height/2,gridX=Math.floor(widthSegments)||1,gridY=Math.floor(heightSegments)||1,gridX1=gridX+1,gridY1=gridY+1,segment_width=width/gridX,segment_height=height/gridY,indices=[],vertices=[],normals=[],uvs=[];for(iy=0;iy<gridY1;iy++){let y=iy*segment_height-height_half;for(ix=0;ix<gridX1;ix++){let x=ix*segment_width-width_half;vertices.push(x,-y,0),normals.push(0,0,1),uvs.push(ix/gridX),uvs.push(1-iy/gridY)}}for(iy=0;iy<gridY;iy++)for(ix=0;ix<gridX;ix++){let a=ix+gridX1*iy,b=ix+gridX1*(iy+1),c=ix+1+gridX1*(iy+1),d=ix+1+gridX1*iy;indices.push(a,b,d),indices.push(b,c,d)}this.setIndex(new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices)),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertices),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(normals),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvs),2))}}class PolyhedronGeometry extends Geometry{constructor(vertices,indices=[],radius=1,detail=0){super();let vertexBuffer=[],uvBuffer=[];function subdivideFace(a,b,c,detail){var i,j,cols=Math.pow(2,detail),v=[];for(i=0;i<=cols;i++){v[i]=[];var aj=a.clone().lerp(c,i/cols),bj=b.clone().lerp(c,i/cols),rows=cols-i;for(j=0;j<=rows;j++)v[i][j]=0===j&&i===cols?aj:aj.clone().lerp(bj,j/rows)}for(i=0;i<cols;i++)for(j=0;j<2*(cols-i)-1;j++){var k=Math.floor(j/2);j%2==0?(pushVertex(v[i][k+1]),pushVertex(v[i+1][k]),pushVertex(v[i][k])):(pushVertex(v[i][k+1]),pushVertex(v[i+1][k+1]),pushVertex(v[i+1][k]))}}function pushVertex(vertex){vertexBuffer.push(vertex.x,vertex.y,vertex.z)}function getVertexByIndex(index,vertex){let stride=3*index;vertex.x=vertices[stride+0],vertex.y=vertices[stride+1],vertex.z=vertices[stride+2]}function correctUV(uv,stride,vector,azimuth){azimuth<0&&1===uv.x&&(uvBuffer[stride]=uv.x-1),0===vector.x&&0===vector.z&&(uvBuffer[stride]=azimuth/2/Math.PI+.5)}function azimuth(vector){return Math.atan2(vector.z,-vector.x)}function inclination(vector){return Math.atan2(-vector.y,Math.sqrt(vector.x*vector.x+vector.z*vector.z))}!function subdivide(detail){let a=new Vector3,b=new Vector3,c=new Vector3;for(let i=0;i<indices.length;i+=3)getVertexByIndex(indices[i+0],a),getVertexByIndex(indices[i+1],b),getVertexByIndex(indices[i+2],c),subdivideFace(a,b,c,detail)}(detail),function appplyRadius(radius){for(var vertex=new Vector3,i=0;i<vertexBuffer.length;i+=3)vertex.x=vertexBuffer[i+0],vertex.y=vertexBuffer[i+1],vertex.z=vertexBuffer[i+2],vertex.normalize().multiplyScalar(radius),vertexBuffer[i+0]=vertex.x,vertexBuffer[i+1]=vertex.y,vertexBuffer[i+2]=vertex.z}(radius),function generateUVs(){let vertex=new Vector3;for(let i=0;i<vertexBuffer.length;i+=3){vertex.x=vertexBuffer[i+0],vertex.y=vertexBuffer[i+1],vertex.z=vertexBuffer[i+2];let u=azimuth(vertex)/2/Math.PI+.5,v=inclination(vertex)/Math.PI+.5;uvBuffer.push(u,1-v)}(function correctUVs(){let a=new Vector3,b=new Vector3,c=new Vector3,centroid=new Vector3,uvA=new Vector2,uvB=new Vector2,uvC=new Vector2;for(let i=0,j=0;i<vertexBuffer.length;i+=9,j+=6){a.set(vertexBuffer[i+0],vertexBuffer[i+1],vertexBuffer[i+2]),b.set(vertexBuffer[i+3],vertexBuffer[i+4],vertexBuffer[i+5]),c.set(vertexBuffer[i+6],vertexBuffer[i+7],vertexBuffer[i+8]),uvA.set(uvBuffer[j+0],uvBuffer[j+1]),uvB.set(uvBuffer[j+2],uvBuffer[j+3]),uvC.set(uvBuffer[j+4],uvBuffer[j+5]),centroid.copy(a).add(b).add(c).divideScalar(3);let azi=azimuth(centroid);correctUV(uvA,j+0,a,azi),correctUV(uvB,j+2,b,azi),correctUV(uvC,j+4,c,azi)}})(),function correctSeam(){for(let i=0;i<uvBuffer.length;i+=6){let x0=uvBuffer[i+0],x1=uvBuffer[i+2],x2=uvBuffer[i+4],max=Math.max(x0,x1,x2),min=Math.min(x0,x1,x2);max>.9&&min<.1&&(x0<.2&&(uvBuffer[i+0]+=1),x1<.2&&(uvBuffer[i+2]+=1),x2<.2&&(uvBuffer[i+4]+=1))}}()}(),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertexBuffer),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(vertexBuffer.slice()),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvBuffer),2)),0===detail?this.computeVertexNormals():this.normalizeNormals()}}class IcosahedronGeometry extends PolyhedronGeometry{constructor(radius,detail){let t=(1+Math.sqrt(5))/2;super([-1,t,0,1,t,0,-1,-t,0,1,-t,0,0,-1,t,0,1,t,0,-1,-t,0,1,-t,t,0,-1,t,0,1,-t,0,-1,-t,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],radius,detail)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(radius=1,detail=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],radius,detail),this.type="OctahedronGeometry",this.parameters={radius:radius,detail:detail}}}OctahedronGeometry.fromJSON=function(data){return new OctahedronGeometry(data.radius,data.detail)};class RingGeometry extends Geometry{constructor(innerRadius=.5,outerRadius=1,thetaSegments=8,phiSegments=1,thetaStart=0,thetaLength=2*Math.PI){super();var segment,j,i,indices=[],vertices=[],normals=[],uvs=[],radius=innerRadius,radiusStep=(outerRadius-innerRadius)/phiSegments,vertex=new Vector3,uv=new Vector2;for(j=0;j<=phiSegments;j++){for(i=0;i<=thetaSegments;i++)segment=thetaStart+i/thetaSegments*thetaLength,vertex.x=radius*Math.cos(segment),vertex.y=radius*Math.sin(segment),vertices.push(vertex.x,vertex.y,vertex.z),normals.push(0,0,1),uv.x=(vertex.x/outerRadius+1)/2,uv.y=(vertex.y/outerRadius+1)/2,uvs.push(uv.x,uv.y);radius+=radiusStep}for(j=0;j<phiSegments;j++){var thetaSegmentLevel=j*(thetaSegments+1);for(i=0;i<thetaSegments;i++){var a=segment=i+thetaSegmentLevel,b=segment+thetaSegments+1,c=segment+thetaSegments+2,d=segment+1;indices.push(a,b,d),indices.push(b,c,d)}}this.setIndex(new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices)),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertices),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(normals),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvs),2))}}class SphereGeometry extends Geometry{constructor(radius=1,widthSegments=8,heightSegments=6,phiStart=0,phiLength=2*Math.PI,thetaStart=0,thetaLength=Math.PI){super(),widthSegments=Math.max(3,Math.floor(widthSegments)),heightSegments=Math.max(2,Math.floor(heightSegments));let ix,iy,thetaEnd=thetaStart+thetaLength,index=0,grid=[],vertex=new Vector3,normal=new Vector3,indices=[],vertices=[],normals=[],uvs=[];for(iy=0;iy<=heightSegments;iy++){let verticesRow=[],v=iy/heightSegments;for(ix=0;ix<=widthSegments;ix++){let u=ix/widthSegments;vertex.x=-radius*Math.cos(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength),vertex.y=radius*Math.cos(thetaStart+v*thetaLength),vertex.z=radius*Math.sin(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength),vertices.push(vertex.x,vertex.y,vertex.z),normal.set(vertex.x,vertex.y,vertex.z).normalize(),normals.push(normal.x,normal.y,normal.z),uvs.push(u,1-v),verticesRow.push(index++)}grid.push(verticesRow)}for(iy=0;iy<heightSegments;iy++)for(ix=0;ix<widthSegments;ix++){let a=grid[iy][ix+1],b=grid[iy][ix],c=grid[iy+1][ix],d=grid[iy+1][ix+1];(0!==iy||thetaStart>0)&&indices.push(a,b,d),(iy!==heightSegments-1||thetaEnd<Math.PI)&&indices.push(b,c,d)}this.setIndex(new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices)),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertices),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(normals),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvs),2))}}class TorusKnotGeometry extends Geometry{constructor(radius=1,tube=.4,tubularSegments=64,radialSegments=8,p=2,q=3){super();let i,j,indices=[],vertices=[],normals=[],uvs=[],vertex=new Vector3,normal=new Vector3,P1=new Vector3,P2=new Vector3,B=new Vector3,T=new Vector3,N=new Vector3;for(i=0;i<=tubularSegments;++i){let u=i/tubularSegments*p*Math.PI*2;for(calculatePositionOnCurve(u,p,q,radius,P1),calculatePositionOnCurve(u+.01,p,q,radius,P2),T.subVectors(P2,P1),N.addVectors(P2,P1),B.crossVectors(T,N),N.crossVectors(B,T),B.normalize(),N.normalize(),j=0;j<=radialSegments;++j){let v=j/radialSegments*Math.PI*2,cx=-tube*Math.cos(v),cy=tube*Math.sin(v);vertex.x=P1.x+(cx*N.x+cy*B.x),vertex.y=P1.y+(cx*N.y+cy*B.y),vertex.z=P1.z+(cx*N.z+cy*B.z),vertices.push(vertex.x,vertex.y,vertex.z),normal.subVectors(vertex,P1).normalize(),normals.push(normal.x,normal.y,normal.z),uvs.push(i/tubularSegments),uvs.push(j/radialSegments)}}for(j=1;j<=tubularSegments;j++)for(i=1;i<=radialSegments;i++){let a=(radialSegments+1)*(j-1)+(i-1),b=(radialSegments+1)*j+(i-1),c=(radialSegments+1)*j+i,d=(radialSegments+1)*(j-1)+i;indices.push(a,b,d),indices.push(b,c,d)}function calculatePositionOnCurve(u,p,q,radius,position){let cu=Math.cos(u),su=Math.sin(u),quOverP=q/p*u,cs=Math.cos(quOverP);position.x=radius*(2+cs)*.5*cu,position.y=radius*(2+cs)*su*.5,position.z=radius*Math.sin(quOverP)*.5}this.setIndex(new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices)),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertices),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(normals),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvs),2))}}Class(function Interaction3D(_camera,_mouse,_stage){Inherit(this,Component);const _this=this;let _hover,_click;var _lastOnUpdate,_maximumVRHitDistance,_v3=new Vector3,_plane=new Plane,_input={},_cacheHits=[],_enabled=!0;_this.ID=Utils.timestamp(),_mouse=_mouse||Mouse,_camera=_camera||World.CAMERA,_stage=_stage||Stage;var _ray=_this.initClass(Raycaster,_camera),_meshes=[],_test=[],_event={};const PROHIBITED_ELEMENTS=["hit","prevent_interaction3d"];function checkIfProhibited(element){let el=element;for(;el;){if(el.classList)for(let i=0;i<PROHIBITED_ELEMENTS.length;i++)if(el.classList.contains(PROHIBITED_ELEMENTS[i]))return!0;el=el.parentNode}return!1}function parseMeshes(meshes){Array.isArray(meshes)||(meshes=[meshes]);let output=[];return meshes.forEach(function checkMesh(obj){if(obj.isOcclusionMesh)return;(obj.hitArea||obj.hitMesh)&&(obj=function initHitMesh(obj){obj.hitMesh||(obj.hitMesh=new Mesh(obj.hitArea));return obj.add(obj.hitMesh),obj=obj.hitMesh,obj.isHitMesh=!0,obj.shader.neverRender=!0,obj}(obj));"boolean"==typeof obj.isHitMesh?(obj.mouseEnabled=function(visible){visible?~_meshes.indexOf(obj)||_meshes.push(obj):_meshes.remove(obj)},output.push(obj)):output.push(obj);obj.children.length&&obj.children.forEach(checkMesh)}),output}function testObjects(){_test.length=0;for(let i=_meshes.length-1;i>-1;i--){let obj=_meshes[i];obj.determineVisible()&&_test.push(obj)}return _test}function start(e){if("2d"==_input.type&&_stage==Stage){let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));if(element&&checkIfProhibited(element)||GLUI.HIT)return}if(!_enabled)return;let hit=move(e);"3d"==_input.type&&_this.events.fire(Interaction3D.EXTERNAL_PRESS),hit?(_click=hit.object,_click.time=Render.TIME):_click=null}function moveHand(e){if(!_enabled)return;_cacheHits.length=0;for(let i=0;i<_input.obj.length;i++){let obj=_input.obj[i];_v3.set(0,0,-1).applyQuaternion(obj.quaternion);let hit=_ray.checkFromValues(testObjects(),obj.position,_v3)[0];hit&&_cacheHits.push(hit)}_cacheHits.sort((a,b)=>a.distance-b.distance);let hit=_cacheHits[0];if(hit&&hit.object==_lastOnUpdate||(_lastOnUpdate&&_lastOnUpdate.onMissUpdate&&_lastOnUpdate.onMissUpdate(),_lastOnUpdate=null),hit){let mesh=hit.object;if(mesh.onHitUpdate)return hit.usingFinger=!0,_lastOnUpdate=mesh,mesh.onHitUpdate(hit),!1;!mesh._debounceFingerClick||Render.TIME-mesh._debounceFingerClick>1e3?hit.distance<.01?(_click=mesh,triggerClick(mesh,hit),mesh._debounceFingerClick=Render.TIME):_hover||(_hover=mesh,triggerHover("over",mesh,hit)):_hover&&(triggerHover("out",_hover),_hover=null)}else _hover&&(triggerHover("out",_hover),_hover=null)}function move(e){if("2d"==_input.type&&_stage==Stage){let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));if(element&&checkIfProhibited(element))return}if(!_enabled)return void Interaction3D.requestCursor("auto",_this);let hit;if("2d"==_input.type?hit=_ray.checkHit(testObjects(),_input.position,_input.rect||_stage)[0]:(_input.obj.hideBeam(),_v3.set(0,0,-1).applyQuaternion(_input.obj.group.getWorldQuaternion()),hit=_ray.checkFromValues(testObjects(),_input.obj.group.getWorldPosition(),_v3)[0]),hit&&hit.object==_lastOnUpdate||(_lastOnUpdate&&_lastOnUpdate.onMissUpdate&&_lastOnUpdate.onMissUpdate(),_lastOnUpdate=null),hit){_this.intersecting=!0;let mesh=hit.object;if("3d"==_input.type){let max=_maximumVRHitDistance||Interaction3D.maximumVRHitDistance;if("number"==typeof mesh.maximumVRHitDistance&&mesh.maximumVRHitDistance>0&&(max=mesh.maximumVRHitDistance),mesh.onHitUpdate&&hit.distance>max)return!1;_input.obj.showBeam(),_input.obj.setHitPosition&&_input.obj.setHitPosition(hit)}return mesh.onHitUpdate?(mesh.onHitUpdate(hit),_lastOnUpdate=mesh,!1):(_hover!==mesh?(_hover&&triggerHover("out",_hover,hit),_hover=mesh,triggerHover("over",_hover,hit),_hover.__clickCallback?Interaction3D.requestCursor("pointer",_this):Interaction3D.requestCursor("auto",_this)):function triggerMove(mesh,hit){_event.action="move",_event.mesh=mesh,_event.hit=hit,_this.events.fire(Interaction3D.MOVE,_event,!0),mesh["__moveCallback"+_this.ID]&&mesh["__moveCallback"+_this.ID](_event)}(_hover,hit),hit)}return _this.intersecting=!1,end(),_input.obj&&_input.obj.setHitPosition&&_input.obj.setHitPosition(!1),!1}function end(){_hover&&(triggerHover("out",_hover,null),_hover=null,Interaction3D.requestCursor(_this.cursor,_this))}function click(e){if("3d"==_input.type&&_this.events.fire(Interaction3D.EXTERNAL_RELEASE),!_this.enabled)return;if(!_click)return;if("2d"==_input.type&&_stage==Stage){let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));if(element&&checkIfProhibited(element))return}let hit;if("2d"==_input.type){if(GLUI.HIT)return;hit=_ray.checkHit(testObjects(),_input.position,_input.rect)[0]}else _v3.set(0,0,-1).applyQuaternion(_input.obj.group.getWorldQuaternion()),hit=_ray.checkFromValues(testObjects(),_input.obj.group.getWorldPosition(),_v3)[0];hit&&hit.object===_click&&e.button>=0&&e.button<3&&triggerClick(_click,hit),_click=null}function triggerHover(action,mesh,hit){_event.action=action,_event.mesh=mesh,_event.hit=hit,_this.events.fire(Interaction3D.HOVER,_event,!0),_hover.__hoverCallback&&_hover.__hoverCallback(_event)}function triggerClick(mesh,hit){_event.action="click",_event.mesh=mesh,_event.hit=hit,_this.events.fire(Interaction3D.CLICK,_event,!0),_click.__clickCallback&&_click.__clickCallback(_event)}function vrInputButton(e){"trigger"==e.label&&(e.pressed?start(e):click(e))}this.cursor="auto",_ray.testVisibility=!0,this.set("camera",c=>{_ray.camera=c}),this.add=function(meshes,hover,click,move,seo){let seoRoot;Array.isArray(meshes)||(meshes=parseMeshes(meshes)),move&&"function"!=typeof move&&(seo=move,move=null),seo&&seo.root&&(seoRoot=seo.root,seo=seo.seo),meshes.forEach((mesh,i)=>{if(seo)try{mesh._divFocus=_=>hover({action:"over",seo:!0,mesh:mesh}),mesh._divBlur=_=>hover({action:"out",seo:!0,mesh:mesh}),mesh._divSelect=_=>click({action:"click",seo:!0,mesh:mesh});let{url:url,label:label,...options}=Array.isArray(seo)?seo[i]:seo;GLSEO.objectNode(mesh,seoRoot),mesh.seo.aLink(url,label,options)}catch(e){Hydra.LOCAL&&console.warn("Could not add SEO to Interaction3D meshes",e)}mesh.hitDestroy=_=>_meshes.remove(mesh),hover&&(mesh.__hoverCallback=hover),click&&(mesh.__clickCallback=click),move&&(mesh["__moveCallback"+_this.ID]=move),_meshes.push(mesh)})},this.remove=function(meshes){Array.isArray(meshes)||(meshes=parseMeshes(meshes)),meshes.forEach(mesh=>{mesh===_hover&&(_hover=null,Interaction3D.requestCursor(_this.cursor,_this)),mesh.seo&&mesh.seo.unlink();for(let i=_meshes.length-1;i>=0;i--)mesh===_meshes[i]&&_meshes.splice(i,1)})},this.set("testVisibility",v=>_ray.testVisibility=v),this.set("input",obj=>{_input&&_input.obj&&(_input.obj.isVrController&&_this.events.unsub(_input.obj,VRInput.BUTTON,vrInputButton),_input.obj.setHitPosition&&_input.obj.setHitPosition(!1),_input.obj.hideBeam&&_input.obj.hideBeam()),(_input={}).obj=obj,_input.position=obj.group?obj.group.position:obj,_input.quaternion=obj.group?obj.group.quaternion:null,_input.type="number"==typeof _input.position.z||Array.isArray(obj)?"3d":"2d",_input.rect=obj.rect,"3d"==_input.type?(new Vector3,new Vector3):(new Vector2,new Vector2),obj.inverseNormal?function addHandlers(){_this.events.sub(_mouse.input,Interaction.START,start),Device.mobile&&_this.events.sub(_mouse.input,Interaction.END,end),_this.events.sub(_mouse.input,Interaction.MOVE,move),_this.events.sub(_mouse.input,Interaction.CLICK,click)}():(!function removeHandlers(){_this.events.unsub(_mouse.input,Interaction.START,start),Device.mobile&&_this.events.unsub(_mouse.input,Interaction.END,end),_this.events.unsub(_mouse.input,Interaction.MOVE,move),_this.events.unsub(_mouse.input,Interaction.CLICK,click)}(),Array.isArray(obj)?(_this.startRender(moveHand),_this.stopRender(move)):(_this.events.sub(obj,VRInput.BUTTON,vrInputButton),_this.startRender(move),_this.stopRender(moveHand)))}),this.get("input",_=>_input),this.get("enabled",_=>_enabled),this.set("enabled",v=>{(_enabled=v)||(_hover&&triggerHover("out",_hover,null),_hover=null,_input&&_input.obj&&(_input.obj.setHitPosition&&_input.obj.setHitPosition(!1),_input.obj.hideBeam&&_input.obj.hideBeam()))}),this.checkObjectHit=function(object,mouse,rect=Stage){return _ray.checkHit(object,mouse,rect)[0]},this.checkObjectFromValues=function(object,origin,direction){return _ray.checkFromValues(object,origin,direction)[0]},this.getObjectHitLocalCoords=function(v,object,mouse,rect=Stage){let hit=_this.checkObjectHit(object,mouse,rect);return hit?(v.copy(hit.point),hit.object.worldToLocal(v)):(_plane.normal.set(0,0,1).applyQuaternion(object.getWorldQuaternion()),_plane.constant=-object.getWorldPosition().dot(_plane.normal),_ray.ray.intersectPlane(_plane,v),object.worldToLocal(v))},this.get("maximumVRHitDistance",()=>_maximumVRHitDistance),this.set("maximumVRHitDistance",value=>{value?"number"==typeof value&&value>0&&(_maximumVRHitDistance=value):_maximumVRHitDistance=void 0})},()=>{Interaction3D.HOVER="interaction3d_hover",Interaction3D.CLICK="interaction3d_click",Interaction3D.MOVE="interaction3d_move",Interaction3D.EXTERNAL_PRESS="interaction3d_ext_press",Interaction3D.EXTERNAL_RELEASE="interaction3d_ext_release";var _cursorObj,_interactions=new Set,_input=Mouse,_maximumVRHitDistance=5;Interaction3D.find=function(camera,mouse,stage){if(!(camera=camera.camera||camera)._interaction3d){let interaction=new Interaction3D(camera,mouse,stage);interaction.input=mouse||_input,camera._interaction3d=interaction,_interactions.add(new WeakRef(interaction))}return camera._interaction3d},Interaction3D.useInput=function(obj){_input!=obj&&(_interactions.forEach(ref=>{let interaction=ref.deref();interaction?interaction.input=obj:_interactions.delete(ref)}),_input=obj)},Interaction3D.requestCursor=function(cursor,obj){obj.forceCursor&&(cursor=obj.forceCursor),"pointer"==cursor&&(_cursorObj=obj,Stage.cursor(cursor)),"auto"==cursor&&_cursorObj==obj&&(Stage.cursor(cursor),_cursorObj=null)},Object.defineProperty(Interaction3D,"maximumVRHitDistance",{get:()=>_maximumVRHitDistance,set(value){value?"number"==typeof value&&value>0&&(_maximumVRHitDistance=value):_maximumVRHitDistance=5}})}),Class(function Lighting(){Inherit(this,Component);const _this=this;var _activeScene,_scenes={};function loop(){if(decomposeLights(_activeScene.lights),_this.UBO){let shader=_activeScene.shaders.start();shader&&(updateArrays(shader),_activeScene.ubo.created?_activeScene.ubo.update():createUBO(shader.uniforms))}else{let shader=_activeScene.shaders.start();for(;shader;)updateArrays(shader),shader=_activeScene.shaders.next()}}function createUBO(uniforms){uniforms.lightPos&&(_activeScene.ubo.created=!0,_activeScene.ubo.push(uniforms.lightPos),_activeScene.ubo.push(uniforms.lightColor),_activeScene.ubo.push(uniforms.lightData),_activeScene.ubo.push(uniforms.lightData2),_activeScene.ubo.push(uniforms.lightData3),_activeScene.ubo.push(uniforms.lightProperties),_activeScene.ubo.upload())}function decomposeLights(lights){for(let i=lights.length-1;i>-1;i--){let light=lights[i];light._decomposedTime&&Render.TIME-light._decomposedTime<8||(light._decomposedTime=Render.TIME,light._parent||light.updateMatrixWorld(),light._world||(light._world=new Vector3),light.lockToLocal?light._world.copy(light.position):light.getWorldPosition(light._world))}}function updateArrays(shader){let lighting=shader.__lighting;lighting.position.length=0,lighting.color.length=0,lighting.data.length=0,lighting.data2.length=0,lighting.data3.length=0,lighting.properties.length=0;for(let i=0;i<_activeScene.lights.length;i++){let light=_activeScene.lights[i];light._world||decomposeLights(_activeScene.lights),lighting.position.push(light._world.x,light._world.y,light._world.z,0),lighting.color.push(light.color.r,light.color.g,light.color.b,0),lighting.data.push(light.data.x,light.data.y,light.data.z,light.data.w),lighting.data2.push(light.data2.x,light.data2.y,light.data2.z,light.data2.w),lighting.data3.push(light.data3.x,light.data3.y,light.data3.z,light.data3.w),lighting.properties.push(light.properties.x,light.properties.y,light.properties.z,light.properties.w)}}function findParentScene(obj3d){if(!obj3d)return _activeScene;if(obj3d._lightingData)return obj3d._lightingData;let scene,p=obj3d._parent;for(;p;)p instanceof Scene&&p._lightingData&&(scene=p._lightingData),p=p._parent;return scene||(scene=_activeScene),scene}this.fallbackAreaToPoint=!1,this.scenes=_scenes,async function(){await Hydra.ready(),_this.createScene("default"),_this.useScene("default")}(),this.createScene=function(name,scene){if(_scenes[name])return this;let obj={lights:[],renderShadows:[],ubo:new(window.Metal?MetalUBO:UBO)(2),shaders:new LinkedList,name:name};return scene&&(scene._lightingData=obj),_scenes[name]=obj,this},this.useScene=function(name){if(!(_activeScene=_scenes[name]))throw`Scene ${name} not found`;return loop(),this},this.destroyScene=function(name){delete _scenes[name]},this.push=this.add=function(light){_this.UBO=Renderer.UBO&&!(window.AURA||RenderManager.type==RenderManager.WEBVR),window.Metal&&(_this.UBO=!0);let scene=findParentScene(light);scene.lights.push(light),light.isAreaLight&&(scene.hasAreaLight=!0),_this.startedLoop||(_this.startedLoop=!0,RenderManager.type==RenderManager.WEBVR?_this.startRender(loop,World.NUKE):Render.onDrawFrame(loop))},this.remove=function(light){_activeScene.lights.remove(light)},this.getLighting=function(shader,force){if(shader.__lighting&&!force)return shader.__lighting;let scene=findParentScene(shader.mesh);scene.shaders.push(shader),window.AreaLightUtil&&scene.hasAreaLight&&AreaLightUtil.append(shader);let lighting=shader.__lighting={position:[],color:[],data:[],data2:[],data3:[],properties:[]};if(!scene.lights.length)return shader.__lighting;let lightUBO=_this.UBO;return shader.uniforms.lightPos={type:"v4v",value:lighting.position,ignoreUIL:!0,lightUBO:lightUBO,components:4,metalIgnore:!0},shader.uniforms.lightColor={type:"v4v",value:lighting.color,ignoreUIL:!0,lightUBO:lightUBO,components:4,metalIgnore:!0},shader.uniforms.lightData={type:"v4v",value:lighting.data,ignoreUIL:!0,lightUBO:lightUBO,components:4,metalIgnore:!0},shader.uniforms.lightData2={type:"v4v",value:lighting.data2,ignoreUIL:!0,lightUBO:lightUBO,components:4,metalIgnore:!0},shader.uniforms.lightData3={type:"v4v",value:lighting.data3,ignoreUIL:!0,lightUBO:lightUBO,components:4,metalIgnore:!0},shader.uniforms.lightProperties={type:"v4v",value:lighting.properties,ignoreUIL:!0,lightUBO:lightUBO,components:4,metalIgnore:!0},updateArrays(shader),_this.UBO&&!_activeScene.ubo.created&&createUBO(shader.uniforms),shader.__lighting},this.destroyShader=function(shader){findParentScene(shader.mesh).shaders.remove(shader),shader.__lighting=null},this.sort=function(callback){_activeScene.lights.sort(callback)},this.addToShadowGroup=function(light){findParentScene(light).renderShadows.push(light)},this.removeFromShadowGroup=function(light){findParentScene(light).renderShadows.remove(light)},this.getShadowLights=function(){return _activeScene.renderShadows},this.getShadowCount=function(){return _activeScene.renderShadows.length},this.initShadowShader=function(object,mesh){let scene,shader=object.shader||object;if(mesh||(mesh=shader.mesh),mesh){let p=mesh._parent;for(;p;)p instanceof Scene&&p._lightingData&&(scene=p._lightingData),p=p._parent}if(scene||(scene=_activeScene),!World.RENDERER.shadows||0==scene.renderShadows.length)return"";shader._gl||shader.upload();let vsName=shader.vsName,fsName="ShadowDepth";shader.customShadowShader&&(fsName=shader.customShadowShader);let customCompile=[vsName,fsName,shader.customCompile].filter(Boolean).join("|");shader.shadow=new Shader(vsName,fsName,{receiveLight:shader.receiveLight,UILPrefix:shader.UILPrefix,precision:"high",customCompile:customCompile}),shader.vertexShader&&(shader.shadow.vertexShader=shader.vertexShader),shader.restoreVS&&(shader.shadow.vertexShader=shader.restoreVS),shader.customCompile&&(shader.shadow.customCompile=shader.customCompile+"_shadow"),shader.defines&&(shader.shadow.defines=shader.defines,shader.shadow.resetProgram()),shader.shadow.lights=shader.lights,shader.shadow.isShadow=!0,shader.copyUniformsTo(shader.shadow,!0),shader.shadow.upload()},this.getShadowUniforms=function(shader){let scene;if(shader.mesh){let p=shader.mesh._parent;for(;p;)p instanceof Scene&&p._lightingData&&(scene=p._lightingData),p=p._parent}return scene||(scene=_activeScene),World.RENDERER.shadows&&0!=scene.renderShadows.length?[`\n#define SHADOW_MAPS ${scene.renderShadows.length}`,World.RENDERER.shadows==Renderer.SHADOWS_LOW?"#define SHADOWS_LOW":"",World.RENDERER.shadows==Renderer.SHADOWS_MED?"#define SHADOWS_MED":"",World.RENDERER.shadows==Renderer.SHADOWS_HIGH?"#define SHADOWS_HIGH":"",`uniform sampler2D shadowMap[${scene.renderShadows.length}];`,`uniform mat4 shadowMatrix[${scene.renderShadows.length}];`,`uniform vec3 shadowLightPos[${scene.renderShadows.length}];`,`uniform float shadowSize[${scene.renderShadows.length}];`].join("\n"):""},this.bindUBO=function(shader){_activeScene.ubo.created&&_activeScene.ubo.bind(shader,"lights")},this.fallbackAreaToPointTest=function(){return _this.fallbackAreaToPoint},this.get("activeScene",_=>_activeScene),this.renderShadowsAllowLight=function(object,light){if(!object._renderShadowsAllowLights){let allowed=new WeakMap;object._renderShadowsAllowLights=allowed;let prevOnBeforeRenderShadow=object.onBeforeRenderShadow;object.onBeforeRenderShadow=function(renderLight){let result=prevOnBeforeRenderShadow&&prevOnBeforeRenderShadow.apply(this,arguments);return!allowed.has(renderLight)||result}}object._renderShadowsAllowLights.set(light.light||light,!0)}},"static");class Shadow{constructor(light){this.light=light,this.camera=new PerspectiveCamera(60,1,.1,50),this.target=new Vector3,this.rt=new RenderTarget(1024,1024),this.rt.createDepthTexture(),this.enabled=!0,this._size=1024,this._fov=60,this._far=50,this._near=.1,light.add(this.camera)}destroy(){this.rt.destroy()}set fov(value){this._fov=value,this.camera.fov=value,this.camera.updateProjectionMatrix(),-1==value&&(this.camera=new OrthographicCamera(-5,5,5,-5,.1,50),this.light.add(this.camera))}get fov(){return this._fov}set area(value){this._area=value,this.camera.left=-value,this.camera.right=value,this.camera.top=value,this.camera.bottom=-value,this.camera.updateProjectionMatrix()}get area(){return this._area}set far(value){this._far=value,this.camera.far=value,this.camera.updateProjectionMatrix()}get far(){return this._far}set near(value){this._near=value,this.camera.near=value,this.camera.updateProjectionMatrix()}get near(){return this._near}set size(value){this._size=value,this.rt.setSize(value,value)}get size(){return this._size}}class Box2{constructor(min,max){this.min=void 0!==min?min:new Vector2(1/0,1/0),this.max=void 0!==max?max:new Vector2(-1/0,-1/0)}set(min,max){return this.min.copy(min),this.max.copy(max),this}setFromPoints(points){this.makeEmpty();for(let i=0,il=points.length;i<il;i++)this.expandByPoint(points[i]);return this}setFromCenterAndSize(center,size){let v1=this.V1||new Vector2;this.V1=v1;let halfSize=v1.copy(size).multiplyScalar(.5);return this.min.copy(center).sub(halfSize),this.max.copy(center).add(halfSize),this}clone(){return(new Box2).copy(this)}copy(box){return this.min.copy(box.min),this.max.copy(box.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(target){return this.isEmpty()?target.set(0,0):target.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(target){return this.isEmpty()?target.set(0,0):target.subVectors(this.max,this.min)}expandByPoint(point){return this.min.min(point),this.max.max(point),this}expandByVector(vector){return this.min.sub(vector),this.max.add(vector),this}expandByScalar(scalar){return this.min.addScalar(-scalar),this.max.addScalar(scalar),this}containsPoint(point){return!(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y)}containsBox(box){return this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y}getParameter(point,target){return target.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(box){return!(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y)}clampPoint(point,target){return target.copy(point).clamp(this.min,this.max)}distanceToPoint(point){let v1=this.V1||new Vector2;return this.V1=v1,v1.copy(point).clamp(this.min,this.max).sub(point).length()}intersect(box){return this.min.max(box.min),this.max.min(box.max),this}union(box){return this.min.min(box.min),this.max.max(box.max),this}translate(offset){return this.min.add(offset),this.max.add(offset),this}equals(box){return box.min.equals(this.min)&&box.max.equals(this.max)}}class Box3{constructor(min,max){this.min=void 0!==min?min:new Vector3(1/0,1/0,1/0),this.max=void 0!==max?max:new Vector3(-1/0,-1/0,-1/0)}set(min,max){return this.min.copy(min),this.max.copy(max),this}setFromArray(array){let minX=1/0,minY=1/0,minZ=1/0,maxX=-1/0,maxY=-1/0,maxZ=-1/0;for(let i=0,l=array.length;i<l;i+=3){let x=array[i],y=array[i+1],z=array[i+2];x<minX&&(minX=x),y<minY&&(minY=y),z<minZ&&(minZ=z),x>maxX&&(maxX=x),y>maxY&&(maxY=y),z>maxZ&&(maxZ=z)}return this.min.set(minX,minY,minZ),this.max.set(maxX,maxY,maxZ),this}setFromBufferAttribute(attribute){let minX=1/0,minY=1/0,minZ=1/0,maxX=-1/0,maxY=-1/0,maxZ=-1/0,tempV=this.min;for(let i=0,l=attribute.count;i<l;i++){tempV.fromBufferAttribute(attribute,i);let{x:x,y:y,z:z}=tempV;x<minX&&(minX=x),y<minY&&(minY=y),z<minZ&&(minZ=z),x>maxX&&(maxX=x),y>maxY&&(maxY=y),z>maxZ&&(maxZ=z)}return this.min.set(minX,minY,minZ),this.max.set(maxX,maxY,maxZ),this}setFromPoints(points){this.makeEmpty();for(let i=0,il=points.length;i<il;i++)this.expandByPoint(points[i]);return this}setFromCenterAndSize(center,size){let v1=this.V1||new Vector3;this.V1=v1;let halfSize=v1.copy(size).multiplyScalar(.5);return this.min.copy(center).sub(halfSize),this.max.copy(center).add(halfSize),this}setFromObject(object){return this.makeEmpty(),this.expandByObject(object)}clone(){return(new Box3).copy(this)}copy(box){return this.min.copy(box.min),this.max.copy(box.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(target){return this.isEmpty()?target.set(0,0,0):target.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(target){return this.isEmpty()?target.set(0,0,0):target.subVectors(this.max,this.min)}expandByPoint(point){return this.min.min(point),this.max.max(point),this}expandByVector(vector){return this.min.sub(vector),this.max.add(vector),this}expandByScalar(scalar){return this.min.addScalar(-scalar),this.max.addScalar(scalar),this}expandByObject(object,local,onlyvisible){let scope,i,l,v1=this.V1||new Vector3;return this.V1=v1,scope=this,object.updateMatrixWorld(!0),object.traverse(node=>{if(onlyvisible&&!node.visible)return;if(node.isGizmo)return;let geometry=node.geometry;if(!geometry)return;let attribute=geometry.attributes.position;if(void 0!==attribute)for(i=0,l=attribute.count;i<l;i++)v1.fromBufferAttribute(attribute,i).applyMatrix4(local?node.matrix:node.matrixWorld),scope.expandByPoint(v1)}),this}containsPoint(point){return!(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y||point.z<this.min.z||point.z>this.max.z)}containsBox(box){return this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y&&this.min.z<=box.min.z&&box.max.z<=this.max.z}getParameter(point,target){return target.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y),(point.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(box){return!(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y||box.max.z<this.min.z||box.min.z>this.max.z)}intersectsSphere(sphere){let closestPoint=this.V1||new Vector3;return this.V1=closestPoint,this.clampPoint(sphere.center,closestPoint),closestPoint.distanceToSquared(sphere.center)<=sphere.radius*sphere.radius}intersectsPlane(plane){let min,max;return plane.normal.x>0?(min=plane.normal.x*this.min.x,max=plane.normal.x*this.max.x):(min=plane.normal.x*this.max.x,max=plane.normal.x*this.min.x),plane.normal.y>0?(min+=plane.normal.y*this.min.y,max+=plane.normal.y*this.max.y):(min+=plane.normal.y*this.max.y,max+=plane.normal.y*this.min.y),plane.normal.z>0?(min+=plane.normal.z*this.min.z,max+=plane.normal.z*this.max.z):(min+=plane.normal.z*this.max.z,max+=plane.normal.z*this.min.z),min<=plane.constant&&max>=plane.constant}intersectsTriangle(triangle){let v0=this.V0||new Vector3;this.V0=v0;let v1=this.V1||new Vector3;this.V1=v1;let v2=this.V2||new Vector3;this.V2=v2;let f0=this.F0||new Vector3;this.F0=f0;let f1=this.F1||new Vector3;this.F1=f1;let f2=this.F2||new Vector3;this.F2=f2;let testAxis=this.V3||new Vector3;this.V3=testAxis;let center=this.V4||new Vector3;this.V4=center;let extents=this.V5||new Vector3;this.V5=extents;let triangleNormal=this.V6||new Vector3;function satForAxes(axes){let i,j;for(i=0,j=axes.length-3;i<=j;i+=3){testAxis.fromArray(axes,i);let r=extents.x*Math.abs(testAxis.x)+extents.y*Math.abs(testAxis.y)+extents.z*Math.abs(testAxis.z),p0=v0.dot(testAxis),p1=v1.dot(testAxis),p2=v2.dot(testAxis);if(Math.max(-Math.max(p0,p1,p2),Math.min(p0,p1,p2))>r)return!1}return!0}if(this.V6=triangleNormal,this.isEmpty())return!1;this.getCenter(center),extents.subVectors(this.max,center),v0.subVectors(triangle.a,center),v1.subVectors(triangle.b,center),v2.subVectors(triangle.c,center),f0.subVectors(v1,v0),f1.subVectors(v2,v1),f2.subVectors(v0,v2);let axes=[0,-f0.z,f0.y,0,-f1.z,f1.y,0,-f2.z,f2.y,f0.z,0,-f0.x,f1.z,0,-f1.x,f2.z,0,-f2.x,-f0.y,f0.x,0,-f1.y,f1.x,0,-f2.y,f2.x,0];return!!satForAxes(axes)&&(axes=[1,0,0,0,1,0,0,0,1],!!satForAxes(axes)&&(triangleNormal.crossVectors(f0,f1),axes=[triangleNormal.x,triangleNormal.y,triangleNormal.z],satForAxes(axes)))}clampPoint(point,target){return target.copy(point).clamp(this.min,this.max)}distanceToPoint(point){let v1=this.V1||new Vector3;return this.V1=v1,v1.copy(point).clamp(this.min,this.max).sub(point).length()}getBoundingSphere(target=new Sphere){let v1=this.V1||new Vector3;return this.V1=v1,this.getCenter(target.center),target.radius=.5*this.getSize(v1).length(),target}intersect(box){return this.min.max(box.min),this.max.min(box.max),this.isEmpty()&&this.makeEmpty(),this}union(box){return this.min.min(box.min),this.max.max(box.max),this}applyMatrix4(matrix){if(this.isEmpty())return this;let m=matrix.elements,xax=m[0]*this.min.x,xay=m[1]*this.min.x,xaz=m[2]*this.min.x,xbx=m[0]*this.max.x,xby=m[1]*this.max.x,xbz=m[2]*this.max.x,yax=m[4]*this.min.y,yay=m[5]*this.min.y,yaz=m[6]*this.min.y,ybx=m[4]*this.max.y,yby=m[5]*this.max.y,ybz=m[6]*this.max.y,zax=m[8]*this.min.z,zay=m[9]*this.min.z,zaz=m[10]*this.min.z,zbx=m[8]*this.max.z,zby=m[9]*this.max.z,zbz=m[10]*this.max.z;return this.min.x=Math.min(xax,xbx)+Math.min(yax,ybx)+Math.min(zax,zbx)+m[12],this.min.y=Math.min(xay,xby)+Math.min(yay,yby)+Math.min(zay,zby)+m[13],this.min.z=Math.min(xaz,xbz)+Math.min(yaz,ybz)+Math.min(zaz,zbz)+m[14],this.max.x=Math.max(xax,xbx)+Math.max(yax,ybx)+Math.max(zax,zbx)+m[12],this.max.y=Math.max(xay,xby)+Math.max(yay,yby)+Math.max(zay,zby)+m[13],this.max.z=Math.max(xaz,xbz)+Math.max(yaz,ybz)+Math.max(zaz,zbz)+m[14],this}translate(offset){return this.min.add(offset),this.max.add(offset),this}equals(box){return box.min.equals(this.min)&&box.max.equals(this.max)}}class Color{constructor(r,g,b){return null==r&&null==g&&null==b?this.setRGB(1,1,1):void 0===g&&void 0===b?this.set(r):void this.setRGB(r,g,b)}set(value){return value&&value instanceof Color?this.copy(value):"number"==typeof value?this.setHex(value):"string"==typeof value&&this.setStyle(value),this}setScalar(scalar){return this.r=scalar,this.g=scalar,this.b=scalar,this}setHex(hex){return hex=Math.floor(hex),this.r=(hex>>16&255)/255,this.g=(hex>>8&255)/255,this.b=(255&hex)/255,this}setStyle(string){return this.setHex(Number(string.replace("#","0x")))}setRGB(r,g,b){return this.r=r,this.g=g,this.b=b,this}setHSL(h,s,l){return h instanceof ColorHSL?h.getRGB(this):this.target?void this.target.setHSL(h,s,l).getRGB(this):this.target=new ColorHSL(h,s,l)}clone(){return new Color(this.r,this.g,this.b)}copy(color){return this.r=color.r,this.g=color.g,this.b=color.b,this}copyGammaToLinear(color,gammaFactor){return void 0===gammaFactor&&(gammaFactor=2),this.r=Math.pow(color.r,gammaFactor),this.g=Math.pow(color.g,gammaFactor),this.b=Math.pow(color.b,gammaFactor),this}copyLinearToGamma(color,gammaFactor){void 0===gammaFactor&&(gammaFactor=2);let safeInverse=gammaFactor>0?1/gammaFactor:1;return this.r=Math.pow(color.r,safeInverse),this.g=Math.pow(color.g,safeInverse),this.b=Math.pow(color.b,safeInverse),this}convertGammaToLinear(gammaFactor){return this.copyGammaToLinear(this,gammaFactor),this}convertLinearToGamma(gammaFactor){return this.copyLinearToGamma(this,gammaFactor),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b}getHexString(){return"#"+("000000"+this.getHex().toString(16)).slice(-6)}getHSL(){return this.target?this.target.setRGB(this.r,this.g,this.b):this.target=new ColorHSL(this)}tween(color,time,ease,delay){const _this=this;_this.tweenObj||(_this.tweenObj={v:0}),_this.tweenObj.v=0;let clone=this.clone();return TweenManager.tween(_this.tweenObj,{v:1},time,ease,delay).onUpdate(_=>{_this.copy(clone).lerp(color,_this.tweenObj.v)})}offsetHSL(h,s,l){return this.target?this.target.setRGB(this.r,this.g,this.b):this.target=new ColorHSL(this),this.target.h+=h,this.target.s+=s,this.target.l+=l,this.target.getRGB(this)}add(color){return this.r+=color.r,this.g+=color.g,this.b+=color.b,this}addColors(color1,color2){return this.r=color1.r+color2.r,this.g=color1.g+color2.g,this.b=color1.b+color2.b,this}addScalar(s){return this.r+=s,this.g+=s,this.b+=s,this}sub(color){return this.r=Math.max(0,this.r-color.r),this.g=Math.max(0,this.g-color.g),this.b=Math.max(0,this.b-color.b),this}multiply(color){return this.r*=color.r,this.g*=color.g,this.b*=color.b,this}multiplyScalar(s){return this.r*=s,this.g*=s,this.b*=s,this}invert(){return this.r=1-this.r,this.g=1-this.g,this.b=1-this.b,this}lerp(color,alpha,hz){return this.r=Math.lerp(color.r,this.r,alpha,hz),this.g=Math.lerp(color.g,this.g,alpha,hz),this.b=Math.lerp(color.b,this.b,alpha,hz),this}equals(c){return c.r===this.r&&c.g===this.g&&c.b===this.b}fromArray(array,offset){return void 0===offset&&(offset=0),this.r=array[offset],this.g=array[offset+1],this.b=array[offset+2],this}toArray(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.r,array[offset+1]=this.g,array[offset+2]=this.b,array}toRGBA(alpha=1){return`rgba(${Math.floor(255*this.r)}, ${Math.floor(255*this.g)}, ${Math.floor(255*this.b)}, ${alpha})`}}class ColorHSL{constructor(h,s,l){return void 0===h&&void 0===s&&void 0===l?this.setHSL(0,0,1):void 0===s&&void 0===l?this.set(h):void this.setHSL(h,s,l)}copy(colorHSL){return this.h=colorHSL.h,this.s=colorHSL.s,this.l=colorHSL.l,this}getRGB(target=new Color){function hue2rgb(p,q,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+6*(q-p)*(2/3-t):p}let h=Math.euclideanModulo(this.h,1),s=Math.clamp(this.s,0,1),l=Math.clamp(this.l,0,1);if(0===s)target.r=target.g=target.b=l;else{let p=l<=.5?l*(1+s):l+s-l*s,q=2*l-p;target.r=hue2rgb(q,p,h+1/3),target.g=hue2rgb(q,p,h),target.b=hue2rgb(q,p,h-1/3)}return target}set(value){return value&&value instanceof ColorHSL?this.copy(value):value&&value instanceof Color?this.setRGB(value.r,value.g,value.b):"number"==typeof value?this.setHex(value):"string"==typeof value&&this.setStyle(value),this}setHex(hex){const r=((hex=Math.floor(hex))>>16&255)/255,g=(hex>>8&255)/255,b=(255&hex)/255;return this.setRGB(r,g,b)}setStyle(string){return this.setHex(Number(string.replace("#","0x")))}setRGB(r,g,b){let hue,saturation,max=Math.max(r,g,b),min=Math.min(r,g,b),lightness=(min+max)/2;if(min===max)hue=0,saturation=0;else{let delta=max-min;switch(saturation=lightness<=.5?delta/(max+min):delta/(2-max-min),max){case r:hue=(g-b)/delta+(g<b?6:0);break;case g:hue=(b-r)/delta+2;break;case b:hue=(r-g)/delta+4}hue/=6}return this.h=hue,this.s=saturation,this.l=lightness,this}setHSL(h,s,l){return this.h=h,this.s=s,this.l=l,this}}class ColorLAB{constructor(l,a,b){return void 0===l&&void 0===a&&void 0===b?this.setLAB(100,0,0):void 0===a&&void 0===b?this.set(l):void this.setLAB(l,a,b)}copy(colorLAB){return this.l=colorLAB.l,this.a=colorLAB.a,this.b=colorLAB.b,this}deltaECIE94(colorLAB){var deltaL=this.l-colorLAB.l,deltaA=this.a-colorLAB.a,deltaB=this.b-colorLAB.b,c1=Math.sqrt(this.a*this.a+this.b*this.b),deltaC=c1-Math.sqrt(colorLAB.a*colorLAB.a+colorLAB.b*colorLAB.b),deltaH=deltaA*deltaA+deltaB*deltaB-deltaC*deltaC,deltaLKlsl=deltaL/1,deltaCkcsc=deltaC/(1+.045*c1),deltaHkhsh=(deltaH=deltaH<0?0:Math.sqrt(deltaH))/(1+.015*c1),i=deltaLKlsl*deltaLKlsl+deltaCkcsc*deltaCkcsc+deltaHkhsh*deltaHkhsh;return i<0?0:Math.sqrt(i)}getRGB(target=new Color){let y=(this.l+16)/116,x=this.a/500+y,z=y-this.b/200;return x=.95047*(x*x*x>.008856?x*x*x:(x-16/116)/7.787),y=y*y*y>.008856?y*y*y:(y-16/116)/7.787,z=1.08883*(z*z*z>.008856?z*z*z:(z-16/116)/7.787),target.r=3.2406*x+-1.5372*y+-.4986*z,target.g=-.9689*x+1.8758*y+.0415*z,target.b=.0557*x+-.204*y+1.057*z,target.r=Math.clamp(target.r>.0031308?1.055*Math.pow(target.r,1/2.4)-.055:12.92*target.r),target.g=Math.clamp(target.g>.0031308?1.055*Math.pow(target.g,1/2.4)-.055:12.92*target.g),target.b=Math.clamp(target.b>.0031308?1.055*Math.pow(target.b,1/2.4)-.055:12.92*target.b),target}set(value){return value&&value instanceof ColorLAB?this.copy(value):value&&value instanceof Color?this.setRGB(value.r,value.g,value.b):"number"==typeof value?this.setHex(value):"string"==typeof value&&this.setStyle(value),this}setHex(hex){const r=((hex=Math.floor(hex))>>16&255)/255,g=(hex>>8&255)/255,b=(255&hex)/255;return this.setRGB(r,g,b)}setStyle(string){return this.setHex(Number(string.replace("#","0x")))}setRGB(r,g,b){let x,y,z;return x=(.4124*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)+.3576*(g=g>.04045?Math.pow((g+.055)/1.055,2.4):g/12.92)+.1805*(b=b>.04045?Math.pow((b+.055)/1.055,2.4):b/12.92))/.95047,y=.2126*r+.7152*g+.0722*b,z=(.0193*r+.1192*g+.9505*b)/1.08883,x=x>.008856?Math.pow(x,1/3):7.787*x+16/116,y=y>.008856?Math.pow(y,1/3):7.787*y+16/116,z=z>.008856?Math.pow(z,1/3):7.787*z+16/116,this.l=116*y-16,this.a=500*(x-y),this.b=200*(y-z),this}setLAB(l,a,b){return this.l=l,this.a=a,this.b=b,this}}class Cylindrical{constructor(radius=1,theta=0,y=0){this.radius=radius,this.theta=theta,this.y=y}set(radius,theta,y){return this.radius=radius,this.theta=theta,this.y=y,this}clone(){return(new this.constructor).copy(this)}copy(other){return this.radius=other.radius,this.theta=other.theta,this.y=other.y,this}setFromVector3(vec3){return this.radius=Math.sqrt(vec3.x*vec3.x+vec3.z*vec3.z),this.theta=Math.atan2(vec3.x,vec3.z),this.y=vec3.y,this}}class Euler{constructor(x,y,z,order){this._x=x||0,this._y=y||0,this._z=z||0,this._order=order||"XYZ",this.isEuler=!0}get x(){return this._x}set x(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Euler::NaN");let dirty=Math.abs(this._x-v)>Base3D.DIRTY_EPSILON;this._x=v,dirty&&this.onChangeCallback()}get y(){return this._y}set y(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Euler::NaN");let dirty=Math.abs(this._y-v)>Base3D.DIRTY_EPSILON;this._y=v,dirty&&this.onChangeCallback()}get z(){return this._z}set z(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Euler::NaN");let dirty=Math.abs(this._z-v)>Base3D.DIRTY_EPSILON;this._z=v,dirty&&this.onChangeCallback()}set order(value){this._order=value,this.onChangeCallback()}get order(){return this._order}set(x,y,z,order){return this._x=x,this._y=y,this._z=z,this._order=order||this._order,this.onChangeCallback(),this}clone(){return new Euler(this._x,this._y,this._z,this._order)}copy(euler){return this._x=euler.x,this._y=euler.y,this._z=euler.z,euler._order&&(this._order=euler._order),this.onChangeCallback(),this}setFromRotationMatrix(m,order,update){let clamp=Math.clamp,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10];return"XYZ"===(order=order||this._order)?(this._y=Math.asin(clamp(m13,-1,1)),Math.abs(m13)<1-Base3D.DIRTY_EPSILON?(this._x=Math.atan2(-m23,m33),this._z=Math.atan2(-m12,m11)):(this._x=Math.atan2(m32,m22),this._z=0)):"YXZ"===order?(this._x=Math.asin(-clamp(m23,-1,1)),Math.abs(m23)<1-Base3D.DIRTY_EPSILON?(this._y=Math.atan2(m13,m33),this._z=Math.atan2(m21,m22)):(this._y=Math.atan2(-m31,m11),this._z=0)):"ZXY"===order?(this._x=Math.asin(clamp(m32,-1,1)),Math.abs(m32)<1-Base3D.DIRTY_EPSILON?(this._y=Math.atan2(-m31,m33),this._z=Math.atan2(-m12,m22)):(this._y=0,this._z=Math.atan2(m21,m11))):"ZYX"===order?(this._y=Math.asin(-clamp(m31,-1,1)),Math.abs(m31)<1-Base3D.DIRTY_EPSILON?(this._x=Math.atan2(m32,m33),this._z=Math.atan2(m21,m11)):(this._x=0,this._z=Math.atan2(-m12,m22))):"YZX"===order?(this._z=Math.asin(clamp(m21,-1,1)),Math.abs(m21)<1-Base3D.DIRTY_EPSILON?(this._x=Math.atan2(-m23,m22),this._y=Math.atan2(-m31,m11)):(this._x=0,this._y=Math.atan2(m13,m33))):"XZY"===order&&(this._z=Math.asin(-clamp(m12,-1,1)),Math.abs(m12)<1-Base3D.DIRTY_EPSILON?(this._x=Math.atan2(m32,m22),this._y=Math.atan2(m13,m11)):(this._x=Math.atan2(-m23,m33),this._y=0)),this._order=order,!1!==update&&this.onChangeCallback(),this}setFromQuaternion(q,order,update){let matrix=this.M1||new Matrix4;return this.M1=matrix,matrix.makeRotationFromQuaternion(q),this.setFromRotationMatrix(matrix,order,update)}setFromVector3(v,order){return this.set(v.x,v.y,v.z,order||this._order)}reorder(newOrder){let q=this.Q1||new Quaternion;return this.Q1=q,q.setFromEuler(this),this.setFromQuaternion(q,newOrder)}lerp(euler,alpha){this._x+=(euler._x-this._x)*alpha,this._y+=(euler._y-this._y)*alpha,this._z+=(euler._z-this._z)*alpha,this.onChangeCallback()}equals(euler){return euler._x===this._x&&euler._y===this._y&&euler._z===this._z&&euler._order===this._order}fromArray(array){return this._x=array[0],this._y=array[1],this._z=array[2],void 0!==array[3]&&(this._order=array[3]),this.onChangeCallback(),this}toArray(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this._x,array[offset+1]=this._y,array[offset+2]=this._z,array[offset+3]=this._order,array}toVector3(optionalResult){return optionalResult?optionalResult.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)}onChange(callback){this.onChangeCallback=callback}onChangeCallback(){}}Euler.DefaultOrder="XYZ",Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Frustum{constructor(p0,p1,p2,p3,p4,p5){this.planes=[void 0!==p0?p0:new Plane,void 0!==p1?p1:new Plane,void 0!==p2?p2:new Plane,void 0!==p3?p3:new Plane,void 0!==p4?p4:new Plane,void 0!==p5?p5:new Plane]}set(p0,p1,p2,p3,p4,p5){let planes=this.planes;return planes[0].copy(p0),planes[1].copy(p1),planes[2].copy(p2),planes[3].copy(p3),planes[4].copy(p4),planes[5].copy(p5),this}clone(){return(new Frustum).copy(this)}copy(frustum){let planes=this.planes;for(let i=0;i<6;i++)planes[i].copy(frustum.planes[i]);return this}setFromMatrix(m){let planes=this.planes,me=m.elements,me0=me[0],me1=me[1],me2=me[2],me3=me[3],me4=me[4],me5=me[5],me6=me[6],me7=me[7],me8=me[8],me9=me[9],me10=me[10],me11=me[11],me12=me[12],me13=me[13],me14=me[14],me15=me[15];return planes[0].setComponents(me3-me0,me7-me4,me11-me8,me15-me12).normalize(),planes[1].setComponents(me3+me0,me7+me4,me11+me8,me15+me12).normalize(),planes[2].setComponents(me3+me1,me7+me5,me11+me9,me15+me13).normalize(),planes[3].setComponents(me3-me1,me7-me5,me11-me9,me15-me13).normalize(),planes[4].setComponents(me3-me2,me7-me6,me11-me10,me15-me14).normalize(),planes[5].setComponents(me3+me2,me7+me6,me11+me10,me15+me14).normalize(),this}setFromCamera(camera){let matrix=this.M1||new Matrix4;return this.M1=matrix,matrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse),this.setFromMatrix(matrix)}intersectsObject(object,setAsBoolean=!0){let sphere=this.S1||new Sphere;this.S1=sphere;let geometry=object.geometry;return!!geometry&&(null===geometry.boundingSphere&&geometry.computeBoundingSphere(),sphere.copy(geometry.boundingSphere).applyMatrix4(object.matrixWorld),this.intersectsSphere(sphere,setAsBoolean))}intersectsSphere(sphere,setAsBoolean=!0){let planes=this.planes,center=sphere.center,negRadius=-sphere.radius,insides=0;for(let i=0;i<6;i++){let distance=planes[i].distanceToPoint(center);if(distance<negRadius)return!setAsBoolean&&-1;!setAsBoolean&&distance>=0&&insides++}return!!setAsBoolean||(6===insides?1:0)}intersectsBox(box){let p1=this.V1||new Vector3,p2=this.V2||new Vector3;this.V1=p1,this.V2=p2;let planes=this.planes;for(let i=0;i<6;i++){let plane=planes[i];p1.x=plane.normal.x>0?box.min.x:box.max.x,p2.x=plane.normal.x>0?box.max.x:box.min.x,p1.y=plane.normal.y>0?box.min.y:box.max.y,p2.y=plane.normal.y>0?box.max.y:box.min.y,p1.z=plane.normal.z>0?box.min.z:box.max.z,p2.z=plane.normal.z>0?box.max.z:box.min.z;let d1=plane.distanceToPoint(p1),d2=plane.distanceToPoint(p2);if(d1<0&&d2<0)return!1}return!0}containsPoint(point){let planes=this.planes;for(let i=0;i<6;i++)if(planes[i].distanceToPoint(point)<0)return!1;return!0}}class Line3{constructor(start=new Vector3,end=new Vector3){this.start=start,this.end=end}set(start,end){return this.start.copy(start),this.end.copy(end),this}clone(){return(new this.constructor).copy(this)}copy(line){return this.start.copy(line.start),this.end.copy(line.end),this}getCenter(target=new Vector3){return target.addVectors(this.start,this.end).multiplyScalar(.5)}delta(target=new Vector3){return target.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,target=new Vector3){return this.delta(target).multiplyScalar(t).add(this.start)}closestPointToPointParameter(point,clampToLine){let startP=this.V1||new Vector3,startEnd=this.V2||new Vector3;this.V1=startP,this.V2=startEnd,startP.subVectors(point,this.start),startEnd.subVectors(this.end,this.start);let startEnd2=startEnd.dot(startEnd),t=startEnd.dot(startP)/startEnd2;return clampToLine&&(t=Math.clamp(t,0,1)),t}closestPointToPoint(point,clampToLine,target=new Vector3){let t=this.closestPointToPointParameter(point,clampToLine);return this.delta(target).multiplyScalar(t).add(this.start)}applyMatrix4(matrix){return this.start.applyMatrix4(matrix),this.end.applyMatrix4(matrix),this}equals(line){return line.start.equals(this.start)&&line.end.equals(this.end)}}class Matrix3{constructor(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}set(n11,n12,n13,n21,n22,n23,n31,n32,n33){let te=this.elements;return te[0]=n11,te[1]=n21,te[2]=n31,te[3]=n12,te[4]=n22,te[5]=n32,te[6]=n13,te[7]=n23,te[8]=n33,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new Matrix3).fromArray(this.elements)}copy(m){let te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[7]=me[7],te[8]=me[8],this}setFromMatrix4(m){let me=m.elements;return this.set(me[0],me[4],me[8],me[1],me[5],me[9],me[2],me[6],me[10]),this}multiply(m){return this.multiplyMatrices(this,m)}premultiply(m){return this.multiplyMatrices(m,this)}multiplyMatrices(a,b){let ae=a.elements,be=b.elements,te=this.elements,a11=ae[0],a12=ae[3],a13=ae[6],a21=ae[1],a22=ae[4],a23=ae[7],a31=ae[2],a32=ae[5],a33=ae[8],b11=be[0],b12=be[3],b13=be[6],b21=be[1],b22=be[4],b23=be[7],b31=be[2],b32=be[5],b33=be[8];return te[0]=a11*b11+a12*b21+a13*b31,te[3]=a11*b12+a12*b22+a13*b32,te[6]=a11*b13+a12*b23+a13*b33,te[1]=a21*b11+a22*b21+a23*b31,te[4]=a21*b12+a22*b22+a23*b32,te[7]=a21*b13+a22*b23+a23*b33,te[2]=a31*b11+a32*b21+a33*b31,te[5]=a31*b12+a32*b22+a33*b32,te[8]=a31*b13+a32*b23+a33*b33,this}multiplyScalar(s){let te=this.elements;return te[0]*=s,te[3]*=s,te[6]*=s,te[1]*=s,te[4]*=s,te[7]*=s,te[2]*=s,te[5]*=s,te[8]*=s,this}determinant(){let te=this.elements,a=te[0],b=te[1],c=te[2],d=te[3],e=te[4],f=te[5],g=te[6],h=te[7],i=te[8];return a*e*i-a*f*h-b*d*i+b*f*g+c*d*h-c*e*g}getInverse(matrix,throwOnDegenerate){let me=matrix.elements,te=this.elements,n11=me[0],n21=me[1],n31=me[2],n12=me[3],n22=me[4],n32=me[5],n13=me[6],n23=me[7],n33=me[8],t11=n33*n22-n32*n23,t12=n32*n13-n33*n12,t13=n23*n12-n22*n13,det=n11*t11+n21*t12+n31*t13;if(0===det){if(!0===throwOnDegenerate)throw new Error(".getInverse() can't invert matrix, determinant is 0");return this.identity()}let detInv=1/det;return te[0]=t11*detInv,te[1]=(n31*n23-n33*n21)*detInv,te[2]=(n32*n21-n31*n22)*detInv,te[3]=t12*detInv,te[4]=(n33*n11-n31*n13)*detInv,te[5]=(n31*n12-n32*n11)*detInv,te[6]=t13*detInv,te[7]=(n21*n13-n23*n11)*detInv,te[8]=(n22*n11-n21*n12)*detInv,this}transpose(){let tmp,m=this.elements;return tmp=m[1],m[1]=m[3],m[3]=tmp,tmp=m[2],m[2]=m[6],m[6]=tmp,tmp=m[5],m[5]=m[7],m[7]=tmp,this}getNormalMatrix(matrix4){return this.setFromMatrix4(matrix4).getInverse(this).transpose()}setUvTransform(tx,ty,sx,sy,rotation,cx,cy){let c=Math.cos(rotation),s=Math.sin(rotation);this.set(sx*c,sx*s,-sx*(c*cx+s*cy)+cx+tx,-sy*s,sy*c,-sy*(-s*cx+c*cy)+cy+ty,0,0,1)}scale(sx,sy){let te=this.elements;return te[0]*=sx,te[3]*=sx,te[6]*=sx,te[1]*=sy,te[4]*=sy,te[7]*=sy,this}rotate(theta){let c=Math.cos(theta),s=Math.sin(theta),te=this.elements,a11=te[0],a12=te[3],a13=te[6],a21=te[1],a22=te[4],a23=te[7];return te[0]=c*a11+s*a21,te[3]=c*a12+s*a22,te[6]=c*a13+s*a23,te[1]=-s*a11+c*a21,te[4]=-s*a12+c*a22,te[7]=-s*a13+c*a23,this}translate(tx,ty){let te=this.elements;return te[0]+=tx*te[2],te[3]+=tx*te[5],te[6]+=tx*te[8],te[1]+=ty*te[2],te[4]+=ty*te[5],te[7]+=ty*te[8],this}equals(matrix){let te=this.elements,me=matrix.elements;for(let i=0;i<9;i++)if(te[i]!==me[i])return!1;return!0}fromArray(array,offset){void 0===offset&&(offset=0);for(let i=0;i<9;i++)this.elements[i]=array[i+offset];return this}toArray(array,offset){void 0===array&&(array=[]),void 0===offset&&(offset=0);let te=this.elements;return array[offset]=te[0],array[offset+1]=te[1],array[offset+2]=te[2],array[offset+3]=te[3],array[offset+4]=te[4],array[offset+5]=te[5],array[offset+6]=te[6],array[offset+7]=te[7],array[offset+8]=te[8],array}applyToBufferAttribute(attribute){let v1=this.V1||new Vector3;this.V1=v1;for(let i=0,l=attribute.count;i<l;i++)v1.x=attribute.array[3*i+0],v1.y=attribute.array[3*i+1],v1.z=attribute.array[3*i+2],v1.applyMatrix3(this),attribute.array[3*i+0]=v1.x,attribute.array[3*i+1]=v1.y,attribute.array[3*i+2]=v1.z;return attribute}}class Matrix4{constructor(){"undefined"!=typeof MatrixWasm&&MatrixWasm.allocate&&MatrixWasm.allocate(this)||(this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]))}set(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){let te=this.elements;return te[0]=n11,te[4]=n12,te[8]=n13,te[12]=n14,te[1]=n21,te[5]=n22,te[9]=n23,te[13]=n24,te[2]=n31,te[6]=n32,te[10]=n33,te[14]=n34,te[3]=n41,te[7]=n42,te[11]=n43,te[15]=n44,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(m){let te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[7]=me[7],te[8]=me[8],te[9]=me[9],te[10]=me[10],te[11]=me[11],te[12]=me[12],te[13]=me[13],te[14]=me[14],te[15]=me[15],this}copyPosition(m){let te=this.elements,me=m.elements;return te[12]=me[12],te[13]=me[13],te[14]=me[14],this}extractBasis(xAxis,yAxis,zAxis){return xAxis.setFromMatrixColumn(this,0),yAxis.setFromMatrixColumn(this,1),zAxis.setFromMatrixColumn(this,2),this}makeBasis(xAxis,yAxis,zAxis){return this.set(xAxis.x,yAxis.x,zAxis.x,0,xAxis.y,yAxis.y,zAxis.y,0,xAxis.z,yAxis.z,zAxis.z,0,0,0,0,1),this}extractRotation(m){let v1=this.V1||new Vector3;this.V1=v1;let te=this.elements,me=m.elements,scaleX=1/v1.setFromMatrixColumn(m,0).length(),scaleY=1/v1.setFromMatrixColumn(m,1).length(),scaleZ=1/v1.setFromMatrixColumn(m,2).length();return te[0]=me[0]*scaleX,te[1]=me[1]*scaleX,te[2]=me[2]*scaleX,te[4]=me[4]*scaleY,te[5]=me[5]*scaleY,te[6]=me[6]*scaleY,te[8]=me[8]*scaleZ,te[9]=me[9]*scaleZ,te[10]=me[10]*scaleZ,this}makeRotationFromEuler(euler){let te=this.elements,x=euler.x,y=euler.y,z=euler.z,a=Math.cos(x),b=Math.sin(x),c=Math.cos(y),d=Math.sin(y),e=Math.cos(z),f=Math.sin(z);if("XYZ"===euler.order){let ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e,te[4]=-c*f,te[8]=d,te[1]=af+be*d,te[5]=ae-bf*d,te[9]=-b*c,te[2]=bf-ae*d,te[6]=be+af*d,te[10]=a*c}else if("YXZ"===euler.order){let ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce+df*b,te[4]=de*b-cf,te[8]=a*d,te[1]=a*f,te[5]=a*e,te[9]=-b,te[2]=cf*b-de,te[6]=df+ce*b,te[10]=a*c}else if("ZXY"===euler.order){let ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce-df*b,te[4]=-a*f,te[8]=de+cf*b,te[1]=cf+de*b,te[5]=a*e,te[9]=df-ce*b,te[2]=-a*d,te[6]=b,te[10]=a*c}else if("ZYX"===euler.order){let ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e,te[4]=be*d-af,te[8]=ae*d+bf,te[1]=c*f,te[5]=bf*d+ae,te[9]=af*d-be,te[2]=-d,te[6]=b*c,te[10]=a*c}else if("YZX"===euler.order){let ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e,te[4]=bd-ac*f,te[8]=bc*f+ad,te[1]=f,te[5]=a*e,te[9]=-b*e,te[2]=-d*e,te[6]=ad*f+bc,te[10]=ac-bd*f}else if("XZY"===euler.order){let ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e,te[4]=-f,te[8]=d*e,te[1]=ac*f+bd,te[5]=a*e,te[9]=ad*f-bc,te[2]=bc*f-ad,te[6]=b*e,te[10]=bd*f+ac}return te[3]=0,te[7]=0,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this}makeRotationFromQuaternion(q){let te=this.elements,x=q._x,y=q._y,z=q._z,w=q._w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return te[0]=1-(yy+zz),te[4]=xy-wz,te[8]=xz+wy,te[1]=xy+wz,te[5]=1-(xx+zz),te[9]=yz-wx,te[2]=xz-wy,te[6]=yz+wx,te[10]=1-(xx+yy),te[3]=0,te[7]=0,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this}lookAt(eye,target,up){let x=this.V1||new Vector3,y=this.V2||new Vector3,z=this.V3||new Vector3;this.V1=x,this.V2=y,this.V3=z;let te=this.elements;return z.subVectors(eye,target),0===z.lengthSq()&&(z.z=1),z.normalize(),x.crossVectors(up,z),0===x.lengthSq()&&(1===Math.abs(up.z)?z.x+=1e-4:z.z+=1e-4,z.normalize(),x.crossVectors(up,z)),x.normalize(),y.crossVectors(z,x),te[0]=x.x,te[4]=y.x,te[8]=z.x,te[1]=x.y,te[5]=y.y,te[9]=z.y,te[2]=x.z,te[6]=y.z,te[10]=z.z,this}multiply(m){return this.multiplyMatrices(this,m)}premultiply(m){return this.multiplyMatrices(m,this)}multiplyMatrices(ae,be){if("undefined"!=typeof MatrixWasm&&MatrixWasm.multiply&&MatrixWasm.multiply(ae,be,this))return this;let a=ae.elements,b=be.elements,out=this.elements,a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return out[0]=b0*a00+b1*a10+b2*a20+b3*a30,out[1]=b0*a01+b1*a11+b2*a21+b3*a31,out[2]=b0*a02+b1*a12+b2*a22+b3*a32,out[3]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[4],b1=b[5],b2=b[6],b3=b[7],out[4]=b0*a00+b1*a10+b2*a20+b3*a30,out[5]=b0*a01+b1*a11+b2*a21+b3*a31,out[6]=b0*a02+b1*a12+b2*a22+b3*a32,out[7]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[8],b1=b[9],b2=b[10],b3=b[11],out[8]=b0*a00+b1*a10+b2*a20+b3*a30,out[9]=b0*a01+b1*a11+b2*a21+b3*a31,out[10]=b0*a02+b1*a12+b2*a22+b3*a32,out[11]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[12],b1=b[13],b2=b[14],b3=b[15],out[12]=b0*a00+b1*a10+b2*a20+b3*a30,out[13]=b0*a01+b1*a11+b2*a21+b3*a31,out[14]=b0*a02+b1*a12+b2*a22+b3*a32,out[15]=b0*a03+b1*a13+b2*a23+b3*a33,this}multiplyScalar(s){let te=this.elements;return te[0]*=s,te[4]*=s,te[8]*=s,te[12]*=s,te[1]*=s,te[5]*=s,te[9]*=s,te[13]*=s,te[2]*=s,te[6]*=s,te[10]*=s,te[14]*=s,te[3]*=s,te[7]*=s,te[11]*=s,te[15]*=s,this}determinant(){let te=this.elements,n11=te[0],n12=te[4],n13=te[8],n14=te[12],n21=te[1],n22=te[5],n23=te[9],n24=te[13],n31=te[2],n32=te[6],n33=te[10],n34=te[14];return te[3]*(+n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34)+te[7]*(+n11*n23*n34-n11*n24*n33+n14*n21*n33-n13*n21*n34+n13*n24*n31-n14*n23*n31)+te[11]*(+n11*n24*n32-n11*n22*n34-n14*n21*n32+n12*n21*n34+n14*n22*n31-n12*n24*n31)+te[15]*(-n13*n22*n31-n11*n23*n32+n11*n22*n33+n13*n21*n32-n12*n21*n33+n12*n23*n31)}transpose(){let tmp,te=this.elements;return tmp=te[1],te[1]=te[4],te[4]=tmp,tmp=te[2],te[2]=te[8],te[8]=tmp,tmp=te[6],te[6]=te[9],te[9]=tmp,tmp=te[3],te[3]=te[12],te[12]=tmp,tmp=te[7],te[7]=te[13],te[13]=tmp,tmp=te[11],te[11]=te[14],te[14]=tmp,this}setPosition(v){let te=this.elements;return te[12]=v.x,te[13]=v.y,te[14]=v.z,this}getInverse(m,throwOnDegenerate){if("undefined"!=typeof MatrixWasm&&MatrixWasm.getInverse&&MatrixWasm.getInverse(this,m))return this;let te=this.elements,me=m.elements,n11=me[0],n21=me[1],n31=me[2],n41=me[3],n12=me[4],n22=me[5],n32=me[6],n42=me[7],n13=me[8],n23=me[9],n33=me[10],n43=me[11],n14=me[12],n24=me[13],n34=me[14],n44=me[15],t11=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44,t12=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44,t13=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44,t14=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34,det=n11*t11+n21*t12+n31*t13+n41*t14;if(0===det)return te[0]=te[5]=te[10]=te[15]=1,te[1]=te[2]=te[3]=te[4]=te[6]=te[7]=te[8]=te[9]=te[11]=te[12]=te[13]=te[14]=0,this;let detInv=1/det;return te[0]=t11*detInv,te[1]=(n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44)*detInv,te[2]=(n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44)*detInv,te[3]=(n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43)*detInv,te[4]=t12*detInv,te[5]=(n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44)*detInv,te[6]=(n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44)*detInv,te[7]=(n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43)*detInv,te[8]=t13*detInv,te[9]=(n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44)*detInv,te[10]=(n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44)*detInv,te[11]=(n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43)*detInv,te[12]=t14*detInv,te[13]=(n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34)*detInv,te[14]=(n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34)*detInv,te[15]=(n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33)*detInv,this}invert(){const te=this.elements,n11=te[0],n21=te[1],n31=te[2],n41=te[3],n12=te[4],n22=te[5],n32=te[6],n42=te[7],n13=te[8],n23=te[9],n33=te[10],n43=te[11],n14=te[12],n24=te[13],n34=te[14],n44=te[15],t11=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44,t12=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44,t13=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44,t14=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34,det=n11*t11+n21*t12+n31*t13+n41*t14;if(0===det)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const detInv=1/det;return te[0]=t11*detInv,te[1]=(n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44)*detInv,te[2]=(n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44)*detInv,te[3]=(n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43)*detInv,te[4]=t12*detInv,te[5]=(n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44)*detInv,te[6]=(n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44)*detInv,te[7]=(n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43)*detInv,te[8]=t13*detInv,te[9]=(n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44)*detInv,te[10]=(n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44)*detInv,te[11]=(n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43)*detInv,te[12]=t14*detInv,te[13]=(n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34)*detInv,te[14]=(n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34)*detInv,te[15]=(n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33)*detInv,this}scale(v){let te=this.elements,x=v.x,y=v.y,z=v.z;return te[0]*=x,te[4]*=y,te[8]*=z,te[1]*=x,te[5]*=y,te[9]*=z,te[2]*=x,te[6]*=y,te[10]*=z,te[3]*=x,te[7]*=y,te[11]*=z,this}getMaxScaleOnAxis(){let te=this.elements,scaleXSq=te[0]*te[0]+te[1]*te[1]+te[2]*te[2],scaleYSq=te[4]*te[4]+te[5]*te[5]+te[6]*te[6],scaleZSq=te[8]*te[8]+te[9]*te[9]+te[10]*te[10];return Math.sqrt(Math.max(scaleXSq,scaleYSq,scaleZSq))}makeTranslation(x,y,z){return this.set(1,0,0,x,0,1,0,y,0,0,1,z,0,0,0,1),this}makeRotationX(theta){let c=Math.cos(theta),s=Math.sin(theta);return this.set(1,0,0,0,0,c,-s,0,0,s,c,0,0,0,0,1),this}makeRotationY(theta){let c=Math.cos(theta),s=Math.sin(theta);return this.set(c,0,s,0,0,1,0,0,-s,0,c,0,0,0,0,1),this}makeRotationZ(theta){let c=Math.cos(theta),s=Math.sin(theta);return this.set(c,-s,0,0,s,c,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(axis,angle){let c=Math.cos(angle),s=Math.sin(angle),t=1-c,x=axis.x,y=axis.y,z=axis.z,tx=t*x,ty=t*y;return this.set(tx*x+c,tx*y-s*z,tx*z+s*y,0,tx*y+s*z,ty*y+c,ty*z-s*x,0,tx*z-s*y,ty*z+s*x,t*z*z+c,0,0,0,0,1),this}makeScale(x,y,z){return this.set(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1),this}makeShear(x,y,z){return this.set(1,y,z,0,x,1,z,0,x,y,1,0,0,0,0,1),this}compose(position,quaternion,scale){return this.makeRotationFromQuaternion(quaternion),this.scale(scale),this.setPosition(position),this}decompose(position,quaternion,scale){let vector=this.V1||new Vector3;this.V1=vector;let matrix=this.M1||new Matrix4;this.M1=matrix;let te=this.elements,sx=vector.set(te[0],te[1],te[2]).length(),sy=vector.set(te[4],te[5],te[6]).length(),sz=vector.set(te[8],te[9],te[10]).length();this.determinant()<0&&(sx=-sx),position.x=te[12],position.y=te[13],position.z=te[14],matrix.copy(this);let invSX=1/sx,invSY=1/sy,invSZ=1/sz;return matrix.elements[0]*=invSX,matrix.elements[1]*=invSX,matrix.elements[2]*=invSX,matrix.elements[4]*=invSY,matrix.elements[5]*=invSY,matrix.elements[6]*=invSY,matrix.elements[8]*=invSZ,matrix.elements[9]*=invSZ,matrix.elements[10]*=invSZ,quaternion.setFromRotationMatrix(matrix),scale.x=sx,scale.y=sy,scale.z=sz,this}makePerspective(left,right,top,bottom,near,far){let te=this.elements,x=2*near/(right-left),y=2*near/(top-bottom),a=(right+left)/(right-left),b=(top+bottom)/(top-bottom),c=-(far+near)/(far-near),d=-2*far*near/(far-near);return te[0]=x,te[4]=0,te[8]=a,te[12]=0,te[1]=0,te[5]=y,te[9]=b,te[13]=0,te[2]=0,te[6]=0,te[10]=c,te[14]=d,te[3]=0,te[7]=0,te[11]=-1,te[15]=0,this}makeOrthographic(left,right,top,bottom,near,far){let te=this.elements,w=1/(right-left),h=1/(top-bottom),p=1/(far-near),x=(right+left)*w,y=(top+bottom)*h,z=(far+near)*p;return te[0]=2*w,te[4]=0,te[8]=0,te[12]=-x,te[1]=0,te[5]=2*h,te[9]=0,te[13]=-y,te[2]=0,te[6]=0,te[10]=-2*p,te[14]=-z,te[3]=0,te[7]=0,te[11]=0,te[15]=1,this}equals(matrix){let te=this.elements,me=matrix.elements;return te[0]==me[0]&&(te[1]==me[1]&&(te[2]==me[2]&&(te[3]==me[3]&&(te[4]==me[4]&&(te[5]==me[5]&&(te[6]==me[6]&&(te[7]==me[7]&&(te[8]==me[8]&&(te[9]==me[9]&&(te[10]==me[10]&&(te[11]==me[11]&&(te[12]==me[12]&&(te[13]==me[13]&&(te[14]==me[14]&&te[15]==me[15]))))))))))))))}fromArray(array,offset=0){let te=this.elements;return te[0]=array[0+offset],te[1]=array[1+offset],te[2]=array[2+offset],te[3]=array[3+offset],te[4]=array[4+offset],te[5]=array[5+offset],te[6]=array[6+offset],te[7]=array[7+offset],te[8]=array[8+offset],te[9]=array[9+offset],te[10]=array[10+offset],te[11]=array[11+offset],te[12]=array[12+offset],te[13]=array[13+offset],te[14]=array[14+offset],te[15]=array[15+offset],this}toArray(array,offset){void 0===array&&(array=[]),void 0===offset&&(offset=0);let te=this.elements;return array[offset]=te[0],array[offset+1]=te[1],array[offset+2]=te[2],array[offset+3]=te[3],array[offset+4]=te[4],array[offset+5]=te[5],array[offset+6]=te[6],array[offset+7]=te[7],array[offset+8]=te[8],array[offset+9]=te[9],array[offset+10]=te[10],array[offset+11]=te[11],array[offset+12]=te[12],array[offset+13]=te[13],array[offset+14]=te[14],array[offset+15]=te[15],array}applyToBufferAttribute(attribute){let v1=this.V1||new Vector3;this.V1=v1;for(let i=0,l=attribute.count;i<l;i++)v1.x=attribute.array[3*i+0],v1.y=attribute.array[3*i+1],v1.z=attribute.array[3*i+2],v1.applyMatrix4(this),attribute.array[3*i+0]=v1.x,attribute.array[3*i+1]=v1.y,attribute.array[3*i+2]=v1.z;return attribute}isIdentity(){let te=this.elements;return 1==te[0]&&(0==te[1]&&(0==te[2]&&(0==te[3]&&(0==te[4]&&(1==te[5]&&(0==te[6]&&(0==te[7]&&(0==te[8]&&(0==te[9]&&(1==te[10]&&(0==te[11]&&(0==te[12]&&(0==te[13]&&(0==te[14]&&1==te[15]))))))))))))))}}class Plane{constructor(normal,constant){this.normal=void 0!==normal?normal:new Vector3(1,0,0),this.constant=void 0!==constant?constant:0}set(normal,constant){return this.normal.copy(normal),this.constant=constant,this}setComponents(x,y,z,w){return this.normal.set(x,y,z),this.constant=w,this}setFromNormalAndCoplanarPoint(normal,point){return this.normal.copy(normal),this.constant=-point.dot(this.normal),this}setFromCoplanarPoints(a,b,c){let v1=this.V1||new Vector3,v2=this.V2||new Vector3;this.V1=v1,this.V2=v2;var normal=v1.subVectors(c,b).cross(v2.subVectors(a,b)).normalize();return this.setFromNormalAndCoplanarPoint(normal,a),this}clone(){return(new Plane).copy(this)}copy(plane){return this.normal.copy(plane.normal),this.constant=plane.constant,this}normalize(){var inverseNormalLength=1/this.normal.length();return this.normal.multiplyScalar(inverseNormalLength),this.constant*=inverseNormalLength,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(point){return this.normal.dot(point)+this.constant}distanceToSphere(sphere){return this.distanceToPoint(sphere.center)-sphere.radius}projectPoint(point,target){return target.copy(this.normal).multiplyScalar(-this.distanceToPoint(point)).add(point)}intersectLine(line,target){let v1=this.V1||new Vector3;this.V1=v1;var direction=line.delta(v1),denominator=this.normal.dot(direction);if(0===denominator)return 0===this.distanceToPoint(line.start)?target.copy(line.start):void 0;var t=-(line.start.dot(this.normal)+this.constant)/denominator;return t<0||t>1?void 0:target.copy(direction).multiplyScalar(t).add(line.start)}intersectsLine(line){var startSign=this.distanceToPoint(line.start),endSign=this.distanceToPoint(line.end);return startSign<0&&endSign>0||endSign<0&&startSign>0}intersectsBox(box){return box.intersectsPlane(this)}intersectsSphere(sphere){return sphere.intersectsPlane(this)}coplanarPoint(target){return target.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(matrix,optionalNormalMatrix){let v1=this.V1||new Vector3;this.V1=v1;let m1=this.M1||new Matrix3;this.M1=m1;var normalMatrix=optionalNormalMatrix||m1.getNormalMatrix(matrix),referencePoint=this.coplanarPoint(v1).applyMatrix4(matrix),normal=this.normal.applyMatrix3(normalMatrix).normalize();return this.constant=-referencePoint.dot(normal),this}translate(offset){return this.constant-=offset.dot(this.normal),this}equals(plane){return plane.normal.equals(this.normal)&&plane.constant===this.constant}}class Quaternion{constructor(x,y,z,w){this._x=x||0,this._y=y||0,this._z=z||0,this._w=void 0!==w?w:1,this.isQuaternion=!0}get x(){return this._x}set x(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Quaternion::NaN");let dirty=Math.abs(this._x-v)>Base3D.DIRTY_EPSILON;this._x=v,dirty&&this.onChangeCallback()}get y(){return this._y}set y(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Quaternion::NaN");let dirty=Math.abs(this._y-v)>Base3D.DIRTY_EPSILON;this._y=v,dirty&&this.onChangeCallback()}get z(){return this._z}set z(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Quaternion::NaN");let dirty=Math.abs(this._z-v)>Base3D.DIRTY_EPSILON;this._z=v,dirty&&this.onChangeCallback()}get w(){return this._w}set w(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Quaternion::NaN");let dirty=Math.abs(this._w-v)>Base3D.DIRTY_EPSILON;this._w=v,dirty&&this.onChangeCallback()}clone(){return new Quaternion(this._x,this._y,this._z,this._w)}copy(quaternion){const abs=Math.abs;let dirty=abs(this._x-quaternion.x)>Base3D.DIRTY_EPSILON||abs(this._y-quaternion.y)>Base3D.DIRTY_EPSILON||abs(this._z-quaternion.z)>Base3D.DIRTY_EPSILON||abs(this._w-quaternion.w)>Base3D.DIRTY_EPSILON;return this._x=quaternion.x,this._y=quaternion.y,this._z=quaternion.z,this._w=quaternion.w,dirty&&this.onChangeCallback(),this}set(x,y,z,w){const abs=Math.abs;let dirty=abs(this._x-x)>Base3D.DIRTY_EPSILON||abs(this._y-y)>Base3D.DIRTY_EPSILON||abs(this._z-z)>Base3D.DIRTY_EPSILON||abs(this._w-w)>Base3D.DIRTY_EPSILON;this._x=x,this._y=y,this._z=z,this._w=w,dirty&&this.onChangeCallback()}setFromEuler(euler,update){let x=euler._x,y=euler._y,z=euler._z,order=euler.order,cos=Math.cos,sin=Math.sin,c1=cos(x/2),c2=cos(y/2),c3=cos(z/2),s1=sin(x/2),s2=sin(y/2),s3=sin(z/2);return"XYZ"===order?(this._x=s1*c2*c3+c1*s2*s3,this._y=c1*s2*c3-s1*c2*s3,this._z=c1*c2*s3+s1*s2*c3,this._w=c1*c2*c3-s1*s2*s3):"YXZ"===order?(this._x=s1*c2*c3+c1*s2*s3,this._y=c1*s2*c3-s1*c2*s3,this._z=c1*c2*s3-s1*s2*c3,this._w=c1*c2*c3+s1*s2*s3):"ZXY"===order?(this._x=s1*c2*c3-c1*s2*s3,this._y=c1*s2*c3+s1*c2*s3,this._z=c1*c2*s3+s1*s2*c3,this._w=c1*c2*c3-s1*s2*s3):"ZYX"===order?(this._x=s1*c2*c3-c1*s2*s3,this._y=c1*s2*c3+s1*c2*s3,this._z=c1*c2*s3-s1*s2*c3,this._w=c1*c2*c3+s1*s2*s3):"YZX"===order?(this._x=s1*c2*c3+c1*s2*s3,this._y=c1*s2*c3+s1*c2*s3,this._z=c1*c2*s3-s1*s2*c3,this._w=c1*c2*c3-s1*s2*s3):"XZY"===order&&(this._x=s1*c2*c3-c1*s2*s3,this._y=c1*s2*c3-s1*c2*s3,this._z=c1*c2*s3+s1*s2*c3,this._w=c1*c2*c3+s1*s2*s3),!1!==update&&this.onChangeCallback(),this}setFromAxisAngle(axis,angle){let halfAngle=angle/2,s=Math.sin(halfAngle);return this._x=axis.x*s,this._y=axis.y*s,this._z=axis.z*s,this._w=Math.cos(halfAngle),this.onChangeCallback(),this}setFromRotationMatrix(m){let s,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10],trace=m11+m22+m33;return trace>0?(s=.5/Math.sqrt(trace+1),this._w=.25/s,this._x=(m32-m23)*s,this._y=(m13-m31)*s,this._z=(m21-m12)*s):m11>m22&&m11>m33?(s=2*Math.sqrt(1+m11-m22-m33),this._w=(m32-m23)/s,this._x=.25*s,this._y=(m12+m21)/s,this._z=(m13+m31)/s):m22>m33?(s=2*Math.sqrt(1+m22-m11-m33),this._w=(m13-m31)/s,this._x=(m12+m21)/s,this._y=.25*s,this._z=(m23+m32)/s):(s=2*Math.sqrt(1+m33-m11-m22),this._w=(m21-m12)/s,this._x=(m13+m31)/s,this._y=(m23+m32)/s,this._z=.25*s),this.onChangeCallback(),this}setFromUnitVectors(vFrom,vTo){let v1=this.V1||new Vector3;this.V1=v1;let r=vFrom.dot(vTo)+1;return r<1e-6?(r=0,Math.abs(vFrom.x)>Math.abs(vFrom.z)?v1.set(-vFrom.y,vFrom.x,0):v1.set(0,-vFrom.z,vFrom.y)):v1.crossVectors(vFrom,vTo),this._x=v1.x,this._y=v1.y,this._z=v1.z,this._w=r,this.normalize()}inverse(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}dot(v){const w=void 0===v._w?1:v._w;return this._x*v._x+this._y*v._y+this._z*v._z+this._w*w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let l=this.length();return 0===l?(this._x=0,this._y=0,this._z=0,this._w=1):(l=1/l,this._x=this._x*l,this._y=this._y*l,this._z=this._z*l,this._w=this._w*l),this.onChangeCallback(),this}multiply(q){return this.multiplyQuaternions(this,q)}premultiply(q){return this.multiplyQuaternions(q,this)}multiplyQuaternions(a,b){let qax=a._x,qay=a._y,qaz=a._z,qaw=a._w,qbx=b._x,qby=b._y,qbz=b._z,qbw=b._w;return this._x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby,this._y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz,this._z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx,this._w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz,this.onChangeCallback(),this}slerp(qb,t,hz=!0){if(0===(t=hz?Math.framerateNormalizeLerpAlpha(t):Math.clamp(t)))return this;if(1===t)return this.copy(qb);let x=this._x,y=this._y,z=this._z,w=this._w,cosHalfTheta=w*qb._w+x*qb._x+y*qb._y+z*qb._z;if(cosHalfTheta<0?(this._w=-qb._w,this._x=-qb._x,this._y=-qb._y,this._z=-qb._z,cosHalfTheta=-cosHalfTheta):this.copy(qb),cosHalfTheta>=1)return this._w=w,this._x=x,this._y=y,this._z=z,this;let sinHalfTheta=Math.sqrt(1-cosHalfTheta*cosHalfTheta);if(Math.abs(sinHalfTheta)<.001)return this._w=.5*(w+this._w),this._x=.5*(x+this._x),this._y=.5*(y+this._y),this._z=.5*(z+this._z),this;let halfTheta=Math.atan2(sinHalfTheta,cosHalfTheta),ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta,ratioB=Math.sin(t*halfTheta)/sinHalfTheta;return this._w=w*ratioA+this._w*ratioB,this._x=x*ratioA+this._x*ratioB,this._y=y*ratioA+this._y*ratioB,this._z=z*ratioA+this._z*ratioB,this.onChangeCallback(),this}equals(quaternion){return quaternion._x===this._x&&quaternion._y===this._y&&quaternion._z===this._z&&quaternion._w===this._w}fromArray(array,offset){return void 0===offset&&(offset=0),this._x=array[offset],this._y=array[offset+1],this._z=array[offset+2],this._w=array[offset+3],this.onChangeCallback(),this}toArray(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this._x,array[offset+1]=this._y,array[offset+2]=this._z,array[offset+3]=this._w,array}onChange(callback){this.onChangeCallback=callback}onChangeCallback(){}}class RayManager{constructor(origin,direction,near=0,far=1/0){this.ray=new Ray(origin,direction),this.near=near,this.far=far,this.params={Mesh:{},Points:{threshold:1}}}set(origin,direction){return this.ray.set(origin,direction),this}setFromCamera(coords,camera){camera.isPerspective?(this.ray.origin.setFromMatrixPosition(camera.matrixWorld),this.ray.direction.set(coords.x,coords.y,.5).unproject(camera).sub(this.ray.origin).normalize()):(this.ray.origin.set(coords.x,coords.y,(camera.near+camera.far)/(camera.near-camera.far)).unproject(camera),this.ray.direction.set(0,0,-1).transformDirection(camera.matrixWorld))}_ascSort(a,b){return a.distance-b.distance}_intersectObject(object,raycaster,intersects,recursive,forceAllVisible){if((!1!==object.visible||forceAllVisible)&&(object.raycast&&object.raycast(raycaster,intersects),!0===recursive)){let children=object.children;for(let i=0,l=children.length;i<l;i++)this._intersectObject(children[i],raycaster,intersects,!0)}}intersectObject(object,recursive,optionalTarget,forceAllVisible){let intersects=optionalTarget||[];return this._intersectObject(object,this,intersects,recursive,forceAllVisible),intersects.sort(this._ascSort),intersects}intersectObjects(objects,recursive,optionalTarget){let intersects=optionalTarget||[];for(let i=0,l=objects.length;i<l;i++)this._intersectObject(objects[i],this,intersects,recursive);return intersects.sort(this._ascSort),intersects}}class Ray{constructor(origin=new Vector3,direction=new Vector3){this.origin=origin,this.direction=direction}set(origin,direction){return this.origin.copy(origin),this.direction.copy(direction),this}clone(){return(new Ray).copy(this)}copy(ray){return this.origin.copy(ray.origin),this.direction.copy(ray.direction),this}at(t,target=new Vector3){return target.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(v){return this.direction.copy(v).sub(this.origin).normalize(),this}recast(t){let v1=this.V1||new Vector3;this.V1=v1,this.origin.copy(this.at(t,v1))}closestPointToPoint(point,target=new Vector3){target.subVectors(point,this.origin);let directionDistance=target.dot(this.direction);return directionDistance<0?target.copy(this.origin):target.copy(this.direction).multiplyScalar(directionDistance).add(this.origin)}distanceToPoint(point){return Math.sqrt(this.distanceSqToPoint(point))}distanceSqToPoint(point){let v1=this.V1||new Vector3;this.V1=v1;let directionDistance=v1.subVectors(point,this.origin).dot(this.direction);return directionDistance<0?this.origin.distanceToSquared(point):(v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin),v1.distanceToSquared(point))}distanceSqToSegment(v0,v1,optionalPointOnRay,optionalPointOnSegment){let segCenter=this.V1||new Vector3,segDir=this.V2||new Vector3,diff=this.V3||new Vector3;this.V1=segCenter,this.V2=segDir,this.V3=diff,segCenter.copy(v0).add(v1).multiplyScalar(.5),segDir.copy(v1).sub(v0).normalize(),diff.copy(this.origin).sub(segCenter);let s0,s1,sqrDist,extDet,segExtent=.5*v0.distanceTo(v1),a01=-this.direction.dot(segDir),b0=diff.dot(this.direction),b1=-diff.dot(segDir),c=diff.lengthSq(),det=Math.abs(1-a01*a01);if(det>0)if(s0=a01*b1-b0,s1=a01*b0-b1,extDet=segExtent*det,s0>=0)if(s1>=-extDet)if(s1<=extDet){let invDet=1/det;s0*=invDet,s1*=invDet,sqrDist=s0*(s0+a01*s1+2*b0)+s1*(a01*s0+s1+2*b1)+c}else s1=segExtent,s0=Math.max(0,-(a01*s1+b0)),sqrDist=-s0*s0+s1*(s1+2*b1)+c;else s1=-segExtent,s0=Math.max(0,-(a01*s1+b0)),sqrDist=-s0*s0+s1*(s1+2*b1)+c;else s1<=-extDet?(s0=Math.max(0,-(-a01*segExtent+b0)),s1=s0>0?-segExtent:Math.min(Math.max(-segExtent,-b1),segExtent),sqrDist=-s0*s0+s1*(s1+2*b1)+c):s1<=extDet?(s0=0,s1=Math.min(Math.max(-segExtent,-b1),segExtent),sqrDist=s1*(s1+2*b1)+c):(s0=Math.max(0,-(a01*segExtent+b0)),s1=s0>0?segExtent:Math.min(Math.max(-segExtent,-b1),segExtent),sqrDist=-s0*s0+s1*(s1+2*b1)+c);else s1=a01>0?-segExtent:segExtent,s0=Math.max(0,-(a01*s1+b0)),sqrDist=-s0*s0+s1*(s1+2*b1)+c;return optionalPointOnRay&&optionalPointOnRay.copy(this.direction).multiplyScalar(s0).add(this.origin),optionalPointOnSegment&&optionalPointOnSegment.copy(segDir).multiplyScalar(s1).add(segCenter),sqrDist}intersectSphere(sphere,target){let v1=this.V1||new Vector3;this.V1=v1,v1.subVectors(sphere.center,this.origin);let tca=v1.dot(this.direction),d2=v1.dot(v1)-tca*tca,radius2=sphere.radius*sphere.radius;if(d2>radius2)return null;let thc=Math.sqrt(radius2-d2),t0=tca-thc,t1=tca+thc;return t0<0&&t1<0?null:t0<0?this.at(t1,target):this.at(t0,target)}intersectsSphere(sphere){return this.distanceSqToPoint(sphere.center)<=sphere.radius*sphere.radius}distanceToPlane(plane){let denominator=plane.normal.dot(this.direction);if(0===denominator)return 0===plane.distanceToPoint(this.origin)?0:null;let t=-(this.origin.dot(plane.normal)+plane.constant)/denominator;return t>=0?t:null}intersectPlane(plane,target){let t=this.distanceToPlane(plane);return null===t?null:this.at(t,target)}intersectsPlane(plane){let distToPoint=plane.distanceToPoint(this.origin);return 0===distToPoint||plane.normal.dot(this.direction)*distToPoint<0}intersectBox(box,target){let tmin,tmax,tymin,tymax,tzmin,tzmax,invdirx=1/this.direction.x,invdiry=1/this.direction.y,invdirz=1/this.direction.z,origin=this.origin;return invdirx>=0?(tmin=(box.min.x-origin.x)*invdirx,tmax=(box.max.x-origin.x)*invdirx):(tmin=(box.max.x-origin.x)*invdirx,tmax=(box.min.x-origin.x)*invdirx),invdiry>=0?(tymin=(box.min.y-origin.y)*invdiry,tymax=(box.max.y-origin.y)*invdiry):(tymin=(box.max.y-origin.y)*invdiry,tymax=(box.min.y-origin.y)*invdiry),tmin>tymax||tymin>tmax?null:((tymin>tmin||tmin!=tmin)&&(tmin=tymin),(tymax<tmax||tmax!=tmax)&&(tmax=tymax),invdirz>=0?(tzmin=(box.min.z-origin.z)*invdirz,tzmax=(box.max.z-origin.z)*invdirz):(tzmin=(box.max.z-origin.z)*invdirz,tzmax=(box.min.z-origin.z)*invdirz),tmin>tzmax||tzmin>tmax?null:((tzmin>tmin||tmin!=tmin)&&(tmin=tzmin),(tzmax<tmax||tmax!=tmax)&&(tmax=tzmax),tmax<0?null:this.at(tmin>=0?tmin:tmax,target)))}intersectsBox(box){let v=this.V1||new Vector3;return this.V1=v,null!==this.intersectBox(box,v)}intersectsTriangle(a,b,c,backfaceCulling,target){let diff=this.V1||new Vector3,edge1=this.V2||new Vector3,edge2=this.V3||new Vector3,normal=this.V4||new Vector3;this.V1=diff,this.V2=edge1,this.V3=edge2,this.V4=normal,edge1.subVectors(b,a),edge2.subVectors(c,a),normal.crossVectors(edge1,edge2);let sign,DdN=this.direction.dot(normal);if(DdN>0){if(backfaceCulling)return null;sign=1}else{if(!(DdN<0))return null;sign=-1,DdN=-DdN}diff.subVectors(this.origin,a);let DdQxE2=sign*this.direction.dot(edge2.crossVectors(diff,edge2));if(DdQxE2<0)return null;let DdE1xQ=sign*this.direction.dot(edge1.cross(diff));if(DdE1xQ<0)return null;if(DdQxE2+DdE1xQ>DdN)return null;let QdN=-sign*diff.dot(normal);return QdN<0?null:this.at(QdN/DdN,target)}applyMatrix4(matrix4){return this.origin.applyMatrix4(matrix4),this.direction.transformDirection(matrix4),this}equals(ray){return ray.origin.equals(this.origin)&&ray.direction.equals(this.direction)}}class Sphere{constructor(center=new Vector3,radius=0){this.center=center,this.radius=radius}set(center,radius){return this.center.copy(center),this.radius=radius,this}setFromPoints(points,optionalCenter){let box=this.V1||new Box3;this.V1=box;let center=this.center;void 0!==optionalCenter?center.copy(optionalCenter):box.setFromPoints(points).getCenter(center);let maxRadiusSq=0;for(let i=0,il=points.length;i<il;i++)maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(points[i]));return this.radius=Math.sqrt(maxRadiusSq),this}clone(){return(new this.constructor).copy(this)}copy(sphere){return this.center.copy(sphere.center),this.radius=sphere.radius,this}empty(){return this.radius<=0}containsPoint(point){return point.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(point){return point.distanceTo(this.center)-this.radius}intersectsSphere(sphere){let radiusSum=this.radius+sphere.radius;return sphere.center.distanceToSquared(this.center)<=radiusSum*radiusSum}intersectsBox(box){return box.intersectsSphere(this)}intersectsPlane(plane){return Math.abs(plane.distanceToPoint(this.center))<=this.radius}clampPoint(point,target=new Vector3){let deltaLengthSq=this.center.distanceToSquared(point);return target.copy(point),deltaLengthSq>this.radius*this.radius&&(target.sub(this.center).normalize(),target.multiplyScalar(this.radius).add(this.center)),target}getBoundingBox(target=new Box3){return target.set(this.center,this.center),target.expandByScalar(this.radius),target}applyMatrix4(matrix){return this.center.applyMatrix4(matrix),this.radius=this.radius*matrix.getMaxScaleOnAxis(),this}translate(offset){return this.center.add(offset),this}equals(sphere){return sphere.center.equals(this.center)&&sphere.radius===this.radius}}class Spherical{constructor(radius=1,phi=0,theta=0){this.radius=radius,this.phi=phi,this.theta=theta}set(radius,phi,theta){return this.radius=radius,this.phi=phi,this.theta=theta,this}clone(){return(new Spherical).copy(this)}copy(other){return this.radius=other.radius,this.phi=other.phi,this.theta=other.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(vec3){return this.radius=vec3.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(vec3.x,vec3.z),this.phi=Math.acos(Math.clamp(vec3.y/this.radius,-1,1))),this}}class Triangle{constructor(a=new Vector3,b=new Vector3,c=new Vector3){this.a=a,this.b=b,this.c=c}set(a,b,c){return this.a.copy(a),this.b.copy(b),this.c.copy(c),this}setFromPointsAndIndices(points,i0,i1,i2){return this.a.copy(points[i0]),this.b.copy(points[i1]),this.c.copy(points[i2]),this}clone(){return(new Triangle).copy(this)}copy(triangle){return this.a.copy(triangle.a),this.b.copy(triangle.b),this.c.copy(triangle.c),this}getArea(){let v0=this.V0||new Vector3,v1=this.V1||new Vector3;return this.V0=v0,this.V1=v1,v0.subVectors(this.c,this.b),v1.subVectors(this.a,this.b),.5*v0.cross(v1).length()}getMidpoint(target=new Vector3){return target.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(target){return Triangle.getNormal(this.a,this.b,this.c,target)}getPlane(target=new Vector3){return target.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(point,target){return Triangle.getBarycoord(point,this.a,this.b,this.c,target)}containsPoint(point){return Triangle.containsPoint(point,this.a,this.b,this.c)}intersectsBox(box){return box.intersectsTriangle(this)}equals(triangle){return triangle.a.equals(this.a)&&triangle.b.equals(this.b)&&triangle.c.equals(this.c)}}class Vector2{constructor(x=0,y=0){this.x=x,this.y=y}set(x,y){return this.x=x,this.y=y,this}get width(){return this.x}get height(){return this.y}setScalar(s){return this.x=this.y=s,this}clone(){return new Vector2(this.x,this.y)}copy(v){return this.x=v.x,this.y=v.y,this}add(v){return this.x+=v.x,this.y+=v.y,this}addScalar(s){return this.x+=s,this.y+=s,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this}addScaledVector(v,s){return this.x+=v.x*s,this.y+=v.y*s,this}sub(v){return this.x-=v.x,this.y-=v.y,this}subScalar(s){return this.x-=s,this.y-=s,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this}multiply(v){return this.x*=v.x,this.y*=v.y,this}multiplyScalar(scalar){return this.x*=scalar,this.y*=scalar,this}divide(v){return this.x/=v.x,this.y/=v.y,this}divideScalar(scalar){return this.multiplyScalar(1/scalar)}applyMatrix3(m){let x=this.x,y=this.y,e=m.elements;return this.x=e[0]*x+e[3]*y+e[6],this.y=e[1]*x+e[4]*y+e[7],this}min(v){return this.x=Math.min(this.x,v.x),this.y=Math.min(this.y,v.y),this}max(v){return this.x=Math.max(this.x,v.x),this.y=Math.max(this.y,v.y),this}clamp(min,max){return this.x=Math.max(min.x,Math.min(max.x,this.x)),this.y=Math.max(min.y,Math.min(max.y,this.y)),this}clampScalar(minVal,maxVal){let min=new Vector2,max=new Vector2;return min.set(minVal,minVal),max.set(maxVal,maxVal),this.clamp(min,max)}clampLength(min,max){let length=this.length();return this.divideScalar(length||1).multiplyScalar(Math.max(min,Math.min(max,length)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(v){return this.x*v.x+this.y*v.y}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){let angle=Math.atan2(this.y,this.x);return angle<0&&(angle+=2*Math.PI),angle}angleTo(a,b){return b||(b=this),Math.atan2(a.y-b.y,a.x-b.x)}distanceTo(v){return Math.sqrt(this.distanceToSquared(v))}distanceToSquared(v){let dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy}manhattanDistanceTo(v){return Math.abs(this.x-v.x)+Math.abs(this.y-v.y)}setLength(length){return this.normalize().multiplyScalar(length)}lerp(v,alpha,hz){return this.x=Math.lerp(v.x,this.x,alpha,hz),this.y=Math.lerp(v.y,this.y,alpha,hz),this}lerpVectors(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1)}equals(v){return v.x===this.x&&v.y===this.y}setAngleRadius(a,r){return this.x=Math.cos(a)*r,this.y=Math.sin(a)*r,this}addAngleRadius(a,r){return this.x+=Math.cos(a)*r,this.y+=Math.sin(a)*r,this}fromArray(array,offset){return void 0===offset&&(offset=0),this.x=Number(array[offset]),this.y=Number(array[offset+1]),this}toArray(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.x,array[offset+1]=this.y,array}rotateAround(center,angle){let c=Math.cos(angle),s=Math.sin(angle),x=this.x-center.x,y=this.y-center.y;return this.x=x*c-y*s+center.x,this.y=x*s+y*c+center.y,this}fromBufferAttribute(attribute,index){this.x=attribute.array[2*index+0],this.y=attribute.array[2*index+1]}}class Vector3{constructor(x,y,z){this.x=x||0,this.y=y||0,this.z=z||0}set(x,y,z){return this.x=x||0,this.y=y||0,this.z=z||0,this}setScalar(scalar){return this.x=scalar,this.y=scalar,this.z=scalar,this}clone(){return new Vector3(this.x,this.y,this.z)}copy(v){return this.x=v.x,this.y=v.y,this.z=v.z,this}add(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this}addScalar(s){return this.x+=s,this.y+=s,this.z+=s,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this}addScaledVector(v,s){return this.x+=v.x*s,this.y+=v.y*s,this.z+=v.z*s,this}sub(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this}subScalar(s){return this.x-=s,this.y-=s,this.z-=s,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this}multiply(v){return this.x*=v.x,this.y*=v.y,this.z*=v.z,this}multiplyScalar(scalar){return this.x*=scalar,this.y*=scalar,this.z*=scalar,this}multiplyVectors(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this}applyEuler(euler){let quaternion=this.Q1||new Quaternion;return this.Q1=quaternion,this.applyQuaternion(quaternion.setFromEuler(euler))}applyAxisAngle(axis,angle){let quaternion=this.Q1||new Quaternion;return this.Q1=quaternion,this.applyQuaternion(quaternion.setFromAxisAngle(axis,angle))}applyMatrix3(m){let x=this.x,y=this.y,z=this.z,e=m.elements;return this.x=e[0]*x+e[3]*y+e[6]*z,this.y=e[1]*x+e[4]*y+e[7]*z,this.z=e[2]*x+e[5]*y+e[8]*z,this}applyMatrix4(m){let x=this.x,y=this.y,z=this.z,e=m.elements,w=1/(e[3]*x+e[7]*y+e[11]*z+e[15]);return this.x=(e[0]*x+e[4]*y+e[8]*z+e[12])*w,this.y=(e[1]*x+e[5]*y+e[9]*z+e[13])*w,this.z=(e[2]*x+e[6]*y+e[10]*z+e[14])*w,this}applyQuaternion(q){let x=this.x,y=this.y,z=this.z,qx=q.x,qy=q.y,qz=q.z,qw=q.w;if(0==qx&&0==qy&&0==qz&&1==qw)return this;let ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy,this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz,this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx,this}project(camera){let matrix=this.M1||new Matrix4;return this.M1=matrix,matrix.multiplyMatrices(camera.projectionMatrix,matrix.getInverse(camera.matrixWorld)),this.applyMatrix4(matrix)}unproject(camera){let matrix=this.M1||new Matrix4;return this.M1=matrix,matrix.multiplyMatrices(camera.matrixWorld,matrix.getInverse(camera.projectionMatrix)),this.applyMatrix4(matrix)}transformDirection(m){let x=this.x,y=this.y,z=this.z,e=m.elements;return this.x=e[0]*x+e[4]*y+e[8]*z,this.y=e[1]*x+e[5]*y+e[9]*z,this.z=e[2]*x+e[6]*y+e[10]*z,this.normalize()}divide(v){return this.x/=v.x,this.y/=v.y,this.z/=v.z,this}divideScalar(scalar){return this.multiplyScalar(1/scalar)}min(v){return this.x=Math.min(this.x,v.x),this.y=Math.min(this.y,v.y),this.z=Math.min(this.z,v.z),this}max(v){return this.x=Math.max(this.x,v.x),this.y=Math.max(this.y,v.y),this.z=Math.max(this.z,v.z),this}clamp(min,max){return this.x=Math.max(min.x,Math.min(max.x,this.x)),this.y=Math.max(min.y,Math.min(max.y,this.y)),this.z=Math.max(min.z,Math.min(max.z,this.z)),this}clampScalar(minVal,maxVal){let min=new Vector3,max=new Vector3;return min.set(minVal,minVal,minVal),max.set(maxVal,maxVal,maxVal),this.clamp(min,max)}clampLength(min,max){let length=this.length();return this.divideScalar(length||1).multiplyScalar(Math.max(min,Math.min(max,length)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(v){return this.x*v.x+this.y*v.y+this.z*v.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(length){return this.normalize().multiplyScalar(length)}lerp(v,alpha,hz){return this.x=Math.lerp(v.x,this.x,alpha,hz),this.y=Math.lerp(v.y,this.y,alpha,hz),this.z=Math.lerp(v.z,this.z,alpha,hz),this}lerpVectors(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1)}cross(v){return this.crossVectors(this,v)}crossVectors(a,b){let ax=a.x,ay=a.y,az=a.z,bx=b.x,by=b.y,bz=b.z;return this.x=ay*bz-az*by,this.y=az*bx-ax*bz,this.z=ax*by-ay*bx,this}projectOnVector(vector){let scalar=vector.dot(this)/vector.lengthSq();return this.copy(vector).multiplyScalar(scalar)}projectOnPlane(planeNormal){let v1=this.V1||new Vector3;return this.V1=v1,v1.copy(this).projectOnVector(planeNormal),this.sub(v1)}reflect(normal){let v1=this.V1||new Vector3;return this.V1=v1,this.sub(v1.copy(normal).multiplyScalar(2*this.dot(normal)))}angleTo(v){let theta=this.dot(v)/Math.sqrt(this.lengthSq()*v.lengthSq());return Math.acos(Math.clamp(theta,-1,1))}distanceTo(v){return Math.sqrt(this.distanceToSquared(v))}distanceToSquared(v){let dx=this.x-v.x,dy=this.y-v.y,dz=this.z-v.z;return dx*dx+dy*dy+dz*dz}manhattanDistanceTo(v){return Math.abs(this.x-v.x)+Math.abs(this.y-v.y)+Math.abs(this.z-v.z)}setFromCylindrical(c){return this.x=c.radius*Math.sin(c.theta),this.y=c.y,this.z=c.radius*Math.cos(c.theta),this}setFromMatrixPosition(m){let e=m.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(m){let sx=this.setFromMatrixColumn(m,0).length(),sy=this.setFromMatrixColumn(m,1).length(),sz=this.setFromMatrixColumn(m,2).length();return this.x=sx,this.y=sy,this.z=sz,this}setFromMatrixColumn(m,index){return this.fromArray(m.elements,4*index)}setAngleRadius(a,r,dir="xy"){return this[dir[0]]=Math.cos(a)*r,this[dir[1]]=Math.sin(a)*r,this}addAngleRadius(a,r,dir="xy"){return this[dir[0]]+=Math.cos(a)*r,this[dir[1]]+=Math.sin(a)*r,this}equals(v){return v.x===this.x&&v.y===this.y&&v.z===this.z}fromArray(array,offset){return void 0===offset&&(offset=0),this.x=Number(array[offset]),this.y=Number(array[offset+1]),this.z=Number(array[offset+2]),this}setFromSpherical(s){this.setFromSphericalCoords(s.radius,s.phi,s.theta)}setFromSphericalCoords(radius,phi,theta){let sinPhiRadius=Math.sin(phi)*radius;return this.x=sinPhiRadius*Math.sin(theta),this.y=Math.cos(phi)*radius,this.z=sinPhiRadius*Math.cos(theta),this}toArray(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.x,array[offset+1]=this.y,array[offset+2]=this.z,array}fromBufferAttribute(attribute,index){return attribute.isInterleaved?(this.x=attribute.data.array[attribute.offset+index*attribute.data.stride+0],this.y=attribute.data.array[attribute.offset+index*attribute.data.stride+1],this.z=attribute.data.array[attribute.offset+index*attribute.data.stride+2]):(this.x=attribute.array[3*index+0],this.y=attribute.array[3*index+1],this.z=attribute.array[3*index+2]),this}}class Vector3D{constructor(x,y,z){this._x=x||0,this._y=y||0,this._z=z||0}get x(){return this._x}set x(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Vector3D::NaN");let dirty=Math.abs(this._x-v)>Base3D.DIRTY_EPSILON;this._x=v,dirty&&this.onChangeCallback()}get y(){return this._y}set y(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Vector3D::NaN");let dirty=Math.abs(this._y-v)>Base3D.DIRTY_EPSILON;this._y=v,dirty&&this.onChangeCallback()}get z(){return this._z}set z(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Vector3D::NaN");let dirty=Math.abs(this._z-v)>Base3D.DIRTY_EPSILON;this._z=v,dirty&&this.onChangeCallback()}onChangeCallback(){}set(x=0,y=0,z=0){const abs=Math.abs;let dirty=abs(this._x-x)>Base3D.DIRTY_EPSILON||abs(this._y-y)>Base3D.DIRTY_EPSILON||abs(this._z-z)>Base3D.DIRTY_EPSILON;return this._x=x,this._y=y,this._z=z,dirty&&this.onChangeCallback(),this}setScalar(scalar){const abs=Math.abs;let dirty=abs(this._x-scalar)>Base3D.DIRTY_EPSILON||abs(this._y-scalar)>Base3D.DIRTY_EPSILON||abs(this._z-scalar)>Base3D.DIRTY_EPSILON;return this._x=scalar,this._y=scalar,this._z=scalar,dirty&&this.onChangeCallback(),this}clone(){return new Vector3(this._x,this._y,this._z)}copy(v){const abs=Math.abs;let dirty=abs(this._x-v.x)>Base3D.DIRTY_EPSILON||abs(this._y-v.y)>Base3D.DIRTY_EPSILON||abs(this._z-v.z)>Base3D.DIRTY_EPSILON;return this._x=v.x,this._y=v.y,this._z=v.z,dirty&&this.onChangeCallback(),this}add(v){let nx=this._x+v.x,ny=this._y+v.y,nz=this._z+v.z;const abs=Math.abs;let dirty=abs(this._x-nx)>Base3D.DIRTY_EPSILON||abs(this._y-ny)>Base3D.DIRTY_EPSILON||abs(this._z-nz)>Base3D.DIRTY_EPSILON;return this._x=nx,this._y=ny,this._z=nz,dirty&&this.onChangeCallback(),this}addScalar(s){let nx=this._x+s,ny=this._y+s,nz=this._z+s;const abs=Math.abs;let dirty=abs(this._x-nx)>Base3D.DIRTY_EPSILON||abs(this._y-ny)>Base3D.DIRTY_EPSILON||abs(this._z-nz)>Base3D.DIRTY_EPSILON;return this._x=nx,this._y=ny,this._z=nz,dirty&&this.onChangeCallback(),this}addVectors(a,b){return this._x=a.x+b.x,this._y=a.y+b.y,this._z=a.z+b.z,this.onChangeCallback(),this}addScaledVector(v,s){return this._x+=v.x*s,this._y+=v.y*s,this._z+=v.z*s,this.onChangeCallback(),this}sub(v){let nx=this._x-v.x,ny=this._y-v.y,nz=this._z-v.z;const abs=Math.abs;let dirty=abs(this._x-nx)>Base3D.DIRTY_EPSILON||abs(this._y-ny)>Base3D.DIRTY_EPSILON||abs(this._z-nz)>Base3D.DIRTY_EPSILON;return this._x=nx,this._y=ny,this._z=nz,dirty&&this.onChangeCallback(),this}subScalar(s){let nx=this._x-s,ny=this._y-s,nz=this._z-s;const abs=Math.abs;let dirty=abs(this._x-nx)>Base3D.DIRTY_EPSILON||abs(this._y-ny)>Base3D.DIRTY_EPSILON||abs(this._z-nz)>Base3D.DIRTY_EPSILON;return this._x=nx,this._y=ny,this._z=nz,dirty&&this.onChangeCallback(),this}subVectors(a,b){return this._x=a.x-b.x,this._y=a.y-b.y,this._z=a.z-b.z,this.onChangeCallback(),this}multiply(v){let nx=this._x*v.x,ny=this._y*v.y,nz=this._z*v.z;const abs=Math.abs;let dirty=abs(this._x-nx)>Base3D.DIRTY_EPSILON||abs(this._y-ny)>Base3D.DIRTY_EPSILON||abs(this._z-nz)>Base3D.DIRTY_EPSILON;return this._x=nx,this._y=ny,this._z=nz,dirty&&this.onChangeCallback(),this}multiplyScalar(scalar){let nx=this._x*scalar,ny=this._y*scalar,nz=this._z*scalar;const abs=Math.abs;let dirty=abs(this._x-nx)>Base3D.DIRTY_EPSILON||abs(this._y-ny)>Base3D.DIRTY_EPSILON||abs(this._z-nz)>Base3D.DIRTY_EPSILON;return this._x=nx,this._y=ny,this._z=nz,dirty&&this.onChangeCallback(),this}multiplyVectors(a,b){return this._x=a.x*b.x,this._y=a.y*b.y,this._z=a.z*b.z,this.onChangeCallback(),this}applyEuler(euler){let quaternion=this.Q1||new Quaternion;return this.Q1=quaternion,this.applyQuaternion(quaternion.setFromEuler(euler))}applyAxisAngle(axis,angle){let quaternion=this.Q1||new Quaternion;return this.Q1=quaternion,this.applyQuaternion(quaternion.setFromAxisAngle(axis,angle))}applyMatrix3(m){let x=this._x,y=this._y,z=this._z,e=m.elements;return this._x=e[0]*x+e[3]*y+e[6]*z,this._y=e[1]*x+e[4]*y+e[7]*z,this._z=e[2]*x+e[5]*y+e[8]*z,this.onChangeCallback(),this}applyMatrix4(m){let x=this._x,y=this._y,z=this._z,e=m.elements,w=1/(e[3]*x+e[7]*y+e[11]*z+e[15]);return this._x=(e[0]*x+e[4]*y+e[8]*z+e[12])*w,this._y=(e[1]*x+e[5]*y+e[9]*z+e[13])*w,this._z=(e[2]*x+e[6]*y+e[10]*z+e[14])*w,this.onChangeCallback(),this}applyQuaternion(q){let x=this._x,y=this._y,z=this._z,qx=q.x,qy=q.y,qz=q.z,qw=q.w,ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return this._x=ix*qw+iw*-qx+iy*-qz-iz*-qy,this._y=iy*qw+iw*-qy+iz*-qx-ix*-qz,this._z=iz*qw+iw*-qz+ix*-qy-iy*-qx,this.onChangeCallback(),this}project(camera){let matrix=this.M1||new Matrix4;return this.M1=matrix,matrix.multiplyMatrices(camera.projectionMatrix,matrix.getInverse(camera.matrixWorld)),this.applyMatrix4(matrix)}unproject(camera){let matrix=this.M1||new Matrix4;return this.M1=matrix,matrix.multiplyMatrices(camera.matrixWorld,matrix.getInverse(camera.projectionMatrix)),this.applyMatrix4(matrix)}transformDirection(m){let x=this._x,y=this._y,z=this._z,e=m.elements;return this._x=e[0]*x+e[4]*y+e[8]*z,this._y=e[1]*x+e[5]*y+e[9]*z,this._z=e[2]*x+e[6]*y+e[10]*z,this.onChangeCallback(),this.normalize()}divide(v){return this._x/=v.x,this._y/=v.y,this._z/=v.z,this.onChangeCallback(),this}divideScalar(scalar){return this.multiplyScalar(1/scalar)}min(v){return this._x=Math.min(this._x,v.x),this._y=Math.min(this._y,v.y),this._z=Math.min(this._z,v.z),this.onChangeCallback(),this}max(v){return this._x=Math.max(this._x,v.x),this._y=Math.max(this._y,v.y),this._z=Math.max(this._z,v.z),this}clamp(min,max){return this._x=Math.max(min.x,Math.min(max.x,this._x)),this._y=Math.max(min.y,Math.min(max.y,this._y)),this._z=Math.max(min.z,Math.min(max.z,this._z)),this}clampScalar(minVal,maxVal){let min=new Vector3,max=new Vector3;return min.set(minVal,minVal,minVal),max.set(maxVal,maxVal,maxVal),this.clamp(min,max)}clampLength(min,max){let length=this.length();return this.divideScalar(length||1).multiplyScalar(Math.max(min,Math.min(max,length)))}floor(){return this._x=Math.floor(this._x),this._y=Math.floor(this._y),this._z=Math.floor(this._z),this.onChangeCallback(),this}ceil(){return this._x=Math.ceil(this._x),this._y=Math.ceil(this._y),this._z=Math.ceil(this._z),this.onChangeCallback(),this}round(){return this._x=Math.round(this._x),this._y=Math.round(this._y),this._z=Math.round(this._z),this.onChangeCallback(),this}roundToZero(){return this._x=this._x<0?Math.ceil(this._x):Math.floor(this._x),this._y=this._y<0?Math.ceil(this._y):Math.floor(this._y),this._z=this._z<0?Math.ceil(this._z):Math.floor(this._z),this.onChangeCallback(),this}negate(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this.onChangeCallback(),this}dot(v){return this._x*v.x+this._y*v.y+this._z*v.z}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)}manhattanLength(){return Math.abs(this._x)+Math.abs(this._y)+Math.abs(this._z)}normalize(){return this.onChangeCallback(),this.divideScalar(this.length()||1)}setLength(length){return this.onChangeCallback(),this.normalize().multiplyScalar(length)}lerp(v,alpha,hz){return this._x=Math.lerp(v.x,this._x,alpha,hz),this._y=Math.lerp(v.y,this._y,alpha,hz),this._z=Math.lerp(v.z,this._z,alpha,hz),this.onChangeCallback(),this}lerpVectors(v1,v2,alpha){return this.onChangeCallback(),this.subVectors(v2,v1).multiplyScalar(alpha).add(v1)}cross(v){return this.crossVectors(this,v)}crossVectors(a,b){let ax=a.x,ay=a.y,az=a.z,bx=b.x,by=b.y,bz=b.z;return this._x=ay*bz-az*by,this._y=az*bx-ax*bz,this._z=ax*by-ay*bx,this.onChangeCallback(),this}projectOnVector(vector){let scalar=vector.dot(this)/vector.lengthSq();return this.copy(vector).multiplyScalar(scalar)}projectOnPlane(planeNormal){let v1=this.V1||new Vector3;return this.V1=v1,this.onChangeCallback(),v1.copy(this).projectOnVector(planeNormal),this.sub(v1)}reflect(normal){let v1=this.V1||new Vector3;return this.V1=v1,this.onChangeCallback(),this.sub(v1.copy(normal).multiplyScalar(2*this.dot(normal)))}angleTo(v){let theta=this.dot(v)/Math.sqrt(this.lengthSq()*v.lengthSq());return Math.acos(Math.clamp(theta,-1,1))}distanceTo(v){return Math.sqrt(this.distanceToSquared(v))}distanceToSquared(v){let dx=this._x-v.x,dy=this._y-v.y,dz=this._z-v.z;return dx*dx+dy*dy+dz*dz}manhattanDistanceTo(v){return Math.abs(this._x-v.x)+Math.abs(this._y-v.y)+Math.abs(this._z-v.z)}setFromSpherical(s){let sinPhiRadius=Math.sin(s.phi)*s.radius;return this._x=sinPhiRadius*Math.sin(s.theta),this._y=Math.cos(s.phi)*s.radius,this._z=sinPhiRadius*Math.cos(s.theta),this.onChangeCallback(),this}setFromCylindrical(c){return this._x=c.radius*Math.sin(c.theta),this._y=c.y,this._z=c.radius*Math.cos(c.theta),this.onChangeCallback(),this}setFromMatrixPosition(m){let e=m.elements;return this._x=e[12],this._y=e[13],this._z=e[14],this.onChangeCallback(),this}setFromMatrixScale(m){let sx=this.setFromMatrixColumn(m,0).length(),sy=this.setFromMatrixColumn(m,1).length(),sz=this.setFromMatrixColumn(m,2).length();return this.onChangeCallback(),this._x=sx,this._y=sy,this._z=sz,this}setFromMatrixColumn(m,index){return this.onChangeCallback(),this.fromArray(m.elements,4*index)}equals(v){return v.x===this._x&&v.y===this._y&&v.z===this._z}fromArray(array,offset){return void 0===offset&&(offset=0),this._x=Number(array[offset]),this._y=Number(array[offset+1]),this._z=Number(array[offset+2]),this.onChangeCallback(),this}toArray(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=Number(this._x),array[offset+1]=Number(this._y),array[offset+2]=Number(this._z),array}fromBufferAttribute(attribute,index){this._x=attribute.array[3*index+0],this._y=attribute.array[3*index+1],this._z=attribute.array[3*index+2],this.onChangeCallback()}onChange(callback){this.onChangeCallback=callback}onChangeCallback(){}}class Vector4{constructor(x=0,y=0,z=0,w=0){this.x=x,this.y=y,this.z=z,this.w=w}multiplyScalar(s){return this.x*=s,this.y*=s,this.z*=s,this.w*=s,this}set(x,y,z,w){return this.x=x,this.y=y,this.z=z,this.w=w,this}copy(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this}dot(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}equals(v){return v.x===this.x&&v.y===this.y&&v.z===this.z&&v.w===this.w}lerp(v,alpha,hz){return this.x=Math.lerp(v.x,this.x,alpha,hz),this.y=Math.lerp(v.y,this.y,alpha,hz),this.z=Math.lerp(v.z,this.z,alpha,hz),this.w=Math.lerp(v.w,this.w,alpha,hz),this}applyMatrix4(m){let x=this.x,y=this.y,z=this.z,w=this.w,e=m.elements;return this.x=e[0]*x+e[4]*y+e[8]*z+e[12]*w,this.y=e[1]*x+e[5]*y+e[9]*z+e[13]*w,this.z=e[2]*x+e[6]*y+e[10]*z+e[14]*w,this.w=e[3]*x+e[7]*y+e[11]*z+e[15]*w,this}toArray(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.x,array[offset+1]=this.y,array[offset+2]=this.z,array[offset+3]=this.w,array}fromArray(array,offset){return void 0===offset&&(offset=0),this.x=Number(array[offset]),this.y=Number(array[offset+1]),this.z=Number(array[offset+2]),this.w=Number(array[offset+3]),this}set width(v){this.z=v}set height(v){this.w=v}get width(){return this.z}get height(){return this.w}clone(){return new Vector4(this.x,this.y,this.z,this.w)}}class Face3{constructor(a,b,c,normal=new Vector3){this.a=a,this.b=b,this.c=c,this.normal=normal}}function NoGLPolyfill(){this.createQuery=this.activeTexture=this.attachShader=this.bindAttribLocation=this.bindBuffer=this.bindFramebuffer=this.bindRenderbuffer=this.bindTexture=this.blendColor=this.blendEquation=this.blendEquationSeparate=this.blendFunc=this.blendFuncSeparate=this.bufferData=this.bufferSubData=this.checkFramebufferStatus=this.clear=this.clearColor=this.clearDepthf=this.clearStencil=this.colorMask=this.compileShader=this.compressedTexImage2D=this.compressedTexSubImage2D=this.copyTexImage2D=this.copyTexSubImage2D=this.createProgram=this.createShader=this.cullFace=this.deleteBuffers=this.deleteFramebuffers=this.deleteProgram=this.deleteRenderbuffers=this.deleteShader=this.deleteTextures=this.depthFunc=this.depthMask=this.depthRangef=this.detachShader=this.disable=this.disableVertexAttribArray=this.drawArrays=this.drawElements=this.enable=this.enableVertexAttribArray=this.finish=this.flush=this.framebufferRenderbuffer=this.framebufferTexture2D=this.frontFace=this.generateMipmap=this.getActiveAttrib=this.getActiveUniform=this.getAttachedShaders=this.getAttribLocation=this.getBooleanv=this.getBufferParameteriv=this.getError=this.getFloatv=this.getFramebufferAttachmentParameteriv=this.getIntegerv=this.getProgramiv=this.getProgramInfoLog=this.getRenderbufferParameteriv=this.getShaderiv=this.getShaderInfoLog=this.getShaderPrecisionFormat=this.getShaderSource=this.getString=this.getTexParameterfv=this.getTexParameteriv=this.getUniformfv=this.getUniformiv=this.getUniformLocation=this.getVertexAttribfv=this.getVertexAttribiv=this.getVertexAttribPointerv=this.isBuffer=this.isEnabled=this.isFramebuffer=this.isProgram=this.isRenderbuffer=this.isShader=this.isTexture=this.lineWidth=this.linkProgram=this.pixelStorei=this.polygonOffset=this.readPixels=this.releaseShaderCompiler=this.renderbufferStorage=this.sampleCoverage=this.scissor=this.shaderBinary=this.shaderSource=this.stencilFunc=this.stencilFuncSeparate=this.stencilMask=this.stencilMaskSeparate=this.stencilOp=this.stencilOpSeparate=this.texParameterf=this.texParameterfv=this.texParameteri=this.texParameteriv=this.texSubImage2D=this.uniform1f=this.uniform1fv=this.uniform1i=this.uniform1iv=this.uniform2f=this.uniform2fv=this.uniform2i=this.uniform2iv=this.uniform3f=this.uniform3fv=this.uniform3i=this.uniform3iv=this.uniform4f=this.uniform4fv=this.uniform4i=this.uniform4iv=this.uniformMatrix2fv=this.uniformMatrix3fv=this.uniformMatrix4fv=this.useProgram=this.validateProgram=this.vertexAttrib1f=this.vertexAttrib1fv=this.vertexAttrib2f=this.vertexAttrib2fv=this.vertexAttrib3f=this.vertexAttrib3fv=this.vertexAttrib4f=this.vertexAttrib4fv=this.vertexAttribPointer=this.viewport=this.getParameter=this.getExtension=this.drawElementsInstanced=this.drawArraysInstanced=this.vertexAttribDivisor=this.getUniformBlockIndex=this.uniformBlockBinding=this.bindBufferBase=this.createVertexArray=this.bindVertexArray=this.deleteVertexArray=this.drawBuffers=this.blitFramebuffer=this.texImage2D=this.getContextAttributes=this.isContextLost=this.clearDepth=this.depthRange=this.createTexture=this.createBuffer=this.createFramebuffer=this.createRenderbuffer=this.deleteTexture=this.deleteBuffer=this.deleteFramebuffer=this.getBufferParameter=this.getRenderbufferParameter=this.getProgramParameter=this.getVertexAttribOffset=this.getFramebufferAttachmentParemeter=this.getUniform=this.getTexParameter=this.getShaderParameter=this.getSupportedExtensions=this.activeTexture=this.attachShader=_=>{},this.getShaderParameter=this.getProgramParameter=function(){return!0}}Class(function zUtils3D(){function createHelpers(){var diff,edge1,edge2,normal,v1,v0;Ray.prototype.intersectTriangle=(diff=new Vector3,edge1=new Vector3,edge2=new Vector3,normal=new Vector3,function intersectTriangle(a,b,c,backfaceCulling,target){edge1.subVectors(b,a),edge2.subVectors(c,a),normal.crossVectors(edge1,edge2);var sign,DdN=this.direction.dot(normal);if(DdN>0){if(backfaceCulling)return null;sign=1}else{if(!(DdN<0))return null;sign=-1,DdN=-DdN}diff.subVectors(this.origin,a);var DdQxE2=sign*this.direction.dot(edge2.crossVectors(diff,edge2));if(DdQxE2<0)return null;var DdE1xQ=sign*this.direction.dot(edge1.cross(diff));if(DdE1xQ<0)return null;if(DdQxE2+DdE1xQ>DdN)return null;var QdN=-sign*diff.dot(normal);return QdN<0?null:this.at(QdN/DdN,target)}),Mesh.prototype.raycast=function(){let inverseMatrix=new Matrix4,ray=new Ray,sphere=new Sphere,vA=new Vector3,vB=new Vector3,vC=new Vector3,uvA=(new Vector3,new Vector3,new Vector3,new Vector3,new Vector2),uvB=new Vector2,uvC=new Vector2,barycoord=new Vector3,intersectionPoint=new Vector3,intersectionPointWorld=new Vector3;function checkBufferGeometryIntersection(object,raycaster,ray,position,uv,a,b,c){if(vA.fromBufferAttribute(position,a),vB.fromBufferAttribute(position,b),vC.fromBufferAttribute(position,c),object.raycastLimit){let{radiusSq:radiusSq,position:position}=object.raycastLimit;if(vA.distanceToSquared(position)>radiusSq)return}let intersection=function checkIntersection(object,shader,raycaster,ray,pA,pB,pC,point){let intersect;if(intersect=shader.side===Shader.BACK_SIDE?ray.intersectTriangle(pC,pB,pA,!0,point):ray.intersectTriangle(pA,pB,pC,shader.side!==Shader.DOUBLE_SIDE,point),null===intersect)return null;intersectionPointWorld.copy(point),intersectionPointWorld.applyMatrix4(object.matrixWorld);let distance=raycaster.ray.origin.distanceTo(intersectionPointWorld);return distance<raycaster.near||distance>raycaster.far?null:{distance:distance,point:intersectionPointWorld.clone(),object:object}}(object,object.shader,raycaster,ray,vA,vB,vC,intersectionPoint);if(intersection){uv&&(uvA.fromBufferAttribute(uv,a),uvB.fromBufferAttribute(uv,b),uvC.fromBufferAttribute(uv,c),intersection.uv=function uvIntersection(point,p1,p2,p3,uv1,uv2,uv3){return Triangle.getBarycoord(point,p1,p2,p3,barycoord),uv1.multiplyScalar(barycoord.x),uv2.multiplyScalar(barycoord.y),uv3.multiplyScalar(barycoord.z),uv1.add(uv2).add(uv3),uv1.clone()}(intersectionPoint,vA,vB,vC,uvA,uvB,uvC));let face=new Face3(a,b,c);Triangle.getNormal(vA,vB,vC,face.normal),intersection.face=face}return intersection}return function raycast(raycaster,intersects){let intersection,a,b,c,geometry=this.geometry,shader=this.shader,matrixWorld=this.matrixWorld;if(void 0===shader)return;if(null===geometry.boundingSphere&&geometry.computeBoundingSphere(),0==this.scale.x)return;if(this.staticRaycast){if(this.raySphere||(this.raySphere=new Sphere,this.raySphere.copy(geometry.boundingSphere),this.raySphere.applyMatrix4(matrixWorld)),this.raycastNeedsUpdate&&(this.raySphere.copy(geometry.boundingSphere),this.raySphere.applyMatrix4(matrixWorld),this.raycastNeedsUpdate=!1),!1===raycaster.ray.intersectsSphere(this.raySphere))return}else if(sphere.copy(geometry.boundingSphere),sphere.applyMatrix4(matrixWorld),!1===raycaster.ray.intersectsSphere(sphere))return;if(inverseMatrix.getInverse(matrixWorld),ray.copy(raycaster.ray).applyMatrix4(inverseMatrix),null!==geometry.boundingBox&&!1===ray.intersectsBox(geometry.boundingBox))return;let i,l,index=geometry.index,position=geometry.attributes.position,uv=geometry.attributes.uv;if(null!==index)for(i=0,l=index.length;i<l;i+=3)a=index[i],b=index[i+1],c=index[i+2],intersection=checkBufferGeometryIntersection(this,raycaster,ray,position,uv,a,b,c),intersection&&(intersection.faceIndex=Math.floor(i/3),intersects.push(intersection));else if(void 0!==position)for(i=0,l=position.count;i<l;i+=3)a=i,b=i+1,c=i+2,intersection=checkBufferGeometryIntersection(this,raycaster,ray,position,uv,a,b,c),intersection&&(intersection.faceIndex=Math.floor(i/3),intersects.push(intersection))}}(),Triangle.prototype.closestPointToPoint=function(){let plane=new Plane,edgeList=[new Line3,new Line3,new Line3],projectedPoint=new Vector3,closestPoint=new Vector3;return function closestPointToPoint(point,target=new Vector3){let minDistance=1/0;if(plane.setFromCoplanarPoints(this.a,this.b,this.c),plane.projectPoint(point,projectedPoint),!0===this.containsPoint(projectedPoint))target.copy(projectedPoint);else{edgeList[0].set(this.a,this.b),edgeList[1].set(this.b,this.c),edgeList[2].set(this.c,this.a);for(let i=0;i<edgeList.length;i++){edgeList[i].closestPointToPoint(projectedPoint,!0,closestPoint);let distance=projectedPoint.distanceToSquared(closestPoint);distance<minDistance&&(minDistance=distance,target.copy(closestPoint))}}return target}}(),Points.prototype.raycast=function(){let inverseMatrix=new Matrix4,ray=new Ray,sphere=new Sphere;return function raycast(raycaster,intersects){let object=this,geometry=this.geometry,matrixWorld=this.matrixWorld,threshold=raycaster.params.Points.threshold;if(null===geometry.boundingSphere&&geometry.computeBoundingSphere(),sphere.copy(geometry.boundingSphere),sphere.applyMatrix4(matrixWorld),sphere.radius+=threshold,!1===raycaster.ray.intersectsSphere(sphere))return;inverseMatrix.getInverse(matrixWorld),ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);let localThreshold=threshold/((this.scale.x+this.scale.y+this.scale.z)/3),localThresholdSq=localThreshold*localThreshold,position=new Vector3,intersectPoint=new Vector3;function testPoint(point,index){let rayPointDistanceSq=ray.distanceSqToPoint(point);if(rayPointDistanceSq<localThresholdSq){ray.closestPointToPoint(point,intersectPoint),intersectPoint.applyMatrix4(matrixWorld);let distance=raycaster.ray.origin.distanceTo(intersectPoint);if(distance<raycaster.near||distance>raycaster.far)return;intersects.push({distance:distance,distanceToRay:Math.sqrt(rayPointDistanceSq),point:intersectPoint.clone(),index:index,face:null,object:object})}}let index=geometry.index,positions=geometry.attributes.position.array;if(null!==index){let indices=index.array;for(let i=0,il=indices.length;i<il;i++){let a=indices[i];position.fromArray(positions,3*a),testPoint(position,a)}}else for(let i=0,l=positions.length/3;i<l;i++)position.fromArray(positions,3*i),testPoint(position,i)}}(),Object.assign(Triangle,{getNormal:(v0=new Vector3,function getNormal(a,b,c,target=new Vector3){target.subVectors(c,b),v0.subVectors(a,b),target.cross(v0);var targetLengthSq=target.lengthSq();return targetLengthSq>0?target.multiplyScalar(1/Math.sqrt(targetLengthSq)):target.set(0,0,0)}),getBarycoord:function(){var v0=new Vector3,v1=new Vector3,v2=new Vector3;return function getBarycoord(point,a,b,c,target=new Vector3){v0.subVectors(c,a),v1.subVectors(b,a),v2.subVectors(point,a);var dot00=v0.dot(v0),dot01=v0.dot(v1),dot02=v0.dot(v2),dot11=v1.dot(v1),dot12=v1.dot(v2),denom=dot00*dot11-dot01*dot01;if(0===denom)return target.set(-2,-1,-1);var invDenom=1/denom,u=(dot11*dot02-dot01*dot12)*invDenom,v=(dot00*dot12-dot01*dot02)*invDenom;return target.set(1-u-v,v,u)}}(),getUV:function(){let _v3=new Vector3;return function getUV(point,p1,p2,p3,uv1,uv2,uv3,target){return this.getBarycoord(point,p1,p2,p3,_v3),target.set(0,0),target.addScaledVector(uv1,_v3.x),target.addScaledVector(uv2,_v3.y),target.addScaledVector(uv3,_v3.z),target}}(),containsPoint:(v1=new Vector3,function containsPoint(point,a,b,c){return Triangle.getBarycoord(point,a,b,c,v1),v1.x>=0&&v1.y>=0&&v1.x+v1.y<=1})})}Math.euclideanModulo=function(n,m){return(n%m+m)%m},Math.isPowerOf2=function(w,h){let test=value=>!(value&value-1);return test(w)&&test(h)},Math.floorPowerOf2=function(value){return Math.pow(2,Math.floor(Math.log(value)/Math.LN2))},Math.ceilPowerOf2=function(value){return Math.pow(2,Math.ceil(Math.log(value)/Math.LN2))},this.LOCAL=window.Hydra&&Hydra.LOCAL,Geometry.createAttributes=function(geom){let attributes={},handler={set(target,property,value){target[property]=value,geom._attributeKeys.length=0,geom._attributeValues.length=0;for(let key in attributes)geom._attributeKeys.push(key),geom._attributeValues.push(attributes[key]);return!0}};return geom._attributeKeys=[],geom._attributeValues=[],new Proxy(attributes,handler)},Geometry.TYPED_ARRAYS={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array},Geometry.arrayNeedsUint32=function(array){for(let i=array.length-1;i>=0;--i)if(array[i]>65535)return!0;return!1},Geometry.TYPES={SphereGeometry:SphereGeometry,IcosahedronGeometry:IcosahedronGeometry,BoxGeometry:BoxGeometry,PlaneGeometry:PlaneGeometry,CylinderGeometry:CylinderGeometry},Matrix4.prototype.isMatrix4=!0,Matrix3.prototype.isMatrix3=!0,Vector3.prototype.isVector3=!0,Vector3D.prototype.isVector3=!0,Vector2.prototype.isVector2=!0,CameraBase3D.prototype.isCamera=!0,PerspectiveCamera.prototype.isPerspective=!0,Scene.FRONT_TO_BACK="sort_front_to_back",Scene.FRONT_TO_BACK_BOUNDING="sort_front_to_back_bounding",window.THREAD&&(Shader={FRONT_SIDE:"shader_front_side",BACK_SIDE:"shader_back_side",DOUBLE_SIDE:"shader_double_side"}),window.MatrixWasm?MatrixWasm.ready().then(createHelpers):createHelpers()},"static"),Class(function FXLayer(_parentNuke,_type,_preventDrawBuffers){Inherit(this,Component);var _nuke,_rt,_this=this,_scene=new Scene,_objects=[],_textureIndex=-1,_visible=!0,_id=Utils.timestamp(),_name=Utils.getConstructorName(_this),_useDrawBuffers=!_preventDrawBuffers;this.resolution=1,this.enabled=!0,this.renderShadows=!0;const CLEAR_COLOR=[0,0,0,1];function resizeHandler(){_rt.setSize&&_rt.setSize(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr)}if(FXLayer.exists=!0,this.set("visible",v=>_this.scene.visible=_visible=v),this.get("visible",_=>_visible),this.onInvisible=function(){_this.scene.visible=!1},this.onVisible=function(){_this.scene.visible=!0},this.create=function(nuke=World.NUKE,type,rt){if(!nuke)return;let format,manualRender,mipmaps;_useDrawBuffers=nuke.useDrawBuffers&&null==_preventDrawBuffers,type&&"object"==typeof type&&("boolean"==typeof type.useDrawBuffers&&(_useDrawBuffers=type.useDrawBuffers),format=type.format,manualRender=type.manualRender,mipmaps=type.mipmaps,rt||(rt=type.rt),type=type.type),_this.rtType=type||Texture.UNSIGNED_BYTE,_this.rtFormat=format||Texture.RGBFormat,_this.rtMipmaps=mipmaps,(_this=this).scene=_scene,_nuke=_this.initClass(Nuke,nuke.stage,{renderer:nuke.renderer,camera:nuke.camera,scene:_scene,dpr:nuke.dpr,useDrawBuffers:!1}),_parentNuke=_this.parent?.nuke||nuke,_nuke.parentNuke=_parentNuke,_this.nuke=_nuke,function initRT(rt){if(_useDrawBuffers){let texture=new Texture;texture.minFilter=Texture.LINEAR,texture.magFilter=Texture.LINEAR,texture.format=Texture.RGBAFormat,_this.rtType&&(texture.type=_this.rtType),_this.rtFormat&&(texture.format=_this.rtFormat),_this.rtMipmaps?(texture.generateMipmaps=!0,texture.minFilter=texture.magFilter=Texture.LINEAR_MIPMAP):texture.generateMipmaps=!1,texture.type==Texture.FLOAT&&(texture.format=Texture.RGBAFormat),texture.wrapS=texture.wrapT=Texture.CLAMP_TO_EDGE,texture.fxLayer=_this,_this.textureIndex=_textureIndex=_parentNuke.attachDrawBuffer(texture),_rt={texture:texture}}else _this.rtType&&_this.rtType==Texture.FLOAT&&"ios"==Device.system.os&&(_this.rtType=Texture.HALF_FLOAT),_rt=rt||Utils3D.createRT(Math.round(_nuke.stage.width*_this.resolution*_nuke.dpr),Math.round(_nuke.stage.height*_this.resolution*_nuke.dpr),_this.rtType,_this.rtFormat),_this.rtMipmaps?(_rt.texture.minFilter=_rt.texture.magFilter=Texture.LINEAR_MIPMAP,_rt.texture.generateMipmaps=!0):_rt.texture.generateMipmaps=!1;_this.rt=_rt,_this.nuke.setSize(_rt.width,_rt.height)}(rt),function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}(),manualRender||FXScene.manualRender||_this.startRender(_=>_this.draw(),nuke)},this.addObject=this.add=function(object){if(_nuke){if(!_useDrawBuffers){let clone=object.clone();for(object["clone_"+_id]=clone,_scene.add(clone),_objects.push(object),object.shader&&function editShader(mesh){let applyShadow=(shader,bool)=>{let fs=shader.fragmentShader;if(fs){for(;fs.includes("#applyShadow");){fs=fs.split("\n");for(let i=0;i<fs.length;i++)bool?fs[i].includes("#applyShadow")&&(fs[i]=fs[i].replace("#applyShadow","")):fs[i].includes("#applyShadow")&&(fs[i]="");fs=fs.join("\n")}shader.fragmentShader=fs}};mesh.shader._fragmentShader||(mesh.shader._fragmentShader=mesh.shader.fragmentShader);let shader=mesh.shader.clone(!_this.renderShadows,`-${_this.name||_name}`);((shader,name)=>{let fs=shader._fragmentShader;if(!fs)return;let marker="#drawbuffer "+name;if(fs.includes(marker)){let split=fs.split(marker+" ");fs=split.join("")}for(;fs.includes("#drawbuffer");){fs=fs.split("\n");for(let i=0;i<fs.length;i++)fs[i].includes("#drawbuffer")&&(fs[i]="");fs=fs.join("\n")}shader.fragmentShader=fs})(shader,_this.name||_name),applyShadow(shader,_this.renderShadows),applyShadow(mesh.shader,!0),mesh.shader.copyUniformsTo(shader,!0),mesh.shader=shader}(clone);clone.children.length;)clone.remove(clone.children[0]);return clone}object.shader&&object.shader.fragmentShader&&(!function editDBShader(mesh){const WEBGL2=Renderer.type==Renderer.WEBGL2;let modifyMarker=(fs,name,index)=>{if(WEBGL2){if(fs.includes("layout(location=0) out vec4 reflectionsData"))return fs;if(!fs.includes(`layout(location=${index})`)){let mainAt=(fs=fs.replace("out vec4 FragColor;","")).indexOf("void main()"),before=fs.slice(0,mainAt),after=fs.slice(mainAt);fs=before+`layout(location=${index}) out vec4 ${name};\n`+after}}let marker="#drawbuffer "+name;if(fs.includes(marker)){let split=fs.split(marker+" "),finalOut=WEBGL2?name:`gl_FragData[${index}]`;for(let i=1;i<split.length;++i)split[i]=split[i].replace("gl_FragColor",finalOut);fs=split.join("")}for(;fs.includes("#applyShadow");){fs=fs.split("\n");for(let i=0;i<fs.length;i++)fs[i].includes("#applyShadow")&&(fs[i]=fs[i].replace("#applyShadow",""));fs=fs.join("\n")}return fs},shader=mesh.shader,fs=shader.fragmentShader,name=_this.name||_name;WEBGL2&&fs.includes("location=0")||(fs=modifyMarker(fs,"Color",0)),fs=modifyMarker(fs,name,_textureIndex),shader.fragmentShader=fs}(object),object.shader._attachmentData={format:_this.rtFormat,type:_this.rtType,attachments:_parentNuke.attachments})}},this.removeObject=function(object){_nuke&&(_scene.remove(object["clone_"+_id]),_objects.remove(object),delete object["clone_"+_id])},this.render=this.draw=function(stage,camera){if(!_nuke||!_this.enabled||_useDrawBuffers)return;if(!_parentNuke.enabled||!_objects.length)return;const oldClear=Renderer.CLEAR;Renderer.CLEAR=CLEAR_COLOR,stage&&(_nuke.stage=stage,_this.setSize(stage.width,stage.height)),_nuke.camera=camera||_nuke.parentNuke.camera,_this.renderShadows||(_nuke.renderer.overridePreventShadows=!0);for(let i=_objects.length-1;i>-1;i--){let obj=_objects[i],clone=obj["clone_"+_id];_this.forceVisible?clone.visible=!0:clone.visible=obj.determineVisible(),clone.visible&&(obj.updateMatrixWorld(),obj.ignoreMatrix||Utils3D.decompose(obj,clone))}_nuke.rtt=_rt,_nuke.render(),RenderStats.update("FXLayer"),_nuke.renderer.overridePreventShadows=!1,Renderer.CLEAR=oldClear},this.addPass=function(pass){_nuke&&_nuke.add(pass)},this.removePass=function(pass){_nuke&&_nuke.remove(pass)},this.setSize=function(width,height){_nuke&&(_rt.width==width&&_rt.height==height||(_this.events.unsub(Events.RESIZE,resizeHandler),_rt&&_rt.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr),_nuke.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr)))},this.setDPR=function(dpr){_nuke&&(_nuke.dpr=dpr,resizeHandler())},this.setResolution=function(res){_this.resolution=res,resizeHandler()},this.getObjects=function(){return _objects},this.useRT=function(rt){_rt=_this.rt=rt},this.getName=function(){return _this.name||_name},_parentNuke instanceof Nuke&&this.create(_parentNuke,_type),_parentNuke.isAppState){let config=_parentNuke;this.create(_this.parent.nuke||config.nuke,config),this.name=config.name}}),Namespace("FX"),Class(function FXScene(_parentNuke,_type,...rest){Inherit(this,Component);var _nuke,_rt,_rtPool,_showManualRenderWarning,_this=this,_scene=new Scene,_id=Utils.timestamp(),_objects=[],_renderTime=Render.TIME,_visible=!0;function releaseRT(){_rtPool&&_rt&&(_rtPool.putRT(_rt),_this.useRT(_rtPool.nullRT))}function resizeHandler(){_rt.setSize&&_rt.setSize(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr),_this.nuke.setSize(_rt.width,_rt.height),_this.width=_rt.width,_this.height=_rt.height}this.resolution=1,this.autoVisible=!0,this.enabled=!0,this.scene=_scene,this.renderShadows=!0,this.set("visible",v=>{_this.scene&&(_this.scene.visible=_visible=v,_this.onFXSceneVisibility?.(v))}),this.get("visible",_=>_visible),this.onInvisible=this.fxInvisible=function(){this.scene.visible&&(this.scene.visible=!1,_this.flag("needsOnVisible",!0)),releaseRT()},this._bindOnDestroy(releaseRT),this.onVisible=this.fxVisible=function(){_this.flag("needsOnVisible")&&(this.scene.visible=!0,_this.flag("needsOnVisible",!1)),_rtPool&&(_this.useRT(_rtPool.getRT()),resizeHandler())},this.create=function(nuke=World.NUKE,rt,options){_this.nuke||(rt instanceof RTPool&&(rt=(_rtPool=rt).nullRT),nuke instanceof RTPool?(options=rt,rt=(_rtPool=nuke).nullRT,nuke=World.NUKE):rt&&"object"==typeof rt?rt.isRT||(options=rt,rt=void 0):!nuke||nuke instanceof Nuke||(options=nuke,nuke=World.NUKE),options||(options={}),_this.rtFormat=options.format||Texture.RGBFormat,_this.rtType=options.type||Texture.UNSIGNED_BYTE,(options.vr||options.vrMode)&&(_this.vrRT=RenderManager.type==RenderManager.VR),options.parentNuke&&(nuke=options.parentNuke),(_this=this).scene=_scene,_this.nuke=_nuke=_this.initClass(Nuke,nuke.stage,{renderer:nuke.renderer,camera:nuke.camera,scene:_scene,dpr:nuke.dpr,format:options.format,vrRT:_this.vrRT,multisample:options.multisample,samplesAmount:options.samplesAmount}),options.customCompile&&(_this.customCompile=options.customCompile),_scene.nuke=_nuke,function initRT(rt,options={}){options.type==Texture.FLOAT&&(options.format=Texture.RGBAFormat,"ios"==Device.system.os&&(options.type=Texture.HALF_FLOAT,options.minFilter=Texture.NEAREST,options.magFilter=Texture.NEAREST));const RT=_this.nuke.useDrawBuffers&&options.multiRenderTarget?MultiRenderTarget:RenderTarget;_this.width=_nuke.stage.width*_this.resolution*_nuke.dpr,_this.height=_nuke.stage.height*_this.resolution*_nuke.dpr;let magFilter=Texture.LINEAR,minFilter=options.mipmaps?Texture.LINEAR_MIPMAP:Texture.LINEAR;_rt=rt||new RT(_this.width,_this.height,Object.assign({minFilter:minFilter,magFilter:magFilter,generateMipmaps:options.mipmaps||!1},options)),_nuke.rtt=_this.rt=_rt,_rt.fxscene=_this,_this.vrRT&&(_rt.vrRT=!0)}(rt,options),rt&&_this.flag("recycle_rt",!0),function addListeners(){_this.flag("recycle_rt")?_rtPool&&_this.events.sub(_rtPool,Events.RESIZE,e=>{_this.width=e.width,_this.height=e.height}):_this.events.sub(Events.RESIZE,resizeHandler)}(),FXScene.onCreate&&FXScene.onCreate(_this),options.manualRender&&(_this.manualRender=!0),_this.manualRender||FXScene.manualRender||(Hydra.LOCAL&&(_showManualRenderWarning=!0),_this.vrRT?_this.startRender(({view:view})=>{0!==view||_this.manualRender||FXScene.manualRender||_this.draw()},RenderManager.EYE_RENDER):_this.startRender(_=>{_this.manualRender||FXScene.manualRender||_this.draw()},nuke)))},this.onDestroy=this.fxDestroy=function(){_this.scene.destroy(),_this.flag("recycle_rt")?releaseRT():_rt&&_rt.destroy&&_rt.destroy()},this.setSize=function(width,height,exact){_nuke&&(exact||(width=width*_this.resolution*_nuke.dpr,height=height*_this.resolution*_nuke.dpr),_rt.width==width&&_rt.height==height||(_this.events.unsub(Events.RESIZE,resizeHandler),_this.width=width,_this.height=height,_rt&&_rt.setSize(_this.width,_this.height),_nuke.setSize(_this.width,_this.height)))},this.add=this.addObject=function(object){if(!object.shader)return;if(!object)return console.error("FXScene addObject undefined!");let clone=object.clone();for(object["clone_"+_id]=clone,_scene.add(clone),_objects.push(object),_this.customCompile&&(clone.shader.customCompile=_this.customCompile),object.shader._attachmentData={format:_this.rtFormat,type:_this.rtType,attachments:1};clone.children.length;)clone.remove(clone.children[0]);return clone},this.removeObject=function(object){_scene.remove(object["clone_"+_id]),_objects.remove(object),delete object["clone_"+_id]},this.setScissor=function(x,y,w,h,invert){if(null===x)return void(this.scissor=this.rt.scissor=null);let width=_rt.width,height=_rt.height;this.scissor||(this.scissor=new Vector4),this.scissor.x=x*width,this.scissor.y=invert?y*height:height-h*height-y*height,this.scissor.width=w*width,this.scissor.height=h*height,this.rt.scissor=this.scissor},this.render=this.draw=function(stage,camera){if(_this.preventRender)return;if(_this.isVrWorldMode)return void(_this.onBeforeRender&&_this.onBeforeRender());if(!_this.manualRender&&!FXScene.manualRender&&Render.TIME-_renderTime<1e3/Render.REFRESH_RATE/2)return void(_showManualRenderWarning&&(console.warn(`FXScene ${Utils.getConstructorName(_this)} rendering early (${Math.round(Render.TIME-_renderTime,3)}ms elapsed, expected ~${Math.round(1e3/Render.REFRESH_RATE,3)}ms. Set manualRender option if using own render loop.`),_showManualRenderWarning=!1));if(_renderTime=Render.TIME,_this.isVrSceneMode){let rt=World.NUKE.enabled&&World.NUKE.passes.length?World.NUKE.rttBuffer:void 0,autoClear=_nuke.renderer.autoClear;return _nuke.renderer.autoClear=!1,_nuke.renderer.clearDepth(rt),_this.onBeforeRender&&_this.onBeforeRender(),_nuke.renderer.render(_scene,_nuke.camera,rt),void(_nuke.renderer.autoClear=autoClear)}stage&&(_this.events.unsub(Events.RESIZE,resizeHandler),_this.nuke.stage=stage,_this.setSize(stage.width,stage.height)),camera&&(_this.nuke.camera=camera);let clearColor=null,alpha=1;_this.clearColor&&(clearColor=_nuke.renderer.getClearColor().getHex(),_nuke.renderer.setClearColor(_this.clearColor)),_this.clearAlpha>-1&&(alpha=_nuke.renderer.getClearAlpha(),_nuke.renderer.setClearAlpha(_this.clearAlpha)),_this.renderShadows||(_nuke.renderer.overridePreventShadows=!0);for(let i=_objects.length-1;i>-1;i--){let obj=_objects[i],clone=obj["clone_"+_id];_this.forceVisible||obj.cloneVisible?clone.visible="boolean"!=typeof clone.isVisible||clone.isVisible:clone.visible=obj.determineVisible(),clone.visible&&(obj.updateMatrixWorld(!1===obj.visible||void 0),obj.ignoreMatrix||(Utils3D.decompose(obj,clone),clone.overrideScale&&clone.scale.setScalar(clone.overrideScale)))}_this.preventRTDraw||(RenderStats.update("FXScene",1,_this),_this.onBeforeRender&&_this.onBeforeRender(),_nuke.rtt=_rt,_nuke.render()),_nuke.renderer.overridePreventShadows=!1,_this.clearColor&&_nuke.renderer.setClearColor(clearColor),_this.clearAlpha>-1&&_nuke.renderer.setClearAlpha(_this.clearAlpha),RenderManager.fire(_this)},this.setDPR=function(dpr){return _nuke?(_nuke.dpr=dpr,resizeHandler(),_this):_this},this.addPass=function(pass){_nuke&&_nuke.add(pass)},this.removePass=function(pass){_nuke&&_nuke.remove(pass)},this.setResolution=function(res){return _this.resolution=res,_rt.vrRT&&(_rt.vrRT=res),resizeHandler(),this},this.useRT=function(rt){_rt=_this.rt=rt,_this.vrRT&&(rt.vrRT=!0),_rt.fxscene=_this},this.upload=function(){_rt&&_rt.upload()},this.useCamera=function(camera){_this.nuke&&(_this.nuke.camera=camera.camera||camera)},this.useScene=function(scene){_this.nuke.scene=scene},this.vrWorldMode=function(){_this.isVrWorldMode=!0,_this.group=new Group;for(let i=0;i<this.scene.children.length;i++)this.group.add(this.scene.children[i]);_scene=_this.scene=_this.group,World.SCENE.add(_this.group)},this.vrSceneMode=function(){_this.isVrSceneMode=!0,World.NUKE.autoClear=!1,RenderManager.renderer.autoClear=!1},this.createDepthTexture=function(useRTTBuffer){return _this.depthTexture||(_this.nuke.passes.length||useRTTBuffer?(_this.nuke.rttBuffer.createDepthTexture(),_this.depthTexture=_this.nuke.rttBuffer.depth):(_this.rt.createDepthTexture(),_this.depthTexture=_this.rt.depth)),_this.depthTexture},_parentNuke instanceof Nuke&&this.create(_parentNuke,_type,...rest)}),Class(function FXSceneCompositor(_shader,_options={}){Inherit(this,Object3D);const _this=this;var _basicShader,_shaders=new Map;function decorateShader(shader){shader.addUniforms({tFrom:{value:null,ignoreUIL:!0},tTo:{value:null,ignoreUIL:!0},uTransition:{value:0}})}function loop(){_this.mesh.shader=_shader.uniforms.uTransition.value>0?_shader:_basicShader,_shader.uniforms.uTransition.value>=1&&(_this.mesh.shader=_basicShader,_basicShader.set("tMap",_shader.get("tTo")),_shader.set("uTransition",0))}!function initOptions(){(null===_options||_options instanceof Texture||_options.texture||_options.rt&&_options.rt.texture)&&(_options={startTexture:_options})}(),decorateShader(_shader),function initMesh(){let uniforms={tMap:{value:_options.startTexture||null}};_options.basicShader?(_basicShader=_options.basicShader).addUniforms(uniforms):_basicShader=_this.initClass(Shader,"ScreenQuad",uniforms),_this.mesh=new Mesh(World.QUAD,_basicShader),_this.mesh.frustumCulled=!1,_this.add(_this.mesh)}(),function initHotReload(){_this.events.sub(Component.HMR_INSTANCE_RELOADED,({oldInstance:oldInstance,newInstance:newInstance})=>{newInstance!==_basicShader.get("tMap")&&newInstance!==_shader.get("tTo")||(newInstance.visible=!0)})}(),_shaders.set("default",_shader),_this.startRender(loop),this.useShader=function(shader){let nextShader=_shaders.get(shader)||_shaders.get("default");nextShader.set("tFrom",_shader.get("tFrom")),nextShader.set("tTo",_shader.get("tTo")),_shader=nextShader,_shader.onActivate?.()},this.addShader=function(shaderName){let shader=_this.initClass(Shader,shaderName,_options.uniforms);return decorateShader(shader),_shaders.set(shaderName,shader),shader},this.useBasicShader=function(shader){_basicShader.copyUniformsTo(shader,!0),_basicShader=shader},this.swap=function(showTransition){showTransition?(_this.mesh.shader=_shader,_shader.set("tFrom",_basicShader.get("tMap")),_shader.set("tTo",_basicShader.get("tMap"))):(_basicShader.set("tMap",_shader.get("tTo")),_this.mesh.shader=_basicShader,_shader.set("tFrom",_basicShader.get("tMap")))},this.set("manual",v=>{v?_this.stopRender(loop):_this.startRender(loop)}),this.transition=async function(texture,time,ease,delay=0){_this.parent.lock&&_this.parent.lock();let from=_shader.get("tFrom");_shader.set("tTo",texture),texture.visible=!0,from||"number"!=typeof delay?("number"!=typeof delay&&(await delay,delay=0),await _shader.tween("uTransition",1,time,ease,delay).onUpdate(_=>{_shader.linkTweens&&_shader.linkTweens.forEach(tween=>{tween.seek(_shader.get("uTransition"))})}).promise()):_shader.set("uTransition",1),from&&(from.visible=!1),_shader.set("tFrom",texture),_this.parent.unlock&&_this.parent.unlock()},this.interpolate=function(from,to,blend){_this.mesh.shader=_shader,_shader.set("tFrom",from),_shader.set("tTo",to),_shader.set("uTransition",blend)},this.test=function(shader){_this.manual=!0,_this.useShader(shader),_this.swap(!0)}}),Class(function BlitPass(_forceNuke){Inherit(this,NukePass);this.uniforms={},this.init("BlitPass"),_forceNuke||(this.blitFramebuffer=!0)}),Class(function Nuke(_stage,_params){Inherit(this,Component);var _width,_height,_nukeMesh,_this=this,_finalTexture={texture:Utils3D.getEmptyTexture()};_params.renderer||console.error("Nuke :: Must define renderer"),_this.stage=_stage,_this.renderer=_params.renderer,_this.camera=_params.camera,_this.scene=_params.scene,_this.rtt=_params.rtt,_this.enabled=0!=_params.enabled,_this.passes=_params.passes||[],_this.format=_params.format||Texture.RGBFormat,_this.useDrawBuffers=!Utils.query("noDrawBuffers")&&!Nuke.NO_DRAWBUFFERS&&(void 0!==_params.useDrawBuffers?_params.useDrawBuffers:!(Renderer.type!=Renderer.WEBGL2&&!window.Metal));var _rttPing,_rttPong,_rttBuffer,_dpr=_params.dpr||1,_drawBuffers=[],_enabledPasses=[],_multisample=_params.multisample||!1,_samplesAmount=_params.samplesAmount||4;function resizeHandler(){var width=_this.stage.width*_dpr,height=_this.stage.height*_dpr;_rttPing.setSize(width,height),_rttPong.setSize(width,height),_rttBuffer.setSize(width,height),Nuke.renameRT(_width,_height,width,height,!1,1,_this.format,!1,_samplesAmount),Nuke.renameRT(_width,_height,width,height,!1,2,_this.format,!1,_samplesAmount),Nuke.renameRT(_width,_height,width,height,_this.useDrawBuffers,-1,_this.format,_multisample,_samplesAmount),_width=width,_height=height}_this.scene.nuke=_this,function initDefaultPass(){if(Nuke.defaultPass)return;let upload=(Nuke.defaultPass=new BlitPass).upload;Nuke.defaultPass.upload=function(){upload.apply(this,arguments),Nuke.defaultPass.uploaded=!0}}(),function initNuke(){let width=_this.stage.width*_dpr,height=_this.stage.height*_dpr;_rttPing=Nuke.getRT(width,height,!1,1,_this.format,!1,_samplesAmount),_rttPong=Nuke.getRT(width,height,!1,2,_this.format,!1,_samplesAmount),_rttBuffer=Nuke.getRT(width,height,_this.useDrawBuffers,-1,_this.format,_multisample,_samplesAmount),(_nukeMesh=new Mesh(World.QUAD,null)).frustumCulled=!1,_nukeMesh.noMatrices=!0,_nukeMesh.transient=!0,_width=width,_height=height,_params.vrRT&&(_this.vrRT=!0,_rttBuffer.vrRT=!0)}(),function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}(),_this.forceResize=resizeHandler,_this.onBeforeShaderCompile=function(obj){if(!obj)return;let shader=obj.shader;if(!(shader&&shader.fragmentShader&&_this.useDrawBuffers&&_drawBuffers.length))return;if(shader.fragmentShader.includes("layout(location"))return;const WEBGL2=Renderer.type==Renderer.WEBGL2;let matched=!1;if(_drawBuffers.forEach((t,i)=>{let name=t.fxLayer.getName(),keyExpr=WEBGL2?new RegExp(`\\b${name}\\s*=`):new RegExp(`\\bgl_FragData\\[${i+1}\\]\\s*=`),defaultOutput=t.fxLayer.defaultOutputColor||"vec4(0.0)";if("Color"===defaultOutput&&(defaultOutput="tmpFragColor"),!keyExpr.test(shader.fragmentShader)&&_this.useDrawBuffers){let fs=shader.fragmentShader;if(!fs.includes(`#drawbuffer ${name} gl_FragColor`)){let idx=fs.lastIndexOf("}");fs=fs.slice(0,idx)+`#drawbuffer ${name} gl_FragColor = ${defaultOutput};\n`+fs.slice(idx),shader.fragmentShader=fs}t.fxLayer.add(obj),matched=!0}}),!(WEBGL2?/\bColor\s*=/:/\bgl_FragData\[0\]\s*=/).test(shader.fragmentShader)){let fs=shader.fragmentShader;if(!fs.includes("layout(location=0) out vec4 reflectionsData")){WEBGL2||(fs="#extension GL_EXT_draw_buffers : require\n"+fs),fs=fs.split("void main() {"),fs=fs[0]+"void main() {\nvec4 tmpFragColor;\n"+fs[1],fs=fs.replace(/gl_FragColor/g,"tmpFragColor");let idx=fs.lastIndexOf("}");fs=matched?WEBGL2?fs.slice(0,idx)+"Color = tmpFragColor;\n"+fs.slice(idx):fs.slice(0,idx)+"gl_FragData[0] = tmpFragColor;\n"+fs.slice(idx):fs.slice(0,idx)+"#drawbuffer Color gl_FragColor = tmpFragColor;\n"+fs.slice(idx)}shader.fragmentShader=fs}shader.onBeforePrecompilePromise.resolve()},_this.add=function(pass,index){"number"!=typeof index?_this.passes.push(pass):_this.passes.splice(index,0,pass)},_this.remove=function(pass){"number"==typeof pass?_this.passes.splice(pass):_this.passes.remove(pass)},_this.render=function(directCallback){if(_this.paused)return;RenderStats.update("Nuke"),RenderManager.fire(_this),_this.events.fire(Nuke.RENDER,_this,!0),_this.onBeforeRender&&_this.onBeforeRender();let count=_this.passes.length;_enabledPasses.length=0;for(let i=0;i<count;i++){let pass=_this.passes[i];pass.disabled||_enabledPasses.push(pass)}if(_this.enabled&&0===_enabledPasses.length&&!_this.rtt&&(_dpr!==Device.pixelRatio||_multisample)&&Nuke.defaultPass&&_enabledPasses.push(Nuke.defaultPass),_this.enabled&&0===_enabledPasses.length&&_this.useDrawBuffers&&_drawBuffers.length&&Nuke.defaultPass&&_enabledPasses.push(Nuke.defaultPass),!_this.enabled||!_enabledPasses.length){let autoClear=_this.renderer.autoClear;return 0==_this.autoClear&&(_this.renderer.autoClear=!1),_this.renderer.render(_this.scene,_this.camera,_this.rtt,null,directCallback),_this.onBeforeProcess&&_this.onBeforeProcess(),_this.events.fire(Nuke.BEFORE_PASSES,_this,!0),_this.events.fire(Nuke.BEFORE_POST_RENDER,_this,!0),_this.postRender&&_this.postRender(),_this.events.fire(Nuke.POST_RENDER,_this,!0),void(0==_this.autoClear&&(_this.renderer.autoClear=autoClear,_this.renderer.clearColor()))}RenderStats.update("NukePass",_enabledPasses.length),_this.hasRendered=!0,_this.onBeforeProcess&&_this.onBeforeProcess();let autoClear=_this.renderer.autoClear;0==_this.autoClear&&(_this.renderer.autoClear=!1),_this.parent.scissor&&(_rttBuffer.scissor=_this.parent.scissor),_this.preventNewRender||_this.renderer.render(_this.scene,_this.camera,_rttBuffer),0==_this.autoClear&&(_this.renderer.autoClear=autoClear),_this.onBeforePasses&&_this.onBeforePasses(_rttBuffer);let pingPong=!0,skipMultisample=_this.rtt&&_this.rtt.multisample;skipMultisample&&(_this.rtt.multisample=!1),count=_enabledPasses.length,_this.events.fire(Nuke.BEFORE_PASSES,_this,!0);for(var i=0;i<count;i++){let shader=_enabledPasses[i].pass,inTexture=0===i?_rttBuffer.texture:pingPong?_rttPing.texture:_rttPong.texture,outTexture=pingPong?_rttPong:_rttPing;i===count-1&&(outTexture=_this.rtt),_nukeMesh.shader=shader,_nukeMesh.shader.depthTest=!1,_nukeMesh.shader.depthWrite=!1,_nukeMesh.shader.uniforms.tDiffuse.value=inTexture,_this.parent.scissor&&(outTexture.scissor=_this.parent.scissor),_this.renderer.renderSingle(_nukeMesh,_this.camera||World.CAMERA,outTexture,i===count-1?directCallback:null),_enabledPasses[i]?.onRenderCallBack?.(),pingPong=!pingPong,outTexture&&(_finalTexture.texture=outTexture.texture)}skipMultisample&&(_this.rtt.multisample=!0),_this.events.fire(Nuke.BEFORE_POST_RENDER,_this,!0),_this.postRender&&_this.postRender(),_this.events.fire(Nuke.POST_RENDER,_this,!0),0==_this.autoClear&&_this.renderer.clearColor(_rttBuffer)},_this.setSize=function(width,height){width==_width&&height==_height||(_width=width,_height=height,resizeHandler(),_this.events.unsub(Events.RESIZE,resizeHandler))},_this.attachDrawBuffer=function(texture){if(_this.hasRendered&&console.warn("Attempt to attach draw buffer after first render! Create FXLayer instance before first render."),_drawBuffers.push(texture),_rttBuffer&&_rttBuffer.attachments){_rttBuffer.attachments=[_this.rtt&&_this.rtt.attachments?_this.rtt.attachments[0]:_rttBuffer.attachments[0]];for(let i=0;i<_drawBuffers.length;i++)_rttBuffer.attachments.push(_drawBuffers[i]),_this.rtt&&_this.rtt.attachments&&_this.rtt.attachments.push(_drawBuffers[i])}return _drawBuffers.length},_this.upload=function(){_this.passes.length&&_this.enabled&&(_rttPing.upload(),_rttPong.upload(),_rttBuffer.upload()),_rttBuffer.depth&&_rttBuffer.depth.upload(),_this.rtt&&_this.rtt.upload()},_this.set("dpr",function(v){_dpr=v,resizeHandler()}),_this.get("dpr",function(){return _dpr}),_this.get("output",function(){return _nukeMesh.shader&&_nukeMesh.shader.uniforms?_nukeMesh.shader.uniforms.tDiffuse.value:null}),_this.get("finalTexture",_=>_finalTexture),_this.get("rttBuffer",function(){return _rttBuffer}),this.set("rttBuffer",function(v){_rttBuffer=v}),_this.get("prevFrameRT",function(){return _rttBuffer&&_rttBuffer.texture?_rttBuffer.texture:null}),_this.get("nukeScene",function(){return _nukeScene}),_this.get("ping",function(){return _rttPing}),_this.get("pong",function(){return _rttPong}),_this.get("attachments",function(){return _rttBuffer.attachments?_rttBuffer.attachments.length:0}),_this.disable=function(){_this.enabled=!1,_this.passes.forEach(pass=>{pass.enabled=!1})},this.onDestroy=function(){!_this.useDrawBuffers&&Nuke.recyclePingPong||_rttBuffer.destroy(),Nuke.recyclePingPong||(_rttPing.destroy(),_rttPong.destroy())},this.clearMemory=function(){_rttBuffer.destroy(),_rttPing.destroy(),_rttPong.destroy()}},function(){Nuke.RENDER="nuke_render",Nuke.BEFORE_PASSES="nuke_before_passes",Nuke.BEFORE_POST_RENDER="nuke_before_post_render",Nuke.POST_RENDER="nuke_post_render";var _rts={};Nuke.getRT=function(width,height,multi,index,format,multisample,samplesAmount){let rt,exists=_rts[`${width}_${height}_${multi}_${index}_${format}_${multisample}_${samplesAmount}`];return exists||(rt=multi?Utils3D.createMultiRT(width,height,void 0,format,multisample,samplesAmount):Utils3D.createRT(width,height,void 0,format,multisample,samplesAmount),Nuke.recyclePingPong&&!multi&&(_rts[`${width}_${height}_${multi}_${index}_${format}_${multisample}_${samplesAmount}`]=rt),rt)},Nuke.renameRT=function(prevWidth,prevHeight,width,height,multi,index,format,multisample,samplesAmount){_rts[`${width}_${height}_${multi}_${index}_${format}_${multisample}_${samplesAmount}`]=_rts[`${prevWidth}_${prevHeight}_${multi}_${index}_${format}_${multisample}_${samplesAmount}`]}}),Class(function NukePass(_fs,_uniforms,_pass){Inherit(this,Component);var _this=this;if("object"==typeof _fs){let shader=_fs.shader;_uniforms=_fs.uniforms,_fs=shader}this.UILPrefix="string"==typeof _fs?_fs:Utils.getConstructorName(_fs),this.init=function(fs,vs){if(_this.pass)return;_this=this;fs||this.constructor.toString().match(/function ([^\(]+)/)[1],Array.isArray(fs)&&fs.join("");if(_this.uniforms=_uniforms||_this.uniforms||{},_this.uniforms.tDiffuse={type:"t",value:null,ignoreUIL:!0},_this.uniforms.unique&&(_this.UILPrefix+="_"+_this.uniforms.unique+"_"),window.UILStorage)for(let key in _this.uniforms)"unique"!==key&&(_this.uniforms[key]=UILStorage.parse(_this.UILPrefix+key,_this.uniforms[key].value)||_this.uniforms[key]);_this.pass=_this.initClass(Shader,vs||"NukePass",fs,Utils.mergeObject(_this.uniforms,{precision:"high"}),(code,type)=>"fs"==type?function prefix(code){if(!code)throw`No shader ${_fs} found`;let pre="";return code.includes("uniform sampler2D tDiffuse")||(pre+="uniform sampler2D tDiffuse;\n",pre+="varying vec2 vUv;\n"),pre+code}(code):code),_this.uniforms=_this.pass.uniforms},this.set=function(key,value){TweenManager.clearTween(_this.uniforms[key]),_this.uniforms[key].value=value},this.get=function(key){return void 0===_this.uniforms[key]?null:_this.uniforms[key].value},this.tween=function(key,value,time,ease,delay,callback,update){return tween(_this.uniforms[key],{value:value},time,ease,delay,callback,update)},this.clone=function(){return _this.pass||_this.init(_fs),new NukePass(null,null,_this.pass.clone())},this.upload=function(){_this.pass.upload()},this.addUniforms=function(obj){for(let key in obj)_this.uniforms[key]=obj[key]},"string"==typeof _fs?_this.init(_fs):_pass&&(_this.pass=_pass,_this.uniforms=_pass.uniforms)}),Class(function Raycaster(_camera){Inherit(this,Component);const _this=this;let _mouse=new Vector3,_raycaster=new RayManager;function ascSort(a,b){return a.distance-b.distance}function intersectObject(object,raycaster,intersects,recursive){let obj=object;for(;obj&&_this.testVisibility;){if(!1===obj.visible&&!obj.forceRayVisible&&!1!==obj.testVisibility)return;obj=obj.parent}if(object.raycast&&(object.raycast(raycaster,intersects),!0===recursive)){let children=object.children;for(let i=0,l=children.length;i<l;i++)intersectObject(children[i],raycaster,intersects,!0)}}function intersect(objects){Array.isArray(objects)||(objects=[objects]);let intersects=[];return objects.forEach(object=>{intersectObject(object,_raycaster,intersects,!1)}),intersects.sort(ascSort),intersects}this.testVisibility=!0,this.set("camera",function(camera){_camera=camera}),this.set("pointsThreshold",function(value){_raycaster.params.Points.threshold=value}),this.get("ray",()=>_raycaster.ray),this.checkHit=function(objects,mouse,rect=Stage){return mouse=mouse||Mouse,_mouse.x=mouse.x/rect.width*2-1,_mouse.y=-mouse.y/rect.height*2+1,_raycaster.setFromCamera(_mouse,_camera),intersect(objects)},this.checkFromValues=function(objects,origin,direction){return _raycaster.set(origin,direction,0,Number.POSITIVE_INFINITY),intersect(objects)}},_=>{var _ray,_map=new WeakMap;Raycaster.checkHit=function(objects,mouse){return _ray||(_ray=new Raycaster(World.CAMERA)),_ray.checkHit(objects,mouse)},Raycaster.checkFromValues=function(objects,origin,direction){return _ray||(_ray=new Raycaster(World.CAMERA)),_ray.checkFromValues(objects,origin,direction)},Raycaster.find=function(camera){if(!_map.has(camera)){let ray=new Raycaster(camera);_map.set(camera,ray)}return _map.get(camera)}}),Class(function ScreenProjection(_camera){Inherit(this,Component);var _v3=new Vector3,_v32=new Vector3,_value=new Vector3;_camera=_camera.camera||_camera,this.set("camera",function(v){_camera=v.camera||v}),this.get("camera",_=>_camera),this.unproject=function(mouse,rect=Stage,distance=1){"number"==typeof rect&&(distance=rect,rect=Stage),_v3.set(mouse.x/rect.width*2-1,-mouse.y/rect.height*2+1,.5),_v3.unproject(_camera);let pos=_camera.getWorldPosition();return _v3.sub(pos).normalize().multiplyScalar(distance),_value.copy(pos).add(_v3),_value},this.project=function(pos,screen){return screen=screen||Stage,pos instanceof Base3D?(pos.updateMatrixWorld(),_v32.set(0,0,0).setFromMatrixPosition(pos.matrixWorld)):_v32.copy(pos),_v32.project(_camera),_v32.x=(_v32.x+1)/2*screen.width,_v32.y=-(_v32.y-1)/2*screen.height,_v32}},_=>{var _screen,_map=new WeakMap;ScreenProjection.unproject=function(mouse,distance){return _screen||(_screen=new ScreenProjection(World.CAMERA)),_screen.unproject(mouse,distance)},ScreenProjection.project=function(pos,screen){return _screen||(_screen=new ScreenProjection(World.CAMERA)),_screen.project(pos,screen)},ScreenProjection.find=function(camera){if(!_map.has(camera)){let projection=new ScreenProjection(camera);_map.set(camera,projection)}return _map.get(camera)}}),Class(function Object3D(){Inherit(this,Component);var _this=this,_visible=!0;this.__element=!0,this.group=new Group,this.group.classRef=this,this.add=function(child){this.group.add(child.group||child)},this.remove=function(child){child&&this.group.remove(child.group||child)},this.onDestroy=function(){this.group.destroy(),this.group.classRef=null},this.set("visible",v=>_this.group.visible=_visible=v),this.get("visible",_=>_visible)}),Class(function Utils3D(){const _this=this;var _emptyTexture,_q,_v3,_v3b,_v3c,_m4,_v4,_supportsKtx1,_textures={},_restorable={},_dominantColors={};function getTexture(key,params,loadTexture){if(!Device.graphics.webgl&&!window.AURA){let texture=params.isTexture3D?new Texture3D:new Texture;return texture.promise=Promise.resolve(),texture.dimensions=params.isTexture3D?{width:0,height:0,depth:0}:{width:0,height:0},texture}let restorable=_restorable[key];if(restorable&&(restorable=restorable.deref(),delete _restorable[key]),restorable)restorable.restore();else if(_textures[key])_textures[key].exists++;else{let texture=params.isTexture3D?new Texture3D:new Texture;params.isCubeLUT&&(texture.isCubeLUT=!0),texture.exists=1,texture.loaded=!1,texture.promise=Promise.create(),texture._destroy=texture.destroy,texture.destroy=function(force){(0!==texture.exists||force)&&(texture.exists=Math.max(texture.exists-1,0),!force&&(texture.forcePersist||texture.exists>0)||(texture._image||texture._gl||_textures[key])&&(delete _textures[key],delete _dominantColors[key],RenderCount.remove(`tex_${texture?.dimensions?.width}_${texture?.dimensions?.height}`),RenderCount.remove("tex_"+(texture.compressed?"compressed":"uncompressed")),_restorable[key]=new WeakRef(this),this._destroy()))},_textures[key]=texture,!1===params.premultiplyAlpha&&(texture.premultiplyAlpha=!1),_this.onTextureCreated&&_this.onTextureCreated(texture);let doLoadTexture=async()=>{try{await loadTexture(texture),texture.loaded=!0,texture.needsReupload=!0,RenderCount.add(`tex_${texture.dimensions.width}_${texture.dimensions.height}`),RenderCount.add("tex_"+(texture.compressed?"compressed":"uncompressed")),texture.onload&&(texture.onload(),texture.onload=null),texture.promise.resolve()}catch(e){texture.promise.reject(e)}};doLoadTexture(texture),texture.restore=function(){delete _restorable[key],texture.exists++,_textures[key]||(texture.promise=Promise.create(),texture.loaded=texture.needsReupload=!1,_textures[key]=texture,texture.dominantColors&&!_dominantColors[key]&&(_dominantColors[key]=texture.dominantColors),doLoadTexture(texture))}}return _textures[key]}async function loadTextureSource(texture,path,params){return processLoadedTextureSource(texture,await ImageDecoder.decode(path,params))}async function processLoadedTextureSource(texture,imgBmp){return imgBmp.crossOrigin="anonymous",texture.dimensions={width:imgBmp.width,height:imgBmp.height},texture.loaded=!0,texture.needsReupload=!0,texture.compressed&&!imgBmp.compressedData&&(texture.compressed=!1),World.RENDERER.type===Renderer.WEBGL2||Math.isPowerOf2(imgBmp.width,imgBmp.height)||(texture.minFilter=Texture.LINEAR,texture.generateMipmaps=!1),imgBmp}function parseTexturePath(path){if(path.includes("://")){let guard=path.split("://");guard[1]=guard[1].replace(/\/\//g,"/"),path=guard.join("://")}else path=path.replace(/\/\//g,"/");let compressed,compressedIdentifier,cacheBust;if(({compressed:compressed,compressedIdentifier:compressedIdentifier,path:path}=parseCompressed(path)),window.URLSearchParams){if(path.includes("?")){let[withoutQuery,query]=path.split("?"),params=new URLSearchParams(query);for(const[key,value]of params.entries()){let check=key;key.includes("-compressedKtx")&&(check=key.substring(0,key.indexOf("-compressedKtx"))),Number.isInteger(Number(check))&&Number(check)>0&&""===value&&(params.delete(key),check!==key&&compressed&&(withoutQuery+=compressedIdentifier),cacheBust=!0)}cacheBust&&(path=withoutQuery,query=params.toString(),query&&(path+="?"+query))}}else path.includes("?")&&(cacheBust=!0,path=path.split("?")[0]);Hydra.LOCAL||(cacheBust=!1);let imgPath=path;return cacheBust&&(imgPath+=(imgPath.includes("?")?"&":"?")+Date.now()),compressed&&!imgPath.includes("compressed")&&(imgPath+=compressedIdentifier),{plainPath:path,imgPath:imgPath,compressed:compressed}}function parseCompressed(path){let compressedIdentifier=/-compressedKtx2?/.exec(path)?.[0],compressed=!1;compressedIdentifier&&(Utils.query("noKtx")||(compressedIdentifier.endsWith("2")?"undefined"!=typeof Ktx2Transcoder&&(compressed="ktx2"):compressed="ktx1"),path=path.replace(compressedIdentifier,""));let requiresKtx=!1;return/\.ktx2(?:\?|#|$)/.test(path)&&(compressed="ktx2",compressedIdentifier="",requiresKtx=!0),{compressed:compressed,compressedIdentifier:compressedIdentifier,path:path,requiresKtx:requiresKtx}}function splitCubemapPath(url){let path=url.replace(/-compressedKtx2?/,"").split(/[#?]/)[0],match=/(\d+)(?!.*\d+)/.exec(path);if(!match)throw new Error("Cubemap texture path must include a numeric pattern");let prefix=url.substring(0,match.index),pattern=match[1];return{prefix:prefix,pattern:pattern,suffix:url.substring(match.index+pattern.length),start:+pattern}}function getCubemapFacePaths(pathinfo){let padChar,{prefix:prefix,pattern:pattern,suffix:suffix,start:start}=pathinfo;return pattern.length>String(start).length&&(padChar=pattern.charAt(0)),Array.from(Array(6).keys(),i=>{let n=String(start+i);return padChar&&(n=n.padStart(pattern.length,padChar)),`${prefix}${n}${suffix}`})}async function doFindDominantColors(texOrImageOrPath,numColors){let image;if(texOrImageOrPath.isTexture)if(texOrImageOrPath.image){if(texOrImageOrPath.image.compressedData&&0===texOrImageOrPath.image.compressedData.length){let{path:path,...params}=texOrImageOrPath.decodeParams;params.hintUsingPixelData=!0,image=await ImageDecoder.decode(path,params)}}else image=texOrImageOrPath.src;return image=image||texOrImageOrPath.image||texOrImageOrPath,"string"==typeof image&&(image=await Assets.decodeImage(image)),ImageDecoder.parseColors(image,numColors)}window.Vec2=window.Vector2,window.Vec3=window.Vector3,this.localDebug=window.Hydra&&Hydra.LOCAL,async function(){await Hydra.ready();let threads=Thread.shared(!0);for(let i=0;i<threads.array.length;i++)_this.loadEngineOnThread(threads.array[i])}(),this.decompose=function(local,world){local.decomposeCache||(local.decomposeCache={position:new Vector3,quaternion:new Quaternion,scale:new Vector3}),local.decomposeDirty&&(local.matrixWorld.decompose(local.decomposeCache.position,local.decomposeCache.quaternion,local.decomposeCache.scale),local.decomposeDirty=!1),world.position.copy(local.decomposeCache.position),world.quaternion.copy(local.decomposeCache.quaternion),world.scale.copy(local.decomposeCache.scale)},this.createDebug=function(size=1,color){return new Mesh(new IcosahedronGeometry(size,1),_this.getTestShader(color))},this.getTestShader=function(color){return color?new Shader("ColorMaterial",{color:{value:color instanceof Color?color:new Color(color)},alpha:{value:1}}):new Shader("TestMaterial")},this.createMultiRT=function(width,height,type,format,multisample=!1,samplesAmount=4){let rt=new MultiRenderTarget(width,height,{minFilter:Texture.LINEAR,magFilter:Texture.LINEAR,format:format||Texture.RGBFormat,type:type,multisample:multisample,samplesAmount:samplesAmount});return rt.texture.generateMipmaps=!1,rt},this.createRT=function(width,height,type,format,multisample=!1,samplesAmount=4){let rt=new RenderTarget(width,height,{minFilter:Texture.LINEAR,magFilter:Texture.LINEAR,format:format||Texture.RGBFormat,type:type,multisample:multisample,samplesAmount:samplesAmount});return rt.texture.generateMipmaps=!1,rt},this.getFloatType=function(){return"android"==Device.system.os?Texture.FLOAT:Texture.HALF_FLOAT},this.findNuke=function(obj){if(!obj)return;let p=obj.parent;for(;p;){if(p.nuke)return p.nuke;p=p.parent}for(p=obj.parent;p;){if(p.nuke)return p.nuke;p=p.group?p.group._parent:p.parent||p._parent}for(p=obj._parent;p;){if(p.nuke)return p.nuke;p=p._parent}return World.NUKE},this.getTexture=function(path,params={}){let key,imgPath,plainPath,compressed,loadSource=loadTextureSource;if(params.mergeKtx2TextureArrays){if(!Array.isArray(path))throw new Error("path must be an array");let parsed=path.map(parseTexturePath);plainPath=parsed[0].plainPath,imgPath=parsed.map(p=>p.imgPath),compressed=!0,key=`tx[]:${parsed.map(({plainPath:plainPath})=>plainPath).join("|")}`,loadSource=async function(texture,paths,params){return processLoadedTextureSource(texture,await ImageDecoder.decodeAndMergeTextureArrays(paths,params))}}else({imgPath:imgPath,plainPath:plainPath,compressed:compressed}=parseTexturePath(path)),key=plainPath;let texture=getTexture(key,params,async texture=>{texture.compressed=compressed,texture.format=plainPath.match(/\.jpe?g/)?Texture.RGBFormat:Texture.RGBAFormat,texture.src=plainPath,texture.decodeParams={path:imgPath,...params};let imgBmp=await loadSource(texture,imgPath,params);texture.image=imgBmp,imgBmp.sizes&&1===imgBmp.sizes.length&&(texture.minFilter=Texture.LINEAR),imgBmp.compressedData&&imgBmp.layers>1&&(texture.isTextureArray=!0);let _onUpdate=texture.onUpdate;texture.onUpdate=function(){!params.preserveData&&imgBmp.close&&(imgBmp.close(),texture.image=null),texture.onUpdate=_onUpdate||null,texture.onUpdate&&texture.onUpdate()}});return texture.promise.then(_=>{params.findDominantColors&&"number"===(params.findDominantColors,!1)&&(params.findDominantColors=4),params.findDominantColors&&_this.findDominantColors(texture,params.findDominantColors)},()=>{}),texture},this.getCubeLUT=function(path,params){let{imgPath:imgPath,plainPath:plainPath}=parseTexturePath(path);return params={...params,isTexture3D:!0,isCubeLUT:!0},getTexture(plainPath,params,async texture=>{let{imgBmp:imgBmp,cubesize:cubesize}=await function loadCubeLUTSource(path,params){let promise=Promise.create(),{compressed:compressed,compressedIdentifier:compressedIdentifier,newpath:newpath,requiresKtx:requiresKtx}=parseCompressed(path);return compressed?ImageDecoder.decode(path,params).then(result=>{promise.resolve({imgBmp:result.compressedData[0],cubesize:result.width})}).catch(e=>{promise.reject(e)}):ImageDecoder.decodeCubeLUT(path,params).then(result=>{promise.resolve({imgBmp:result.imgBmp,cubesize:result.cubesize})}),promise}(imgPath,params);texture.format=Texture.RGBAFormat,texture.image=imgBmp,texture.src=plainPath,texture.minFilter=texture.magFilter=Texture.LINEAR,texture.type=Texture.UNSIGNED_BYTE,texture.width=texture.height=texture.depth=cubesize,texture.dimensions={width:cubesize,height:cubesize,depth:cubesize},texture.generateMipmaps=!1,texture.onUpdate=function(){!params.preserveData&&imgBmp.close&&(imgBmp.close(),texture.image=null),texture.onUpdate=null}})},this.getCubeTexture=function(paths,params={}){let parsed=(paths=function getCubePaths(url){if(Array.isArray(url))return url;let{compressed:compressed,compressedIdentifier:compressedIdentifier,path:path,requiresKtx:requiresKtx}=parseCompressed(url);if(requiresKtx)return[path];"ktx1"===compressed&&(void 0===_supportsKtx1&&(_supportsKtx1=!!(Renderer.extensions.s3tc||Renderer.extensions.etc1||Renderer.extensions.pvrtc||Renderer.extensions.astc)),_supportsKtx1||(compressed=!1));!compressed&&compressedIdentifier&&(url=url.replace(compressedIdentifier,""));let info=splitCubemapPath(url);if(compressed)return[`${info.prefix}${info.suffix}`];return getCubemapFacePaths(info)}(paths)).map(parseTexturePath);return getTexture(`cube:${parsed.map(({plainPath:plainPath})=>plainPath).join("|")}`,params,async texture=>{texture.cube=await Promise.all(parsed.map(({imgPath:imgPath,compressed:compressed})=>(texture.compressed=compressed,texture.format=imgPath.match(/\.jpe?g/)?Texture.RGBFormat:Texture.RGBAFormat,loadTextureSource(texture,imgPath,params)))),texture.compressed||1!==texture.cube.length||(texture.cube=[...Array(6).keys()].map(_=>texture.cube[0])),texture.compressed&&1===texture.cube[0].sizes.length&&(texture.minFilter=Texture.LINEAR),texture.onUpdate=function(){params.preserveData||texture.cube.forEach((imgBmp,i)=>{imgBmp.close&&(imgBmp.close(),texture.cube[i]=null)}),texture.onUpdate=null}})},this.splitCubemapPath=splitCubemapPath,this.getCubemapFacePaths=getCubemapFacePaths,this.getLookupTexture=function(path){let texture=_this.getTexture(path);return texture.minFilter=texture.magFilter=Texture.NEAREST,texture.generateMipmaps=!1,texture},this.clearTextureCache=function(path,force){if(path){let key=parseTexturePath(path).plainPath,cached=_textures[key];cached?(cached.destroy(force),delete _textures[key],delete _restorable[key]):_restorable[key]&&delete _restorable[key],delete _dominantColors[key]}else{for(let key in _textures)_textures[key].destroy(force);_textures={},_dominantColors={}}},this.makeDataTexturePowerOf2=function(texture,itemSize){let[maxDimension,minDimension]=[texture.width,texture.height].sort();maxDimension=Math.ceilPowerOf2(maxDimension);const totalLength=maxDimension*maxDimension*itemSize,remainder=[];let j;for(let i=0;i<totalLength-texture.data.length;i++)j=i%texture.data.length,remainder.push(texture.data[j]);const totalData=new Float32Array(totalLength);totalData.set(texture.data),totalData.set(remainder,texture.data.length),texture.data=totalData,texture.width=texture.height=maxDimension,texture.powerOfTwoScale=minDimension/maxDimension},this.loadCurve=function(obj){"string"==typeof obj&&((obj=Assets.JSON[obj]).curves=obj.curves[0]);let data=obj.curves,points=[];for(let j=0;j<data.length;j+=3)points.push(new Vector3(data[j+0],data[j+1],data[j+2]));if(void 0===CatmullRomCurve)throw"loadCurve requires curve3d module";return new CatmullRomCurve(points)},this.getEmptyTexture=function(){return _emptyTexture||((_emptyTexture=new Texture).destroy=null,_emptyTexture.forcePersist=!0,_emptyTexture.promise=Promise.resolve()),_emptyTexture},this.getRepeatTexture=function(src,scale){let texture=_this.getTexture(src,scale);return World.RENDERER.type===Renderer.WEBGL1&&texture.promise.then(_=>{Math.isPowerOf2(texture.dimensions.width,texture.dimensions.height)||console.warn(`getRepeatTexture :: ${src} not power of two!`)}),texture.wrapS=texture.wrapT=Texture.REPEAT,texture},this.findTexturesByPath=function(path){let array=[];for(let key in _textures)key.includes(path)&&array.push(_textures[key]);return array},this.addTextureToCache=function(path,texture){let key=parseTexturePath(path).plainPath;_textures[key]||(_textures[key]=texture)},this.getHeightFromCamera=function(camera,dist){camera=camera.camera||camera,dist||(dist=camera.position.length());let fov=camera.fov;return 2*dist*Math.tan(.5*Math.radians(fov))},this.getWidthFromCamera=function(camera,dist){camera=camera.camera||camera;return _this.getHeightFromCamera(camera,dist)*camera.aspect},this.getPositionFromCameraSize=function(camera,size){camera=camera.camera||camera;let fov=Math.radians(camera.fov);return Math.abs(size/Math.sin(fov/2))},this.loadEngineOnThread=function(thread){["Base3D","CameraBase3D","Mesh","OrthographicCamera","PerspectiveCamera","Geometry","GeometryAttribute","Points","Scene","BoxGeometry","CylinderGeometry","PlaneGeometry","PolyhedronGeometry","IcosahedronGeometry","SphereGeometry","Box2","Box3","Face3","Color","ColorLAB","ColorHSL","Cylindrical","Euler","Frustum","Line3","Matrix3","Matrix4","Plane","Quaternion","Ray","Sphere","Spherical","Triangle","Vector2","Vector3","Vector4","RayManager","Vector3D","Group"].forEach(name=>{thread.importES6Class(name)}),thread.importCode(`Class(${zUtils3D.constructor.toString()}, 'static')`),thread.importCode("Base3D.DIRTY_EPSILON = 0.0001;")},this.billboard=function(mesh,camera=World.CAMERA){_q||(_q=new Quaternion),_q.copy(camera.quaternion),mesh.customRotation&&mesh.quaternion.multiply(mesh.customRotation),mesh._parent&&_q.premultiply(mesh._parent.getWorldQuaternion().inverse()),mesh.quaternion.copy(_q)},this.billboardYAxis=function(mesh,camera=World.CAMERA){_q||(_q=new Quaternion),_q.copy(camera.quaternion);let angle=Math.atan2(_q.y,_q.w)+Math.PI;angle=-angle,_q.set(0,Math.sin(angle),0,Math.cos(angle)),mesh.customRotation&&mesh.quaternion.multiply(mesh.customRotation),mesh._parent&&_q.premultiply(mesh._parent.getWorldQuaternion().inverse()),mesh.quaternion.copy(_q)},this.positionInFrontOfCamera=function(object,distance,alpha=1,camera=World.CAMERA){_v3||(_v3=new Vector3),_v3b||(_v3b=new Vector3),_m4||(_m4=new Matrix4),_q||(_q=new Quaternion);let cameraPosition=_v3b,cameraQuaternion=_q;camera.updateMatrixWorld(),camera.matrixWorld.decompose(cameraPosition,cameraQuaternion,_v3),_v3.set(0,0,-distance).applyQuaternion(cameraQuaternion).add(cameraPosition),_m4.lookAt(cameraPosition,_v3,object.up),_q.setFromRotationMatrix(_m4),object.position.lerp(_v3,alpha),object.quaternion.slerp(_q,alpha)},this.getSignedQuaternionAngleToPlane=function(quaternion,direction,planeNormal,axis){_v3c||(_v3c=new Vector3);let vector=_v3c.copy(direction).applyQuaternion(quaternion);return _this.getSignedAngleToPlane(vector,planeNormal,axis)},this.getSignedAngleToPlane=function(vector,planeNormal,axis){_v3||(_v3=new Vector3),_v3b||(_v3b=new Vector3);let projected=_v3.copy(vector).projectOnPlane(planeNormal).normalize();if(0===projected.length())return Math.PI/2;axis?vector=_v3b.copy(vector).projectOnPlane(axis).normalize():axis=_v3b.crossVectors(projected,planeNormal);let dot=vector.dot(projected),det=axis.dot(projected.cross(vector));return Math.atan2(det,dot)},this.getQuad=function(){let geom=new Geometry,position=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),uv=new Float32Array([0,0,2,0,0,2]);return geom.addAttribute("position",new GeometryAttribute(position,3)),geom.addAttribute("uv",new GeometryAttribute(uv,2)),geom},this.findParentCamera=function(group){if(group._parent){let p=group;for(;p;){if(p.classRef){group=p.classRef;break}p=p._parent}}let parent=group;for(;parent;){if(parent.nuke)return parent.nuke.camera;parent=parent.parent}return World.CAMERA},this.cameraIntrinsicsToObject=function(camera,object){object.fov=camera.fov,object.aspect=camera.aspect,object.near=camera.near,object.far=camera.far,object.p||(object.p=[],object.q=[],object.projectionMatrix=[]),camera.getWorldPosition().toArray(object.p),camera.getWorldQuaternion().toArray(object.q),camera.projectionMatrix.toArray(object.projectionMatrix),object.width=Stage.width,object.height=Stage.height},this.createFXLayer=function(name,nuke=World.NUKE,options){let layer=new FXLayer(nuke,options);return layer.name=name,layer},this.ensureAttributes=function(mesh){const vs=Shaders.getShader(mesh.shader.vsName+".vs"),attrib_regex=/attribute (\w+) (\w+);/g,attribs=mesh.geometry.attributes,firstCount=attribs[Object.keys(attribs)[0]].count;let attrib;for(;null!==(attrib=attrib_regex.exec(vs));){const name=attrib[2];if(name&&!attribs[name]){const size=parseInt(attrib[1][attrib[1].length-1])||1;mesh.geometry.addAttribute(name,new GeometryAttribute(new Float32Array(size*firstCount),size)),mesh.geometry.needsUpdate=!0}}},this.findDominantColors=function(texOrImageOrPath,numColors=4){let path;if(path="string"==typeof texOrImageOrPath?texOrImageOrPath:texOrImageOrPath.src||texOrImageOrPath.path||texOrImageOrPath.image?.src||texOrImageOrPath.image?.path,!path)throw new Error("Couldnt find image asset path");let{plainPath:plainPath}=parseTexturePath(path),colors=_dominantColors[plainPath];if(colors)if(colors.promise){if(colors.numColors>=numColors)return colors.promise}else if(colors.length>=numColors)return colors;return colors={promise:doFindDominantColors(texOrImageOrPath,numColors),numColors:numColors},_dominantColors[plainPath]=colors,(async()=>{try{let result=await colors.promise;_dominantColors[plainPath]===colors&&(_dominantColors[plainPath]=result,texOrImageOrPath.isTexture&&(texOrImageOrPath.dominantColors=result),_textures[plainPath]&&(_textures[plainPath].dominantColors=result))}catch(e){_dominantColors[plainPath]===colors&&delete _dominantColors[plainPath]}})(),colors.promise},this.renderToTexture3D=function(texture,shader){if(void 0===texture._renderTargets){let depth=texture.depth/4;texture._renderTargets=[];let offset=0;for(let i=0;i<depth;i++){offset=4*i;let renderTarget=new RenderTarget(texture.width,texture.height);renderTarget.texture=texture,renderTarget.indices=[offset,offset+1,offset+2,offset+3],texture._renderTargets.push(renderTarget)}let mesh=new Mesh(World.QUAD,shader);texture._meshFor3D=mesh}try{_v4||(_v4=new Vector4),texture._renderTargets.forEach(rt=>{shader.set("indices",_v4.set(...rt.indices)),World.RENDERER.renderSingle(texture._meshFor3D,World.CAMERA,rt)})}catch(e){console.warn("the 3d texture can not be updated correctly, the shader requires the indices uniform to be declared")}},this.cloneTransform=function(object,target=new Base3D){if(!target||!target.position||!target.position.copy)throw new Error("Target of cloneTransform must be a Base3D.");let group=object.group||object;return target.position.copy(group.position),target.scale.copy(group.scale),target.quaternion.copy(group.quaternion),target},this.cloneUniforms=function(object,target={}){let shader=object.shader||object,uniforms=shader.uniforms||shader;if(uniforms&&!uniforms.group){let origin={};for(let key in uniforms){let value=uniforms[key].value,ignoreUIL=uniforms[key].ignoreUIL||null===value;!ignoreUIL&&value.clone&&(value=value.clone()),origin[key]={type:uniforms[key].type,value:value,ignoreUIL:ignoreUIL}}return Object.assign(target.shader||target,origin)}},Object.defineProperty(this,"textureCacheCount",{get(){let count=0;for(let key in _textures)count++;return count}})},"static"),window.WebGLRenderingContext&&function(){"use strict";var e={};function r(r,t){var i;e[r]=!0,void 0!==t&&(i=t,window.console&&window.console.error&&window.console.error(i))}var t=function e(r){var t=r.gl;this.ext=r,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(r.maxVertexAttribs);for(var i=0;i<this.attribs.length;i++){var a=new e.VertexAttrib(t);this.attribs[i]=a}this.maxAttrib=0};(t.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=e.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var i=function(r){var t,i,a=this;this.gl=r,i=(t=r).getError,t.getError=function(){do{(r=i.apply(t))!=t.NO_ERROR&&(e[r]=!0)}while(r!=t.NO_ERROR);for(var r in e)if(e[r])return delete e[r],parseInt(r);return t.NO_ERROR};var n=this.original={getParameter:r.getParameter,enableVertexAttribArray:r.enableVertexAttribArray,disableVertexAttribArray:r.disableVertexAttribArray,bindBuffer:r.bindBuffer,getVertexAttrib:r.getVertexAttrib,vertexAttribPointer:r.vertexAttribPointer};r.getParameter=function(e){return e==a.VERTEX_ARRAY_BINDING_OES?a.currentVertexArrayObject==a.defaultVertexArrayObject?null:a.currentVertexArrayObject:n.getParameter.apply(this,arguments)},r.enableVertexAttribArray=function(e){var r=a.currentVertexArrayObject;return r.maxAttrib=Math.max(r.maxAttrib,e),r.attribs[e].enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},r.disableVertexAttribArray=function(e){var r=a.currentVertexArrayObject;return r.maxAttrib=Math.max(r.maxAttrib,e),r.attribs[e].enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},r.bindBuffer=function(e,t){switch(e){case r.ARRAY_BUFFER:a.currentArrayBuffer=t;break;case r.ELEMENT_ARRAY_BUFFER:a.currentVertexArrayObject.elementArrayBuffer=t}return n.bindBuffer.apply(this,arguments)},r.getVertexAttrib=function(e,t){var i=a.currentVertexArrayObject.attribs[e];switch(t){case r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return i.buffer;case r.VERTEX_ATTRIB_ARRAY_ENABLED:return i.enabled;case r.VERTEX_ATTRIB_ARRAY_SIZE:return i.size;case r.VERTEX_ATTRIB_ARRAY_STRIDE:return i.stride;case r.VERTEX_ATTRIB_ARRAY_TYPE:return i.type;case r.VERTEX_ATTRIB_ARRAY_NORMALIZED:return i.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},r.vertexAttribPointer=function(e,r,t,i,s,A){var o=a.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,e);var c=o.attribs[e];return c.buffer=a.currentArrayBuffer,c.size=r,c.type=t,c.normalized=i,c.stride=s,c.offset=A,c.recache(),n.vertexAttribPointer.apply(this,arguments)},r.instrumentExtension&&r.instrumentExtension(this,"OES_vertex_array_object"),r.canvas.addEventListener("webglcontextrestored",function(){window.console&&window.console.log&&window.console.log("OESVertexArrayObject emulation library context restored"),a.reset_()},!0),this.reset_()};i.prototype.VERTEX_ARRAY_BINDING_OES=34229,i.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(var e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;var r=this.gl;this.maxVertexAttribs=r.getParameter(r.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new t(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},i.prototype.createVertexArrayOES=function(){var e=new t(this);return this.vertexArrayObjects.push(e),e},i.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject==e&&this.bindVertexArrayOES(null)},i.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof t&&e.hasBeenBound&&e.ext==this)},i.prototype.bindVertexArrayOES=function(e){var t=this.gl;if(!e||e.isAlive){var i=this.original,a=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var n=this.currentVertexArrayObject;if(a!=n){a&&n.elementArrayBuffer==a.elementArrayBuffer||i.bindBuffer.call(t,t.ELEMENT_ARRAY_BUFFER,n.elementArrayBuffer);for(var s=this.currentArrayBuffer,A=Math.max(a?a.maxAttrib:0,n.maxAttrib),o=0;o<=A;o++){var c=n.attribs[o],b=a?a.attribs[o]:null;if(a&&c.enabled==b.enabled||(c.enabled?i.enableVertexAttribArray.call(t,o):i.disableVertexAttribArray.call(t,o)),c.enabled){var u=!1;a&&c.buffer==b.buffer||(s!=c.buffer&&(i.bindBuffer.call(t,t.ARRAY_BUFFER,c.buffer),s=c.buffer),u=!0),(u||c.cached!=b.cached)&&i.vertexAttribPointer.call(t,o,c.size,c.type,c.normalized,c.stride,c.offset)}}this.currentArrayBuffer!=s&&i.bindBuffer.call(t,t.ARRAY_BUFFER,this.currentArrayBuffer)}}else r(t.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject")},function(){var e=WebGLRenderingContext.prototype.getSupportedExtensions;WebGLRenderingContext.prototype.getSupportedExtensions=function(){var r=e.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};var r=WebGLRenderingContext.prototype.getExtension;WebGLRenderingContext.prototype.getExtension=function(e){return r.call(this,e)||("OES_vertex_array_object"!==e?null:(this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new i(this)),this.__OESVertexArrayObject))}}()}(),Class(function DracoThread(){let decoderConfig,decoderPending;function onError(opts){opts.message.preloading&&console.warn(opts.er);let plane=new PlaneGeometry(1,1).toNonIndexed(),buff=[],data={};for(let key in plane.attributes)data[key]=plane.attributes[key].array,buff.push(data[key].buffer);computeBounding(data),opts?.resolve(data,opts.id,buff)}function readJsonHeader(buffer){const decoder=new TextDecoder,jsonSize=parseInt(decoder.decode(buffer.slice(0,10)));return[JSON.parse(decoder.decode(buffer.slice(10,10+jsonSize))),buffer.slice(10+jsonSize)]}async function fetchAndDecodeDracoBundle(message,id){let res=await fetch(message.path);if(!res.ok)throw new Error("HTTP Error");let bundleBuffer=await res.arrayBuffer(),[header,buffersBuffer]=readJsonHeader(bundleBuffer),offset=0;const draco=(await decoderPending).draco,geometries=[],allBuffers=[];header.buffers.forEach(byteLength=>{let nextOffset=offset+byteLength,dracoBuffer=buffersBuffer.slice(offset,nextOffset);offset=nextOffset;const[geometry,buffers]=decodeDracoBuffer(dracoBuffer,draco);message.custom&&self[message.custom](geometry),geometries.push(geometry),allBuffers.push(...buffers)}),resolve({geometries:geometries},id,allBuffers)}async function fetchAndDecodeDraco(message,id){let res=await fetch(message.path);if(!res.ok)throw new Error("HTTP Error");let dracoBuffer=await res.arrayBuffer();const module=await decoderPending,[response,buffers]=decodeDracoBuffer(dracoBuffer,module.draco);message.custom&&self[message.custom](response),resolve(response,id,buffers)}async function fetchAndDecodeDracoSkinAnimation(message,id){let res=await fetch(message.path);if(!res.ok)throw new Error("HTTP Error");let dracoBuffer=await res.arrayBuffer();const module=await decoderPending,[response,,jsonData]=decodeDracoBuffer(dracoBuffer,module.draco);let animation={duration:jsonData.duration,orientationNormalized:!0,skeleton:[]},boneCount=response.offset_0.length/3;for(let boneIndex=0;boneIndex<boneCount;++boneIndex){let keys=[];animation.skeleton[boneIndex]={keys:keys};for(let i=0;i<jsonData.frameCount;++i){let offset=response[`offset_${i}`],orientation=response[`orientation_${i}`],scale=response[`scale_${i}`],rot=Array.from(orientation.slice(4*boneIndex,4*boneIndex+4)),l=Math.sqrt(rot[0]*rot[0]+rot[1]*rot[1]+rot[2]*rot[2]+rot[3]*rot[3]);rot[0]/=l,rot[1]/=l,rot[2]/=l,rot[3]/=l,keys.push({time:jsonData.frameTimes?.[i]??i,pos:Array.from(offset.slice(3*boneIndex,3*boneIndex+3)),rot:rot,scl:Array.from(scale.slice(3*boneIndex,3*boneIndex+3))})}}message.custom&&self[message.custom](response,jsonData),resolve(animation,id)}function decodeDracoBuffer(dracoBuffer,draco){let[jsonData,buffer]=readJsonHeader(dracoBuffer);const TYPED_ARRAYS=Object.values(Geometry.TYPED_ARRAYS),attributeIDs={},attributeTypes={};jsonData.attributes.forEach((att,i)=>{const name=att[0];attributeIDs[name]=i,attributeTypes[name]=TYPED_ARRAYS[att[1]]});const taskConfig={attributeIDs:attributeIDs,attributeTypes:attributeTypes,useUniqueIDs:!0},isMesh=0===jsonData.type,decoder=new draco.Decoder;try{const geometry=decodeGeometry(draco,decoder,buffer,taskConfig),buffers=geometry.attributes.map(attr=>attr.array.buffer);isMesh&&geometry.index&&buffers.push(geometry.index.array.buffer);const response={_type:"BufferGeometry",userData:jsonData.userData||{}};return response.userData.dracoType=jsonData.type,response.userData.name=jsonData.name,isMesh&&geometry.index&&(response.index=geometry.index.array),geometry.bones&&(response.bones=geometry.bones),geometry.attributes.forEach(att=>{response[att.name]=att.array,response[`${att.name}ItemSize`]=att.itemSize}),isMesh&&response.position&&computeBounding(response),[response,buffers,jsonData]}finally{draco.destroy(decoder)}}function decodeGeometry(draco,decoder,buffer,taskConfig){const attributeIDs=taskConfig.attributeIDs,attributeTypes=taskConfig.attributeTypes;let dracoGeometry,decodingStatus,bytes=new Int8Array(buffer);const geometryType=decoder.GetEncodedGeometryType(bytes);if(geometryType===draco.TRIANGULAR_MESH)dracoGeometry=new draco.Mesh,decodingStatus=decoder.DecodeArrayToMesh(bytes,bytes.byteLength,dracoGeometry);else{if(geometryType!==draco.POINT_CLOUD)throw new Error("DRACOLoader: Unexpected geometry type.");dracoGeometry=new draco.PointCloud,decodingStatus=decoder.DecodeArrayToPointCloud(bytes,bytes.byteLength,dracoGeometry)}if(!decodingStatus.ok()||0===dracoGeometry.ptr)throw new Error("DRACOLoader: Decoding failed: "+decodingStatus.error_msg());const geometry={index:null,attributes:[]};for(const attributeName in attributeIDs){const attributeType=attributeTypes[attributeName];let attribute,attributeID;if(taskConfig.useUniqueIDs)attributeID=attributeIDs[attributeName],attribute=decoder.GetAttributeByUniqueId(dracoGeometry,attributeID);else{if(attributeID=decoder.GetAttributeId(dracoGeometry,draco[attributeIDs[attributeName]]),-1===attributeID)continue;attribute=decoder.GetAttribute(dracoGeometry,attributeID)}let attr=decodeAttribute(draco,decoder,dracoGeometry,attributeName,attributeType,attribute);geometry.attributes.push(attr),"skinIndex"===attributeName&&attr.array.forEach((value,i)=>{attr.array[i]=Math.round(value)})}geometryType===draco.TRIANGULAR_MESH&&(geometry.index=decodeIndex(draco,decoder,dracoGeometry));let metadata=decoder.GetMetadata(dracoGeometry);if(metadata.ptr){const querier=new draco.MetadataQuerier;let json=querier.GetStringEntry(metadata,"json");if(json){const data=JSON.parse(json);(data.rig||data.bones)&&(geometry.bones=data.rig?data.rig.bones:data.bones)}draco.destroy(querier)}return draco.destroy(dracoGeometry),geometry}function decodeIndex(draco,decoder,dracoGeometry){const numIndices=3*dracoGeometry.num_faces(),byteLength=4*numIndices,ptr=draco._malloc(byteLength);decoder.GetTrianglesUInt32Array(dracoGeometry,byteLength,ptr);const index=new Uint32Array(draco.HEAPF32.buffer,ptr,numIndices).slice();return draco._free(ptr),{array:index,itemSize:1}}function decodeAttribute(draco,decoder,dracoGeometry,attributeName,attributeType,attribute){const numComponents=attribute.num_components(),numValues=dracoGeometry.num_points()*numComponents,byteLength=numValues*attributeType.BYTES_PER_ELEMENT,dataType=getDracoDataType(draco,attributeType),ptr=draco._malloc(byteLength);decoder.GetAttributeDataArrayForAllPoints(dracoGeometry,attribute,dataType,byteLength,ptr);const array=new attributeType(draco.HEAPF32.buffer,ptr,numValues).slice();return draco._free(ptr),{name:attributeName,array:array,itemSize:numComponents}}function getDracoDataType(draco,attributeType){switch(attributeType){case Float32Array:return draco.DT_FLOAT32;case Int8Array:return draco.DT_INT8;case Int16Array:return draco.DT_INT16;case Int32Array:return draco.DT_INT32;case Uint8Array:return draco.DT_UINT8;case Uint16Array:return draco.DT_UINT16;case Uint32Array:return draco.DT_UINT32}}this.loadDraco=function(e,id){const message=e;switch(message.type){case"init":decoderConfig=message.decoderConfig,decoderPending=new Promise(function(pendingResolve){decoderConfig.onModuleLoaded=function(draco){pendingResolve({draco:draco}),resolve({},id)},DracoDecoderModule(decoderConfig)});break;case"decode_buffer_gltf":((dracoBuffer,dataAttrib)=>{const buffer=dracoBuffer,attributeIDs={},attributeTypes={},TYPE_ARRAY={5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array,"image/jpeg":Uint8Array,"image/png":Uint8Array};dataAttrib.forEach(att=>{const name=att.name;attributeIDs[name]=att.id,attributeTypes[name]=TYPE_ARRAY[att.type]});const taskConfig={attributeIDs:attributeIDs,attributeTypes:attributeTypes,useUniqueIDs:!0};decoderPending.then(module=>{const draco=module.draco,decoder=new draco.Decoder;try{const geometry=decodeGeometry(draco,decoder,buffer,taskConfig),buffers=geometry.attributes.map(attr=>attr.array.buffer);geometry.index&&buffers.push(geometry.index.array.buffer);const response={};geometry.index&&(response.index=geometry.index.array),geometry.bones&&(response.bones=geometry.bones),geometry.attributes.forEach(att=>{response[att.name]=att.array,response[`${att.name}ItemSize`]=att.itemSize}),response.position&&computeBounding(response),resolve(response,id,buffers)}catch(error){onError({message:message,er:`Parsing error on Draco file ${message.path}.`,resolve:resolve,id:id})}finally{draco.destroy(decoder)}})})(message.buffer,message.dataAttrib);break;case"decodeBundle":fetchAndDecodeDracoBundle(message,id).catch(error=>{onError({message:message,er:`Error decoding draco bundle ${message.path}: ${error.message}`,resolve:resolve,id:id})});break;case"decode":fetchAndDecodeDraco(message,id).catch(error=>{onError({message:message,er:`Error decoding draco file ${message.path}: ${error.message}`,resolve:resolve,id:id})});break;case"decodeSkinAnimation":fetchAndDecodeDracoSkinAnimation(message,id).catch(error=>{onError({message:message,er:`Error decoding draco skin animation ${message.path}: ${error.message}`,resolve:resolve,id:id})})}},this.decodeGeometry=decodeGeometry,this.decodeIndex=decodeIndex,this.decodeAttribute=decodeAttribute,this.getDracoDataType=getDracoDataType,this.onError=onError,this.readJsonHeader=readJsonHeader,this.fetchAndDecodeDracoBundle=fetchAndDecodeDracoBundle,this.fetchAndDecodeDraco=fetchAndDecodeDraco,this.fetchAndDecodeDracoSkinAnimation=fetchAndDecodeDracoSkinAnimation,this.decodeDracoBuffer=decodeDracoBuffer},"static"),Class(function GeomThread(){Inherit(this,Component);const _this=this;var _cache={},_cacheWait={},_receive={},_dracoLoaded=null;function computeBounding(data){let geom=new Geometry;geom.addAttribute("position",new GeometryAttribute(data.position,3)),data.index&&geom.setIndex(data.index),geom.computeBoundingBox(),geom.computeBoundingSphere(),data.boundingBox=geom.boundingBox,data.boundingSphere=geom.boundingSphere}function loadGeometry(e,id){get(e.path).then(data=>{let buffers=[];if(data.data&&data.metadata?.type){let bufferList={_type:data.metadata.type},jsonData=data.data;jsonData.index&&(bufferList.index=new Geometry.TYPED_ARRAYS[jsonData.index.type](jsonData.index.array),buffers.push(bufferList.index.buffer));for(let key in jsonData.attributes){let attrib=jsonData.attributes[key];bufferList[key]=new Geometry.TYPED_ARRAYS[attrib.type](attrib.array),bufferList[`${key}ItemSize`]=attrib.itemSize,buffers.push(bufferList[key].buffer)}bufferList.position&&computeBounding(bufferList),data.userData&&(bufferList.userData=data.userData),e.custom&&self[e.custom](bufferList),resolve(bufferList,id,buffers)}else{for(let key in data)if("bones"!=key)if(Array.isArray(data[key])){const ArrayType="index"==key?Geometry.arrayNeedsUint32(data[key])?Uint32Array:Uint16Array:Float32Array;data[key]=new ArrayType(data[key]),buffers.push(data[key].buffer)}else data[key].length>0&&buffers.push(data[key].buffer);computeBounding(data),e.custom&&self[e.custom](data),resolve(data,id,buffers)}}).catch(er=>{e.preloading||console.error(er);let plane=new PlaneGeometry(1,1).toNonIndexed(),buffers=[],data={};for(let key in plane.attributes)data[key]=plane.attributes[key].array,buffers.push(data[key].buffer);computeBounding(data),resolve(data,id,buffers)})}function loadDracoLib(){_dracoLoaded=Promise.create();const useJS="object"!=typeof WebAssembly,libFolder="~assets/js/lib/_draco/",libs=useJS?[`${libFolder}draco_decoder.js`]:[`${libFolder}draco_wasm_wrapper.js`,`${libFolder}draco_decoder.wasm`];Promise.all(libs.map((url,i)=>fetch(Assets.getPath(url)).then(res=>{if(!res.ok)throw new Error;return 0===i?res.text():res.arrayBuffer()}))).then(async loadedLibs=>{Thread.upload(["function loadDraco() {","/* draco decoder */",loadedLibs[0],"","/* worker */","","let decoderConfig, decoderPending;","",DracoThread.onError.toString(),DracoThread.decodeGeometry.toString(),DracoThread.decodeIndex.toString(),DracoThread.decodeAttribute.toString(),DracoThread.getDracoDataType.toString(),DracoThread.readJsonHeader.toString(),DracoThread.fetchAndDecodeDracoBundle.toString(),DracoThread.fetchAndDecodeDraco.toString(),DracoThread.fetchAndDecodeDracoSkinAnimation.toString(),DracoThread.decodeDracoBuffer.toString(),"","return "+DracoThread.loadDraco.toString(),"};"].join("\n"));const pool=Thread.shared(!0).array,decoderConfig=useJS?{}:{wasmBinary:loadedLibs[1]};pool.forEach(t=>t.importCode("self.loadDraco = loadDraco();")),await Promise.all(pool.map(t=>t.loadDraco({type:"init",decoderConfig:decoderConfig}))),_dracoLoaded.resolve()}).catch(()=>{console.warn("Draco libs could not be loaded. Fallback to .json"),_dracoLoaded.reject()})}function parseGeometry(data,path,custom){let geometry;if(geometry=custom&&_receive[custom]?_receive[custom](data,doParseGeometry):doParseGeometry(data),geometry._src=path,!geometry.attributes.position)throw`GeomThread :: Malformed geometry is missing position data. ${path}`;return geometry}function doParseGeometry(data){let geom=new Geometry;if(data._type){for(let key in data)if("_type"!==key&&!key.endsWith("ItemSize"))switch(key){case"userData":geom.userData=data.userData;break;case"boundingBox":geom.boundingBox=new Box3((new Vector3).set(data.boundingBox.min.x,data.boundingBox.min.y,data.boundingBox.min.z),(new Vector3).set(data.boundingBox.max.x,data.boundingBox.max.y,data.boundingBox.max.z));break;case"boundingSphere":geom.boundingSphere=new Sphere((new Vector3).set(data.boundingSphere.center.x,data.boundingSphere.center.y,data.boundingSphere.center.z),data.boundingSphere.radius);break;case"index":geom.setIndex(data.index);break;case"bones":geom.bones=data.bones;break;default:data[`${key}ItemSize`]&&geom.addAttribute(key,new GeometryAttribute(data[key],data[`${key}ItemSize`]))}}else geom.addAttribute("position",new GeometryAttribute(data.position,3)),geom.addAttribute("normal",new GeometryAttribute(data.normal||data.position.length,3)),geom.addAttribute("uv",new GeometryAttribute(data.uv||data.position.length/3*2,2)),data.uv2&&geom.addAttribute("uv2",new GeometryAttribute(data.uv2,2)),data.vdata&&geom.addAttribute("vdata",new GeometryAttribute(data.vdata,3)),data.index&&geom.setIndex(data.index),data.skinIndex&&geom.addAttribute("skinIndex",new GeometryAttribute(data.skinIndex,4)),data.skinWeight&&geom.addAttribute("skinWeight",new GeometryAttribute(data.skinWeight,4)),(data.rig||data.bones)&&(geom.bones=(data.rig?data.rig.bones:data.bones).slice(0)),geom.boundingBox=new Box3((new Vector3).set(data.boundingBox.min.x,data.boundingBox.min.y,data.boundingBox.min.z),(new Vector3).set(data.boundingBox.max.x,data.boundingBox.max.y,data.boundingBox.max.z)),geom.boundingSphere=new Sphere((new Vector3).set(data.boundingSphere.center.x,data.boundingSphere.center.y,data.boundingSphere.center.z),data.boundingSphere.radius);return geom}function processPath(path,rawPath){let cacheBust=!1;path.includes("?")&&(path=path.split("?")[0],cacheBust="?"+Utils.timestamp());let noQuery=path;return path.includes("http")||(Hydra.LOCAL||(cacheBust=!1),path.includes("assets/geometry/")||rawPath||(path="assets/geometry/"+path),path.includes(".")||(path+=".json"),cacheBust&&(path+=cacheBust)),[Thread.absolutePath(Assets.getPath(path)),noQuery]}function isGeometryUsable(geom){if(Array.isArray(geom))return geom.every(isGeometryUsable);for(let key in geom.attributes){let attrib=geom.attributes[key];if(!attrib._gl&&attrib.array.deleted&&!attrib.array.length)return!1}return!0}function getCachedGeometry(path){let geom=_cache[path]?.deref();if(geom&&isGeometryUsable(geom))return geom}this.caching=!0,async function(){await Hydra.ready(),Thread.upload(loadGeometry,computeBounding)}(),this.loadGeometry=async function(path,custom,preloading,rawPath){if(!Device.graphics.gpu)return new PlaneGeometry(1,1);let noQuery;[path,noQuery]=processPath(path,rawPath);let data,cached=getCachedGeometry(path);if(cached)return cached;if(_this.caching){if(_cacheWait[path])return _cacheWait[path];_cacheWait[path]=Promise.create()}if(noQuery.endsWith(".bin")){_dracoLoaded||loadDracoLib(),await _dracoLoaded;try{data=await Thread.shared().loadDraco({type:"decode",path:path,custom:custom,preloading:preloading})}catch(e){path=path.replace(".bin",".json")}}data||(data=await Thread.shared().loadGeometry({path:path,custom:custom,preloading:preloading}));let geometry=parseGeometry(data,path,custom);return _this.caching&&(_cache[path]=new WeakRef(geometry),_cacheWait[path]&&_cacheWait[path].resolve(geometry),delete _cacheWait[path]),geometry},this.loadGeometryBundle=async function(path,preloading){if(!Device.graphics.gpu)return[new PlaneGeometry(1,1)];let noQuery;[path,noQuery]=processPath(path);let cached=getCachedGeometry(path);if(cached)return cached;if(_this.caching){if(_cacheWait[path])return _cacheWait[path];_cacheWait[path]=Promise.create()}_dracoLoaded||loadDracoLib(),await _dracoLoaded;let data=await Thread.shared().loadDraco({type:"decodeBundle",path:path,preloading:preloading}),basePath=noQuery.substring(0,noQuery.lastIndexOf("/")),geometries=data.geometries.map(geometryData=>{let geometryPath=`${basePath}/${geometryData.userData.name}`,geometry=parseGeometry(geometryData,geometryPath);return _this.caching&&(_cache[geometryPath]=new WeakRef(geometry),_cacheWait[geometryPath]&&_cacheWait[geometryPath].resolve(geometry),delete _cacheWait[geometryPath]),geometry});return _this.caching&&(_cache[path]=new WeakRef(geometries),_cacheWait[path]&&_cacheWait[path].resolve(geometries),delete _cacheWait[path]),geometries},this.loadSkinAnimation=async function(path,custom,preloading){let noQuery,data=_cache[path]?.deref();if([path,noQuery]=processPath(path),data)return data;if(_this.caching){if(_cacheWait[path])return _cacheWait[path];_cacheWait[path]=Promise.create()}if(noQuery.endsWith(".bin")){_dracoLoaded||loadDracoLib(),await _dracoLoaded;try{data=await Thread.shared().loadDraco({type:"decodeSkinAnimation",path:path,custom:custom,preloading:preloading})}catch(e){path=path.replace(".bin",".json")}}return data||(data=await get(path)),custom&&_receive[custom]&&(data=_receive[custom](data)),_this.caching&&(_cache[path]=new WeakRef(data),_cacheWait[path]&&_cacheWait[path].resolve(data),delete _cacheWait[path]),data},this.removeFromCache=function(path){path.includes("assets/geometry/")||(path="assets/geometry/"+path),path.includes(".")||(path+=".json"),path=Thread.absolutePath(Assets.getPath(path)),delete _cache[path],delete _cacheWait[path]},this.clearCache=function(){_cache={},_cacheWait={}},this.loadDracoLib=function(){return _dracoLoaded||loadDracoLib(),_dracoLoaded},this.loadSkinnedGeometry=function(path,custom,preloading){return this.loadGeometry(path,custom,preloading)},this.customFunction=function(fn,receive){let name=Thread.upload(fn);name=name[0],_receive[name]=receive}},"static"),Class(function InstanceMesh(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;var _config,_frustumCulled=!1,_blankShader,_instanceGroup;function initHotReload(){_mesh.cacheGeom=_mesh.geometry.clone(),_this.events.sub(SceneLayout.HOTLOAD_GEOMETRY,({file:file})=>{_mesh.geometry?._src?.includes(file)&&GeomThread.loadGeometry(file).then(_=>{createInstanceMesh(_config.getFilePath("json"))}),file.includes(_config.getFilePath("json"))&&createInstanceMesh(_config.getFilePath("json"))})}async function createInstanceMesh(file){if(!file)return;let isBinary=file.includes(".bin"),data;file.includes("http")||file.includes("assets/geometry")||(file=`assets/geometry/${file}`),isBinary||file.includes(".json")||(file+=".json"),_mesh.cacheGeom&&(file+="?"+Utils.timestamp()),_mesh.instanceMesh&&(_mesh.instanceMesh.visible=!1),isBinary?(await GeomThread.loadDracoLib(),data=await Thread.shared().loadDraco({type:"decode",path:Thread.absolutePath(Assets.getPath(file))})):data=await Thread.shared().parseInstanceMesh({url:Thread.absolutePath(Assets.getPath(file))});let isStatic=!_config.get("dynamic");if(_this.batch=_this.initClass(MeshBatch,{visibilityCheck:!isStatic}),_mesh._parent.add(_this.batch.group),_this.batch.static=isStatic,_this.batch.frustumCulled=_frustumCulled,_this.batch.onMeshCreated=mesh=>{let geom=mesh.geometry;for(let key in data){if(["_type","userData","offset","orientation","scale"].includes(key))continue;let itemSize=data[`${key}ItemSize`];"number"==typeof itemSize&&geom.addAttribute(key,new GeometryAttribute(data[key],itemSize,1,_this.batch.useDynamic))}let instances=[];for(let i=0;i<count;i++)instances.push(i);geom.addAttribute("instance",new GeometryAttribute(new Float32Array(instances),1,1)),_mesh.instanceMesh=mesh,mesh.position.copy(_mesh.position),mesh.quaternion.copy(_mesh.quaternion),mesh.scale.copy(_mesh.scale),mesh.geometry.maxInstancedCount=_this.maxInstancedCount*_this.instanceMultiplier,_mesh.instanceMeshReady.resolve()},!data.offsetItemSize)return;let count=data.offset.length/data.offsetItemSize;for(let i=0;i<count;++i){let m=new Mesh(_mesh.cacheGeom||_mesh.geometry,_mesh.shader);m.position.fromArray(data.offset,i*data.offsetItemSize),data.orientation&&m.quaternion.fromArray(data.orientation,i*data.orientationItemSize),data.scale&&m.scale.fromArray(data.scale,i*data.scaleItemSize),m.renderOrder=_mesh.renderOrder,m.castShadow=_mesh.castShadow,m.frustumCulled=!1,m.renderOrder=_mesh.renderOrder,m.castShadow=_mesh.castShadow,m.receiveLight=_mesh.receiveLight,m.shader.neverRender=!1,_this.batch.add(m),m.shader.neverRender=!1,m.shader=_blankShader,_instanceGroup.add(m)}let test=_config.get("test");test&&(_this.instanceMultiplier=eval(test)),void 0===_this.maxInstancedCount&&(_this.maxInstancedCount=count),isStatic&&(await _this.batch.staticReady(),_instanceGroup.matrixAutoUpdate=!1)}function addHandlers(){_this.events.sub(MeshUIL.UPDATE,handleMeshUpdate),_this.bindState(UILStorage.state,`MESH_${_mesh.prefix}position`,val=>_mesh.instanceMesh&&_mesh.instanceMesh.position.fromArray(val)),_this.bindState(UILStorage.state,`MESH_${_mesh.prefix}rotation`,val=>_mesh.instanceMesh&&_mesh.instanceMesh.rotation.fromArray(val.map(Math.radians))),_this.bindState(UILStorage.state,`MESH_${_mesh.prefix}scale`,val=>_mesh.instanceMesh&&_mesh.instanceMesh.scale.fromArray(val)),Hydra.LOCAL&&UIL.global&&(_this.events.sub(UILGraphNode.TOGGLE_VISIBILITY,handleToggleVisibility),_this.events.sub(InputUIL.UPDATE,handleUILUpdate))}function handleMeshUpdate({key:key,prefix:prefix,val:val}){if(_mesh.instanceMesh&&(prefix=prefix.substring(5))===_mesh.prefix)switch(key){case"position":_mesh.instanceMesh.position.fromArray(val);break;case"rotation":_mesh.instanceMesh.rotation.fromArray(val.map(Math.radians));break;case"scale":_mesh.instanceMesh.scale.fromArray(val)}}function handleToggleVisibility({id:id,visible:visible}){_this.batch&&_mesh.uilGroup&&id===_mesh.uilGroup.id&&(_this.batch.group.visible=visible)}function handleUILUpdate(e){_this.batch&&e.group===_input&&"visible"===e.key&&(_this.batch.group.visible=_input.get("visible"))}this.instanceMultiplier=1,(_config=InputUIL.create("im_"+_input.prefix,_group)).addFile("json",{relative:"assets/geometry"}),_config.add("test"),_config.addToggle("dynamic",!1),_config.setLabel("Instance"),!1!==_input.get("visible")&&(_this._config=_config,(_blankShader=Utils3D.getTestShader()).visible=!1,(_instanceGroup=new Group).doNotProject=!0,_mesh._parent.add(_instanceGroup),_mesh._parent.remove(_mesh),_mesh.visible=!1,_mesh.geometry.destroyDataAfterUpload=!1,_mesh.instanceMeshReady=Promise.create(),_mesh.instanceMeshBeforeReady=Promise.create(),createInstanceMesh(_config.getFilePath("json")),_config.onUpdate=_=>{createInstanceMesh(_config.getFilePath("json"))},addHandlers(),Hydra.LOCAL&&initHotReload()),this.applyToShader=function(shader){_this.batch.applyToShader(shader)},this.get("frustumCulled",()=>_this.batch?_this.batch.frustumCulled:_frustumCulled),this.set("frustumCulled",async b=>{_this.batch&&(_this.batch.frustumCulled=b),_frustumCulled=b})},_=>{Thread.upload(function parseInstanceMesh({url:url},id){get(url).then(data=>{let bufferList={},buffers=[];if(data.data&&data.metadata?.type){bufferList._type=data.metadata.type;let jsonData=data.data;for(let key in jsonData.attributes){let attrib=jsonData.attributes[key];bufferList[key]=new Geometry.TYPED_ARRAYS[attrib.type](attrib.array),bufferList[`${key}ItemSize`]=attrib.itemSize,buffers.push(bufferList[key].buffer)}}else{bufferList._type="BufferGeometry";for(let key in data){let attrib=data[key];bufferList[key]=new Float32Array(attrib.buffer),bufferList[`${key}ItemSize`]=attrib.components,buffers.push(bufferList[key].buffer)}}resolve(bufferList,id,buffers)})})}),Class(function MeshBatch(_input,_config){Inherit(this,Object3D);const _this=this;var _geom,_shader,_mesh,_firstRender,_shaderKey,_availableIndices,_packedData,_packedTexture,_maxIndices,_static=!1,_renderOrder=0,_objects=[],_offset=[],_quaternion=[],_scale=[],_attributes={},_uniformToAttrib=[],_uniformNoAttrib=[],_frustumCulled=!0,_v1=new Vector3,_v2=new Vector3,_q=new Quaternion,_list=new LinkedList;function initHotReload(shaderRef){_this.events.sub(ShaderUIL.SHADER_UPDATE,({shader:shader})=>{if(shaderRef||(shaderRef=_shader),shaderRef&&shaderRef.vsName&&shader.includes(shaderRef.vsName)){let newShader=new Shader(shaderRef.vsName,shaderRef.fsName);delete MeshBatch.shaders[`${shaderRef.vsName}|${shaderRef.fsName}`],updateShader(newShader),Shader.renderer.hotReloadClearProgram(shaderRef.vsName),newShader.upload(_mesh,_geom),shaderRef._gl&&(shaderRef._gl=newShader._gl),shaderRef._gpu&&(shaderRef._gpu=newShader._gpu),shaderRef._metal&&(shaderRef._metal=newShader._metal)}})}async function initFromSceneLayout(){let wildcard=_input.get("wildcard");if(!wildcard||!wildcard.length)return;let groupName=wildcard.split("|")[0],group=await _this.parent.getLayer(groupName);await _this.wait(group.children,"length");let children=[...group.children];children.sort((a,b)=>a.renderOrder-b.renderOrder),wildcard.includes("static")&&(_this.static=!0),children.forEach(mesh=>_this.add(mesh)),_this.group.renderOrder=children[0].renderOrder,group.add(_this.group)}function updateShader(shader,castShadow){let prefetchCode=Shaders.getShader(shader.vsName+".vs");shader.customCompile=`${shader.vsName}|${shader.fsName}|instance`,shader.castShadow=castShadow,shader.resetProgram();let cached=MeshBatch.shaders[`${shader.vsName}|${shader.fsName}`];if(cached)return shader.fragmentShader=shader.restoreFS=cached.fragment,void(shader.vertexShader=shader.restoreVS=cached.vertex);let vsSplit=shader.vertexShader.split("__ACTIVE_THEORY_LIGHTS__"),fsSplit=shader.fragmentShader.split("__ACTIVE_THEORY_LIGHTS__");if(!vsSplit[1].includes("vec3 pos = position;")&&!vsSplit[1].includes("pos = pos;")&&!shader.vertexShader.includes("vec3 transformPosition"))throw`Shader ${shader.vsName} needs to have "vec3 pos = position;" in order for batching to work`;let definitions=[];vsSplit[1].split("\n").forEach(line=>{if(line.includes("uniform")){if(line.includes("sampler2D"))return;let data=line.split(" "),uni=data[2].replace(";","");(function uniformToAttrib(key){key=key.trim();for(let i=0;i<_uniformToAttrib.length;i++){let val=_uniformToAttrib[i];if(key.includes(val)||val.includes(key))return!_uniformNoAttrib.includes(key)}return!1})(uni)&&(definitions.push(`${uni} = a_${data[2]}`),vsSplit[1]=vsSplit[1].replace(line,`attribute ${data[1]} a_${data[2]}\nvarying ${data[1]} ${data[2]}`),fsSplit[1]=fsSplit[1].replace(line,`varying ${data[1]} ${data[2]}`))}}),vsSplit[1]=vsSplit[1].replace(/vec3 pos = position;/g,"vec3 pos = transformPosition(position, offset, scale, orientation);"),vsSplit[1]=vsSplit[1].replace(/pos = pos;/g,"pos = transformPosition(pos, offset, scale, orientation);"),vsSplit[1]=vsSplit[1].replace(/vNormal = normalMatrix \* normal;/g,"vNormal = normalMatrix * transformNormal(normal, orientation);"),vsSplit[1]=vsSplit[1].replace(/vWorldNormal = transpose(inverse(mat3(modelMatrix))) \* normal;/g,"vWorldNormal = transpose(inverse(mat3(modelMatrix))) * transformNormal(normal, orientation);"),vsSplit[1]=vsSplit[1].replace(/vec3 transformedNormal = normal;/g,"vec3 transformedNormal = transformNormal(normal, orientation);");let main=vsSplit[1].split("main() {");main[1]="\n"+definitions.join("\n")+main[1],vsSplit[1]=main.join("main() {"),vsSplit[0]+="#define INSTANCED 1\n",fsSplit[0]+="#define INSTANCED 1\n",prefetchCode&&prefetchCode.includes("attribute vec3 offset")||(vsSplit[0]+="\n",vsSplit[0]+="attribute float instance;\n",vsSplit[0]+="attribute vec3 offset;\n",vsSplit[0]+="attribute vec3 scale;\n",vsSplit[0]+="attribute vec4 orientation;\n"),shader.vertexShader.includes("vec3 transformPosition")||(vsSplit[0]+=Shaders.getShader("instance.vs")+"\n"),_packedData&&(vsSplit[0]+="\n            attribute float batchIndex;\n            uniform vec3 uPackedInfo;\n            uniform sampler2D tPackedTexture;\n            vec2 getPackedUV(float index, float offset) {\n                float pixel = (index*uPackedInfo.x) + offset;\n            \n                float size = uPackedInfo.y;\n                float p0 = pixel / size;\n                float y = floor(p0);\n                float x = p0 - y;\n            \n                vec2 uv = vec2(0.0);\n                uv.x = x;\n                uv.y = y / size;\n                return uv;\n            }\n            \n            vec4 getPackedData(float offset) {\n                return texture2D(tPackedTexture, getPackedUV(batchIndex, offset));\n            }\n            "),vsSplit=vsSplit.join("__ACTIVE_THEORY_LIGHTS__"),fsSplit=fsSplit.join("__ACTIVE_THEORY_LIGHTS__"),shader.vertexShader=shader.restoreVS=vsSplit,shader.fragmentShader=shader.restoreFS=fsSplit,_shaderKey=`${shader.vsName}|${shader.fsName}`,MeshBatch.shaders[_shaderKey]={fragment:shader.fragmentShader,vertex:shader.vertexShader}}function modifyGeometry(dir){if(!_geom||!_geom.attributes||!_geom.attributes.offset)return;let count=_config.preallocate?_config.preallocate:_geom.attributes.offset.count+dir;if(!_config.preallocate){_offset=new Float32Array(3*count),_scale=new Float32Array(3*count),_quaternion=new Float32Array(4*count),_geom.attributes.offset.setArray(new Float32Array(3*count)),_geom.attributes.scale.setArray(new Float32Array(3*count)),_geom.attributes.orientation.setArray(new Float32Array(4*count));for(let key in _attributes){let components=_geom.attributes[key].itemSize;_attributes[key]=new Float32Array(count*components),_geom.attributes[key].setArray(new Float32Array(count*components))}}_geom.maxInstancedCount=_objects.length,loop()}function dirty(a,b){for(let i=a.length-1;i>-1;i--)if(a[i]!=b[i])return!0;return!1}function prepareMesh(mesh,i){let pos=_v1,scale=_v2,quaternion=_q;if(_config.worldCoords)try{if(_config.parent>0)switch(_config.parent){case 1:pos.copy(mesh._parent.position),scale.copy(mesh._parent.scale),quaternion.copy(mesh._parent.quaternion);break;case 2:pos.copy(mesh._parent._parent.position),scale.copy(mesh._parent._parent.scale),quaternion.copy(mesh._parent._parent.quaternion)}else _config.addParentPosition?(pos.copy(mesh.position).add(mesh._parent.position),2==_config.addParentPosition&&pos.add(mesh._parent._parent.position),scale.copy(mesh.scale),quaternion.copy(mesh.quaternion)):(pos.copy(mesh.getWorldPosition()),scale.copy(mesh.getWorldScale()),quaternion.copy(mesh.getWorldQuaternion()));_config.bypassVisibilityCheck||mesh.determineVisible()||(scale.x=scale.y=scale.z=0)}catch(e){pos.copy(mesh.position),scale.copy(mesh.scale),quaternion.copy(mesh.quaternion)}else pos.copy(mesh.position),scale.copy(mesh.scale),quaternion.copy(mesh.quaternion),_config.visibilityCheck&&!mesh.determineVisible()&&scale.setScalar(0);mesh.batchOffsetPos&&pos.add(mesh.batchOffsetPos);let i3=3*i,i4=4*i;if(_offset[i3+0]=pos.x,_offset[i3+1]=pos.y,_offset[i3+2]=pos.z,_scale[i3+0]=scale.x,_scale[i3+1]=scale.y,_scale[i3+2]=scale.z,_quaternion[i4+0]=quaternion.x,_quaternion[i4+1]=quaternion.y,_quaternion[i4+2]=quaternion.z,_quaternion[i4+3]=quaternion.w,mesh.attributes)for(let key in mesh.attributes){let attr=mesh.attributes[key],value=void 0===attr.value?attr:attr.value;value instanceof Color?(_attributes[key][3*i+0]=value.r,_attributes[key][3*i+1]=value.g,_attributes[key][3*i+2]=value.b):value instanceof Vector3?(_attributes[key][3*i+0]=value.x,_attributes[key][3*i+1]=value.y,_attributes[key][3*i+2]=value.z):value instanceof Vector4||value instanceof Quaternion?(_attributes[key][4*i+0]=value.x,_attributes[key][4*i+1]=value.y,_attributes[key][4*i+2]=value.z,_attributes[key][4*i+3]=value.w):value instanceof Vector2?(_attributes[key][2*i+0]=value.x,_attributes[key][2*i+1]=value.y):_attributes[key][i]=value}if(_packedTexture){let batchIndex=mesh.batchIndex,stride=4*_packedTexture.keys;for(let key in _packedData){let offset=4*_packedData[key],value=mesh.packedData[key].value,index=batchIndex*stride+offset,r=g=b=a=1;value instanceof Color?(r=value.r,g=value.g,b=value.b):value instanceof Vector3?(r=value.x,g=value.y,b=value.z):value instanceof Vector4||value instanceof Quaternion?(r=value.x,g=value.y,b=value.z,a=value.w):value instanceof Vector2?(r=value.x,g=value.y):r=value,_packedTexture.data[index+0]=r,_packedTexture.data[index+1]=g,_packedTexture.data[index+2]=b,_packedTexture.data[index+3]=a}_packedTexture.needsUpdate=!0}}function updateBuffers(){if(_mesh){dirty(_quaternion,_geom.attributes.orientation.array)&&(_geom.attributes.orientation.array.set(_quaternion),_geom.attributes.orientation.needsUpdate=!0),dirty(_offset,_geom.attributes.offset.array)&&(_geom.attributes.offset.array.set(_offset),_geom.attributes.offset.needsUpdate=!0),dirty(_scale,_geom.attributes.scale.array)&&(_geom.attributes.scale.array.set(_scale),_geom.attributes.scale.needsUpdate=!0);for(let key in _attributes)dirty(_attributes[key],_geom.attributes[key].array)&&(_geom.attributes[key].array.set(_attributes[key]),_geom.attributes[key].needsUpdate=!0)}else!function initMesh(){if(_config.preallocate){let count=_config.preallocate,offset=new Float32Array(3*count),scale=new Float32Array(3*count),quaternion=new Float32Array(4*count);offset.set(_offset),scale.set(_scale),quaternion.set(_quaternion),_offset=offset,_scale=scale,_quaternion=quaternion,_geom.addAttribute("offset",new GeometryAttribute(new Float32Array(_offset),3,1,_this.useDynamic)),_geom.addAttribute("scale",new GeometryAttribute(new Float32Array(_scale),3,1,_this.useDynamic)),_geom.addAttribute("orientation",new GeometryAttribute(new Float32Array(_quaternion),4,1,_this.useDynamic))}else _offset=new Float32Array(_offset),_quaternion=new Float32Array(_quaternion),_scale=new Float32Array(_scale),_geom.addAttribute("offset",new GeometryAttribute(new Float32Array(_offset),3,1,_this.useDynamic)),_geom.addAttribute("scale",new GeometryAttribute(new Float32Array(_scale),3,1,_this.useDynamic)),_geom.addAttribute("orientation",new GeometryAttribute(new Float32Array(_quaternion),4,1,_this.useDynamic));if(_geom.attributes.offset.destroyDataAfterUpload=!1,_geom.attributes.scale.destroyDataAfterUpload=!1,_geom.attributes.orientation.destroyDataAfterUpload=!1,_frustumCulled){let box=new Box3;_objects.forEach(mesh=>box.expandByObject(mesh,!0)),_geom.boundingBox=box,_geom.boundingSphere=box.getBoundingSphere()}_mesh=_this.usePoints?new Points(_geom,_shader):new Mesh(_geom,_shader),(_shader.castShadow||_this.castShadow)&&defer(_=>_mesh.castShadow=!0),_mesh.asyncPromise=_this.group.asyncPromise,_this.group.asyncPromise.resolve(),_this.mesh=_mesh,_this.shader=_mesh.shader,_this.mesh.isMeshBatch=!0,_this.group.add(_mesh),_mesh.frustumCulled=_frustumCulled,_renderOrder&&(_mesh.renderOrder=_renderOrder);for(let key in _attributes){let components=1,attr=_objects[0].attributes[key],value=attr.value||attr;value instanceof Vector3?components=3:value instanceof Vector4||value instanceof Quaternion?components=4:value instanceof Color?components=3:value instanceof Vector2&&(components=2);let buffer=new Float32Array(_config.preallocate?_config.preallocate*components:_attributes[key].length);buffer.set(_attributes[key]),_attributes[key]=buffer,_geom.addAttribute(key,new GeometryAttribute(new Float32Array(_attributes[key]),components,1,_this.useDynamic)),_geom.attributes[key].destroyDataAfterUpload=!1}_this.onMeshCreated&&_this.onMeshCreated(_mesh)}()}async function initializeStatic(){let wasVisible=_this.group.determineVisible();if(await(()=>{let promise=Promise.create(),mesh=_list.start(),i=0,worker=new Render.Worker(_=>{mesh.updateMatrixWorld(!0),prepareMesh(mesh,i),i++,mesh=_list.next(),mesh||(worker.stop(),promise.resolve())},1);return promise})(),updateBuffers(),wasVisible){if(_frustumCulled){let box=new Box3;_objects.forEach(mesh=>box.expandByObject(mesh,!0)),_geom.boundingBox=box,_geom.boundingSphere=box.getBoundingSphere()}_this.flag("isStaticReady",!0)}else await _this.wait(()=>_this.group.determineVisible()),_static&&initializeStatic()}function loop(){_static&&_this.stopRender(loop,RenderManager.AFTER_LOOPS);let first=!_firstRender;_firstRender=!0;let i=0,mesh=_list.start();for(;mesh;)(!1!==mesh.batchNeedsUpdate||first)&&(first&&mesh.updateMatrixWorld(!0),prepareMesh(mesh,i)),mesh=_list.next(),i++;updateBuffers()}function firstLoop(){_static||_this.startRender(loop,RenderManager.AFTER_LOOPS),loop()}_this.usePoints=!1,_this.useDynamic=!1,function(){if(_input instanceof InputUILConfig||(_config=_input,_input=null),_config=_config||{},_input&&_this.parent.ready(!0).then(initFromSceneLayout),_this.group.asyncPromise=Promise.create(),Hydra.LOCAL){let warning=setTimeout(()=>{console.log("Problem loading instance",_this?.parent?._config?.getFilePath?.("json"))},5e3);_this.group.asyncPromise.then(()=>{clearTimeout(warning)})}Hydra.LOCAL&&initHotReload()}(),this.add=function(mesh){_objects.push(mesh),_list.push(mesh),mesh.uploadIgnore=!0,mesh.batch=_this,_availableIndices&&!mesh.batchIndex&&(mesh.batchIndex=_availableIndices.shift(),mesh.attributes||(mesh.attributes={}),mesh.attributes.batchIndex={value:mesh.batchIndex});let shader=mesh.shader;for(let key in shader.uniforms){let uniform=shader.uniforms[key];if(uniform.value instanceof Color||uniform.value instanceof Vector2||uniform.value instanceof Vector3||uniform.value instanceof Vector4||uniform.value instanceof Quaternion||"number"==typeof uniform.value)if(uniform.batchUnique||_config.batchUnique)_uniformToAttrib.push(key),mesh.attributes||(mesh.attributes={}),mesh.attributes["a_"+key]=uniform;else if(_uniformNoAttrib.includes(key)||_uniformNoAttrib.push(key),void 0!==uniform.packedIndex){if(_packedData||(_packedData={}),!_availableIndices)throw"Can't use packedData without first setting .maxIndices";_packedData[key]||(_packedData[key]=uniform.packedIndex),mesh.packedData||(mesh.packedData={}),mesh.packedData[key]=uniform}}_geom||function initGeometry(mesh){if((_geom=(new Geometry).instanceFrom(mesh.geometry)).batch=_this,_this.geom=_geom,!_shader){if((_shader=mesh.shader.clone()).debug=!0,_this.usePoints||mesh.shader.replicateUniformsTo(_shader),_packedData){let total=Object.keys(_packedData).length,pixels=Math.sqrt(_maxIndices*total),size=Math.pow(2,Math.ceil(Math.log(pixels)/Math.log(2)));(_packedTexture=new DataTexture(new Float32Array(size*size*4),size,size,Texture.RGBAFormat,Texture.FLOAT)).keys=total,_shader.addUniforms({tPackedTexture:{value:_packedTexture},uPackedInfo:{value:new Vector3(total,size,_maxIndices)}})}updateShader(_shader,mesh.castShadow)}if(mesh.attributes)for(let key in mesh.attributes)_attributes[key]=[];_geom.maxInstancedCount=_objects.length,_static&&defer(initializeStatic)}(mesh),_mesh&&(modifyGeometry(1),_static&&console.error("Don't add more meshes to a static MeshBatch")),mesh.shader.neverRender=!0,_static||RenderManager.scheduleOne(firstLoop,RenderManager.AFTER_LOOPS)},this.remove=function(mesh){_objects.includes(mesh)&&(_objects.remove(mesh),_list.remove(mesh),mesh.batchIndex>-1&&!mesh.persistBatchIndex&&(_availableIndices.push(mesh.batchIndex),_availableIndices.sort((a,b)=>a-b)),modifyGeometry(-1))},this.onDestroy=function(){_this.mesh&&_this.mesh.destroy&&_this.mesh.destroy(),delete MeshBatch.shaders[_shaderKey],_this._onDestroy&&_this._onDestroy()},this.loadFromFile=async function(shader,geomFile,instanceFile){geomFile.includes("http")||geomFile.includes("assets/geometry")||(geomFile="assets/geometry/"+geomFile),geomFile.includes(".json")||(geomFile+=".json"),instanceFile.includes("http")||instanceFile.includes("assets/geometry")||(instanceFile="assets/geometry/"+instanceFile),instanceFile.includes(".json")||(instanceFile+=".json");let[geom,data]=await Promise.all([GeomThread.loadGeometry(Assets.getPath(geomFile)),get(Assets.getPath(instanceFile))]),array=[],count=data.offset.buffer.length/3;for(let i=0;i<count;i++){let mesh=new Mesh(geom,shader);mesh.position.fromArray(data.offset.buffer,3*i),mesh.scale.fromArray(data.scale.buffer,3*i),mesh.quaternion.fromArray(data.orientation.buffer,4*i),array.push(mesh),_this.add(mesh)}return await _this.ready(),array},this.ready=function(){return _this.wait("mesh")},this.staticReady=function(){if(_static)return _this.wait("isStaticReady")},this.getMeshByIndex=function(index){return _objects[index]},this.getMeshCount=function(){return _objects.length},this.get("static",()=>_static),this.set("static",b=>{!!b!==_static&&(_static=!!b,_objects.length&&(_static&&console.warn("For better initialization performance, set meshBatch.static before adding any meshes"),_this.stopRender(loop,RenderManager.AFTER_LOOPS),RenderManager.scheduleOne(firstLoop,RenderManager.AFTER_LOOPS)))}),this.set("maxIndices",value=>{if(_maxIndices=value,!(_availableIndices=_config.availableIndices||[]).length)for(let i=0;i<value;i++)_availableIndices[i]=i}),this.get("attributes",_=>_attributes),this.get("maxIndices",_=>_maxIndices),this.set("renderOrder",v=>{_renderOrder=v,_mesh&&(_mesh.renderOrder=v)}),this.get("renderOrder",_=>_renderOrder),this.set("frustumCulled",b=>{_frustumCulled=b,_mesh&&(_mesh.frustumCulled=b)}),this.applyToShader=function(shader,castShadow=shader.mesh?.castShadow??!1){updateShader(shader,castShadow),Hydra.LOCAL&&initHotReload(shader)},this.upload=async function(){await _this.ready(),_mesh.upload()}},_=>{MeshBatch.shaders={}}),Class(function MeshMerge(_input,_dynamic){Inherit(this,Object3D);const _this=this;var _mesh,_geom,_texture,_shaderKey,_meshes=[],_pending=[],_index=0;function initDynamic(){let array=new Float32Array(16384);(_texture=new DataTexture(array,64,64,Texture.RGBAFormat,Texture.FLOAT)).dynamic=!0,_texture.promise=Promise.resolve(),function updateShader(shader,textureSize){shader.customCompile=`${shader.vsName}|${shader.fsName}|dynamicMerge`,shader.addUniforms({tDynamicMerge:{value:_texture}});let cached=MeshMerge.shaders[`${shader.vsName}|${shader.fsName}`];if(cached)return shader.resetProgram(),void(shader.vertexShader=shader.restoreVS=cached.vertex);shader.resetProgram();let vsSplit=shader.vertexShader.split("__ACTIVE_THEORY_LIGHTS__");if(!vsSplit[1].includes("vec3 pos = position;"))throw`Shader ${shader.vsName} needs to have "vec3 pos = position;" in order for dynamic merging to work`;vsSplit[0]+="attribute float mIndex;\n",vsSplit[0]+="uniform sampler2D tDynamicMerge;\n",vsSplit[0]+="vec3 offset;\n",vsSplit[0]+="vec3 scale;\n",vsSplit[0]+="vec4 orientation;\n",shader.vertexShader.includes("vec3 transformPosition")||(vsSplit[0]+=Shaders.getShader("instance.vs")+"\n");vsSplit[0]+=`\n        vec2 getDMUV(float index, float offset) {\n            float pixel = (index*3.0) + offset;\n        \n            float size = ${textureSize}.0;\n            float p0 = pixel / size;\n            float y = floor(p0);\n            float x = p0 - y;\n        \n            vec2 uv = vec2(0.0);\n            uv.x = x;\n            uv.y = y / size;\n            return uv;\n        }\n        \n`,vsSplit[1]=vsSplit[1].replace(/vec3 pos = position;/g,"vec3 pos = transformPosition(position, offset, scale, orientation);"),vsSplit[1]=vsSplit[1].replace(/vNormal = normalMatrix \* normal;/g,"vNormal = normalMatrix * transformNormal(normal, orientation);"),vsSplit[1]=vsSplit[1].replace(/vec3 transformedNormal = normal;/g,"vec3 transformedNormal = transformNormal(normal, orientation);");let oso="\n        offset = texture2D(tDynamicMerge, getDMUV(mIndex, 0.0)).xyz;\n        scale = texture2D(tDynamicMerge, getDMUV(mIndex, 1.0)).xyz;\n        orientation = texture2D(tDynamicMerge, getDMUV(mIndex, 2.0));\n        ",main=vsSplit[1].split("main() {");main[1]="\n"+oso+main[1],vsSplit[1]=main.join("main() {"),vsSplit=vsSplit.join("__ACTIVE_THEORY_LIGHTS__"),shader.vertexShader=shader.restoreVS=vsSplit,_shaderKey=`${shader.vsName}|${shader.fsName}`,MeshMerge.shaders[_shaderKey]={vertex:shader.vertexShader}}(_mesh.shader,64);let loop=_=>{for(let i=_meshes.length-1;i>-1;i--){let mesh=_meshes[i],index=mesh.mergeIndex;array[12*index+0]=mesh.position.x,array[12*index+1]=mesh.position.y,array[12*index+2]=mesh.position.z,array[12*index+3]=1,array[12*index+4]=mesh.scale.x,array[12*index+5]=mesh.scale.y,array[12*index+6]=mesh.scale.z,array[12*index+7]=1,array[12*index+8]=mesh.quaternion.x,array[12*index+9]=mesh.quaternion.y,array[12*index+10]=mesh.quaternion.z,array[12*index+11]=mesh.quaternion.w}};defer(loop),_this.startRender(loop)}function completeMerge(){_mesh.geometry=_geom,_mesh.asyncPromise.resolve(),_this.onMeshCreated&&_this.onMeshCreated(_mesh),_this.mesh=_mesh}async function initFromSceneLayout(){let wildcard=_input.get("wildcard");if(!wildcard||!wildcard.length)return;let[groupName,dynamic]=wildcard.split("|");await _this.parent.loadedAllLayers();let group=await _this.parent.getLayer(groupName);_dynamic="dynamic"==dynamic;let children=[...group.children];children.sort((a,b)=>a.renderOrder-b.renderOrder),children.forEach(mesh=>_this.add(mesh)),group.add(_this.group),MeshMerge.cache[_input.prefix]||(MeshMerge.cache[_input.prefix]=Promise.create())}!function(){if("object"==typeof _input){if(!1===_input.get("visible"))return;_this.parent.ready().then(initFromSceneLayout)}else"boolean"==typeof _input&&(_dynamic=_input)}(),this.onDestroy=function(){_mesh.destroy(),delete MeshBatch.shaders[_shaderKey],_input?.prefix&&delete MeshMerge.cache[_input.prefix],_this._onDestroy&&_this._onDestroy()},this.ready=function(){return _this.wait("mesh")},this.add=function(mesh){if(mesh.uploadIgnore=!0,!mesh.visible)return;if(mesh.merge=_this,mesh.updateMatrixWorld(!0),_mesh||async function initMesh(mesh){if((_mesh=new Mesh(World.QUAD,mesh.shader)).asyncPromise=Promise.create(),_this.group.add(_mesh),_input?.get&&(_mesh.castShadow=_input.get("castShadow"),_mesh.shader.receiveShadow=_input.get("receiveShadow")),_dynamic&&initDynamic(),_input?.prefix){let cached=MeshMerge.cache[_input.prefix];if(cached)return _geom=await cached,void completeMerge()}await defer();let data=await Promise.all(_pending),buffers=[];data.forEach(obj=>{for(let key in obj)obj[key].buffer&&buffers.push(obj[key].buffer)});let merged=await Thread.shared().meshMergeComplete({data:data},buffers);_geom=new Geometry;for(let key in merged)"components"!==key&&"indexBuffer"!==key&&_geom.addAttribute(key,new GeometryAttribute(merged[key],merged.components[key]));merged.indexBuffer&&_geom.setIndex(merged.indexBuffer),_input?.prefix&&MeshMerge.cache[_input.prefix].resolve(_geom),completeMerge()}(mesh),_input?.prefix){if(MeshMerge.cache[_input.prefix])return mesh.visible=!1,_meshes.push(mesh),void(mesh.mergeIndex=_index++)}let geom=mesh.geometry;if(mesh.attributes)for(let key in mesh.attributes){let attr=mesh.attributes[key];attr instanceof Vector4&&(attr.isVector4=!0),attr instanceof Vector3&&(attr.isVector3=!0),attr instanceof Vector2&&(attr.isVector2=!0),attr instanceof Color&&(attr.isColor=!0)}let data={},components={},buffers=[];for(let key in geom.attributes)data[key]=new Float32Array(geom.attributes[key].array),buffers.push(data[key].buffer),components[key]=geom.attributes[key].itemSize;geom.index&&(data.indexBuffer=new Uint32Array(geom.index),buffers.push(data.indexBuffer.buffer)),data.attributes=mesh.attributes,data.components=components,data.matrix="world"==_input?mesh.matrixWorld.elements:mesh.matrix.elements,_dynamic&&(data.matrix=null),data.dynamic=_dynamic,data.index=mesh.mergeIndex=_index++,mesh.visible=!1,_meshes.push(mesh),_pending.push(Thread.shared().meshMergeTransform(data,buffers))},this.toJSON=function(){return{metadata:{type:"MeshMerge"},data:{geometry:_mesh.geometry.toJSON(),offset:{type:"Float32Array",itemSize:3,array:_meshes.map(mesh=>mesh.position.toArray()).flat()},orientation:{type:"Float32Array",itemSize:4,array:_meshes.map(mesh=>mesh.quaternion.toArray()).flat()},scale:{type:"Float32Array",itemSize:3,array:_meshes.map(mesh=>mesh.scale.toArray()).flat()}}}},this.loadMerged=function(mergedGeometry,shader,meshes){meshes.forEach(mesh=>{mesh.merge=_this,mesh.uploadIgnore=!0,mesh.updateMatrixWorld(!0),"number"==typeof mesh.mergeIndex?(_index=Math.max(mesh.mergeIndex,_index),_meshes[mesh.mergeIndex]=mesh):(mesh.mergeIndex=_index++,_meshes.push(mesh))}),(_mesh=new Mesh(World.QUAD,shader)).asyncPromise=Promise.create(),_this.group.add(_mesh),_dynamic&&initDynamic(),_geom=mergedGeometry,completeMerge()}},_=>{Thread.upload(function meshMergeTransform(e,id){let geom=new Geometry;for(let key in e)!key.includes(["components","matrix"])&&e[key]instanceof Float32Array&&geom.addAttribute(key,new GeometryAttribute(e[key],e.components[key]));if(e.indexBuffer&&(geom.index=e.indexBuffer),e.attributes)for(let key in e.attributes){let components=1,attr=e.attributes[key];attr.isVector4?components=4:attr.isVector3||attr.isColor?components=3:attr.isVector2&&(components=2);let buffer=new Float32Array(geom.attributes.position.count*components),step=buffer.length/components;for(let i=0;i<step;i++)4==components?(buffer[4*i+0]=attr.x,buffer[4*i+1]=attr.y,buffer[4*i+2]=attr.z,buffer[4*i+3]=attr.w):3==components?(buffer[3*i+0]=attr.x||attr.r||0,buffer[3*i+1]=attr.y||attr.g||0,buffer[3*i+2]=attr.z||attr.b||0):2==components?(buffer[2*i+0]=attr.x,buffer[2*i+1]=attr.y):buffer[i]=attr;geom.addAttribute(key,new GeometryAttribute(buffer,components))}e.matrix&&geom.applyMatrix((new Matrix4).fromArray(e.matrix));let indexBuffer=new Float32Array(geom.attributes.position.count);for(let i=0;i<indexBuffer.length;i++)indexBuffer[i]=e.index;geom.addAttribute("mIndex",new GeometryAttribute(indexBuffer,1));let data={},buffers=[],components={};for(let key in geom.attributes)data[key]=geom.attributes[key].array,components[key]=geom.attributes[key].itemSize,buffers.push(data[key].buffer);geom.index&&(data.indexBuffer=geom.index,buffers.push(data.indexBuffer.buffer)),data.components=components,resolve(data,id,buffers)}),Thread.upload(function meshMergeComplete({data:data},id){let _geom;data.forEach(data=>{let geom=new Geometry;for(let key in data)"components"!=key&&("indexBuffer"==key?geom.index=data[key]:geom.addAttribute(key,new GeometryAttribute(data[key],data.components[key])));_geom?_geom.merge(geom):_geom=geom});let result={},components={},buffers=[];for(let key in _geom.attributes)result[key]=_geom.attributes[key].array,components[key]=_geom.attributes[key].itemSize,buffers.push(result[key].buffer);_geom.index&&(result.indexBuffer=_geom.index,buffers.push(result.indexBuffer.buffer)),result.components=components,resolve(result,id,buffers)}),MeshMerge.shaders={},MeshMerge.cache={}}),Class(function RTPool(_type,_size=3,_format,_multisample=!1,_samplesAmount=4){Inherit(this,Component);const _this=this;var _pool,_indexed={};this.nullRT=Utils3D.createRT(2,2),this.nullRT.setSize=()=>{};var _array=[],_resizeDisabled=!1,_rtSize={width:Stage.width*World.DPR,height:Stage.height*World.DPR};function createRT(){let rt=Utils3D.createRT(_rtSize.width,_rtSize.height,_type,_format,_multisample,_samplesAmount);return rt.index=_pool.length(),rt}function addListeners(){_resizeDisabled||_this.events.sub(Events.RESIZE,resizeHandler)}function resizeHandler(){_rtSize.width=Stage.width*World.DPR,_rtSize.height=Stage.height*World.DPR,_array.forEach(rt=>{rt.setSize(_rtSize.width,_rtSize.height)}),_this.events.fire(Events.RESIZE,_rtSize,!0)}!function initPool(){_pool=new ObjectPool;for(let i=0;i<_size;i++){let rt=createRT();_pool.put(rt),_array.push(rt)}}(),defer(addListeners),this.get("array",_=>_array),this.getRT=function(index){return"number"==typeof index?(_indexed[index]||(_indexed[index]=createRT()),_indexed[index]):_pool.get()||function createExtraRT(){Hydra.LOCAL&&console.warn(`Not enough RTs in RTPool, initial size=${_size}, growing to ${_array.length+1}`);let rt=createRT();return _pool.put(rt),_array.push(rt),rt}()},this.putRT=function(rt){delete rt.scissor,delete rt.fxscene,rt!==_this.nullRT&&_pool.put(rt)},this.setSize=function(width,height){_this.disableResize(),_rtSize.width=width,_rtSize.height=height,_array.forEach(rt=>{rt.setSize(_rtSize.width,_rtSize.height)}),_this.events.fire(Events.RESIZE,_rtSize,!0)},this.onDestroy=function(){let p=_pool.get();for(;p;)p.dispose(),p=_pool.get()},this.clone=function(type=_type,size=_size,format=_format,multisample=_multisample,samplesAmount=_samplesAmount){return new RTPool(type,size,format,multisample,samplesAmount)},this.disableResize=function(){_resizeDisabled=!0,_this.events.unsub(Events.RESIZE,resizeHandler)}},"singleton"),Class(function RenderCount(){const _this=this;var $container,LOG,_map={},_display={};this.map=_map,async function(){await Hydra.ready(),_this.active=Utils.query("uil")||Utils.query("renderCount"),LOG=_this.active&&Utils.query("log"),Utils.query("renderCount")&&async function initUIL(){await Hydra.ready(),($container=Stage.create("RenderCount")).css({width:175,height:"auto",paddingBottom:5,bottom:0,maxHeight:400,overflowY:"scroll",position:"absolute"}).bg("#111").setZ(9999999)}()}(),this.add=function(name,detail,amt=1){if(_this.active){if(void 0===_map[name]&&(_map[name]=0,$container)){let $wrapper=$container.create("wrapper");$wrapper.css({position:"relative",width:"100%",height:20}),$wrapper.label=$wrapper.create("label"),$wrapper.label.fontStyle("Arial",12,"#fff").text(name).css({left:10,position:"absolute"}),$wrapper.value=$wrapper.create("value"),$wrapper.value.fontStyle("Arial",12,"#fff").text(0).css({right:10,position:"absolute"}),_display[name]=$wrapper}LOG&&(console.groupCollapsed(name),detail&&console.log(detail),console.trace(),console.groupEnd()),_map[name]+=amt,_display[name]?.value?.text?.(_map[name]||"0")}},this.remove=function(name,amt=1){_this.active&&_map[name]&&(_map[name]-=amt,_display[name]?.value?.text?.(_map[name]||"0"))}},"static"),Class(function RenderStats(){const _this=this;var _trace,_filter,$container,_map={},_display={};function flush(){for(let key in _map)_this.stats[key]=_map[key],_display[key]&&_display[key].value.text(_map[key]||"0"),_map[key]=0;_trace=null}_this.stats={},async function(){await Hydra.ready(),_this.active=Utils.query("renderStats"),Utils.query("renderStats")&&async function initUIL(){if(await Hydra.ready(),($container=Stage.create("RenderStats")).css({position:"fixed",width:150,height:"auto",paddingTop:5}).bg("#111").setZ(99999),Utils.query("uil")){const left=RenderCount.active?150:0;$container.css({bottom:0,left:left})}}(),Render.drawFrame=flush;let frames=0,prevTime=0,fps=Render.REFRESH_RATE;Render.start(_=>{frames+=1,Render.TIME>=prevTime+1e3&&(fps=1e3*frames/(Render.TIME-prevTime),fps=Math.round(fps,fps>=1?0:2),prevTime=Render.TIME,frames=0),_this.update("FPS",fps)})}(),this.update=function(name,amt=1,detail,detail2){if(Hydra.LOCAL){if(_trace==name){if(_filter&&detail){if(!("string"==typeof detail?detail:Utils.getConstructorName(detail)).toLowerCase().includes(_filter.toLowerCase()))return}console.groupCollapsed(name),detail&&console.log("string"==typeof detail?detail:Utils.getConstructorName(detail)),detail2&&console.log(detail2),console.trace(),console.groupEnd()}if(void 0===_map[name]&&(_map[name]=0,$container)){let $wrapper=$container.create("wrapper");$wrapper.css({position:"relative",width:"100%",height:20}),$wrapper.label=$wrapper.create("label"),$wrapper.label.fontStyle("Arial",12,"#fff").text(name).css({left:10,position:"absolute"}),$wrapper.value=$wrapper.create("value"),$wrapper.value.fontStyle("Arial",12,"#fff").text(0).css({right:10,position:"absolute"}),_display[name]=$wrapper}_map[name]+=amt}},this.trace=function(name,filter=null){_trace=name,_filter=filter},this.log=function(){for(let key in _this.stats)console.log(key,_this.stats[key]);console.log("----")}},"static"),Class(function Firebase(){Inherit(this,Model);const _this=this;let _hasInit;async function bootAuth(){FirebaseAuth.init(),await FirebaseAuth.ready()}async function bootFirestore(app){try{await FirebaseFirestore.boot(app),await async function initFirebaseAnonAuth(){const prom=Promise.create();return await FirebaseAuth.ready(),firebase.auth().onAuthStateChanged(user=>{user?prom.resolve():prom.reject()}),firebase.auth().signInAnonymously().catch(e=>{console.error("Error signing into firebase anon"),console.log(e),prom.reject(e)}),prom}()}catch(e){console.log("an error occurred booting firestore",e)}}function init(){if(!firebase)return _this.delayedCall(init,100);_this.dataReady=!0}this.init=async function(){if(_hasInit)return _this.ready();_hasInit=!0,await AssetLoader.loadAssets(["~assets/js/lib/firebase-app.js"]),await AssetLoader.waitForLib("firebase"),init()},this.initApp=function(firebaseConfig,name){return name?firebase.initializeApp(firebaseConfig,name):firebase.initializeApp(firebaseConfig)},this.boot=async function(firebaseData,loader){let database=!1!==firebaseData.database,firestore=firebaseData.firestore,auth=firestore||firebaseData.auth;loader&&(loader.add(1),database&&loader.add(1),firestore&&loader.add(1),auth&&loader.add(1));let loaderCallback=()=>{loader&&loader.trigger(1)};await _this.init().then(loaderCallback);let app=_this.initApp(Config.PLATFORM_CONFIG);return await Promise.all([database&&FirebaseDB.boot(app).finally(loaderCallback),auth&&bootAuth().finally(loaderCallback),firestore&&bootFirestore().finally(loaderCallback)]),app}},"Static"),Class(function FirebaseAuth(){Inherit(this,Model);const _this=this;var _hasInit;function init(){if(!firebase.auth)return _this.delayedCall(init);_this.dataReady=!0}this.init=async function(){if(_hasInit)return _this.ready();_hasInit=!0,await Firebase.ready(),await AssetLoader.loadAssets(["~assets/js/lib/firebase-auth.js"]),init()}},"Static"),Class(function ServicesAuth(){Inherit(this,Model);const _this=this;let _app,_auth,_user,_loggedIn,_reload,_hasInit=!1,_providers={};function onAuth(user){if(user){if(_user=user,_loggedIn=!0,_reload)return window.location.reload();_this.events.fire("logged_in")}else _user=null,_loggedIn=!1,_this.events.fire("logged_out");_this.dataReady=!0}this.init=async function(app){if(_hasInit)return _hasInit;_hasInit=Promise.create(),await FirebaseAuth.ready(),_app=app,function init(){_auth=_app.auth(),function initProviders(){_providers.google=new firebase.auth.GoogleAuthProvider}(),function addListeners(){_auth.onAuthStateChanged(onAuth)}(),_hasInit.resolve()}()},this.isLoggedIn=function(){return _loggedIn},this.user=function(){return _user||null},this.login=function(email,password){if(_auth)return _auth.signInWithEmailAndPassword(email,password);console.error("Auth not ready")},this.loginGoogle=function(r=!1){if(_reload=r,_auth&&_providers.google)return _auth.signInWithPopup(_providers.google);console.error("Google login error")},this.logout=function(){if(_auth)return _user=null,_auth.signOut();console.error("Auth not ready")}},"Static"),Class(function FireDBFirebase(_database){Inherit(this,Component);var _key;this.bindChange=function(key,callback){void 0===callback&&(callback=key,key=_key),_database.ref(key).on("value",snapshot=>{callback(snapshot.val())})},this.bindAdd=function(key,callback){void 0===callback&&(callback=key,key=_key),_database.ref(key).on("child_added",snapshot=>{callback(snapshot.val())})},this.bindRemove=function(key,callback){void 0===callback&&(callback=key,key=_key),_database.ref(key).on("child_removed",snapshot=>{callback(snapshot.val())})},this.update=function(key,value){return void 0===value&&(value=key,key=_key),_database.ref(key).update(value)},this.push=function(key,value){return void 0===value&&(value=key,key=_key),_database.ref(key).push(value)},this.read=function(key=_key){return _database.ref(key).once("value").then(snapshot=>snapshot.val())},this.orderBy=function(key,orderBy,limitTo=null){void 0===orderBy?(orderBy=null,key=_key):void 0===limitTo&&"string"!=typeof orderBy&&"object"!=typeof orderBy?(limitTo=null,key=orderBy=null):void 0===limitTo&&(limitTo=null,key=_key);let query=_database.ref(key);return"string"==typeof orderBy?query=query.orderByChild(orderBy):"key"===orderBy?query=query.orderByKey():"value"===orderBy?query=query.orderByValue():"object"==typeof orderBy&&null!==orderBy&&"priority"in orderBy&&(query=query.orderByPriority()),null!==limitTo&&("number"==typeof limitTo?query=query.limitToFirst(limitTo):"object"==typeof limitTo&&("first"in limitTo?query=query.limitToFirst(limitTo.first):"last"in limitTo&&(query=query.limitToLast(limitTo.last)))),query.once("value").then(snapshot=>{const results=[];return snapshot.forEach(childSnapshot=>{results.push(childSnapshot.val())}),results})},this.key=function(key){return _key=key,this}}),Class(function FireDBFirestore(_database){Inherit(this,Component);var _collection;function Query(){const qthis=this,_config={};this.where=function(field,operator,value){return _config.where={field:field,operator:operator,value:value},qthis},this.limit=function(limit){return _config.limit=limit,qthis},this.orderBy=function(field,direction){return _config.orderBy={field:field,direction:direction},qthis},this.get=async function(){let query=_collection;_config.where&&(query=query.where(_config.where.field,_config.where.operator,_config.where.value)),_config.limit&&(query=query.limit(_config.limit)),_config.orderBy&&(query=query.orderBy(_config.orderBy.field,_config.orderBy.direction));let doc=await query.get();return!doc||doc.empty?[]:[...doc.docs.map(d=>{const data=d.data();return data.__id=d.id,data})]}}this.collection=function(name){return _collection=_database.collection(name),this},this.add=function(data){return _collection.add(data)},this.remove=function(id){return"object"==typeof id&&(id=data.__id),_collection.doc(id).delete()},this.update=function(id,data){return"object"==typeof id&&(id=(data=id).__id,delete data.__id),_collection.doc(id).update(data)},this.bindChange=function(id,callback){return"object"==typeof id&&(id=data.__id),_collection.doc(id).onSnapshot(doc=>{const data=doc.data();data.__id=doc.id,callback(data)})},this.bindAdd=function(callback){return _collection.onSnapshot(snapshot=>{snapshot.docs.forEach(doc=>{const data=doc.data();data.__id=doc.id,callback(data)})})},this.bindRemove=function(callback){return _collection.onSnapshot(snapshot=>{snapshot.docs.forEach(doc=>{const data=doc.data();data.__id=doc.id,callback(data)})})},this.query=function(){return new Query}}),Class(function FirebaseDB(){Inherit(this,Model);const _this=this;var _hasInit,_app,_hasBooted,_booted=Promise.create();function init(){if(!firebase.database)return _this.delayedCall(init);_this.dataReady=!0}this.init=async function(){if(_hasInit)return _this.ready();_hasInit=!0,await Firebase.ready(),await AssetLoader.loadAssets(["~assets/js/lib/firebase-database.js"]),init()},this.sanitize=function(key){return key.replace(/[.$#[\]/]/g,"-")},this.boot=async function(app){return _hasBooted?_booted:(_hasBooted=!0,Firebase.init(),_this.init(),await _this.ready(),_app=app||firebase.initializeApp(Config.PLATFORM_CONFIG),_booted.resolve(_app),_app)},this.booted=()=>_booted,this.getDB=function(type="firebase"){if(!_app)throw"Wait for FirebaseDB.ready() before calling getDB()";return"firebase"===type?new FireDBFirebase(_app.database()):"firestore"===type?new FireDBFirestore(FirebaseFirestore.db):void 0}},"Static"),Class(function FirebaseStorage(){Inherit(this,Model);const _this=this;let _hasInit;function init(){if(!firebase.storage)return _this.delayedCall(init);_this.dataReady=!0}this.init=async function(){if(_hasInit)return _this.ready();_hasInit=!0,await Firebase.ready(),await AssetLoader.loadAssets(["~assets/js/lib/firebase-storage.js"]),init()}},"Static"),Class(function Fluid(_simSize=128,_dyeSize=512,_rect=Stage){Inherit(this,Component);const _this=this;var _fbos={},_scenes={},_tmpVec=new Vector2,_lastSplat=Render.TIME;if("object"==typeof _simSize&&_simSize.isAppState){let params=_simSize;_simSize=params.simSize||129,_dyeSize=params.dyeSize||512,_rect=params.rect||Stage}const DYE_WIDTH=_dyeSize,DYE_HEIGHT=_dyeSize,SIM_WIDTH=_simSize,SIM_HEIGHT=_simSize,config={DENSITY_DISSIPATION:.97,VELOCITY_DISSIPATION:.98,PRESSURE_DISSIPATION:.8,PRESSURE_ITERATIONS:20,CURL:30,DEBUG_MOUSE:!0,SPLAT_RADIUS:.25};function updateParamsHz(param){return 0==(param=Math.clamp(param))?0:Math.exp(Math.log(param)*Render.HZ_MULTIPLIER)}function loop(){_rect.width===_this.rt.width&&_rect.height===_this.rt.height||_this.rt.setSize(_rect.width,_rect.height),_scenes.curl.uniforms.uVelocity.value=_fbos.velocity.read,_scenes.curl.render(_fbos.curl.fbo),_scenes.vorticity.uniforms.uVelocity.value=_fbos.velocity.read,_scenes.vorticity.uniforms.uCurl.value=_fbos.curl.fbo,_scenes.vorticity.uniforms.curl.value=config.CURL,_scenes.vorticity.render(_fbos.velocity.write),_fbos.velocity.swap(),_scenes.divergence.uniforms.uVelocity.value=_fbos.velocity.read,_scenes.divergence.render(_fbos.divergence.fbo),_scenes.clear.uniforms.uTexture.value=_fbos.pressure.read,_scenes.clear.uniforms.value.value=updateParamsHz(config.PRESSURE_DISSIPATION),_scenes.clear.render(_fbos.pressure.write),_fbos.pressure.swap(),_scenes.pressure.uniforms.uDivergence.value=_fbos.divergence.fbo;for(let i=0;i<config.PRESSURE_ITERATIONS;i++)_scenes.pressure.uniforms.uPressure.value=_fbos.pressure.read,_scenes.pressure.render(_fbos.pressure.write),_fbos.pressure.swap();_scenes.gradientSubtract.uniforms.uPressure.value=_fbos.pressure.read,_scenes.gradientSubtract.uniforms.uVelocity.value=_fbos.velocity.read,_scenes.gradientSubtract.render(_fbos.velocity.write),_fbos.velocity.swap(),_scenes.advection.uniforms.texelSize.value.set(1/SIM_WIDTH,1/SIM_HEIGHT),_scenes.advection.uniforms.uVelocity.value=_fbos.velocity.read,_scenes.advection.uniforms.uSource.value=_fbos.velocity.read,_scenes.advection.uniforms.dissipation.value=updateParamsHz(config.VELOCITY_DISSIPATION),_scenes.advection.render(_fbos.velocity.write),_fbos.velocity.swap(),_scenes.advection.uniforms.texelSize.value.set(1/DYE_WIDTH,1/DYE_HEIGHT),_scenes.advection.uniforms.uVelocity.value=_fbos.velocity.read,_scenes.advection.uniforms.uSource.value=_fbos.density.read,_scenes.advection.uniforms.dissipation.value=updateParamsHz(config.DENSITY_DISSIPATION),_scenes.advection.render(_fbos.density.write),_fbos.density.swap(),_scenes.display.uniforms.uTexture.value=_fbos.density.read,_scenes.display.uniforms.texelSize.value.set(1/_rect.width,1/_rect.height),_scenes.display.render(_this.rt)}this.rt=Utils3D.createRT(_rect.width,_rect.height),this.fbos=_fbos,this.additiveBlending=!0,_this.rt.disableDepth=!0,function initFBOs(){_fbos.density=_this.initClass(FluidFBO,DYE_WIDTH,DYE_HEIGHT,Texture.LINEAR),_fbos.velocity=_this.initClass(FluidFBO,SIM_WIDTH,SIM_HEIGHT,Texture.LINEAR),_fbos.divergence=_this.initClass(FluidFBO,SIM_WIDTH,SIM_HEIGHT,Texture.NEAREST),_fbos.curl=_this.initClass(FluidFBO,SIM_WIDTH,SIM_HEIGHT,Texture.NEAREST),_fbos.pressure=_this.initClass(FluidFBO,SIM_WIDTH,SIM_HEIGHT,Texture.NEAREST)}(),function initScenes(){_scenes.curl=_this.initClass(FluidScene,"fluidBase","curlShader",{texelSize:{value:new Vector2(1/SIM_WIDTH,1/SIM_HEIGHT)},uVelocity:{value:null},depthWrite:!1}),_scenes.vorticity=_this.initClass(FluidScene,"fluidBase","vorticityShader",{texelSize:{value:new Vector2(1/SIM_WIDTH,1/SIM_HEIGHT)},uVelocity:{value:null},uCurl:{value:null},curl:{value:config.CURL},dt:{value:1/Render.REFRESH_RATE}}),_scenes.divergence=_this.initClass(FluidScene,"fluidBase","divergenceShader",{texelSize:{value:new Vector2(1/SIM_WIDTH,1/SIM_HEIGHT)},uVelocity:{value:null}}),_scenes.clear=_this.initClass(FluidScene,"fluidBase","clearShader",{uTexture:{value:null},value:{value:config.PRESSURE_DISSIPATION}}),_scenes.pressure=_this.initClass(FluidScene,"fluidBase","pressureShader",{texelSize:{value:new Vector2(1/SIM_WIDTH,1/SIM_HEIGHT)},uPressure:{value:null},uDivergence:{value:null}}),_scenes.gradientSubtract=_this.initClass(FluidScene,"fluidBase","gradientSubtractShader",{texelSize:{value:new Vector2(1/SIM_WIDTH,1/SIM_HEIGHT)},uPressure:{value:null},uVelocity:{value:null}}),_scenes.advection=_this.initClass(FluidScene,"fluidBase","advectionShader",{texelSize:{value:new Vector2(1/SIM_WIDTH,1/SIM_HEIGHT)},uVelocity:{value:null},uSource:{value:null},dt:{value:1/Render.REFRESH_RATE},dissipation:{value:config.VELOCITY_DISSIPATION}}),_scenes.display=_this.initClass(FluidScene,"fluidBase","displayShader",{texelSize:{value:new Vector2(1/_rect.width,1/_rect.height)},uTexture:{value:null}}),_scenes.splat=_this.initClass(FluidScene,"fluidBase","splatShader",{uTarget:{value:null},aspectRatio:{value:_rect.width/_rect.height},point:{value:new Vector2},prevPoint:{value:new Vector2},color:{value:new Vector3},bgColor:{value:new Color("#000000")},radius:{value:config.SPLAT_RADIUS/100},canRender:{value:0},uAdd:{value:1}})}(),_this.startRender(loop),this.updateConfig=function(key,value){config[key]=value},this.drawInput=function(x,y,dx,dy,color,radius=config.SPLAT_RADIUS,independent){_scenes.splat.uniforms.uTarget.value=_fbos.velocity.read,_scenes.splat.uniforms.radius.value=radius/200,_scenes.splat.uniforms.aspectRatio.value=_rect.width/_rect.height,_tmpVec.set(x/_rect.width,1-y/_rect.height);let now=Render.TIME,delta=now-_lastSplat;_lastSplat=now,delta>50||independent?_scenes.splat.uniforms.prevPoint.value.copy(_tmpVec):_scenes.splat.uniforms.prevPoint.value.copy(_scenes.splat.uniforms.point.value),_scenes.splat.uniforms.point.value.copy(_tmpVec),_scenes.splat.uniforms.color.value.set(dx,-dy,1),_scenes.splat.uniforms.uAdd.value=1,_scenes.splat.render(_fbos.velocity.write),_fbos.velocity.swap(),_scenes.splat.uniforms.uTarget.value=_fbos.density.read,_scenes.splat.uniforms.color.value.set(color.r,color.g,color.b),_scenes.splat.uniforms.uAdd.value=_this.additiveBlending?1:0,_scenes.splat.render(_fbos.density.write,!0),_fbos.density.swap(),_scenes.splat.uniforms.canRender.value=1}}),Class(function FluidFBO(_width,_height,_filter){Inherit(this,Component);const _this=this,type=Device.mobile||Renderer.type!=Renderer.WEBGL1?Texture.HALF_FLOAT:Texture.FLOAT;var _fbo1=new RenderTarget(_width,_height,{minFilter:_filter,magFilter:_filter,format:Texture.RGBAFormat,type:type}),_fbo2=new RenderTarget(_width,_height,{minFilter:_filter,magFilter:_filter,format:Texture.RGBAFormat,type:type});this.fbo=_fbo1,this.uniform={value:_fbo1},_fbo1.disableDepth=!0,_fbo2.disableDepth=!0,_fbo1.generateMipmaps=!1,_fbo2.generateMipmaps=!1,_fbo1.texture.forcePersist=!0,_fbo2.texture.forcePersist=!0,this.swap=function(){let temp=_fbo1;_fbo1=_fbo2,_fbo2=temp,_this.uniform.value=_fbo1},this.get("read",_=>_fbo1),this.get("write",_=>_fbo2)}),Class(function FluidLayer(_input,_group){Inherit(this,Object3D);var _fluid,_config,_this=this;!function initConfig(){_this.uilInput=_input,_this.uilGroup=_group,(_config=InputUIL.create(_input.prefix+"fluid",_group)).setLabel("Fluid Config"),_config.add("dyeSize",512),_config.add("simSize",128),_config.add("velocity",.98),_config.add("density",.97),_config.add("pressure",.8),_config.add("iterations",5),_config.add("curl",30),_config.add("defaultRadius",25),_config.addToggle("debugMouse",!1)}(),function initFluid(){let rect=Stage,wildcard=_input.get("wildcard");if(wildcard&&wildcard.includes("x")){let split=wildcard.split("x");rect={width:Number(split[0]),height:Number(split[1])}}_fluid=_this.initClass(Fluid,_config.getNumber("simSize"),_config.getNumber("dyeSize"),rect),_this.rt=_fluid.rt,_this.fbos=_fluid.fbos,_config.onUpdate=key=>{switch(key){case"velocity":_fluid.updateConfig("VELOCITY_DISSIPATION",_config.getNumber(key));break;case"density":_fluid.updateConfig("DENSITY_DISSIPATION",_config.getNumber(key));break;case"pressure":_fluid.updateConfig("PRESSURE_DISSIPATION",_config.getNumber(key));break;case"iterations":_fluid.updateConfig("PRESSURE_ITERATIONS",_config.getNumber(key));break;case"curl":_fluid.updateConfig("CURL",_config.getNumber(key));break;case"defaultRadius":_fluid.updateConfig("SPLAT_RADIUS",_config.getNumber(key));break;case"debugMouse":_fluid.updateConfig("DEBUG_MOUSE",_config.get(key))}},["velocity","density","pressure","iterations","curl","defaultRadius","debugMouse"].forEach(_config.onUpdate)}(),this.initMesh=function initMesh(){let shader=_this.initClass(Shader,"ScreenQuad",{tMap:{value:_fluid.rt}}),mesh=new Mesh(World.QUAD,shader);_this.add(mesh),_this.mesh=mesh},this.drawInput=_fluid.drawInput,this.set("additiveBlending",v=>_fluid.additiveBlending=v),this.applyTo=function(shader){shader.uniforms.tFluid=_this.fbos.velocity.uniform,shader.uniforms.tFluidMask={value:_this}}}),Class(function FluidScene(_vs,_fs,_uniforms){Inherit(this,Component);const _this=this;var _scene=new Scene;!function(){_uniforms.depthWrite=!1;let shader=_this.initClass(Shader,_vs,_fs,_uniforms),mesh=new Mesh(World.QUAD,shader);shader.depthWrite=!1,mesh.noMatrices=!0,_scene.add(mesh),_this.uniforms=shader.uniforms}(),this.render=function(rt){World.RENDERER.autoClear=!1,World.RENDERER.renderSingle(_scene.children[0],World.CAMERA,rt),World.RENDERER.autoClear=!0}}),Class(function FXAA(){Inherit(this,NukePass);this.uniforms={tMask:{value:null}},this.init("FXAA","FXAA"),this.setMask=function(texture){this.uniforms.tMask.value=texture}}),Class(function FXScroll(_params={}){Inherit(this,Object3D);const _this=this;var $element,_transitionShader,_renderManager,_views=[];function loop(){_renderManager.render();for(let i=_views.length-1;i>-1;i--){let view=_views[i];if(null!=view.scrollNormal&&view.__scrollCamera){let camera=view.__scrollCamera,y=view.__scrollY;camera.group.position.y=y*view.scrollNormal}}let scroll=_renderManager.controller.overallScroll;scroll>0&&(_this.progress=scroll)}function findRouter(){let p=_this.parent;for(;p;){if(p.getState)return p;p=p.parent}}function navigate(view){let route=view.__scrollRoute;if(route)findRouter()?.navigate(route);else{let privateRoute=view.__privateRoute;privateRoute&&(findRouter()?.replaceState(""),AppState.set("Router/state",privateRoute))}}async function initRoute(){if(_this.flag("initializing"))return;if(_this.flag("initializing",!0,2e3),_views.length||await _this.wait(_=>!!_views.length),await defer(),_this._invisible)return;let router=findRouter();if(!router)return;router.virtualRoutes=!0;let state=router.getState();AppState.set("Router/state",state),state&&state.includes("/")&&(state=state.split("/")[0]),async function sortAndInitialize(state){let foundFirst=!1,sortedViews=[..._views];_params.initializeSort&&(sortedViews.forEach(view=>{view.__scrollRoute==state&&(view.__initIndex=0,foundFirst=view)}),foundFirst||(sortedViews[0].__initIndex=0,foundFirst=sortedViews[0]),sortedViews.forEach(view=>{if(null==view.__initIndex){let myIndex=_views.indexOf(view),firstIndex=sortedViews.indexOf(foundFirst);view.__initIndex=Math.abs(myIndex-firstIndex)}}),sortedViews.sort((a,b)=>a.__initIndex-b.__initIndex)),sortedViews.forEach(async(ref,i)=>{ref.nuke&&await Initializer3D.uploadNuke(ref.nuke);const group=ref.layout||ref.scene||ref.group||ref.element?.group;group&&(await Initializer3D.detectUploadAll(group,0==i),i==sortedViews.length-1&&AppState.set("FXScroll/initialized",!0),0==i&&AppState.set("FXScroll/firstScene"))})}(state);for(let i=0;i<_views.length;i++){let view=_views[i];if(view.__scrollRoute==state)return void(_renderManager.controller.scroll=view.start+20)}navigate(_views[0])}function resizeHandler(){_transitionShader.set("uRatio",Stage.width/Stage.height)}function handleViewChange({view:view}){_this.flag("initializing")||navigate(view)}this.views=_views,this.progress=0,function initHTML(){($element=Stage.create("FXScroll")).css({position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:2}),$element._scrollParent=!0,_this.element=$element,_this._bindOnDestroy(()=>{_this.element&&_this.element.remove&&(_this.element=_this.element.remove())})}(),function initLogic(){_transitionShader=_this.initClass(Shader,"FXScrollTransition",{tMap1:{value:null},tMap2:{value:null},tNormal:{value:Utils3D.getTexture("assets/images/pbr/damaged_road_normal.jpg"),getTexture:Utils3D.getRepeatTexture},uRatio:{value:Stage.width/Stage.height},uTransition:{value:0},uVelocity:{value:0},uAngle:{value:_params.angle||0}}),_renderManager=_this.initClass(ScrollRenderManager,_this,_transitionShader,{container:$element,keyboard:void 0===_params.keyboard||"boolean"!=typeof _params.keyboard||_params.keyboard,smoothScroll:!0,pingPong:_params.pingPong||!1}),_this.events.sub(_renderManager.controller,ScrollController.VIEW_CHANGE,handleViewChange)}(),_this.startRender(loop),_this.onResize(resizeHandler),this.onVisible=function(){initRoute()},this.scrollTo=function(scroll,time){if(time>0){let v={value:_renderManager.controller.scroll};tween(v,{value:scroll.start?scroll.start+20:scroll},time,"linear").onUpdate(_=>{_renderManager.controller.scroll=v.value})}else _renderManager.controller.scroll=scroll.start?scroll.start+20:scroll},this.parent.lockScroll=function(){_renderManager.controller.lock()},this.parent.unlockScroll=function(){_renderManager.controller.unlock()},this.parent._initFXScroll=async function(list){for(let i=0;i<list.length;i++){let obj=list[i];for(let key in obj){let value=obj[key];"$"==value.charAt?.(0)&&(await _this.wait(_this.parent,value.slice(1)),obj[key]=_this.parent[value.slice(1)])}let view=obj.view;view.__scrollElement=$("scrollElement");let vh=obj.vh;_params.pageScalar&&(vh*=_params.pageScalar),view.__scrollElement.size("100%",105*Number(Math.max(1,vh))+"vh").css({position:"absolute"}),obj.cameraLayer&&view.layout?.getLayer(obj.cameraLayer).then(camera=>{view.__scrollCamera=camera}),obj.route&&(view.__scrollRoute=obj.route),obj.privateRoute&&(view.__privateRoute=obj.privateRoute),obj.cameraMove&&(view.__scrollY=Number(obj.cameraMove)),_views.push(view),$element.add(view.__scrollElement),view.attachElementToScroll=el=>view.__scrollCamera.add(el)}_renderManager.show(_this),initRoute()}}),Class(function FXScrollUI(){let fxScrollRoot,p=this.parent;for(;p;)p.scene instanceof Scene&&(fxScrollRoot=p),p=p.parent;fxScrollRoot.scrollContainer=this.element,this.element.visible=!1}),Class(function ScrollController(_object,_params){Inherit(this,Component);const _this=this;var _virtualScroll,_views;this.position=0,this.last=0,this.delta=0,this.direction=0,this.index1=0,this.index2=0,this.progress=0;var _index=0,_bottomScrolled=!1,_timer=null,_virtualValue=0,_totalHeight=0,_lerpSpeed=Device.mobile?.5:.15;function debounceResize(){Utils.debounce(resize,250)}function removeHandlers(){_this.events.unsub(Events.RESIZE,debounceResize),_this.stopRender(loop),_this.events.unsub(Keyboard.DOWN,keydown)}function keydown(e){if(_views)switch(e.code){case"Tab":!function handleTabNav(){if(_params.virtualScroll&&!_this.smoothScroll)return;defer(()=>{})}();break;case"ArrowUp":moveScroll(-.25*Stage.height);break;case"ArrowDown":moveScroll(.25*Stage.height);break;case"Space":moveScroll(.4*Stage.height)}}function moveScroll(s){(_params.keyboard||_params.virtualScroll)&&(_params.virtualScroll?_virtualValue+=Math._round(s):_this.object.div.scrollTop+=Math._round(s))}async function resize(){if(_views&&!_this._invisible){if(_totalHeight=0,_virtualScroll)_views.forEach(view=>{view.start=_totalHeight;let height=view.height;view.end=view.start+view.height,_totalHeight+=height});else{await defer(),_views.forEach(async view=>{let layout=view.__scrollElement;layout.ready&&await layout.ready(),layout.css({top:_totalHeight}),view.start=_totalHeight,layout.start=_totalHeight;let height=layout.div.getBoundingClientRect().height;view.height=height,layout.height=height,_totalHeight+=height,view.end=view.start+view.height,layout.parallax&&layout.willChange("transform")});__body}update()}}function loop(){_this.flag("active")&&(_virtualScroll?(_virtualValue+=.7*_virtualScroll.delta.y,_params.infinite||(_virtualValue=Math.clamp(_virtualValue,0,_totalHeight)),_this.position=Math.lerp(_virtualValue,_this.position,_lerpSpeed)):_this.smoothScroll?_this.position=Math.floor(Math.lerp(_this.object.div.scrollTop,_this.position,_lerpSpeed)):_this.position=_this.object.div.scrollTop,_this.delta=_this.position-_this.last,_this.last=_this.position,_this.direction=Math.sign(_this.delta),_this.overallScroll=Math.range((_this.position+Stage.height)/_totalHeight,.03,1,0,1,!0),update())}function update(){if(!_views)return;let prevActiveView=_views[_this.index1];prevActiveView&&(prevActiveView.active=!1);let height=0;for(let i=0,l=_views.length;i<l;i++){let view=_views[i];if(height+=view.height,view.scrollNormal=-1,view.scrollProgress=0,view.scrollContainer&&(view.scrollContainer.visible=!1),_this.position<height){_this.index1=i,_this.index2=i+1,_this.index2>l-1&&(_this.index2=l-1);break}}let current=Math.max(_this.position+Stage.height-_views[_this.index2].start,0);if(_this.progress=current/Stage.height,_views[_this.index1].active=!0,parallax(_views[_this.index1]),parallax(_views[_this.index2]),_index!==_this.index1){_index=_this.index1;let event={};event.index=_index,event.direction=_this.direction,event.view=_views[_index],_this.events.fire(ScrollController.VIEW_CHANGE,event)}Math.abs(_totalHeight-Stage.height-_this.position)<.2*Stage.height?_bottomScrolled||(_bottomScrolled=!0,_timer=_this.delayedCall(()=>{let event={};event.index=_this.index2,event.direction=1,event.view=_views[_this.index2],_this.events.fire(ScrollController.BOTTOM,event)},850)):(_timer&&(clearTimeout(_timer),_timer=null),_bottomScrolled&&(_bottomScrolled=!1))}function parallax(view){let current=0,progress=0;if(_params.infinite){let pos=_this.position+Stage.height-view.start;current=Math.fract(pos/_totalHeight)*_totalHeight,progress=Math.clamp(current/(view.height+Stage.height),0,1)}else current=_this.position+Stage.height-view.start,progress=Math.clamp(current/(view.height+Stage.height),0,1);isNaN(progress)&&(progress=0),view.scrollProgress=progress,view.scrollNormal=Math.range(progress,0,1,1,-1),view.scrollDirection=_this.direction,view.scrollTransition=_this.progress;let layout=view.ui||view,currentScroll=_this.scroll;if(layout.scrollContainer&&progress>0){let target=view.start-currentScroll;if(null!=layout.scrollContainer.stickyY)if(null!=layout.scrollContainer.releaseY){let percent=layout.scrollContainer.releaseY*Stage.height/view.height;if(view.scrollProgress>percent){let pixels=(view.scrollProgress-percent)*view.height;target=layout.scrollContainer.stickyY*Stage.height-pixels}else target=Math.max(layout.scrollContainer.stickyY*Stage.height,target)}else target=Math.max(layout.scrollContainer.stickyY*Stage.height,target);layout.scrollContainer.y=Math.lerp(target,layout.scrollContainer.y,_lerpSpeed),layout.scrollContainer.fxScrollSetup?layout.scrollContainer.show():(layout.scrollContainer.fxScrollSetup=!0,layout.scrollContainer.y=target),layout.scrollContainer.transform&&layout.scrollContainer.transform()}}!function initParams(){_params||(_params={}),_this.object=_object,_this.object.overflowScroll({y:!0}),_this.smoothScroll=!1!==_params.smoothScroll}(),function style(){_params.virtualScroll||(_this.smoothScroll?_this.object.css({position:"fixed",top:0,left:0,width:"100%",height:"100%",overflowY:"scroll"}):_this.object.css({width:"100%"}))}(),_params.virtualScroll&&(_virtualScroll=Scroll.createUnlimited()),this.get("totalHeight",()=>_totalHeight),this.get("scroll",_=>_params.virtualScroll?_virtualValue:_this.object.div.scrollTop),this.set("scroll",s=>{_params.virtualScroll?_virtualValue=Math._round(s):_this.object.div.scrollTop=Math._round(s)}),this.show=function(page){_this.smoothScroll&&_params.virtualScroll,_views=page.views,_this.scroll=0,_this.position=0,_virtualValue=0,resize(),function addHandlers(){_this.events.sub(Events.RESIZE,debounceResize),_this.startRender(loop),_this.events.sub(Keyboard.DOWN,keydown)}(),_this.flag("active",!0)},this.hide=function(page){removeHandlers(),_this.flag("active",!1)},this.lock=function(){_params.virtualScroll||_this.object.css({overflow:"hidden"}).invisible()},this.unlock=function(){_params.virtualScroll||_this.object.css({overflowY:"scroll"}).visible()},this.onDestroy=function(){removeHandlers()}},_=>{ScrollController.VIEW_CHANGE="smooth_view_change",ScrollController.BOTTOM="smooth_bottom",ScrollController.TOP="smooth_top"}),Class(function ScrollRenderManager(object,transitionShader,params){Inherit(this,Component);const _this=this;var _mesh,_controller,_views,_index1=0,_index2=0,_renderCount=0;function onScrollControllerViewChange(e){_this.events.fire(_this.VIEW_CHANGE,e)}function onScrollControllerBottom(e){_this.events.fire(_this.BOTTOM,e)}function onScrollControllerTop(e){_this.events.fire(_this.TOP,e)}this.VIEW_CHANGE="ScrollControllerRenderManager_view_change",this.BOTTOM="ScrollControllerRenderManager_bottom",this.TOP="ScrollControllerRenderManager_top",this.initialize=function(object,transitionShader,params={}){_this.initClass(Shader,"ScreenQuad",{tMap:{value:null}}),_this.transitionShader=transitionShader,(_mesh=new Mesh(World.QUAD,_this.transitionShader)).frustumCulled=!1,object.add(_mesh),_controller=_this.initClass(ScrollController,params.container,params),_this.events.sub(_controller,ScrollController.VIEW_CHANGE,onScrollControllerViewChange),_this.events.sub(_controller,ScrollController.BOTTOM,onScrollControllerBottom),_this.events.sub(_controller,ScrollController.TOP,onScrollControllerTop),_this.controller=_controller,_this.pingPong=!1!==params.pingPong},this.render=function(){_views&&(_index1!==_controller.index1||_index2!==_controller.index2?(_views[_index1].rt&&(_views[_index1].visible=!1),_views[_index2].rt&&(_views[_index2].visible=!1),_index1=_controller.index1,_index2=_controller.index2,_views[_index1].rt&&(_views[_index1].visible=!0),_views[_index2].rt&&_controller.progress>0&&(_views[_index2].visible=!0)):_views[_index1].visible&&_views[_index2].visible||(_views[_index1].rt&&(_views[_index1].visible=!0),_views[_index2].rt&&_controller.progress>0&&(_views[_index2].visible=!0)),_this.transitionShader.set("tMap1",_views[_index1].rt?_views[_index1]:null),_this.transitionShader.set("tMap2",_views[_index2].rt?_views[_index2]:null),_this.transitionShader.set("uTransition",_controller.progress),null!=_controller.progress&&(_views[_index1].setScissor(0,0,1,1.3*Math.range(_controller.progress,0,1,1,0)),_views[_index2].setScissor(0,0,1,1.3*Math.range(_controller.progress,0,1,0,1),!0)),_this.pingPong?((0===(_renderCount=Math.abs(_renderCount-1))||_controller.progress<.01)&&_views[_index1].rt&&_views[_index1].draw(),1===_renderCount&&_views[_index2].rt&&_controller.progress>0&&_views[_index2].draw()):(_views[_index1].rt&&_views[_index1].draw(),_index1!==_index2&&_controller.progress>0&&_views[_index2].rt&&_views[_index2].draw()))},this.show=function(page){_controller.show(page),(_views=page.views).forEach(v=>{v.manualRender=!0,v.scrollContainer&&v.scrollContainer.hide(),v.visible=!1})},this.hide=function(page){_controller.hide(page)},object&&this.initialize(object,transitionShader,params)}),Interaction.Class(function Dragger(_obj,_config){Inherit(this,Component);const _this=this;var _input;"object"!=typeof _obj||_config||(_obj=(_config=_obj).object,"boundsMinX"in _config&&"boundsMaxX"in _config&&(_config.boundsX=[parseFloat(_config.boundsMinX??-2),parseFloat(_config.boundsMaxX??2)]),"boundsMinY"in _config&&"boundsMaxY"in _config&&(_config.boundsY=[parseFloat(_config.boundsMinY??-2),parseFloat(_config.boundsMaxY??2)])),this.boundsX=_config.boundsX||[-2,2],this.boundsY=_config.boundsY||[-2,2],this.multiplier=_config.multiplier||1,this.flipX=_config.flipX,this.flipY=_config.flipY,this.lerp=_config.lerp||.1;var _hitCamera,_element=_config.element||Stage,_v2=new Vector2,_holdPos=new Vector2,_holdObjPos=new Vector2,_target=new Vector2,_v3=new Vector3,_snapping=!1,_nearestX=(_this.boundsX[0]+_this.boundsX[1])/2,_nearestY=(_this.boundsY[0]+_this.boundsY[1])/2;function loop(){if(_config.hitObject&&(checkHit()?_this.flag("hovering")||(_this.flag("hovering",!0),_element.cursor("grab",_this)):_this.flag("hovering")&&!_this.flag("dragging")&&(_this.flag("hovering",!1),_element.cursor("auto",_this))),clampTarget(),_snapping)return _config.snapX&&(_obj.x=Math.lerp(_nearestX,_obj.x,.5*_this.lerp),_target.x=_obj.x),void(_config.snapY&&(_obj.y=Math.lerp(_nearestY,_obj.y,.5*_this.lerp),_target.y=_obj.y));_obj.x=Math.lerp(_target.x,_obj.x,_this.lerp),_obj.y=Math.lerp(_target.y,_obj.y,_this.lerp)}function checkHit(){if(!_config.hitObject)return!0;return"2d"===Interaction3D.find(_hitCamera).input.type?_config.hitObject.interaction.checkObjectHit(_config.hitObject,Mouse,_hitCamera):void 0}function clampTarget(){_target.x>_this.boundsX[1]&&(_target.x=_this.boundsX[1]),_target.x<_this.boundsX[0]&&(_target.x=_this.boundsX[0]),_target.y<_this.boundsY[0]&&(_target.y=_this.boundsY[0]),_target.y>_this.boundsY[1]&&(_target.y=_this.boundsY[1])}function touchStart(e){_snapping=!1,_this.flag("dragging",!0),getInputPos(e,_holdPos),_config.absoluteMode?_holdObjPos.copy(_holdPos):_holdObjPos.copy(_obj),_element.cursor("grabbing",_this),_config.onTouchStart&&_config.onTouchStart(),touchMove(e)}function getInputPos(e,target=_v2){return _config.hitObject?(_config.hitObject.interaction.getObjectHitLocalCoords(_v3,_config.hitObject,Mouse,_hitCamera),target.copy(_v3)):target.copy(e),target}function touchMove(e){if(!_this.flag("dragging"))return;let delta=getInputPos(e).sub(_holdPos);_target.x=_holdObjPos.x+delta.x*_this.multiplier*(_this.flipX?-1:1),_target.y=_holdObjPos.y+delta.y*_this.multiplier*(_this.flipY?-1:1),clampTarget()}function touchEnd(e){_this.flag("dragging")&&(_this.flag("dragging",!1),_config.hitObject?checkHit()?_element.cursor("grab",_this):(_this.flag("hovering",!1),_element.cursor("auto",_this)):_element.cursor("grab",_this),(_config.snapX||_config.snapY)&&function snapOnEnd(){_snapping=!0,_config.snapX&&(_nearestX=getNearestSnapPoint("x"));_config.snapY&&(_nearestY=getNearestSnapPoint("y"))}(),_config.onTouchEnd&&_config.onTouchEnd())}function getNearestSnapPoint(axis){let snaps=getSnapPoints(axis);return snaps[getNearestSnapPointIndex(axis,snaps)]}function getSnapPoints(axis){let bounds="x"===axis?_this.boundsX:_this.boundsY,center=(bounds[0]+bounds[1])/2;bounds=[...bounds,center];let snaps=bounds.sort((a,b)=>a-b);return snaps.filter((val,index)=>0===index||val!==snaps[index-1])}function getNearestSnapPointIndex(axis,snaps=getSnapPoints(axis)){let shortestDist=1/0,nearestIndex=-1;return snaps.find((val,index)=>{let dist=Math.abs(_target[axis]-val);if(dist>=shortestDist)return!0;nearestIndex=index,shortestDist=dist}),nearestIndex}function incrementSnapIndex(axis,increment){if(_snapping=!1,"x"===axis?_config.snapX:_config.snapY){let snaps=getSnapPoints(axis),currentIndex="x"===axis?_this.snapIndexX:_this.snapIndexY,nextIndex=Math.clamp(currentIndex+increment,0,snaps.length-1);_target[axis]=snaps[nextIndex]}else{let bounds="x"===axis?_this.boundsX:_this.boundsY;_target[axis]+=(bounds[1]-bounds[0])/(_config.numStepsX||5),clampTarget()}}function moveToSnapIndex(axis,snapIndex){if(_snapping=!1,"x"===axis?_config.snapX:_config.snapY){let snaps=getSnapPoints(axis);_target[axis]=snaps[Math.clamp(snapIndex,0,snaps.length-1)]}else{let bounds="x"===axis?_this.boundsX:_this.boundsY,step=(bounds[1]-bounds[0])/(_config.numStepsY||5);_target[axis]=Math.clamp(step*snapIndex,bounds[0],bounds[1])}}function moveTo(axis,val){_snapping=!1,_target[axis]=val,clampTarget(),("x"===axis?_config.snapX:_config.snapY)&&(_target[axis]=getNearestSnapPoint(axis))}function jumpTo(axis,val){moveTo(axis,val),_obj[axis]=_target[axis]}!function addListeners(){_input=GestureManager.add(_this,_element,checkHit),_this.events.sub(_input,Interaction.START,touchStart),_this.events.sub(_input,Interaction.MOVE,touchMove),_this.events.sub(_input,Interaction.END,touchEnd),_config.hitObject&&(_hitCamera=_config.hitCamera||World.CAMERA)}(),_this.startRender(loop),this.onVisible=function(){_config.hitObject||_element.cursor("grab",_this)},this.onInvisible=function(){_config.hitObject||_element.cursor("auto",_this)},this.setBoundsX=function(arr){_this.boundsX.splice(0,_this.boundsX.length,...arr),clampTarget(),_config.snapX&&(_target.x=getNearestSnapPoint("x"))},this.setBoundsY=function(arr){_this.boundsY.splice(0,_this.boundsY.length,...arr),clampTarget(),_config.snapY&&(_target.y=getNearestSnapPoint("y"))},this.nextX=function(){incrementSnapIndex("x",1)},this.nextY=function(){incrementSnapIndex("y",1)},this.prevX=function(){incrementSnapIndex("x",-1)},this.prevY=function(){incrementSnapIndex("y",-1)},this.moveToSnapIndexX=function(snapIndexX){moveToSnapIndex("x",snapIndexX)},this.moveToSnapIndexY=function(snapIndexY){moveToSnapIndex("y",snapIndexY)},this.moveToX=function(x){moveTo("x",x)},this.moveToY=function(y){moveTo("y",y)},this.jumpToX=function(x){jumpTo("x",x)},this.jumpToY=function(y){jumpTo("y",y)},this.get("snapIndexX",()=>getNearestSnapPointIndex("x")),this.get("snapIndexY",()=>getNearestSnapPointIndex("y")),this.get("snapIndexCountX",()=>getSnapPoints("x").length),this.get("snapIndexCountY",()=>getSnapPoints("y").length)}),Interaction.Class(function Drawer(_object,_directions){Inherit(this,Component);var _input,_origin,_values,_renderer,_max,_axis,_snap,_moving,_prevent,_kill,_touching,_this=this,_min=0,_save=new Vector2,_travel=new Vector2,_evt=(new Vector2,{});function initOrigin(){for(var key in _origin={},_max={},_snap={},_directions||(_directions={x:1,y:1}),_directions)_origin[key]=_object[key],_max[key]=_directions[key];_axis=key}function outOfBounds(){if(_max[_axis]<1){if(_object[_axis]>_max[_axis])return!0;if(_object[_axis]<_min)return!0}else{if(_object[_axis]>_max[_axis])return!0;if(_object[_axis]<_min)return!0}}function getElapsed(){return Math.range(_object[_axis],_min,_max[_axis],0,1)}function copyFromTo(o1,o2){for(let key in o1)"number"==typeof o1[key]&&(o2[key]=o1[key])}function tweenObj(_time,_to){_this.enabled&&(copyFromTo(_object,_values),tween(_values,_to,_time,_this.ease).onUpdate(()=>{copyFromTo(_values,_object),_this.autoRender&&_renderer.needsUpdate&&_renderer.update(),_evt.elapsed=getElapsed(),_this.events.fire(Interaction.MOVE,_evt,!0),_this.onUpdate&&_this.onUpdate(getElapsed())}))}function inputUpdate(e){let delta=_input.move;if(_this.enabled&&!_prevent&&!_kill&&_touching&&(!_this.prevent||!_this.prevent.disabled)){if(_this.prevent)if(Math.abs(delta[_axis])<20&&!_this.prevent.frozen){var prevAxis=_this.prevent.axis;if(Math.abs(delta[prevAxis])>_this.prevent.pixels)return _this.prevent.disabled=!0}else _this.prevent.disabled||(_this.prevent.frozen=!0);_moving=!0,_object[_axis]=_save[_axis]+delta[_axis],_travel.subVectors(_object,_origin),outOfBounds()&&function clampWithFriction(){var max=_max[_axis],val=_object[_axis];max<1?(val>max&&(_object[_axis]=max-(max-val)*_this.friction,_snap[_axis]=max),val<_min&&(_object[_axis]=_min-(_min-val)*_this.friction,_snap[_axis]=_min)):(val>max&&(_object[_axis]=max+(val-max)*_this.friction,_snap[_axis]=max),val<0&&(_object[_axis]=val*_this.friction,_snap[_axis]=_min))}(),e.elapsed=getElapsed(),_this.events.fire(Interaction.MOVE,e,!0),_this.autoRender&&_renderer.needsUpdate&&_renderer.update()}}function inputStart(e){if(_this.checkPrevent&&_this.checkPrevent(e))return _prevent=!0;_this.enabled&&(_touching=!0,_save.copy(_object),clearTween(_values),_this.events.fire(Interaction.START,null,!0))}function inputEnd(){if(_kill)return _kill=!1;if(!_this.enabled||_prevent)return _prevent=!1;if(_touching=!1,_this.events.fire(Interaction.END,null,!0),!(_this.prevent&&(_this.prevent.disabled=!1,_this.prevent.frozen=!1,Math.abs(_input.velocity[_this.prevent.axis])>1&&Math.abs(_input.velocity[_axis])<1))&&_moving&&_this.enabled&&!_this.flag("toggle"))if(_moving=!1,_this.snap){var target={},time=_this.easeTime;Math.abs(_input.delta[_axis])>.5?_max[_axis]>0?_input.delta[_axis]<0&&_max[_axis]<0||_input.delta[_axis]>0&&_max[_axis]>0?target[_axis]=_max[_axis]:target[_axis]=_min:_input.velocity[_axis]<0?target[_axis]=_min:target[_axis]=_max[_axis]:getElapsed()>.5?target[_axis]=_max[_axis]:target[_axis]=_min,tweenObj(time,target)}else outOfBounds()&&tweenObj(_this.easeTime,_snap)}this.autoRender=!0,this.friction=.5,this.ease="easeOutCubic",this.easeTime=500,this.snap=!0,this.prevent=null,this.enabled=!0,function initHelpers(){_input=_this.initClass(Interaction,_object),_this.events.sub(Mouse.input,Interaction.MOVE,inputUpdate),_this.events.sub(_input,Interaction.START,inputStart),_this.events.sub(_input,Interaction.END,inputEnd),_values={},_renderer=_this.initClass(Interaction.Renderer,_object),_this.input=_input}(),initOrigin(),this.set("directions",function(d){_directions=d,initOrigin()}),this.set("min",function(m){_min=m}),this.resetOrigin=function(){initOrigin()},this.toggle=function(time){_this.flag("toggle",!0);var target={};getElapsed()<.5?target[_axis]=_max[_axis]:target[_axis]=_min,tweenObj(time||_this.easeTime,target),_this.delayedCall(function(){_this.flag("toggle",!1)},250)},this.getElapsed=function(){return getElapsed()},this.clearTween=function(){clearTween(_values)},this.forceInputEnd=function(){_kill=!0,inputEnd()}}),Class(function GestureManager(_object){Inherit(this,Component);const _this=this;var _interactions;_this.add=function(listener,element,checkHit,options){_interactions||(_interactions=new Map);let interaction=_interactions.get(element);return interaction||(interaction=_this.initClass(GestureManagerInteraction,element,options),_interactions.set(element,interaction)),interaction.addListener(listener,checkHit)},_this.remove=function(listener){for(const[element,interactions]of _interactions)interactions.removeListener(listener),interactions.empty&&(_interactions.delete(element),interactions.destroy())}},"static"),Class(function GestureManagerInteraction(_element,_options={}){Inherit(this,Component);const _this=this;var _input,_captured,_listeners=[];function sortListeners(){_listeners.sort((a,b)=>b.listener.zIndex-a.listener.zIndex)}function removeListener(listener){let index=_listeners.findIndex(r=>r.listener===listener);_listeners.splice(index,1)}function touchStart(e){for(let i=0;i<_listeners.length;++i){let record=_listeners[i];if(record.listener.destroy){if(!record.listener._invisible&&record.checkHit.call(record.listener,e)){(_captured=record).input.events.fire(Interaction.START,e,!0);break}}else removeListener(record.listener),i-=1}}function touchMove(e){_captured&&!_captured.listener._invisible&&_captured.input.events.fire(Interaction.MOVE,e,!0)}function touchEnd(e){_captured&&(_captured.listener._invisible||_captured.input.events.fire(Interaction.END,e,!0),_captured=null)}window.RenderManager&&window.RenderManager.type===window.RenderManager.VR&&_options.joystick?_input=_this.initClass(JoystickInteraction,{hit:_element,hitCamera:_options.hitCamera}):(_input=_this.initClass(Interaction,_element)).ignoreLeave=!0,function addHandlers(){_this.events.sub(_input,Interaction.START,touchStart),_this.events.sub(_input,Interaction.MOVE,touchMove),_this.events.sub(_input,Interaction.END,touchEnd)}(),_this.addListener=function(listener,checkHit){let proxied=listener.initClass(Events),input=new Proxy(proxied,{get:(target,property)=>"events"===property?target[property]:_input[property]}),record={listener:listener,checkHit:checkHit,input:input};_listeners.push(record);let zIndex=listener.zIndex||0;return listener.get("zIndex",()=>zIndex),listener.set("zIndex",nextZIndex=>{zIndex=nextZIndex,sortListeners()}),listener._bindOnDestroy(()=>removeListener(listener)),sortListeners(),input},_this.removeListener=removeListener,_this.get("input",()=>_input),_this.get("empty",()=>0===_listeners.length)}),Class(function JoystickInteraction(_config={}){Inherit(this,Events);const _this=this;var _joystick,_hitObject;function loop(t,delta){if(!_joystick)return;let e={target:{}};Math.abs(_joystick.x)<.001&&Math.abs(_joystick.y)<.001?(e.x=_this.move.x,e.y=_this.move.y,_this.delta.x=0,_this.delta.y=0,_this.move.x=0,_this.move.y=0,_this.isTouching&&(_this.isTouching=!1,_this.events.fire(Interaction.END,e,!0))):_this.isTouching?(_this.delta.x=_joystick.x*delta,_this.delta.y=_joystick.y*delta,_this.move.x+=_this.delta.x,_this.move.y+=_this.delta.y,e.x=_this.move.x,e.y=_this.move.y,_this.velocity.x=Math.abs(_this.delta.x)/delta,_this.velocity.y=Math.abs(_this.delta.y)/delta,_this.events.fire(Interaction.MOVE,e,!0),_this.events.fire(Interaction.DRAG,e,!0)):(_this.isTouching=!0,e.x=_this.move.x=0,e.y=_this.move.y=0,_this.delta.x=0,_this.delta.y=0,_this.events.fire(Interaction.START,e,!0))}this.delta=new Vector2,this.move=new Vector2,_this.velocity=new Vector2,function(){if(Device.system.xr.vr){if(_config&&_config.raycast?(_hitObject=_config,World.CAMERA):_config&&(_hitObject=_config.hit,_config.hitCamera||World.CAMERA),!_hitObject)throw"JoystickInteraction requires a Mesh for hit testing";!async function addHandlers(){await VRInput.ready(),_joystick={x:0,y:0},VRInput.controllers.forEach(controller=>_this.events.sub(controller,VRInput.JOYSTICK,e=>{!function handleJoystick(e,controller){!function checkHit(controller){return _hitObject.interaction.checkObjectFromValues(_hitObject,controller.group.worldPos,controller.pointer,_config.hitCamera)}(controller)?(_joystick.x=0,_joystick.y=0):(_joystick.x=e.x,_joystick.y=e.y)}(e,controller)}))}(),Render.start(loop)}}()}),Class(function PinchMechanism(element=Stage){Inherit(this,Component);var _this=this,_event={percent:0,theta:0,average:new Vector2},_p0=new Vector2,_p1=new Vector2,_calc=new Vector2,_dist=0,_start=0,_percent=0,_last=0,_touching=!1,_time=performance.now(),_thetaOffset=!1;function setTouches(e){var p0=e.touches[0],p1=e.touches[1];p0&&_p0.set(p0.clientX,p0.clientY),p1&&_p1.set(p1.clientX,p1.clientY)}function touchStart(e){2!=e.touches.length||_touching||(_thetaOffset=!1,_touching=!0,_start=_percent,setTouches(e),element.bind("touchmove",touchMove),_dist=_calc.subVectors(_p0,_p1).length())}function touchMove(e){let now=performance.now();if(now-_time<16)return;_time=now,setTouches(e);var dist=_calc.subVectors(_p0,_p1).length(),absDist=dist-_dist,perc=Math.range(absDist,0,_this.max,0,1);_percent=Math.clamp(_start+perc,0,1),_event.average.set((_p0.x+_p1.x)/2,(_p0.y+_p1.y)/2),_event.delta=dist>_last?1:-1,_event.percent=_percent;let theta=Math.atan2(_p1.y-_p0.y,_p1.x-_p0.x);!1===_thetaOffset&&(_thetaOffset=theta),_event.theta+=theta-_thetaOffset,_thetaOffset=theta,_this.events.fire(PinchMechanism.UPDATE,_event,!0),_last=dist}function touchEnd(e){_touching&&(_touching=!1,_start=_percent,element.unbind("touchmove",touchMove),_this.events.fire(PinchMechanism.END,null,!0))}this.max=150,this.set("percent",function(value){_percent=value}),this.start=function(){!function addListeners(){element.bind("touchstart",touchStart),element.bind("touchend",touchEnd),element.bind("touchcancel",touchEnd)}()},this.stop=function(){!function removeListeners(){element.unbind("touchstart",touchStart),element.unbind("touchend",touchEnd),element.unbind("touchcancel",touchEnd),element.unbind("touchmove",touchMove)}()},this.snapTo=function(to,time){let d={v:_percent};tween(d,{v:to},time,"linear").onUpdate(()=>{_event.delta=0,_event.percent=d.v,_start=d.v,_this.events.fire(Events.UPDATE,_event,!0)})}},function(){PinchMechanism.END="pinch_end",PinchMechanism.UPDATE="pinch_update"}),Class(function PinchMechanism(element=Stage){Inherit(this,Component);var _this=this,_event={percent:0,theta:0,average:new Vector2},_p0=new Vector2,_p1=new Vector2,_calc=new Vector2,_dist=0,_start=0,_percent=0,_last=0,_touching=!1,_time=performance.now(),_thetaOffset=!1;function setTouches(e){var p0=e.touches[0],p1=e.touches[1];p0&&_p0.set(p0.clientX,p0.clientY),p1&&_p1.set(p1.clientX,p1.clientY)}function touchStart(e){2!=e.touches.length||_touching||(_thetaOffset=!1,_touching=!0,_start=_percent,setTouches(e),element.bind("touchmove",touchMove),_dist=_calc.subVectors(_p0,_p1).length())}function touchMove(e){let now=performance.now();if(now-_time<16)return;_time=now,setTouches(e);var dist=_calc.subVectors(_p0,_p1).length(),absDist=dist-_dist,perc=Math.range(absDist,0,_this.max,0,1);_percent=Math.clamp(_start+perc,0,1),_event.average.set((_p0.x+_p1.x)/2,(_p0.y+_p1.y)/2),_event.delta=dist>_last?1:-1,_event.percent=_percent;let theta=Math.atan2(_p1.y-_p0.y,_p1.x-_p0.x);!1===_thetaOffset&&(_thetaOffset=theta),_event.theta+=theta-_thetaOffset,_thetaOffset=theta,_this.events.fire(PinchMechanism.UPDATE,_event,!0),_last=dist}function touchEnd(e){_touching&&(_touching=!1,_start=_percent,element.unbind("touchmove",touchMove),_this.events.fire(PinchMechanism.END,null,!0))}this.max=150,this.set("percent",function(value){_percent=value}),this.start=function(){!function addListeners(){element.bind("touchstart",touchStart),element.bind("touchend",touchEnd),element.bind("touchcancel",touchEnd)}()},this.stop=function(){!function removeListeners(){element.unbind("touchstart",touchStart),element.unbind("touchend",touchEnd),element.unbind("touchcancel",touchEnd),element.unbind("touchmove",touchMove)}()},this.snapTo=function(to,time){let d={v:_percent};tween(d,{v:to},time,"linear").onUpdate(()=>{_event.delta=0,_event.percent=d.v,_start=d.v,_this.events.fire(Events.UPDATE,_event,!0)})}},function(){PinchMechanism.END="pinch_end",PinchMechanism.UPDATE="pinch_update"}),Interaction.Class(function Renderer(_object){var _hydraObject=_object instanceof HydraObject;this.needsUpdate=!!_hydraObject,_hydraObject&&(_object.x=_object.x||0,_object.y=_object.y||0,_object.z=_object.z||0,_object.pos={x:0,y:0,z:0}),this.update=function(){_object.transform()}}),Interaction.Class(function Slider(_object,_direction,_config){Inherit(this,Component);var _input,_values,_renderer,_side,_delta,_addInput,_axis,_views,_dragging,_lockMove,_cacheStart,_hitObject,_this=this,_holdOffset=0,_lastSign=1;function handleArrowNavigation({code:code}){if(!_this.preventVisible&&!_this.preventMovement){switch(code){case"ArrowUp":case"ArrowDown":break;case"ArrowLeft":_this.prev();break;case"ArrowRight":_this.next()}if(_this.useARIAControls)switch(code){case"ShiftLeft":case"ShiftRight":_this.prev();break;case"Tab":_this.next()}}}function copyFromTo(o1,o2){_this.interpolate||(void 0!==o1.x&&(o2.x=o1.x),void 0!==o1.y&&(o2.y=o1.y),void 0!==o1.z&&(o2.z=o1.z))}function loop(time,clock){if(_this.interpolate&&(void 0!==_values.x&&(_object.x=Math.lerp(_values.x,_object.x,_this.interpolate)),void 0!==_values.y&&(_object.y=Math.lerp(_values.y,_object.y,_this.interpolate)),void 0!==_values.z&&(_object.z=Math.lerp(_values.z,_object.z,_this.interpolate))),_this.autoProgress){!function doAutoProgress(){if(_dragging||_this.preventMovement||_this.preventVisible)return;(_this.interpolate?_values:_object)[_axis]-=_this.autoMultiplier*_this.multiplier,!_this.infinite&&outOfBounds()&&clampWithFriction();_this.cssTransitions&&_object.stopTween();_this.autoRender&&_renderer.needsUpdate&&(_this.cssTransitions&&(_object.pos[_axis]=_object[_axis]),_renderer.update())}();let currentSlide=Math.round(-_object[_axis]/_this[_side]*_this.textDir);_this.infinite||Math.clamp(currentSlide,0,_this.maxSlides-1),currentSlide!==_this.currentSlide&&(_this.currentSlide=currentSlide,onUpdateSlide(_this.currentSlide))}!function getFullElapsed(time,clock){if(!_this.preventVisible&&(_this.elapsed=Math.abs(_object[_axis])/Math.abs(-_this[_side]*(_this.maxSlides-1)),_views))for(var i=0;i<_views.length;i++){var view=_views[i],pos=_this[_side]*i,offset=(_object[_axis]+pos)/_this[_side];view.sliderOffset=offset,view.updatePosition&&view.updatePosition(offset,_dragging,time,clock,_delta)}}(time,clock)}function tweenObj(_to){var css=_this.cssTransitions;if(_this.needsRender=!0,_this.interpolate&&void 0===_values[_axis]&&(_values[_axis]=_object[_axis]),copyFromTo(_object,_values),tween(_values,_to,_this.easeTime,_this.ease).onUpdate(()=>{copyFromTo(_values,css?_object.pos:_object),!css&&_this.autoRender&&_renderer.needsUpdate&&_renderer.update(),_this.onUpdate&&_this.onUpdate(_this.elapsed)}).onComplete(_=>_this.needsRender=!1),css){var cssTo={};cssTo[_axis]=_to[_axis],_object.tween(cssTo,_this.easeTime,_this.ease)}}function incSlide(){_this.currentSlide++,_this.repeatable&&_this.currentSlide>_this.maxSlides-1&&(_this.currentSlide=0),!_this.infinite&&_this.currentSlide>_this.maxSlides-1&&(_this.currentSlide=_this.maxSlides-1),onUpdateSlide(_this.currentSlide)}function decSlide(){_this.currentSlide--,_this.repeatable&&_this.currentSlide<0&&(_this.currentSlide=_this.maxSlides-1),!_this.infinite&&_this.currentSlide<0&&(_this.currentSlide=0),onUpdateSlide(_this.currentSlide)}function outOfBounds(){return _this.textDir*_object[_axis]>0||_this.currentSlide==_this.maxSlides-1&&_this.textDir*_object[_axis]<-_this[_side]*_this.currentSlide*_this.textDir}function clampWithFriction(){let obj=_this.interpolate?_values:_object;var val=obj[_axis],max=-_this[_side]*_this.currentSlide*_this.textDir;_this.textDir*val>0?obj[_axis]=val*_this.friction:_this.textDir*val<max&&(obj[_axis]=max+(val-max)*_this.friction)}function onUpdateSlide(slide){_this.events.fire(Interaction.Slider.UPDATE,{slide:slide}),_this.state.slide=slide}function inputUpdate(e,delta=_input.move,override){if(!Device.mobile&&!_this.desktopDrag||!_dragging&&!override||_this.preventMovement||_this.preventVisible)return;(_this.interpolate?_values:_object)[_axis]=-_this[_side]*_this.currentSlide+delta[_axis]*_this.multiplier+_holdOffset,!_this.infinite&&outOfBounds()&&clampWithFriction(),_this.cssTransitions&&_object.stopTween(),e.elapsed=_this.elapsed,_this.events.fire(Interaction.MOVE,e,!0),_this.events.fire(Interaction.Slider.MOVE,{event:e,delta:delta},!0),_this.autoRender&&_renderer.needsUpdate&&(_this.cssTransitions&&(_object.pos[_axis]=_object[_axis]),_renderer.update()),_delta=delta,_this.delta=delta}function lockStart(e){_cacheStart=e}function lockMove(e){Math.abs(_input.move[_axis])>_lockMove&&!_this.flag("overrideLock")&&!_this.flag("preventMove")&&(inputStart(_cacheStart),_this.flag("overrideLock",!0),_this.events.fire(Interaction.Slider.OVERRIDE_LOCK,{action:"start"})),"x"==_axis?(Math.abs(_input.move.y)>_lockMove||Math.abs(_input.move.z)>_lockMove)&&_this.flag("preventMove",!0):"y"==_axis?(Math.abs(_input.move.x)>_lockMove||Math.abs(_input.move.z)>_lockMove)&&_this.flag("preventMove",!0):(Math.abs(_input.move.x)>_lockMove||Math.abs(_input.move.y)>_lockMove)&&_this.flag("preventMove",!0)}function lockEnd(e){_cacheStart=null,_this.flag("overrideLock")&&_this.events.fire(Interaction.Slider.OVERRIDE_LOCK,{action:"end"}),_this.flag("overrideLock",!1),_this.flag("preventMove",!1)}function checkHit(e){return!_hitObject||_hitObject.interaction.checkObjectHit(_hitObject,e,_config.hitCamera)}function inputStart(e){!Device.mobile&&!_this.desktopDrag||"hit"==e.target.className&&1!=_config.allowHit||_this.preventMovement||_this.preventVisible||(_dragging=!0,clearTween(_values),_holdOffset=_values[_axis]+_this[_side]*_this.currentSlide||0,Date.now(),_delta=0,_this.delta=0,_this.needsRender=!0,_this.events.fire(Interaction.Slider.START_INTERACTION,null,!0))}function inputEnd(_,override){if((Device.mobile||_this.desktopDrag)&&(_dragging||override)&&!_this.preventMovement&&!_this.preventVisible){var velocity,target={},delta=_input.delta[_axis];if(0===delta&&0!==_input.velocity[_axis]||(_lastSign=Math.sign(delta)),velocity=_input.velocity[_axis]*_lastSign,_this.flickable&&Math.abs(velocity)>1.5){let flick=Math.log(Math.abs(velocity))/Math.log(2)*Math.sign(velocity),currentSlide=Math.round(-(_object[_axis]+flick)/_this[_side]*_this.textDir);_this.infinite||Math.clamp(currentSlide,0,_this.maxSlides-1),currentSlide!==_this.currentSlide&&(_this.currentSlide=currentSlide,onUpdateSlide(_this.currentSlide))}else if(window.RenderManager&&window.RenderManager.type!=window.RenderManager.VR&&(Math.abs(velocity)>.1||override)){(override||velocity)*_this.textDir>0?decSlide():incSlide()}else{let currentSlide=Math.round(-_object[_axis]/_this[_side]*_this.textDir);_this.infinite||Math.clamp(currentSlide,0,_this.maxSlides-1),currentSlide!==_this.currentSlide&&(_this.currentSlide=currentSlide,onUpdateSlide(_this.currentSlide))}target[_axis]=-_this[_side]*_this.currentSlide*_this.textDir,_dragging=!1,tweenObj(target),_this.events.fire(Interaction.Slider.END_INTERACTION,null,!0)}}"object"!=typeof _object||_direction||_config||(_object=(_config=_object).object,_direction={x:!!_config.x,y:!!_config.y,z:!!_config.z},_config.desktopDrag="true"===_config.desktopDrag||!0===_config.desktopDrag,_config.useKeyboard="true"===_config.useKeyboard||!0===_config.useKeyboard,_config.useARIAControls="true"===_config.useARIAControls||!0===_config.useARIAControls,_config.autoResizing="true"===_config.autoResizing||!0===_config.autoResizing,_config.slideObject=_config.slideObject||!1),this.autoRender=!0,this.autoProgress=!1,this.autoMultiplier=.5,this.currentSlide=0,this.maxSlides=_config.slides,this.width=_config.width,this.height=_config.height,this.gap=_config.gap,this.snapPoint=.3,this.ease="easeOutCubic",this.easeTime=500,this.friction=.3,this.infinite=!1,this.desktopDrag="boolean"!=typeof _config.desktopDrag||_config.desktopDrag,this.useKeyboard="boolean"!=typeof _config.useKeyboard||_config.useKeyboard,this.useARIAControls="boolean"==typeof _config.useARIAControls&&_config.useARIAControls,this.preventMovement=!1,this.cssTransitions=!1,this.multiplier=1,this.elapsed=0,this.interpolate=!1,this.textDir=Interaction.Slider.LTR,this.autoResizing="boolean"==typeof _config.autoResizing&&_config.autoResizing,this.slideObject=_config.slideObject,this.delta=0,this.flickable=!1,this.state=AppState.createLocal(),function initHelpers(){let object;window.RenderManager&&window.RenderManager?.type==window.RenderManager.VR?object=_config.vrHit||_config.hit||_object:(object=_config.hit||_object,window.GLUIObject&&object instanceof window.GLUIObject&&(_hitObject=object,object=Stage)),_input=GestureManager.add(_this,object,checkHit,{joystick:!0,hitCamera:_config.hitCamera}),_this.events.sub(_input,Interaction.MOVE,inputUpdate),_this.events.sub(_input,Interaction.START,inputStart),_this.events.sub(_input,Interaction.END,inputEnd),_this.useKeyboard&&_this.events.sub(Keyboard.DOWN,handleArrowNavigation),_this.input=_input,_values={},_renderer=_config.renderer||_this.initClass(Interaction.Renderer,_object),_this.autoResizing&&function setupResizeObserver(){if(!(_object||_this.slideObject&&_this.slideObject.div))return console.warn("Couldn't setup ResizeObserver on Slider.js, missing div to observer.");let domObj=_object.div;_this.slideObject&&_this.slideObject.div&&(domObj=_this.slideObject.div);const resizeObserver=new ResizeObserver(entries=>{let slideSize=(entries[0].contentRect||entries[0].contentBoxSize)[_side];_this[_side]=slideSize,_this.moveTo(_this.currentSlide)});resizeObserver.observe(domObj),_this._bindOnDestroy(()=>{resizeObserver.unobserve(domObj)})}()}(),function initDirection(){_side=_direction.x?"width":_direction.y?"height":"gap",_axis=_direction.x?"x":_direction.y?"y":"z",_values[_axis]=-_this[_side]*_this.currentSlide*_this.textDir}(),_this.startRender(loop),this.set("views",function(v){_views=v}),this.set("lockMove",function(v){_lockMove=v}),this.lockDirection=function(move=50){_lockMove=move,_this.events.unsub(_input,Interaction.START,inputStart),_this.events.sub(_input,Interaction.START,lockStart),_this.events.sub(_input,Interaction.MOVE,lockMove),_this.events.sub(_input,Interaction.END,lockEnd)},this.moveTo=function(slide){_this.infinite||(slide<0&&(slide=0),slide>=_this.maxSlides&&(slide=_this.maxSlides-1)),_this.currentSlide=slide;var target={};target[_axis]=-_this[_side]*_this.currentSlide*_this.textDir,tweenObj(target),onUpdateSlide(_this.currentSlide)},this.jumpTo=function(slide){_this.infinite||(slide<0&&(slide=0),slide>=_this.maxSlides&&(slide=_this.maxSlides-1)),_this.currentSlide=slide,_values[_axis]=-_this[_side]*_this.currentSlide*_this.textDir,copyFromTo(_values,_object),_this.autoRender&&_renderer.needsUpdate&&(_object.pos[_axis]=_object[_axis],_renderer.update()),onUpdateSlide(_this.currentSlide)},this.next=function(){-1===_this.textDir?decSlide():incSlide();var target={};target[_axis]=-_this[_side]*_this.currentSlide*_this.textDir,tweenObj(target)},this.prev=function(){-1===_this.textDir?incSlide():decSlide();var target={};target[_axis]=-_this[_side]*_this.currentSlide*_this.textDir,tweenObj(target)},this.clearTween=function(){clearTween(_values)},this.onInvisible=function(){_this.preventVisible=!0},this.onVisible=function(){_this.preventVisible=!1},this.addInput=function(x=0,y=0){if(!_this.flag("preventInput")&&(_addInput||((_addInput={}).delta={}),_addInput.delta.x=x,_addInput.delta.y=y,_addInput.total||(_addInput.total=0),inputUpdate(_addInput,_addInput.delta,!0),Math.abs(_object[_axis])>.2*Math.abs(_this[_side]))){let val=Math.abs(y)>Math.abs(x)?y:x;_this.moveTo(_this.currentSlide+Math.sign(val)),_this.flag("preventInput",!0,_this.easeTime)}}},_=>{Interaction.Slider.OVERRIDE_LOCK="slider_override_lock",Interaction.Slider.UPDATE="slider_update",Interaction.Slider.MOVE="slider_move",Interaction.Slider.START_INTERACTION="slider_start_interaction",Interaction.Slider.END_INTERACTION="slider_end_interaction",Interaction.Slider.LTR=1,Interaction.Slider.RTL=-1}),Class(function TouchGesture($object){Inherit(this,Component);var $touchArea=$object,_p0=new Vector2,_p1=new Vector2,_calc=new Vector2,_scale={},_translate={},_rotate={};function loop(){$object.rect.width=$object.width*$object.scale,$object.rect.height=$object.height*$object.scale,$object.rect.x=$object.rect.cx-$object.rect.width/2,$object.rect.y=$object.rect.cy-$object.rect.height/2,$object.rect.mx=$object.rect.cx+$object.rect.width/2,$object.rect.my=$object.rect.cy+$object.rect.height/2,$object.transform()}function updateVectors(e){e.touches[0]&&_p0.set(e.touches[0].pageX,e.touches[0].pageY),e.touches[1]&&_p1.set(e.touches[1].pageX,e.touches[1].pageY),_calc.lastDist||(_calc.lastDist=0),_calc.subVectors(_p0,_p1),_calc.dist=_calc.length(),_calc.angle=_calc.angleTo(_p0,_p1),_calc.dir=_calc.dist>_calc.lastDist?1:-1,_calc.lastDist=_calc.dist}function clearTweens(){_scale.tween&&(_scale.tween=_scale.tween.stop()),_scale.center&&(_scale.center=_scale.center.stop()),_translate.tSnapX&&(_translate.tSnapX=_translate.tSnapX.stop()),_translate.tSnapY&&(_translate.tSnapY=_translate.tSnapY.stop()),_translate.tStartX&&(_translate.tStartX=_translate.tStartX.stop()),_translate.tStartY&&(_translate.tStartY=_translate.tStartY.stop()),_translate.tVelX&&(_translate.tVelX=_translate.tVelX.stop()),_translate.tVelY&&(_translate.tVelY=_translate.tVelY.stop()),_rotate.tweenR&&(_rotate.tweenR=_rotate.tweenR.stop()),_rotate.tweenS&&(_rotate.tweenS=_rotate.tweenS.stop())}function addListeners(){$touchArea.bind("touchstart",touchStart),Stage.bind("touchend",touchEnd),Stage.bind("touchcancel",touchEnd)}function touchStart(e){_calc.dir=0,clearTweens(),updateVectors(e),_scale.enabled&&function startScale(e){2!=e.touches.length||_rotate.prevent||(e.preventDefault(),_scale.active=!0,_scale.startDist=_calc.dist,_scale.saveScale=$object.scale)}(e),_translate.enabled&&function startTranslate(e){if(_translate.moving||_scale.active)return;_translate.moving=!0,_translate.save.set(_p0.x,_p0.y),_translate.start.copy($object)}(),_rotate.enabled&&function startRotate(e){2==e.touches.length&&(_rotate.active=!0,_rotate.angle=_calc.angle)}(e),Stage.bind("touchmove",touchMove)}function touchMove(e){updateVectors(e),clearTweens(),_scale.enabled&&function moveScale(e){if(!_scale.active||_rotate.prevent)return;var diff=_calc.dist-_scale.startDist,scale=_scale.saveScale+Math.range(diff,0,_scale.fidelity,0,1);_scale.snap=!1,scale>_scale.max?(_scale.snap=_scale.max,scale=_scale.max+.05*(scale-_scale.max)):scale<_scale.min&&(_scale.snap=_scale.min,scale=_scale.min-.02*(_scale.min-scale));-1==_calc.dir&&_translate.enabled&&(_scale.centering=!0,$object.x+=.02*(_translate.origin.x-$object.x),$object.y+=.02*(_translate.origin.y-$object.y),_translate.start.copy($object));$object.scale=scale}(),_translate.enabled&&function moveTranslate(e){if(_translate.diff.subVectors(_p0,_translate.save),_translate.delta.subVectors(_p0,_translate.prevTouch),_translate.prevTouch.copy(_p0),!_translate.moving||_scale.active)return _translate.moving=!1;_translate.haveMoved=!0,_translate.snapX=!1,_translate.snapY=!1,_translate.time=Date.now()-(_translate.prevTime||0),_translate.prevTime=Date.now(),Math.abs(_translate.diff.x)>20&&e.preventDefault();var x=_translate.start.x+_translate.diff.x,y=_translate.start.y+_translate.diff.y,mh=_translate.mask.height,mw=_translate.mask.width,l=$object.rect.x+x,t=$object.rect.y+y,max=0,diff=0;_translate.stopXR=mw-$object.rect.width-$object.rect.x,_translate.stopXL=-$object.rect.x,_translate.stopYB=mh-$object.rect.height-$object.rect.y,_translate.stopYT=-$object.rect.y,l<0?l<(max=mw-$object.rect.width)&&(_translate.diff.sx1||(_translate.diff.sx1=_translate.diff.x),diff=_translate.diff.sx1-_translate.diff.x,x=max-$object.rect.x-.3*diff,_translate.snapX=max-$object.rect.x):(_translate.diff.sx2||(_translate.diff.sx2=_translate.diff.x),diff=_translate.diff.sx2-_translate.diff.x,x=-$object.rect.x-.3*diff,_translate.snapX=-$object.rect.x);t<0?t<(max=mh-$object.rect.height)&&(_translate.diff.sy1||(_translate.diff.sy1=_translate.diff.y),diff=_translate.diff.sy1-_translate.diff.y,y=max-$object.rect.y-.3*diff,_translate.snapY=max-$object.rect.y):(_translate.diff.sy2||(_translate.diff.sy2=_translate.diff.y),diff=_translate.diff.sy2-_translate.diff.y,y=-$object.rect.y-.3*diff,_translate.snapY=-$object.rect.y);$object.x=x,$object.y=y}(e),_rotate.enabled&&function moveRotate(e){if(!_rotate.active)return;var diff=Math.degrees(_calc.angle-_rotate.angle);(Math.abs(diff)>3||_rotate.allow)&&(_rotate.allow=!0,$object.rotation=_rotate.startAngle+diff)}()}function touchEnd(e){clearTweens(),Stage.unbind("touchmove",touchMove),_scale.enabled&&function endScale(e){if(!_scale.active||_rotate.prevent)return;_scale.saveScale=$object.scale,_scale.snap&&(_scale.tween=tween($object,{scale:_scale.snap},300,"easeOutCubic"),_scale.snap=!1);_scale.centering&&(_scale.center=tween($object,{x:_translate.origin.x,y:_translate.origin.y},300,"easeOutCubic"));defer(function(){_scale.active=!1,_scale.centering=!1})}(),_translate.enabled&&function endTranslate(e){if(_translate.haveMoverd=!1,!_translate.moving||_scale.active)return;_translate.moving=!1,_translate.start.copy($object),_translate.diff.sy1=!1,_translate.diff.sx1=!1,_translate.diff.sy2=!1,_translate.diff.sx2=!1,_translate.velocity.copy(_translate.delta).divide(_translate.time).multiply(80);var xTime=2*Math.abs(_translate.velocity.x),yTime=2*Math.abs(_translate.velocity.y),time=xTime>yTime?xTime:yTime;_scale.centering&&_translate.velocity.set(0,0);if("number"==typeof _translate.snapX)_translate.tSnapX=tween($object,{x:_translate.snapX},300,"easeOutCubic"),_translate.tStartX=tween(_translate.start,{x:_translate.snapX},300,"easeOutCubic"),_translate.snapX=!1;else if(Math.abs(_translate.velocity.x)>10){var x=$object.x+_translate.velocity.x;x<_translate.stopXR?x=_translate.stopXR:x>_translate.stopXL&&(x=_translate.stopXL),_translate.tVelX=tween($object,{x:x},time,"easeOutCubic"),_translate.tStartX=tween(_translate.start,{x:x},time,"easeOutCubic")}if("number"==typeof _translate.snapY)_translate.tSnapY=tween($object,{y:_translate.snapY},300,"easeOutCubic"),_translate.tStartY=tween(_translate.start,{y:_translate.snapY},300,"easeOutCubic"),_translate.snapY=!1;else if(Math.abs(_translate.velocity.y)>10){var y=$object.y+_translate.velocity.y;y<_translate.stopYB?y=_translate.stopYB:y>_translate.stopYT&&(y=_translate.stopYT),_translate.tVelY=tween($object,{y:y},time,"easeOutCubic"),_translate.tStartY=tween(_translate.start,{y:y},time,"easeOutCubic")}}(),_rotate.enabled&&function endRotate(e){if(!_rotate.active)return;_rotate.active=!1,_rotate.allow=!1,_rotate.prevent=!1,_rotate.startAngle=$object.rotation,_rotate.snap&&(_rotate.tweenR=tween($object,{rotation:0},300,"easeOutCubic"),_rotate.tweenS=tween(_rotate,{startAngle:0},300,"easeOutCubic"))}()}this.velocityDelta=80,$object.multiTween=!0,$object.transformPoint($object.width/2,$object.height/2),$object.rect={x:0,y:0,width:$object.width,height:$object.height,cx:$object.width/2,cy:$object.height/2},$object.scale=$object.scale||1,defer(addListeners),Render.start(loop),this.scale=function(fidelity,min,max){_scale.enabled=!0,_scale.init=$object.scale||1,_scale.saveScale=_scale.init,_scale.fidelity=100*(1-fidelity),_scale.min=min,_scale.max=max},this.translate=function(mask,bounds){_translate.enabled=!0,_translate.bounds=bounds,_translate.start=new Vector2($object.x||0,$object.y||0),_translate.origin=(new Vector2).copy(_translate.start),_translate.save=new Vector2,_translate.diff=new Vector2,_translate.delta=new Vector2,_translate.velocity=new Vector2,_translate.prevTouch=new Vector2,_translate.mask=mask,_translate.start.multiTween=!0},this.rotate=function(snap){_rotate.snap=snap,_rotate.enabled=!0,_rotate.startAngle=$object.rotation||0},this.onDestroy=function(){Render.stop(loop)},this.set("bounding",function($value){$touchArea=$value})}),Class(function GLA11y(){Inherit(this,Element);const _this=this;var $this,_groups=[],_links=[];function isVisible(group){if(group.__glseoParent){const seoHidden=!!group.__glseoParent.seoHidden,hidden=!!group.__glseoParent.hidden;return!seoHidden&&!hidden}return group.seo.enabled&&group.determineVisible()}function isDeleted(group){return group.__glseoParent?group.__glseoParent.deleted:group.deleted}function checkItemVisibility(seo){Array.prototype.slice.call(seo.div.children).forEach(div=>{let seo=div.hydraObject,group=seo&&seo.group;if(!seo||!group)return;let hidden=!group.determineVisible();hidden!==seo.hidden&&(hidden?seo.hide():seo.show(),seo.hidden=hidden)})}function loop(){for(let i=_groups.length-1;i>-1;i--){let group=_groups[i];if(isDeleted(group))return $this.removeChild(group.seo),_groups.splice(i,1);isVisible(group)?(group.seo&&group.seo.hidden&&(group.seo.hidden=!1,$this.add(group.seo)),checkItemVisibility(group.seo)):group.seo&&!group.seo.hidden&&(group.seo.hidden=!0,$this.removeChild(group.seo,!0))}for(let i=_links.length-1;i>-1;i--){let group=_links[i];if(isDeleted(group))return $this.removeChild(group.seo),_groups.splice(i,1);isVisible(group)?group.seoHidden&&(group.seoHidden=!1,group.seoDOM.forEach(obj=>obj.show())):group.seoHidden||(group.seoHidden=!0,group.seoDOM.forEach(obj=>obj.hide()))}}function aLink($object,url,label,options={}){let seo=$("link","a");return seo.group=$object.group||$object,seo.attr("href","#"===url?url:Hydra.absolutePath(url)),seo.text(label),seo.accessible(),seo.div.onfocus=_=>$object._divFocus(),seo.div.onblur=_=>$object._divBlur(),seo.div.onclick=e=>{e.preventDefault(),$object._divSelect()},options.role&&(seo.attr("role",options.role),seo.div.onkeydown=e=>{switch(e.key){case" ":case"Spacebar":e.preventDefault(),e.stopPropagation(),$object._divSelect()}}),seo}function findSeoParent($object,$suggestedParent){let parent=$suggestedParent||($object._3d?$object.anchor&&$object.anchor._parent?$object.anchor:$object.group:$object)._parent;if($object.parentSeo){let parentSeo=$object.parentSeo;parent=parentSeo.group&&parentSeo.group.seo?parentSeo.group:parentSeo}for(;parent&&!parent.seo;)if(parent.parentSeo)parent=parent.parentSeo.group||parent.parentSeo;else{if(parent.stageLayoutCapture?.parent?.$gluiObject)return findSeoParent(parent.stageLayoutCapture.parent.$gluiObject);parent=parent._parent}if(parent?.seo)return parent}function getInsertBeforeNode($object,parent,sortOrder){let before=null;if(!isNaN(sortOrder)){sortOrder=+sortOrder,$object.seo.sortOrder=sortOrder;let divs=parent.seo.children();for(let i=0;i<divs.length;++i){let div=divs[i];if(div.hydraObject.sortOrder>sortOrder){before=div;break}}}return before}function addSortOrderProperty($object,parent,initialSortOrder=$object.seo.sortOrder){let sortOrder=initialSortOrder;Object.defineProperty($object.seo,"sortOrder",{get:()=>sortOrder,set(nextSortOrder){if(nextSortOrder===sortOrder)return;sortOrder=nextSortOrder;let before=getInsertBeforeNode($object,parent,sortOrder);parent.seo.div.insertBefore($object.seo.div,before)}})}!async function(){window.GLSEO=_this,await Hydra.ready(),function initHTML(){($this=_this.element).setZ(-1),Stage.add($this)}(),HydraCSS.style(".GLA11y *",{position:"relative"})}(),this.registerPage=function(group,name){let topLevel=group;!(group=group instanceof GLUIObject?group:group.group||group.scene||group).determineVisible&&group.group&&(group.determineVisible=group.group.determineVisible.bind(group.group)),Global.PLAYGROUND||World.ELEMENT.mouseEnabled(!1),topLevel.seo=group.seo=$(name),group.seo.hidden=!0,group.seo.enabled=!0;let remove=group.seo.remove.bind(group.seo);group.seo.remove=_=>{_groups.remove(group),remove()},_groups.push(group),_this.startRender(loop,10)},this.setPageH1=function(group,title){let $h1=group.seo.h1;$h1||($h1=group.seo.create("title","h1"),group.seo.h1=$h1,defer(()=>{let el=$h1.div;el.parentNode.insertBefore(el,el.parentNode.firstChild)})),$h1.text(title)},this.registerPersist=function(group,name){let topLevel=group;group=group instanceof GLUIObject?group:group.group||group.scene||group,Global.PLAYGROUND||World.ELEMENT.mouseEnabled(!1),topLevel.seo=group.seo=$this.create(name)},this.link=function($dom,group){$dom instanceof HydraObject&&((group=group.group||group.scene||group).seoDOM||(group.seoDOM=[]),group.seoDOM.push($dom),_links.push(group)),$dom instanceof GLUIObject&&($dom.seo=group.seo)},this.textNode=function($text,text,sortOrder){let parent=findSeoParent($text);if(parent)if($text.seo){if($text.seo.text(text),$text.seo.accessible(),!isNaN(sortOrder)&&$text.seo.sortOrder!==+sortOrder){let before=getInsertBeforeNode($text,parent,sortOrder);$text.seo.div.parentNode.insertBefore($text.seo.div,before)}}else{$text.seo=$("text"),$text.seo.group=$text.group,$text.seo.text(text),$text.seo.accessible();let before=getInsertBeforeNode($text,parent,sortOrder);parent.seo.add($text.seo,before?.hydraObject),addSortOrderProperty($text,parent),$text.seo.aLink=function(url,options){let index=Array.prototype.slice.call(parent.seo.div.children).indexOf($text.seo.div),sortOrder=$text.seo.sortOrder;$text.seo.remove(),$text.seo=aLink($text,url,text,options),parent.seo.div.insertBefore($text.seo.div,parent.seo.div.children[index]),addSortOrderProperty($text,parent,sortOrder)},$text.seo.unlink=function(){parent.seo.div.removeChild($text.seo.div),$text.seo.group=null,$text.seo=null}}},this.bindToPage=function(parent,child,name){child.__glseoParent=parent,_this.registerPage(child,name)},this.objectNode=function($object,$parent){let parent=findSeoParent($object,$parent);parent&&($object.seo||($object.seo={},$object.seo.group=$object.group||$object,$object.seo.aLink=function(url,label,options){$object.seo=aLink($object,url,label,options),parent.seo.div.insertBefore($object.seo.div,getInsertBeforeNode($object,parent,options?.sortOrder)),addSortOrderProperty($object,parent),$object.seo.unlink=function(){parent.seo.div.removeChild($object.seo.div),$object.seo.group=null,$object.seo=null}}))}},"static"),Class(function GLScreenProjection(_camera=World.CAMERA,_target=new Vector2){Inherit(this,Object3D);var _this=this,_projection=new ScreenProjection(_camera),_m0=new Matrix4,_m1=new Matrix4;function loop(){_this.pos.set(_target.x,_target.y),_this.pos3D.copy(_projection.unproject(_this.pos)),_this.group.updateMatrixWorld(),_m0.copy(_camera.projectionMatrix),_m1.getInverse(_camera.matrixWorld),_this.matrix.multiplyMatrices(_m0,_m1),_this.uniforms.normalMatrix.value.copy(_camera.matrixWorld),_this.uniforms.modelMatrix.value.copy(_this.group.matrixWorld)}this.resolution=new Vector2,this.pos=new Vector2,this.pos3D=new Vector3,this.matrix=new Matrix4,this.uniforms={projMatrix:{type:"m4",value:this.matrix},pos:{type:"v2",value:this.pos},pos3D:{type:"v3",value:this.pos3D},normalMatrix:{type:"m4",value:new Matrix4},modelMatrix:{type:"m4",value:new Matrix4}},this.set("camera",v=>{_camera=v,_projection.camera=_camera}),this.set("target",v=>{_target=v}),this.update=loop,this.start=function(){_this.startRender(loop)},this.stop=function(){_this.stopRender(loop)}}),Class(function GLText({font:font,italic:italic=!1,bold:bold=!1,text:text,width:width=1/0,align:align="left",size:size=1,direction:direction="ltr",letterSpacing:letterSpacing=0,lineHeight:lineHeight=1.4,wordSpacing:wordSpacing=0,wordBreak:wordBreak=!1,langBreak:langBreak=!1,paragraphSpacing:paragraphSpacing=1,indent:indent=0,color:color=new Color("#000000"),alpha:alpha=1,shader:shader="DefaultText",customCompile:customCompile=!1}){const _this=this;var _override,_promise=Promise.create();const config=GLText.FONT_CONFIG[font];function overrideParams(){if(GLText.overrideParams){_override={letterSpacing:letterSpacing,size:size,wordSpacing:wordSpacing,lineHeight:lineHeight};let obj=GLText.overrideParams({letterSpacing:letterSpacing,size:size,wordSpacing:wordSpacing,lineHeight:lineHeight});letterSpacing=obj.letterSpacing,size=obj.size,wordSpacing=obj.wordSpacing,lineHeight=obj.lineHeight}}function resetOverride(){_override&&(letterSpacing=_override.letterSpacing,size=_override.size,wordSpacing=_override.wordSpacing,lineHeight=_override.lineHeight)}!function init(){overrideParams(),_this.charLength=text.length,_this.text=new GLTextGeometry({font:font,italic:italic,bold:bold,text:text,width:width,align:align,direction:direction,wordSpacing:wordSpacing,letterSpacing:letterSpacing,paragraphSpacing:paragraphSpacing,size:size,lineHeight:lineHeight,wordBreak:wordBreak,langBreak:langBreak,config:config,indent:indent}),_this.string=text,resetOverride(),_this.text.loaded.then(({buffers:buffers,texture:texture,textureBold:textureBold,textureItalic:textureItalic,height:height,numLines:numLines})=>{_this.deleted||(_this.texture=texture,bold&&(_this.textureBold=textureBold),italic&&(_this.textureItalic=textureItalic),_this.shader=new(shader.includes("PBR")?PBRShader:Shader)(shader,{tMap:{value:_this.texture,ignoreUIL:!0},tMapBold:{value:_this.textureBold||Utils3D.getEmptyTexture(),ignoreUIL:!0},tMapItalic:{value:_this.textureItalic||Utils3D.getEmptyTexture(),ignoreUIL:!0},uColor:{value:color,ignoreUIL:!0},uAlpha:{value:alpha,ignoreUIL:!0},transparent:!0,customCompile:customCompile}),_this.onCreateShader&&_this.onCreateShader(_this.shader),function createGeometry(buffers){_this.geometry=new Geometry,_this.geometry.addAttribute("position",new GeometryAttribute(buffers.position,3)),_this.geometry.addAttribute("uv",new GeometryAttribute(buffers.uv,2)),_this.geometry.addAttribute("local",new GeometryAttribute(buffers.local,2)),_this.geometry.addAttribute("animation",new GeometryAttribute(buffers.animation,3)),_this.geometry.addAttribute("weight",new GeometryAttribute(buffers.weight,1)),_this.geometry.setIndex(new GeometryAttribute(buffers.index,1)),_this.geometry.boundingBox=buffers.boundingBox,_this.geometry.boundingSphere=buffers.boundingSphere,_this.geometry.letterCount=buffers.letterCount+1,_this.geometry.wordCount=buffers.wordCount+1,_this.geometry.lineCount=buffers.lineCount+1}(buffers),_this.mesh=new Mesh(_this.geometry,_this.shader),_this.height=height,_promise.resolve())})}(),void 0===font&&console.log(font,text),this.destroy=function(){_this.mesh&&_this.mesh.destroy&&_this.mesh.destroy(),_this.deleted=!0},this.ready=this.loaded=function(){return _promise},this.centerY=function(){_this.mesh.position.y=.5*_this.height,_this.needsCenterY=!0},this.resize=function(options){return this.setText(text,options)},this.tweenColor=function(c,time=300,ease="easeOutCubic"){c&&color.tween(c,time,ease)},this.setColor=function(c){c&&color.set(c)},this.setText=function(txt,options){if(text==txt&&function match(options){return!options||options.font==font&&options.italic==italic&&options.bold==bold&&options.width==width&&options.align==align&&options.direction==direction&&!(options.wordSpacing>0&&options.wordSpacing!=wordSpacing)&&options.letterSpacing==letterSpacing&&options.paragraphSpacing==paragraphSpacing&&options.size==size&&options.indent==indent&&options.lineHeight==lineHeight&&!(!0===options.wordBreak&&!options.wordBreak||0==options.wordBreak&&options.wordBreak)}(options))return;if(!(text=txt))return;!function setVars(options){font=options.font||font,bold=options.bold||bold,italic=options.italic||italic,width=options.width||width,align=options.align||align,wordSpacing=options.wordSpacing||wordSpacing,letterSpacing=options.letterSpacing||letterSpacing,paragraphSpacing=options.paragraphSpacing||paragraphSpacing,size=options.size||size,lineHeight=options.lineHeight||lineHeight,wordBreak=options.wordBreak||wordBreak,langBreak=options.langBreak||langBreak,direction=options.direction||direction,indent=options.indent||indent}(options||{}),overrideParams(),_this.string=text,_this.charLength=text.length;let newGeometry=new GLTextGeometry({font:font,italic:italic,bold:bold,text:text,width:width,align:align,direction:direction,wordSpacing:wordSpacing,letterSpacing:letterSpacing,paragraphSpacing:paragraphSpacing,size:size,lineHeight:lineHeight,wordBreak:wordBreak,langBreak:langBreak,config:config,indent:indent});return _this.text=newGeometry,resetOverride(),_promise=Promise.create(),_this.text.loaded.then(({buffers:buffers,height:height})=>{_this.deleted||(_this.text===newGeometry&&(!function updateGeometry(buffers){_this.geometry.attributes.position.setArray(buffers.position),_this.geometry.attributes.uv.setArray(buffers.uv),_this.geometry.attributes.animation.setArray(buffers.animation),_this.geometry.attributes.weight.setArray(buffers.weight),_this.geometry.setIndex(buffers.index),_this.geometry.indexNeedsUpdate=!0,_this.geometry.boundingBox=buffers.boundingBox,_this.geometry.boundingSphere=buffers.boundingSphere,_this.geometry.letterCount=buffers.letterCount+1,_this.geometry.wordCount=buffers.wordCount+1,_this.geometry.lineCount=buffers.lineCount+1}(buffers),_this.height=height,_this.needsCenterY&&_this.centerY()),_promise.resolve())}),_promise},this.getData=function(){return{font:font,italic:italic,bold:bold,text:text,width:width,align:align,direction:direction,wordSpacing:wordSpacing,letterSpacing:letterSpacing,paragraphSpacing:paragraphSpacing,size:size,lineHeight:lineHeight,wordBreak:wordBreak,langBreak:langBreak,color:color,indent:indent}}},_=>{GLText.FONT_CONFIG={}}),Class(function GLTextAligner(){Inherit(this,Component);const _this=this,_stageContainer=Stage.create("stageContainer","div");let _container,_currentFont,_fonts,_glContainer=$gl(),_currentOptions={align:"center",fontSize:60,letterSpacing:0,lineHeight:1.2,width:900,baseOffset:0},_currentText="lorem ipsum dolor sit amet consectetur adipiscing elit";const inputStyles={width:"100%",padding:"8px",fontSize:"16px",backgroundColor:"#333",color:"white",border:"1px solid #666",borderRadius:"4px",cursor:"pointer",fontFamily:"monospace",display:"block"};function updateFonts(){_container&&_container.remove(),_glContainer&&GLUI.Stage.remove(_glContainer),_glContainer=$gl(),GLUI.Stage.add(_glContainer),GLText.FONT_CONFIG[_currentFont]||(GLText.FONT_CONFIG[_currentFont]={}),GLText.FONT_CONFIG[_currentFont].baseOffset=_currentOptions.baseOffset,_this.outputConfig[_currentFont]=`GLText.FONT_CONFIG['${_currentFont}'] = ${JSON.stringify(GLText.FONT_CONFIG[_currentFont],null,2)};`,_container=Stage.create("container","div"),_container.css({color:"red",width:"100%",display:"flex",justifyContent:"center"===_currentOptions.align?"center":"right"===_currentOptions.align?"flex-end":"flex-start",opacity:.5});const element=Stage.create("text","div");element.css({position:"relative",fontFamily:_fonts.find(font=>font.name===_currentFont).cssName,fontSize:_currentOptions.fontSize,textAlign:_currentOptions.align,letterSpacing:`${_currentOptions.letterSpacing}px`,lineHeight:_currentOptions.lineHeight,width:"auto"===_currentOptions.width?"auto":`${_currentOptions.width}px`,fontVariationSettings:"'wdth' 100, 'wght' 95, 'slnt' 0"}),element.text(_currentText),_container.add(element);const $el=$glText(element.div.innerText,_currentFont,parseInt(_currentOptions.fontSize),{align:_currentOptions.align,letterSpacing:_currentOptions.letterSpacing/_currentOptions.fontSize,lineHeight:_currentOptions.lineHeight,width:"auto"===_currentOptions.width?Stage.width:_currentOptions.width});$el.text.ready().then(()=>{"center"===_currentOptions.align?$el.x=Stage.width/2:"right"===_currentOptions.align?$el.x=Stage.width:$el.x=0}),_glContainer.add($el)}_this.outputConfig={},async function(){console.warn('GLTextAligner: remember to exclude it from the build by adding it to the EXCLUDE array in build.json like so: `"gltext/GLTextAligner|env!=dev"`'),await defer(),_fonts=function loadFontsData(){return ASSETS.SW.filter(path=>path.includes("fonts/")).map(path=>{const ext=path.split(".").pop(),name=path.split("fonts/").pop().split(".").shift(),cssName=name.split("/").pop(),cssExt=ASSETS.SW.filter(p=>p.includes(name)).map(p=>p.split(".").pop()).filter(ext=>!["json","png"].includes(ext));return{name:name,path:path,ext:ext,cssExt:cssExt,cssName:cssName}}).filter(font=>"json"===font.ext)}(),_currentFont=_fonts[0].name,function createFontFaces(fontsData){fontsData.forEach(font=>{const face=Stage.create("fontFace","style"),pathNoExt=font.path.split(".").slice(0,-1).join(".");(font.cssExt||[]).forEach(ext=>{face.div.innerText+=`@font-face { font-family: '${font.cssName}'; src: url('${pathNoExt}.${ext}') format('${"ttf"===ext||"otf"===ext?"opentype":ext}'); }`}),document.head.appendChild(face.div)})}(_fonts),function createFontSelector(fontsData){const selectContainer=Stage.create("fontSelector","div"),select=Stage.create("fontSelect","select");select.css(inputStyles),fontsData.forEach(font=>{const option=document.createElement("option");option.value=font.name,option.textContent=font.name,option.style.fontFamily=font.name,font.name===_currentFont&&(option.selected=!0),select.div.appendChild(option)}),select.div.addEventListener("change",e=>{_currentFont=e.target.value,updateFonts()}),selectContainer.add(select),_stageContainer.add(selectContainer)}(_fonts),function createTextInput(){const inputContainer=Stage.create("textInputContainer","div");inputContainer.css({marginTop:"10px"});const input=Stage.create("textInput","textarea");input.div.value=_currentText,input.css({...inputStyles,minHeight:"100px"}),input.div.addEventListener("change",e=>{_currentText=e.target.value,updateFonts()}),inputContainer.add(input),_stageContainer.add(inputContainer)}(),function createBaseOffsetInput(){const inputContainer=Stage.create("baseOffsetContainer","div");inputContainer.css({marginTop:"10px"});const input=Stage.create("baseOffsetInput","input");input.div.type="number",input.div.step="0.01",input.div.value=_currentOptions.baseOffset,input.css(inputStyles),input.div.addEventListener("change",e=>{_currentOptions.baseOffset=parseFloat(e.target.value),updateFonts()}),inputContainer.add(input),_stageContainer.add(inputContainer)}(),function createSaveButton(){const buttonContainer=Stage.create("saveButtonContainer","div");buttonContainer.css({marginTop:"10px"});const button=Stage.create("saveButton","button");button.text("Save"),button.css(inputStyles),button.div.addEventListener("click",()=>{console.log(Object.values(_this.outputConfig).join("\n")),navigator.clipboard.writeText(Object.values(_this.outputConfig).join("\n"))}),buttonContainer.add(button),_stageContainer.add(buttonContainer)}(),updateFonts(),_this.onResize(()=>{updateFonts()}),_stageContainer.css({position:"fixed",bottom:"20px",right:"20px",zIndex:100,width:"40vw"}),Stage.add(_stageContainer),GLUI.Stage.add(_glContainer)}()}),Class(function GLTextGeometry({font:font,italic:italic,bold:bold,text:text,width:width=1/0,align:align="left",size:size=1,direction:direction="ltr",letterSpacing:letterSpacing=0,paragraphSpacing:paragraphSpacing=1,indent:indent=0,lineHeight:lineHeight=1.4,wordSpacing:wordSpacing=0,wordBreak:wordBreak=!1,langBreak:langBreak=!1,config:config={}}){let json,texture,glyphs,bJson,bTexture,bGlyphs,iJson,iTexture,iGlyphs,_this=this;_this.loaded=Promise.create(),_this.fontLoaded=Promise.create(),async function init(){await async function loadFont(){[json,texture,glyphs]=await GLTextGeometry.loadFont(font),bold&&([bJson,bTexture,bGlyphs]=await GLTextGeometry.loadFont(bold));italic&&([iJson,iTexture,iGlyphs]=await GLTextGeometry.loadFont(italic));_this.fontLoaded.resolve()}(),async function createGeometry(){let buffers=await GLTextThread.generate({font:font,bold:bold,italic:italic,text:text,width:width,align:align,size:size,direction:direction,letterSpacing:letterSpacing,paragraphSpacing:paragraphSpacing,indent:indent,lineHeight:lineHeight,wordSpacing:wordSpacing,wordBreak:wordBreak,langBreak:langBreak,json:json,glyphs:glyphs,bJson:bJson,bGlyphs:bGlyphs,iJson:iJson,iGlyphs:iGlyphs,config:config});_this.buffers=buffers,_this.texture=texture,_this.textureBold=bTexture,_this.textureItalic=iTexture,_this.numLines=buffers.lineLength,_this.height=_this.numLines*size*lineHeight,_this.onLayout&&_this.onLayout(buffers,texture,_this.height,_this.numLines),_this.loaded.resolve({buffers:buffers,texture:texture,textureBold:bTexture,textureItalic:iTexture,height:_this.height,numLines:_this.numLines})}()}()},_=>{async function loadJSON(font){return await get(function getPathTo(font,ext){let fontName=GLTextGeometry.fontMapping[font]||font,suffix=ext?`.${ext}`:"";return Assets.getPath(`${getFontPath(font)}${fontName}${suffix}`)}(font,"json"))}function getFontPath(font){return GLTextGeometry.fontMapping[font]&&GLTextGeometry.fontPath[font]?GLTextGeometry.fontPath[font]:"assets/fonts/"}let _promises={},_fonts={};GLTextGeometry.fontMapping={},GLTextGeometry.fontPath={},GLTextGeometry.chars={},GLTextGeometry.loadFont=async function(font){let info=_fonts[font];if(!info)if(_promises[font])info=await _promises[font];else{let promise=Promise.create();_promises[font]=promise;let json=await loadJSON(font),glyphs={};json.chars.forEach(d=>glyphs[d.char]=d),GLTextGeometry.chars[font]=json.chars,info=[json,null,glyphs],_fonts[font]=info,delete _promises[font],promise.resolve(info)}return info[1]=function loadTexture(font){let base=`${getFontPath(font)}${font}`,path=[`${base}.ktx2`,Assets.supportsWebP()&&`${base}.webp`].filter(Boolean).find(candidate=>(window.ASSETS?.SW||[]).includes(candidate))||`${base}.png`,texture=Utils3D.getTexture(path);return texture.generateMipmaps=!1,texture.minFilter=Texture.LINEAR,texture}(font),info}}),Class(function GLTextThread(){function loadTextGeometry({font:font,bold:bold,italic:italic,text:text,width:width,align:align,size:size,direction:direction,letterSpacing:letterSpacing,paragraphSpacing:paragraphSpacing,lineHeight:lineHeight,wordSpacing:wordSpacing,wordBreak:wordBreak,langBreak:langBreak,json:json,glyphs:glyphs,bJson:bJson,bGlyphs:bGlyphs,iJson:iJson,iGlyphs:iGlyphs,indent:indent,config:config},pid){const newline=/\n/,whitespace=/[^\S]/,langbreak=!!langBreak&&new RegExp(langBreak),dir="rtl"===direction?-1:1;config||(config={}),config.boldBaseOffset=config.boldBaseOffset?config.boldBaseOffset:0,config.italicBaseOffset=config.italicBaseOffset?config.italicBaseOffset:0;let buffers,scale=size/json.info.size,weights=[],weight={0:glyphs,1:bGlyphs,2:iGlyphs};function getKernPairOffset(id1,id2){for(let i=0;i<json.kernings.length;i++){let k=json.kernings[i];if(!(k.first<id1)&&!(k.second<id2))return k.first>id1||k.first===id1&&k.second>id2?0:k.amount}return 0}!function setWeights(){let i=0,w=0;for(;i<text.length;){let code=text.substring(i,i+3).toLowerCase(),endcode=text.substring(i,i+4).toLowerCase();"<b>"!==code&&"<i>"!==code||(w="<b>"===code?1:2,text=text.substring(0,i)+text.substring(i+3)),"</b>"!==endcode&&"</i>"!==endcode||(w=0,text=text.substring(0,i)+text.substring(i+4)),weights.push(w),i++}}(),function createGeometry(){let numChars=text.replace(/[ \n]/g,"").length;buffers={position:new Float32Array(4*numChars*3),uv:new Float32Array(4*numChars*2),local:new Float32Array(4*numChars*2),animation:new Float32Array(3*numChars*4),index:new Uint16Array(6*numChars),weight:new Float32Array(4*numChars)};for(let i=0;i<numChars;i++)buffers.index.set([4*i,4*i+2,4*i+1,4*i+1,4*i+2,4*i+3],6*i);!function layout(){const lines=[];let cursor=0,wordCursor=0,wordWidth=0,line=newLine();function newLine(br=!1){const line={width:0,glyphs:[]};return lines.last()&&(lines.last().br=br),lines.push(line),wordCursor=cursor,wordWidth=0,line}for(;cursor<text.length;){let prev=text[cursor-1],char=text[cursor];if(!line.glyphs.length&&whitespace.test(char)&&!(prev&&newline.test(char)&&newline.test(prev))){cursor++,wordCursor=cursor,wordWidth=0;continue}if(newline.test(char)){cursor++,line=newLine(!0);continue}!cursor&&indent&&(line.width+=indent);let style=weight[weights[cursor]]||weight[0],glyph=style[char];if(glyph||(console.warn(`font ${font} missing character '${char}'`),char=Object.keys(style)[0],glyph=style[char]),glyph.weight=weights[cursor],line.glyphs.length){const prevGlyph=line.glyphs[line.glyphs.length-1][0];let kern=getKernPairOffset(glyph.id,prevGlyph.id)*scale;line.width+=kern,wordWidth+=kern*dir}let gl={...glyph};gl.weight=weights[cursor],line.glyphs.push([gl,line.width]);let advance=0;if(whitespace.test(char)&&(gl.whitespace=!0,wordCursor=cursor,wordWidth=0,advance+=wordSpacing*size),advance+=letterSpacing*size,advance+=glyph.xadvance*scale,line.width+=advance,wordWidth+=advance,line.width>width){if((wordBreak||char&&langBreak&&!langbreak.test(char))&&line.glyphs.length>1){line.width-=advance,line.glyphs.pop(),line=newLine();continue}if(!wordBreak&&wordWidth!==line.width){let numGlyphs=cursor-wordCursor+1;line.glyphs.splice(-numGlyphs,numGlyphs),cursor=wordCursor,line.width-=wordWidth,line=newLine();continue}}cursor++}line.glyphs.length||lines.pop();if("justify"===align){let max=-1/0;lines.forEach(l=>{l.whitespaces=0,max<l.width&&(max=l.width),l.glyphs.forEach(g=>{g[0].whitespace&&l.whitespaces++})}),lines.forEach(l=>{let totalToAdd=max-l.width,addToWhitespace=0===l.whitespaces?0:totalToAdd/l.whitespaces;l.width=max;let additionalOffset=0;l.glyphs.forEach(g=>{g[1]+=additionalOffset,g[0].whitespace&&(additionalOffset+=addToWhitespace)})})}!function populateBuffers(lines){const texW=json.common.scaleW,texH=json.common.scaleH,baseOffset=config.baseOffset?config.baseOffset:0;let geom,j=0,y=-size*(lineHeight-1)/2+baseOffset*size,glyphIndex=0,wordIndex=-1,lineId=-1;for(let lineIndex=0;lineIndex<lines.length;lineIndex++){const line=lines[lineIndex];wordIndex++,lineId++;for(let i=0;i<line.glyphs.length;i++){const glyph=line.glyphs[i][0];let x=line.glyphs[i][1];if(-1===dir&&(x=line.width-x),"center"===align||"justify"===align?x-=.5*line.width:"right"===align&&(x-=line.width*dir),whitespace.test(glyph.char)){wordIndex++;continue}1===glyph.weight&&(y+=config.boldBaseOffset*scale),2===glyph.weight&&(y+=config.italicBaseOffset*scale),x+=glyph.xoffset*scale*dir,y-=glyph.yoffset*scale,buffers.weight.set([glyph.weight,glyph.weight,glyph.weight,glyph.weight],4*glyphIndex);const w=glyph.width*scale,h=glyph.height*scale;-1===dir?buffers.position.set([x-w,y-h,0,x-w,y,0,x,y-h,0,x,y,0],4*j*3):buffers.position.set([x,y-h,0,x,y,0,x+w,y-h,0,x+w,y,0],4*j*3),buffers.animation.set([glyphIndex,wordIndex,lineId,glyphIndex,wordIndex,lineId,glyphIndex,wordIndex,lineId,glyphIndex,wordIndex,lineId],3*glyphIndex*4),glyphIndex++;const u=glyph.x/texW,uw=glyph.width/texW,v=1-glyph.y/texH,vh=glyph.height/texH;buffers.uv.set([u,v-vh,u,v,u+uw,v-vh,u+uw,v],4*j*2),buffers.local.set([0,1,0,0,1,1,1,0],4*j*2),1===glyph.weight&&(y-=config.boldBaseOffset*scale),2===glyph.weight&&(y-=config.italicBaseOffset*scale),y+=glyph.yoffset*scale,j++}y-=size*lineHeight*(line.br?paragraphSpacing:1)}window.zUtils3D&&(geom=new Geometry,geom.addAttribute("position",new GeometryAttribute(buffers.position,3)),geom.computeBoundingBox(),geom.computeBoundingSphere());let backing=[];for(let key in buffers)backing.push(buffers[key].buffer);buffers.lineLength=lines.length,geom&&(buffers.boundingBox=geom.boundingBox,buffers.boundingSphere=geom.boundingSphere);buffers.letterCount=glyphIndex,buffers.lineCount=lineId,buffers.wordCount=wordIndex,resolve(buffers,pid,backing)}(lines)}()}()}Thread.upload(loadTextGeometry),this.generate=async function(obj){return Thread.shared().loadTextGeometry(obj)}},"static"),Class(function GLUI(){Inherit(this,Component);const _this=this,hasMetal=!!window.Metal,hasAuraAR=!!window.AURA_AR;function loop(){hasMetal||(hasAuraAR&&AURA_AR.active&&(World.NUKE.postRender=null,AURA_AR.postRender=loop),_this.Scene&&_this.Scene.render(),_this.Stage&&_this.Stage.render())}window.$gl=window.glObject=function(width,height,map,customCompile){return new GLUIObject(width,height,map,customCompile)},window.$glText=window.glText=function(text,fontName,fontSize,options,customCompile){return new GLUIText(text,fontName,fontSize,options,customCompile)},this.init=async function(is2D,is3D){_this.initialized||(void 0===is2D&&(is2D=!0,is3D=!0),await AssetLoader.waitForLib("zUtils3D"),is2D&&(_this.Stage=new GLUIStage),is3D&&(_this.Scene=new GLUIStage3D,_this.Scene.interaction.input=Mouse),_this.wait(World,"NUKE",_=>{_this.initialized=!0,_this.Scene&&(World.NUKE.onBeforeRender=_this.Scene.mark),World.NUKE.postRender=loop}))},this.clear=function(){_this.Stage.clear(),_this.Scene.clear()},this.ready=function(){return _this.wait(_this,"initialized")},this.renderDirect=function(render){_this.Scene&&_this.Scene.renderDirect(render),_this.Stage&&_this.Stage.renderDirect(render)}},"static"),Class(function GLUIElement(){Inherit(this,Component);this.element=$gl(),this.create=function(w,h,t){return this.element.create(w,h,t)}}),Class(function GLUIUtils(){const _this=this;_this.setRetinaMode=function($obj,retinaMode,parent){if(RenderManager.type===RenderManager.WEBVR&&(retinaMode=!1),parent||(parent=$obj.anchor&&$obj.anchor._parent||$obj.group._parent))if(retinaMode){let gluiToRTScene,p=parent;for(;p;)p.glSceneEnabled&&(gluiToRTScene=p),p=p.parent;gluiToRTScene?gluiToRTScene.glScene.add($obj):GLUI.Scene.add($obj),parent.add($obj.anchor),$obj.anchor.retinaAnchorFor=$obj,$obj.group.asyncPromise&&!$obj.anchor.asyncPromise&&($obj.anchor.asyncPromise=$obj.group.asyncPromise),$obj.anchor.position.equals($obj.group.position)&&$obj.anchor.scale.equals($obj.group.scale)&&$obj.anchor.quaternion.equals($obj.group.quaternion)||($obj.isDirty=!0,$obj.mesh&&$obj.mesh.onBeforeRender&&$obj.mesh.onBeforeRender())}else _this.isRetinaMode($obj)&&(parent.remove($obj.anchor),GLUI.Scene.remove($obj),$obj.anchor._parent=null,$obj.group.visible=parent.determineVisible(),"boolean"==typeof $obj.isDirty&&$obj.mesh&&$obj.mesh.onBeforeRender?($obj.isDirty=!0,$obj.mesh.onBeforeRender()):($obj.group.position.setScalar(0),$obj.group.quaternion.set(0,0,0,1),$obj.group.scale.setScalar(1)),$obj.deferred=!1,$obj.parent=null),parent.add($obj.group)},_this.isRetinaMode=function($obj){return RenderManager.type!==RenderManager.WEBVR&&$obj.anchor&&$obj.anchor._parent&&$obj.parent===GLUI.Scene}},"static"),Class(function GLUIBatch(globalUniforms={},_useWorldCoords,cacheSuffix=""){Inherit(this,Component);const _this=this;var _timer,_geometry,_shader,_objects=[];function loop(){if(!_geometry)return;let parent=_this.group._parent;for(;parent;){if(parent.isRenderingCheck&&!parent.isRenderingCheck())return;parent=parent._parent}let len=_objects.length;for(let i=0;i<len;i++){let obj=_objects[i];if(obj._buffers){obj.mesh.onBeforeRender(),_useWorldCoords&&(obj.group.updateMatrixWorld(),obj.mesh.getWorldPosition(obj.worldPosition),obj.worldRotation.setFromQuaternion(obj.mesh.getWorldQuaternion()),obj.mesh.getWorldScale(obj.worldScale));for(let j=obj._buffers.length-1;j>-1;j--){let buffer=obj._buffers[j],dirty=!1;if(dirty=!buffer.value.equals(buffer.lookup),buffer.value.copy(buffer.lookup),dirty){let attribute=_geometry.attributes[buffer.key],array=attribute.array;switch(buffer.key){case"scale":_useWorldCoords?(array[2*i+0]=obj.worldScale.x,array[2*i+1]=obj.worldScale.y):(array[2*i+0]=obj.group.scale.x*obj.mesh.scale.x,array[2*i+1]=obj.group.scale.y*obj.mesh.scale.y);break;case"rotation":array[i]=buffer.lookup.z;break;default:_useWorldCoords?(array[3*i+0]=obj.worldPosition.x,array[3*i+1]=obj.worldPosition.y):(array[3*i+0]=obj.group.position.x,array[3*i+1]=obj.group.position.y),array[3*i+2]=obj.mesh.renderOrder}attribute.needsUpdate=!0}}for(let j=obj._uniforms.length-1;j>-1;j--){let uniform=obj._uniforms[j],dirty=!1;if("f"==uniform.type?(dirty=obj.mesh.shader.uniforms[uniform.key].value!=uniform.value,uniform.value=obj.mesh.shader.uniforms[uniform.key].value):(dirty=!obj.mesh.shader.uniforms[uniform.key].value.equals(uniform.value),uniform.value.copy(obj.mesh.shader.uniforms[uniform.key].value)),dirty){let attribute=_geometry.attributes["a_"+uniform.key],array=attribute.array;"f"==uniform.type?array[i]=uniform.value:uniform.value.toArray(array,i*uniform.components),attribute.needsUpdate=!0}}}}}function getTypeFromSize(size){switch(size){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}}function createMesh(){let shader=_objects[0].mesh.shader;_geometry=(new Geometry).instanceFrom(_objects[0].mesh.geometry.clone());let map={},arrays={};_objects.forEach((obj,i)=>{obj.mesh.onBeforeRender();let buffers=[],uniforms=[];for(let key in shader.uniforms){let uniform=shader.uniforms[key];uniform&&(uniform.value instanceof Color&&uniforms.push({key:key,type:"c",components:3}),uniform.value instanceof Vector4&&uniforms.push({key:key,type:"v4",components:4}),uniform.value instanceof Vector3&&uniforms.push({key:key,type:"v3",components:3}),uniform.value instanceof Vector2&&uniforms.push({key:key,type:"v",components:2}),"number"==typeof uniform.value&&uniforms.push({key:key,type:"f",components:1}))}_useWorldCoords&&(obj.worldScale=new Vector3,obj.worldRotation=new Euler,obj.worldPosition=new Vector3),buffers.push({key:"scale",lookup:_useWorldCoords?obj.worldScale:obj.group.scale,components:2}),buffers.push({key:"rotation",lookup:_useWorldCoords?obj.worldRotation:obj.group.rotation,components:1}),buffers.push({key:"offset",lookup:_useWorldCoords?obj.worldPosition:obj.group.position,components:3}),uniforms.forEach(uniform=>{arrays["a_"+uniform.key]||(arrays["a_"+uniform.key]=[]),map["a_"+uniform.key]||(map["a_"+uniform.key]=uniform);let value=shader.uniforms[uniform.key].value;"object"==typeof value?(uniform.value=value.clone(),uniform.value.toArray(arrays["a_"+uniform.key],i*uniform.components)):(uniform.value=shader.uniforms[uniform.key].value,arrays["a_"+uniform.key].push(uniform.value))}),buffers.forEach(buffer=>{switch(arrays[buffer.key]||(arrays[buffer.key]=[]),map[buffer.key]||(map[buffer.key]=buffer),buffer.value=buffer.lookup.clone(),buffer.key){case"scale":arrays[buffer.key].push(obj.group.scale.x*obj.mesh.scale.x,obj.group.scale.y*obj.mesh.scale.y);break;case"rotation":arrays[buffer.key].push(buffer.lookup.z);break;default:arrays[buffer.key].push(buffer.lookup.x,buffer.lookup.y,obj.mesh.renderOrder)}}),obj._buffers=buffers,obj._uniforms=uniforms,obj.shader.neverRender=!0});let attributes=[],defines=[];for(let key in map)key.includes("a_")&&(attributes.push(`% ${getTypeFromSize(map[key].components)} ${key};`),defines.push(`${key.replace("a_","v_")} = ${key};`));attributes=attributes.join("\n"),defines=defines.join("\n");for(let key in arrays)_geometry.addAttribute(key,new GeometryAttribute(new Float32Array(arrays[key]),map[key].components,1));let cacheKey=shader.fsName+cacheSuffix;if(GLUIBatch.cache[cacheKey])_shader=GLUIBatch.cache[cacheKey];else{(_shader=_this.initClass(Shader,"GLUIBatch",shader.fsName,Object.assign({},{transparent:!0,depthWrite:!1,depthTest:!1,customCompile:Utils.uuid()},globalUniforms))).vertexShader||_shader.resetProgram();let vsSplit=_shader.vertexShader.split("__ACTIVE_THEORY_LIGHTS__"),fsSplit=_shader.fragmentShader.split("__ACTIVE_THEORY_LIGHTS__"),definitions=[];fsSplit[1].split("\n").forEach(line=>{if(line.includes("uniform")){if(line.includes("sampler2D"))return;let data=line.split(" ");definitions.push(`${data[2].replace(";","")} = a_${data[2]}`),vsSplit[1]=`\nattribute ${data[1]} a_${data[2]}\nvarying ${data[1]} ${data[2]}`+vsSplit[1],vsSplit[1]=vsSplit[1].replace(line,""),fsSplit[1]=fsSplit[1].replace(line,`varying ${data[1]} ${data[2]}`)}}),vsSplit[1]=vsSplit[1].replace("//vdefines","\n"+definitions.join("\n")),_shader.vertexShader=vsSplit.join("__ACTIVE_THEORY_LIGHTS__"),_shader.fragmentShader=fsSplit.join("__ACTIVE_THEORY_LIGHTS__"),GLUIBatch.cache[cacheKey]=_shader}shader.replicateUniformsTo(_shader),_this.mesh=new Mesh(_geometry,_shader),_this.mesh.frustumCulled=!1,_this.group.add(_this.mesh)}this.group=new Group,"boolean"==typeof globalUniforms&&(_useWorldCoords=globalUniforms,globalUniforms={}),GLUIBatch.cache||(GLUIBatch.cache={}),_this.startRender(loop),this.add=function(obj){if(clearTimeout(_timer),_timer=_this.delayedCall(createMesh,50),_useWorldCoords){let getAlpha=obj.getAlpha;getAlpha&&(obj.getAlpha=()=>(_this.parent?_this.parent.getAlpha():1)*getAlpha.call(obj))}else _this.parent?.add?.(obj);_objects.push(obj)},this.setZ=async function(z){await _this.wait("mesh"),_this.mesh.renderOrder=z},this.onDestroy=function(){_this.mesh&&_this.mesh.destroy()}}),Class(function GLUIBatchText(globalUniforms={},_useWorldCoords,_shaderName){Inherit(this,Component);const _this=this;var _geometry,_shader,_timer,_forceUpdate,_promises=[],_toSplice=[],_objects=[],_offset=0;function loop(){if(!_geometry)return;let updated=!1;for(let key in _geometry.attributes){let attrib=_geometry.attributes[key];attrib.updateRange.length&&(attrib.updateRange.length=0)}let len=_objects.length;for(let i=0;i<len;i++){let obj=_objects[i];obj.mesh.onBeforeRender(),_useWorldCoords&&(obj.group.updateMatrixWorld(),obj.mesh.getWorldPosition(obj.worldPosition),obj.worldRotation.setFromQuaternion(obj.mesh.getWorldQuaternion()),obj.mesh.getWorldScale(obj.worldScale));let offset=obj._offset,count=obj._count,end=offset+count;obj._buffers.forEach(buffer=>{let dirty=!1;if(dirty=!buffer.value.equals(buffer.lookup),buffer.value.copy(buffer.lookup),dirty){let array=_geometry.attributes[buffer.key].array;for(let j=offset;j<end;j++)switch(buffer.components){case 4:array[4*j+0]=buffer.lookup.x,array[4*j+1]=buffer.lookup.y,array[4*j+2]=buffer.lookup.z,array[4*j+3]=buffer.lookup.w;break;case 3:array[3*j+0]=buffer.lookup.x,array[3*j+1]=buffer.lookup.y,array[3*j+2]=buffer.lookup.z;break;case 2:array[2*j+0]=buffer.lookup.x,array[2*j+1]=buffer.lookup.y;break;case 1:array[j]=buffer.lookup.z}updated=!0,buffer.updateRange.offset=offset*buffer.components,buffer.updateRange.count=count*buffer.components,_geometry.attributes[buffer.key].updateRange.push(buffer.updateRange),_geometry.attributes[buffer.key].needsUpdate=!0}}),obj._uniforms.forEach(uniform=>{let dirty=!1;if("f"==uniform.type?(dirty=obj.mesh.shader.uniforms[uniform.key].value!=uniform.value,uniform.value=obj.mesh.shader.uniforms[uniform.key].value):(dirty=!obj.mesh.shader.uniforms[uniform.key].value.equals(uniform.value),uniform.value.copy(obj.mesh.shader.uniforms[uniform.key].value)),dirty||_forceUpdate){let array=_geometry.attributes["a_"+uniform.key].array;for(let j=offset;j<end;j++)"f"==uniform.type?array[j]=obj.mesh.shader.uniforms[uniform.key].value:obj.mesh.shader.uniforms[uniform.key].value.toArray(array,j*uniform.components);updated=!0,uniform.updateRange.offset=offset*uniform.components,uniform.updateRange.count=count*uniform.components,_geometry.attributes["a_"+uniform.key].updateRange.push(uniform.updateRange),_geometry.attributes["a_"+uniform.key].needsUpdate=!0}})}if(updated)for(let key in _geometry.attributes){let bottom,attrib=_geometry.attributes[key];if(!attrib.updateRange.length)continue;let toSplice=_toSplice;toSplice.length=0;for(let i=0;i<attrib.updateRange.length;i++){let current=attrib.updateRange[i],prev=attrib.updateRange[i-1];prev?prev.offset+prev.count==current.offset?(bottom.count+=current.count,toSplice.push(i)):bottom=current:bottom=current}for(let i=toSplice.length-1;i>-1;i--)attrib.updateRange.splice(toSplice[i],1)}_forceUpdate=!1}async function createMesh(){if(_this.flag("mesh"))return;_this.flag("mesh",!0),await Promise.all(_promises),await _this.wait(100);let mesh=new Mesh(_geometry,_shader);_this.mesh=mesh,mesh.frustumCulled=!1,_this.group.add(mesh)}this.group=new Group,this.enable3D=()=>{},"boolean"==typeof globalUniforms&&(_useWorldCoords=globalUniforms,globalUniforms={}),_this.flag("canLoad",!0),_this.startRender(loop),_this.add=async function(obj){if(await _this.flag("canLoad"),_this.destroy){if(_this.flag("canLoad",!1),await obj.loaded(),obj.mesh.shader.neverRender=!0,_promises.push(obj.loaded()),function addAttributes(obj,mesh){let{geometry:geometry,shader:shader}=mesh,count=geometry.attributes.uv.count;mesh.onBeforeRender();let buffers=[],uniforms=[];for(let key in shader.uniforms){let uniform=shader.uniforms[key];uniform.value instanceof Color&&uniforms.push({key:key,type:"c",components:3}),uniform.value instanceof Vector3&&uniforms.push({key:key,type:"v3",components:3}),uniform.value instanceof Vector4&&uniforms.push({key:key,type:"v4",components:4}),uniform.value instanceof Vector2&&uniforms.push({key:key,type:"v",components:2}),"number"==typeof uniform.value&&uniforms.push({key:key,type:"f",components:1})}_useWorldCoords&&(obj.worldScale=new Vector3,obj.worldRotation=new Euler,obj.worldPosition=new Vector3),buffers.push({key:"offset",lookup:_useWorldCoords?obj.worldPosition:obj.group.position,components:3}),buffers.push({key:"scale",lookup:_useWorldCoords?obj.worldScale:obj.group.scale,components:2}),buffers.push({key:"rotation",lookup:_useWorldCoords?obj.worldRotation:obj.group.rotation,components:1}),uniforms.forEach(uniform=>{uniform.updateRange={},uniform.value=shader.uniforms[uniform.key].value,"object"==typeof uniform.value&&(uniform.value=uniform.value.clone()),uniform.buffer=new Float32Array(count*uniform.components)}),buffers.forEach(buffer=>{buffer.updateRange={},buffer.value=buffer.lookup.clone(),buffer.buffer=new Float32Array(count*buffer.components)});for(let i=0;i<count;i++)buffers.forEach(buffer=>{switch(buffer.components){case 4:buffer.buffer[4*i+0]=buffer.lookup.x,buffer.buffer[4*i+1]=buffer.lookup.y,buffer.buffer[4*i+2]=buffer.lookup.z,buffer.buffer[4*i+3]=buffer.lookup.w;break;case 3:buffer.buffer[3*i+0]=buffer.lookup.x,buffer.buffer[3*i+1]=buffer.lookup.y,buffer.buffer[3*i+2]=buffer.lookup.z;break;case 2:buffer.buffer[2*i+0]=buffer.lookup.x,buffer.buffer[2*i+1]=buffer.lookup.y;break;case 1:buffer.buffer[i]=buffer.lookup.z}}),uniforms.forEach(uniform=>{"f"==uniform.type?uniform.buffer[i]=shader.uniforms[uniform.key].value:shader.uniforms[uniform.key].value.toArray(uniform.buffer,i*uniform.components)});buffers.forEach(buffer=>{geometry.addAttribute(buffer.key,new GeometryAttribute(buffer.buffer,buffer.components))}),uniforms.forEach(uniform=>{geometry.addAttribute("a_"+uniform.key,new GeometryAttribute(uniform.buffer,uniform.components))}),obj._offset=_offset,obj._count=count,obj._uniforms=uniforms,obj._buffers=buffers,_objects.push(obj),_offset+=count}(obj,obj.mesh),_useWorldCoords){let getAlpha=obj.getAlpha;getAlpha&&(obj.getAlpha=()=>(_this.parent?_this.parent.getAlpha():1)*getAlpha.call(obj))}else _this.parent.add(obj);_geometry?_geometry.merge(obj.mesh.geometry):function initGeometry(mesh){(_shader=_this.initClass(Shader,_shaderName||"GLUIBatchText",_shaderName||mesh.shader.fsName,Object.assign({},{transparent:!0,depthWrite:!1,customCompile:`${mesh.shader.vsName}|${mesh.shader.fsName}|instance`},globalUniforms))).vertexShader||_shader.resetProgram();let vsSplit=_shader.vertexShader.split("__ACTIVE_THEORY_LIGHTS__"),fsSplit=_shader.fragmentShader.split("__ACTIVE_THEORY_LIGHTS__"),definitions=[],definitionSplit=[];fsSplit[1].split("\n").forEach(line=>{if(line.includes("uniform")){if(line.includes("sampler2D"))return;let data=line.split(" ");definitions.push(`${data[2].replace(";","")} = a_${data[2]}`),vsSplit[1]=`\nattribute ${data[1]} a_${data[2]}\nvarying ${data[1]} ${data[2]}`+vsSplit[1],vsSplit[1]=vsSplit[1].replace(line,""),fsSplit[1]=fsSplit[1].replace(line,`varying ${data[1]} ${data[2]}`)}}),definitions.forEach(def=>definitionSplit.push(def.split(" =")[0].trim()));let baseVS=Shaders.getShader(mesh.shader.vsName+".vs");if(baseVS.includes("//start batch main")){let main=baseVS.split("//start batch main")[1].split("//end batch main")[0];vsSplit[1]=vsSplit[1].replace("//custommain",main);let beforeMain=baseVS.split("void main() {")[0];beforeMain=beforeMain.replace("uniform sampler2D tMap;",""),beforeMain=beforeMain.replace("varying vec2 vUv;",""),beforeMain.split("\n").forEach(line=>{definitionSplit.forEach(def=>{line.includes(def)&&line.includes(["uniform","varying"])&&(beforeMain=beforeMain.replace(line,""))})}),vsSplit[0]+=beforeMain}vsSplit[1]=vsSplit[1].replace("//vdefines","\n"+definitions.join("\n")),_shader.vertexShader=vsSplit.join("__ACTIVE_THEORY_LIGHTS__"),_shader.fragmentShader=fsSplit.join("__ACTIVE_THEORY_LIGHTS__"),mesh.shader.copyUniformsTo(_shader),_geometry=mesh.geometry.clone();for(let key in _geometry.attributes)_geometry.attributes[key].updateRange=[]}(obj.mesh),_this.flag("canLoad",!0),clearTimeout(_timer),_timer=_this.delayedCall(createMesh,50),obj.isDirty=!0}},_this.forceUpdate=function(){_forceUpdate=!0},_this.onDestroy=function(){_this.mesh&&_this.mesh.destroy()}}),Class(function GLUIStageInteraction2D(_camera,_scene,_stage,_custom){Inherit(this,Component);const _this=this;var _ray,_over,_click,_customTest,_disabled,_blocked,_test=[],_objects=this.objects=[],_hold=new Vector2,_lastTestedPoint=(new Vector2,new Vector2),_plane=new Plane;function cacheTopScene(obj){let p=obj;for(;p;)p instanceof Scene&&(obj.interactionScene=p),p=p._parent}function testObjects(){let objects=GLUI.Stage.interaction.objects;_test.length=0;for(let i=objects.length-1;i>-1;i--){let obj=objects[i];obj.interactionScene||cacheTopScene(obj),(obj.forceGLUIInteraction||obj.determineVisible()&&_scene==obj.interactionScene)&&_test.push(obj)}return _test}function externalStart(){_this._invisible||start(_lastTestedPoint)}function externalRelease(){_this._invisible||end(_lastTestedPoint)}function move(e){if(GLUI.PREVENT_INTERACTION||_this._invisible||_disabled||_blocked)return;_ray||((_ray=new Raycaster(_camera)).testVisibility=!1);let objects=testObjects();if(!objects.length)return void(_over&&(_over._onOver({action:"out",object:_over}),_over=null,Stage.cursor("auto")));let hit=_ray.checkHit(objects,e,_stage);try{if(hit[0]){_customTest||(GLUI.HIT=!0);let obj=hit[0].object.glui;_over||((_over=obj)._onOver({action:"over",object:obj}),Stage.cursor("pointer")),_over!=obj&&(_over._onOver({action:"out",object:_over}),(_over=obj)._onOver({action:"over",object:obj}),Stage.cursor("pointer"))}else _customTest||(GLUI.HIT=!1),_over&&(_over._onOver({action:"out",object:_over}),_over=null,Stage.cursor("auto"))}catch(e){console.warn(e)}}function start(e){let handlingEvent=!(e instanceof Vector2),checkDefault=GLUI.PREVENT_DEFAULT_INTERACTION&&handlingEvent,checkPrevention=GLUI.PREVENT_INTERACTION||_this._invisible||_disabled||_blocked;checkDefault||checkPrevention||(_custom&&handlingEvent||!Device.mobile&&RenderManager.type!=RenderManager.WEBVR||move(e),_over&&!_click&&(_click=_over,_hold.copy(e),_hold.time=Date.now()))}function end(e){if(!(GLUI.PREVENT_INTERACTION||_this._invisible||_disabled||_blocked)){if(_customTest&&Device.mobile&&_click&&null==_over&&(_over=_click),GLUI.HIT=!1,_click){if(Date.now()-_hold.time>750)return _click=null;if(_click==_over)try{_blocked=!0,_this.delayedCall(_=>{_blocked=!1},_this.preventDoubleClickTime),_click._onClick({action:"click",object:_click}),(Device.mobile||_custom)&&_over&&(_over._onOver({action:"out",object:_over}),_over=null,Stage.cursor("auto"))}catch(e){console.warn(e)}}_click=null}}function findCapture(object){let capture=object.__slc;return void 0===capture&&window.UI3D?object.__slc=UI3D.findStageLayoutCapture(object)||null:capture}this.preventDoubleClickTime=300,function addListeners(){_custom||_this.events.sub(Mouse.input,Interaction.MOVE,move),_this.events.sub(Mouse.input,Interaction.START,start),_this.events.sub(Mouse.input,Interaction.END,end),_this.events.sub(Interaction3D.EXTERNAL_PRESS,externalStart),_this.events.sub(Interaction3D.EXTERNAL_RELEASE,externalRelease)}(),_this.startRender(_=>{}),this.add=function(obj){obj&&_objects.push(obj.mesh||obj)},this.remove=function(obj){obj&&_objects.remove(obj.mesh||obj)},this.testWith=function(point,id){point.customTest=!0,_lastTestedPoint.copy(point),_lastTestedPoint.customTest=!0,_customTest=!0,move(point),Device.mobile&&RenderManager.type!=RenderManager.WEBVR&&_over&&start(point)},this.testWithFinger=function(point,distance,minDistance){_ray||((_ray=new Raycaster(_camera)).testVisibility=!1),_customTest=!0;let objects=testObjects();if(objects.length)if(distance<.02){let hit=_ray.checkHit(objects,point,_stage);try{if(hit[0]){let obj=hit[0].object.glui;(!obj._preventClickTime||Render.TIME-obj._preventClickTime>_this.preventDoubleClickTime)&&(obj._requiresClear||(_over=obj,obj._onOver({action:"over",object:obj}),obj._onClick({action:"click",object:obj}),obj._preventClickTime=Render.TIME,obj._requiresClear=!0))}else _over&&(_over._requiresClear=!1,_over._onOver({action:"out",object:_over}),_over=null)}catch(e){console.warn(e)}}else _over&&(_over._requiresClear=!1,_over._onOver({action:"out",object:_over}),_over=null)},this.checkObjectHit=function(object,mouse){let capture=findCapture(object);return capture?capture.checkObjectHit(object.mesh||object,mouse):(_ray||((_ray=new Raycaster(_camera)).testVisibility=!1),_ray.checkHit(object.mesh||object,mouse,_stage)[0])},this.checkObjectFromValues=function(object,origin,direction){let capture=findCapture(object);return capture?capture.checkObjectFromValues(object.mesh||object,origin,direction):(_ray||((_ray=new Raycaster(_camera)).testVisibility=!1),_ray.checkFromValues(object.mesh||object,origin,direction)[0])},this.getObjectHitLocalCoords=function(v,object,mouse){let capture=findCapture(object);if(capture)return capture.getObjectHitLocalCoords(v,object,mouse);let hit=_this.checkObjectHit(object,mouse);if(hit)return v.copy(hit.point),hit.object.worldToLocal(v);{let mesh=object.mesh||object;return _plane.normal.set(0,0,1).applyQuaternion(mesh.getWorldQuaternion()),_plane.constant=-mesh.getWorldPosition().dot(_plane.normal),_ray.ray.intersectPlane(_plane,v),mesh.worldToLocal(v)}},this.set("_disabled",v=>{(_disabled=v)&&(_click=null,_over&&(_over._onOver({action:"out",object:_over}),_over=null,Stage.cursor("auto")))}),this.onInvisible=()=>{_click=null,_over&&(_over._onOver({action:"out",object:_over}),_over=null,Stage.cursor("auto"))}}),Class(function GLUIStageInteraction3D(){Inherit(this,Component);function onHover(e){e.mesh.glui._onOver({action:e.action,object:e.mesh.glui})}function onClick(e){e.mesh.glui._onClick({action:e.action,object:e.mesh.glui})}this.add=function(obj,camera=World.CAMERA){Interaction3D.find(camera).add(obj.mesh||obj,onHover,onClick)},this.remove=function(obj,camera=World.CAMERA){Interaction3D.find(camera).remove(obj.mesh||obj)},this.checkObjectHit=function(object,mouse,camera=World.CAMERA){return Interaction3D.find(camera).checkObjectHit(object.mesh,mouse)},this.checkObjectFromValues=function(object,origin,direction,camera=World.CAMERA){return Interaction3D.find(camera).checkObjectFromValues(object.mesh,origin,direction)},this.getObjectHitLocalCoords=function(v,object,mouse,camera=World.CAMERA){return Interaction3D.find(camera).getObjectHitLocalCoords(v,object.mesh,mouse)}}),Class(function GLUICornerPin($obj){Inherit(this,Component);const _this=this;var _geom,_vertices,_last;function loop(){_vertices[0]=_this.tl.x,_vertices[1]=-_this.tl.y,_vertices[3]=_vertices[9]=_this.bl.x,_vertices[4]=_vertices[10]=-_this.bl.y,_vertices[6]=_vertices[15]=_this.tr.x,_vertices[7]=_vertices[16]=-_this.tr.y,_vertices[12]=_this.br.x,_vertices[13]=-_this.br.y,function dirty(){let a=_vertices,b=_last;for(let i=a.length-1;i>-1;i--)if(a[i]!=b[i])return!0;return!1}()&&(_geom.attributes.position.needsUpdate=!0),_last.set(_vertices)}this.tl=new Vector2(0,0),this.tr=new Vector2($obj.width,0),this.bl=new Vector2(0,$obj.height),this.br=new Vector2($obj.width,$obj.height),function initGeometry(){_geom=$obj.mesh.geometry.toNonIndexed(),$obj.useGeometry(_geom),$obj.mesh.scale.set(1,1,1),_vertices=_geom.attributes.position.array,_last=new Float32Array(_vertices)}(),_this.startRender(loop),this.update=function(){this.tl.set(0,0),this.tr.set($obj.width,0),this.bl.set(0,$obj.height),this.br.set($obj.width,$obj.height)},this.tween=function(type,val,time,ease,delay){return val=val instanceof Vector2?val:new Vector2(val.x,val.y),tween(_this[type],val,time,ease,delay)}});class GLUIObject{constructor(width,height,map,customCompile){let shader=this.textureShader=new Shader("GLUIObject",{tMap:{value:null},uAlpha:{type:"f",value:1},transparent:!0,depthTest:!1,customCompile:customCompile});shader.persists=!0,map||(shader.visible=!1),this.usingMap=null!=map&&"empty"!=map&&""!=map,this.tMap=shader.uniforms.tMap,this.group=new Group,this.alpha=1,this._x=0,this._y=0,this._z=0,this._scaleX=1,this._scaleY=1,this._scale=1,this._rotation=0,this.multiTween=!0,this.children=[],this.dimensions=new Vector3(width,height,1),this._shader=shader,this.mesh=new Mesh(GLUIObject.getGeometry("2d"),shader),this.mesh.glui=this,this.group.add(this.mesh),shader.mesh=this.mesh,window.GLSEO&&GLSEO.objectNode(this),this.bg("string"==typeof map?map.includes(["#","0x"])?map:"empty"===map||""===map?null:Utils3D.getTexture(map,{premultiplyAlpha:!1}):map);const _this=this;this.mesh.onBeforeRender=_=>{if(!_this.mesh.determineVisible()&&_this.firstRender)return;let alpha=_this.getAlpha();if(_this.mesh.shader.uniforms.uAlpha&&(_this.mesh.shader.uniforms.uAlpha.value=alpha),_this.usingMap)if(alpha<.001){if(_this.mesh.neverRender=!0,_this.mesh.shader.visible=!1,!_this.isDirty&&_this.firstRender)return}else _this.mesh.neverRender=!1,_this.mesh.shader.visible=!0;if(!_this.isDirty&&_this.firstRender)return;RenderStats.active&&RenderStats.update("GLUIObject",1,_this.mesh.shader.vsName+"|"+_this.mesh.shader.fsName,_this.mesh),_this.group.position.x=_this._x,_this.group.position.y=_this._3d?_this._y:-_this._y,_this.group.position.z=_this._z,1!=_this.scale&&(_this.group.position.x+=(_this.dimensions.x-_this.dimensions.x*_this.scale)/2,_this.group.position.y-=(_this.dimensions.y-_this.dimensions.y*_this.scale)/2);_this.mesh.shader;if(_this.calcMask){let v=_this.isMasked;v.copy(v.origin),_this.group.localToWorld(v),v.z=v.width,v.w=v.height}map?_this.corners||(_this.mesh.scale.set(1,1,1).multiply(_this.dimensions),_this.group.scale.x=_this._scaleX*_this._scale,_this.group.scale.y=_this._scaleY*_this._scale):_this.group.scale.set(_this._scaleX*_this._scale,_this._scaleY*_this._scale,1),_this._3d?_this.anchor&&_this.anchor._parent?(_this.anchor.position.copy(_this.group.position),_this.anchor.scale.copy(_this.group.scale),_this.anchor.quaternion.setFromEuler(_this._rotation),_this.anchor.isDirty=!0):(_this.group.quaternion.setFromEuler(_this._rotation),_this.group.matrixDirty=!0):_this.group.rotation.z=Math.radians(_this._rotation),_this.firstRender||(_this.group.updateMatrixWorld(!0),_this.firstRender=!0,_this.onMountedHook&&_this.onMountedHook()),_this.isDirty=!1},_this.isDirty=!0}get width(){return this.dimensions.x}set width(w){let dirty=Math.abs(this.dimensions.x-w)>Base3D.DIRTY_EPSILON;this.dimensions.x=w,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get height(){return this.dimensions.y}set height(h){let dirty=Math.abs(this.dimensions.y-h)>Base3D.DIRTY_EPSILON;this.dimensions.y=h,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get x(){return this._x}set x(v){let dirty=Math.abs(this._x-v)>Base3D.DIRTY_EPSILON;this._x=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get y(){return this._y}set y(v){let dirty=Math.abs(this._y-v)>Base3D.DIRTY_EPSILON;this._y=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get z(){return this._z}set z(v){let dirty=Math.abs(this._z-v)>Base3D.DIRTY_EPSILON;this._z=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get scale(){return this._scale}set scale(v){let dirty=Math.abs(this._scale-v)>Base3D.DIRTY_EPSILON;this._scale=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get scaleX(){return this._scaleX}set scaleX(v){let dirty=Math.abs(this._scaleX-v)>Base3D.DIRTY_EPSILON;this._scaleX=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get scaleY(){return this._scaleY}set scaleY(v){let dirty=Math.abs(this._scaleY-v)>Base3D.DIRTY_EPSILON;this._scaleY=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get rotation(){return this._rotation}set rotation(v){let dirty=Math.abs(this._rotation-v)>Base3D.DIRTY_EPSILON;this._rotation=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}style(props){for(let prop in props)void 0!==this[prop]&&(this[prop]=props[prop]);return this}size(w,h){return this.width=w,this.height=h,this.corners&&this.corners.update(),this}add($obj){return $obj?.parent?.children?.remove($obj),$obj.parent=this,this.group.add($obj.group),this.children.push($obj),this.isMasked&&$obj.mask(this.isMasked,this.maskShader),this._3d&&!$obj._3d&&$obj.enable3D(),this.deferred&&($obj.deferRender(!0),$obj.anchor&&this.anchor&&this.anchor.add($obj.anchor)),this}interact(over,click,camera=World.CAMERA,url,label,options){"string"==typeof camera&&(options=label,label=url,url=camera,camera=World.CAMERA);const bubble=(e,fn)=>{e.stopPropagation=function(){e._stopProp=!0};let parent=this._parent;for(;parent;){if(e._stopProp)return;parent[fn]?.(e),parent=parent.parent}};if(this._onOver=e=>{bubble(e,"_onChildHover"),over(e)},this._onClick=e=>{bubble(e,"_onChildClick"),click(e)},this._interactCamera=camera,over?this.interaction.add(this,camera):this.interaction.remove(this,camera),"string"==typeof url&&"string"==typeof label){const _this=this;defer(_=>{!_this.seo&&window.GLSEO&&GLSEO.objectNode(_this),_this.seo&&_this.seo.aLink&&_this.seo.aLink(url,label,options)})}return this}clearInteract(){return this._onOver&&(this.interaction.remove(this,this._interactCamera),this._onClick=GLUIObject.noop,this._onOver=GLUIObject.noop),this.seo&&this.seo.unlink(),this}remove(param){param&&console.warn("GLUIObject.remove removes ITSELF from its parent. use removeChild instead"),this.children.slice().forEach(child=>{child.remove?child.remove():child.destroy&&child.destroy()}),this.clearInteract(),this.parent&&(this.parent.children?this.parent.children?.remove(this):GLUI.Stage.remove(this)),this.mesh._parent?this.group._parent?.remove(this.group):this._3d?GLUI.Scene.remove(this):GLUI.Stage.remove(this);let textureShader=this.textureShader;for(let key in textureShader.uniforms){let uniform=textureShader.uniforms[key];uniform&&uniform.value&&uniform.value.destroy&&uniform.value.destroy()}}create(width,height,map,customCompile){let $obj=$gl(width,height,map,customCompile);return this.add($obj),this._3d&&$obj.enable3D(),$obj}removeChild(obj){return this.group.remove(obj.group),this}tween(obj,time,ease,delay){return tween(this,obj,time,ease,delay)}enable3D(style2d){this._3d=!0,this.mesh.geometry=GLUIObject.getGeometry(style2d?"2d":"3d"),this.mesh.shader.depthTest=!0,this._rotation=new Euler,this.anchor||(this.anchor=new Group),this.anchor.onMatrixDirty=_=>{_this.isDirty=!0};const _this=this;return _this._rotation.onChange(_=>{_this.isDirty=!0}),this}loaded(){return!0}setZ(z){return this.mesh.renderOrder=z,this}bg(path){if(void 0!==path)return"string"==typeof path?path.length<=10&&(path.startsWith("0x")||path.startsWith("#"))?(this.colorShader||(this.colorShader=new Shader("GLUIColor",{transparent:!0,uAlpha:{type:"f",value:1},uColor:{value:new Color(path)}})),this.colorShader.set("uColor",new Color(path)),this._shader.uniforms.uColor||this.useShader(this.colorShader)):(this.textureShader.uniforms.tMap.value=Utils3D.getTexture(path,{premultiplyAlpha:!1}),this._shader.uniforms.tMap||this.useShader(this.textureShader)):(this._shader.uniforms.tMap||this.useShader(this.textureShader),this._shader.uniforms.tMap.value=path),this}show(){return this.group.matrixDirty=!0,this.mesh.matrixDirty=!0,this.group.visible=!0,this.anchor&&(this.anchor.visible=!0),this}hide(){return this.group.visible=!1,this.anchor&&(this.anchor.visible=!1),this}useShader(shader){return shader&&(shader!=this.textureShader&&shader!=this.colorShader&&(shader.uniforms.tMap=this.mesh.shader.uniforms.tMap,shader.uniforms.uAlpha=this.mesh.shader.uniforms.uAlpha),this._3d||(shader.depthTest=!1),shader.transparent=!0),this._shader=shader,this.mesh.shader=shader||this._shader,shader.mesh=this.mesh,this}depthTest(bool){this.mesh.shader.depthTest=bool}childInteract(hover,click){this._onChildHover=hover,this._onChildClick=click}useGeometry(geom){return this.mesh.geometry=geom,this}updateMap(src){this._shader.uniforms.tMap.value="string"==typeof src?Utils3D.getTexture(src):src}async mask(obj,shader){await defer();let dimensions={},p=this._parent;for(;p;)p.stageLayoutCapture&&(dimensions.width=p.stageLayoutCapture.width,dimensions.height=p.stageLayoutCapture.height),p=p._parent;dimensions.width||(dimensions.width=Stage.width,dimensions.height=Stage.height),obj.group.updateMatrixWorld(!0),obj.mesh.onBeforeRender();let box=(new Box3).setFromObject(obj.mesh),minX=box.min.x/dimensions.width,minY=box.max.y/dimensions.height,maxX=box.max.x/dimensions.width,maxY=-box.min.y/dimensions.height;this.shader&&(this.useShader(shader),this.shader.addUniforms({uMaskValues:{value:new Vector4(minX,minY,maxX,maxY)}})),obj.hide(),this.group.traverse(o=>{o.glui&&o.glui!=this&&o.glui.mask(obj,shader)})}deferRender(parent){this.deferred=!0,parent||(this.anchor=new Group,GLUI.Scene.addDeferred(this))}clearTween(){return this._mathTweens&&this._mathTweens.forEach(t=>{t.tween.stop()}),this}createCorners(){this.corners=new GLUICornerPin(this)}getAlpha(){if(this._gluiParent){let alpha=this._gluiParent.getAlpha();return this.alpha=alpha,alpha}let alpha=this.alpha,$parent=this.parent;for(;$parent&&void 0!==$parent.alpha;)alpha*=$parent.alpha,$parent=$parent.parent;return alpha}get shader(){return this._shader}_divFocus(){this._onOver&&this._onOver({action:"over",object:this}),this.onDivFocus&&this.onDivFocus()}_divBlur(){this._onOver&&this._onOver({action:"out",object:this}),this.onDivBlur&&this.onDivBlur()}_divSelect(){this._onClick&&this._onClick({action:"click",object:this}),this.onDivSelect&&this.onDivSelect()}get _parent(){return this.parent}get interaction(){return(this._3d?GLUI.Scene:GLUI.Stage).interaction}forceUpdate(){this.firstRender=!1,this.mesh.onBeforeRender()}}!function(){var _geom2d,_geom3d;GLUIObject.getGeometry=function(type){return"2d"==type?(_geom2d||(_geom2d=new PlaneGeometry(1,1)).applyMatrix((new Matrix4).makeTranslation(.5,-.5,0)),_geom2d):(_geom3d||(_geom3d=World.PLANE),_geom3d)},GLUIObject.clear=function(){_geom2d=_geom3d=null},GLUIObject.noop=_=>{}}();class GLUIText{constructor(text,fontName,fontSize,options={},customCompile){options.font=fontName||options.font,options.text=text,options.seoText=options.seoText??text,options.width=options.width,options.align=options.align||"left",options.size=fontSize||options.size,options.lineHeight=options.lineHeight,options.letterSpacing=options.letterSpacing,options.wordSpacing=options.wordSpacing,options.wordBreak=options.wordBreak,options.langBreak=options.langBreak,options.indent=options.indent,options.color=new Color(options.color),options.customCompile=customCompile,this.text=new GLText(options),this.group=new Group,this.group.asyncPromise=this.text.text.fontLoaded,this.alpha=1,this._x=0,this._y=0,this._z=0,this._scaleX=1,this._scaleY=1,this._scale=1,this._rotation=0,this.multiTween=!0;const _this=this;text&&defer(_=>{!_this.seo&&options.seoText&&_this.seoText(options.seoText,this._seoSortOrder??options.seoSortOrder)}),this.text.ready().then(_=>{let mesh=_this.text.mesh;mesh.glui=_this,mesh.shader.visible=!1,_this.mesh=mesh,_this.group.add(mesh),_this._3d&&!_this._style2d&&_this.text.centerY(),_this._3d||(_this.text.mesh.shader.depthTest=!1),mesh.shader.mesh=mesh,mesh.onBeforeRender=_=>{if(!mesh.determineVisible()&&_this.firstRender)return;let alpha=_this.getAlpha();if(mesh.shader.uniforms.uAlpha&&(mesh.shader.uniforms.uAlpha.value=alpha),alpha<.001){if(mesh.shader.visible=!1,mesh.neverRender=!0,!_this.isDirty&&_this.firstRender)return}else mesh.neverRender=!1,mesh.shader.visible=!0;!_this.isDirty&&_this.firstRender||(RenderStats.active&&RenderStats.update("GLUIText",1,mesh.shader.vsName+"|"+mesh.shader.fsName,mesh),_this.group.position.x=_this._x,_this.group.position.y=_this._3d?_this._y:-_this._y,_this.group.position.z=_this._z,_this.group.scale.set(_this._scaleX*_this._scale,_this._scaleY*_this._scale,1),_this._3d?_this.anchor&&_this.anchor._parent?(_this.anchor.position.copy(_this.group.position),_this.anchor.scale.copy(_this.group.scale),_this.anchor.quaternion.setFromEuler(_this._rotation)):_this.group.quaternion.setFromEuler(_this._rotation):_this.group.rotation.z=Math.radians(_this._rotation),_this.firstRender||(_this.group.updateMatrixWorld(!0),_this.firstRender=!0,mesh.shader.visible=!0),_this.onInternalUpdate&&_this.onInternalUpdate(),_this.isDirty=!1)}})}get x(){return this._x}set x(v){Math.abs(this._x-v)>Base3D.DIRTY_EPSILON&&(this.isDirty=!0),this._x=v}get y(){return this._y}set y(v){Math.abs(this._y-v)>Base3D.DIRTY_EPSILON&&(this.isDirty=!0),this._y=v}get z(){return this._z}set z(v){Math.abs(this._z-v)>Base3D.DIRTY_EPSILON&&(this.isDirty=!0),this._z=v}get scale(){return this._scale}set scale(v){Math.abs(this._scale-v)>Base3D.DIRTY_EPSILON&&(this.isDirty=!0),this._scale=v}get scaleX(){return this._scaleX}set scaleX(v){Math.abs(this._scaleX-v)>Base3D.DIRTY_EPSILON&&(this.isDirty=!0),this._scaleX=v}get scaleY(){return this._scaleY}set scaleY(v){Math.abs(this._scaleY-v)>Base3D.DIRTY_EPSILON&&(this.isDirty=!0),this._scaleY=v}get rotation(){return this._rotation}set rotation(v){Math.abs(this._rotation-v)>Base3D.DIRTY_EPSILON&&(this.isDirty=!0),this._rotation=v}get dimensions(){return this._dimensions||(this._dimensions={}),this.text&&this.text.geometry&&!this._dimensions.max&&(this._dimensions=this.text.geometry.boundingBox,this._dimensions.width=Math.abs(this._dimensions.min.x-this._dimensions.max.x),this._dimensions.height=Math.abs(this._dimensions.min.y-this._dimensions.max.y)),this._dimensions}interact(over,click,camera=World.CAMERA,seoLink,options){"string"==typeof camera&&(options=seoLink,seoLink=camera,camera=World.CAMERA),this._onOver=over,this._onClick=click,this._interactCamera=camera;let stage=this._3d?GLUI.Scene:GLUI.Stage;const _this=this;return _this.text.ready().then(_=>{if(over){if(_this.text.geometry.boundingBox||_this.text.geometry.computeBoundingBox(),!_this.hitArea){let bb=_this.text.geometry.boundingBox,shader=Utils3D.getTestShader();if(shader.visible=!1,_this.hitArea=new Mesh(World.PLANE,shader),_this.hitArea.glui=_this,_this.hitArea.scale.set(Math.abs(bb.min.x)+Math.abs(bb.max.x),Math.abs(bb.min.y)+Math.abs(bb.max.y),1),_this._3d&&!_this._style2d||(_this.hitArea.position.x=(bb.max.x-bb.min.x)/2),_this.hitArea.position.y=(bb.min.y-bb.max.y)/2,_this._3d)switch(_this.text.getData().align){case"center":_this.hitArea.position.x=0;break;case"right":_this.hitArea.position.x=(bb.min.x-bb.max.x)/2}else switch(_this.text.getData().align){case"center":_this.hitArea.position.x=0;break;case"right":_this.hitArea.position.x=-(bb.max.x-bb.min.x)/2}_this.text.mesh.add(_this.hitArea)}stage.interaction.add(_this.hitArea,camera)}else stage.interaction.remove(_this.hitArea,camera)}),defer(_=>{seoLink&&_this.seo&&_this.seo.aLink&&_this.seo.aLink(seoLink,options)}),this}clearInteract(){if(this._onOver){(this._3d?GLUI.Scene:GLUI.Stage).interaction.remove(this.hitArea,this._interactCamera),this._onClick=GLUIObject.noop,this._onOver=GLUIObject.noop}return this}remove(param){param&&console.warn("GLUIObject.remove removes ITSELF from its parent. use removeChild instead");let stage=this._3d?GLUI.Scene:GLUI.Stage;this.mesh&&this.mesh.parent?this.group.parent.remove(this.group):stage.remove(this),this.hitArea&&stage.interaction.remove(this.hitArea,this._interactCamera),this.text&&this.text.destroy&&this.text.destroy(),Utils.nullObject(this.mesh),Utils.nullObject(this),this.deleted=!0}tween(obj,time,ease,delay){return tween(this,obj,time,ease,delay)}enable3D(style2d){this._3d=!0,this._style2d=style2d,this._rotation=new Euler;const _this=this;return _this._rotation.onChange(_=>{_this.isDirty=!0}),_this.text.ready().then(_=>{_this.deleted||(_this.text.mesh.shader.depthTest=!0)}),this.anchor||(this.anchor=new Group),this.anchor.onMatrixDirty=_=>{_this.isDirty=!0},_this.isDirty=!0,this}depthTest(bool){const _this=this;return _this.text.ready().then(_=>{_this.deleted||(_this.text.mesh.shader.depthTest=bool)}),this}setZ(z){const _this=this;return _this.text.ready().then(_=>{_this.deleted||(_this.text.mesh.renderOrder=z)}),this}height(){return this.mesh?this.text.height:0}async setText(text,options){if(text&&(text=text.toString(),!1!==options?.seoText)){let seoText=options?.seoText;seoText=seoText&&"boolean"!=typeof seoText?seoText.toString():text,this.seoText(seoText,options?.seoSortOrder)}return await this.text.ready(),await this.text.setText(text,options),this._dimensions=null,this}seoText(text,sortOrder=this._seoSortOrder){window.GLSEO&&(GLSEO.textNode(this,text,sortOrder),delete this._seoSortOrder)}get seoSortOrder(){return this.seo?this.seo.sortOrder:this._seoSortOrder}set seoSortOrder(sortOrder){this.seo?GLSEO.textNode(this,this.seo.text(),sortOrder):this._seoSortOrder=sortOrder}getTextString(){return this.text.string}setColor(color){const _this=this;return _this.text.ready().then(_=>{_this.deleted||_this.text.setColor(color)}),this}tweenColor(color,time,ease,delay){const _this=this;return _this.text.ready().then(_=>{_this.deleted||_this.text.tweenColor(color,time,ease,delay)}),this}async resize(options){await this.text.ready(),await this.text.resize(options),this._dimensions=null}show(){const _this=this;return _this.text.ready().then(_=>{_this.deleted||(this.text.mesh.visible=!0,this.text.mesh.updateMatrixWorld(!0))}),this}async mask(obj,shader){await defer();let dimensions={},p=this._parent;for(;p;)p.stageLayoutCapture&&(dimensions.width=p.stageLayoutCapture.width,dimensions.height=p.stageLayoutCapture.height),p=p._parent;dimensions.width||(dimensions.width=Stage.width,dimensions.height=Stage.height),obj.group.updateMatrixWorld(!0),obj.mesh.onBeforeRender();let box=(new Box3).setFromObject(obj.mesh),minX=box.min.x/dimensions.width,minY=box.max.y/dimensions.height,maxX=box.max.x/dimensions.width,maxY=-box.min.y/dimensions.height;this.shader&&(this.useShader(shader),this.shader.addUniforms({uMaskValues:{value:new Vector4(minX,minY,maxX,maxY)}})),obj.hide(),this.group.traverse(o=>{o.glui&&o.glui!=this&&o.glui.mask(obj,shader)})}hide(){const _this=this;return _this.text.ready().then(_=>{_this.deleted||(_this.text.mesh.visible=!1)}),this}loaded(){return this.text.ready()}length(){return this.text.charLength}deferRender(parent){this.deferred=!0,parent||(this.anchor||(this.anchor=new Group),GLUI.Scene.addDeferred(this))}getAlpha(){if(this._gluiParent){let alpha=this._gluiParent.getAlpha();return this.alpha=alpha,alpha}let alpha=this.alpha,$parent=this.parent;for(;$parent&&void 0!==$parent.alpha;)alpha*=$parent.alpha,$parent=$parent.parent;return alpha}size(){}upload(){const _this=this;return _this.text.ready().then(_=>{_this.deleted||_this.text.mesh.upload()}),this}_divFocus(){this._onOver&&this._onOver({action:"over",object:this}),this.onDivFocus&&this.onDivFocus()}_divBlur(){this._onOver&&this._onOver({action:"out",object:this}),this.onDivBlur&&this.onDivBlur()}_divSelect(){this._onClick&&this._onClick({action:"click",object:this}),this.onDivBlurSelect&&this.onDivSelect()}get _parent(){return this.parent}async useShader(shader){await this.text.ready(),shader.uniforms.tMap=this.text.shader.uniforms.tMap,shader.uniforms.tMapBold=this.text.shader.uniforms.tMapBold,shader.uniforms.tMapItalic=this.text.shader.uniforms.tMapItalic,shader.uniforms.uAlpha=this.text.shader.uniforms.uAlpha,shader.uniforms.uColor=this.text.shader.uniforms.uColor,shader.transparent=!0,(!this._3d||this._3d||this.parent)&&(shader.depthTest=!1),this.text.mesh.shader=shader||this.text.shader,this.text.shader=shader,this.text.mesh.shader.mesh=this.text.mesh}}Class(function GLUIStage(){Inherit(this,Component);const _this=this;var _scene=new Scene,_camera=new OrthographicCamera(1,1,1,1,.1,1);function resizeHandler(){const _stage=_this?.customStageSize||Stage;_camera.left=_stage.width/-2,_camera.right=_stage.width/2,_camera.top=_stage.height/2,_camera.bottom=_stage.height/-2,_camera.near=.01,_camera.far=1e3,_camera.updateProjectionMatrix(),_camera.position.x=_stage.width/2,_camera.position.y=-_stage.height/2}this.interaction=new GLUIStageInteraction2D(_camera,_scene,Stage),this.alpha=1,this.scene=_scene,_scene.disableAutoSort=!0,_camera.position.z=1,function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}(),resizeHandler(),this.add=function($obj){$obj.parent=_this,_scene.add($obj.group||$obj.mesh)},this.remove=function($obj){$obj.parent=null,_scene.remove($obj.group)},this.clear=function(){_scene.traverse(obj=>{obj.geometry&&obj.shader&&obj.destroy()}),_scene.children.length=_scene.childrenLength=0},this.renderToRT=function(scene,rt,camera){let clearAlpha;rt&&rt.fxscene&&rt.fxscene.clearAlpha>-1&&(clearAlpha=World.RENDERER.getClearAlpha(),World.RENDERER.setClearAlpha(0));let autoClear=World.RENDERER.autoClear;World.RENDERER.autoClear=!1,World.RENDERER.render(scene,camera||_camera,rt),World.RENDERER.autoClear=autoClear,clearAlpha&&World.RENDERER.setClearAlpha(clearAlpha)},this.get("camera",()=>_camera),this.setStageSize=function setStageSize(size){_this.customStageSize=size,resizeHandler()},this.resize=resizeHandler,this.render=function loop(){if(!_scene.children.length)return;let clear=World.RENDERER.autoClear;World.RENDERER.autoClear=!1,World.RENDERER.render(_scene,_camera,null,!0,_this.xrFramebuffer),World.RENDERER.autoClear=clear},this.renderDirect=callback=>{_scene.children.length&&(_scene.traverse(obj=>{obj.shader&&(obj.shader.depthTest=!1)}),callback(_scene,_camera))}}),Class(function GLUIStage3D(){Inherit(this,Object3D);const _this=this;var _camera,_externalRenders=[],_scene=new Scene,_list=new LinkedList;this.alpha=1,this.interaction=new GLUIStageInteraction3D,this.add=function(obj,parent){obj.parent=_this,obj._gluiParent=parent,obj.anchor&&(obj.anchor._gluiParent=parent),obj._3d||obj.enable3D(),obj.deferRender()},this.clear=function(){_scene.traverse(obj=>{obj.geometry&&obj.shader&&obj.destroy()}),_scene.children.length=_scene.childrenLength=0},this.addDeferred=function(obj){_list.push(obj),_scene.add(obj.group||obj.mesh)},this.remove=function(obj){_scene.remove(obj.group||obj.mesh),_list.remove(obj)},this.disableAutoSort=function(){_scene.disableAutoSort=!0},this.renderToRT=function(scene,camera){camera=camera.camera||camera,scene.traverse(mesh=>{let obj=mesh.glui||mesh;obj&&obj.anchor&&obj.anchor.determineVisible()&&Utils3D.decompose(obj.anchor,obj.group||obj)}),scene._textRenderCamera=camera,_externalRenders.push(scene)},this.renderToRT2=function(scene,rt,camera){let clearAlpha;rt.fxscene&&rt.fxscene.clearAlpha>-1&&(clearAlpha=World.RENDERER.getClearAlpha(),World.RENDERER.setClearAlpha(0));let autoClear=World.RENDERER.autoClear;World.RENDERER.autoClear=!1,World.RENDERER.render(scene,camera,rt),World.RENDERER.autoClear=autoClear,clearAlpha&&World.RENDERER.setClearAlpha(clearAlpha)},this.render=function loop(){if(!window.Metal){if(_list.length){let obj=_list.start();for(;obj;)obj._marked&&(obj._marked=!1,Utils3D.decompose(obj.anchor,obj.group)),obj=_list.next();let clear=World.RENDERER.autoClear;Renderer.context.clear(Renderer.context.DEPTH_BUFFER_BIT),World.RENDERER.autoClear=!1,World.RENDERER.render(_scene,_camera||World.CAMERA),World.RENDERER.autoClear=clear}if(_externalRenders.length)for(;_externalRenders.length;){let scene=_externalRenders.shift(),camera=scene._textRenderCamera,clear=World.RENDERER.autoClear;Renderer.context.clear(Renderer.context.DEPTH_BUFFER_BIT),World.RENDERER.autoClear=!1,World.RENDERER.render(scene,camera),World.RENDERER.autoClear=clear}}},this.mark=function mark(){let obj=_list.start();for(;obj;)obj.anchor._parent&&(obj.group.visible=obj.anchor.determineVisible()),obj.mesh&&obj.mesh.determineVisible()&&obj.anchor._parent&&(obj._marked=!0),obj=_list.next()},this.renderDirect=function(callback){if(_list.length){let obj=_list.start();for(;obj;)obj._marked&&(obj._marked=!1,Utils3D.decompose(obj.anchor,obj.group)),obj=_list.next();_scene.traverse(obj=>{obj.shader&&(obj.shader.depthTest=!1)}),callback(_scene,_camera||World.CAMERA)}},this.set("camera",c=>{_camera=c.camera||c})}),Module(function FirefoxGPUFixer(){this.exports=function(){GPU.detect("radeon r9 200")&&("mac"==Device.system.os||Device.pixelRatio>1)&&(Device.graphics.webgl.gpu="radeon pro 455")}}),Class(function GPU(){Inherit(this,Component);var _this=this,_split={};Hydra.ready(async()=>{if(_this.detect=function(match){if(Device.graphics.gpu)return Device.graphics.gpu.detect(match)},_this.detectAll=function(){if(Device.graphics.gpu){for(var match=!0,i=0;i<arguments.length;i++)Device.graphics.gpu.detect(arguments[i])||(match=!1);return match}},_this.matchGPU=function(str,min,max=99999){let num=function splitGPU(string){if(_split[string])return _split[string];if(!_this.detect(string))return-1;try{var num=Number(_this.gpu.split(string)[1].split(" ")[0].replace(/[^a-zA-Z0-9]/g,"").trim());return _split[string]=num,num}catch(e){return-1}}(str);return num>=min&&num<max},_this.gpu=Device.graphics.gpu?Device.graphics.gpu.identifier:"","apple gpu"==_this.gpu)if(Device.mobile){let{getRenderer:getRenderer,fallbackTest:fallbackTest}=require("iOSGPUTest"),gpu=await getRenderer();if(gpu)Device.graphics.webgl.gpu=gpu.toLowerCase();else{let gpu=fallbackTest();gpu&&(Device.graphics.webgl.gpu=gpu)}}else require("MacOSPerformanceTest")();for(var key in"firefox"===Device.system.browser&&require("FirefoxGPUFixer")(),_this.BLOCKLIST=require("GPUBlocklist").match(),_this.T0=!(Device.mobile||!_this.BLOCKLIST&&!_this.detect("radeon(tm) r5")&&!_this.detect("radeon r9 200")&&!_this.detect("hd graphics family")&&!_this.detect("intel(r) uhd graphics direct")&&!_this.matchGPU("hd graphics ",1e3,5001)&&!(_this.matchGPU("hd graphics ",0,618)&&Device.pixelRatio>1)&&!(_this.detect(["hd graphics","iris"])&&Math.max(Stage.width,Stage.height)>1800)&&!_this.detect(["intel iris opengl engine"])&&!_this.matchGPU("iris(tm) graphics ",1e3)),_this.T1=!(_this.BLOCKLIST||Device.mobile||_this.T0||!_this.matchGPU("iris(tm) graphics ",540,1e3)&&!_this.matchGPU("hd graphics ",514,1e3)&&!_this.matchGPU("intel(r) uhd graphics ",600,1e3)&&_this.detect(["nvidia","amd","radeon","geforce"])&&!_this.detect(["vega 8"])),_this.T2=!_this.BLOCKLIST&&!Device.mobile&&!(!_this.detect(["nvidia","amd","radeon","geforce"])||_this.T1||_this.T0),_this.T3=!(_this.BLOCKLIST||Device.mobile||!_this.detect(["titan","amd radeon pro","quadro"])&&!_this.matchGPU("gtx ",940)&&!_this.matchGPU("radeon (tm) rx ",400)&&!_this.detect("amd radeon(tm) graphics direct3d11 vs_5_0")&&!_this.matchGPU("radeon rx ",400)&&!_this.matchGPU("radeon pro ",420)),_this.T4=!(_this.BLOCKLIST||Device.mobile||!_this.detect(["titan","quadro","radeon vii","apple m"])&&!_this.matchGPU("gtx ",1060)&&!_this.matchGPU("rtx")&&!_this.matchGPU("radeon rx ",500)&&!_this.matchGPU("vega ",50)&&!_this.detect(["radeon pro 5300m","radeon pro 5500m","radeon pro 5600m","amd radeon unknown prototype"])),_this.T5=!(_this.BLOCKLIST||Device.mobile||!_this.detect(["titan","radeon vii"])&&!_this.matchGPU("gtx ",1080)&&!_this.matchGPU("rtx ",2060)&&!_this.matchGPU("radeon rx ",5500)&&(!_this.detect("apple m")||!_this.detect("max"))),_this.MT0=!!Device.mobile&&(!!_this.BLOCKLIST||!("ios"!=Device.system.os||!_this.detect("a7"))||!("android"!=Device.system.os||!_this.detect("sgx"))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",0,415):_this.detect("mali")?_this.matchGPU("mali-t",0,628):!("ios"!=Device.system.os||!_this.detect(["a8","a9"]))||!!_this.detect("mali-g")||!!_this.matchGPU("adreno (tm) ",420))),_this.MT1=function(){if(!Device.mobile)return!1;if(_this.BLOCKLIST)return!1;if("ios"==Device.system.os&&_this.detect("a10"))return!0;if("android"==Device.system.os&&!_this.MT0)return!0;if(_this.detect("nvidia tegra")&&Device.detect("pixel c"))return!0;if(_this.detect("mali-g"))return _this.matchGPU("mali-g",73);if(_this.detect("adreno")){if(_this.matchGPU("adreno (tm) ",600,616))return!0;if(_this.matchGPU("adreno (tm) ",530,600))return!0}return!1}(),_this.MT2=!!Device.mobile&&!_this.BLOCKLIST&&(!("ios"!=Device.system.os||!_this.detect(["a11","a12"]))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",630):_this.detect("mali-g")?_this.matchGPU("mali-g",74):!(!navigator.platform.toLowerCase().includes(["mac","windows"])||"chrome"!=Device.system.browser))),_this.MT3=!!Device.mobile&&!_this.BLOCKLIST&&(!("ios"!=Device.system.os||!_this.detect(["a12","a13","a14","a15","a16","a17","a18"]))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",640):_this.detect("mali-g")?_this.matchGPU("mali-g",76):!(!navigator.platform.toLowerCase().includes(["mac","windows"])||"chrome"!=Device.system.browser))),_this.MT4=!!Device.mobile&&!_this.BLOCKLIST&&(!("ios"!=Device.system.os||!_this.detect(["a14","a15","a16","a17","a18","a19","a20","apple m"]))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",650):_this.detect("mali-g")?_this.detect("mali-g710")||_this.matchGPU("mali-g",78):!(!navigator.platform.toLowerCase().includes(["mac","windows"])||"chrome"!=Device.system.browser))),_this.MT5=!!Device.mobile&&!_this.BLOCKLIST&&(!("ios"!=Device.system.os||!_this.detect(["a16","a17","a18","a19","a20","a21","a22","a23","a24","a25","apple m"]))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",740):!(!navigator.platform.toLowerCase().includes(["mac","windows"])||"chrome"!=Device.system.browser))),_this.lt=function(num){return _this.TIER>-1&&_this.TIER<=num},_this.gt=function(num){return _this.TIER>-1&&_this.TIER>=num},_this.eq=function(num){return _this.TIER>-1&&_this.TIER==num},_this.mobileEq=function(num){return _this.M_TIER>-1&&_this.M_TIER==num},_this.mobileLT=function(num){return _this.M_TIER>-1&&_this.M_TIER<=num},_this.mobileGT=function(num){return _this.M_TIER>-1&&_this.M_TIER>=num},_this)"T"==key.charAt(0)&&!0===_this[key]&&(_this.TIER=Number(key.charAt(1))),"MT"==key.slice(0,2)&&!0===_this[key]&&(_this.M_TIER=Number(key.charAt(2)));!1!==Utils.query("gpu")&&(Device.mobile||Utils.query("gpu").toString().includes("m")?(_this.TIER=-1,_this.M_TIER=Number(Utils.query("gpu").slice(1))):_this.TIER=Number(Utils.query("gpu"))),"ios"==Device.system.os&&Render.REFRESH_RATE<40&&(_this.M_TIER-=1),_this.OVERSIZED=!Device.mobile&&_this.TIER<=0&&Math.max(window.innerWidth,window.innerHeight)>1400||!Device.mobile&&_this.TIER<=1&&Device.pixelRatio<2&&Math.max(window.innerWidth,window.innerHeight)>1600,"ie"==Device.system.browser&&(_this.OVERSIZED=!0),_this.initialized=!0}),this.ready=function(){return this.wait("initialized")}},"static"),Module(function GPUCalculations(){this.exports={hash:function hash(){var imageHash=0,canvas=document.createElement("canvas");if(null!=canvas){var imageData=function drawImage(canvas){canvas.width=67,canvas.height=67;var ctx=canvas.getContext("2d",{alpha:!0});if(null!=ctx)return ctx.imageSmoothingQuality="low",ctx.imageSmoothingEnabled=!0,ctx.globalCompositeOperation="source-over",ctx.globalAlpha=1,ctx.miterLimit=1/0,ctx.filter="none",ctx.lineCap="butt",ctx.lineDashOffset=0,ctx.lineJoin="miter",ctx.font="10pt Arial",ctx.lineWidth=2,void 0!==ctx.setLineDash&&ctx.setLineDash([10,20]),ctx.shadowColor="black",ctx.shadowOffsetX=-3,ctx.shadowOffsetY=-5,ctx.translate(canvas.width/2,canvas.height/2),ctx.rotate(.8901179),ctx.fillStyle="green",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText("*51Degrees*",0,0),ctx.beginPath(),ctx.shadowColor="yellow",ctx.shadowBlur=1,ctx.shadowOffsetX=1,ctx.shadowOffsetY=1,ctx.strokeStyle="red",ctx.fillStyle="rgba(0, 0, 255, 0.6)",void 0===ctx.ellipse?ctx.arc(0,0,25,0,2*Math.PI):ctx.ellipse(0,0,25,15,Math.PI/4,0,2*Math.PI),ctx.fill(),ctx.stroke(),canvas.toDataURL()}(canvas);imageData&&(imageHash=function fnvHash(str){for(var h=2166136261,i=0;i<str.length;++i)h^=str.charCodeAt(i),h+=(h<<1)+(h<<4)+(h<<7)+(h<<8)+(h<<24);return h>>>0}(imageData))}return Global.iOSGPUHASHVAL=imageHash,imageHash},primeTest:function primeTest(){let results=[];function getPrime(){return function largest_prime_factor(n){return factors(n).filter(primep).pop()}(1e12)}function factors(n){var i,out=[],sqrt_n=Math.sqrt(n);for(i=2;i<=sqrt_n;i++)n%i===0&&out.push(i);return out}function primep(n){return 0===factors(n).length}for(let i=0;i<3;i++){let time=performance.now();getPrime(),results.push(10*(performance.now()-time))}return results.sort((a,b)=>a-b),results[0]}}}),Module(function MacOSPerformanceTest(){const{hash:hash,primeTest:primeTest}=require("GPUCalculations");this.exports=function(){let hashValue=hash().toString();switch(Global.MACOSHASHVALUE=hashValue,hashValue){case"154539004":case"2370358002":return Device.graphics.webgl.gpu="intel iris opengl engine";case"174373703":return Device.graphics.webgl.gpu="apple m1";case"245727699":return Device.graphics.webgl.gpu="apple m1 pro";case"2650655516":return Device.graphics.webgl.gpu="apple m1 max";case"1031999577":case"604831120":case"1085686600":case"1589747348":return Device.graphics.webgl.gpu="amd radeon pro 5500m";case"2267488256":return Device.graphics.webgl.gpu="apple m2";case"640654249":return Device.graphics.webgl.gpu="apple m4 max"}let result=primeTest();if(result<100)return Device.graphics.webgl.gpu="apple m1 max";screen.width<=1440&&screen.height<=900?Device.graphics.webgl.gpu=result>540?"intel iris opengl engine":"safari tier 1":Device.graphics.webgl.gpu=result>475?result>540?"intel iris opengl engine":"safari tier 1":result<375?"amd radeon pro 455 opengl engine":"nvidia geforce 750m opengl engine"}}),Module(function iOSGPUTest(){function hash3d(){var gl,program,canvas,mat4={create:function(){for(var result=new Array(16),i=0;i<16;i++)result[i]=i%5==0?1:0;return result},perspective:function(out,fovy,aspect,near,far){var nf,f=1/Math.tan(fovy/2);return out[0]=f/aspect,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=f,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[11]=-1,out[12]=0,out[13]=0,out[15]=0,null!=far&&far!==1/0?(nf=1/(near-far),out[10]=(far+near)*nf,out[14]=2*far*near*nf):(out[10]=-1,out[14]=-2*near),out},lookAt:function(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];return Math.abs(eyex-centerx)<1e-6&&Math.abs(eyey-centery)<1e-6&&Math.abs(eyez-centerz)<1e-6?mat4.identity(out):(z0=eyex-centerx,z1=eyey-centery,z2=eyez-centerz,x0=upy*(z2*=len=1/Math.hypot(z0,z1,z2))-upz*(z1*=len),x1=upz*(z0*=len)-upx*z2,x2=upx*z1-upy*z0,(len=Math.hypot(x0,x1,x2))?(x0*=len=1/len,x1*=len,x2*=len):(x0=0,x1=0,x2=0),y0=z1*x2-z2*x1,y1=z2*x0-z0*x2,y2=z0*x1-z1*x0,(len=Math.hypot(y0,y1,y2))?(y0*=len=1/len,y1*=len,y2*=len):(y0=0,y1=0,y2=0),out[0]=x0,out[1]=y0,out[2]=z0,out[3]=0,out[4]=x1,out[5]=y1,out[6]=z1,out[7]=0,out[8]=x2,out[9]=y2,out[10]=z2,out[11]=0,out[12]=-(x0*eyex+x1*eyey+x2*eyez),out[13]=-(y0*eyex+y1*eyey+y2*eyez),out[14]=-(z0*eyex+z1*eyey+z2*eyez),out[15]=1,out)},multiply:function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return out[0]=b0*a00+b1*a10+b2*a20+b3*a30,out[1]=b0*a01+b1*a11+b2*a21+b3*a31,out[2]=b0*a02+b1*a12+b2*a22+b3*a32,out[3]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[4],b1=b[5],b2=b[6],b3=b[7],out[4]=b0*a00+b1*a10+b2*a20+b3*a30,out[5]=b0*a01+b1*a11+b2*a21+b3*a31,out[6]=b0*a02+b1*a12+b2*a22+b3*a32,out[7]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[8],b1=b[9],b2=b[10],b3=b[11],out[8]=b0*a00+b1*a10+b2*a20+b3*a30,out[9]=b0*a01+b1*a11+b2*a21+b3*a31,out[10]=b0*a02+b1*a12+b2*a22+b3*a32,out[11]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[12],b1=b[13],b2=b[14],b3=b[15],out[12]=b0*a00+b1*a10+b2*a20+b3*a30,out[13]=b0*a01+b1*a11+b2*a21+b3*a31,out[14]=b0*a02+b1*a12+b2*a22+b3*a32,out[15]=b0*a03+b1*a13+b2*a23+b3*a33,out},identity:function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}};var imageHash=0;if(null!=(canvas=document.createElement("canvas"))){var imageData=function generate(){if(gl=function getRenderingContext(){canvas.width=67,canvas.height=67;var gl=canvas.getContext("webgl")||canvas.getContext("experimental-webgl");return gl&&(gl.viewport(0,0,67,67),gl.clearColor(0,0,0,1),gl.clear(gl.COLOR_BUFFER_BIT)),gl}()){var vertexShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vertexShader,"attribute vec3 c,d; uniform vec4 e; uniform vec3 f,g;uniform mat4 h,i;varying vec3 j;void main(){vec3 a=normalize(d);vec4 b=h*vec4(c,1.);vec3 k=normalize(vec3(e-b));j=g*f*max(dot(k,a),0.),gl_Position=i*vec4(c,1.);}"),gl.compileShader(vertexShader);var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,"#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec3 j;void main(){gl_FragColor = vec4(j, 1.0);}"),gl.compileShader(fragmentShader),program=gl.createProgram(),gl.attachShader(program,vertexShader),gl.attachShader(program,fragmentShader),gl.linkProgram(program),gl.detachShader(program,vertexShader),gl.detachShader(program,fragmentShader),gl.deleteShader(vertexShader),gl.deleteShader(fragmentShader),gl.useProgram(program);var n=function initVertexBuffers(gl){var latNumber,longNumber,vertexPositionData=[],normalData=[],textureCoordData=[],indexData=[];for(latNumber=0;latNumber<=50;++latNumber){var theta=latNumber*Math.PI/50,sinTheta=Math.sin(theta),cosTheta=Math.cos(theta);for(longNumber=0;longNumber<=50;++longNumber){var phi=2*longNumber*Math.PI/50,sinPhi=Math.sin(phi),x=Math.cos(phi)*sinTheta,y=cosTheta,z=sinPhi*sinTheta,u=1-longNumber/50,v=1-latNumber/50;vertexPositionData.push(2*x),vertexPositionData.push(2*y),vertexPositionData.push(2*z),normalData.push(x),normalData.push(y),normalData.push(z),textureCoordData.push(u),textureCoordData.push(v)}}for(latNumber=0;latNumber<50;++latNumber)for(longNumber=0;longNumber<50;++longNumber){var first=51*latNumber+longNumber,second=first+50+1;indexData.push(first),indexData.push(second),indexData.push(first+1),indexData.push(second),indexData.push(second+1),indexData.push(first+1)}vertexPositionData=new Float32Array(vertexPositionData),normalData=new Float32Array(normalData),textureCoordData=new Float32Array(textureCoordData),indexData=new Uint16Array(indexData);var vertexPositionBuffer=gl.createBuffer(),vertexNormalBuffer=gl.createBuffer(),indexBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexPositionBuffer),gl.bufferData(gl.ARRAY_BUFFER,vertexPositionData,gl.STATIC_DRAW);var VertexPosition=gl.getAttribLocation(program,"c");gl.vertexAttribPointer(VertexPosition,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(VertexPosition),gl.bindBuffer(gl.ARRAY_BUFFER,vertexNormalBuffer),gl.bufferData(gl.ARRAY_BUFFER,normalData,gl.STATIC_DRAW);var VertexNormal=gl.getAttribLocation(program,"d");return gl.vertexAttribPointer(VertexNormal,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(VertexNormal),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,indexData,gl.STATIC_DRAW),indexData.length}(gl);gl.clearColor(0,0,0,1),gl.enable(gl.DEPTH_TEST);var projection=mat4.create();mat4.perspective(projection,Math.PI/6,1,.1,100);var modelView=mat4.create();mat4.lookAt(modelView,[0,0,10],[0,0,0],[0,1,0]);var mvpMatrix=mat4.create();mat4.multiply(mvpMatrix,projection,modelView);var ModelViewMatrix=gl.getUniformLocation(program,"h");gl.uniformMatrix4fv(ModelViewMatrix,!1,modelView);var MVP=gl.getUniformLocation(program,"i");gl.uniformMatrix4fv(MVP,!1,mvpMatrix);var LightPosition=gl.getUniformLocation(program,"e");gl.uniform4fv(LightPosition,[10,10,10,1]);var Kd=gl.getUniformLocation(program,"f");gl.uniform3fv(Kd,[.9,.5,.3]);var Ld=gl.getUniformLocation(program,"g");return gl.uniform3fv(Ld,[1,1,1]),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.drawElements(gl.TRIANGLES,n,gl.UNSIGNED_SHORT,0),function cleanup(){gl.useProgram(null),program&&gl.deleteProgram(program)}(),canvas.toDataURL()}}();imageData&&(imageHash=function fnvHash(str){for(var h=2166136261,i=0;i<str.length;++i)h^=str.charCodeAt(i),h+=(h<<1)+(h<<4)+(h<<7)+(h<<8)+(h<<24);return h>>>0}(imageData))}return Global.iOSGPUHASH3D=imageHash,imageHash}const{hash:hash,primeTest:primeTest}=require("GPUCalculations");function getRenderer(complete){var decisionTree={Version:"1.7",PublishDate:"2025-11-26T07:00:32.931Z",Data:[{x:"Unknown",m:()=>family(),n:[108,3,2,1]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A8X GPU|Apple A9 GPU|Apple A9X GPU|Apple A10 GPU|Apple A10X GPU|Apple A11 GPU|Apple A12 GPU|Apple A12X GPU|Apple A12Z GPU|Apple A13 GPU|Apple A14 GPU|Apple A15 GPU|Apple A16 GPU|Apple A17 Pro GPU|Apple M1 GPU|Apple M2 GPU",m:()=>height(),n:[109,63,60,61,62,47,45,46,33,36,32,34,35,23,18,19,11,6,7,5],v:["Macintosh"]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A12 GPU|Apple A13 GPU|Apple A14 GPU|Apple A15 GPU|Apple A16 GPU|Apple A17 Pro GPU",m:()=>height(),n:[60,61,62,44,45,46,30,31,23,17,12,6,7],v:["iPhone"]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A8X GPU|Apple A9 GPU|Apple A9X GPU|Apple A10 GPU|Apple A10X GPU|Apple A12 GPU|Apple A12X GPU|Apple A12Z GPU|Apple A13 GPU|Apple A14 GPU|Apple A15 GPU|Apple M1 GPU|Apple M2 GPU",m:()=>height(),n:[109,110,63,47,33,32,18,4],v:["iPad"]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A8X GPU|Apple A9 GPU|Apple A9X GPU|Apple A10 GPU|Apple A10X GPU|Apple A12 GPU|Apple A12X GPU|Apple A12Z GPU|Apple M1 GPU|Apple M2 GPU",m:()=>mediacolorgamut(),n:[16,13],v:[2048]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A8X GPU|Apple A9 GPU|Apple A9X GPU|Apple A10 GPU|Apple A10X GPU|Apple A12 GPU|Apple A12X GPU|Apple A12Z GPU|Apple M1 GPU|Apple M2 GPU",m:()=>mediacolorgamut(),n:[16,14],v:[2048]},{x:"Apple A11 GPU|Apple A12 GPU|Apple A13 GPU|Apple A14 GPU|Apple A15 GPU|Apple A16 GPU|Apple A17 Pro GPU",m:()=>hash3d(),n:[114,73,74,72,75,21,26,20,8],v:[2436]},{x:"Apple A11 GPU|Apple A12 GPU|Apple A13 GPU|Apple A14 GPU|Apple A15 GPU|Apple A16 GPU|Apple A17 Pro GPU",m:()=>hash3d(),n:[121,120,115,50,27,28,21,9],v:[2079]},{x:"Apple A12 GPU|Apple A13 GPU|Apple A14 GPU|Apple A15 GPU|Apple A16 GPU|Apple A17 Pro GPU",m:()=>hash(),n:[43,15],v:[3711606621]},{x:"Apple A12 GPU|Apple A13 GPU|Apple A14 GPU|Apple A15 GPU|Apple A16 GPU|Apple A17 Pro GPU",m:()=>hash(),n:[103,10],v:[3711606621]},{x:"Apple A14 GPU|Apple A15 GPU|Apple A16 GPU|Apple A17 Pro GPU",v:[235283973]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A13 GPU|Apple A15 GPU",m:()=>mediacolorgamut(),n:[38,25],v:[1136]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A13 GPU|Apple A15 GPU",m:()=>mediacolorgamut(),n:[37,38],v:[1136]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A8X GPU|Apple A9 GPU|Apple A9X GPU|Apple A10 GPU",m:()=>hash(),n:[149,148,89,90,91,92,55,56,58,54,57],v:["srgb"]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A8X GPU|Apple A9 GPU|Apple A9X GPU|Apple A10 GPU",m:()=>hash(),n:[149,153,97,98,92,55,56,58,54],v:["srgb"]},{x:"Apple A14 GPU|Apple A15 GPU|Apple A16 GPU|Apple A17 Pro GPU",v:[235283973]},{x:"Apple A9X GPU|Apple A10X GPU|Apple A12 GPU|Apple A12X GPU|Apple A12Z GPU|Apple M1 GPU|Apple M2 GPU",m:()=>hash3d(),n:[150,126,127,94,93,95,79],v:["p3"]},{x:"Apple A8 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A13 GPU|Apple A15 GPU",m:()=>mediacolorgamut(),n:[68,39],v:[1334]},{x:"Apple A9X GPU|Apple A10X GPU|Apple A12X GPU|Apple A12Z GPU|Apple M1 GPU|Apple M2 GPU",m:()=>mediacolorgamut(),n:[111,24],v:[2732]},{x:"Apple A8 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A13 GPU|Apple A15 GPU",m:()=>mediacolorgamut(),n:[70,39],v:[1334]},{x:"Apple A13 GPU|Apple A14 GPU|Apple A15 GPU|Apple A16 GPU",m:()=>hash(),n:[157,100,42],v:[3403189785]},{x:"Apple A14 GPU|Apple A15 GPU",m:()=>hash(),n:[22],v:[2364051618]},{x:"Apple A14 GPU|Apple A15 GPU",v:[2775654583]},{x:"Apple A14 GPU|Apple A15 GPU",m:()=>hash3d(),n:[74,51,40,21,29],v:[2532]},{x:"Apple A10X GPU|Apple A12X GPU|Apple A12Z GPU|Apple M1 GPU|Apple M2 GPU",m:()=>hash3d(),n:[152,151,150,126,127,41],v:["p3"]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A9 GPU|Apple A10 GPU",m:()=>hash3d(),n:[155,156,99],v:["srgb"]},{x:"Apple A14 GPU|Apple A15 GPU|Apple A16 GPU",v:[46273595]},{x:"Apple A13 GPU|Apple A14 GPU|Apple A15 GPU|Apple A16 GPU",m:()=>hash(),n:[157,101,102],v:[3403189785]},{x:"Apple A14 GPU|Apple A15 GPU|Apple A16 GPU",v:[46273595]},{x:"Apple A14 GPU|Apple A15 GPU",m:()=>hash(),n:[178,179],v:[3711606621]},{x:"Apple A8 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU",m:()=>mediacolorgamut(),n:[64,65],v:[2001]},{x:"Apple A8 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU",m:()=>mediacolorgamut(),n:[66,67],v:[2208]},{x:"Apple A12X GPU|Apple A12Z GPU|Apple M1 GPU|Apple M2 GPU",m:()=>hash3d(),n:[126,127,79,78],v:[2388]},{x:"Apple A14 GPU|Apple M1 GPU",m:()=>mediacolorgamut(),n:[112,48],v:[2360]},{x:"Apple A8 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU",m:()=>mediacolorgamut(),n:[69,67],v:[2208]},{x:"Apple A8 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU",m:()=>mediacolorgamut(),n:[71,65],v:[2001]},{x:"Apple A14 GPU|Apple A15 GPU|Apple M2 GPU",m:()=>ratio(),n:[113,49],v:[2778]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A9 GPU",m:()=>hash(),n:[130,131,82,83,84],v:["srgb"]},{x:"Apple A10 GPU|Apple A11 GPU|Apple A13 GPU|Apple A15 GPU",m:()=>hash3d(),n:[132,133,118,134,85,86],v:["p3"]},{x:"Apple A10 GPU|Apple A11 GPU|Apple A13 GPU|Apple A15 GPU",m:()=>hash(),n:[144,145,147,146,87,88],v:["p3"]},{x:"Apple A14 GPU|Apple A15 GPU",m:()=>hash(),n:[100,104],v:[3403189785]},{x:"Apple A10X GPU|Apple A12Z GPU|Apple M1 GPU|Apple M2 GPU",m:()=>hash(),n:[174,107,159,106],v:[3403189785]},{x:"Apple A14 GPU|Apple A15 GPU|Apple A16 GPU",v:[2775654583]},{x:"Apple A12 GPU|Apple A13 GPU",v:[3565683531]},{x:"Apple A14 GPU|Apple A15 GPU",m:()=>hash3d(),n:[74,122,77,52,29],v:[2778]},{x:"Apple A16 GPU|Apple A17 Pro GPU",m:()=>hash3d(),n:[123],v:[2796]},{x:"Apple A16 GPU|Apple A17 Pro GPU",m:()=>hash3d(),n:[123,177,53],v:[2556]},{x:"Apple A10 GPU|Apple A12 GPU|Apple A13 GPU",m:()=>hash(),n:[128,129,80,81],v:[2160]},{x:"Apple A14 GPU|Apple M1 GPU",m:()=>hash3d(),n:[74,96,59],v:["p3"]},{x:"Apple A14 GPU|Apple A15 GPU",m:()=>hash3d(),n:[74,122,77,52,29],v:[3]},{x:"Apple A14 GPU",v:[105985484,679860869]},{x:"Apple A15 GPU",v:[46273595,679860869]},{x:"Apple A14 GPU|Apple A15 GPU",m:()=>hash(),n:[22],v:[3403189785]},{x:"Apple A16 GPU|Apple A17 Pro GPU",v:[3711606621]},{x:"Apple A7 GPU",v:[1915583345]},{x:"Apple A9 GPU|Apple A9X GPU|Apple A10 GPU",v:[3129316290,3249312110]},{x:"Apple A9 GPU|Apple A9X GPU|Apple A10 GPU",m:()=>hash3d(),n:[168,105],v:[2114570256]},{x:"Apple A7 GPU",v:[857422828]},{x:"Apple A9 GPU|Apple A9X GPU|Apple A10 GPU",m:()=>hash3d(),n:[171],v:[63583436]},{x:"Apple A14 GPU|Apple M1 GPU",m:()=>hash(),n:[175,107],v:[3403189785]},{x:"Apple A12 GPU|Apple A13 GPU",m:()=>hash3d(),n:[116,115,76],v:[2688]},{x:"Apple A12 GPU|Apple A13 GPU",m:()=>hash3d(),n:[118,117,76],v:[1624]},{x:"Apple A12 GPU|Apple A13 GPU",m:()=>hash3d(),n:[118,119,76],v:[1792]},{x:"Apple A10X GPU|Apple A12 GPU",m:()=>hash(),n:[125,124],v:[2224]},{x:"Apple A8 GPU|Apple A9 GPU",m:()=>hash(),n:[135,136],v:["srgb"]},{x:"Apple A10 GPU|Apple A11 GPU",m:()=>hash(),n:[137,138],v:["p3"]},{x:"Apple A8 GPU|Apple A9 GPU",m:()=>hash(),n:[139,140],v:["srgb"]},{x:"Apple A10 GPU|Apple A11 GPU",m:()=>hash(),n:[137,141],v:["p3"]},{x:"Apple A8 GPU|Apple A9 GPU",m:()=>hash(),n:[142,143],v:["srgb"]},{x:"Apple A8 GPU|Apple A9 GPU",m:()=>hash(),n:[154,140],v:["srgb"]},{x:"Apple A8 GPU|Apple A9 GPU",m:()=>hash(),n:[154,143],v:["srgb"]},{x:"Apple A8 GPU|Apple A9 GPU",m:()=>hash(),n:[154,136],v:["srgb"]},{x:"Apple A12 GPU",v:[958581112,4085158452]},{x:"Apple A13 GPU",v:[1278953537,3335845976,4193218782]},{x:"Apple A14 GPU",v:[105985484]},{x:"Apple A12 GPU",v:[2301174800]},{x:"Apple A12 GPU|Apple A13 GPU",v:[3711606621]},{x:"Apple A14 GPU|Apple A15 GPU",m:()=>hash(),n:[104],v:[2364051618]},{x:"Apple A12X GPU|Apple A12Z GPU",v:[4085158452]},{x:"Apple M1 GPU|Apple M2 GPU",m:()=>hash(),n:[158,159],v:[3403189785]},{x:"Apple A12 GPU|Apple A13 GPU",m:()=>hash3d(),n:[160,75],v:[2206992415]},{x:"Apple A12 GPU|Apple A13 GPU",m:()=>hash3d(),n:[160,75],v:[2866949877]},{x:"Apple A9 GPU",v:[46663968,3129316290]},{x:"Apple A9 GPU",v:[2114570256]},{x:"Apple A9 GPU",v:[63583436]},{x:"Apple A13 GPU|Apple A15 GPU",m:()=>hash(),n:[161,162],v:[3403189785]},{x:"Apple A13 GPU|Apple A15 GPU",m:()=>hash(),n:[163,164],v:[3711606621]},{x:"Apple A11 GPU|Apple A13 GPU",m:()=>hash3d(),n:[165,166],v:[1349146759]},{x:"Apple A11 GPU|Apple A13 GPU",m:()=>hash3d(),n:[167,160],v:[2206992415]},{x:"Apple A8 GPU|Apple A8X GPU",v:[1361285941,3816812018,4125234388]},{x:"Apple A8 GPU|Apple A8X GPU",m:()=>hash3d(),n:[169,170],v:[4005673483]},{x:"Apple A8 GPU|Apple A8X GPU",m:()=>hash3d(),n:[169],v:[1350183384]},{x:"Apple A8 GPU|Apple A8X GPU",m:()=>hash3d(),n:[173,172],v:[2870741841]},{x:"Apple A9X GPU|Apple A10X GPU",v:[583354101,3458129248]},{x:"Apple A12 GPU|Apple A12X GPU",v:[4085158452]},{x:"Apple A9X GPU|Apple A10X GPU",v:[3928876783]},{x:"Apple M1 GPU",v:[2364051618]},{x:"Apple A8 GPU|Apple A8X GPU",m:()=>hash3d(),n:[176,170],v:[4005673483]},{x:"Apple A8 GPU|Apple A8X GPU",v:[1361285941]},{x:"Apple A9 GPU",v:[583354101,3403189785,3458129248,3928876783]},{x:"Apple A14 GPU",v:[1349146759,1444462398]},{x:"Apple A14 GPU",v:[1444462398]},{x:"Apple A15 GPU|Apple A16 GPU",v:[2775654583]},{x:"Apple A12 GPU|Apple A13 GPU",v:[3565683531]},{x:"Apple A15 GPU",v:[2775654583]},{x:"Apple A9X GPU|Apple A10 GPU",v:[3458129248]},{x:"Apple A12Z GPU|Apple M1 GPU",v:[1349146759]},{x:"Apple M1 GPU",v:[1444462398]},{x:"Apple A10 GPU",v:["iPod Touch"]},{x:"Apple A15 GPU",v:[2266]},{x:"Apple M2 GPU",v:[2778]},{x:"Apple A9X GPU",v:["srgb"]},{x:"Apple A14 GPU",v:["srgb"]},{x:"Apple M2 GPU",v:[2]},{x:"Apple A11 GPU",v:[367695777,411650080,1220644697]},{x:"Apple A12 GPU",v:[958581112,2301174800,4085158452]},{x:"Apple A13 GPU",v:[352823931,1278953537,3335845976,4193218782]},{x:"Apple A12 GPU",v:[0,958581112,2301174800,3403189785,4085158452]},{x:"Apple A13 GPU",v:[352823931,3335845976,4193218782]},{x:"Apple A12 GPU",v:[958581112,2301174800,3403189785,4085158452]},{x:"Apple A11 GPU",v:[367695777,411650080]},{x:"Apple A13 GPU",v:[352823931,1278953537,3335845976]},{x:"Apple A15 GPU",v:[1407135659]},{x:"Apple A16 GPU",v:[46273595,3403189785]},{x:"Apple A10X GPU",v:[63583436,2114570256,3129316290,3249312110]},{x:"Apple A12 GPU",v:[1349146759,2917249763]},{x:"Apple M1 GPU",v:[105985484,2364051618]},{x:"Apple M2 GPU",v:[46273595]},{x:"Apple A10 GPU",v:[2114570256]},{x:"Apple A12 GPU",v:[1349146759]},{x:"Apple A7 GPU",v:[857422828,1915583345]},{x:"Apple A8 GPU",v:[839732043,3816812018,4125234388]},{x:"Apple A10 GPU",v:[583354101,3458129248,3928876783]},{x:"Apple A11 GPU",v:[367695777,411650080,1220644697,1804407534]},{x:"Apple A15 GPU",v:[2364051618]},{x:"Apple A8 GPU",v:[1411440593,1924197914,4125234388]},{x:"Apple A9 GPU",v:[2114570256,3129316290]},{x:"Apple A10 GPU",v:[63583436,2114570256,3129316290]},{x:"Apple A11 GPU",v:[1349146759,2206992415,2917249763,2946940121]},{x:"Apple A8 GPU",v:[1411440593,1913250432,3074367344,4125234388]},{x:"Apple A9 GPU",v:[46663968,2114570256,3129316290]},{x:"Apple A11 GPU",v:[2206992415,2917249763,2946940121,3237505312]},{x:"Apple A8 GPU",v:[3128296539,3816812018,4125234388]},{x:"Apple A9 GPU",v:[46663968,63583436,2114570256,3129316290]},{x:"Apple A10 GPU",v:[46663968,63583436,2114570256,3129316290]},{x:"Apple A11 GPU",v:[2917249763,2946940121,3237505312]},{x:"Apple A15 GPU",v:[235283973,1444462398,2775654583]},{x:"Apple A13 GPU",v:[2866949877,3565683531]},{x:"Apple A8 GPU",v:[2656686317,3710391565]},{x:"Apple A10 GPU",v:[46663968]},{x:"Apple A12Z GPU",v:[958581112,2301174800,2487400911]},{x:"Apple A12X GPU",v:[4085158452]},{x:"Apple A10X GPU",v:[583354101,3458129248,3928876783]},{x:"Apple A8X GPU",v:[1350183384,3816812018,4125234388]},{x:"Apple A8 GPU",v:[4125234388]},{x:"Apple A7 GPU",v:[1966062736]},{x:"Apple A8 GPU",v:[2998196247]},{x:"Apple A13 GPU",v:[2866949877]},{x:"Apple M1 GPU",v:[1349146759,1444462398]},{x:"Apple M2 GPU",v:[2775654583]},{x:"Apple A13 GPU",v:[3335845976]},{x:"Apple A13 GPU",v:[1349146759]},{x:"Apple A15 GPU",v:[1444462398]},{x:"Apple A13 GPU",v:[3565683531]},{x:"Apple A15 GPU",v:[235283973]},{x:"Apple A11 GPU",v:[411650080,1220644697]},{x:"Apple A13 GPU",v:[352823931,3403189785,4193218782]},{x:"Apple A11 GPU",v:[367695777]},{x:"Apple A10 GPU",v:[3403189785]},{x:"Apple A8X GPU",v:[1783160115]},{x:"Apple A8 GPU",v:[3928382683]},{x:"Apple A10 GPU",v:[1058363647,2015944978]},{x:"Apple A8 GPU",v:[3312905059,3928382683]},{x:"Apple A8X GPU",v:[1480368425,1783160115,3403189785]},{x:"Apple A10X GPU",v:[2114570256]},{x:"Apple A14 GPU",v:[1349146759]},{x:"Apple A8X GPU",v:[1783160115,3403189785]},{x:"Apple A17 Pro GPU",v:[256903246]},{x:"Apple A14 GPU",v:[235283973]},{x:"Apple A15 GPU",v:[2370695082]}]};
/*! VERSION = 1.7 */function evaluateNode(node,iterations){if(node.m){var result=node.m(node);result||""===result?result.then||function resolveNode(node,value,iterations){for(var i=0;i<node.n.length;i++){var child=decisionTree.Data[node.n[i]];if(child.r)for(var c=0;c<child.r.length;c++){var range=child.r[c];if((null===range.a||value>=range.a)&&(null===range.b||value<=range.b))return void evaluateNode(child,0)}else if(child.v&&-1!=child.v.indexOf(value))return void evaluateNode(child,0)}node.n.length>0&&iterations<3?setTimeout(function(){evaluateNode(node,iterations+1)},10):complete(node.x)}(node,result,iterations):node.x&&complete(node.x)}else complete(node.x)}evaluateNode(decisionTree.Data[0],0)}function height(){return window.screen.height*window.devicePixelRatio}function ratio(){return window.devicePixelRatio}function hasMediaSupport(query){return window.matchMedia(query).matches}function mediacolorgamut(){return function getMediaSingleValue(name,possibleValues){for(var i=0;i<possibleValues.length;i++)if(hasMediaSupport("("+name+": "+possibleValues[i]+")"))return possibleValues[i];return"n/a"}("color-gamut",["p3","srgb"])}function family(){var segments=/iPhone|iPad|Macintosh/.exec(navigator.userAgent);return segments&&segments.length>0?segments[0]:""}this.exports={async getRenderer(){let rendererPromise=Promise.create();getRenderer(rendererPromise.resolve);let result=await rendererPromise;if("Unknown"!==result){if(result.includes("|")){let gpus=result.split("|");result=gpus.last()}return result}},fallbackTest:function fallbackTest(time=primeTest()){let res=Math.min(screen.width,screen.height)+"x"+Math.max(screen.width,screen.height);if(Global.iOSGPUFALLBACKTEST=time,time<100)return"apple a18";switch(res){case"320x480":return"legacy";case"320x568":return time<=400?"apple a8":time<=500?"apple a7":"legacy";case"375x812":case"414x896":return time<=150?"apple a13":time<=180?"apple a12":"apple a11";case"414x736":case"375x667":return time<=220?"apple a11":time<=250?"apple a10":time<=360?"apple a9":time<=400?"apple a8":time<=600?"apple a7":"legacy";default:case"768x1024":return time<=140?"apple a14":time<=160?"apple a13":time<=180?"apple a12":time<=220?"apple a11":time<=250?"apple a10":time<=360?"apple a9":time<=400?"apple a8":time<=600?"apple a7":"legacy";case"834x1112":return time<=160?"apple a13":time<=180?"apple a12":time<=220?"apple a11":"apple a10";case"834x1194":if(time<=140)return"apple m1 gpu";if(time<=160)return"apple a13";if(time<=180)return"apple a12";break;case"810x1080":if(time<=160)return"apple a13";if(time<=220)return"apple a11";if(time<=250)return"apple a10";break;case"820x1180":return"apple a14";case"428x926":case"390x844":return"apple a15";case"1024x1366":return time<=140?"apple m1 gpu":time<=160?"apple a13":time<=180?"apple a12":time<=220?"apple a11":time<=250?"apple a10":"apple a9"}},primeTest:primeTest,family:family,width:function width(){return window.screen.width*window.devicePixelRatio},height:height,mediacolorgamut:mediacolorgamut,hash3d:hash3d,hash:hash,ratio:ratio}}),Module(function GPUBlocklist(){this.exports={match:function(){return!Device.graphics.gpu||Device.graphics.gpu.detect(["radeon hd 6970m","radeon hd 6770m","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 5750","radeon hd 5670","radeon hd 4850","radeon hd 4870","radeon hd 4670","geforce 9400m","geforce 320m","geforce 330m","geforce gt 130","geforce gt 120","geforce gtx 285","geforce 8600","geforce 9600m","geforce 9400m","geforce 8800 gs","geforce 8800 gt","quadro fx 5","quadro fx 4","radeon hd 2600","radeon hd 2400","radeon hd 2600","mali-4","mali-3","mali-2","swiftshader","basic render driver","generic renderer","sgx543","legacy","sgx 543"])}}}),Class(function HierarchyAnimation(_data,createObjects,_isLayout){Inherit(this,Object3D);const _this=this;var _objects,_lastElapsed=-1;this.elapsed=0,this.weight=1,this.scale=1,this.duration=0,this.loop=!1;const prevPos=new Vector3,prevRot=new Quaternion,prevScl=new Vector3,nextPos=new Vector3,nextRot=new Quaternion,nextScl=new Vector3,DEFAULT_QUAT=new Quaternion(0,0,0,1),DEFAULT_POS=new Vector3(0,0,0),DEFAULT_SCALE=new Vector3(1,1,1);function loop(){_this.update()}!async function(){if("function"!=typeof createObjects)throw"HierarchyAnimation :: Second parameter requires callback function to create objects";if("string"==typeof _data&&(_data=await get(Assets.getPath(`assets/geometry/${_data}.json`))),_objects=await createObjects(_data.hierarchy),!Array.isArray(_objects))throw"HierarchyAnimation :: Object creation function requires an array to be returned";!function nestObjects(){try{if(_data.hierarchy.length!=_objects.length)throw"HierarchyAnimation :: Number of objects in hierarchy does not match number of objects created.";_data.hierarchy.forEach((d,i)=>{if(d.parent>-1){"null"!=_data.hierarchy[Number(d.parent)].name&&_objects[d.parent].add(_objects[i])}else"null"!=d.name&&_this.add(_objects[i])})}catch(e){throw console.error("HierarchyAnimation :: Could not successfully nest objects -- check your names!"),e}}(),_this.duration=_data.frames.length,_this.fps=_data.fps}(),this.update=function(totalWeight=1,isSet){if(!_objects)return;const weight=isSet?1:_this.weight/totalWeight,elapsed=Math.clamp(_this.elapsed,0,.99)*_this.duration;if(Math.abs(elapsed-_lastElapsed)<.001)return;_lastElapsed=elapsed;const floorFrame=Math.floor(elapsed),blend=elapsed-floorFrame,prevKey=_data.frames[floorFrame],nextKey=_data.frames[_this.loop?(floorFrame+1)%_this.duration:floorFrame+1];prevKey&&nextKey&&_objects.forEach((object,i)=>{prevPos.fromArray(prevKey.position,3*i).multiplyScalar(_this.scale),prevRot.fromArray(prevKey.quaternion,4*i),prevScl.fromArray(prevKey.scale,3*i),nextPos.fromArray(nextKey.position,3*i).multiplyScalar(_this.scale),nextRot.fromArray(nextKey.quaternion,4*i),nextScl.fromArray(nextKey.scale,3*i),prevPos.lerp(nextPos,blend,!1),prevRot.slerp(nextRot,blend,!1),prevScl.lerp(nextScl,blend,!1),_isLayout?(prevPos.equals(DEFAULT_POS)||object.position.lerp(prevPos,weight,!1),prevRot.equals(DEFAULT_QUAT)||object.quaternion.slerp(prevRot,weight,!1),prevScl.equals(DEFAULT_SCALE)||object.scale.lerp(prevScl,weight,!1)):(object.position.lerp(prevPos,weight,!1),object.quaternion.slerp(prevRot,weight,!1),object.scale.lerp(prevScl,weight,!1))})},this.start=function(){_this.startRender(loop)},this.stop=function(){_this.stopRender(loop)},this.ready=function(){return _this.wait(_this,"duration")},this.set("data",data=>{_data=data,_this.duration=_data.frames.length,_this.fps=_data.fps,_this.elapsed=0})}),Class(function HierarchyLayout(_data,createObjects){Inherit(this,Component);const _this=this;var _animation;!async function(){_animation=new HierarchyAnimation(_data,createObjects,!0),_this.group=_animation.group,_animation.loop=!0,await _animation.ready(),_animation.update()}(),this.ready=function(){return _animation.ready()},this.set("scale",s=>_animation.scale=s)}),Class(function LayerAnimation(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;var _config,_hierarchy,_json;async function initFile(){let file=await _config.get("Animation File");"string"==typeof file&&(file=JSON.parse(file)),file&&(_json=await get(file.src),async function initHierarchy(){_hierarchy&&_hierarchy.destroy();_hierarchy=_this.initClass(HierarchyAnimation,_json,data=>{let array=[];for(let i=0;i<data.length;i++){"null"!=data[i].name?array.push(_mesh):array.push(new Group)}return array}),await _hierarchy.ready(),_hierarchy.update(),_this.flag("initialized",!0)}())}!async function(){_mesh.classRef&&(_mesh.classRef.animation=_this),_mesh.animation=_this,function initConfig(){(_config=InputUIL.create(_input.prefix+"anim",_group)).addFile("Animation File"),_config.onUpdate=key=>{"Animation File"==key&&initFile()}}(),initFile()}(),this.play=async function(time,ease,delay){await _this.wait("initialized"),ease||(ease="linear"),time||(time=_json.frames.length/_json.fps*1e3),_hierarchy.data=_json,_hierarchy.start(),await tween(_hierarchy,{elapsed:1},time,ease,delay).promise(),_hierarchy.stop()},this.setPlayhead=function(playhead){_hierarchy&&(_hierarchy.elapsed=playhead,_hierarchy.update())}}),Class(function Initializer3D(){Inherit(this,Component);const _this=this;let _loader,_working,_promiseCount=0,_queue=[],_resolved=Promise.create();async function workQueue(){clearTimeout(_this.warningTimer),_working=!0;let promise=_queue.shift();if(!promise)return _working=!1;promise.resolve(workQueue),Hydra.LOCAL&&(_this.warningTimer=_this.delayedCall(_=>{console.warn("Long running queue has taken more than 5 seconds.")},5e3))}this.READY="initializer_ready",this.bundle=function(){return new function PromiseBundler(){const promises=[],ready=Promise.create();let timer;function run(){clearTimeout(timer),timer=_this.delayedCall(_=>{Promise.all(promises).then(_=>ready.resolve())},100)}this.capture=function(promise){promises.push(promise),run()},this.ready=function(){return run(),ready}}},this.promise=this.capture=function(promise){return _loader&&_loader.add(1),async function wrapPromise(promise){try{_promiseCount+=1,await promise}finally{_loader&&_loader.trigger(1),_promiseCount-=1,0===_promiseCount&&(clearTimeout(_this.fire),_this.fire=_this.delayedCall(_=>{_this.events.fire(_this.READY),_resolved.resolve(),_this.resolved=!0,Utils3D.onTextureCreated=null,_loader&&_loader.trigger(50)},100))}}(promise),promise},this.ready=this.loaded=function(){return _resolved},this.createWorld=async function(){await Promise.all([AssetLoader.waitForLib("zUtils3D"),Shaders.ready(),GPU.ready(),UILStorage.ready()]),await MatrixWasm.ready(),World.instance()},this.linkSceneLayout=function(loader){_this.captureTextures(),SceneLayout.initializer=_this.capture,_loader=loader},this.queue=function(immediate){if(immediate)return Promise.resolve(_=>{});let promise=Promise.create();return _queue.push(promise),_working||workQueue(),promise},this.captureTextures=function(){Utils3D.onTextureCreated=texture=>{_this.promise(texture.promise)}},this.uploadAll=async function(group){if(!group)throw"Undefined passed to uploadAll";let sceneLayout;if(group.layout&&(group=group.layout),group instanceof SceneLayout||window.StageLayout&&group instanceof StageLayout){if(sceneLayout=group,sceneLayout.uploaded)return;sceneLayout.uploaded=!0,await sceneLayout.loadedAllLayers(),group=group.group}let promises=[],layouts=[],textures=[];if(sceneLayout){sceneLayout.textures=textures;for(let key in sceneLayout.layers){let layer=sceneLayout.layers[key];layer.uploadSync&&layer.uploadSync()}}if(sceneLayout?.parent){for(let key in sceneLayout.parent.classes){let clss=sceneLayout.parent.classes[key];clss.upload&&clss.upload(),clss.uploadSync&&clss.uploadSync()}sceneLayout.parent.nuke&&_this.uploadNuke(sceneLayout.parent.nuke)}let seen=new Set;group.traverse(obj=>{if(!seen.has(obj)&&(seen.add(obj),obj.sceneLayout&&obj!=group&&layouts.push(obj.sceneLayout),obj.stageLayout&&obj!=group&&layouts.push(obj.stageLayout),!obj.uploadIgnore&&0!=obj.visible)){if(obj.shader)for(let key in obj.shader.uniforms){let uniform=obj.shader.uniforms[key],val=uniform?.value;if(val){if(seen.has(val))continue;seen.add(val),val.promise&&!val.uploadIgnore&&(textures.push(val),promises.push(val.promise.then(val.upload.bind(val)).catch(e=>{}))),val.scene&&layouts.push(val.scene),val.layout&&layouts.push(val.layout)}}obj.shader&&obj.shader.shadow&&obj.shader.shadow.upload(),obj.classRef&&obj.classRef.upload&&obj.classRef.upload(),obj.asyncPromise?promises.push(obj.asyncPromise.then(obj.upload.bind(obj))):obj.upload&&obj.upload()}}),await Promise.catchAll(promises),textures.forEach(t=>t.upload());for(let i=0;i<layouts.length;i++)await _this.uploadAll(layouts[i]);sceneLayout&&sceneLayout._completeInitialization&&sceneLayout._completeInitialization(!0),sceneLayout&&delete sceneLayout.textures},this.uploadAllDistributed=this.uploadAllAsync=async function(group,releaseQueue){if(!group)throw"Undefined passed to uploadAllDistributed";let sceneLayout;if(group.layout&&(group=group.layout),releaseQueue||"boolean"==typeof releaseQueue||(releaseQueue=await _this.queue()),group instanceof SceneLayout||window.StageLayout&&group instanceof StageLayout){if(sceneLayout=group,sceneLayout.uploaded)return"function"==typeof releaseQueue?releaseQueue():void 0;sceneLayout.uploaded=!0,await sceneLayout.loadedAllLayers(),group=group.group}let steppers=[],promises=[],layouts=[],textures=[];if(sceneLayout){sceneLayout.textures=textures;for(let key in sceneLayout.layers){let layer=sceneLayout.layers[key];layer.upload&&!layer.uploadIgnore&&!1!==layer.visible&&layer.upload()}}if(sceneLayout?.parent){for(let key in sceneLayout.parent.classes){let clss=sceneLayout.parent.classes[key];clss.upload&&steppers.push(()=>(clss.upload(),!0))}sceneLayout.parent.nuke&&_this.uploadNukeAsync(sceneLayout.parent.nuke)}let seen=new Set,pushUpload=obj=>{steppers.push(()=>(obj.upload(),!0))},pushGeometry=geometry=>{seen.has(geometry)||(steppers.push(Geometry.renderer.getUploadBuffersStepper(geometry)),seen.add(geometry))};group.traverse(obj=>{if(!seen.has(obj)&&(seen.add(obj),obj.sceneLayout&&obj!=group&&layouts.push(obj.sceneLayout),obj.stageLayout&&obj!=group&&layouts.push(obj.stageLayout),!obj.uploadIgnore&&0!=obj.visible)){if(obj.shader)for(let key in obj.shader.uniforms){let uniform=obj.shader.uniforms[key],val=uniform?.value;if(val){if(seen.has(val))continue;seen.add(val),val.promise&&!val.uploadIgnore&&(textures.push(val),promises.push(val.promise.then(_=>pushUpload(val)).catch(e=>{}))),val.scene&&layouts.push(val.scene),val.layout&&layouts.push(val.layout)}}if(obj.asyncPromise)promises.push(obj.asyncPromise.then(_=>{obj.geometry&&(obj.geometry.distributeBufferData=!0),pushUpload(obj),obj.geometry&&pushGeometry(obj.geometry)}));else if(obj.upload){if(obj.geometry){if(obj.geometry.uploaded)return;obj.geometry.distributeBufferData=!0}pushUpload(obj),obj.geometry&&pushGeometry(obj.geometry)}obj.shader&&obj.shader.shadow&&pushUpload(obj.shader.shadow),obj.classRef&&obj.classRef.upload&&pushUpload(obj.classRef)}});let canFinish=!1,promise=Promise.create(),stepperIndex=0,worker=new Render.Worker(_=>{let stepper=steppers[stepperIndex];stepper?stepper()&&stepperIndex++:canFinish?((async()=>{for(let i=0;i<layouts.length;i++)await _this.uploadAllAsync(layouts[i],!!releaseQueue);"function"==typeof releaseQueue&&releaseQueue(),promise.resolve()})(),worker.stop()):worker.pause()},2);return Promise.catchAll(promises).then(_=>{worker.resume(),canFinish=!0}),sceneLayout&&sceneLayout._completeInitialization&&sceneLayout._completeInitialization(!1),sceneLayout&&promise.then(_=>{delete sceneLayout.textures}),promise},this.detectUploadAll=function(group,sync,releaseQueue){return sync?_this.uploadAll(group):_this.uploadAllDistributed(group,releaseQueue)},this.detectUploadNuke=function(nuke,sync){return sync?_this.uploadNuke(nuke):_this.uploadNukeAsync(nuke)},this.uploadNuke=async function(nuke){if(nuke&&nuke.enabled){for(let i=0;i<nuke.passes.length;i++){let pass=nuke.passes[i],uniforms=pass.uniforms;for(let key in uniforms)uniforms[key].value&&uniforms[key].value.promise&&await uniforms[key].value.promise,uniforms[key].value&&uniforms[key].value.upload&&uniforms[key].value.upload();pass.upload()}Nuke.defaultPass.uploaded||Nuke.defaultPass.upload(),nuke.render()}},this.uploadNukeAsync=async function(nuke){let queue=await _this.queue(),calls=[];for(let i=0;i<nuke.passes.length;i++){let pass=nuke.passes[i],uniforms=pass.uniforms;for(let key in uniforms)uniforms[key].value&&uniforms[key].value.promise&&await uniforms[key].value.promise,uniforms[key].value&&uniforms[key].value.upload&&calls.push(uniforms[key].value.upload.bind(uniforms[key].value));calls.push(pass.upload.bind(pass))}Nuke.defaultPass.uploaded||calls.push(Nuke.defaultPass.upload.bind(Nuke.defaultPass)),calls.push(nuke.render.bind(nuke));let promise=Promise.create(),worker=new Render.Worker(function uploadBuffersAsync(){let cb=calls.shift();cb?cb():(promise.resolve(),worker.stop())});await promise,queue()},this.destroyAll=function(scene){scene.traverse(obj=>{if(obj.geometry&&obj.shader){for(let key in obj.shader.uniforms){let uniform=obj.shader.uniforms[key];uniform&&uniform.value instanceof Texture&&uniform.value.destroy()}obj.destroy()}})},this.set("loader",loader=>{_loader=loader})},"static"),Class(function Line3D(_params={}){Inherit(this,Object3D);const _this=this;let _geometry,_shader,_mesh,_vs,_fs,_prevPoint,_index=_params.index||0,_points=_params.points||[],_pressure=_params.pressure||[],_taperFunction=_params.taperFunction||(()=>1),_dynamic=_params.dynamic||!1;function initMesh(){if(_mesh)return;let geometry;if(_params.geometry)geometry=_params.geometry;else{if(_points.length<2)return;geometry=_geometry.geometry}_mesh=new Mesh(geometry,_shader),_mesh.frustumCulled=!1,"number"==typeof _params.renderOrder&&(_mesh.renderOrder=_params.renderOrder),_this.add(_mesh),_this.mesh=_mesh,_geometry&&(_geometry.mesh=_mesh)}!function initGeometry(){_params.geometry||(_geometry=_this.initClass(LineGeometry,{index:_index,points:_points,pressure:_pressure,taperFunction:_taperFunction,dynamic:_dynamic}))}(),window.THREAD||(function initShader(){const shaderName=_params.customShader||"Line";_shader=_this.initClass(Shader,shaderName,{uLineWidth:{value:_params.width||Line3D.defaultLineWidth,ignoreUIL:!0},uBaseWidth:Line3D.BASE_WIDTH,uColor:{value:new Color(_params.color||Line3D.defaultColor),ignoreUIL:!0},uOpacity:{value:_params.opacity||Line3D.defaultOpacity,ignoreUIL:!0},transparent:!0,depthWrite:!1!==_params.depthWrite,depthTest:!1!==_params.depthTest}),_vs=_shader.vertexShader,_fs=_shader.fragmentShader,_vs&&(Line3D.vertexShader=_shader.vertexShader,Line3D.vsName=_shader.vsName,Line3D.fragmentShader=_shader.fragmentShader,Line3D.fsName=_shader.fsName),_this.shader=_shader}(),initMesh(),Hydra.LOCAL&&function initHotReload(){_this.events.sub(ShaderUIL.SHADER_UPDATE,({shader:shader})=>{let updateCustom=!1;if(shader.includes(Line3D.vsName)){let newBaseShader=new Shader(Line3D.vsName,Line3D.fsName);if(newBaseShader.resetProgram(),_vs=Line3D.vertexShader=newBaseShader.vertexShader,_fs=Line3D.fragmentShader=newBaseShader.fragmentShader,_shader.vsName===newBaseShader.vsName)return;updateCustom=!0}if(shader.includes(_shader.vsName)||updateCustom){let newShader=new Shader(_shader.vsName,_shader.fsName,_shader.params);_this.useShader(newShader),Shader.renderer.hotReloadClearProgram(_shader.customCompile)}})}()),this.get("data",()=>({geometry:{points:_points,pressure:_pressure,index:_index},meta:{fs:_shader.fsName,vs:_shader.vsName,width:_shader.uniforms.uLineWidth.value,opacity:_shader.uniforms.uOpacity.value,color:_shader.uniforms.uColor.value.getHex()}})),this.get("lineGeometry",()=>_geometry),this.get("geometry",()=>_mesh?.geometry||_geometry.geometry),this.set("lineWidth",v=>{_shader.set("uLineWidth",v)}),this.set("color",hex=>{_shader.uniforms.uColor.value.set(hex)}),this.set("opacity",value=>{_shader.uniforms.uOpacity.value=value}),this.useShader=function(shader){_shader.vertexShader=_vs,_shader.fragmentShader=_fs,_shader=Line3D.mergeShaders(shader,_shader),_this.shader=_shader,_mesh&&(_mesh.shader=_shader)},this.draw=function(pos,pressure=1){_points.push(pos.x,pos.y,pos.z||0),_pressure.push(pressure),_points.length<2||(_geometry.update(_points,!0),_mesh||initMesh())},this.moveTo=function(pos,subdivisions=30){if(_prevPoint){let v=new Vector3;for(let i=0;i<subdivisions;i++)v.copy(_prevPoint).lerp(pos,i/(subdivisions-1),!1),_points.push(v.x,v.y,v.z||0),_pressure.push(1)}_prevPoint=pos,_points.length<2||(_geometry.update(_points,!0),_mesh||initMesh())},this.clear=function(clearGeometry=!0){_points.length=0,_prevPoint=null,clearGeometry&&_geometry.clear()},this.fromCurve=function(curve,subdivisions=30){_this.clear();for(let i=0;i<=subdivisions;i++){let pct=i/subdivisions,pos=curve.getPoint(pct);_points.push(pos.x,pos.y,pos.z||0),_pressure.push(1)}_geometry.update(_points,!0),_mesh||initMesh()},this.onDestroy=function(){_this.parent&&_this.parent.group&&_this.parent.group.remove(_this.group),_mesh&&_mesh.destroy&&_mesh.destroy(),_this._onDestroy&&_this._onDestroy()}},()=>{Line3D.defaultLineWidth=1,Line3D.defaultOpacity=1,Line3D.defaultColor="#ffffff",Line3D.BASE_WIDTH={value:.005,ignoreUIL:!0},Line3D.MAX_LINE_LENGTH=500,Line3D.mergeShaders=function(s0,s1){s0.customCompile=`${s0.vsName}|${s0.fsName}|Line3D`,s1.copyUniformsTo(s0);for(let key in s1.properties)s0.properties[key]=s1.properties[key];if(s0.lineFormat||!s0.vertexShader)return s0.lineFormat=!0,s0;s1.fragmentShader||(s1.fragmentShader=Line3D.fragmentShader,s1.vertexShader=Line3D.vertexShader);let vs=s0.vertexShader.split("__ACTIVE_THEORY_LIGHTS__")[1],fs=s0.fragmentShader.split("__ACTIVE_THEORY_LIGHTS__")[1],split=vs.split("void main() {"),fsParams=s1.fragmentShader.split("__ACTIVE_THEORY_LIGHTS__")[1].split("void main")[0];if(s0.fragmentShader=s0.fragmentShader.split("__ACTIVE_THEORY_LIGHTS__").join(fsParams),s1.vertexShader=s1.vertexShader.replace("//params",split[0]),s1.vertexShader=s1.vertexShader.replace("//main",split[1].split("}")[0]),s0.vertexShader.includes("customMatrix")){let content=s0.vertexShader.split("customMatrix() {")[1];content=content.split("}")[0];let matrix=s1.vertexShader.split("//startMatrix")[1].split("//endMatrix")[0];s1.vertexShader=s1.vertexShader.replace(matrix,content)}if(s0.vertexShader.includes("customDirection")){let content=s0.vertexShader.split("customDirection() {")[1];content=content.split("}")[0],s1.vertexShader=s1.vertexShader.replace("//direction",content)}return split=fs.split("void main() {"),s1.fragmentShader=s1.fragmentShader.replace("//fsmain",split[1].substring(0,split[1].lastIndexOf("}"))),s1.fragmentShader=s1.fragmentShader.replace("//fsparams",split[0]),s0.vertexShader=s1.vertexShader,s0.fragmentShader=s1.fragmentShader,s0}}),Class(function Line3DLayer(_input,_group){Inherit(this,Object3D);const _this=this;var _shader,_line,_config;async function load(json,subdivisions,color,width){json.includes("assets/geometry")||(json=`assets/geometry/${json}`),json.includes(".json")||(json+=".json");let merged=await LineUtil.loadFromSplines(Assets.getPath(json),subdivisions,color,width);_line=merged,_this.add(merged),_shader&&merged.useShader(_shader),_this.flag("loaded",!0)}!function(){let config=InputUIL.create(_input.prefix+"line3d",_group);config.add("json").add("subdivisions",100).addColor("color",new Color).add("width",10).setLabel("Spline");let json=config.get("json");if(json){load(json,_this.parent.data&&_this.parent.data.line3DSubdivisions?_this.parent.data.line3DSubdivisions:config.getNumber("subdivisions"),config.get("color"),config.getNumber("width"))}_config=config,function initShader(){let shader=_input.get("shader");shader&&shader.length&&(_this.shader=_shader=_this.initClass(Shader,shader,{transparent:!0,unique:_input.prefix}),function completeShader(shader){let transparent=_input.get("transparent"),depthWrite=_input.get("depthWrite"),depthTest=_input.get("depthTest"),blending=_input.get("blending"),castShadow=_input.get("castShadow"),receiveShadow=_input.get("receiveShadow");"boolean"==typeof depthWrite&&(shader.depthWrite=depthWrite);"boolean"==typeof depthTest&&(shader.depthTest=depthTest);"boolean"==typeof transparent&&(shader.transparent=transparent);"boolean"==typeof castShadow&&defer(_=>_this.mesh.castShadow=castShadow);"boolean"==typeof receiveShadow&&(shader.receiveShadow=receiveShadow);blending&&(shader.blending=blending)}(_shader),window[shader]&&_this.initClass(window[shader],_this,_shader),ShaderUIL.add(_shader,_group).setLabel("Shader"))}()}(),this.ready=function(){return _this.wait("loaded")},this.getRandomPosition=async function(){let positions=_line.geometry.attributes.position.array,index=3*Math.random(0,positions.length/3,0);return new Vector3(positions[index],positions[index+1],positions[index+2])},this.loadFile=function(path){if(_line&&(_this.flag("loaded",!1),_this.group.remove(_line.group),_line.destroy()),"string"==typeof path)load(path,_config.getNumber("subdivisions"),_config.get("color"),_config.getNumber("width"));else{let merged=path;_line=merged,_this.add(merged),_shader&&merged.useShader(_shader),_this.flag("loaded",!0)}}}),Class(function LineGeometry({index:index=0,points:points=[],taperFunction:taperFunction=()=>1,defaultCount:defaultCount=512,dynamic:dynamic=!1}){Inherit(this,Component);const _this=this;_this.index=index,_this.points=points,_this.taperFunction=taperFunction;const _geometry=_this.geometry=new Geometry,_attr=_geometry.attributes;let _prev=new Vector3,_curr=new Vector3,_length=0,_count=0,_defaultPoints=[];function initBuffers(count){_geometry.addAttribute("position",new GeometryAttribute(new Float32Array(3*count*2),3,!1,dynamic)),_geometry.addAttribute("previous",new GeometryAttribute(new Float32Array(3*count*2),3,!1,dynamic)),_geometry.addAttribute("next",new GeometryAttribute(new Float32Array(3*count*2),3,!1,dynamic)),_geometry.addAttribute("side",new GeometryAttribute(new Float32Array(1*count*2),1,!1,dynamic)),_geometry.addAttribute("lineIndex",new GeometryAttribute(new Float32Array(1*count*2),1,!1,dynamic)),_geometry.addAttribute("width",new GeometryAttribute(new Float32Array(1*count*2),1,!1,dynamic)),_geometry.addAttribute("uv",new GeometryAttribute(new Float32Array(2*count*2),2,!1,dynamic)),_geometry.addAttribute("uv2",new GeometryAttribute(new Float32Array(2*count*2),2,!1,dynamic)),_geometry.setIndex(new GeometryAttribute(new Uint16Array(3*(count-1)*2),1,!1,dynamic)),_geometry.drawRange.end=0,_length=0,_count=0,function setStaticBuffers(count){for(let i=0;i<count;i++){if(_attr.side.setXY(2*i,1,-1),_attr.lineIndex.setXY(2*i,_this.index,_this.index),i===count-1)continue;let ind=2*i;_geometry.index[3*(ind+0)+0]=ind+0,_geometry.index[3*(ind+0)+1]=ind+1,_geometry.index[3*(ind+0)+2]=ind+2,_geometry.index[3*(ind+1)+0]=ind+2,_geometry.index[3*(ind+1)+1]=ind+1,_geometry.index[3*(ind+1)+2]=ind+3}}(count)}function getPos(index){let i=3*index;return[points[i],points[i+1],points[i+2]]}function update(p=points,force=!1){if(_this.points==p&&!force)return;_this.points=points=p;let newLength=points.length/3;2*newLength>_attr.position.count&&function increaseBuffers(){initBuffers(_attr.position.count/2+defaultCount)}();let oldLength=_count;if(oldLength&&!force){let nxt=getPos(oldLength);_attr.next.setXYZ(2*(oldLength-1)+0,nxt[0],nxt[1],nxt[2]),_attr.next.setXYZ(2*(oldLength-1)+1,nxt[0],nxt[1],nxt[2])}else _length=0;for(let i=force?0:oldLength;i<newLength;i++){_attr.position.setXYZ(2*i+0,points[3*i+0],points[3*i+1],points[3*i+2]),_attr.position.setXYZ(2*i+1,points[3*i+0],points[3*i+1],points[3*i+2]);let prv=getPos(Math.max(0,i-1));_attr.previous.setXYZ(2*i+0,prv[0],prv[1],prv[2]),_attr.previous.setXYZ(2*i+1,prv[0],prv[1],prv[2]);let nxt=getPos(Math.min(newLength-1,i+1));_attr.next.setXYZ(2*i+0,nxt[0],nxt[1],nxt[2]),_attr.next.setXYZ(2*i+1,nxt[0],nxt[1],nxt[2]),_prev.fromArray(prv),_curr.fromArray(getPos(i)),_length+=_prev.distanceTo(_curr),_attr.uv2.setX(2*i+0,_length),_attr.uv2.setX(2*i+1,_length)}for(let i=0;i<newLength;i++){_attr.uv.setXY(2*i+0,i/newLength,0),_attr.uv.setXY(2*i+1,i/newLength,1),_attr.uv2.setY(2*i+0,_length),_attr.uv2.setY(2*i+1,_length);let w=_this.taperFunction(i/(newLength-1),i,newLength);_attr.width.setXY(2*i,w,w)}_attr.position.needsUpdate=!0,_attr.previous.needsUpdate=!0,_attr.next.needsUpdate=!0,_attr.width.needsUpdate=!0,_attr.uv.needsUpdate=!0,_attr.uv2.needsUpdate=!0,_geometry.drawRange.end=6*(newLength-1),_count=newLength,_this.points=points}!function(){initBuffers(points.length?points.length/3:defaultCount);for(let i=0;i<defaultCount;i++)_defaultPoints.push(0,0,0);points.length&&update(points,!0)}(),this.update=update,this.clear=function clear(){update(_defaultPoints,!0),_length=0,_count=0}}),Class(function MergedLine(_geometry,_lineCount){Inherit(this,Object3D);const _this=this;var _shader,_mesh,_vs,_fs;function updateShader(shader){shader.customCompile=`${shader.vsName}|${shader.fsName}|MergedLine`,shader.resetProgram(),shader.vertexShader=shader.vertexShader.replace("uniform float uLineWidth;","attribute float thickness;"),shader.vertexShader=shader.vertexShader.replace("uLineWidth","thickness"),shader.fragmentShader=shader.fragmentShader.replace("uniform float uLineWidth;",""),shader.vertexShader=shader.vertexShader.replace("uniform vec3 uColor;","attribute vec3 aColor;"),shader.vertexShader=shader.vertexShader.replace("vColor = uColor;","vColor = aColor;"),shader.vertexShader=shader.vertexShader.replace("uniform float uOpacity;","attribute float aOpacity;"),shader.vertexShader=shader.vertexShader.replace("vOpacity = uOpacity;","vOpacity = aOpacity;"),_vs=shader.vertexShader,_fs=shader.fragmentShader,_shader!==shader&&_shader.copyUniformsTo(shader,!0)}this.geometry=_geometry,function initShader(){(_shader=_this.initClass(Shader,"Line",{uBaseWidth:Line3D.BASE_WIDTH,uLineCount:{type:"f",value:_lineCount||1,ignoreUIL:!0},transparent:!0})).vertexShader?(Line3D.vertexShader=_shader.vertexShader,Line3D.vsName=_shader.vsName,Line3D.fragmentShader=_shader.fragmentShader,Line3D.fsName=_shader.fsName):(_shader.vertexShader=Line3D.vertexShader,_shader.fragmentShader=Line3D.fragmentShader),_shader.vertexShader&&_shader.vertexShader.length||(_shader.vertexShader=Shaders.getShader("Line.vs")),_shader.fragmentShader&&_shader.fragmentShader.length||(_shader.fragmentShader=Shaders.getShader("Line.fs")),_this.shader=_shader,updateShader(_shader)}(),function createMesh(){(_mesh=new Mesh(_geometry,_shader)).frustumCulled=!1,_this.add(_mesh),_this.mesh=_mesh}(),Hydra.LOCAL&&function initHotReload(){_this.events.sub(ShaderUIL.SHADER_UPDATE,({shader:shader})=>{let updateCustom=!1;if(shader.includes(Line3D.vsName)){let newBaseShader=new Shader(Line3D.vsName,Line3D.fsName);if(newBaseShader.vertexShader&&(Line3D.vertexShader=newBaseShader.vertexShader,Line3D.fragmentShader=newBaseShader.fragmentShader),updateShader(newBaseShader),Shader.renderer.hotReloadClearProgram(newBaseShader.customCompile),_shader.vsName===newBaseShader.vsName)return newBaseShader.upload(_mesh,_geometry),_shader._gl&&(_shader._gl=newBaseShader._gl),_shader._gpu&&(_shader._gpu=newBaseShader._gpu),void(_shader._metal&&(_shader._metal=newBaseShader._metal));updateCustom=!0}if(shader.includes(_shader.vsName)||updateCustom){let newShader=new Shader(_shader.vsName,_shader.fsName,_shader.params);_this.useShader(newShader),Shader.renderer.hotReloadClearProgram(_shader.customCompile)}})}(),this.useShader=function(shader){_shader.vertexShader=_vs,_shader.fragmentShader=_fs,(_shader=Line3D.mergeShaders(shader,_shader)).customCompile=`${_shader.customCompile}|MergedLine`,_this.shader=_shader,shader.uniforms.uBaseWidth.ignoreUIL=shader.uniforms.uLineCount.ignoreUIL=!0,shader.transparent=!0,_mesh&&(_mesh.shader=_shader)},this.onDestroy=function(){_this.events.fire(MergedLine.DESTROY),_mesh.destroy(),_this.group&&_this.group.parent&&_this.group.parent.remove(_this.group),_this._onDestroy&&_this._onDestroy()},this.clone=function(){return new MergedLine(_geometry,_fs)},this.set("widthMultiplier",v=>{_shader.set("uBaseWidth",1.8*v)}),this.set("color",hex=>{_shader.uniforms.uColor.value.set(hex)})},_=>{MergedLine.DESTROY="merged_line_destroy"}),Class(function MergedLineGroup(){Inherit(this,Object3D);const _this=this;this.lines=[],this.add=function(line){line.freezeMatrix(),line.mergedGroup=this,this.lines.push(line),this.group.add(line.group)},this.onDestroy=function(){_this.events.fire(MergedLine.DESTROY),this.lines.forEach(line=>line.destroy()),_this.group.parent.remove(_this.group),_this._onDestroy&&_this._onDestroy()}}),Class(function LineBuilder(){const _this=this;var _cache={},_taperFunctions,_color;function merge(geom,line){geom.attributes.position?mergeAttributes(geom,line):copyAttributes(geom,line)}function copyAttributes(geom,line){for(let key in line.attributes)geom.attributes[key]=line.attributes[key];geom.index=line.index}function mergeAttributes(geom,line){for(let key in line.attributes)geom.attributes[key]=new GeometryAttribute(Float32ArrayConcat(geom.attributes[key].array,line.attributes[key].array),geom.attributes[key].itemSize);let indexArray=Array.prototype.slice.call(geom.index),startIndex=indexArray[indexArray.length-1]+1;for(let i=0;i<line.index.length;i++)indexArray.push(startIndex+line.index[i]);geom.index=new(Geometry.arrayNeedsUint32(indexArray)?Uint32Array:Uint16Array)(indexArray)}function Float32ArrayConcat(first,second){var firstLength=first.length,result=new Float32Array(firstLength+second.length);return result.set(first),result.set(second,firstLength),result}function geomToObj(geom){let obj={},buffers=[];for(let key in geom.attributes)obj[key]=geom.attributes[key].array,buffers.push(obj[key].buffer);return obj.index=geom.index,buffers.push(obj.index.buffer),{obj:obj,buffers:buffers}}function createExtraAttrib(geom,key,value){let len=geom.attributes.position.count;if("number"==typeof value){let array=new Float32Array(len);for(let i=0;i<array.length;i++)array[i]=value;geom.addAttribute(key,new GeometryAttribute(array,1))}else{let array=new Float32Array(len*value.length);for(let i=0;i<len;i++)for(let j=0;j<value.length;j++)array[i*value.length+j]=value[j];geom.addAttribute(key,new GeometryAttribute(array,value.length))}}function parseData(data,e){"string"==typeof data&&(data=JSON.parse(JSON.parse(data)));let mergedGeom=new Geometry;return data.forEach(d=>{let lineGeom=new LineGeometry(d.geometry.index,d.geometry.points,d.geometry.pressure);createExtraAttrib(lineGeom.geometry,"thickness",d.meta.width),d.meta.color&&(_color||(_color=new Color),_color.set(d.meta.color),createExtraAttrib(lineGeom.geometry,"aColor",_color.toArray())),d.meta.opacity&&createExtraAttrib(lineGeom.geometry,"aOpacity",d.meta.opacity),merge(mergedGeom,lineGeom.geometry,d.meta)}),geomToObj(mergedGeom)}function parseGroups(data,e,callback,promise){let groups=[],cached=[];for(let i=0;i<data.length;i++){let meta=data[i].meta,key=`${meta.fs||"fs"}_${meta.vs||"vs"}`;cached[key]||(cached[key]=!0,groups.push({fs:meta.fs||"fs",vs:meta.vs||"vs"}))}void 0===callback?promise.resolve(groups):resolve(groups,callback)}this.parse=function(e,callback){window.taper&&(Line3D.taperFunction=taper);let promise=Promise.create();return get(e.file).then(data=>{if(data.data){let meta=data;data=data.data,delete meta.data,window.emit?emit("meta",meta):_this.onMeta&&_this.onMeta(meta)}_cache[e.file]=data,parseGroups(data,e,callback,promise)}),promise},this.createLine=function(e,callback){let data=e.data||_cache[e.file],selected=[];for(let i=0;i<data.length;i++){let meta=data[i].meta;meta.fs!=e.group.fs||meta.vs&&meta.vs!=e.group.vs||selected.push(data[i])}let meta=selected[0].meta;if(_taperFunctions){let key=meta.vs;_taperFunctions[key]&&(Line3D.taperFunction=_taperFunctions[key])}let{obj:obj,buffers:buffers}=parseData(selected,e);if(obj.meta=meta,obj.lineCount=selected.length,void 0===callback)return Promise.resolve(obj);resolve(obj,callback,buffers)},this.parseFromData=function(e,callback){window.taper&&(Line3D.taperFunction=taper);let data=e.data,promise=Promise.create();return parseGroups(data,e,callback,promise),promise},this.release=function(e){delete _cache[e.file]},this.uploadTaperFunctions=function(e){_taperFunctions=e.fns;for(let key in _taperFunctions)eval(`_taperFunctions['${key}'] = ${_taperFunctions[key]}`)},this.changeTaperFunction=function(e){Line3D.taperFunction=_taperFunctions[e.fn]},this.loadFromSplines=function({url:url,subdivisions:subdivisions,width:width,color:color,type:type},id){!async function(){let mergedGeom=new Geometry,array=await get(url),curves=array.curves.map(array=>new Curve(array,type)),total=0,maxLength=0;array.curves.forEach(c=>{let length;length=c.metadata?c.points.length:c.length,maxLength=Math.max(length,maxLength)}),curves.forEach((curve,i)=>{let length,points=[];length=array.curves[i].metadata?array.curves[i].points.length:array.curves[i].length;let count=Math.max(10,Math.round(subdivisions*(length/maxLength)));for(let i=0;i<=count;i++){let pct=i/count,pos=curve.getPoint(pct);points.push(pos.x,pos.y,pos.z)}let line=new Line3D({width:width,color:color,index:total++,points:points});createExtraAttrib(line.geometry,"thickness",width),createExtraAttrib(line.geometry,"aColor",new Color(color||"#ffffff").toArray()),createExtraAttrib(line.geometry,"aOpacity",1),merge(mergedGeom,line.geometry)});let{obj:obj,buffers:buffers}=geomToObj(mergedGeom);obj.lineCount=total,resolve(obj,id,buffers)}()},this.fromCurve=function({curvePoints:curvePoints,subdivisions:subdivisions,width:width,color:color,type:type},id){let curve=new Curve(curvePoints.map(p=>new Vector3(p.x,p.y,p.z)),type),points=[];for(let i=0;i<=subdivisions;i++){let pct=i/subdivisions,pos=curve.getPoint(pct);points.push(pos.x,pos.y,pos.z)}let line=new Line3D({width:width,color:color,points:points});createExtraAttrib(line.geometry,"thickness",width),createExtraAttrib(line.geometry,"aColor",new Color(color||"#ffffff").toArray()),createExtraAttrib(line.geometry,"aOpacity",1);let{obj:obj,buffers:buffers}=geomToObj(line.geometry);resolve(obj,id,buffers)}}),Class(function LineUtil(){Inherit(this,Component);const _this=this;var _builder,_meta;this.useThread=!0,this.precision=3;var _processing=!1,_queue=[];function createGeometry(attributes){let geom=new Geometry;for(let key in attributes){if("index"==key||!attributes[key].length)continue;let comp=attributes[key].length/attributes.width.length;geom.addAttribute(key,new GeometryAttribute(attributes[key],comp))}return geom.setIndex(new GeometryAttribute(new(Geometry.arrayNeedsUint32(attributes.index)?Uint32Array:Uint16Array)(attributes.index),1)),geom}function initBuilder(){_this.useThread?(_builder=_this.initClass(Thread,LineBuilder),Utils3D.loadEngineOnThread(_builder),_builder.importClass(LineGeometry,Line3D,Object3D),window.Curve&&Curve.loadOnThread(_builder),_builder.on("meta",receiveMeta),Line3D.taperFunction&&_builder.loadFunction(Line.taperFunction)):(_builder=_this.initClass(LineBuilder)).onMeta=receiveMeta}function trim(value,precision){let p=Math.pow(10,precision);return Math.round(value*p)/p}function build(groups,file,data){let promise=Promise.create(),promises=[],group=null;return groups.forEach(group=>{promises.push(_builder.createLine({file:file,data:data,group:group}))}),Promise.all(promises).then(array=>{array.forEach(attributes=>{let merged=new MergedLine(createGeometry(attributes),attributes.lineCount);merged.meta=attributes.meta,merged.lineCount=attributes.lineCount,1==array.length?promise.resolve(merged):(group||(group=new MergedLineGroup),group.add(merged))}),promise.resolve(group)}),promise}async function runQueue(){let data,obj=_queue.shift();obj&&(_processing=!0,data=obj.file?await function load(file){let promise=Promise.create();_builder||initBuilder();return file=Thread.absolutePath(file),_builder.parse({file:file}).then(groups=>{build(groups,file,null).then(merged=>{merged.fileMeta=_meta,promise.resolve(merged),_builder.release({file:file}),_meta=null})}),promise}(obj.file):await function loadFromData(data){_builder||initBuilder();let promise=Promise.create();return _builder.parseFromData({data:data}).then(groups=>{build(groups,null,data).then(merged=>{promise.resolve(merged)})}),promise}(obj.data),obj.promise.resolve(data),_processing=!1,runQueue())}function receiveMeta(e){_meta=e}this.load=function(file){let promise=Promise.create();return _queue.push({file:file,promise:promise}),_processing||runQueue(),promise},this.loadFromData=function(data){let promise=Promise.create();return _queue.push({data:data,promise:promise}),_processing||runQueue(),promise},this.outputFromArray=function(array){let output=[];return array.forEach(l=>{let data=l.data;for(let key in data.geometry)Array.isArray(data.geometry[key])&&data.geometry[key].forEach((v,i)=>{data.geometry[key][i]=trim(v,_this.precision)});output.push(data)}),output},this.trim=trim,this.uploadTaperFunctions=function(fn){if(!_this.useThread)return;_builder||initBuilder();let upload={fns:{}};for(let key in fn){let code=fn[key].toString();upload.fns[key]=code}_builder.uploadTaperFunctions(upload)},this.changeTaperFunction=function(fn){_builder.changeTaperFunction({fn:fn})},this.loadFromSplines=async function(url,subdivisions,color,width,type){_builder||initBuilder();let data=await _builder.loadFromSplines({url:Thread.absolutePath(url),subdivisions:subdivisions,width:width,color:color,type:type});return new MergedLine(createGeometry(data),data.lineCount)},this.fromCurve=async function(curve,config){_builder||initBuilder(),config.curvePoints=curve.points;let data=await _builder.fromCurve(config);return new MergedLine(createGeometry(data),data.lineCount)}},"static"),Class(function MixpanelAnalytics(){const DEBUG=Utils.query("debug"),CONFIG={token:"e6e4a06eaa23bf8d70162ed513d69033",debug:!0===DEBUG,track_pageview:!0,persistence:"cookies",cross_subdomain_cookie:!0,secure_cookie:!0,ip:!0,ignore_dnt:!1,record_sessions_percent:5,record_heatmap_data:!0,loaded:function(){!0===DEBUG&&console.log("%cMixpanel loaded with Session Replay and Heatmaps enabled","color: #7856ff; font-weight: bold;")}};let isInitialized=!1;!async function(){if(window.mixpanel&&!isInitialized)try{window.mixpanel.init(CONFIG.token,CONFIG),isInitialized=!0,!0===DEBUG&&console.log("%cMixpanelAnalytics ready","color: #7856ff; font-weight: bold;")}catch(error){!0===DEBUG&&console.error("%cMixpanel init failed:","color: #7856ff; font-weight: bold;",error)}else window.mixpanel||!0!==DEBUG||console.warn("%cMixpanel script not loaded","color: #7856ff; font-weight: bold;")}();const isReady=()=>!!window.mixpanel||(!0===DEBUG&&console.warn("%cMixpanel not available","color: #7856ff; font-weight: bold;"),!1),safeExecute=(fn,operation,...args)=>{if(isReady())try{const result=fn(...args);return!0===DEBUG&&console.log(`%cMixpanel: ${operation}`,"color: #7856ff; font-weight: bold;"),result}catch(error){!0===DEBUG&&console.error(`%cMixpanel: ${operation} failed:`,"color: #7856ff; font-weight: bold;",error)}};this.identify=function(distinctId,properties){safeExecute(()=>{window.mixpanel.identify(distinctId),properties&&window.mixpanel.people.set(properties)},`identify ${distinctId}`,distinctId,properties)},this.alias=function(alias,distinctId){safeExecute(()=>{window.mixpanel.alias(alias,distinctId)},`alias ${alias} to ${distinctId}`,alias,distinctId)},this.setUserProperties=function(properties){safeExecute(()=>{window.mixpanel.people.set(properties)},"set user properties",properties)},this.incrementUserProperty=function(property,value=1){safeExecute(()=>{window.mixpanel.people.increment(property,value)},`increment ${property} by ${value}`,property,value)},this.track=function(eventName,properties){safeExecute(()=>{properties?window.mixpanel.track(eventName,properties):window.mixpanel.track(eventName)},`track ${eventName}`,eventName,properties)},this.trackWithGroups=function(eventName,properties,groups){safeExecute(()=>{window.mixpanel.track_with_groups(eventName,properties,groups)},`track ${eventName} with groups`,eventName,properties,groups)},this.setSuperProperties=function(properties){safeExecute(()=>{window.mixpanel.register(properties)},"set super properties",properties)},this.unsetSuperProperties=function(properties){safeExecute(()=>{Array.isArray(properties)?properties.forEach(prop=>window.mixpanel.unregister(prop)):window.mixpanel.unregister(properties)},"unset super properties",properties)},this.setGroupProperties=function(groupKey,groupId,properties){safeExecute(()=>{window.mixpanel.get_group(groupKey,groupId).set(properties)},`set group properties ${groupKey}:${groupId}`,groupKey,groupId,properties)},this.addToGroup=function(groupKey,groupId){safeExecute(()=>{window.mixpanel.set_group(groupKey,groupId)},`add to group ${groupKey}:${groupId}`,groupKey,groupId)},this.removeFromGroup=function(groupKey,groupId){safeExecute(()=>{window.mixpanel.remove_group(groupKey,groupId)},`remove from group ${groupKey}:${groupId}`,groupKey,groupId)},this.reset=function(){safeExecute(()=>{window.mixpanel.reset()},"reset user data")},this.optOut=function(){safeExecute(()=>{window.mixpanel.opt_out_tracking()},"opt out")},this.optIn=function(){safeExecute(()=>{window.mixpanel.opt_in_tracking()},"opt in")},this.hasOptedOut=function(){if(!isReady())return!1;try{return window.mixpanel.has_opted_out_tracking()}catch(error){return!0===DEBUG&&console.error("%cMixpanel: opt-out check failed:","color: #7856ff; font-weight: bold;",error),!1}},this.getDistinctId=function(){if(!isReady())return null;try{return window.mixpanel.get_distinct_id()}catch(error){return!0===DEBUG&&console.error("%cMixpanel: get ID failed:","color: #7856ff; font-weight: bold;",error),null}}},"static"),Class(function LayeredMVShader(_mesh,_shader,_group,_input){Inherit(this,Component);function getTexture(path){const texture=Utils3D.getRepeatTexture(path);return texture.minFilter=texture.magFilter=Texture.LINEAR,texture}_shader.addUniforms({tMap:{value:null,getTexture:getTexture},tMapSpecular:{value:null,getTexture:getTexture},tMotion:{value:null,getTexture:getTexture},uProgress:{value:0},uColumns:{value:4},uRows:{value:4},uColumnsSpecular:{value:16},uRowsSpecular:{value:16},uDisplacementStrength:{value:.7}})}),Class(function MVShader(_mesh,_shader,_group,_input){Inherit(this,Component);function getTexture(path){const texture=Utils3D.getRepeatTexture(path);return texture.minFilter=texture.magFilter=Texture.LINEAR,texture}!function(){_shader.addUniforms({tMap:{value:null,getTexture:getTexture},tMotion:{value:null,getTexture:getTexture},uProgress:{value:0},uColumns:{value:4},uRows:{value:4},uDisplacementStrength:{value:.7}});const customDefine=_input.get("wildcard");customDefine&&(_shader.customCompile=`${_shader.vsName}|${_shader.fsName}${customDefine}`,_shader.defines=_shader.defines||[],_shader.defines.push(customDefine.toUpperCase()),_shader.restoreFS=_shader.restoreVS=null,_shader.resetProgram())}()}),Class(function MotionVector(_mesh,_shader,_input,_uilGroup){Inherit(this,Component);const _this=this;var _lightTarget=new Vector2,_lastAlignedTarget=0;_shader.addUniforms({tColor:{value:null},tMotionVectors:{value:null},uMotionStrength:{value:1.5},uMotionConfidenceThreshold:{value:1},uFrames:{value:23},uPlayhead:{value:0,ignoreUIL:!0}}),_mesh.motionVector=_this,this.setPlayhead=function(value){_shader.set("uPlayhead",value)},this.alignToNextKeyframe=function(currentValue,direction,alignThreshold=.05){if(Math.abs(currentValue-_lastAlignedTarget)<=alignThreshold)return currentValue;const numFrames=_shader.uniforms.uFrames.value,frameSize=1/numFrames;direction=Math.sign(direction);let newValue=(Math.floor(currentValue*numFrames)+direction+numFrames)%numFrames*frameSize;return newValue=Math.max(0,Math.min(1,newValue)),_lastAlignedTarget=newValue,newValue},this.loop=function(durationInSeconds=1){let lastTime=Render.TIME;_this.startRender(_=>{const currentTime=Render.TIME,deltaTime=(currentTime-lastTime)/2e3;lastTime=currentTime;let currentPlayhead=_shader.uniforms.uPlayhead.value;currentPlayhead+=deltaTime/durationInSeconds,currentPlayhead>=1?currentPlayhead-=Math.floor(currentPlayhead):currentPlayhead<0&&(currentPlayhead+=Math.ceil(Math.abs(currentPlayhead))),_shader.set("uPlayhead",currentPlayhead)})},this.interactiveFBRLight=function(){_this.startRender(_=>{_lightTarget.set(Mouse.tilt.x,Mouse.tilt.y),_shader.uniforms.uLight.value.x=Math.lerp(_lightTarget.x,_shader.uniforms.uLight.value.x,.07),_shader.uniforms.uLight.value.y=Math.lerp(_lightTarget.y,_shader.uniforms.uLight.value.y,.07)})}}),Class(function MouseFluid(_params={active:!0}){Inherit(this,Object3D);const _this=this;var _config,_fluid,_custom;this.scale=1;var _scale=1,_last=new Vector2,_mouse=new Vector2,_white=new Color("#ffffff");function loop(){_scale+=(_this.scale-_scale)*Math.framerateNormalizeLerpAlpha(.05),_custom||_mouse.copy(Mouse);let len=_mouse.distanceTo(_last),size=_this.scaleBasedOnVelocity?Math.range(len,0,5,0,60,!0):25;size*=.8;let delta=Math.range(len,0,15,0,10,!0);len>.01&&_fluid.drawInput(_mouse.x,_mouse.y,(_mouse.x-_last.x)*delta,(_mouse.y-_last.y)*delta,_white,size*_scale),_last.copy(_mouse)}this.scaleBasedOnVelocity=!0,async function(){let layout=_this.initClass(SceneLayout,"mousefluid");(_fluid=await layout.getLayer("fluid")).forcePersist=!0,function initConfig(){(_config=InputUIL.create(_fluid.uilInput.prefix+"mousefluid",_fluid.uilGroup)).setLabel("MouseFluid Config"),_config.add("scale",1),_config.onUpdate=key=>{if("scale"===key)_this.scale=_config.getNumber("scale")},_config.onUpdate()}(),_this.isPlayground()&&_fluid.initMesh(),_this.fluid=_fluid,_params.active?_this.startRender(loop,RenderManager.AFTER_LOOPS):_fluid.visible=!1}(),this.applyTo=async function(shader){await _this.wait("fluid"),shader.uniforms.tFluid=_fluid.fbos.velocity.uniform,shader.uniforms.tFluidMask={value:_fluid}},this.useCustomMouse=function(){_custom=!0},this.getFluid=async function(){return await _this.wait("fluid"),_this.fluid},this.get("mouse",_=>_mouse)},"singleton"),Class(function Noise(){Inherit(this,Component);var v2=new Vector2,v3=new Vector3;this.cnoise3d=function(vec){let v=v3.copy(vec),t=.3*v.z;v.y*=.8;let noise=0,s=.5;return noise+=.3*(Math.sin(.9*v.x/s+10*t)+Math.sin(2.4*v.x/s+15*t)+Math.sin(-3.5*v.x/s+4*t)+Math.sin(-2.5*v.x/s+7.1*t)),noise+=.3*(Math.sin(-.3*v.y/s+18*t)+Math.sin(1.6*v.y/s+18*t)+Math.sin(2.6*v.y/s+8*t)+Math.sin(-2.6*v.y/s+4.5*t)),noise},this.cnoise2d=function(vec){let v=v2.copy(vec),t=.3*v.x;v.y*=.8;let noise=0,s=.5;return noise+=.3*(Math.sin(.9*v.x/s+10*t)+Math.sin(2.4*v.x/s+15*t)+Math.sin(-3.5*v.x/s+4*t)+Math.sin(-2.5*v.x/s+7.1*t)),noise+=.3*(Math.sin(-.3*v.y/s+18*t)+Math.sin(1.6*v.y/s+18*t)+Math.sin(2.6*v.y/s+8*t)+Math.sin(-2.6*v.y/s+4.5*t)),noise}},"static"),Class(function OrbitCamera($element){Inherit(this,BaseCamera);var _root,_wrap1,_wrap2,_rotation,_gaze,_zoom,_this=this,_camera=_this.camera,_zDistance=4;function loop(){_camera.position.z=_this.zDistance+_this.zMove,_this.group.updateMatrixWorld()}this.zOrigin=_zDistance,this.$element=$element,this.maxZoom=2,this.minZoom=5,this.lockZoom=!1,this.screenRotation=180,this.xLimit=.4,this.xMax=30,this.xMin=0,this.zMove=0,this.offset=new Vector3(0,0,0),this.velocityZoom=1,this.set("zDistance",z=>{_zDistance=z,_this.zOrigin=z,_zoom&&(_zoom.z=z)}),this.get("zDistance",_=>_zDistance),function initBehaviors(){_this.group.remove(_camera),_root=new Group,_wrap1=new Group,_wrap2=new Group,_root.add(_wrap1),_wrap1.add(_wrap2),_wrap2.add(_camera),_this.group.add(_root),_rotation=_this.initClass(OrbitCameraRotation,_root,_wrap1),_zoom=_this.initClass(OrbitCameraZoom,_this),_gaze=_this.initClass(OrbitCameraGaze,_camera,_wrap2),_this.rotation=_rotation,_this.gaze=_gaze,_camera.position.z=_zDistance}(),_this.startRender(loop,RenderManager.BEFORE_RENDER),this.center=function(lat,lng,snap){var y=-lng*Math.PI/180-Math.PI+Math.radians(90),x=-lat*Math.PI/180;_rotation.center(x,-y,snap)},_this.setOffset=function(offset){_this.offset=offset,_wrap1.position.set(..._this.offset)},_this.get("zoom",()=>_zoom),_this.set("zoom",zoom=>{_zoom=zoom})}),Class(function OrbitCameraGaze(_camera){Inherit(this,Component);var _this=this,_move=new Vector3;function loop(){Device.mobile?Mobile.Accelerometer&&(_move.x=_this.position.x+Math.range(Mobile.Accelerometer.x,-2,2,-1,1,!0)*_this.moveXY.x,_move.y=_this.position.y+Math.range(Mobile.Accelerometer.x,-2,2,-1,1,!0)*_this.moveXY.y):(_move.x=_this.position.x+Stage.width&&Math.range(Mouse.x,0,Stage.width,-1,1,!0)*_this.moveXY.x,_move.y=_this.position.y+Stage.height&&Math.range(Mouse.y,0,Stage.height,-1,1,!0)*_this.moveXY.y),_move.z=_this.position.z,_camera.position.lerp(_move,_this.lerpSpeed)}this.moveXY=new Vector2(4,4),this.position=new Vector3,this.lerpSpeed=.04,this.lookAt=new Vector3,_this.startRender(loop,RenderManager.BEFORE_RENDER)}),Class(function OrbitCameraLayer(_input,_group){Inherit(this,Object3D);const _this=this;var _config;!function(){let orbit=_this.initClass(OrbitCamera);orbit.zDistance=10,orbit.maxZoom=4,orbit.minZoom=10,orbit.lockZoom=!1,orbit.screenRotation=180,orbit.xLimit=.1,orbit.xMax=20,orbit.xMin=0,orbit.gaze.moveXY.set(.5,.5),orbit.offset=new Vector3(0,0,0),_this.orbit=orbit,(_config=InputUIL.create(_input.prefix+"orbit_camera_wrapper",_group)).setLabel("Orbit Config"),_config.addNumber("zDistance",10).addVector("moveXY",[.5,.5]).addNumber("maxZoom",4).addNumber("minZoom",10).addNumber("screenRotation",180).add("xLimit",.1).add("xMax",20).add("xMin",0).addToggle("xSnap").add("velocityZoom",1).add("fov",30).addVector("offset",[0,0,0]),_config.onUpdate=key=>{orbit.zDistance=_config.getNumber("zDistance"),orbit.maxZoom=_config.getNumber("maxZoom"),orbit.minZoom=_config.getNumber("minZoom"),orbit.screenRotation=_config.getNumber("screenRotation"),orbit.xLimit=_config.getNumber("xLimit"),orbit.xMax=_config.getNumber("xMax"),orbit.xMin=_config.getNumber("xMin"),orbit.xSnap=_config.get("xSnap"),orbit.velocityZoom=_config.get("velocityZoom"),orbit.setFOV(_config.getNumber("fov")),orbit.gaze.moveXY.fromArray(_config.get("moveXY")),orbit.setOffset(_config.get("offset"))},_config.onUpdate()}()}),Class(function OrbitCameraRotation(_root,_wrap){Inherit(this,Component);var _input,_camera,_prevent,_moving,_cursor,_this=this,_move=new Vector2,_hold=new Vector3,_target=new Vector3,_rotation=new Vector3,_velocity=new Vector3,_moveTarget=0,_moveAlpha=.07,_keyboardRotationSpeed=3;this.lerp=1;const PROHIBITED_ELEMENTS=["hit","prevent_orbit"];function initInput(){_input=_this.initClass(Interaction,_this.parent.$element||Stage),_this.events.sub(_input,Interaction.START,touchStart),_this.events.sub(_input,Interaction.MOVE,touchMove),_this.events.sub(_input,Interaction.END,touchEnd)}function clampVelocity(){_velocity.x=Math.clamp(_velocity.x,_this.parent.xMax,_this.parent.xMin)}function loop(){_camera||(_camera=_this.parent),_target.lerp(_velocity,.07*_this.lerp),_rotation.lerp(_target,.4*_this.lerp),_root.rotation.y=Math.radians(_rotation.y),_wrap.rotation.x=Math.radians(_rotation.x),_camera.zMove+=(_moveTarget-_camera.zMove)*_moveAlpha,updateCursor()}function touchStart(e){if(_prevent)return;let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));if(!element||!function checkIfProhibited(element){let el=element;for(;el;){if(el.classList)for(let i=0;i<PROHIBITED_ELEMENTS.length;i++)if(el.classList.contains(PROHIBITED_ELEMENTS[i]))return!0;el=el.parentNode}return!1}(element)){if(e.touches&&e.touches.length>1||"hit"==e.target.className)return _moving=!1;_moving=!0,_velocity.y=_target.y,_hold.y=_target.y,_hold.x=_target.x,_moveAlpha=.07}}function touchMove(e){_moving&&!_prevent&&(_target.y=_hold.y+-_input.move.x/Stage.width*_this.parent.screenRotation,_target.x=_hold.x+-_input.move.y/Stage.height*(_this.parent.screenRotation*_this.parent.xLimit),_this.parent.xSnap&&(_target.x>_this.parent.xMax&&(_target.x=_this.parent.xMax),_target.x<_this.parent.xMin&&(_target.x=_this.parent.xMin)),_velocity.y=_target.y,_velocity.x=_target.x,_move.copy(_input.move),_moveTarget=Math.range(Math.abs(_input.velocity.x),0,7,0,.5*_this.parent.zOrigin*_this.parent.velocityZoom,!0))}function touchEnd(e){if(_moving&&!_prevent){var moveX=200*-Math.abs(_input.velocity.x)/Stage.width*_this.parent.screenRotation*Math.sign(_move.x),moveY=200*-Math.abs(_input.velocity.y)/Stage.height*(_this.parent.screenRotation*_this.parent.xLimit)*Math.sign(_move.y);_move&&_move.length()>8&&(_velocity.y=_target.y+Math.clamp(moveX,-360,360),_velocity.x=Math.clamp(_target.x+moveY,_this.parent.xMin||-_this.parent.xMax,_this.parent.xMax)),_moveTarget=0,_moveAlpha=.02,_moving=!1,_move&&(_move.x=0,_move.y=0)}}function onKeyDown(e){37===e.keyCode&&(_velocity.y-=_keyboardRotationSpeed),39===e.keyCode&&(_velocity.y+=_keyboardRotationSpeed),38===e.keyCode&&(_velocity.x-=_keyboardRotationSpeed),40===e.keyCode&&(_velocity.x+=_keyboardRotationSpeed),_velocity.x=Math.clamp(_velocity.x,_this.parent.xMin||-_this.parent.xMax,_this.parent.xMax)}function updateCursor(){let cursor="auto";_moving&&(cursor="grabbing"),(_this._invisible||_prevent)&&(cursor="auto"),cursor!==_cursor&&(_cursor=cursor,Stage.cursor(cursor,_this))}!async function(){defer(initInput),defer(clampVelocity),_this.startRender(loop,RenderManager.BEFORE_RENDER)}(),this.center=function(x,y,snap){let currentX=Math.degrees(_wrap.rotation.x),currentY=Math.degrees(_root.rotation.y),targetX=Math.degrees(x),diffY=(Math.degrees(y)-currentY+180)%360-180;diffY<-180&&(diffY+=360);let diffX=(targetX-currentX+180)%360-180;diffX<-180&&(diffX+=360),_velocity.x=currentX+diffX,_velocity.y=currentY+diffY,snap&&(_target.x=_velocity.x,_target.y=_velocity.y,_rotation.x=_velocity.x,_rotation.y=_velocity.y,_wrap.rotation.x=x,_root.rotation.y=y)},this.toggleKeyboardInteraction=function(bool=!0){_this.flag("keyboardInteraction")!==bool&&(_this.flag("keyboardInteraction",bool),bool?_this.events.sub(Keyboard.DOWN,onKeyDown):_this.events.unsub(Keyboard.DOWN,onKeyDown))},this.onVisible=updateCursor,this.onInvisible=updateCursor,this.set("rotationY",y=>{_velocity.y=_target.y=_rotation.y=y,_root.rotation.y=Math.radians(y)}),this.get("rotationY",()=>Math.degrees(_root.rotation.y)),this.set("disabled",bool=>{_prevent=bool,updateCursor()}),this.set("keyboardRotationSpeed",val=>{_keyboardRotationSpeed=val}),this._bindOnDestroy(_=>{Stage.cursor("auto",_this)})}),Class(function OrbitCameraZoom(_parent){Inherit(this,Component);var _pinch,_hold,_scroll,_this=this;function loop(){_scroll&&(_this.z+=.02*_scroll.delta.y,_this.z=Math.clamp(_this.z,_this.parent.maxZoom,_this.parent.minZoom)),_parent.zDistance+=.07*(_this.z-_parent.zDistance)}function pinch(e){_hold||(_this.z=Math.range(1-e.percent,0,1,_this.parent.maxZoom,_this.parent.minZoom))}this.z=_parent.zDistance,function addListeners(){Device.mobile?((_pinch=_this.initClass(PinchMechanism)).start(),_pinch.max=100,_this.events.sub(_pinch,PinchMechanism.UPDATE,pinch)):_scroll=Scroll.createUnlimited()}(),_this.startRender(loop,RenderManager.BEFORE_RENDER),this.zoomIn=function(z,time=1e3,ease="easeInOutCubic",snap){_hold=_this.z,snap?(_this.z=z,_parent.zDistance=_this.z):tween(_this,{z:z},time,ease)},this.zoomOut=function(time=1e3,ease="easeInOutCubic"){tween(_this,{z:_hold},time,ease,function(){_hold=null})},this.manualLerp=function(t){_this.z=Math.lerp(_this.parent.maxZoom,_this.parent.minZoom,t)}}),Class(function ParticleDistributor(){Inherit(this,Component);const _this=this;function init(){_this.flag("initGenerate")||(_this.flag("initGenerate",!0),Thread.upload(distributeParticles),Thread.upload(generatePointCloud),Thread.upload(generatePointGrid))}function distributeParticles(e,id){let{position:position,count:count,normal:normal,uv:uv,skinIndex:skinIndex,skinWeight:skinWeight,offset:offset,scale:scale,orientation:orientation}=e,vertices=position.length/3,v3=new Vector3,v32=new Vector3,v33=new Vector3,q=new Quaternion,outputPosition=new Float32Array(3*count),outputNormal=normal?new Float32Array(3*count):null,outputUV=uv?new Float32Array(3*count):null,outputSkinIndex=skinIndex?new Float32Array(4*count):null,outputSkinWeight=skinWeight?new Float32Array(4*count):null;for(let i=0;i<count;i++){let j=3*Math.random(0,vertices/3);v3.set(Math.random(0,100),Math.random(0,100),Math.random(0,100));let m=1/(v3.x+v3.y+v3.z);if(v3.set(v3.x*m,v3.y*m,v3.z*m),outputPosition[3*i+0]=position[3*j+0]*v3.x+position[3*j+3]*v3.y+position[3*j+6]*v3.z,outputPosition[3*i+1]=position[3*j+1]*v3.x+position[3*j+4]*v3.y+position[3*j+7]*v3.z,outputPosition[3*i+2]=position[3*j+2]*v3.x+position[3*j+5]*v3.y+position[3*j+8]*v3.z,offset){let randomInstance=Math.random(0,offset.length/3-1);v32.fromArray(outputPosition,3*i),v33.fromArray(scale,3*randomInstance),v32.multiplyScalar(v33),q.fromArray(orientation,4*randomInstance),v32.applyQuaternion(q),v33.fromArray(offset,3*randomInstance),v32.add(v33),v32.toArray(outputPosition,3*i)}if(outputNormal&&(outputNormal[3*i+0]=normal[3*j+0]*v3.x+normal[3*j+3]*v3.y+normal[3*j+6]*v3.z,outputNormal[3*i+1]=normal[3*j+1]*v3.x+normal[3*j+4]*v3.y+normal[3*j+7]*v3.z,outputNormal[3*i+2]=normal[3*j+2]*v3.x+normal[3*j+5]*v3.y+normal[3*j+8]*v3.z),outputUV&&(outputUV[3*i+0]=uv[2*j+0]*v3.x+uv[2*j+2]*v3.y+uv[2*j+4]*v3.z,outputUV[3*i+1]=uv[2*j+1]*v3.x+uv[2*j+3]*v3.y+uv[2*j+5]*v3.z),outputSkinIndex){let skinCluster1={};skinCluster1[skinIndex[4*j+0]]=skinWeight[4*j+0],skinCluster1[skinIndex[4*j+1]]=skinWeight[4*j+1],skinCluster1[skinIndex[4*j+2]]=skinWeight[4*j+2],skinCluster1[skinIndex[4*j+3]]=skinWeight[4*j+3];let skinCluster2={};skinCluster2[skinIndex[4*j+4]]=skinWeight[4*j+4],skinCluster2[skinIndex[4*j+5]]=skinWeight[4*j+5],skinCluster2[skinIndex[4*j+6]]=skinWeight[4*j+6],skinCluster2[skinIndex[4*j+7]]=skinWeight[4*j+7];let skinCluster3={};skinCluster3[skinIndex[4*j+8]]=skinWeight[4*j+8],skinCluster3[skinIndex[4*j+9]]=skinWeight[4*j+9],skinCluster3[skinIndex[4*j+10]]=skinWeight[4*j+10],skinCluster3[skinIndex[4*j+11]]=skinWeight[4*j+11];let indices=[];for(let k=0;k<12;k++){let index=skinIndex[4*j+k];-1===indices.indexOf(index)&&indices.push(index)}let clusters=[];for(let k=0;k<indices.length;k++){let index=indices[k];clusters.push([index,(skinCluster1[index]||0)*v3.x+(skinCluster2[index]||0)*v3.y+(skinCluster3[index]||0)*v3.z])}clusters.sort(function(a,b){return b[1]-a[1]});for(let l=clusters.length-1;l<4;l++)clusters.push([0,0]);let sum=clusters[0][1]+clusters[1][1]+clusters[2][1]+clusters[3][1];outputSkinIndex[4*i+0]=clusters[0][0],outputSkinIndex[4*i+1]=clusters[1][0],outputSkinIndex[4*i+2]=clusters[2][0],outputSkinIndex[4*i+3]=clusters[3][0],outputSkinWeight[4*i+0]=clusters[0][1]*(1/sum),outputSkinWeight[4*i+1]=clusters[1][1]*(1/sum),outputSkinWeight[4*i+2]=clusters[2][1]*(1/sum),outputSkinWeight[4*i+3]=clusters[3][1]*(1/sum)}}let output={},buffer=[];output.position=outputPosition,buffer.push(outputPosition.buffer),outputNormal&&(output.normal=outputNormal,buffer.push(outputNormal.buffer)),outputUV&&(output.uv=outputUV,buffer.push(outputUV.buffer)),outputSkinIndex&&(output.skinIndex=outputSkinIndex,output.skinWeight=outputSkinWeight,buffer.push(outputSkinIndex.buffer),buffer.push(outputSkinWeight.buffer)),resolve(output,id,buffer)}function generatePointCloud({path:path,textureSize:textureSize},id){!async function(){try{let data=await get(path),totalParticles=textureSize*textureSize,positions=new Float32Array(3*totalParticles),colors=new Float32Array(3*totalParticles);for(let i=0;i<totalParticles;i++)positions[3*i+0]=data.data.attributes.positions.array[3*i+0],positions[3*i+1]=data.data.attributes.positions.array[3*i+1],positions[3*i+2]=data.data.attributes.positions.array[3*i+2],colors[3*i+0]=data.data.attributes.colors.array[3*i+0],colors[3*i+1]=data.data.attributes.colors.array[3*i+1],colors[3*i+2]=data.data.attributes.colors.array[3*i+2];data.positions=positions,data.colors=colors,resolve(data,id,[data.positions.buffer,data.colors.buffer])}catch(e){throw console.log(e),`Could not load Point Cloud for ${path}`}}()}function generatePointGrid({path:path,particleCount:particleCount},id){let split=path.split("generateGrid-")[1].split("-"),dir=split[0],scale=Number(split[1]),textureSize=(Number(split[2]),Number(split[split.length-1].split(".")[0])),totalParticles=particleCount,positions=new Float32Array(3*totalParticles),colors=new Float32Array(3*totalParticles);for(let i=0;i<totalParticles;i++){let p0=i/textureSize,y=Math.floor(p0),x=p0-y;y/=textureSize,x=Math.range(x,0,1,-scale/2,scale/2),y=Math.range(y,0,1,-scale/2,scale/2),"xz"==dir?(positions[3*i+0]=x,positions[3*i+1]=0,positions[3*i+2]=y):(positions[3*i+0]=x,positions[3*i+1]=y,positions[3*i+2]=0),colors[3*i+0]=1,colors[3*i+1]=1,colors[3*i+2]=1}resolve({colors:colors,positions:positions},id,[colors.buffer,positions.buffer])}this.generate=async function(geom,count){init();let position=new Float32Array(geom.attributes.position.array);return(await Thread.shared().distributeParticles({position:position,count:count},[position.buffer])).position},this.generateInstanced=async function(geom,count){init();let position=new Float32Array(geom.attributes.position.array),offset=new Float32Array(geom.attributes.offset.array),scale=new Float32Array(geom.attributes.scale.array),orientation=new Float32Array(geom.attributes.orientation.array);return(await Thread.shared().distributeParticles({position:position,offset:offset,scale:scale,orientation:orientation,count:count},[position.buffer,offset.buffer,scale.buffer,orientation.buffer])).position},this.generateAll=async function(geom,count){init();let position=new Float32Array(geom.attributes.position.array),normal=new Float32Array(geom.attributes.normal.array),uv=new Float32Array(geom.attributes.uv.array);return await Thread.shared().distributeParticles({position:position,normal:normal,uv:uv,count:count},[position.buffer,normal.buffer,uv.buffer])},this.generateSkinned=async function(geom,count){init();let position=new Float32Array(geom.attributes.position.array),normal=new Float32Array(geom.attributes.normal.array),uv=new Float32Array(geom.attributes.uv.array),skinIndex=new Float32Array(geom.attributes.skinIndex.array),skinWeight=new Float32Array(geom.attributes.skinWeight.array);return await Thread.shared().distributeParticles({position:position,normal:normal,uv:uv,skinIndex:skinIndex,skinWeight:skinWeight,count:count},[position.buffer,normal.buffer,uv.buffer,skinIndex.buffer,skinWeight.buffer])},this.generatePointCloud=async function(path,textureSize){path.includes("assets/geometry")||(path="assets/geometry/"+path),path.includes(".json")||path.includes(".bin")||(path+=".bin");let data,isBinary=path.includes(".bin");if(path=Assets.getPath(path),init(),isBinary)await GeomThread.loadDracoLib(),data=await Thread.shared().loadDraco({type:"decode",path:Thread.absolutePath(path)});else{let fn=path.includes("generateGrid")?Thread.shared().generatePointGrid:Thread.shared().generatePointCloud;data=await fn({path:Thread.absolutePath(path),textureSize:textureSize})}return{positions:new AntimatterAttribute(data.positions,3),colors:new AntimatterAttribute(data.colors,3)}}},"static"),Class(function Performance(){Inherit(this,Component);const _this=this;var _overrides=Storage.get("performance_override")||{};const PLATFORM_ALLOWED_KEYS=["desktopVRAvailable","enableWorldNukeMSAA","msaaSamples","forceWebGL1","blurFX"];var IGNORED_FUNCTIONS;function save(obj,key,value){_overrides[key]={obj:Utils.getConstructorName(obj),value:value},Storage.set("performance_override",_overrides)}function convert(tier){if(GPU.BLOCKLIST)return"F";switch(tier){case 5:return"A++";case 4:return"A+";case 3:return"A";case 2:return"B";case 1:return"C";case 0:return"D"}}!async function(){if(Utils.query("performance")&&Utils.query("edit")||Utils.query("custom")){await Hydra.ready();for(let key in _overrides){let obj,value,override=_overrides[key];override?.obj?({obj:obj,value:value}=override):(obj="Tests",value=override),window[obj]&&(window[obj][key]=_=>value)}}}(),this.displayResults=async function(){let editing=Utils.query("edit");await GPU.ready(),$(document.documentElement).bg("#000"),__body.bg("#000"),Stage.bg("#000"),Stage.hide();let $results=__body.create("PerformanceResults");__body.css({overflowY:"scroll",background:"#000"}),$results.fontStyle("Arial",16,"#fff").css({marginLeft:50,marginRight:50,"user-select":"auto"}),Mobile.allowNativeScroll(),HydraCSS.style(".PerformanceResults *",{position:"relative","user-select":"auto"});Tests.constructor.toString();let tests="",keys=[],addTest=(obj,key)=>{let result,val=obj[key];if("function"==typeof val){if(!IGNORED_FUNCTIONS){let obj={__afterInitClass:[]};Inherit(obj,Component),"function"==typeof XComponent&&Inherit(obj,XComponent),obj.__afterInitClass.forEach(cb=>cb()),IGNORED_FUNCTIONS=Object.values(obj).filter(val=>"function"==typeof val).map(fn=>fn.toString())}if(!IGNORED_FUNCTIONS.includes(val.toString())){try{result=obj[key]()}catch(e){return}tests+=`<p><b>${key}:</b> `,tests+=editing?"number"==typeof result?`<input class="${key}" value="${result.toString()}" /></p>`:"boolean"==typeof result?`<input class="${key}" type="checkbox" ${result?"checked":""}/></p>`:`<input class="${key}" value="${result}" type="text"></p>`:function sanitizeHTML(str){return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}(result)+"</p>",keys.push({obj:obj,key:key})}}};for(let key in Tests)addTest(Tests,key);if(window.Platform)for(let key in Platform)(key.startsWith("use")||key.startsWith("using")||PLATFORM_ALLOWED_KEYS.includes(key))&&addTest(Platform,key);let compressionExtensions=["compressed_texture","texture_compression"],enabledExtensions=Device.graphics.webgl?.extensions||[],otherExtensions=enabledExtensions.filter(ext=>!compressionExtensions.find(n=>ext.includes(n))).join(", "),dedupe={};compressionExtensions=enabledExtensions.map(ext=>compressionExtensions.map(name=>{let index=ext.indexOf(name);if(!(index<0))return index+=name.length,"_"===ext.charAt(index)&&(index+=1),ext.substring(index)}).find(Boolean)).filter(ext=>!(!ext||dedupe[ext])&&(dedupe[ext]=!0)).join(", ");let html=`<h1>Performance Results</h1>\n                    <button id="copy">Copy to clipboard</button>\n                    <p><b>Time:</b> ${new Date}</p>\n                    <p><b>GPU:</b> ${Device.graphics.webgl?Device.graphics.webgl.gpu:"WEBGL UNAVAILABLE"}</p>\n                    <p><b>WebGL Version:</b> ${Device.graphics.webgl?Device.graphics.webgl.version:"WEBGL UNAVAILABLE"}</p>\n                    ${"ios"==Device.system.os?function getiOSGPUStats(){let{hash:hash,hash3d:hash3d,fallbackTest:fallbackTest,primeTest:primeTest}=require("iOSGPUTest"),hashVal=Global.iOSGPUHASHVAL||hash(),hash3dVal=Global.iOSGPUHASH3D||hash3d(),fallbackVal=Global.iOSGPUFALLBACKTEST||primeTest();return`<p><b>iOS GPU UNMASK:</b> ${hashVal||"X"} | ${hash3dVal||"X"} | ${fallbackVal||"X"} | ${fallbackTest(fallbackVal)||"X"}</p>\n<p><b>Reported GPU:</b>${Device.graphics.gpu?.identifier}</p>`}():""}\n                    ${"safari"!=Device.system.browser||Device.mobile?"":"<b>SAFARI GPU UNMASK:</b> "+Global.MACOSHASHVALUE}\n                    <p><b>GPU Tier:</b> ${Device.mobile?convert(GPU.M_TIER):convert(GPU.TIER)} [${Device.mobile?GPU.M_TIER:GPU.TIER}]</p>\n                    <p><b>Mobile:</b> ${Device.mobile?Object.keys(Device.mobile).filter(key=>Device.mobile[key]):"false"} </p>\n                    <p><b>User Agent:</b> ${Device.agent}</p>\n                    <p><b>OS:</b> ${Device.system.os}</p>${-1!==Device.system.version?`\n                    <p><b>OS Version:</b> ${Device.system.version}`:""}\n                    <p><b>DPR:</b> ${Device.pixelRatio}</p>\n                    <p><b>Screen Size:</b> ${screen.width} x ${screen.height}</p>\n                    <p><b>HZ Multiplier:</b> ${Render.HZ_MULTIPLIER}</p>\n                    <p><b>Stage Size:</b> ${Stage.width} x ${Stage.height}</p>\n                    <p><b>Browser:</b> ${Device.system.browser}</p>\n                    <p><b>Browser Version:</b> ${Device.system.browserVersion}</p>\n                    <p><b>Compressed textures:</b> ${compressionExtensions}</p>\n                    <p><b>WebGL extensions:</b> ${otherExtensions}</p>\n                    <p><b>Media Devices w/ Permissions Granted:</b>${await(navigator?.mediaDevices?.enumerateDevices?.().then(devices=>devices?.filter?.(device=>""!==device.label)?.map(device=>` ${device.label}`)))}</p>\n                    \n                    <h2>Project-Specific Tests</h2>\n                    ${editing?'<button class="resetBtn">Reset All</button>':""}\n                    ${tests}\n        `;$results.html(html);let copy=$(document.getElementById("copy"));if(copy.bind("click",_=>{let text=`${$results.div.innerText.split("\n").slice(2).join("\n").trim()}`;Utils.copyToClipboard(text),copy.text("Results copied!"),clearTimeout(_this.copyTimer),_this.copyTimer=_this.delayedCall(_=>{copy.text("Copy to clipboard")},3e3)}),editing){await defer(),document.querySelector(".resetBtn").onclick=_=>{Storage.set("performance_override",null),location.reload()};for(let{obj:obj,key:key}of keys){let div=document.querySelector(`.${key}`);div&&(div.onchange=_=>{let value=div.value;value=isNaN(value)?div.checked:Number(value),save(obj,key,value)})}}}},"static"),Class(function Proton(_input,_group){Inherit(this,Object3D);const _this=this;var _config,_size,_antimatter,_behaviorInput,_batches;const prefix=this.prefix=`P_${_input.prefix}`;async function initConfig(){(_config=_this.uilConfig=InputUIL.create(prefix+"_config",_group)).setLabel("Config"),_config.addButton("load-values",{label:"Values",actions:[{title:"Load",callback:loadValues},{title:"Save",callback:saveValues}]}).addButton("save",{label:"Configuration",actions:[{title:"Load",callback:loadConfig},{title:"Save",callback:saveConfig}]}).addButton("load-shader",{label:"Shader",actions:[{title:"Load",callback:()=>loadShader()}]}).addButton("load-behavior",{label:"Behavior",actions:[{title:"Load",callback:()=>loadBehavior()}]});_config.addSelect("type",[{label:"Permanent",value:"permanent"},{label:"Lifecycle",value:"lifecycle"}]),window.ProtonCulling&&_config.addToggle("FrustumCulling",!1),_config.addToggle("staticParticles",!1),_this.preventUpdate=_config.get("staticParticles"),_config.addFile("initialPositions",{relative:"assets/geometry"}),window.ProtonPhysics&&_config.addToggle("enablePhysics",!1),_config.add("particleCount",1e3),window.ProtonVolumeShadows&&_config.addToggle("volumeShadows",!1);let output=[{label:"Particles",value:"particles"},{label:"Custom",value:"custom"}];window.ProtonTubes&&output.push({label:"Tubes",value:"tubes"}),window.ProtonMarchingCubes&&output.push({label:"IsoSurface",value:"isosurface"}),_config.addSelect("output",output),_config.add("shader"),_config.get("shader")&&_config.addTextarea("uniforms"),_config.add("class");_config.get("type");try{if(!1===_input.get("visible"))throw"Layer set to invisible";if(_this.particleCount=_size=getSize(),0==_size||isNaN(_size))throw"Size is falsy or 0";initAntimatter()}catch(e){Hydra.LOCAL&&console.warn("Proton skipped",e),_this.disabled=!0}}function loadValues(){const name=prompt("Name of values to be loaded");if(null===name)return;let data=UILStorage.get(`proton_values_${name}`);data||alert(`No values ${name} found`),data=JSON.parse(data);let apply=(shader,obj)=>{for(let key in obj)UILStorage.set(shader.UILPrefix+key,obj[key])};apply(_this.behavior,data.behavior),apply(_this.shader,data.shader),_this.customClass&&_this.customClass.saveValues&&apply(_this.customClass.saveValues(),data.custom),alert("Values imported. Save and refresh.")}function saveValues(){const name=prompt("Name of values to be saved");if(null===name)return;let store=(shader,to)=>{for(let key in shader.uniforms){if(shader.uniforms[key].ignoreUIL)continue;let uilValue=UILStorage.get(shader.UILPrefix+key);void 0!==uilValue&&(to[key]=uilValue)}},output={behavior:{},shader:{}};store(_this.behavior,output.behavior),store(_this.shader,output.shader),_this.customClass&&_this.customClass.saveValues&&(output.custom={},store(_this.customClass.saveValues(),output.custom)),UILStorage.setWrite(`proton_values_${name}`,JSON.stringify(output))}function loadConfig(){const name=prompt("Name of configuration to be loaded");if(null===name)return;let toLoad=UILStorage.get(`proton_config_${name}`);loadBehavior(toLoad),loadShader(toLoad),alert("Loaded. Save and refresh")}function saveConfig(){let name=prompt("Name of configuration to be saved");null!==name&&UILStorage.setWrite(`proton_config_${name}`,prefix)}function loadShader(toLoad){let shouldNotify=!toLoad;if(!toLoad){const name=prompt("Name of shader to be loaded");if(null===name)return;toLoad=UILStorage.get(`proton_config_${name}`)}let copyConfig=InputUIL.create(toLoad+"_config",null);_config.copyFrom(copyConfig,["shader","uniforms"]),(_config.get("uniforms")||"").split("\n").forEach(line=>{if(!line.includes(":"))return;let name=(line=line.replace(/ /g,"")).split(":")[0],shaderName=copyConfig.get("shader"),store=`${shaderName}/${shaderName}/${prefix}/`,lookup=`${shaderName}/${shaderName}/${toLoad}/`,val=UILStorage.get(lookup+name);val?UILStorage.set(store+name,val):(val=UILStorage.get(lookup+"_tx_"+name),val&&UILStorage.set(store+"_tx_"+name,val))}),shouldNotify&&alert("Loaded. Save and refresh")}function loadBehavior(toLoad){let shouldNotify=!toLoad;if(!toLoad){const name=prompt("Name of behavior to be loaded");if(null===name)return;toLoad=UILStorage.get(`proton_config_${name}`)}let copyConfig=InputUIL.create(toLoad+"_config",null);_config.copyFrom(copyConfig,["type","particleCount","output","class"]);let copyBehavior=InputUIL.create(toLoad+"_behavior",null);InputUIL.create(prefix+"_behavior",null).copyFrom(copyBehavior,["uniforms","data","codeCount"]);let data=copyBehavior.get("data")||[],buniformString=copyBehavior.get("uniforms")+"\n";ListUIL.create(prefix+"_code",null).internalAddItems(data.length),data.forEach(postfix=>{let toCode=InputUIL.create(prefix+postfix,null),fromCode=InputUIL.create(toLoad+postfix,null);toCode.copyFrom(fromCode,["name","code","uniforms","preset"]),buniformString+=fromCode.get("uniforms")+"\n"}),buniformString.split("\n").forEach(line=>{if(!line.includes(":"))return;let name=(line=line.replace(/ /g,"")).split(":")[0],lookup="am_ProtonAntimatter_"+toLoad,store="am_ProtonAntimatter_"+prefix,val=UILStorage.get(lookup+name);val&&UILStorage.set(store+name,val)});let className=copyConfig.get("class");className&&(_this.customClass=_this.parent.initClass(window[className],_this,_group,_input),_this.customClass.loadConfig&&_this.customClass.loadConfig(toLoad,prefix)),shouldNotify&&alert("Loaded. Save and refresh")}function getSize(){if(_this.parent.data&&_this.parent.data.particleCount)return"string"==typeof _this.parent.data.particleCount?eval(_this.parent.data.particleCount):_this.parent.data.particleCount;let size=_config.getNumber("particleCount");if(isNaN(size)||0===size)try{size=eval(_config.get("particleCount"))}catch(e){throw"Proton particleCount is not a number or valid test function"}if(isNaN(size))throw"Proton particleCount is falsy!";return _this.particleCount=size,size}async function initCustomClass(){_this.shader.addUniforms({DPR:{value:World.DPR,ignoreUIL:!0}});let className=_config.get("class");className&&(_this.customClass=_this.parent.initClass(window[className],_this,_group,_input))}function parseUniforms(text,predefined){if(!text)return{};let split=text.split("\n"),output={};return split.forEach(line=>{if(!(line=line.replace(/ /g,"")).length||!line.includes(":"))return;let split=line.split(":"),name=split[0],val=split[1];if(val.includes("[")){let array=JSON.parse(val);switch(array.length){case 2:output[name]={value:(new Vector2).fromArray(array)};break;case 3:output[name]={value:(new Vector3).fromArray(array)};break;case 4:output[name]={value:(new Vector4).fromArray(array)};break;default:throw`Unknown uniform type ${line}`}}else"C"==val.charAt(0)?predefined[name]=val.slice(1):"T"===val?output[name]={value:null}:"T3D"===val?output[name]={value:null,isTexture3D:!0}:"OEST"===val?output[name]={value:null,oes:!0}:val.includes(["0x","#"])?output[name]={value:new Color(val)}:output[name]={value:Number(val)}}),output}function getUniformGLSLType(obj){return"number"==typeof obj.value?"float":obj.oes?"samplerExternalOES":null===obj.value?obj.isTexture3D?"sampler3D":"sampler2D":obj.value instanceof Texture?obj.value.isTexture3D?"sampler3D":"sampler2D":obj.value instanceof Vector2?"vec2":obj.value instanceof Vector3||obj.value instanceof Vector3D?"vec3":obj.value instanceof Vector4?"vec4":obj.value instanceof Color?"vec3":void 0}async function initBehavior(behavior){let glsl=[],predefinedUniforms={HZ:"float"},input;_behaviorInput?input=_behaviorInput:(input=InputUIL.create(prefix+"_behavior",_group),input.setLabel("Behavior Uniforms"),input.addTextarea("uniforms"),input.add("data","hidden"),input.add("codeCount","hidden"),_behaviorInput=input);let map={},list=[],count=input.getNumber("codeCount")||0,data=input.get("data")||[],panel=ListUIL.create(prefix+"_code",_group);panel.setLabel("Behavior Code"),panel.onAdd((name,input,index)=>{list[index]||addCode(),input.group.add(list[index].group),list[index].mapId=name,map[name]=list[index],input.setLabel(map[name].get("name")||"Code")}),panel.onRemove(name=>{let postfix=map[name].postfix;list.remove(map[name]),data.remove(postfix),input.setValue("data",JSON.stringify(data))}),panel.onSort(array=>{let arr=[];array.forEach(name=>{arr.push(map[name].postfix)}),data=arr,input.setValue("data",JSON.stringify(data))});let uniforms=parseUniforms(input.get("uniforms")),createCode=postfix=>{let input=InputUIL.create(prefix+postfix,_group,!0);if(input.prefix=prefix+postfix,input.postfix=postfix,input.setLabel("Editor"),input.add("name","hidden"),Proton.ignorePresets&&Proton.ignorePresets.includes(input.get("name")))return;ProtonPresets.bind(input),input.customPresetCallback&&input.customPresetCallback(_this);let code=input.get("code")||"";if(!input.disabled&&code.length){for(uniforms=Utils.mergeObject(uniforms,parseUniforms(input.get("uniforms"),predefinedUniforms));code.includes("#test ");)try{let test=code.split("#test ")[1],name=test.split("\n")[0],glsl=code.split("#test "+name+"\n")[1].split("#endtest")[0];eval(name)||(code=code.replace(glsl,"")),code=code.replace("#test "+name+"\n",""),code=code.replace("#endtest","")}catch(e){throw"Error parsing test :: "+e}glsl.push(code)}list.push(input)};data.forEach(createCode);let addCode=_=>{count++,data.push(`code_${count}`),input.setValue("data",JSON.stringify(data)),input.setValue("codeCount",count),createCode(`code_${count}`)};behavior instanceof AntimatterPass&&(behavior.addInput("tOrigin",_antimatter.vertices),behavior.addInput("tAttribs",_antimatter.attribs),behavior.addUniforms(uniforms));let filledRequire=[],insertUniform=(code,line)=>code.split("//uniforms").join(line+"\n//uniforms"),insertCode=(code,line)=>code.split("//code").join(line+"\n//code"),insertRequire=(code,line)=>{let name=line.split("require(")[1].split(")")[0];return filledRequire.includes(name)?code:(filledRequire.push(name),code.split("//require").join(Shaders.getShader(name)+"\n//require"))},insertGLSL=(code,line)=>{if(line.includes("#require")){let split=line.split("\n");for(let l of split)code=l.includes("#require")?insertRequire(code,l):insertCode(code,l);return code}return insertCode(code,line)};behavior.onCreateShader=code=>{for(let name in uniforms)code=insertUniform(code,`uniform ${getUniformGLSLType(uniforms[name])} ${name};`);for(let name in predefinedUniforms)code=insertUniform(code,`uniform ${predefinedUniforms[name]} ${name};`);for(let str of glsl)code=insertGLSL(code,str);return _this.tubes&&(code=_this.tubes.overrideShader(code)),Renderer.type==Renderer.WEBGL2&&(code=code.replace(/gl_FragColor/g,"FragColor")),code.includes("samplerExternalOES")&&window.AURA&&"android"==Device.system.os&&(code="#version 300 es\n#extension GL_OES_EGL_image_external_essl3 : require\n"+code.replace("#version 300 es","")),code},behavior.uniforms.uMaxCount={value:_this.particleCount,ignoreUIL:!0},ShaderUIL.add(behavior,_group).setLabel("Behavior Shader"),behavior.uniforms.HZ={value:1},_config.get("FrustumCulling")&&_batches.setupPositionTexture(behavior.output.texture),_this.startRender(_=>{behavior.uniforms.HZ.value=Render.HZ_MULTIPLIER},10),ProtonPresets.onCodeEdit=rebuildShader}async function rebuildShader(){let lifecycle="lifecycle"==_config.get("type"),behavior=_this.initClass(AntimatterPass,"ProtonAntimatter"+(lifecycle?"Lifecycle":""),{unique:prefix,customCompile:prefix+Utils.uuid()});await initBehavior(behavior),behavior.initialize(64),behavior.upload(),_this.behavior.shader._gl&&(_this.behavior.shader._gl=behavior.shader._gl),_this.behavior.shader._metal&&(_this.behavior.shader._metal=behavior.shader._metal),_this.behavior.shader._gpu&&(_this.behavior.shader._gpu=behavior.shader._gpu)}function completeShader(shader){let transparent=_input.get("transparent"),depthWrite=_input.get("depthWrite"),depthTest=_input.get("depthTest"),blending=_input.get("blending"),castShadow=_input.get("castShadow"),receiveShadow=_input.get("receiveShadow");"boolean"==typeof depthWrite&&(shader.depthWrite=depthWrite),"boolean"==typeof depthTest&&(shader.depthTest=depthTest),"boolean"==typeof transparent&&(shader.transparent=transparent),"boolean"==typeof castShadow&&(_this.mesh.castShadow=castShadow),"boolean"==typeof receiveShadow&&(shader.receiveShadow=receiveShadow),blending&&(shader.blending=blending),shader.uniforms.tRandom={value:_antimatter.attribs}}function update(){_this.preventUpdate||_antimatter.update()}async function initInitialPositions(){let file=_config.getFilePath("initialPositions");if(!file)return;let isBinary=file.includes(".bin");file.includes("assets/geometry")||(file=`assets/geometry/${file}`),isBinary||file.includes(".json")||(file+=".json");let url=Thread.absolutePath(Assets.getPath(file)),pointData={};if(isBinary){await GeomThread.loadDracoLib();let data=await Thread.shared().loadDraco({type:"decode",path:url});data._type?(pointData.positions=data.offset,pointData.random=data.random):(pointData.positions=data.offset.buffer,pointData.random=data.random.buffer)}else{pointData=await Thread.shared().parseInstancePositions({url:url})}return pointData.positions&&(_this.particleCount=_size=pointData.positions.length/3),pointData}async function initAntimatter(){let lifecycle="lifecycle"==_config.get("type");_config.get("enablePhysics")?(_config.addVector("width",[0,128]),_config.addVector("height",[0,128]),_config.addVector("depth",[0,128])):(_config.addVector("width",[-1,1]),_config.addVector("height",[-1,1]),_config.addVector("depth",[-1,1]));let dimensions={w:_config.get("width")||[-1,1],h:_config.get("height")||[-1,1],d:_config.get("depth")||[-1,1],pot:"tubes"===_config.get("output")||!0===_config.get("volumeShadows")||"isosurface"===_config.get("output")},pointData=null;if(_config.get("FrustumCulling")){let file=_config.getFilePath("initialPositions");if(file=Assets.getPath(file),!file)return;_batches=_this.initClass(ProtonCulling,_input,_group,file),await _batches.ready,pointData={},pointData.positions=new Float32Array(_batches.pointData),_this.particleCount=_size=_batches.pointData.length/3}else pointData=await initInitialPositions();_antimatter=_this.initClass(Antimatter,_size,dimensions,World.RENDERER,pointData),Proton.forceCloneVertices.includes(_config.get("class"))&&(_antimatter.cloneVertices=!0),_this.antimatter=_antimatter,await _antimatter.ready();let output=_config.get("output");"tubes"==output&&(_this.tubes=_this.initClass(ProtonTubes,_this)),"isosurface"==output&&(_this.surface=_this.initClass(ProtonMarchingCubes,_this));let overrideShader,wildcard=_input.get("wildcard");if(wildcard&&wildcard.includes(".behavior")){let layer=await _this.parent.getLayer(wildcard.split(".")[0]);await _this.wait(layer,"behavior"),_this.behavior=layer.behavior}else{let behavior=_this.initClass(AntimatterPass,"ProtonAntimatter"+(lifecycle?"Lifecycle":""),{unique:prefix,customCompile:prefix});_this.behavior=behavior,initBehavior(behavior)}let shaderName=_config.get("shader");if(shaderName)if(shaderName.includes(".shader")){let layer=await _this.parent.getLayer(shaderName.split(".")[0]);await _this.wait(layer,"shader"),overrideShader=layer.shader}else{let uniforms=parseUniforms(_config.get("uniforms"));uniforms.unique=prefix+(_this.onGenerateUniqueShader?_this.onGenerateUniqueShader():""),_antimatter.useShader(shaderName,uniforms)}_antimatter.addPass(_this.behavior),_this.mesh=_antimatter.getMesh(),_this.onCreateMesh&&_this.onCreateMesh(_this.mesh),window[shaderName]&&_this.initClass(window[shaderName],_this.mesh,_antimatter.shader,_input,_group),output&&"particles"!=output||_this.delayedCall(_=>{_config.get("FrustumCulling")||_this.add(_antimatter.mesh)},480),Utils.query("uilOnly")||_this.startRender(update,RenderManager.AFTER_LOOPS),shaderName&&!shaderName.includes(".shader")&&(ShaderUIL.add(_antimatter.shader,_group).setLabel("Shader"),completeShader(_antimatter.shader)),overrideShader&&_antimatter.overrideShader(overrideShader),_this.shader=_antimatter.shader,_this.initialized=!0,lifecycle&&(_this.spawn=_this.initClass(AntimatterSpawn,_this,_group,_input)),initCustomClass(),_config.get("volumeShadows")&&_this.initClass(ProtonVolumeShadows,_this,_group,_input),_config.get("enablePhysics")&&_this.initClass(ProtonPhysics,_this,_group,_input)}async function upload(sync=!0){if(_this.disabled)return;await _this.ready();let output=_config.get("output"),uploadFuncName=sync?"uploadSync":"upload";await _antimatter[uploadFuncName](!output||"particles"===output),_this.spawn&&await _this.spawn.upload(),_this.tubes&&await _this.tubes[uploadFuncName]()}this.uilInput=_input,this.uilGroup=_group,this.prefix=prefix,this.preventUpdate=!1,initConfig(),this.parseUniforms=parseUniforms,this.ready=function(){return this.wait(this,"initialized")},this.applyToInstancedGeometry=function(geometry){geometry.addAttribute("lookup",new GeometryAttribute(_antimatter.getLookupArray(),3,1)),geometry.addAttribute("random",new GeometryAttribute(_antimatter.getRandomArray(),4,1)),geometry.maxInstancedCount=_size},this.applyToShader=function(shader){shader.addUniforms({tPos:_antimatter.getOutput(),tPrevPos:_antimatter.getPrevOutput()})},this.upload=function(){let visible,count=0;return async function(){0===count&&(visible=_this.group.visible,_this.group.visible=!1,count+=1),await upload(!1),count-=1,0===count&&(_this.group.visible=visible)}}(),this.uploadSync=async function(){await upload(!0)},this.stopUpdating=function(){_this.stopRender(update,RenderManager.AFTER_LOOPS)},this.update=update,this.set("renderOrder",async v=>{await _this.ready(),await _antimatter.ready(),_antimatter.mesh.renderOrder=v}),this.get("renderOrder",v=>_antimatter.mesh.renderOrder)},_=>{Proton.forceCloneVertices=[],Proton.ignore=function(name){Proton.ignorePresets||(Proton.ignorePresets=[]),Proton.ignorePresets.push(name)},Thread.upload(function parseInstancePositions({url:url},id){get(url).then(data=>{let result={},buffers=[];if(data?.positions)result.positions=new Float32Array(data.positions),buffers.push(result.positions.buffer);else if(data){let bufferName="buffer",attributes=data;data.data&&data.metadata?.type&&(bufferName="array",attributes=data.data.attributes),result.positions=new Float32Array(attributes.offset[bufferName]),buffers.push(result.positions.buffer)}if(data?.random)result.random=new Float32Array(data.random),buffers.push(result.random.buffer);else if(data){let bufferName="buffer",attributes=data;data.data&&data.metadata?.type&&(bufferName="array",attributes=data.data.attributes),attributes.random&&(result.random=new Float32Array(attributes.random[bufferName]),buffers.push(result.random.buffer))}resolve(result,id,buffers)})})}),Class(function ProtonPresets(){const _this=this,LIST=[{label:"Custom Code",value:"custom"},{label:"Curl Noise",value:"curl"},{label:"Sine Move",value:"sine"},{label:"Plane Shape",value:"planeshape"},{label:"3D Shape",value:"3dshape"},{label:"Point Cloud",value:"pointcloud"},{label:"Force",value:"force"},{label:"Follow",value:"follow"},{label:"Mouse Fluid",value:"fluid"}],CALLBACKS={custom:function customCode(input){input.setValue("name","Custom Code"),input.setLabel("Custom Code")},curl:function curlNoise(input){input.setValue("name","Curl Noise"),input.setLabel("Curl Noise");input.setValue("uniforms","\n        uCurlNoiseScale: 1\n        uCurlTimeScale: 0\n        uCurlNoiseSpeed: 0\n        "),setPresetCodeIfRequired(input,"#require(curl.glsl)\n\nvec3 curl = curlNoise(pos * uCurlNoiseScale*0.1 + (time * uCurlTimeScale * 0.1));\npos += curl * uCurlNoiseSpeed * 0.01 * HZ;","uCurlNoise")},sine:function sineMove(input){input.setValue("name","Sine Move"),input.setLabel("Sine Move");input.setValue("uniforms","\n        uSinSpeed: 1\n        uSinMovement: 0\n        "),setPresetCodeIfRequired(input,"pos = origin;\npos.x += sin(time*uSinSpeed + radians(360.0 * random.x)) * 0.03 * random.z * uSinMovement * HZ;\npos.y += sin(time*uSinSpeed + radians(360.0 * random.y)) * 0.03 * random.w * uSinMovement * HZ;\npos.z += sin(time*uSinSpeed + radians(360.0 * random.w)) * 0.03 * random.x * uSinMovement * HZ;","uSinSpeed")},planeshape:function planeShape(input){input.setValue("name","Plane Shape"),input.setLabel("Plane Shape");input.setValue("uniforms","\n        uTakePlaneShape: 1\n        uPlaneScale: 1\n        tPlaneTexture: Csampler2D\n        "),setPresetCodeIfRequired(input,"vec2 planeLookup = texture2D(tPlaneTexture, uv).xy;\nvec3 plane;\nplane.x = uPlaneScale * 0.5 * range(planeLookup.x, 0.0, 1.0, -1.0, 1.0);\nplane.y = uPlaneScale * 0.5 * -range(planeLookup.y, 0.0, 1.0, -1.0, 1.0);\nif (uTakePlaneShape > 0.5) pos = plane;","uPlaneScale"),input.customPresetCallback=proton=>{proton.behavior.addUniforms({tPlaneTexture:{value:null}})}},"3dshape":function shape3D(input){input.setValue("name","3D Shape"),input.setLabel("3D Shape"),input.add("geometry");let geometry=input.get("geometry");input.setValue("uniforms","\n        tShape3D: Csampler2D\n        "),setPresetCodeIfRequired(input,"vec3 shape3d = texture2D(tShape3D, uv).xyz;","tShape3D"),input.customPresetCallback=proton=>{let create=async g=>{let geom=await GeomThread.loadGeometry(g),distribution=await ParticleDistributor.generate(geom,proton.antimatter.particleCount),attribute=new AntimatterAttribute(distribution,3);proton.behavior.addInput("tShape3D",attribute)};geometry&&create(geometry),proton.set3DShape=create}},pointcloud:function pointCloud(input){input.setValue("name","Point Cloud"),input.setLabel("Point Cloud"),input.add("file");let file=input.get("file");input.setValue("uniforms","\n        tPointCloud: Csampler2D\n        "),setPresetCodeIfRequired(input,"vec3 pointShape = texture2D(tPointCloud, uv).xyz;","tPointCloud"),input.customPresetCallback=proton=>{let create=async filePath=>{let data;"string"==typeof filePath?(filePath+="-"+proton.antimatter.powerOf2,_this.cachePointCloud=_this.cachePointCloud||{},_this.cachePointCloud[filePath]||(_this.cachePointCloud[filePath]=ParticleDistributor.generatePointCloud(filePath,proton.antimatter.textureSize)),data=await _this.cachePointCloud[filePath]):data=filePath,proton.behavior.shader.uniforms.tPointCloud&&(proton.behavior.shader.uniforms.tPointCloud.value.destroy(),proton.shader.uniforms.tPointColor.value.destroy()),proton.behavior.addInput("tPointCloud",data.positions),proton.shader.addUniforms({tPointColor:{value:data.colors}})};file||(file=proton.parent.data?proton.parent.data.pointCloudFile:void 0),file&&create(file),proton.setPointCloud=create}},force:function force(input){input.setValue("name","Force"),input.setLabel("Force");input.setValue("uniforms","\n        uForceDir: [0, 1, 0]\n        uForceScale: 1\n        "),setPresetCodeIfRequired(input,"vec3 force = normalize(uForceDir) * uForceScale * 0.1;\npos += force * HZ;","uForceDir")},follow:function follow(input){input.setValue("name","Follow"),input.setLabel("Follow");input.setValue("uniforms","\n        uFollowPos: [0, 0, 0]\n        uFollowRadius: 2\n        uFollowLerp: 0.7\n        "),setPresetCodeIfRequired(input,"float speed = range(random.x, 0.0, 1.0, 0.5, 1.5);\nvec3 followPos = uFollowPos;\nfollowPos.x += range(random.y, 0.0, 1.0, -1.0, 1.0) * uFollowRadius;\nfollowPos.y += range(random.z, 0.0, 1.0, -1.0, 1.0) * uFollowRadius;\nfollowPos.z += range(random.w, 0.0, 1.0, -1.0, 1.0) * uFollowRadius;\npos += (followPos - pos) * (uFollowLerp*0.1*speed*HZ);","followPos")},fluid:function fluid(input){input.setValue("name","Mouse Fluid"),input.setLabel("Mouse Fluid");input.setValue("uniforms","\n        uProjMatrix: Cmat4\n        uProjNormalMatrix: Cmat4\n        uModelMatrix: Cmat4\n        tFluidMask: Csampler2D\n        tFluid: Csampler2D\n        uMouseStrength: 1\n        "),setPresetCodeIfRequired(input,"#require(glscreenprojection.glsl)\n\nvec3 mpos = vec3(uModelMatrix * vec4(pos, 1.0));\nvec2 screenUV = getProjection(mpos, uProjMatrix);\nvec3 flow = vec3(texture2D(tFluid, screenUV).xy, 0.0);\napplyNormal(flow, uProjNormalMatrix);\npos += flow * 0.0001 * HZ * uMouseStrength * texture2D(tFluidMask, screenUV).r;","glscreenprojection");let findCamera=proton=>{let camera=World.CAMERA,p=proton.group._parent;for(;p;)p instanceof Scene&&p.nuke&&(camera=p.nuke.camera),p=p._parent;return camera};input.customPresetCallback=async proton=>{if(!("MouseFluid"in window))return void alert("'mousefluid' module not found. To use Mouse Fluid preset, import module, load the MouseFluid class, and add a layer named 'fluid' with customCLass FluidLayer.");let camera=findCamera(proton),projection=proton.initClass(GLScreenProjection,camera);projection.start(),proton.projection=projection,Render.start(function camLoop(){if(!proton.group)return void Render.stop(camLoop);let newCamera=findCamera(proton);newCamera!=camera&&(camera=newCamera,projection.camera=camera)},10),proton.wait("behavior").then(_=>{proton.behavior.addUniforms({uProjMatrix:projection.uniforms.projMatrix,uModelMatrix:projection.uniforms.modelMatrix,uProjNormalMatrix:projection.uniforms.normalMatrix}),MouseFluid.instance().applyTo(proton.behavior)})}}};function setPresetCodeIfRequired(input,presetCode,keyShaderComponentString){const editorCode=input.get("code");editorCode&&editorCode.includes(keyShaderComponentString)||input.setValue("code",presetCode)}this.register=function(name,callback){let key=name.replace(/ /g,"").toLowerCase();LIST.push({label:name,value:key}),CALLBACKS[key]=callback},this.bind=function(input){input.add("code","hidden");input.add("uniforms","hidden"),input.addSelect("preset",LIST);let callback=CALLBACKS[input.get("preset")];callback&&callback(input),input.addButton("btn",{actions:[{title:"Edit Code",callback:_=>{let editor=new UILExternalEditor(input.get("name")||"Code",300);editor.setCode(input.get("code"),"c"),editor.onSave=value=>{input.setValue("code",value),_this.onCodeEdit?.()},UIL.add(editor)}}],hideLabel:!0})}},"static"),Class(function ProtonTubes(_proton){Inherit(this,Object3D);const _this=this;var _config,_segments,_textureSize,_count,_shader,_geom;this.padding=1e3,async function(){!function initConfig(){(_config=InputUIL.create("tubes_"+_proton.prefix,_proton.uilGroup)).setLabel("Tubes"),_config.add("segments",5),_config.add("sides",4),_config.add("lerp",.2),_config.add("resetDelta",10),_config.onUpdate=key=>{"lerp"==key&&_proton.behavior.setUniform("uLerp",_config.getNumber("lerp")),"resetDelta"==key&&_proton.behavior.setUniform("uResetDelta",_config.getNumber("resetDelta"))}}(),await async function initBuffers(){let segments=_this.parent.parent.data&&_this.parent.parent.data.tubeSegments?_this.parent.parent.data.tubeSegments:_config.getNumber("segments");_this.padding=2*_segments;let indexBuffer=await _proton.antimatter.createFloatArrayAsync(4,!0),count=indexBuffer.length/4;for(let i=0;i<count;i++)indexBuffer[4*i+0]=i%segments,indexBuffer[4*i+1]=Math.floor(i/segments),indexBuffer[4*i+2]=i%segments==0?1:0,indexBuffer[4*i+3]=1;_textureSize=_proton.antimatter.textureSize,_segments=segments,_count=count/segments;let indices=_this.initClass(AntimatterAttribute,indexBuffer,4);_proton.behavior.addInput("tIndices",indices),_proton.behavior.addUniforms({uLerp:{value:_config.getNumber("lerp"),ignoreUIL:!0},uResetDelta:{value:_config.getNumber("resetDelta"),ignoreUIL:!0},textureSize:{value:_textureSize,ignoreUIL:!0},lineSegments:{value:segments,ignoreUIL:!0}})}(),await _this.wait(_proton.spawn,"lifeOutput"),function initGeometry(){let shape=require("GenerateTube")(_config.getNumber("sides"),_segments-1,!1),geom=new Geometry;geom.addAttribute("cNumber",new GeometryAttribute(new Float32Array(_count),1,1));for(let key in shape.attributes)geom.addAttribute(key,shape.attributes[key]);for(let i=0;i<_count;i++)geom.attributes.cNumber.array[i]=i;_geom=geom}(),function initShader(){let shaderName=_proton.uilConfig.get("shader")||"",modifyShader=!0;const attr={noAttributes:!0,unique:shaderName,thickness:{type:"f",value:1},textureSize:{type:"f",value:_textureSize,ignoreUIL:!0},lineSegments:{type:"f",value:_segments,ignoreUIL:!0},radialSegments:{type:"f",value:_config.getNumber("sides"),ignoreUIL:!0},taper:{type:"f",value:0},tLife:{type:"t",value:_proton.spawn.lifeOutput,ignoreUIL:!0},tRandom:{type:"t",value:_proton.antimatter.random,ignoreUIL:!0}};shaderName.includes("ProtonCustom")?(_shader=_this.initClass(Shader,shaderName,attr),modifyShader=!1):_shader=_this.initClass(shaderName&&shaderName.includes("PBR")?PBRShader:Shader,"ProtonTube",shaderName||"ProtonTube",attr);if(_this.wait(_proton.shader.uniforms,"tLifeData").then(_=>{_shader.addUniforms({tLifeData:_proton.shader.uniforms.tLifeData,tRandom:_proton.shader.uniforms.tRandom})}),_shader.addUniforms(_proton.parseUniforms(_proton.uilConfig.get("uniforms"))),shaderName&&modifyShader){let vs=Shaders.getShader(shaderName+".vs");if(vs&&_shader.vertexShader){if(vs=vs.split("void main() {"),vs[0].includes("extrudeTube")){let extrude=vs[0].split("void extrudeTube() {")[1].split("}")[0];vs[0]=vs[0].replace("void extrudeTube() {"+extrude+"}",""),_shader.vertexShader=_shader.vertexShader.replace("//neutrinovs",extrude)}let params=vs[0].split("\n"),main=vs[1].slice(0,vs[1].lastIndexOf("}")),paramOutput=[];for(let line of params)_shader.vertexShader.includes(line)&&"}"!=line.trim()||paramOutput.push(line);_shader.vertexShader=_shader.vertexShader.replace("//neutrinoparams",paramOutput.join("\n")),_shader.vertexShader=_shader.vertexShader.replace("//neutrinovspost",main)}window[shaderName]&&_this.initClass(window[shaderName],_shader,_shader)}ShaderUIL.add(_shader,_proton.uilGroup).setLabel("Tube Shader"),_proton.applyToShader(_shader),_this.shader=_shader,function completeShader(shader){let transparent=_proton.uilInput.get("transparent"),depthWrite=_proton.uilInput.get("depthWrite"),depthTest=_proton.uilInput.get("depthTest"),blending=_proton.uilInput.get("blending"),castShadow=_proton.uilInput.get("castShadow"),receiveShadow=_proton.uilInput.get("receiveShadow");"boolean"==typeof depthWrite&&(shader.depthWrite=depthWrite);"boolean"==typeof depthTest&&(shader.depthTest=depthTest);"boolean"==typeof transparent&&(shader.transparent=transparent);"boolean"==typeof castShadow&&defer(_=>_this.mesh.castShadow=castShadow);"boolean"==typeof receiveShadow&&(shader.receiveShadow=receiveShadow);blending&&(shader.blending=blending)}(_shader)}(),function initMesh(){let mesh=new Mesh(_geom,_shader);mesh.frustumCulled=!1,_this.add(mesh),_this.mesh=mesh}(),_this.canEmit=!0}(),this.overrideShader=function(code){let uniforms=Shaders.getShader("ProtonTubesUniforms.fs"),main=Shaders.getShader("ProtonTubesMain.fs"),movement=(code=code.replace("//uniforms",uniforms)).split("//abovespawn")[1].split("//code")[0];return main=main.replace("//main",movement),main=main.split("main() {")[1].slice(0,-1),code=code.replace(movement,main)},this.release=function(pos,count=1,radius=0,velocity,color){if(!_this.canEmit)return;let positions=[],velocities=velocity?[]:null,colors=color?[]:null;_proton.spawn.index>_proton.spawn.total-_this.padding&&(_proton.spawn.index=-1);for(let i=0;i<count;i++){let x=pos.x+Math.random(-1,1,4)*radius,y=pos.y+Math.random(-1,1,4)*radius,z=pos.z+Math.random(-1,1,4)*radius;for(let j=0;j<_segments;j++)positions.push(x,y,z),velocities&&velocities.push(velocity.x,velocity.y,velocity.z),colors&&colors.push(color.r,color.g,color.b)}_proton.spawn.emit(positions,velocities,colors)},this.useColor=async function(){await this.ready(),await _proton.spawn.useColor(),_proton.spawn.applyToShader(_shader)},this.ready=async function(){return await _proton.spawn.ready(),_this.wait("canEmit")},this.upload=async function(){await _this.wait("mesh"),await _this.mesh.geometry.uploadBuffersAsync()},this.uploadSync=async function(){await _this.wait("mesh"),await _this.mesh.upload()}}),Class(function RenderManager(){Inherit(this,Component);const _this=this;var _hasGLUI,_hasMetal,_firingEvt,_directRenderCallback,_dpr=null,_stringSchedules=new Map,_objectSchedules=new WeakMap;function getSchedulesMap(evt){return"string"==typeof evt?_stringSchedules:_objectSchedules}function getSchedule(evt){return getSchedulesMap(evt).get(evt)}function fire(evt,data){let array=getSchedule(evt);if(array){let len=array.length;for(let i=0;i<len;i++){let cb=array[i];if(!array.markedForDeletion.has(cb)){_firingEvt=evt;try{data?cb(data):cb(Render.TIME,Render.DELTA)}catch(error){let errorEvt={callback:cb,error:error,preventStopRender:!1};Events.emitter._fireEvent(Render.RENDER_CALLBACK_ERROR,errorEvt),evt.preventStopRender||_this.unschedule(cb,evt)}}}_firingEvt=void 0,array.markedForDeletion.size&&(array.markedForDeletion.forEach((_,cb)=>{array.remove(cb)}),array.markedForDeletion.clear())}}function startFrame(){fire(_this.FRAME_BEGIN)}function resizeHandler(){_this.renderer&&_this.renderer.setSize(Stage.width,Stage.height)}function getDPR(){return window.AURA?Device.pixelRatio:GPU.OVERSIZED?1:GPU.lt(0)?Math.min(1.3,Device.pixelRatio):GPU.lt(1)?Math.min(1.8,Device.pixelRatio):GPU.mobileLT(2)?Math.min(2,Device.pixelRatio):GPU.gt(4)?Math.max(1.5,Device.pixelRatio):Math.max(1.25,Device.pixelRatio)}this.NORMAL="normal",this.MAGIC_WINDOW="magic_window",this.VR=this.WEBVR="webvr",this.AR=this.WEBAR="webar",this.MR="mixed_reality",this.RENDER="RenderManager_render",this.BEFORE_RENDER="RenderManager_before_render",this.POST_RENDER=this.FRAME_END="RenderManager_post_render",this.EYE_RENDER="RenderManager_eye_render",this.BEFORE_OBJECT_EYE_RENDER="RenderManager_before_object_eye_render",this.FRAME_BEGIN="RenderManager_frame_begin",this.AFTER_LOOPS="RenderManager_after_loops",this.NATIVE_FRAMERATE="RenderManager_native_framerate",this.READY="render_gl_ready",this.initialized=Promise.create(),_this.events.sub(Events.RESIZE,resizeHandler),Render.startFrame=startFrame,Hydra.ready(_=>{_hasGLUI=!!window.GLUI,_hasMetal=!!window.Metal,_hasGLUI&&_hasMetal&&(_directRenderCallback=function(render){GLUI.renderDirect(render)})}),this.get("DPR",v=>getDPR()),this.initialize=function(type,params={}){if(_this.camera&&_this.camera.destroy(),_this.renderer&&_this.renderer.destroy(),type!=_this.WEBVR&&type!=_this.WEBAR||(params.xrCompatible=!0,params.alpha=!1,window.Ares&&(params.alpha=!0),window.XRDeviceManager&&XRDeviceManager.antialias&&(params.antialias=!0)),!_this.gl){let camera=new PerspectiveCamera(45,Stage.width/Stage.height,.01,200);_this.gl=function(){"safari"==Device.system.browser&&Device.system.browserVersion<13&&delete params.powerPreference,Utils.query("compat")&&(params.forceWebGL1=!0);let renderer=new Renderer(params);return renderer.setSize(Stage.width,Stage.height),renderer.setPixelRatio(getDPR()),renderer}(),_this.scene=new Scene,_this.nuke=_this.initClass(Nuke,Stage,Object.assign({renderer:_this.gl,scene:_this.scene,camera:camera,dpr:World.DPR},params))}switch(_dpr=_dpr||World.DPR||1,type){case _this.WEBVR:_this.renderer=_this.initClass(VRRenderer,_this.gl,_this.nuke),_this.camera=_this.initClass(VRCamera);break;case _this.WEBAR:_this.renderer=_this.initClass(ARRenderer,_this.gl,_this.nuke),_this.camera=_this.initClass(ARCamera),window.Ares?(document.body.appendChild(_this.gl.domElement),_this.gl.domElement.style.backgroundColor="transparent",document.body.style.backgroundColor="transparent",document.documentElement.style.backgroundColor="transparent",Stage.hide()):Stage.div.style.backgroundColor="transparent";break;case _this.MAGIC_WINDOW:_this.renderer=_this.initClass(MagicWindowRenderer,_this.gl,_this.nuke),_this.camera=_this.initClass(VRCamera);break;case _this.NORMAL:_this.renderer=_this.initClass(RenderManagerRenderer,_this.gl,_this.nuke),_this.camera=_this.initClass(RenderManagerCamera)}_this.type=type,_this.nuke.camera=_this.camera.worldCamera,_this.initialized.resolve()},this.render=function(scene,camera,renderTarget,forceClear){fire(_this.AFTER_LOOPS),_this.type==_this.VR&&fire(World.NUKE),fire(_this.BEFORE_RENDER),_this.renderer.render(scene||_this.scene,_this.nuke.camera,renderTarget,forceClear,_directRenderCallback),_this.events.fire(_this.POST_RENDER),fire(_this.POST_RENDER)},this.schedule=function(callback,slot){let schedules=getSchedulesMap(slot),array=schedules.get(slot);array||(array=[],array.markedForDeletion=new Map,schedules.set(slot,array)),array.indexOf(callback)>=0?array.markedForDeletion.delete(callback):array.push(callback)},this.scheduleOne=function(callback,slot){let result;"function"!=typeof callback&&(slot=callback,result=Promise.create(),callback=result.resolve);let array=getSchedule(slot);if(array){if(array.find(h=>h.scheduleOneCallback===callback))return}let handler=function(){return _this.unschedule(handler,slot),callback.apply(this,arguments)};return handler.scheduleOneCallback=callback,_this.schedule(handler,slot),result},this.unschedule=function(callback,slot){const array=getSchedule(slot);if(!array)return;const index=array.indexOf(callback);index<0||(_firingEvt?array.markedForDeletion.set(callback,!0):array.splice(index,1))},this.setSize=function(width,height){_this.events.unsub(Events.RESIZE,resizeHandler),_this.renderer.setSize(width,height)},this.fire=fire},"static"),Class(function RenderManagerCamera(){Inherit(this,Component);const _this=this;this.worldCamera=window.THREE?new THREE.PerspectiveCamera(30,Stage.width/Stage.height,.1,1e3):new PerspectiveCamera(30,Stage.width/Stage.height,.1,1e3),_this.events.sub(Events.RESIZE,()=>{_this.worldCamera.aspect=Stage.width/Stage.height,_this.worldCamera.updateProjectionMatrix()})}),Class(function RenderManagerRenderer(_renderer,_nuke){Inherit(this,Component);const _this=this;var _evt={};_nuke.onBeforeProcess=_=>{_evt.stage=Stage,_evt.camera=_nuke.camera,_this.events.fire(RenderManager.RENDER,_evt)},this.render=function(scene,camera,_1,_2,directRender){_nuke.camera=camera,_nuke?_nuke.render(directRender):_renderer.render(scene,camera,null,null,directRender)},this.setSize=function(width,height){_renderer.setSize(width,height)}}),Class(function PortableText(){Inherit(this,Component);const _this=this;let _pt,_renderStack=[];const toHTMLOptions={components:{types:{},block:{},marks:{link:linkRenderer,internalLink:linkRenderer,underline:function underlineRenderer({children:children}){return`<span style="text-decoration:underline" class="block-underline">${children}</span>`}}}};function linkRenderer({markType:markType,value:value,children:children}){let link=SanityUtils.resolveLink({...value});const props={className:"block-link",href:link.url};if("internalLink"===markType?(props.className=`${props.className} block-link--internal`,link.path&&"_blank"!==link.target&&(props["data-path"]=link.path),link.hash&&(props["data-hash"]=link.hash),"_blank"===link.target&&(props.className=`${props.className} block-link--internal-target-blank`),Hydra.LOCAL||!Device.system.pushstate?props.href=`#!/${link.path}`:props.href=`/${link.path}`):props.className=`${props.className} block-link--external`,link.target&&(props.target=link.target,props.rel="noopener noreferrer"),_pt.uriLooksSafe(props.href)){return`<a ${Object.keys(props).map(attr=>`${attr}="${_pt.escapeHTML(props[attr])}"`).join(" ")}>${children}</a>`}return children}function toHTML(blocks){return _pt.toHTML(blocks,toHTMLOptions)}function pushRenderState(state={}){return state.afterRender||(state.afterRender=[]),_renderStack.push(state),state}function popRenderState(){return _renderStack.pop()}function getRenderState(key){let state=_renderStack.last();return key?state[key]:state}_pt=(()=>{var S=Object.defineProperty,ct=Object.defineProperties,pt=Object.getOwnPropertyDescriptor,ut=Object.getOwnPropertyDescriptors,mt=Object.getOwnPropertyNames,L=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,E=(t,e,n)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,d=(t,e)=>{for(var n in e||(e={}))H.call(e,n)&&E(t,n,e[n]);if(L)for(var n of L(e))U.call(e,n)&&E(t,n,e[n]);return t},h=(t,e)=>ct(t,ut(e)),g=(t,e)=>{var n={};for(var r in t)H.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&L)for(var r of L(t))e.indexOf(r)<0&&U.call(t,r)&&(n[r]=t[r]);return n},Ot={};((t,e)=>{for(var n in e)S(t,n,{get:e[n],enumerable:!0})})(Ot,{defaultComponents:()=>w,escapeHTML:()=>T,mergeComponents:()=>O,toHTML:()=>st,uriLooksSafe:()=>_});var bt=["http","https","mailto","tel"],dt={"&":"amp","<":"lt",">":"gt",'"':"quot","'":"#x27"};function T(t){return t.replace(/[&<>"']/g,e=>`&${dt[e]};`)}function _(t){let e=(t||"").trim(),n=e.charAt(0);if("#"===n||"/"===n)return!0;let r=e.indexOf(":");if(-1===r)return!0;let i=e.slice(0,r).toLowerCase();if(-1!==bt.indexOf(i))return!0;let o=e.indexOf("?");if(-1!==o&&r>o)return!0;let l=e.indexOf("#");return-1!==l&&r>l}var z={em:({children:t})=>`<em>${t}</em>`,strong:({children:t})=>`<strong>${t}</strong>`,code:({children:t})=>`<code>${t}</code>`,underline:({children:t})=>`<span style="text-decoration:underline">${t}</span>`,"strike-through":({children:t})=>`<del>${t}</del>`,link:({children:t,value:e})=>{let n=(null==e?void 0:e.href)||"";return _(n)?`<a href="${T(n)}">${t}</a>`:t}},P=(t,e)=>`Unknown ${t}, specify a component for it in the \`components.${e}\` option`,C=t=>P(`block type "${t}"`,"types");function J(t){console.warn(t)}var w={types:{},block:{normal:({children:t})=>`<p>${t}</p>`,blockquote:({children:t})=>`<blockquote>${t}</blockquote>`,h1:({children:t})=>`<h1>${t}</h1>`,h2:({children:t})=>`<h2>${t}</h2>`,h3:({children:t})=>`<h3>${t}</h3>`,h4:({children:t})=>`<h4>${t}</h4>`,h5:({children:t})=>`<h5>${t}</h5>`,h6:({children:t})=>`<h6>${t}</h6>`},marks:z,list:{number:({children:t})=>`<ol>${t}</ol>`,bullet:({children:t})=>`<ul>${t}</ul>`},listItem:({children:t})=>`<li>${t}</li>`,hardBreak:()=>"<br/>",unknownType:({value:t,isInline:e})=>{let n=C(t._type);return e?`<span style="display:none">${n}</span>`:`<div style="display:none">${n}</div>`},unknownMark:({markType:t,children:e})=>`<span class="unknown__pt__mark__${t}">${e}</span>`,unknownList:({children:t})=>`<ul>${t}</ul>`,unknownListItem:({children:t})=>`<li>${t}</li>`,unknownBlockStyle:({children:t})=>`<p>${t}</p>`};function O(t,e){let f=e,{block:n,list:r,listItem:i,marks:o,types:l}=f,c=g(f,["block","list","listItem","marks","types"]);return d(h(d({},t),{block:I(t,e,"block"),list:I(t,e,"list"),listItem:I(t,e,"listItem"),marks:I(t,e,"marks"),types:I(t,e,"types")}),c)}function I(t,e,n){let r=e[n],i=t[n];return"function"==typeof r||r&&"function"==typeof i?r:r?d(d({},i),r):i}function et(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function nt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?et(Object(n),!0).forEach(function(r){gt(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function gt(t,e,n){return(e=function Pt(t){var e=function wt(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function B(t){return"span"===t._type&&"text"in t&&"string"==typeof t.text&&(typeof t.marks>"u"||Array.isArray(t.marks)&&t.marks.every(e=>"string"==typeof e))}function M(t){return"string"==typeof t._type&&"@"!==t._type[0]&&(!("markDefs"in t)||!t.markDefs||Array.isArray(t.markDefs)&&t.markDefs.every(e=>"string"==typeof e._key))&&"children"in t&&Array.isArray(t.children)&&t.children.every(e=>"object"==typeof e&&"_type"in e)}function v(t){return M(t)&&"listItem"in t&&"string"==typeof t.listItem&&(typeof t.level>"u"||"number"==typeof t.level)}function j(t){return"@list"===t._type}function N(t){return"@span"===t._type}function A(t){return"@text"===t._type}var rt=["strong","em","code","underline","strike-through"];function It(t,e,n){if(!B(t)||!t.marks)return[];if(!t.marks.length)return[];let r=t.marks.slice(),i={};return r.forEach(o=>{i[o]=1;for(let l=e+1;l<n.length;l++){let c=n[l];if(!(c&&B(c)&&Array.isArray(c.marks)&&-1!==c.marks.indexOf(o)))break;i[o]++}}),r.sort((o,l)=>function Lt(t,e,n){let r=t[e],i=t[n];if(r!==i)return i-r;let o=rt.indexOf(e),l=rt.indexOf(n);return o!==l?o-l:e.localeCompare(n)}(i,o,l))}function St(t,e){return(t.level||1)===e.level&&t.listItem===e.listItem}function $(t,e,n){return{_type:"@list",_key:`${t._key||`${e}`}-parent`,mode:n,level:t.level||1,listItem:t.listItem,children:[t]}}function D(t,e){let n=e.level||1,r=e.listItem||"normal",i="string"==typeof e.listItem;if(j(t)&&(t.level||1)===n&&i&&(t.listItem||"normal")===r)return t;if(!("children"in t))return;let o=t.children[t.children.length-1];return o&&!B(o)?D(o,e):void 0}function W(t){let e="";return t.children.forEach(n=>{A(n)?e+=n.text:N(n)&&(e+=W(n))}),e}function st(t,e={}){let{components:n,onMissingComponent:r=J}=e,i=r||Ct,l=function it(t,e){let r,n=[];for(let i=0;i<t.length;i++){let o=t[i];if(o){if(!v(o)){n.push(o),r=void 0;continue}if(!r){r=$(o,i,e),n.push(r);continue}if(St(o,r)){r.children.push(o);continue}if((o.level||1)>r.level){let l=$(o,i,e);if("html"===e){let c=r.children[r.children.length-1],f=nt(nt({},c),{},{children:[...c.children,l]});r.children[r.children.length-1]=f}else r.children.push(l);r=l;continue}if((o.level||1)<r.level){let l=n[n.length-1],c=l&&D(l,o);if(c){r=c,r.children.push(o);continue}r=$(o,i,e),n.push(r);continue}if(o.listItem!==r.listItem){let l=n[n.length-1],c=l&&D(l,{level:o.level||1});if(c&&c.listItem===o.listItem){r=c,r.children.push(o);continue}r=$(o,i,e),n.push(r);continue}console.warn("Unknown state encountered for block",o),n.push(o)}}return n}(Array.isArray(t)?t:[t],"html"),c=n?O(w,n):w,f=_t(c,i);return l.map((s,p)=>f({node:s,index:p,isInline:!1,renderNode:f})).join("")}var t,_t=(t,e)=>{function n(a){let{node:s,index:p,isInline:u}=a;return j(s)?function i(a,s){let p=a.children.map((y,b)=>n({node:y._key?y:h(d({},y),{_key:`li-${s}-${b}`}),index:s,isInline:!1,renderNode:n})),u=t.list,k=("function"==typeof u?u:u[a.listItem])||t.unknownList;if(k===t.unknownList){let y=a.listItem||"bullet";e((t=>P(`list style "${t}"`,"list"))(y),{nodeType:"listStyle",type:y})}return k({value:a,index:s,isInline:!1,renderNode:n,children:p.join("")})}(s,p):v(s)?function r(a,s){let p=lt({node:a,index:s,isInline:!1,renderNode:n}),u=t.listItem,k=("function"==typeof u?u:u[a.listItem])||t.unknownListItem;if(k===t.unknownListItem){let x=a.listItem||"bullet";e((t=>P(`list item style "${t}"`,"listItem"))(x),{type:x,nodeType:"listItemStyle"})}let y=p.children;if(a.style&&"normal"!==a.style){let b=a,{listItem:x}=b;y=n({node:g(b,["listItem"]),index:s,isInline:!1,renderNode:n})}return k({value:a,index:s,isInline:!1,renderNode:n,children:y})}(s,p):N(s)?function o(a){let{markDef:s,markType:p,markKey:u}=a,m=t.marks[p]||t.unknownMark,k=a.children.map((y,b)=>n({node:y,index:b,isInline:!0,renderNode:n}));return m===t.unknownMark&&e((t=>P(`mark type "${t}"`,"marks"))(p),{nodeType:"mark",type:p}),m({text:W(a),value:s,markType:p,markKey:u,renderNode:n,children:k.join("")})}(s):M(s)?function l(a,s,p){let x=lt({node:a,index:s,isInline:p,renderNode:n}),{_key:u}=x,m=g(x,["_key"]),k=m.node.style||"normal",b=("function"==typeof t.block?t.block:t.block[k])||t.unknownBlockStyle;return b===t.unknownBlockStyle&&e((t=>P(`block style "${t}"`,"block"))(k),{nodeType:"blockStyle",type:k}),b(h(d({},m),{value:m.node,renderNode:n}))}(s,p,u):A(s)?function c(a){if("\n"===a.text){let s=t.hardBreak;return s?s():"\n"}return T(a.text)}(s):function f(a,s,p){let u=t.types[a._type];return u||e(C(a._type),{nodeType:"block",type:a._type}),(u||t.unknownType)({value:a,isInline:p,index:s,renderNode:n})}(s,p,u)}return n};function lt(t){let{node:e,index:n,isInline:r,renderNode:i}=t,l=function ot(t){var e;let{children:n,markDefs:r=[]}=t;if(!n||!n.length)return[];let i=n.map(It),o={_type:"@span",children:[],markType:"<unknown>"},l=[o];for(let c=0;c<n.length;c++){let f=n[c];if(!f)continue;let a=i[c]||[],s=1;if(l.length>1)for(;s<l.length;s++){let u=(null==(e=l[s])?void 0:e.markKey)||"",m=a.indexOf(u);if(-1===m)break;a.splice(m,1)}l=l.slice(0,s);let p=l[l.length-1];if(p){for(let u of a){let m=r.find(b=>b._key===u),k=m?m._type:u,y={_type:"@span",_key:f._key,children:[],markDef:m,markType:k,markKey:u};p.children.push(y),l.push(y),p=y}if(B(f)){let u=f.text.split("\n");for(let m=u.length;m-- >1;)u.splice(m,0,"\n");p.children=p.children.concat(u.map(m=>({_type:"@text",text:m})))}else p.children=p.children.concat(f)}}return o.children}(e).map((c,f)=>i({node:c,isInline:!0,index:f,renderNode:i}));return{_key:e._key||`block-${n}`,children:l.join(""),index:n,isInline:r,node:e}}function Ct(){}return t=Ot,((t,e,n,r)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of mt(e))!H.call(t,i)&&i!==n&&S(t,i,{get:()=>e[i],enumerable:!(r=pt(e,i))||r.enumerable});return t})(S({},"__esModule",{value:!0}),t)})(),Object.assign(_this,_pt),_this.toHTML=function(blocks){pushRenderState();try{return toHTML(blocks)}finally{popRenderState()}},_this.render=function(blocks,parent,$element){let state=pushRenderState({renderParent:parent});try{let html=toHTML(blocks);$element||($element=parent.element),$element.html(html),state.afterRender.forEach(callback=>callback($element))}finally{popRenderState()}},_this.registerTypeRenderer=function(typeName,renderer,tagName="div"){toHTMLOptions.components.types[typeName]=function({value:value}){return function augmentAfterRender(tagName,callback){let afterRender=getRenderState("afterRender"),counter=afterRender.length+1;return afterRender.push($element=>{let $placeholder=new HydraObject($element.div.querySelector(`${tagName}[data-temp="${counter}"]`));$placeholder.attr("data-temp",null),callback($placeholder)}),`<${tagName} data-temp="${counter}"></${tagName}>`}(tagName,$element=>{let component=renderer(value,$element,getRenderState("renderParent"));if(component?.element?.div){let element=component.element;$element.div.replaceWith(element.div),element.onMountedHook&&defer(_=>{element.onMountedHook&&(element.onMountedHook(),delete element.onMountedHook)})}})}},_this.registerBlockRenderer=function(blockName,renderer){toHTMLOptions.components.block[blockName]=renderer},_this.registerMarkRenderer=function(markName,renderer){toHTMLOptions.components.marks[markName]=renderer}},"static"),Class(function SanityImageUrlBuilder(){Inherit(this,Component);const _this=this;let _builder;function parseAssetId(ref){const example="image-Tb9Ew8CXIwaY6R1kjMvI0uRR-2000x3000-jpg",[,id,dimensionString,format]=ref.split("-");if(!id||!dimensionString||!format)throw new Error(`Malformed asset _ref '${ref}'. Expected an id like "${example}".`);const[imgWidthStr,imgHeightStr]=dimensionString.split("x"),width=+imgWidthStr,height=+imgHeightStr;if(!(isFinite(width)&&isFinite(height)))throw new Error(`Malformed asset _ref '${ref}'. Expected an id like "${example}".`);return{id:id,width:width,height:height,format:format}}_this.configure=function(options){_builder&&_builder.baseUrl===options.baseUrl&&_builder.projectId===options.projectId&&_builder.dataset===options.dataset||(_builder=new ImageUrlBuilder(null,options),_this.flag("isReady",!0))},_this.ready=_this.wait("isReady"),_this.build=function(image){return _this.buildRaw(image).auto("format").fit("min")},_this.buildRaw=function(image){if(!_builder)throw new Error("Need to call configure() before build()");return _builder.image(image)},_this.getImageDimensions=function(image,cropAspectRatio){if(!(image=parseSource(image)))return{};const asset=parseAssetId(image.asset._ref||image.asset._id||"");let width=asset.width,height=asset.height,aspectRatio=asset.width/asset.height;if(image.crop){let x1=image.crop.left*width,y1=image.crop.top*height,x2=(1-image.crop.right)*width,y2=(1-image.crop.bottom)*height;width=Math.round(x2-x1),height=Math.round(y2-y1),aspectRatio=width/height}return"number"==typeof cropAspectRatio&&(cropAspectRatio<aspectRatio?width=Math.round(height*cropAspectRatio):height=Math.round(width/cropAspectRatio),aspectRatio=width/height),{width:width,height:height,aspectRatio:aspectRatio,_type:"sanity.imageDimensions"}};const SPEC_NAME_TO_URL_NAME_MAPPINGS=[["width","w"],["height","h"],["format","fm"],["download","dl"],["blur","blur"],["sharpen","sharp"],["invert","invert"],["orientation","or"],["minHeight","min-h"],["maxHeight","max-h"],["minWidth","min-w"],["maxWidth","max-w"],["quality","q"],["fit","fit"],["crop","crop"],["saturation","sat"],["auto","auto"],["dpr","dpr"],["pad","pad"],["frame","frame"]];function urlForImage(options){let spec={...options||{}};const source=spec.source;delete spec.source;const image=parseSource(source);if(!image)return null;const asset=parseAssetId(image.asset._ref||image.asset._id||""),cropLeft=Math.round(image.crop.left*asset.width),cropTop=Math.round(image.crop.top*asset.height),crop={left:cropLeft,top:cropTop,width:Math.round(asset.width-image.crop.right*asset.width-cropLeft),height:Math.round(asset.height-image.crop.bottom*asset.height-cropTop)},hotSpotVerticalRadius=image.hotspot.height*asset.height/2,hotSpotHorizontalRadius=image.hotspot.width*asset.width/2,hotSpotCenterX=image.hotspot.x*asset.width,hotSpotCenterY=image.hotspot.y*asset.height,hotspot={left:hotSpotCenterX-hotSpotHorizontalRadius,top:hotSpotCenterY-hotSpotVerticalRadius,right:hotSpotCenterX+hotSpotHorizontalRadius,bottom:hotSpotCenterY+hotSpotVerticalRadius};return spec.rect||spec.focalPoint||spec.ignoreImageParams||spec.crop||(spec={...spec,...fit({crop:crop,hotspot:hotspot},spec)}),function specToImageUrl(spec){const cdnUrl=spec.baseUrl||"https://cdn.sanity.io",filename=`${spec.asset.id}-${spec.asset.width}x${spec.asset.height}.${spec.asset.format}`,baseUrl=`${cdnUrl}/images/${spec.projectId}/${spec.dataset}/${filename}`,params=[];if(spec.rect){const{left:left,top:top,width:width,height:height}=spec.rect;(0!==left||0!==top||height!==spec.asset.height||width!==spec.asset.width)&&params.push(`rect=${left},${top},${width},${height}`)}spec.bg&&params.push(`bg=${spec.bg}`);spec.focalPoint&&(params.push(`fp-x=${spec.focalPoint.x}`),params.push(`fp-y=${spec.focalPoint.y}`));const flip=[spec.flipHorizontal&&"h",spec.flipVertical&&"v"].filter(Boolean).join("");flip&&params.push(`flip=${flip}`);if(SPEC_NAME_TO_URL_NAME_MAPPINGS.forEach(mapping=>{const[specName,param]=mapping;void 0!==spec[specName]?params.push(`${param}=${encodeURIComponent(spec[specName])}`):void 0!==spec[param]&&params.push(`${param}=${encodeURIComponent(spec[param])}`)}),0===params.length)return baseUrl;return`${baseUrl}?${params.join("&")}`}({...spec,asset:asset})}function fit(source,spec){let cropRect;const imgWidth=spec.width,imgHeight=spec.height;if(!imgWidth||!imgHeight)return{width:imgWidth,height:imgHeight,rect:source.crop};const crop=source.crop,hotspot=source.hotspot,desiredAspectRatio=imgWidth/imgHeight;if(crop.width/crop.height>desiredAspectRatio){const height=Math.round(crop.height),width=Math.round(height*desiredAspectRatio),top=Math.max(0,Math.round(crop.top)),hotspotXCenter=Math.round((hotspot.right-hotspot.left)/2+hotspot.left);let left=Math.max(0,Math.round(hotspotXCenter-width/2));left<crop.left?left=crop.left:left+width>crop.left+crop.width&&(left=crop.left+crop.width-width),cropRect={left:left,top:top,width:width,height:height}}else{const width=crop.width,height=Math.round(width/desiredAspectRatio),left=Math.max(0,Math.round(crop.left)),hotspotYCenter=Math.round((hotspot.bottom-hotspot.top)/2+hotspot.top);let top=Math.max(0,Math.round(hotspotYCenter-height/2));top<crop.top?top=crop.top:top+height>crop.top+crop.height&&(top=crop.top+crop.height-height),cropRect={left:left,top:top,width:width,height:height}}return{width:imgWidth,height:imgHeight,rect:cropRect}}const validFits=["clip","crop","fill","fillmax","max","scale","min"],validCrops=["top","bottom","left","right","center","focalpoint","entropy"],validAutoModes=["format"];function rewriteSpecName(key){const specs=SPEC_NAME_TO_URL_NAME_MAPPINGS;for(const entry of specs){const[specName,param]=entry;if(key===specName||key===param)return specName}return key}class ImageUrlBuilder{constructor(parent,options){this.options=parent?{...parent.options||{},...options||{}}:{...options||{}}}withOptions(options){const baseUrl=options.baseUrl||this.options.baseUrl,newOptions={baseUrl:baseUrl};for(const key in options)if(options.hasOwnProperty(key)){newOptions[rewriteSpecName(key)]=options[key]}return new ImageUrlBuilder(this,{baseUrl:baseUrl,...newOptions})}image(source){return this.withOptions({source:source})}dataset(dataset){return this.withOptions({dataset:dataset})}projectId(projectId){return this.withOptions({projectId:projectId})}bg(bg){return this.withOptions({bg:bg})}dpr(dpr){return this.withOptions(dpr&&1!==dpr?{dpr:dpr}:{})}width(width){return this.withOptions({width:width})}height(height){return this.withOptions({height:height})}focalPoint(x,y){return this.withOptions({focalPoint:{x:x,y:y}})}maxWidth(maxWidth){return this.withOptions({maxWidth:maxWidth})}minWidth(minWidth){return this.withOptions({minWidth:minWidth})}maxHeight(maxHeight){return this.withOptions({maxHeight:maxHeight})}minHeight(minHeight){return this.withOptions({minHeight:minHeight})}size(width,height){return this.withOptions({width:width,height:height})}blur(blur){return this.withOptions({blur:blur})}sharpen(sharpen){return this.withOptions({sharpen:sharpen})}rect(left,top,width,height){return this.withOptions({rect:{left:left,top:top,width:width,height:height}})}format(format){return this.withOptions({format:format})}invert(invert){return this.withOptions({invert:invert})}orientation(orientation){return this.withOptions({orientation:orientation})}quality(quality){return this.withOptions({quality:quality})}forceDownload(download){return this.withOptions({download:download})}flipHorizontal(){return this.withOptions({flipHorizontal:!0})}flipVertical(){return this.withOptions({flipVertical:!0})}ignoreImageParams(){return this.withOptions({ignoreImageParams:!0})}fit(value){if(-1===validFits.indexOf(value))throw new Error(`Invalid fit mode "${value}"`);return this.withOptions({fit:value})}crop(value){if(-1===validCrops.indexOf(value))throw new Error(`Invalid crop mode "${value}"`);return this.withOptions({crop:value})}saturation(saturation){return this.withOptions({saturation:saturation})}auto(value){if(-1===validAutoModes.indexOf(value))throw new Error(`Invalid auto mode "${value}"`);return this.withOptions({auto:value})}pad(pad){return this.withOptions({pad:pad})}vanityName(value){return this.withOptions({vanityName:value})}frame(frame){if(1!==frame)throw new Error(`Invalid frame value "${frame}"`);return this.withOptions({frame:frame})}url(){return urlForImage(this.options)}toString(){return this.url()}}const isRef=source=>!!source&&"string"==typeof source._ref,isAsset=source=>!!source&&"string"==typeof source._id,isAssetStub=source=>!(!source||!source.asset)&&"string"==typeof source.asset.url;function parseSource(source){if(!source)return null;let image;if("string"==typeof source&&function isUrl(url){return/^https?:\/\//.test(`${url}`)}(source))image={asset:{_ref:urlToId(source)}};else if("string"==typeof source)image={asset:{_ref:source}};else if(isRef(source))image={asset:source};else if(isAsset(source))image={asset:{_ref:source._id||""}};else if(isAssetStub(source))image={asset:{_ref:urlToId(source.asset.url)}};else{if("object"!=typeof source.asset)return null;image=source}const img=source;return img.crop&&(image.crop=img.crop),img.hotspot&&(image.hotspot=img.hotspot),function applyDefaults(image){if(image.crop&&image.hotspot)return image;const result={...image};result.crop||(result.crop={left:0,top:0,bottom:0,right:0});result.hotspot||(result.hotspot={x:.5,y:.5,height:1,width:1});return result}(image)}function urlToId(url){return`image-${url.split("/").slice(-1)[0]}`.replace(/\.([a-z]+)$/,"-$1")}},"static"),Class(function SanityUtils(){Inherit(this,Component);const _this=this;_this.canonicalBase=location.origin,_this.canonicalHost=location.hostname,_this.stegaClean=function(string){return string},_this.stegaSplit=function(string){return{encoded:"",cleaned:string}},_this.richTextToPlainText=function(text){return(text||[]).filter(block=>"block"===block._type).map(block=>block.children.filter(child=>"span"===child._type).map(span=>span.text).join("").trim()).filter(Boolean).join("\n").trim()},_this.resolvePath=function(doc){if(!doc)return;let parts=[],ref=doc;for(;ref;)ref.slug&&parts.push(ref.slug.current),ref=ref.parent;doc.language&&"en"!==doc.language&&parts.push(doc.language);let path=parts.reverse().filter(Boolean).join("/");return"home"===path&&(path=""),path},_this.resolveLink=function(linkContent){return"internalLink"===linkContent._type?(linkContent.path||(linkContent.path=_this.resolvePath(linkContent.reference)),linkContent.hash&&!linkContent.path.includes("#")&&(linkContent.path+=`#${linkContent.hash}`),linkContent.url=`${_this.canonicalBase}/${linkContent.path}`,!linkContent.text&&linkContent.reference&&(linkContent.text||(linkContent.text=linkContent.reference.title)),linkContent.targetBlank&&(linkContent.target="_blank")):(linkContent.href&&!linkContent.url?linkContent.url=linkContent.href:linkContent.url&&!linkContent.href&&(linkContent.href=linkContent.url),!linkContent.href||linkContent.href.includes(_this.canonicalHost)||linkContent.href.includes("mailto:")||(linkContent.target="_blank")),linkContent},_this.resolveLinks=function(content){Object.keys(content).forEach(key=>{let value=content[key];value&&"object"==typeof value&&("internalLink"===value._type||"link"===value._type||"externalLink"===value._type?_this.resolveLink(value):"slug"!==value._type&&_this.resolveLinks(value))})},_this.imageUrlBuilder=SanityImageUrlBuilder.build,_this.rawImageUrlBuilder=SanityImageUrlBuilder.buildRaw,_this.getImageDimensions=SanityImageUrlBuilder.getImageDimensions},"Static"),Class(function Frag3D(_name){Inherit(this,Object3D);const _this=this;this.layout=this.initClass(SceneLayout,_name),this.uploadSync=function(){return Initializer3D.uploadAll(_this.layout)}}),Class(function FragFXScene(_name){Inherit(this,FXScene);const _this=this;function initLayout(name){if(_this.layout)return Hydra.LOCAL?console.warn(`FragFXScene: initLayout: layout ${_name} already initialized`):null;_name=name,_this.layout=_this.initClass(SceneLayout,_name),_this.scene.add(_this.layout.group),_this.cameraController=Camera.instance().createLocal()}_name&&initLayout(_name),this.group=new Group,this._initFXScene=function(nuke,rtPool,options){for(let key in options)options[key]||delete options[key];if(RenderManager.type==RenderManager.WEBVR&&!options.vrMode)return _this.onFXSceneVisibility=bool=>{if(bool){_this.group.visible=!0;let recurse=obj=>{if(obj.classRef?.layers)for(let key in obj.classRef.layers){let layer=obj.classRef.layers[key];!0===layer.visible&&(layer.visible=!1,layer.visible=!0)}obj.children.forEach(recurse)};_this.group.children.forEach(recurse)}},void _this.vrWorldMode();options.screenQuad&&defer(_=>{let shader=_this.initClass(Shader,"ScreenQuad",{customCompile:Utils.uuid(),depthWrite:!1,tMap:{value:_this.rt}}),mesh=new Mesh(World.QUAD,shader);mesh.frustumCulled=!1,mesh.renderOrder=-1,_this.group.add(mesh)}),rtPool?_this.create(nuke,rtPool(),options):_this.create(nuke,options),_this._initMultiscreenFXScene?.(),_this.cameraController&&!Utils.query("orbit")&&_this.useCamera(_this.cameraController.worldCamera)},this.initLayout=async function(name){initLayout(name),_this.layers=await _this.layout.getAllLayers()},this.uploadSync=function(){return Initializer3D.uploadAll(_this.layout)}}),Class(function SceneLayout(_name,_options={}){Inherit(this,Object3D);const _this=this;var _dataStore,_data,_timeline,_breakpoint,_stateData,_gizmo,_initializers=[],_promiseCount=0,_promisesAllSettled=Promise.create(),_breakpoints=[],_folders={},_groups={},_custom={},_meshes={},_exists={},_layers={},_uil=UIL.sidebar,_graph,_config,_groupIndex=0,_groupsSynced=Promise.create();async function initialize(promise){try{_promiseCount+=1,await promise}finally{0===(_promiseCount-=1)&&_promisesAllSettled.resolve()}}function initGizmo(){_options.noGizmo||Utils.query("nogizmo")||RenderManager.type!=RenderManager.NORMAL||(_gizmo=_this.initClass(SceneLayoutGizmo))}function createFolder(name){let folder=new UILFolder(`sl_${_name}_${name}`,{label:name,closed:!0});return folder.hide(),_folders[`sl_${_name}_${name}`]=folder,folder}async function initConfig(){let input=InputUIL.create(`CONFIG_sl_${_name}`,_uil);input.add("Animation"),input.add("Layout"),input.add("Cinema Config"),_graph&&_graph.addSpecial("Config",`Config (${_name})`,"Config"),input.setLabel("Config");let animation=input.get("Animation"),layout=input.get("Layout");animation&&(await ready(),_groupsSynced.then(async()=>{if(animation=animation.replace(/^\//g,""),_this.animation=_this.initClass(HierarchyAnimation,animation,linkObjects),_timeline)_this.startRender(_=>{_this.animation.elapsed=_timeline.elapsed,_this.animation.update()});else if(_uil){let range=new UILControlRange("Animation",{min:0,max:1,step:.001});range.onChange(val=>{_this.animation.elapsed=val,_this.animation.update()}),_uil.add(range)}await _this.animation.ready(),_this.animation.update()})),layout&&(await ready(),_this.layout=_this.initClass(HierarchyLayout,layout,linkObjects),await _this.layout.ready()),_config=input,await defer(),_this.configured=!0}async function linkObjects(data){let array=[];for(let i=0;i<data.length;i++){let name=data[i].name,exists=_this.exists(name);exists||"null"==name.toLowerCase()||console.warn(`linkAnimation :: ${name} does not exist`);let group=new Group,mesh=exists?await _this.getLayer(name):null;mesh&&(_this.layout&&mesh instanceof Mesh?(mesh._parent.add(group),group.add(mesh)):group=mesh.group||mesh),group.name=name,array.push(group)}return array}async function initGraph(){if(_options.noGraph||!window.UILGraph||SceneLayout.noGraph||UIL.CMS_ONLY&&!_options.cmsData||!UIL.CMS_ONLY&&_options.cmsData)return _uil=null,void _groupsSynced.resolve();(_graph=UILGraph.instance().getGraph(_name,_this))?(UIL.sidebar.element.show(),await _this.ready(),_graph.syncVisibility(_layers),_graph.syncGroupNames(_groups,_folders),_groupsSynced.resolve(),Global.PLAYGROUND&&Utils.getConstructorName(_this.parent)==Global.PLAYGROUND&&_graph.open()):_groupsSynced.resolve()}function initParams(){if(_options.rootPath?"/"!=_options.rootPath.charAt(_options.rootPath.length-1)&&(_options.rootPath+="/"):_options.rootPath="",_this.timeline=_timeline=_options.timeline,_timeline&&(_timeline.add({v:0},{v:1},100,"linear"),_uil)){let range=new UILControlRange("Timeline",{min:0,max:1,step:.001});range.onChange(val=>{_timeline.elapsed=val,_timeline.update()}),_uil.add(range),range.hide(),_graph&&_graph.addSpecial("Timeline","Timeline")}_this.baseRenderOrder=_options.baseRenderOrder||0,_this.data=_options.data,_breakpoint=_options.breakpoint||SceneLayout.breakpoint,_options.breakpoint&&(_this.localBreakpoint=!0),_options.uil&&(_uil=_options.uil)}async function initData(){if(await UILStorage.ready(),_dataStore=InputUIL.create(`scenelayout_${_name}`,null),void 0===(_data=JSON.parse(_dataStore.get("data")||"{}")).layers&&(_data.layers=-1),_stateData=await UILGroupBridge.createSceneLayout(_name,_this),_options.perFrame)_data.layers>0?createLayers():_this.loaded=!0;else{for(let i=0,c=_data.layers+1;i<c;i++)initialize(createLayer(i));_this.loaded=!0}}function createShader(shaderName,input,params={}){let shader;try{shader=_this.initClass(Shader,shaderName,{unique:`Element_${input.id}_${_name}`,...params})}catch(e){if("SceneLayout"===shaderName)throw e;return console.error(e,", replacing with default UV tile."),createShader("SceneLayout",input,params)}if("SceneLayout"===shaderName||!window[shaderName]){let texturePath=input.getImage("texture");texturePath?texturePath.includes("assets/images")||(texturePath=_options.rootPath+texturePath):texturePath="assets/images/_scenelayout/uv.jpg",shader.addUniforms({tMap:{value:Utils3D.getTexture(texturePath)},uAlpha:{value:1}})}return shader}function createLayers(){let index=0,renderWorker=new Render.Worker(function(){initialize(createLayer(index)),index++==_data.layers&&(renderWorker.stop(),_this.loaded=!0)},_options.perFrame)}function getGroup(name,index){if(!name)return _this.group;if(name==_name)return _this.group;if(!_groups[name]){let uilGroup=_uil?createFolder(name):null;uilGroup&&(uilGroup.setLabel(`${name} (Group)`),_uil.add(uilGroup),_graph&&_graph.addGroup(uilGroup.id,name));let config=InputUIL.create(`GROUP_${_name}_${name}`,uilGroup);config.setLabel("Parameters"),config.addToggle("occlusionCulling"),_timeline&&config.add("tween"),config.addToggle("billboard"),config.add("breakpoints"),config.add("name","hidden");let breakpoints=config.get("breakpoints");breakpoints&&(breakpoints=breakpoints.replace(/ /g,"").split(","));let breakpoint=breakpoints&&_breakpoint?"-"+_breakpoint:"";"-"==breakpoint.charAt(breakpoint.length-1)&&(breakpoint="");let group=new Group;group.name=name,_groups[name]=group,_layers[name]=group,_exists[name]="group",group.prefix=`${name}_${_name}${breakpoint}`;let meshUIL=MeshUIL.add(group,uilGroup);meshUIL.setLabel("Mesh"),_this.add(group),UIL.global&&(group._meshUIL=meshUIL),uilGroup&&(uilGroup.params=config),breakpoints&&_breakpoints.push(group),config.get("billboard")&&updateBillboard(!0,mesh);let occlusionCulling=config.get("occlusionCulling");"boolean"==typeof occlusionCulling&&occlusionCulling&&_groups[name].generateOcclusionMesh();let appState=_stateData.getGroup(index||_groupIndex);appState||(appState=_stateData.syncGroup(index||_groupIndex,name),_this.flag("needsGroupFixing",!0)),_this.flag("needsGroupFixing")&&(group.fixStateBinding=appState.id),appState.scene=_name,_this.bindState(appState,"name",name=>{_groups[name]=group,_layers[name]=group,_exists[name]="group";for(let key in _layers)key!=name&&_layers[key]==_layers[name]&&(delete _layers[key],delete _exists[key],delete _groups[key])}),_this.bindState(appState,"visible",bool=>{group.visible=bool}),_this.bindState(appState,"deleted",bool=>{bool&&(delete _groups[name],delete _layers[name],delete _exists[name],group.destroy())}),bindSortIndex(group,index||_groupIndex,appState,config),appState.slGroup=group}return void 0===index&&(_data.groups=_groupIndex,_groupIndex++,_dataStore.setValue("data",JSON.stringify(_data))),_this.flag("needsGroupFixing")&&Utils.debounce(healGroups,100),_groups[name]}function healGroups(){_stateData.healGroups(_groupIndex)}function addPhysicsInputs(input){input.displayPhysics||(input.displayPhysics=!0,input.add("physicsCode"),Physics.supportsMeshTypes&&input.addSelect("physicsType",[{label:"Shapes/Bounds",value:"default"},{label:"Convex",value:"convex"},{label:"Triangle Mesh",value:"mesh"}]),input.addFile("physicsBounds",{relative:"assets/geometry"}))}async function bindSortIndex(mesh,id,appState,input){_this.bindState(appState,"sortIndex",async index=>{if(appState.parent){let[fraction,groupSortIndex]=await _stateData.calculateRenderFraction(id),renderOrder=_this.baseRenderOrder+groupSortIndex+fraction;input&&input.setValue("renderOrder",renderOrder-_this.baseRenderOrder),mesh.renderOrder=renderOrder,mesh.classRef?.setRenderOrder&&mesh.classRef.setRenderOrder(renderOrder)}else{let renderOrder=_this.baseRenderOrder+index;input&&(input.setValue("renderOrder",renderOrder-_this.baseRenderOrder),input.setValue("sortIndex",index)),mesh.renderOrder=renderOrder,mesh.classRef?.setRenderOrder&&mesh.classRef.setRenderOrder(renderOrder)}})}async function createLayer(index,groupName,returnName){let created=!1,input,id="number"==typeof index?index:++_data.layers,graphGroupName=groupName;if(graphGroupName){let nameLabel=UILStorage.get(`INPUT_GROUP_${_name}_${groupName}_name`);nameLabel&&(groupName=nameLabel)}let appState=_stateData.layers[id];if(appState?.deleted)return;if(_this.preventLayerCreation&&_this.preventLayerCreation(UILStorage.get(`INPUT_Config_${id}_${_name}_name`)))return;let group=_uil?createFolder(id):null,shader,mesh;appState&&(_this.bindState(appState,"visible",bool=>{mesh&&(mesh.visible=bool)}),_this.bindState(appState,"parent",async parentName=>{let parent;if(await _this.wait(_=>!!mesh),parentName?.includes?.("group")&&(parent=Number(parentName.split("group_")[1])),null==parentName)return _this.group.add(mesh),mesh.position.y+=1,void(mesh.position.y-=1);if(parentName.includes("_env_")){let groupName=parentName.split("_env_")[1];return _groups[groupName].add(mesh),mesh.position.y+=1,void(mesh.position.y-=1)}if(parentName.startsWith("sl_")){let groupName=parentName.split("_").pop();if(isNaN(groupName)){return _groups[groupName].add(mesh),mesh.position.y+=1,void(mesh.position.y-=1)}}if(parent>-1){let obj=_stateData.getGroup(parent);obj?.slGroup&&obj.slGroup.add(mesh),mesh.position.y+=1,mesh.position.y-=1}else _this.group.add(mesh)})),Hydra.LOCAL&&_this.delayedCall(_=>{created||console.error(`SceneLayout :: 5 second timer expired creating ${_name} ${input.get("name")}`)},5e3),input=InputUIL.create(`Config_${id}_${_name}`,group),input.setLabel("Parameters"),input.add("name","hidden").add("sortIndex","hidden").addFile("geometry",{relative:"assets/geometry"}).addToggle("visible",!0).addToggle("transparent").addToggle("depthWrite",!0).addToggle("depthTest",!0).addToggle("occlusionCulling",!1).addToggle("castShadow").addToggle("receiveShadow").addToggle("receiveLight").addToggle("billboard").addToggle("animates",!0).add("shader").add("custom",null,"customClass").add("script",null,"scriptClass").add("wildcard").add("renderOrder","hidden").add("group","hidden").add("breakpoints").addSelect("side",[{label:"Front Side",value:"shader_front_side"},{label:"Back Side",value:"shader_back_side"},{label:"Double Side",value:"shader_double_side"},{label:"Double Side Transparent",value:"shader_double_side_trasparency"}]).addSelect("blending",[{label:"Normal",value:"shader_normal_blending"},{label:"Additive",value:"shader_additive_blending"},{label:"Premultiplied Alpha",value:"shader_premultiplied_alpha_blending"},{label:"Multiply",value:"shader_multiply_blending"}]),UIL.global&&(appState.inputUIL=input),input.name=_name,input.prefix=`Element_${id}_${_name}`,input.id=id,group&&(group.params=input),_timeline&&input.addToggle("tween"),_options.physics&&(input.addToggle("physics"),input.get("physics")?addPhysicsInputs(input):_this.bindState(input.state,"physics",bool=>{bool&&addPhysicsInputs(input)}));let name=input.get("name")||id,shaderName=input.get("shader")||"SceneLayout",geomPath=input.getFilePath("geometry"),visible=input.get("visible"),transparent=input.get("transparent"),depthWrite=input.get("depthWrite"),depthTest=input.get("depthTest"),occlusionCulling=input.get("occlusionCulling"),billboard=input.get("billboard"),animates=input.get("animates"),doTween=input.get("tween"),renderOrder=input.getNumber("renderOrder"),blending=input.get("blending"),side=input.get("side"),physics=input.get("physics"),castShadow=input.get("castShadow"),receiveShadow=input.get("receiveShadow"),receiveLight=input.get("receiveLight");appState&&(appState.scene=_name,(async()=>{mesh||await _this.wait(_=>mesh),_this.destroy&&bindSortIndex(mesh,id,appState,input)})());let breakpoints=input.get("breakpoints");breakpoints&&(breakpoints=breakpoints.replace(/ /g,"").split(","));let breakpoint=breakpoints&&_breakpoint?"-"+_breakpoint:"";"-"==breakpoint.charAt(breakpoint.length-1)&&(breakpoint=""),name&&group&&group.setLabel(name),groupName&&input.setValue("group",groupName);let groupParent=getGroup(input.get("group"));if(group){let groupName=input.get("group"),groupId=groupName?`sl_${_name}_${graphGroupName||groupName}`:void 0;_graph&&_graph.addLayer(group.id,name||id+"",groupId)}if(_uil&&!UIL.CMS_ONLY&&_uil.add(group),"ignore"==name)return created=!0;let customClass=input.get("custom")||input.get("customClass"),scriptClass=input.get("script")||input.get("scriptClass"),customCompile;if(shaderName.includes("|")&&([shaderName,customCompile]=shaderName.split("|")),_exists[name]=customClass?"custom":"mesh",customClass){if(customClass===_this.parent.constructor.name)return console.warn(`Tried to recursively initialize ${customClass}`);if(!window[customClass])return console.warn(`Tried to initialize ${customClass} but it doesn't  exist!`);let obj=_this.initClass(window[customClass],input,group,id,null);if(mesh=obj.group,obj.wildcard=input.get("wildcard"),obj.animates=input.get("animates"),"boolean"==typeof visible&&mesh&&(mesh.visible=visible),_custom[name]=obj,_layers[name]=obj,appState&&_this.bindState(appState,"name",name=>{_layers[name]=obj,_exists[name]="custom";for(let key in _layers)key!=name&&_layers[key]==_layers[name]&&(delete _layers[key],delete _exists[key])}),_this.onCreateLayer){let capture=cb=>(_this.delayedCall(_=>cb(obj,name),32),!0);if(!0===_this.onCreateLayer(name,group,capture))return}if(obj.group&&(groupParent.add(obj.group),groupParent&&groupParent.fixStateBinding&&(appState.parent=groupParent.fixStateBinding)),obj.renderOrder=_this.baseRenderOrder+renderOrder,mesh){let meshUIL;obj.camera||(mesh.prefix=`Element_${id}_${_name}${breakpoint}`,meshUIL=MeshUIL.add(mesh,group),meshUIL.setLabel("Mesh"),UIL.global&&(mesh._meshUIL=meshUIL)),breakpoints&&_breakpoints.push(mesh),scriptClass&&!1!==visible&&(scriptClass.includes(",")?(scriptClass=scriptClass.replace(/ /g,"").split(","),scriptClass.forEach(script=>{window[script]?(mesh.scriptClass=mesh.scriptClass||[],mesh.scriptClass.push(_this.initClass(window[script],mesh,shader,group,input))):console.warn(`scriptClass ${script} not found`)})):window[scriptClass]?mesh.scriptClass=_this.initClass(window[scriptClass],mesh,shader,group,input):console.warn(`scriptClass ${scriptClass} not found`)),UIL.global&&(mesh._sceneLayout=input._sceneLayout={meshUIL:meshUIL,mesh:mesh,shader:shader,name:name,input:input})}return created=!0,input}if(_this.onCreateLayer){let capture=cb=>{let mesh=new Group;return mesh.prefix=`Element_${id}_${_name}${breakpoint}`,MeshUIL.add(mesh,group),_meshes[name]=mesh,_layers[name]=mesh,_this.delayedCall(_=>cb(mesh,name),32),created=!0,!0};if(!0===_this.onCreateLayer(name,group,capture))return created=!0}let geom=World.PLANE;geomPath&&geomPath.includes(["World","SceneLayout"])&&(geom=eval(geomPath),geomPath=null),shaderName.includes(".shader")&&(shader=await resolveShaderRef(shaderName,name),shader||(shaderName="SceneLayout")),shader||(shaderName.includes("PBR")?shader=_this.initClass(PBRShader,shaderName,{unique:`Element_${id}_${_name}`,customCompile:customCompile}):(shader=createShader(shaderName,input,{customCompile:customCompile}),defer(_=>{for(let key in shader.uniforms){let uniform=shader.uniforms[key];uniform&&uniform.value instanceof Texture&&initialize(uniform.value.promise)}}))),"boolean"==typeof depthWrite&&(shader.depthWrite=depthWrite),"boolean"==typeof depthTest&&(shader.depthTest=depthTest),"boolean"==typeof transparent&&(shader.transparent=transparent),_this.onCreateGeometry&&(geomPath=_this.onCreateGeometry(geomPath,input.get("wildcard")));let gltfNodes=null;if(geomPath)if(String(geomPath).indexOf(".glb")>0||String(geomPath).indexOf(".gltf")>0){let loader=new GLTFLoader;gltfNodes=await loader.parse(geomPath,_this,name),geom=new PlaneGeometry(0,0)}else geom=await GeomThread.loadGeometry(geomPath);if(mesh=new Mesh(geom,shader),"boolean"==typeof occlusionCulling&&(mesh.occlusionCulled=occlusionCulling),gltfNodes)for(let i=0;i<gltfNodes.length;i++)mesh.add(gltfNodes[i]);"boolean"==typeof _options.frustumCulled&&(mesh.frustumCulled=_options.frustumCulled),"boolean"==typeof visible&&(mesh.visible=visible),groupParent.fixStateBinding&&(appState.parent=groupParent.fixStateBinding),mesh.prefix=`Element_${id}_${_name}${breakpoint}`,mesh.uilName=name,mesh.uilGroup=group,mesh.uilGraph=_graph,mesh.wildcard=input.get("wildcard"),mesh.animates=input.get("animates");let meshUIL=MeshUIL.add(mesh,group);if(meshUIL.setLabel("Mesh"),UIL.global&&(mesh._meshUIL=meshUIL),physics){let p=_this.group,_physicsData;for(;p;){if(p._physicsData){_physicsData=p._physicsData;break}p=p._parent}_physicsData&&(mesh._physicsData=_physicsData);let path=input.getFilePath("physicsBounds"),type=input.getFilePath("physicsType")??"default",obj;if("default"!==type){let shapes=[{type:type,pos:[0,0,0],rot:[0,0,0],scale:mesh.scale.toArray(),vertices:geom.attributes.position.array,index:geom.index}];obj=Physics.instance().createFromShapes(shapes,{sleep:!0,debugId:geom._src},mesh)}else if(path){const shapes=await PhysicsBounds.parsePhysicsBoundsShapes(Assets.getPath(path));shapes&&(obj=Physics.instance().createFromShapes(shapes,{},mesh))}obj||(obj=Physics.instance().create(mesh)),_physicsData&&delete mesh._physicsData,obj.prefix=`Physics_${id}_${_name}`,PhysicsUIL.add(obj,group).setLabel("Physics");let physicsCodeClassName=input.get("physicsCode"),physicsCodeClass;physicsCodeClassName&&(physicsCodeClass=window[physicsCodeClassName],physicsCodeClass||console.warn(`physicsCode class ${physicsCodeClassName} not found`)),physicsCodeClass&&_this.initClass(physicsCodeClass,obj,mesh,group,input)}if(groupParent.add(mesh),_meshes[name]=mesh,_layers[name]=mesh,appState&&_this.bindState(appState,"name",name=>{_layers[name]=mesh,_exists[name]=customClass?"custom":mesh;for(let key in _layers)key!=name&&_layers[key]==_layers[name]&&(delete _layers[key],delete _exists[key])}),breakpoints&&_breakpoints.push(mesh),mesh.renderOrder=_this.baseRenderOrder+(renderOrder||0),billboard&&updateBillboard(!0,mesh),"SceneLayout"!=shaderName&&window[shaderName]&&(mesh.shaderClass=_this.initClass(window[shaderName],mesh,shader,group,input)),"number"!=typeof index&&_dataStore.setValue("data",JSON.stringify(_data)),blending&&(shader.blending=blending),side&&(shader.side=side),castShadow&&(mesh.castShadow=castShadow),receiveShadow=receiveShadow||Shader.shouldReceiveShadow(shader),receiveShadow&&(shader.receiveShadow=receiveShadow),receiveLight&&(shader.receiveLight=receiveLight),scriptClass&&(scriptClass.includes(",")?(scriptClass=scriptClass.replace(/ /g,"").split(","),scriptClass.forEach(script=>{window[script]?(mesh.scriptClass=mesh.scriptClass||[],mesh.scriptClass.push(_this.initClass(window[script],mesh,shader,group,input))):console.warn(`scriptClass ${script} not found`)})):window[scriptClass]?mesh.scriptClass=_this.initClass(window[scriptClass],mesh,shader,group,input):console.warn(`scriptClass ${scriptClass} not found`)),shader._copied||shader!==mesh.shader&&!shaderName.includes("PBR")||ShaderUIL.add(shader,group).setLabel("Shader"),shader._copied&&shader._copied.shaderClass&&shader._copied.shaderClass.applyClone&&shader._copied.shaderClass.applyClone(mesh),input.onUpdate=key=>{switch(key){case"name":break;case"visible":mesh.visible=input.get(key);break;case"renderOrder":mesh.renderOrder=_this.baseRenderOrder+input.getNumber(key);break;case"transparent":shader.transparent=input.get(key);break;case"depthWrite":shader.depthWrite=input.get(key);break;case"depthTest":shader.depthTest=input.get(key);break;case"side":shader.side=input.get(key);break;case"blending":shader.blending=input.get(key);break;case"geometry":updateGeometry(input.getFilePath(key),mesh);break;case"shader":updateShader(input.get(key),mesh,group,input);break;case"scriptClass":updateScriptClass(input.get(key),mesh,group,input);break;case"receiveShadow":updateShadow(input.get(key),mesh);break;case"receiveLight":updateLighting(input.get(key),mesh);break;case"billboard":updateBillboard(input.get(key),mesh)}UIL.global&&(World.SCENE.displayNeedsUpdate=!0,window?.view?.scene&&(view.scene.displayNeedsUpdate=!0))},Hydra.LOCAL&&Global.PLAYGROUND){_this.events.sub(SceneLayout.HOTLOAD_GEOMETRY,({file:file})=>{mesh.geometry?._src?.includes(file)&&updateGeometry(file,mesh)});const scriptClassNeedsUpdate=(inst,file)=>(inst.__cacheName||(inst.__cacheName=Utils.getConstructorName(inst)),!!file.includes(inst.__cacheName)&&inst.__cacheName);_this.events.sub(SceneLayout.HOTLOAD_SCRIPT,({file:file})=>{if(file.includes(mesh.shader?.vsName)&&(shader.hotReloading=!0,"SceneLayout"!==shaderName&&window[shaderName]&&(mesh.shaderClass=_this.initClass(window[shaderName],mesh,shader,group,input)),group.remove(shader.UILPrefix),delete ShaderUIL.exists[shader.UILPrefix],ShaderUIL.add(shader,group).setLabel("Shader"),shader.hotReloading=!1),mesh.scriptClass)if(Array.isArray(mesh.scriptClass))mesh.scriptClass.every((inst,index)=>{let name=scriptClassNeedsUpdate(inst,file);return!name||(mesh.scriptClass.remove(inst),updateScriptClass(name,mesh,group,input),!1)});else{let name=scriptClassNeedsUpdate(mesh.scriptClass,file);name&&updateScriptClass(name,mesh,group,input)}})}if(UIL.global&&(mesh._sceneLayout=input._sceneLayout={meshUIL:meshUIL,mesh:mesh,input:input,name:name,get shaderUIL(){return this.mesh.shader.shaderUIL}}),_options.cmsData){let cmsGroup=_uil?createFolder(id):null,cmsInput=InputUIL.create(`Config_${id}_${_name}`,cmsGroup);cmsInput.CMS=!0,cmsInput.setLabel("Data");for(let key in _options.cmsData){let value=_options.cmsData[key];"string"==typeof value&&(key.includes("textarea")?cmsInput.addTextarea(key,value):cmsInput.add(key,value)),"number"==typeof value&&cmsInput.addNumber(key,value),"boolean"==typeof value&&cmsInput.addToggle(key,value),"object"==typeof value&&("image"==value.type&&cmsInput.addImage(key),"file"==value.type&&cmsInput.addFile(key),"range"==value.type&&cmsInput.addRange(key),"color"==value.type&&cmsInput.addColor(key))}appState.cmsInput=cmsInput,UIL.CMS_ONLY&&_uil?.add(cmsGroup)}return created=!0,returnName?name:input}async function updateGeometry(geomPath,mesh){let geom=World.PLANE;geomPath&&geomPath.includes(["World","SceneLayout"])?(geom=eval(geomPath),geomPath=null):geomPath&&(geom=await GeomThread.loadGeometry(geomPath+"?"+Utils.timestamp())),mesh.geometry=geom}async function resolveShaderRef(shaderName,layerName){let shaderLayer=shaderName.split(".shader")[0],promise=_this.getLayer(shaderLayer);Hydra.LOCAL&&(promise=Promise.race([promise,(async()=>{await _this.loadedAllLayers()})()]));let layer=await promise;if(layer){let shader=layer.shader;return shader._copied=layer,shader}Hydra.LOCAL&&console.error(`Couldnt find shader ${shaderName} for layer ${layerName} in SceneLayout ${_name}, because layer ${shaderLayer} doesn't exist`)}async function updateShader(shaderName="",mesh,group,input){let shader;shaderName.includes(".shader")&&(shader=await resolveShaderRef(shaderName,mesh.uilName),shader||(shaderName="SceneLayout")),shader||(shader=shaderName.includes("PBR")?_this.initClass(PBRShader,shaderName,{unique:`Element_${input.id}_${_name}`}):createShader(shaderName,input)),group.remove(mesh.shader.UILPrefix);for(let key in mesh.shader.uniforms){if("t"===mesh.shader.uniforms[key].type)try{mesh.shader.shaderUIL.copyTexture(key,shader)}catch(e){console.error(e)}}mesh.shader=shader,"SceneLayout"!==shaderName&&window[shaderName]&&(mesh.shaderClass=_this.initClass(window[shaderName],mesh,shader,group,input)),ShaderUIL.add(shader,group).setLabel("Shader")}function updateLighting(bool,mesh){mesh.shader.customCompile=Utils.uuid(),mesh.shader.receiveLight=bool,mesh.shader.resetProgram(),mesh.shader.upload()}function updateShadow(bool,mesh){mesh.shader.customCompile=Utils.uuid(),mesh.shader.receiveShadow=bool,mesh.shader.resetProgram(),mesh.shader.upload()}function updateBillboard(bool,mesh){bool?(mesh._billboardLoop=_=>Utils3D.billboard(mesh),_this.startRender(mesh._billboardLoop)):(mesh.rotation.set(0,0,0),_this.stopRender(mesh._billboardLoop))}function updateScriptClass(scriptClass,mesh,group,input){scriptClass&&(scriptClass.includes(",")?(scriptClass=scriptClass.replace(/ /g,"").split(",")).forEach(script=>{window[script]?(mesh.scriptClass=mesh.scriptClass||[],mesh.scriptClass.push(_this.initClass(window[script],mesh,mesh.shader,group,input))):console.warn(`scriptClass ${script} not found`)}):window[scriptClass]?mesh.scriptClass=_this.initClass(window[scriptClass],mesh,mesh.shader,group,input):console.warn(`scriptClass ${scriptClass} not found`))}function addListeners(){_this.events.sub(SceneLayout.BREAKPOINT,e=>_this.localBreakpoint?null:setBreakpoint(e))}function setBreakpoint({value:value}){value!=_breakpoint&&(_breakpoint=value,_breakpoints.forEach(mesh=>{if(!mesh.prefix)return;mesh.prefix=mesh.prefix.split("-")[0]+"-"+_breakpoint,"-"==mesh.prefix.charAt(mesh.prefix.length-1)&&(mesh.prefix=mesh.prefix.slice(0,-1));let meshUIL=new MeshUILConfig(mesh);UIL.global&&(mesh._meshUIL=meshUIL)}))}async function ready(){await _this.wait(_this,"loaded"),UIL.sidebar&&UIL.sidebar.toolbar.hideAll()}function copyFolderProps(from,to){let mesh,params,shader;to.forEachFolder(child=>{switch(child.label){case"Parameters":params=child;break;case"Mesh":mesh=child;break;case"Shader":shader=child}});let allowed=["Parameters","Mesh","Shader"];from.forEachFolder(child=>{if(!(allowed.indexOf(child.label)<0))switch(child.toClipboard(),child.label){case"Parameters":params.fromClipboard();break;case"Mesh":mesh.fromClipboard();break;case"Shader":shader.fromClipboard()}})}this.isSceneLayout=!0,this.name=_name,async function(){window.Physics&&(_options.physics=!0),_this.group.sceneLayout=_this,initialize(_this.wait("loaded")),await initialize(defer()),SceneLayout.getTexture||(SceneLayout.getTexture=Utils3D.getTexture),initGraph(),initParams(),initialize(initConfig()),initData(),addListeners(),ready(),UIL?.loaded&&initGizmo()}(),this.ready=async function(early){if(await _this.wait(_this,"loaded"),await _this.wait(_this,"configured"),early)return!0;await defer(),await defer()},this.getLayer=async function(name){let timer;return Hydra.LOCAL&&(timer=_this.delayedCall(_=>{_exists[name]||console.warn(`${name} doesn't exist in SceneLayout ${_name}`)},1e3)),await _this.wait(_layers,name),timer&&clearTimeout(timer),_layers[name]},this.getLayers=async function(){let array=[];for(let i=0;i<arguments.length;i++)array.push(_this.getLayer(arguments[i]));return Promise.all(array)},this.getAllLayers=async function(){return await this.ready(),await this.loadedAllLayers(),_layers},this.getAllMatching=async function(label){let layers=await _this.getAllLayers(),array=[];for(let key in layers)key.includes(label)&&(layers[key].layerName=key,array.push(layers[key]));return array},this.exists=function(name){return _exists[name]},this._createLayer=function(parentId,returnName=!1){return createLayer(null,parentId,returnName)},this._createGroup=function(){return getGroup(`group_${_groupIndex}`),_groupIndex},this._deleteGroup=function(){},this._getGroup=function(name,index){return getGroup(name,index)},this._rename=function(id,name,value){let folder=_folders[id]||_folders[`sl_${_name}_${id}`];folder&&(folder.setLabel(value),folder.params&&folder.params.setValue("name",value),[_groups,_custom,_meshes,_exists,_layers].forEach(function(store){store[name]&&(store[value]=store[name],store[name]=null,delete store[name])}))},this._deleteLayer=function(id,name,coded){id.includes("_")&&(id=(id=id.split("_"))[id.length-1]);let folder=_folders[id]||_folders[`sl_${_name}_${id}`],layer=_layers[id]||_layers[name];return layer&&layer.isGroup&&layer.length>1?(alert("Can't delete a group that has nested layers."),!1):!(!coded&&!confirm("Are you sure you want to delete this layer?"))&&(layer&&layer._parent&&(layer._parent.remove(layer),layer._parent=null),folder&&folder.parent&&folder.parent.remove(folder),UILStorage.set(`sl_${_name}_${id}_deleted`,!0),!0)},this._changeParent=function(childId,childName,parentId,parentName){let child=_layers[childId]||_layers[childName],parent=_layers[parentId]||_layers[parentName]||_this;if(!child)return;let folder=_folders[childId]||_folders[`sl_${_name}_${childName}`];folder&&folder.params&&folder.params.setValue("group",parentName||null);let parentObject=parent.group||parent,childObject=child.group||child;parentObject.isObject3D&&childObject.isObject3D&&parentObject.add(childObject),child.updateMatrix&&child.updateMatrix()},this._visible=function(name,visible){let mesh=_layers[name];mesh&&(mesh.group&&(mesh=mesh.group),mesh.visible=visible)},this._focus=function(name){UIL.sidebar.toolbar.filterSingle(name)},this._blur=function(name){let folder=_folders[name]||_folders[`sl_${_name}_${name}`];folder&&folder.forEachFolder&&(folder.forEachFolder(f=>f.close()),folder.close())},this._sort=function(order){order.forEach((label,index)=>{label.children&&label.children.forEach(function(child,j,all){let folder=_folders[child];if(!folder||!folder.params)return;let renderOrder=_this.baseRenderOrder+index+(j+1)/(all.length+1);folder.params.setValue("renderOrder",renderOrder-_this.baseRenderOrder);let mesh=_layers[child]||_layers[folder.label];mesh&&(mesh.renderOrder=renderOrder)});let folder=_folders[label];if(!folder||!folder.params)return;let renderOrder=_this.baseRenderOrder+index;folder.params.setValue("renderOrder",renderOrder-_this.baseRenderOrder);let mesh=_layers[label]||_layers[folder.label];mesh&&(mesh.renderOrder=renderOrder)})},this._duplicateLayer=function(id,parentId){let folder=_folders[id]||_folders[`sl_${_name}_${id}`];if(!folder)return;createLayer(null,parentId);let copyShader,copy=Object.values(_folders).last();folder.forEachControl(input=>{"shader"===input.label&&(copyShader=input.value)}),copyShader&&(console.log(copyShader),copy.forEachControl(input=>{"shader"===input.label&&input.force(copyShader)})),copyFolderProps(folder,copy)},this._duplicateGroup=function(id,children){let folder=_folders[id]||_folders[`sl_${_name}_${id}`];if(!folder)return;let copyId=`group_${_groupIndex+1}`;getGroup(copyId),copyFolderProps(folder,Object.values(_folders).last()),children.forEach(childId=>{_this._duplicateLayer(childId,copyId)})},this._getCinemaConfig=async function(){let _cinemaConfig=_config.get("Cinema Config").replace(".json","");return await get(Assets.getPath(`assets/geometry/${_cinemaConfig}.json`))},this._applyCinemaConfig=function(id,params){let folder=_folders[id]||_folders[`sl_${_name}_${id}`];if(!folder)return;let mesh=folder.getAll().filter(sub=>"Mesh"==sub.label)[0];if(params.geometry&&folder.params.setValue("geometry",params.geometry.replace("assets/geometry/","")),["position","quaternion","scale"].forEach(transform=>{if(params[transform]){let value=JSON.parse(params[transform]);if("quaternion"==transform){let quat=(new Quaternion).fromArray(value);value=(new Euler).setFromQuaternion(quat).toArray().slice(0,3).map(angle=>180*angle/Math.PI),transform="rotation"}mesh.getAll().filter(control=>control.label==transform)[0].force(value)}}),params.visible&&"false"===params.visible&&!params.geometry&&(folder.params.setValue("geometry","World.PLANE"),folder.params.setValue("side","shader_double_side"),!Global.PLAYGROUND)){_meshes[folder.params.get("name")].shader.neverRender=!0}params.shader&&folder.params.setValue("shader",params.shader)},this.loadedAllLayers=async function(){return await _this.ready(),_promisesAllSettled},this.set("breakpoint",value=>{_this.localBreakpoint=!0,setBreakpoint({value:value})}),this.get("breakpoint",_=>_breakpoint),this.get("layers",_=>_layers),this.get("layerCount",_=>_data.layers),this.onDestroy=function(){_graph?.destroy?.(),_stateData?.destroySceneLayout?.(_name,_this);for(let key in _layers){let layer=_layers[key];layer.destroy?.()}_layers=null,_initializers.length=0,_breakpoints.length=0,_this.textures&&!_options.persistTextures&&_this.textures.forEach(t=>{t.destroy&&t.destroy()}),_this._onDestroy&&_this._onDestroy()},this.addInitializer=function(callback){_initializers.push(callback)},this._completeInitialization=async function(sync){if(!_initializers.length)return!0;for(let i=0;i<_initializers.length;i++)await _initializers[i](sync);_initializers.length=0}},_=>{SceneLayout.BREAKPOINT="sl_breakpoint",SceneLayout.HOTLOAD_GEOMETRY="sl_hotload_geom",SceneLayout.HOTLOAD_SCRIPT="sl_hotload_script",SceneLayout.setBreakpoint=function(value){SceneLayout.breakpoint!==value&&(SceneLayout.breakpoint=value,Events.emitter._fireEvent(SceneLayout.BREAKPOINT,{value:value}))}}),Class(function SceneLayoutGizmo(){Inherit(this,Object3D);const _this=this;var _controls,_update,_attached,_lastVal,_shouldBeVisible=!1;function findCamera(){let camera=World.CAMERA,p=_this.group._parent;for(;p;)p instanceof Scene&&p.nuke&&(camera=p.nuke.camera),p=p._parent;return camera}function update(){if(!_controls.visible)return clearInterval(_update),void(_update=null);let uil=_attached._cameraUIL||_attached._meshUIL,key="translate"==_controls.getMode()?"position":"scale",value=_attached[key].toArray();(function same(a,b){return!(!a||!b||Math.abs(a[0]-b[0])>Base3D.DIRTY_EPSILON||Math.abs(a[1]-b[1])>Base3D.DIRTY_EPSILON||Math.abs(a[2]-b[2])>Base3D.DIRTY_EPSILON)})(value,_lastVal)||(_lastVal=value,_attached._cameraUIL&&"position"==key&&(key="groupPos"),uil?.[`forceUpdate${key.toUpperCase()}`]?.(value))}function handleVisibility(bool){_controls.visible=!!bool&&_shouldBeVisible}function startMoving(){_controls.visible&&(_update=setInterval(update,250))}function stopMoving(){clearInterval(_update),_update=null,update()}function keyDown(e){document.activeElement.tagName.toLowerCase().includes(["textarea","input"])||("."==e.key&&_controls.setMode("translate"),"/"==e.key&&_controls.setMode("scale"))}function playgroundEvent(camera){camera||(_controls.visible=!1,camera=findCamera()),_controls.camera=camera}async function nodeFocused(e){if(_controls.visible=!1,"Config"!=e.name&&(_shouldBeVisible=!1,e.layoutInstance==_this.parent)){let layer=await _this.parent.getLayer(e.name),group=layer.group||layer;if(!group||!group.updateMatrixWorld)return;_controls.attach(group),_attached=group,_controls.visible=!!AppState.get("SceneLayoutGizmo/visible"),_shouldBeVisible=!0}}this.isGizmo=!0,(_controls=new TransformControls(findCamera(),World.ELEMENT.div)).onChange=_controls.onMouseDown=_controls.onMouseUp=_controls.onObjectChange=e=>{},_controls.onMouseDown=startMoving,_controls.onMouseUp=stopMoving,_controls.draggingChanged=e=>{let activeControls=Playground.instance().activeControls;activeControls&&(activeControls.enabled=!e.value)},_controls.visible=!1,_this.group.add(_controls),AppState.bind("playground_camera_active",playgroundEvent),AppState.bind("SceneLayoutGizmo/visible",handleVisibility),function addListeners(){_this.events.sub(Keyboard.DOWN,keyDown),_this.events.sub(UILGraphNode.FOCUSED,nodeFocused)}(),_this.delayedCall(_=>{_controls.camera=findCamera()},500),_this.group.traverse(obj=>{obj.isGizmo=!0})},_=>{let toggled=!1;Hydra.ready().then(_=>{Events.emitter._addEvent(Keyboard.PRESS,e=>{103!=e.keyCode&&"="!==e.key&&"+"!==e.key||(toggled=!toggled,AppState.set("SceneLayoutGizmo/visible",toggled))})})}),Class(function SceneLayoutPreloader(_name){Inherit(this,Component);function findMatch(src,arr){return!(!src||src.startsWith("."))&&((src=src.trim()).startsWith("/")&&(src=src.slice(1)),arr.find(({filename:filename})=>filename.includes(src)))}this.load=function(name){let promise=Promise.create(),array=[],keys=UILStorage.getKeys(),i=0,worker=new Render.Worker(_=>{let key=keys[i];if(!key)return worker.stop(),void Promise.all(array).then(promise.resolve);if(key.includes(name)){let val=UILStorage.get(key);if(!val||!val.includes)return i++;if(key.includes("geometry")&&("{"==val.charAt(0)&&(val=JSON.parse(val).src),val.includes(".json")||val.includes(".bin")||(val+=".json"),val.includes("assets/")||(val="assets/geometry/"+val),findMatch(val.split("assets/geometry/")[1],UIL_ASSETS_GEOMETRIES)&&array.push(GeomThread.loadGeometry(Assets.getPath(val),null,!0))),val.includes(".json")||val.includes(".bin"))val.includes("assets/")||(val="assets/geometry/"+val),findMatch(val.split("assets/geometry/")[1],UIL_ASSETS_GEOMETRIES)&&array.push(fetch(Assets.getPath(val)).catch(e=>{}));else if(val.includes("src")){let obj=JSON.parse(val),src=obj.src;if(obj.compressed)if("ktx2"===obj.compressed){let src0=src.split(".")[0];src=src0+".ktx2"}else{let ext,src0=src.split(".")[0],src1=src0.split("/");ext=Renderer.extensions.etc1?"astc":Renderer.extensions.pvrtc?"pvrtc":Renderer.extensions.astc?"astc":"dxt",src=src0+"/"+src1[src1.length-1]+"-"+ext+".ktx"}findMatch(src.split("assets/images/")[1],UIL_ASSETS_TEXTURES)&&array.push(fetch(Assets.getPath(src)).catch(e=>{}))}}i++},1);return promise}},"static"),Class(function UILGroupBridge(){Inherit(this,Component);const _this=this;var _map=new Map;function Bridge(name){let store=InputUIL.create(`scenelayout_${name}`,null),data=JSON.parse(store.get("data")||"{}");void 0===data.layers&&(data.layers=-1),void 0===data.groups&&(data.groups=-1);var _healedGroups,_healedMap,_name=name;this.all=new StateArray,this.layers=new StateArray,this.groups=new StateArray;const $this=this;async function bindChanges(obj,key){await _this.wait($this,"sceneLayout"),$this.sceneLayout.bindState(obj,"name",name=>{UILStorage.set(`${key}_name`,name)}),$this.sceneLayout.bindState(obj,"sortIndex",index=>{UILStorage.set(`${key}_sortIndex`,index)}),$this.sceneLayout.bindState(obj,"parent",parent=>{UILStorage.set(`${key}_parent`,parent)})}function run(){data.groups=Math.max(data.groups,Number(UILStorage.get(`groupBridge_${name}_groups`))-1||-1);let healedGroups=_healedGroups=Number(UILStorage.get(`groupBridge_${name}healGroups`));healedGroups>0&&(_healedMap={});for(let i=0,c=data.layers+1;i<c;i++){let obj=AppState.createLocal(),key=`INPUT_Config_${i}_${name}`;obj.deleted=UILStorage.get(`sl_${name}_${i}_deleted`),obj.visible=!0,obj.parent=UILStorage.get(`${key}_parent`),obj.name=UILStorage.get(`${key}_name`)||"layer_"+i,obj.id=`sl_${name}_${i}`,obj.sortIndex=Number(UILStorage.get(`${key}_sortIndex`)),isNaN(obj.sortIndex)&&(obj.sortIndex=$this.all.length),$this.layers.push(obj),obj.deleted||$this.all.push(obj),obj.type="layer",bindChanges(obj,key),this.onChange?.()}this.groups=new StateArray;for(let i=0,c=data.groups+1;i<c;i++){if(healedGroups>0&&i<healedGroups)continue;let obj=AppState.createLocal(),key=`GROUP_${name}_group_${i}`;obj.visible=!0,obj.children=new StateArray,obj.id=`sl_${name}_group_${i}`,obj.deleted=UILStorage.get(`groupBridge_${obj.id}_deleted`),obj.name=UILStorage.get(`${key}_name`)||"group_"+i,obj.sortIndex=Number(UILStorage.get(`${key}_sortIndex`)),isNaN(obj.sortIndex)&&(obj.sortIndex=$this.all.length),$this.groups.push(obj),obj.type="group",_this.wait($this,"sceneLayout").then(_=>{$this.sceneLayout._getGroup("group_"+i,healedGroups>0?i:void 0)}),_healedMap&&(_healedMap[i]=obj),obj.deleted||$this.all.push(obj),bindChanges(obj,key)}$this.all.sort((a,b)=>a.sortIndex-b.sortIndex)}run(),this.createGroup=async function(){let obj=AppState.createLocal();obj.deleted=!1,obj.visible=!0,obj.type="group",obj.children=new StateArray,obj.sortIndex=this.all.length,this.groups.push(obj),this.all.push(obj);let prevCount=Number(UILStorage.get(`groupBridge_${name}_groups`))||0;UILStorage.set(`groupBridge_${name}_groups`,prevCount+1),_healedGroups>0?(prevCount+=_healedGroups,this.sceneLayout._getGroup("group_"+prevCount,prevCount),_healedMap[prevCount]=obj):this.sceneLayout._createGroup(),obj.name="group_"+prevCount,obj.id=`sl_${name}_group_${prevCount}`},this.syncGroup=function(index,name){let obj=AppState.createLocal();return obj.deleted=!1,obj.visible=!0,obj.type="group",obj.children=new StateArray,obj.sortIndex=this.all.length,this.groups.push(obj),this.all.push(obj),obj.name=name,obj.id=`sl_${_name}_${name}`,obj},this.getGroup=function(index){return _healedMap?_healedMap[index]:this.groups[index]},this.healGroups=function(index){Number(UILStorage.get(`groupBridge_${name}healGroups`))>0||UILStorage.set(`groupBridge_${name}healGroups`,index)},this.createLayer=async function(parent){let obj=AppState.createLocal(),key=`INPUT_Config_${this.layers.length}_${name}`;obj.deleted=!1,obj.visible=!0,obj.parent=parent,obj.name="layer_"+this.layers.length,obj.type="layer",obj.id=`sl_${name}_${this.layers.length}`,obj.sortIndex=this.all.length,this.layers.push(obj),this.all.push(obj);let layer=await this.sceneLayout._createLayer();obj.name=layer.get("name")||obj.name,bindChanges(obj,key),this.onChange?.()},this.sync=function(){this.all.refresh([]),this.layers.refresh([]),this.groups.refresh([]),run()},this.deleteNode=function(obj){return obj.children?.length?alert("You can't delete a group with children"):confirm("Are you sure you want to delete this layer?")?(obj.deleted=!0,this.all.remove(obj),"layer"==obj.type&&this.sceneLayout._deleteLayer(obj.id,obj.name,!0),"group"==obj.type&&(this.sceneLayout._deleteGroup(obj.id,obj.name,!0),UILStorage.set(`groupBridge_${obj.id}_deleted`,!0)),!0):void 0},this.calculateRenderFraction=async function(index){let parent,obj=this.layers[index];if(this.groups.forEach(node=>{node.id.includes(obj.parent)&&(parent=node)}),!parent)return[0,0];let fraction=parent.children.indexOf(obj)/(parent.children.length-1)*.99;return isNaN(fraction)?(await _this.wait(50),this.calculateRenderFraction(index)):[fraction,parent.sortIndex]},this.destroySceneLayout=async function(name,layout){layout&&(_map.delete(layout),_map.get(name)===this&&_map.delete(name))}}this.createSceneLayout=this.create=async function(name,layout){if(layout||await _this.wait(_=>_map.has(name)),layout&&!_map.has(layout)){let bridge=new Bridge(name);_map.set(layout,bridge),_map.has(name)||_map.set(name,bridge),bridge.sceneLayout=layout}return layout?_map.get(layout):_map.get(name)}},"static"),Class(function Scroll(_object,_params){Inherit(this,Component);const _this=this,PROHIBITED_ELEMENTS=["prevent_interactionScroll"];this.x=0,this.y=0,this.max={x:0,y:0},this.delta={x:0,y:0},this.enabled=!0,_this.bounds=null;const _scrollTarget={x:0,y:0},_scrollInertia={x:0,y:0};let _axes=["x","y"];var _lastDelta,_deltaChange=0;function checkIfProhibited(element){let el=element;for(;el;){if(el.classList)for(let i=0;i<PROHIBITED_ELEMENTS.length;i++)if(el.classList.contains(PROHIBITED_ELEMENTS[i]))return!0;el=el.parentNode}return!1}function loop(){_this.object&&(Math.round(_this.object.div.scrollLeft)===Math.round(_this.x)&&Math.round(_this.object.div.scrollTop)===Math.round(_this.y)||(_this.x=_scrollTarget.x=_this.object.div.scrollLeft,_this.y=_scrollTarget.y=_this.object.div.scrollTop,stopInertia())),_axes.forEach(axis=>{_this.isInertia&&(_scrollInertia[axis]*=.9,_scrollTarget[axis]+=_scrollInertia[axis]);let scale=_this.scale;Device.mobile&&(scale=_this.touchScale),_this.limit&&(_scrollTarget[axis]=Math.max(_scrollTarget[axis],0)),_this.limit&&(_scrollTarget[axis]=Math.min(_scrollTarget[axis],_this.max[axis]/scale)),_this.delta[axis]=_this.flag("block")?0:.5*(_scrollTarget[axis]*scale-_this[axis]),_this[axis]+=_this.delta[axis],Math.abs(_this.delta[axis])<.01&&(_this.delta[axis]=0),Math.abs(_this[axis])<.001&&(_this[axis]=0),_this.flag("block")&&(_scrollTarget[axis]=0,_this.delta[axis]=0,_this[axis]=0),_this.object&&("x"==axis&&(_this.object.div.scrollLeft=Math.round(_this.x)),"y"==axis&&(_this.object.div.scrollTop=Math.round(_this.y)))})}function stopInertia(){_this.isInertia=!1,clearTween(_scrollTarget)}function edgeScroll(e){let element=document.elementFromPoint(Math.clamp(Mouse.x,0,Stage.width),Math.clamp(Mouse.y,0,Stage.height));element&&checkIfProhibited(element)||_params.lockMouseX&&Mouse.x>Stage.width||"touch"===e.pointerType&&_this.enabled&&(e.preventDefault&&e.preventDefault(),_axes.forEach(axis=>{let dir=axis.toUpperCase(),delta=`offset${dir}`,diff=(_this[`ieDelta${dir}`]||e[delta])-e[delta];_scrollTarget[axis]+=diff,_scrollInertia[axis]=diff,_this.isInertia=!0,_this[`ieDelta${dir}`]=e[delta]}),_this.onUpdate&&_this.onUpdate(),_this.events.fire(Events.UPDATE,_scrollInertia))}function edgeScrollEnd(){_this.ieDeltaX=!1,_this.ieDeltaY=!1}function scroll(e){let element=document.elementFromPoint(Math.clamp(Mouse.x,0,Stage.width),Math.clamp(Mouse.y,0,Stage.height));if(element&&checkIfProhibited(element))return;if(_params.lockMouseX&&Mouse.x>Stage.width)return;if(!_this.enabled)return;if(!checkBounds(e))return;if(_this.object&&_this.limit&&e.preventDefault&&e.preventDefault(),!_this.mouseWheel)return;stopInertia();let newDelta=0;_axes.forEach(axis=>{let delta="delta"+axis.toUpperCase();if("mac"==Device.system.os){if("firefox"==Device.system.browser)return 1===e.deltaMode?(_scrollTarget[axis]+=4*e[delta],_scrollInertia[axis]=4*e[delta],_this.isInertia=!0,void(newDelta=_scrollInertia[axis])):void(_scrollTarget[axis]+=e[delta]);if(Device.system.browser.includes(["chrome","safari"]))return _scrollTarget[axis]+=.33*e[delta],_scrollInertia[axis]=.33*e[delta],_this.isInertia=!0,void(newDelta=_scrollInertia[axis])}if("windows"==Device.system.os){if("firefox"==Device.system.browser&&1===e.deltaMode)return _scrollTarget[axis]+=10*e[delta],_scrollInertia[axis]=10*e[delta],_this.isInertia=!0,void(newDelta=_scrollInertia[axis]);if(Device.system.browser.includes(["chrome"])){let s=.25;return _scrollTarget[axis]+=e[delta]*s,_scrollInertia[axis]=e[delta]*s,_this.isInertia=!0,void(newDelta=_scrollInertia[axis])}if("ie"==Device.system.browser)return _scrollTarget[axis]+=e[delta],_scrollInertia[axis]=e[delta],_this.isInertia=!0,void(newDelta=_scrollInertia[axis])}_scrollTarget[axis]+=e[delta],newDelta=_scrollInertia[axis]}),newDelta=Math.abs(newDelta),newDelta!=_lastDelta&&_deltaChange++,_this.flag("hardBlock")||(_deltaChange>3?newDelta>_lastDelta&&_this.flag("block",!1):newDelta>=_lastDelta&&_this.flag("block",!1)),_lastDelta=newDelta,_this.onUpdate&&_this.onUpdate(),_this.events.fire(Events.UPDATE,_scrollInertia),_this.events.fire(Scroll.EVENT,e)}function down(e){if(!_this.enabled)return;if(!checkBounds(e))return;let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));element&&checkIfProhibited(element)||(stopInertia(),_this.isDragging=!0)}function drag(e){if(!_this.enabled)return;if(!checkBounds(e))return;let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));element&&checkIfProhibited(element)||(_axes.forEach(axis=>{let newDelta=Math.abs(Mouse.delta[axis]);_this.flag("hardBlock")||newDelta>_lastDelta&&_this.flag("block",!1),_lastDelta=newDelta,_scrollTarget[axis]-=Mouse.delta[axis]}),_this.events.fire(Events.UPDATE))}function up(e){if(!_this.enabled||_this.preventInertia)return;if(!checkBounds(e))return;let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));if(element&&checkIfProhibited(element))return;const m="android"==Device.system.os?35:25,obj={};_axes.forEach(axis=>{obj[axis]=_scrollTarget[axis]-Mouse.delta[axis]*m}),tween(_scrollTarget,obj,2500,"easeOutQuint"),_this.isDragging=!1}function onKeyDown({key:key,shiftKey:shiftKey}){let dst=null;switch(key){case"Up":case"ArrowUp":dst=_scrollTarget.y-150;break;case"Down":case"ArrowDown":dst=_scrollTarget.y+150;break;case"Home":dst=0;break;case"End":dst=_this.max.y;break;case"PageUp":dst=_scrollTarget.y-Stage.height;break;case"PageDown":dst=_scrollTarget.y+Stage.height;break;case" ":case"Spacebar":onKeyDown(shiftKey?{key:"PageUp"}:{key:"PageDown"})}null!==dst&&_this.scrollTo(dst,"y",400,"easeOutCubic")}function resize(){if(!_this.enabled)return;if(stopInertia(),!_this.object)return;const p={};Device.mobile&&_axes.forEach(axis=>p[axis]=_this.max[axis]?_scrollTarget[axis]/_this.max[axis]:0),void 0===_params.height&&(_this.max.y=_this.object.div.scrollHeight-_this.object.div.clientHeight),void 0===_params.width&&(_this.max.x=_this.object.div.scrollWidth-_this.object.div.clientWidth),Device.mobile&&_axes.forEach(axis=>_this[axis]=_scrollTarget[axis]=p[axis]*_this.max[axis])}function checkBounds(e){return!_this.bounds||!(e.x/Stage.width>_this.bounds.x.y||e.x/Stage.width<_this.bounds.x.x||e.y/Stage.height>_this.bounds.y.y||e.y/Stage.height<_this.bounds.y.x)}!function initParams(){_object&&_object.div||(_params=_object,_object=null),_params||(_params={}),_this.object=_object,_this.hitObject=_params.hitObject||_this.object,_this.max.y=_params.height||0,_this.max.x=_params.width||0,_this.scale=_params.scale||1,_this.touchScale=_params.touchScale||1,_this.isDragging=!1,_this.drag=void 0!==_params.drag?_params.drag:!!Device.mobile,_this.mouseWheel=!1!==_params.mouseWheel,_this.limit="boolean"==typeof _params.limit&&_params.limit,_this.bounds=_params.bounds||null,_this.keyboard=_params.keyboard||!1,Array.isArray(_params.axes)&&(_axes=_params.axes)}(),_this.object&&function style(){_this.object.css({overflow:"auto"})}(),function addHandlers(){if(Device.mobile||("ie"===Device.system.browser&&Device.system.browserVersion>=17&&(document.body.addEventListener("pointermove",edgeScroll,!0),document.body.addEventListener("pointerup",edgeScrollEnd,!0)),"ie"==Device.system.browser?document.body.addEventListener("wheel",scroll,!0):__window.bind("wheel",scroll),_this.keyboard&&_this.events.sub(Keyboard.DOWN,onKeyDown)),_this.drag){_this.hitObject&&_this.hitObject.bind("touchstart",e=>{let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));element&&checkIfProhibited(element)||e.preventDefault()});let input=_this.hitObject?_this.initClass(Interaction,_this.hitObject):Mouse.input;_this.events.sub(input,Interaction.START,down),_this.events.sub(input,Interaction.DRAG,drag),_this.events.sub(input,Interaction.END,up)}_this.events.sub(Events.RESIZE,resize)}(),resize(),_this.startRender(loop),this.reset=function(){return _this.object&&_this.object.div&&(_this.object.div.scrollLeft=_this.x=0,_this.object.div.scrollTop=_this.y=0),_scrollTarget.x=_scrollTarget.y=0,_scrollInertia.x=_scrollInertia.y=0,stopInertia(),this},this.onDestroy=function(){__window.unbind("wheel",scroll),_this.events.unsub(Keyboard.DOWN,onKeyDown)},this.resize=resize,this.scrollTo=function(value,axis="y",time=800,ease="easeInOutCubic"){let values={};values[axis]=value,tween(_scrollTarget,values,time,ease)},this.setTarget=function(value,axis="y"){_scrollTarget[axis]=value},this.blockUntilNewScroll=function(){return _this.reset(),_this.flag("block",!0),_this.flag("hardBlock",!0,200),this},this.stopInertia=stopInertia},_=>{var _scroll;Scroll.EVENT="scroll_event",Scroll.createUnlimited=Scroll.getUnlimited=function(options){return _scroll||(_scroll=new Scroll({limit:!1,drag:Device.mobile})),_scroll}}),Class(function Shaders(){Inherit(this,Component);var _this=this,_dependencies,_shaderNames;function parseSingleShader(code,fileName){let uniforms=code.split("#!UNIFORMS")[1].split("#!")[0],varyings=code.split("#!VARYINGS")[1].split("#!")[0],attributes=code.split("#!ATTRIBUTES")[1].split("#!")[0];for(;code.includes("#!SHADER");){let split=(code=code.slice(code.indexOf("#!SHADER"))).split("#!SHADER")[1],br=split.indexOf("\n"),name=getShaderName(split.slice(0,br),fileName),glsl=split.slice(br);glsl=name.includes(".vs")?attributes+uniforms+varyings+glsl:uniforms+varyings+glsl,_this[name]=glsl,_shaderNames&&name!==fileName&&(_shaderNames[fileName]=_shaderNames[fileName]||[],_shaderNames[fileName].push(name)),code=code.replace("#!SHADER","$")}}function parseCompiled(shaders){var split=shaders.split("{@}");split.shift();for(var i=0;i<split.length;i+=2){var name=split[i],text=split[i+1];text.includes("#!UNIFORMS")?parseSingleShader(text,name):_this[name]=text}}function parseRequirements(){for(var key in _this){var obj=_this[key];"string"==typeof obj&&(_this[key]=require(obj,key))}}function require(shader,key){if(!shader.includes("require"))return shader;for(shader=shader.replace(/# require/g,"#require");shader.includes("#require");){var name=shader.split("#require(")[1].split(")")[0];if(name=name.replace(/ /g,""),!_this[name])throw"Shader required "+name+", but not found in compiled shaders.\n"+shader;_dependencies&&(_dependencies[name]||(_dependencies[name]=[]),_dependencies[name].includes(key)||_dependencies[name].push(key)),shader=shader.replace("#require("+name+")",_this[name])}return shader}function getShaderName(shaderLine,fileName){let name=shaderLine.split(": ")[1];name.slice(0,6).includes("Vertex")&&(name=fileName.split(".")[0]+".vs"),name.slice(0,8).includes("Fragment")&&(name=fileName.split(".")[0]+".fs");let splitName=name.split(".");return splitName[0]+(splitName[1].includes("vs")?".vs":".fs")}Hydra.LOCAL&&(_dependencies={},_shaderNames={}),this.get("dependencies",_=>_dependencies),this.parse=function(code,file){code.includes("{@}")?(parseCompiled(code),parseRequirements()):(file=(file=file.split("/"))[file.length-1],_this[file]=code),_this.shadersParsed=!0},this.parseSingle=parseSingleShader,this.onReady=this.ready=function(callback){let promise=Promise.create();return callback&&promise.then(callback),_this.wait(()=>promise.resolve(),_this,"shadersParsed"),promise},this.getShader=function(string){_this.FALLBACKS&&_this.FALLBACKS[string]&&(string=_this.FALLBACKS[string]);var code=_this[string];if(!code)throw`No shader ${string} found`;for(;code.includes("#test ");)try{var test=code.split("#test ")[1],name=test.split("\n")[0],glsl=code.split("#test "+name+"\n")[1].split("#endtest")[0];eval(name)||(code=code.replace(glsl,"")),code=code.replace("#test "+name+"\n",""),code=code.replace("#endtest","")}catch(e){throw"Error parsing test :: "+string}return code},this.hasShader=function(string){return!(!_this.FALLBACKS?.[string]&&!_this[string])},this.getShaderNames=function getShaderNames(fileName){return _shaderNames[fileName]}},"static");class CubicBezierCurve2D extends Curve3D{constructor(v0,v1,v2,v3){super(),this.type="CubicBezierCurve",this.v0=v0||new Vector2,this.v1=v1||new Vector2,this.v2=v2||new Vector2,this.v3=v3||new Vector2,this.isCubicBezierCurve=!0}getPoint(t,optionalTarget){var point=optionalTarget||new Vector2,v0=this.v0,v1=this.v1,v2=this.v2,v3=this.v3;const{CubicBezier:CubicBezier}=require("Shape2DInterpolations");return point.set(CubicBezier(t,v0.x,v1.x,v2.x,v3.x),CubicBezier(t,v0.y,v1.y,v2.y,v3.y)),point}copy(source){return Curve3D.prototype.copy.call(this,source),this.v0.copy(source.v0),this.v1.copy(source.v1),this.v2.copy(source.v2),this.v3.copy(source.v3),this}let(){var data=Curve3D.prototype.let.call(this);return data.v0=this.v0.toArray(),data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data.v3=this.v3.toArray(),data}fromJSON(json){return Curve.prototype.fromJSON.call(this,json),this.v0.fromArray(json.v0),this.v1.fromArray(json.v1),this.v2.fromArray(json.v2),this.v3.fromArray(json.v3),this}}class EllipseCurve extends Base3D{constructor(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){super(),this.type="EllipseCurve",this.aX=aX||0,this.aY=aY||0,this.xRadius=xRadius||1,this.yRadius=yRadius||1,this.aStartAngle=aStartAngle||0,this.aEndAngle=aEndAngle||2*Math.PI,this.aClockwise=aClockwise||!1,this.aRotation=aRotation||0,this.isEllipseCurve=!0}getPoint(t,optionalTarget){let point=optionalTarget||new Vector2,twoPi=2*Math.PI,deltaAngle=this.aEndAngle-this.aStartAngle,samePoints=Math.abs(deltaAngle)<Number.EPSILON;for(;deltaAngle<0;)deltaAngle+=twoPi;for(;deltaAngle>twoPi;)deltaAngle-=twoPi;deltaAngle<Number.EPSILON&&(deltaAngle=samePoints?0:twoPi),!0!==this.aClockwise||samePoints||(deltaAngle===twoPi?deltaAngle=-twoPi:deltaAngle-=twoPi);let angle=this.aStartAngle+t*deltaAngle,x=this.aX+this.xRadius*Math.cos(angle),y=this.aY+this.yRadius*Math.sin(angle);if(0!==this.aRotation){let cos=Math.cos(this.aRotation),sin=Math.sin(this.aRotation),tx=x-this.aX,ty=y-this.aY;x=tx*cos-ty*sin+this.aX,y=tx*sin+ty*cos+this.aY}return point.set(x,y)}copy(){return Curve3D.prototype.copy.call(this,source),this.aX=source.aX,this.aY=source.aY,this.xRadius=source.xRadius,this.yRadius=source.yRadius,this.aStartAngle=source.aStartAngle,this.aEndAngle=source.aEndAngle,this.aClockwise=source.aClockwise,this.aRotation=source.aRotation,this}toJSON(){let data=Curve3D.prototype.toJSON.call(this);return data.aX=this.aX,data.aY=this.aY,data.xRadius=this.xRadius,data.yRadius=this.yRadius,data.aStartAngle=this.aStartAngle,data.aEndAngle=this.aEndAngle,data.aClockwise=this.aClockwise,data.aRotation=this.aRotation,data}fromJSON(){return Curve3D.prototype.fromJSON.call(this,json),this.aX=json.aX,this.aY=json.aY,this.xRadius=json.xRadius,this.yRadius=json.yRadius,this.aStartAngle=json.aStartAngle,this.aEndAngle=json.aEndAngle,this.aClockwise=json.aClockwise,this.aRotation=json.aRotation,this}}class LineCurve extends Curve3D{constructor(v1,v2){super(),this.type="LineCurve",this.v1=v1||new Vector3,this.v2=v2||new Vector3,this.isLineCurve=!0}getPoint(t,optionalTarget){var point=optionalTarget||new Vector3;return 1===t?point.copy(this.v2):(point.copy(this.v2).sub(this.v1),point.multiplyScalar(t).add(this.v1)),point}getPointAt(u,optionalTarget){return this.getPoint(u,optionalTarget)}getTangent(){return this.v2.clone().sub(this.v1).normalize()}copy(source){return Curve3D.prototype.copy.call(this,source),this.v1.copy(source.v1),this.v2.copy(source.v2),this}toJSON(){var data=Curve3D.prototype.toJSON.call(this);return data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data}fromJSON(json){return Curve.prototype.fromJSON.call(this,json),this.v1.fromArray(json.v1),this.v2.fromArray(json.v2),this}}class QuadraticBezierCurve extends Curve3D{constructor(v0,v1,v2){super(),this.type="QuadraticBezierCurve",this.v0=v0||new Vector2,this.v1=v1||new Vector2,this.v2=v2||new Vector2,this.isQuadraticBezierCurve=!0}getPoint(t,optionalTarget=new Vector2){let point=optionalTarget||new Vector2,v0=this.v0,v1=this.v1,v2=this.v2;const{QuadraticBezier:QuadraticBezier}=require("Shape2DInterpolations");return point.set(QuadraticBezier(t,v0.x,v1.x,v2.x),QuadraticBezier(t,v0.y,v1.y,v2.y)),point}copy(source){return Curve3D.prototype.copy.call(this,source),this.v0.copy(source.v0),this.v1.copy(source.v1),this.v2.copy(source.v2),this}toJSON(){let data=Curve3D.prototype.toJSON.call(this);return data.v0=this.v0.toArray(),data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data}fromJSON(json){return Curve3D.prototype.fromJSON.call(this,json),this.v0.fromArray(json.v0),this.v1.fromArray(json.v1),this.v2.fromArray(json.v2),this}}class SplineCurve extends Curve3D{constructor(){super(),this.type="SplineCurve",this.points=points||[],this.isSplineCurve=!0}getPoint(t,optionalTarget){let point=optionalTarget||new Vector2,points=this.points,p=(points.length-1)*t,intPoint=Math.floor(p),weight=p-intPoint,p0=points[0===intPoint?intPoint:intPoint-1],p1=points[intPoint],p2=points[intPoint>points.length-2?points.length-1:intPoint+1],p3=points[intPoint>points.length-3?points.length-1:intPoint+2];return point.set(CatmullRom(weight,p0.x,p1.x,p2.x,p3.x),CatmullRom(weight,p0.y,p1.y,p2.y,p3.y)),point}copy(source){Curve3D.prototype.copy.call(this,source),this.points=[];for(let i=0,l=source.points.length;i<l;i++){let point=source.points[i];this.points.push(point.clone())}return this}toJSON(){let data=Curve.prototype.toJSON.call(this);data.points=[];for(let i=0,l=this.points.length;i<l;i++){let point=this.points[i];data.points.push(point.toArray())}return data}fromJSON(json){Curve.prototype.fromJSON.call(this,json),this.points=[];for(let i=0,l=json.points.length;i<l;i++){let point=json.points[i];this.points.push((new Vector2).fromArray(point))}return this}}class ExtrudeGeometry extends Geometry{constructor(shapes,options={}){super();var WorldUVGenerator={generateTopUV:function(geometry,vertices,indexA,indexB,indexC){var a_x=vertices[3*indexA],a_y=vertices[3*indexA+1],b_x=vertices[3*indexB],b_y=vertices[3*indexB+1],c_x=vertices[3*indexC],c_y=vertices[3*indexC+1];return[new Vector2(a_x,a_y),new Vector2(b_x,b_y),new Vector2(c_x,c_y)]},generateSideWallUV:function(geometry,vertices,indexA,indexB,indexC,indexD){var a_x=vertices[3*indexA],a_y=vertices[3*indexA+1],a_z=vertices[3*indexA+2],b_x=vertices[3*indexB],b_y=vertices[3*indexB+1],b_z=vertices[3*indexB+2],c_x=vertices[3*indexC],c_y=vertices[3*indexC+1],c_z=vertices[3*indexC+2],d_x=vertices[3*indexD],d_y=vertices[3*indexD+1],d_z=vertices[3*indexD+2];return Math.abs(a_y-b_y)<.01?[new Vector2(a_x,1-a_z),new Vector2(b_x,1-b_z),new Vector2(c_x,1-c_z),new Vector2(d_x,1-d_z)]:[new Vector2(a_y,1-a_z),new Vector2(b_y,1-b_z),new Vector2(c_y,1-c_z),new Vector2(d_y,1-d_z)]}};shapes=Array.isArray(shapes)?shapes:[shapes];for(var scope=this,verticesArray=[],uvArray=[],i=0,l=shapes.length;i<l;i++){addShape(shapes[i])}function addShape(shape){var extrudePts,splineTube,binormal,normal,position2,ahole,h,hl,placeholder=[],curveSegments=void 0!==options.curveSegments?options.curveSegments:12,steps=void 0!==options.steps?options.steps:1,depth=void 0!==options.depth?options.depth:100,bevelEnabled=void 0===options.bevelEnabled||options.bevelEnabled,bevelThickness=void 0!==options.bevelThickness?options.bevelThickness:6,bevelSize=void 0!==options.bevelSize?options.bevelSize:bevelThickness-2,bevelOffset=void 0!==options.bevelOffset?options.bevelOffset:0,bevelSegments=void 0!==options.bevelSegments?options.bevelSegments:3,extrudePath=options.extrudePath,uvgen=void 0!==options.UVGenerator?options.UVGenerator:WorldUVGenerator,extrudeByPath=!1;extrudePath&&(extrudePts=extrudePath.getSpacedPoints(steps),extrudeByPath=!0,bevelEnabled=!1,splineTube=extrudePath.computeFrenetFrames(steps,!1),binormal=new Vector3,normal=new Vector3,position2=new Vector3),bevelEnabled||(bevelSegments=0,bevelThickness=0,bevelSize=0,bevelOffset=0);var shapePoints=shape.extractPoints(curveSegments),vertices=shapePoints.shape,holes=shapePoints.holes;if(!ExtrudeUtils.isClockWise(vertices))for(vertices=vertices.reverse(),h=0,hl=holes.length;h<hl;h++)ahole=holes[h],ExtrudeUtils.isClockWise(ahole)&&(holes[h]=ahole.reverse());var faces=ExtrudeUtils.triangulateShape(vertices,holes),contour=vertices;for(h=0,hl=holes.length;h<hl;h++)ahole=holes[h],vertices=vertices.concat(ahole);function scalePt2(pt,vec,size){return vec||console.error("ExtrudeGeometry: vec does not exist"),vec.clone().multiplyScalar(size).add(pt)}var b,bs,t,z,vert,face,vlen=vertices.length,flen=faces.length;function getBevelVec(inPt,inPrev,inNext){var v_trans_x,v_trans_y,shrink_by,v_prev_x=inPt.x-inPrev.x,v_prev_y=inPt.y-inPrev.y,v_next_x=inNext.x-inPt.x,v_next_y=inNext.y-inPt.y,v_prev_lensq=v_prev_x*v_prev_x+v_prev_y*v_prev_y,collinear0=v_prev_x*v_next_y-v_prev_y*v_next_x;if(Math.abs(collinear0)>Number.EPSILON){var v_prev_len=Math.sqrt(v_prev_lensq),v_next_len=Math.sqrt(v_next_x*v_next_x+v_next_y*v_next_y),ptPrevShift_x=inPrev.x-v_prev_y/v_prev_len,ptPrevShift_y=inPrev.y+v_prev_x/v_prev_len,sf=((inNext.x-v_next_y/v_next_len-ptPrevShift_x)*v_next_y-(inNext.y+v_next_x/v_next_len-ptPrevShift_y)*v_next_x)/(v_prev_x*v_next_y-v_prev_y*v_next_x),v_trans_lensq=(v_trans_x=ptPrevShift_x+v_prev_x*sf-inPt.x)*v_trans_x+(v_trans_y=ptPrevShift_y+v_prev_y*sf-inPt.y)*v_trans_y;if(v_trans_lensq<=2)return new Vector2(v_trans_x,v_trans_y);shrink_by=Math.sqrt(v_trans_lensq/2)}else{var direction_eq=!1;v_prev_x>Number.EPSILON?v_next_x>Number.EPSILON&&(direction_eq=!0):v_prev_x<-Number.EPSILON?v_next_x<-Number.EPSILON&&(direction_eq=!0):Math.sign(v_prev_y)===Math.sign(v_next_y)&&(direction_eq=!0),direction_eq?(v_trans_x=-v_prev_y,v_trans_y=v_prev_x,shrink_by=Math.sqrt(v_prev_lensq)):(v_trans_x=v_prev_x,v_trans_y=v_prev_y,shrink_by=Math.sqrt(v_prev_lensq/2))}return new Vector2(v_trans_x/shrink_by,v_trans_y/shrink_by)}for(var contourMovements=[],i=0,il=contour.length,j=il-1,k=i+1;i<il;i++,j++,k++)j===il&&(j=0),k===il&&(k=0),contourMovements[i]=getBevelVec(contour[i],contour[j],contour[k]);var oneHoleMovements,s,holesMovements=[],verticesMovements=contourMovements.concat();for(h=0,hl=holes.length;h<hl;h++){for(ahole=holes[h],oneHoleMovements=[],i=0,j=(il=ahole.length)-1,k=i+1;i<il;i++,j++,k++)j===il&&(j=0),k===il&&(k=0),oneHoleMovements[i]=getBevelVec(ahole[i],ahole[j],ahole[k]);holesMovements.push(oneHoleMovements),verticesMovements=verticesMovements.concat(oneHoleMovements)}for(b=0;b<bevelSegments;b++){for(t=b/bevelSegments,z=bevelThickness*Math.cos(t*Math.PI/2),bs=bevelSize*Math.sin(t*Math.PI/2)+bevelOffset,i=0,il=contour.length;i<il;i++)v((vert=scalePt2(contour[i],contourMovements[i],bs)).x,vert.y,-z);for(h=0,hl=holes.length;h<hl;h++)for(ahole=holes[h],oneHoleMovements=holesMovements[h],i=0,il=ahole.length;i<il;i++)v((vert=scalePt2(ahole[i],oneHoleMovements[i],bs)).x,vert.y,-z)}for(bs=bevelSize+bevelOffset,i=0;i<vlen;i++)vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i],extrudeByPath?(normal.copy(splineTube.normals[0]).multiplyScalar(vert.x),binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y),position2.copy(extrudePts[0]).add(normal).add(binormal),v(position2.x,position2.y,position2.z)):v(vert.x,vert.y,0);for(s=1;s<=steps;s++)for(i=0;i<vlen;i++)vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i],extrudeByPath?(normal.copy(splineTube.normals[s]).multiplyScalar(vert.x),binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y),position2.copy(extrudePts[s]).add(normal).add(binormal),v(position2.x,position2.y,position2.z)):v(vert.x,vert.y,depth/steps*s);for(b=bevelSegments-1;b>=0;b--){for(t=b/bevelSegments,z=bevelThickness*Math.cos(t*Math.PI/2),bs=bevelSize*Math.sin(t*Math.PI/2)+bevelOffset,i=0,il=contour.length;i<il;i++)v((vert=scalePt2(contour[i],contourMovements[i],bs)).x,vert.y,depth+z);for(h=0,hl=holes.length;h<hl;h++)for(ahole=holes[h],oneHoleMovements=holesMovements[h],i=0,il=ahole.length;i<il;i++)vert=scalePt2(ahole[i],oneHoleMovements[i],bs),extrudeByPath?v(vert.x,vert.y+extrudePts[steps-1].y,extrudePts[steps-1].x+z):v(vert.x,vert.y,depth+z)}function sidewalls(contour,layeroffset){var j,k;for(i=contour.length;--i>=0;){j=i,(k=i-1)<0&&(k=contour.length-1);var s=0,sl=steps+2*bevelSegments;for(s=0;s<sl;s++){var slen1=vlen*s,slen2=vlen*(s+1);f4(layeroffset+j+slen1,layeroffset+k+slen1,layeroffset+k+slen2,layeroffset+j+slen2)}}}function v(x,y,z){placeholder.push(x),placeholder.push(y),placeholder.push(z)}function f3(a,b,c){addVertex(a),addVertex(b),addVertex(c);var nextIndex=verticesArray.length/3,uvs=uvgen.generateTopUV(scope,verticesArray,nextIndex-3,nextIndex-2,nextIndex-1);addUV(uvs[0]),addUV(uvs[1]),addUV(uvs[2])}function f4(a,b,c,d){addVertex(a),addVertex(b),addVertex(d),addVertex(b),addVertex(c),addVertex(d);var nextIndex=verticesArray.length/3,uvs=uvgen.generateSideWallUV(scope,verticesArray,nextIndex-6,nextIndex-3,nextIndex-2,nextIndex-1);addUV(uvs[0]),addUV(uvs[1]),addUV(uvs[3]),addUV(uvs[1]),addUV(uvs[2]),addUV(uvs[3])}function addVertex(index){verticesArray.push(placeholder[3*index+0]),verticesArray.push(placeholder[3*index+1]),verticesArray.push(placeholder[3*index+2])}function addUV(vector2){uvArray.push(vector2.x),uvArray.push(vector2.y)}!function buildLidFaces(){verticesArray.length;if(bevelEnabled){var layer=0,offset=vlen*layer;for(i=0;i<flen;i++)f3((face=faces[i])[2]+offset,face[1]+offset,face[0]+offset);for(offset=vlen*(layer=steps+2*bevelSegments),i=0;i<flen;i++)f3((face=faces[i])[0]+offset,face[1]+offset,face[2]+offset)}else{for(i=0;i<flen;i++)f3((face=faces[i])[2],face[1],face[0]);for(i=0;i<flen;i++)f3((face=faces[i])[0]+vlen*steps,face[1]+vlen*steps,face[2]+vlen*steps)}}(),function buildSideFaces(){verticesArray.length;var layeroffset=0;for(sidewalls(contour,layeroffset),layeroffset+=contour.length,h=0,hl=holes.length;h<hl;h++)sidewalls(ahole=holes[h],layeroffset),layeroffset+=ahole.length}()}this.addAttribute("position",new GeometryAttribute(new Float32Array(verticesArray),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvArray),2)),!0===options.computeNormals&&this.computeVertexNormals()}}Class(function ExtrudeUtils(){Inherit(this,Component);const _this=this;function removeDupEndPts(points){let l=points.length;l>2&&points[l-1].equals(points[0])&&points.pop()}function addContour(vertices,contour){for(let i=0;i<contour.length;i++)vertices.push(contour[i].x),vertices.push(contour[i].y)}!async function(){window.THREAD||(await Hydra.ready(),Thread.shared(!0).array.forEach(thread=>{Curve.loadOnThread(thread),["CurvePath","Path","Shape","LineCurve","ExtrudeGeometry"].forEach(name=>{thread.importES6Class(name)}),thread.importClass(Curve),thread.importClass(LinkedList),thread.importCode(`Class(${_this.constructor.toString()}, 'static')`),thread.importCode(`Class(${Earcut.constructor.toString()}, 'static')`)}))}(),this.area=function(contour){let n=contour.length,a=0;for(let p=n-1,q=0;q<n;p=q++)a+=contour[p].x*contour[q].y-contour[q].x*contour[p].y;return.5*a},this.isClockWise=function(pts){return _this.area(pts)<0},this.triangulateShape=function(contour,holes){let vertices=[],holeIndices=[],faces=[];removeDupEndPts(contour),addContour(vertices,contour);let holeIndex=contour.length;holes.forEach(removeDupEndPts);for(let i=0;i<holes.length;i++)holeIndices.push(holeIndex),holeIndex+=holes[i].length,addContour(vertices,holes[i]);let triangles=Earcut.triangulate(vertices,holeIndices);for(let i=0;i<triangles.length;i+=3)faces.push(triangles.slice(i,i+3));return faces}},"static");class GLUIShape extends GLUIObject{constructor(){super(1,1),GLUIShape.emptyShape||(GLUIShape.emptyShape=new Shape),GLUIShape.antialias||(GLUIShape.antialias=1);let geom=new ShapeGeometry(GLUIShape.emptyShape,24);this.geom=geom,this.msaa=1,this.useGeometry(geom),this.fillColor=new Color,this.commands=[],this.holes=new GLUIShapeHoles,this.subdivisions=24;let shader=new Shader("GLUIShape",{uColor:{value:this.fillColor}});this.useShader(shader)}beginPath(){this.commands.length=0}moveTo(x,y){this.commands.push(["moveTo",x,-y])}lineTo(x,y){this.commands.push(["lineTo",x,-y])}quadraticCurveTo(aCPx,aCPy,aX,aY){this.commands.push(["quadraticCurveTo",aCPx,-aCPy,aX,-aY])}bezierCurveTo(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){this.commands.push(["bezierCurveTo",aCP1x,-aCP1y,aCP2x,-aCP2y,aX,-aY])}arc(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){this.commands.push(["arc",aX,-aY,aRadius,aStartAngle,aEndAngle,aClockwise])}endPath(){const _this=this;return _this._promise=ShapeUtils.process(this).then(_=>{let shape,p=_this.parent;for(;p;)p instanceof GLUIShape&&(shape=p),p=p.parent;shape&&shape._notifyParentUpdate(),_this.update&&_this.update()}),_this._promise}create(){let $obj=$glShape();return this.add($obj),$obj}_notifyParentUpdate(){this._cacheAsBitmap&&this.bitmap.update()}set cacheAsBitmap(bool){this._cacheAsBitmap=bool,bool&&(this.bitmap||(this.bitmap=new GLUIShapeBitmap(this)),this.bitmap.show())}get mask(){return this._mask||(this._mask=new GLUIShapeMask(this),this.cacheAsBitmap=!0,this.bitmap.mask=this._mask),this._mask}async ready(){return this._promise}async loaded(){return this._promise}}class GLUIShapeBitmap{constructor(shape){this.shape=shape,this.rt=Utils3D.createRT(100,100,null,Texture.RGBAFormat),this.camera=new OrthographicCamera,this.scene=new Scene,this.wrapper=new Group,this.scene.add(this.wrapper),this.quad=$gl(100,100,this.rt),this.shape.add(this.quad),this.shader=new Shader("GLUIShapeBitmap",{tMask:{value:Utils3D.getTexture("assets/images/_scenelayout/mask.jpg")}}),this.quad.useShader(this.shader)}hide(){let _this=this;this.quad.hide(),this.shape.children.forEach(child=>{child!=_this.quad&&this.shape.group.add(child.group)})}show(){let _this=this;this.quad.show(),this.shape.children.forEach(child=>{child!=_this.quad&&this.wrapper.add(child.group)})}update(){this.scene.position.set(0,0,0),this.scene.updateMatrixWorld(!0);let scale=World.DPR*GLUIShape.antialias,bb=new Box3;bb.setFromObject(this.wrapper);let width=bb.max.x-bb.min.x,height=-(bb.min.y-bb.max.y);this.rt.setSize(width*scale,height*scale),this.quad.width=width,this.quad.height=height,this.camera.setViewport(width,height),this.camera.position.x=width/2,this.camera.position.y=-height/2,this.camera.updateMatrixWorld(!0);const _this=this;let x=9999,y=9999;this.shape.children.forEach(child=>{if(child==_this.quad)return;child.mesh.onBeforeRender&&child.mesh.onBeforeRender();let worldPos=child.mesh.getWorldPosition();x=Math.min(x,worldPos.x),y=Math.min(y,-worldPos.y)}),this.scene.position.set(-x,y,0),this.quad.x=x,this.quad.y=-y;let clearAlpha=World.RENDERER.getClearAlpha();World.RENDERER.setClearAlpha(0),World.RENDERER.render(this.scene,this.camera,this.rt),World.RENDERER.setClearAlpha(clearAlpha),this.mask&&this.mask.update()}}class GLUIShapeHoles{constructor(){this.commands=[]}beginPath(){this.commands.length=0}moveTo(x,y){this.commands.push(["moveTo",x,-y])}lineTo(x,y){this.commands.push(["lineTo",x,-y])}quadraticCurveTo(aCPx,aCPy,aX,aY){this.commands.push(["quadraticCurveTo",aCPx,-aCPy,aX,-aY])}bezierCurveTo(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){this.commands.push(["bezierCurveTo",aCP1x,-aCP1y,aCP2x,-aCP2y,aX,-aY])}arc(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){this.commands.push(["arc",aX,-aY,aRadius,aStartAngle,aEndAngle,aClockwise])}endPath(){this.commands.push(["endPath"])}}class GLUIShapeMask extends GLUIShape{constructor(shape){super(),this.shape=shape,this.rt=Utils3D.createRT(100,100,null,Texture.RGBAFormat),this.scene=new Scene,this.scene.add(this.group),this.mesh.frustumCulled=!1,this.__internalDirty=this.update}update(){let{x:x,y:y}=this.shape.bitmap.quad;this.scene.position.set(0,0,0),this.scene.updateMatrixWorld(!0),this.rt.setSize(this.shape.bitmap.rt.width,this.shape.bitmap.rt.height),this.scene.position.set(-x,0,0);let clearAlpha=World.RENDERER.getClearAlpha();World.RENDERER.setClearAlpha(0),World.RENDERER.render(this.scene,this.shape.bitmap.camera,this.rt),World.RENDERER.setClearAlpha(clearAlpha),this.shape.bitmap.shader.set("tMask",this.rt)}clear(){this.shape.bitmap.shader.set("tMask",Utils3D.getTexture("assets/images/_scenelayout/mask.jpg")),this.rt.destroy(),this.shape._mask=null}}class CurvePath extends Curve3D{constructor(){super(),this.curves=[],this.autoClose=!1}add(curve){this.curves.push(curve)}closePath(){let startPoint=this.curves[0].getPoint(0),endPoint=this.curves[this.curves.length-1].getPoint(1);startPoint.equals(endPoint)||this.curves.push(new LineCurve(endPoint,startPoint))}getPoint(t){let d=t*this.getLength(),curveLengths=this.getCurveLengths(),i=0;for(;i<curveLengths.length;){if(curveLengths[i]>=d){let diff=curveLengths[i]-d,curve=this.curves[i],segmentLength=curve.getLength(),u=0===segmentLength?0:1-diff/segmentLength;return curve.getPointAt(u)}i++}return null}getLength(){let lens=this.getCurveLengths();return lens[lens.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let lengths=[],sums=0;for(let i=0,l=this.curves.length;i<l;i++)sums+=this.curves[i].getLength(),lengths.push(sums);return this.cacheLengths=lengths,lengths}getSpacedPoints(divisions){void 0===divisions&&(divisions=40);let points=[];for(let i=0;i<=divisions;i++)points.push(this.getPoint(i/divisions));return this.autoClose&&points.push(points[0]),points}getPoints(divisions=12){let last,points=[];for(let i=0,curves=this.curves;i<curves.length;i++){let curve=curves[i],resolution=curve&&curve.isEllipseCurve?2*divisions:curve&&(curve.isLineCurve||curve.isLineCurve3)?1:curve&&curve.isSplineCurve?divisions*curve.points.length:divisions,pts=curve.getPoints(resolution);for(let j=0;j<pts.length;j++){let point=pts[j];point.z||(point.z=0),last&&last.equals(point)||(points.push(point),last=point)}}return this.autoClose&&points.length>1&&!points[points.length-1].equals(points[0])&&points.push(points[0]),points}copy(source){Curve3D.prototype.copy.call(this,source),this.curves=[];for(let i=0,l=source.curves.length;i<l;i++){let curve=source.curves[i];this.curves.push(curve.clone())}return this.autoClose=source.autoClose,this}toJSON(){let data=Curve3D.prototype.toJSON.call(this);data.autoClose=this.autoClose,data.curves=[];for(let i=0,l=this.curves.length;i<l;i++){let curve=this.curves[i];data.curves.push(curve.toJSON())}return data}fromJSON(json){Curve3D.prototype.fromJSON.call(this,json),this.autoClose=json.autoClose,this.curves=[];for(let i=0,l=json.curves.length;i<l;i++){let curve=json.curves[i];this.curves.push((new Curves[curve.type]).fromJSON(curve))}return this}}class Path extends CurvePath{constructor(points){super(),this.type="Path",this.currentPoint=new Vector2,points&&this.setFromPoints(points)}setFromPoints(points){this.moveTo(points[0].x,points[0].y);for(let i=1,l=points.length;i<l;i++)this.lineTo(points[i].x,points[i].y)}moveTo(x,y){this.currentPoint.set(x,y)}lineTo(x,y){let curve=new LineCurve(this.currentPoint.clone(),new Vector2(x,y));this.curves.push(curve),this.currentPoint.set(x,y)}quadraticCurveTo(aCPx,aCPy,aX,aY){let curve=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(aCPx,aCPy),new Vector2(aX,aY));this.curves.push(curve),this.currentPoint.set(aX,aY)}bezierCurveTo(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){let curve=new CubicBezierCurve2D(this.currentPoint.clone(),new Vector2(aCP1x,aCP1y),new Vector2(aCP2x,aCP2y),new Vector2(aX,aY));this.curves.push(curve),this.currentPoint.set(aX,aY)}splineThru(pts){let npts=[this.currentPoint.clone()].concat(pts),curve=new SplineCurve(npts);this.curves.push(curve),this.currentPoint.copy(pts[pts.length-1])}arc(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){let x0=this.currentPoint.x,y0=this.currentPoint.y;this.absarc(aX+x0,aY+y0,aRadius,aStartAngle,aEndAngle,aClockwise)}absarc(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){this.absellipse(aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise)}ellipse(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){let x0=this.currentPoint.x,y0=this.currentPoint.y;this.absellipse(aX+x0,aY+y0,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation)}absellipse(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){let curve=new EllipseCurve(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation);if(this.curves.length>0){let firstPoint=curve.getPoint(0);firstPoint.equals(this.currentPoint)||this.lineTo(firstPoint.x,firstPoint.y)}this.curves.push(curve);let lastPoint=curve.getPoint(1);this.currentPoint.copy(lastPoint)}copy(source){return CurvePath.prototype.copy.call(this,source),this.currentPoint.copy(source.currentPoint),this}toJSON(){let data=CurvePath.prototype.toJSON.call(this);return data.currentPoint=this.currentPoint.toArray(),data}fromJSON(json){return CurvePath.prototype.fromJSON.call(this,json),this.currentPoint.fromArray(json.currentPoint),this}}class Shape extends Path{constructor(points){super(points),this.type="Shape",this.holes=[]}getPointsHoles(divisions){let holesPts=[];for(let i=0,l=this.holes.length;i<l;i++)holesPts[i]=this.holes[i].getPoints(divisions);return holesPts}extractPoints(divisions){return{shape:this.getPoints(divisions),holes:this.getPointsHoles(divisions)}}copy(source){Path.prototype.copy.call(this,source),this.holes=[];for(let i=0,l=source.holes.length;i<l;i++){let hole=source.holes[i];this.holes.push(hole.clone())}return this}toJSON(){let data=Path.prototype.toJSON.call(this);data.holes=[];for(let i=0,l=this.holes.length;i<l;i++){let hole=this.holes[i];data.holes.push(hole.toJSON())}return data}fromJSON(json){Path.prototype.fromJSON.call(this,json),this.holes=[];for(let i=0,l=json.holes.length;i<l;i++){let hole=json.holes[i];this.holes.push((new Path).fromJSON(hole))}return this}}class ShapeGeometry extends Geometry{constructor(shapes,curveSegments){super(),this.type="ShapeGeometry",this.parameters={shapes:shapes,curveSegments:curveSegments};let indices=[],vertices=[];if(!1===Array.isArray(shapes))addShape(shapes);else for(let i=0;i<shapes.length;i++)addShape(shapes[i]);function addShape(shape){let i,l,shapeHole,indexOffset=vertices.length/3,points=shape.extractPoints(curveSegments),shapeVertices=points.shape,shapeHoles=points.holes;for(!1===ShapeUtils.isClockWise(shapeVertices)&&(shapeVertices=shapeVertices.reverse()),i=0,l=shapeHoles.length;i<l;i++)shapeHole=shapeHoles[i],!0===ShapeUtils.isClockWise(shapeHole)&&(shapeHoles[i]=shapeHole.reverse());let faces=ShapeUtils.triangulateShape(shapeVertices,shapeHoles);for(i=0,l=shapeHoles.length;i<l;i++)shapeHole=shapeHoles[i],shapeVertices=shapeVertices.concat(shapeHole);for(i=0,l=shapeVertices.length;i<l;i++){let vertex=shapeVertices[i];vertices.push(vertex.x,vertex.y,0)}for(i=0,l=faces.length;i<l;i++){let face=faces[i],a=face[0]+indexOffset,b=face[1]+indexOffset,c=face[2]+indexOffset;indices.push(a,b,c)}}this.index=new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertices),3))}}Class(function Earcut(){Inherit(this,Component);function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===function signedArea(data,start,end,dim){for(var sum=0,i=start,j=end-dim;i<end;i+=dim)sum+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;return sum}(data,start,end,dim)>0)for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last);else for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last);return last&&equals(last,last.next)&&(removeNode(last),last=last.next),last}function filterPoints(start,end){if(!start)return start;end||(end=start);var again,p=start;do{if(again=!1,p.steiner||!equals(p,p.next)&&0!==area(p.prev,p,p.next))p=p.next;else{if(removeNode(p),(p=end=p.prev)===p.next)break;again=!0}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(ear){!pass&&invSize&&function indexCurve(start,minX,minY,invSize){var p=start;do{null===p.z&&(p.z=zOrder(p.x,p.y,minX,minY,invSize)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next}while(p!==start);p.prevZ.nextZ=null,p.prevZ=null,function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,list=null,tail=null,numMerges=0;p;){for(numMerges++,q=p,pSize=0,i=0;i<inSize&&(pSize++,q=q.nextZ);i++);for(qSize=inSize;pSize>0||qSize>0&&q;)0!==pSize&&(0===qSize||!q||p.z<=q.z)?(e=p,p=p.nextZ,pSize--):(e=q,q=q.nextZ,qSize--),tail?tail.nextZ=e:list=e,e.prevZ=tail,tail=e;p=q}tail.nextZ=null,inSize*=2}while(numMerges>1);return list}(p)}(ear,minX,minY,invSize);for(var prev,next,stop=ear;ear.prev!==ear.next;)if(prev=ear.prev,next=ear.next,invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear))triangles.push(prev.i/dim),triangles.push(ear.i/dim),triangles.push(next.i/dim),removeNode(ear),ear=next.next,stop=next.next;else if((ear=next)===stop){pass?1===pass?earcutLinked(ear=cureLocalIntersections(ear,triangles,dim),triangles,dim,minX,minY,invSize,2):2===pass&&splitEarcut(ear,triangles,dim,minX,minY,invSize):earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1);break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var p=ear.next.next;p!==ear.prev;){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y,minZ=zOrder(minTX,minTY,minX,minY,invSize),maxZ=zOrder(maxTX,maxTY,minX,minY,invSize),p=ear.prevZ,n=ear.nextZ;p&&p.z>=minZ&&n&&n.z<=maxZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,n!==ear.prev&&n!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}for(;p&&p.z>=minZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;n&&n.z<=maxZ;){if(n!==ear.prev&&n!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}return!0}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)&&(triangles.push(a.i/dim),triangles.push(p.i/dim),triangles.push(b.i/dim),removeNode(p),removeNode(p.next),p=start=b),p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,invSize){var a=start;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,triangles,dim,minX,minY,invSize),void earcutLinked(c,triangles,dim,minX,minY,invSize)}b=b.next}a=a.next}while(a!==start)}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){if(outerNode=function findHoleBridge(hole,outerNode){var m,p=outerNode,hx=hole.x,hy=hole.y,qx=-1/0;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){if(qx=x,x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var tan,stop=m,mx=m.x,my=m.y,tanMin=1/0;p=m.next;for(;p!==stop;)hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)&&((tan=Math.abs(hy-p.y)/(hx-p.x))<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)&&(m=p,tanMin=tan),p=p.next;return m}(hole,outerNode),outerNode){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function zOrder(x,y,minX,minY,invSize){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x=32767*(x-minX)*invSize)|x<<8))|x<<4))|x<<2))|x<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y=32767*(y-minY)*invSize)|y<<8))|y<<4))|y<<2))|y<<1))<<1}function getLeftmost(start){var p=start,leftmost=start;do{(p.x<leftmost.x||p.x===leftmost.x&&p.y<leftmost.y)&&(leftmost=p),p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&function middleInside(a,b){var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{p.y>py!=p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&&(inside=!inside),p=p.next}while(p!==a);return inside}(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){return!!(equals(p1,p2)&&equals(q1,q2)||equals(p1,q2)&&equals(p2,q1))||area(p1,q1,p2)>0!=area(p1,q1,q2)>0&&area(p2,q2,p1)>0!=area(p2,q2,q1)>0}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;return a.next=b,b.prev=a,a2.next=an,an.prev=a2,b2.next=a2,a2.prev=b2,bp.next=b2,b2.prev=bp,b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);return last?(p.next=last.next,p.prev=last,last.next.prev=p,last.next=p):(p.prev=p,p.next=p),p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Node(i,x,y){this.i=i,this.x=x,this.y=y,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}this.triangulate=function(data,holeIndices,dim){dim=dim||2;var minX,minY,maxX,maxY,x,y,invSize,hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode||outerNode.next===outerNode.prev)return triangles;if(hasHoles&&(outerNode=function eliminateHoles(data,holeIndices,outerNode,dim){var i,len,list,queue=[];for(i=0,len=holeIndices.length;i<len;i++)(list=linkedList(data,holeIndices[i]*dim,i<len-1?holeIndices[i+1]*dim:data.length,dim,!1))===list.next&&(list.steiner=!0),queue.push(getLeftmost(list));for(queue.sort(compareX),i=0;i<queue.length;i++)eliminateHole(queue[i],outerNode),outerNode=filterPoints(outerNode,outerNode.next);return outerNode}(data,holeIndices,outerNode,dim)),data.length>80*dim){minX=maxX=data[0],minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim)(x=data[i])<minX&&(minX=x),(y=data[i+1])<minY&&(minY=y),x>maxX&&(maxX=x),y>maxY&&(maxY=y);invSize=0!==(invSize=Math.max(maxX-minX,maxY-minY))?1/invSize:0}return earcutLinked(outerNode,triangles,dim,minX,minY,invSize),triangles}},"static"),Module(function Shape2DInterpolations(){this.exports={QuadraticBezier:function QuadraticBezier(t,p0,p1,p2){return function QuadraticBezierP0(t,p){let k=1-t;return k*k*p}(t,p0)+function QuadraticBezierP1(t,p){return 2*(1-t)*t*p}(t,p1)+function QuadraticBezierP2(t,p){return t*t*p}(t,p2)},CubicBezier:function CubicBezier(t,p0,p1,p2,p3){return function CubicBezierP0(t,p){let k=1-t;return k*k*k*p}(t,p0)+function CubicBezierP1(t,p){let k=1-t;return 3*k*k*t*p}(t,p1)+function CubicBezierP2(t,p){return 3*(1-t)*t*t*p}(t,p2)+function CubicBezierP3(t,p){return t*t*t*p}(t,p3)},CatmullRom:function CatmullRom(t,p0,p1,p2,p3){let v0=.5*(p2-p0),v1=.5*(p3-p1),t2=t*t;return(2*p1-2*p2+v0+v1)*(t*t2)+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}}}),Class(function ShapeUtils(){Inherit(this,Component);const _this=this;function getShapeGeom({commands:commands,holes:holes,subdivisions:subdivisions},id){let geom=commandsToShapeGeom(commands,holes,subdivisions),position=geom.attributes.position.array,index=geom.index,bb=geom.boundingBox;resolve({position:position,index:index,bb:bb},id,[position.buffer,index.buffer])}function commandsToShapeGeom(commands,holes,curveSegments){let shape=new Shape;commands.forEach(array=>{let cmd=array.shift();shape[cmd].apply(shape,array)});let path=new Path;holes.forEach(array=>{let cmd=array.shift();"endPath"===cmd?(shape.holes.push(path),path=new Path):path[cmd].apply(path,array)}),path.curves.length&&shape.holes.push(path);let geom=new ShapeGeometry(shape,curveSegments);return geom.computeBoundingBox(),geom}function removeDupEndPts(points){let l=points.length;l>2&&points[l-1].equals(points[0])&&points.pop()}function addContour(vertices,contour){for(let i=0;i<contour.length;i++)vertices.push(contour[i].x),vertices.push(contour[i].y)}!async function(){window.THREAD||(await Hydra.ready(),Thread.shared(!0).array.forEach(thread=>{thread.loadFunction(commandsToShapeGeom),thread.importModule("Shape2DInterpolations"),["ShapeGeometry","Curve3D","CurvePath","EllipseCurve","Path","CubicBezierCurve2D","LineCurve","Shape","SplineCurve"].forEach(name=>{thread.importES6Class(name)}),thread.importCode(`Class(${_this.constructor.toString()}, 'static')`),thread.importCode(`Class(${Earcut.constructor.toString()}, 'static')`)}),Thread.upload(getShapeGeom))}(),this.area=function(contour){let n=contour.length,a=0;for(let p=n-1,q=0;q<n;p=q++)a+=contour[p].x*contour[q].y-contour[q].x*contour[p].y;return.5*a},this.isClockWise=function(pts){return _this.area(pts)<0},this.triangulateShape=function(contour,holes){let vertices=[],holeIndices=[],faces=[];removeDupEndPts(contour),addContour(vertices,contour);let holeIndex=contour.length;holes.forEach(removeDupEndPts);for(let i=0;i<holes.length;i++)holeIndices.push(holeIndex),holeIndex+=holes[i].length,addContour(vertices,holes[i]);let triangles=Earcut.triangulate(vertices,holeIndices);for(let i=0;i<triangles.length;i+=3)faces.push(triangles.slice(i,i+3));return faces},this.process=async function(shape){let{geom:geom,commands:commands,subdivisions:subdivisions}=shape,holes=shape.holes.commands,data=await Thread.shared().getShapeGeom({commands:commands,holes:holes,subdivisions:subdivisions});geom.attributes.position.array=data.position,geom.attributes.position.needsUpdate=!0,geom.attributes.position.needsNewBuffer=!0,geom.attributes.position.count=data.position.length/3,geom.boundingBox=data.bb,geom.setIndex(data.index),geom.indexNeedsUpdate=!0},window.$glShape=function(){return new GLUIShape}},"static"),Class(function Share(){const POPUP_OPTIONS="height=555,width=577,scrollbars=yes";function url(u){return u||`${location.protocol}//${location.host}${location.pathname}`}this.native=function(text,u,title){if(window.navigator.share)return window.navigator.share({url:url(u),text:text,title:title||document.title})},this.facebook=function(u){open(`https://www.facebook.com/sharer?u=${url(u)}`,"_blank",POPUP_OPTIONS)},this.twitter=function(text,u){open(`https://twitter.com/share?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url(u))}`,"_blank",POPUP_OPTIONS)},this.linkedin=function(u,title,text){open(`https://www.linkedin.com/shareArticle/?url=${encodeURIComponent(url(u))}&mini=true&title=${encodeURIComponent(title)}&text=${encodeURIComponent(text)}`,"_blank",POPUP_OPTIONS)},this.reddit=function(u,title){open(`https://www.reddit.com/submit?url=${encodeURIComponent(url(u))}&title=${encodeURIComponent(title)}&type=LINK`,"_blank",POPUP_OPTIONS)},this.email=function(subject,body,u){window.location.href=`mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body+url(u))}`},this.download=function(image,filename="download.png"){return Device.mobile||"ie"===Device.system.browser?open(image):function download(image,filename){var link=document.createElement("a");link.setAttribute("href",image),link.setAttribute("target","_blank"),link.setAttribute("download",filename),link.style.display="none","firefox"===Device.system.browser?(document.body.appendChild(link),link.click(),document.body.removeChild(link)):link.click()}(image,filename)}},"static"),Class(function SplitText(_element,_options={lineThreshold:.2,type:"lines,words",asHydraObject:!0,noAriaLabel:!1,noBalance:!1,balanceRatio:1,minLines:1,handleCJT:!1}){Inherit(this,Component);const _this=this;_this.isSplit=!1,_this.options={},_this.chars=[],_this.words=[],_this.lines=[],_this.originals=[],_this.lineParents=[];let safeCheckBalance=0,_warned=!1;if("object"==typeof _element&&!_element.div&&!_element.children){let element=_element.element;for(const key in _options)_options[key]=_element[key]||_options[key];_element=element,_this.isHydraX=!0}function split(){_this.isSplit&&revert();const by=(_this.options.type||"lines").split(",").map(s=>s.trim()),byLines=~by.indexOf("lines"),byWords=~by.indexOf("words"),byChars=~by.indexOf("chars");return _this.elements.forEach((element,i)=>{if(element instanceof HydraObject&&(element=element.div),_this.originals[i]=element.innerHTML.trim(),element.innerHTML=element.innerHTML.trim().split(/\u200b/).join("<wbr>"),balance(element),byWords||byLines||byChars){if(_this.words.push(...splitElement(element,"word")),1===_this.words.length&&_this.words[0].offsetWidth<element.parentElement.offsetWidth&&_this.lineParents.forEach(l=>l.style.removeProperty("max-width")),byLines){!function detectLinesTop(el,els,lineThreshold){let lineOffsetY=-999;const computedStyle=window.getComputedStyle(el),threshold=parseFloat(computedStyle.fontSize||0)*lineThreshold,result=els.map(e=>{const top=Math.round(function offsetTop(el,offsetParent){let offsetGrandparent=offsetParent.offsetParent,top=0,p=el;for(;p&&p!==offsetParent&&p!==offsetGrandparent;)top+=p.offsetTop,p=p.offsetParent;return top}(e,el));return Math.abs(top-lineOffsetY)>threshold&&(lineOffsetY=top),e.__top=lineOffsetY,e.__top});return[...new Set(result)]}(element,_this.words,_this.options.lineThreshold);const proceed=function checkMinLines(element,els){if(_this.options.minLines<=1||_this.options.minLines>1&&els.length<=1)return!0;let lineTop=els[0].__top,linesCount=1;els.forEach(a=>{const top=a.__top;top>lineTop&&(lineTop=top,linesCount++)});const diff=_this.options.minLines-linesCount;diff>1&&!_warned&&(_warned=!0,console.warn(`SplitText is ran ${diff} times. Careful as this option might be expensive `.toUpperCase(),element));const word=_this.words[_this.words.length-1];let x=word.offsetLeft+.9*word.offsetWidth;element.offsetWidth<x&&(x=element.offsetWidth-.5*word.offsetWidth);if(linesCount<_this.options.minLines&&x>0)return element.style.width=`${x}px`,revert(),balance(element),split(),!1;return!0}(element,_this.words);if(!proceed)return;element.style.removeProperty("width"),function attachBr(_,els){let prevLineParent,prevTop=els[0]?.__top||0;els.forEach((w,i)=>{const prevEl=els[i-1];if(prevTop!==w.__top&&prevEl){const lineParent=findLineParent(w);lineParent.__idx||(lineParent.__idx=`l${w.__top}`),isPrevBr(w.parentElement)||isPrevBr(w)||function isNextBr(el){return"BR"===el.nextElementSibling?.tagName}(prevEl)||prevLineParent&&prevLineParent?.__idx!==lineParent.__idx||w.insertAdjacentHTML("beforebegin","<br>"),prevLineParent=lineParent,prevTop=w.__top}})}(0,_this.words),splitBr(element),function replaceWords(element,notByChars){Array.from(element.getElementsByClassName("word")).forEach((el,i)=>{el.replaceWith(_this.words[i]),el.__isCJT&&notByChars&&(_this.words[i].innerHTML=_this.words[i].textContent)})}(element,(byLines||byWords)&&!byChars),_this.lines.push(...function splitLines(el){const lines=[];findAllBr(el,!1).forEach(br=>{const lineParent=findLineParent(br),line=createLine();line.__isLine=!0,lineParent?.__lines?.push(line)});let globalLineIndex=0;return _this.lineParents.forEach((lp,i)=>{let lineIndex=0;i>0&&globalLineIndex++,toArray(lp.childNodes).forEach(next=>{"BR"===next.tagName?(globalLineIndex++,lineIndex++,next.remove()):(lp.__lines[lineIndex].appendChild(next),toArray(next.childNodes).forEach(e=>e.__line=globalLineIndex),next.__line=globalLineIndex)}),lp.__lines.forEach(line=>lp.appendChild(line)),lines.push(...lp.__lines)}),lines.forEach(line=>{line.__words=toArray(line.getElementsByClassName("word")),line.__wordCount=line.__words.length}),lines}(element));const earlyReturn=function checkBalance(_,index){if(_this.options.noBalance)return!0;const removeParentMaxWidth=_this.lines.filter(l=>l.scrollWidth>l.parentElement.offsetWidth);for(let i=0;i<removeParentMaxWidth.length;i++){const l=removeParentMaxWidth[i],text=l.__words[0]?.textContent;if(1===l.__wordCount&&text.match(/\b\w+-\w+\b/)&&safeCheckBalance<=5){const newWordText=text.split("-").join("-&#8203;");return _this.originals[index]=_this.originals[index].replace(text,newWordText),safeCheckBalance++,revert(),split(),!1}l.parentElement.style.removeProperty("max-width")}return!0}(0,i);if(!earlyReturn)return;safeCheckBalance=0}!byLines||byWords||byChars||(_this.lines.forEach(l=>{l.__words.forEach(w=>{w.insertAdjacentHTML("beforebegin",w.textContent),w.remove()}),l.normalize()}),_this.words.length=0,_this.chars.length=0),byChars&&(_this.words.forEach(e=>_this.chars.push(...splitElement(e,"char"))),byWords||(_this.chars.forEach(e=>{e.parentElement.insertAdjacentHTML("beforebegin",e.outerHTML),e.remove()}),_this.chars=toArray(element.getElementsByClassName("char")),_this.words.forEach(e=>e.remove()),_this.words.length=0))}if(_this.options.asHydraObject&&(_this.lines=_this.lines.map(l=>$(l)),_this.words=_this.words.map(w=>$(w)),_this.chars=_this.chars.map(c=>$(c))),!_this.options.noAriaLabel&&(byChars||byWords)){recursiveAriaLabel(element);toArray(element.querySelectorAll("a, button")).forEach(focusableTag=>{createAriaLabel(focusableTag)})}}),_this.isSplit=!0,_this}function recursiveAriaLabel(element){const blockTags=toArray(element.childNodes).filter(child=>SplitText.BLOCK_TAGS.includes(child.tagName));blockTags.length?blockTags.forEach(child=>{recursiveAriaLabel(child)}):createAriaLabel(element)}function createAriaLabel(element){const span=document.createElement("span");span.classList.add("sr-only"),span.style.setProperty("position","absolute"),span.style.setProperty("width","1px"),span.style.setProperty("height","1px"),span.style.setProperty("padding","0"),span.style.setProperty("margin","-1px"),span.style.setProperty("overflow","hidden"),span.style.setProperty("clip","rect(0, 0, 0, 0)"),span.style.setProperty("white-space","nowrap"),span.style.setProperty("border","0"),span.textContent=element.textContent,element.appendChild(span)}function revert(){0!==_this.originals.length&&(_this.elements.forEach((el,i)=>el.innerHTML=_this.originals[i]),[_this.lines,_this.words,_this.chars,_this.originals].forEach(arr=>arr.length=0),_this.isSplit=!1)}function recursiveBalance(e){e.normalize(),toArray(e.childNodes).forEach(next=>{next.normalize(),next.__lineParent=Boolean(next.tagName&&next.hasChildNodes()&&SplitText.BLOCK_TAGS.includes(next.tagName)),next.__lineParent&&e?.__lineParent&&!e.__isParent&&(e.__lineParent=!1),recursiveBalance(next)})}function recursiveCheckLineParent(e,lineParents){toArray(e.childNodes).forEach(next=>{next.__lineParent&&(next.__idx=null,next.textContent.replace(/\s+/g," ").trim().length>0&&(next.__lines=[createLine()],lineParents.push(next))),recursiveCheckLineParent(next,lineParents)})}function balance(el){_this.lineParents=[],recursiveBalance(el),recursiveCheckLineParent(el,_this.lineParents);let useParent=!0;_this.lineParents.length||(_this.lineParents.push(el),el.__lines=[createLine()],el.__lineParent=!0,el.__idx=null,useParent=!1),el.__lineParent=!0,_this.options.noBalance||_this.lineParents.forEach(e=>BalanceText.relayout(e,_this.options.balanceRatio,useParent))}function recursiveFindBr(e,brs,onlyNew=!0){e.normalize(),toArray(e.childNodes).forEach(next=>{"BR"!==next.tagName||onlyNew&&next.__newBR?recursiveFindBr(next,brs,onlyNew):brs.push(next)})}function findAllBr(el,onlyNew=!0){const brs=[];return recursiveFindBr(el,brs,onlyNew),brs}function splitBr(el){let j=0;const brs=findAllBr(el);for(;j<brs.length;){let i=0,parent=brs[j++].parentElement;if(!parent)return splitBr(el);for(;!parent.__lineParent;){if(i++>=100)return;if(!parent.parentElement)return splitBr(el);const cloneInnerHTML=parent.innerHTML,parentClone=parent.cloneNode(),parentTagName=parentClone.tagName.toLowerCase(),cloneOuterHTML=parentClone.outerHTML.split(`</${parentTagName}>`).join(""),newInnerHTML=cloneInnerHTML.split(/<br\b[^>]*>/).join(`</${parentTagName}><br>${cloneOuterHTML.trim()}`);parent=parent.parentElement,parent.innerHTML=parent.innerHTML.replace(cloneInnerHTML.trim(),newInnerHTML.trim()),toArray(parent.childNodes).forEach(child=>{"BR"===child.tagName?child.__newBR=!0:3!==child.nodeType&&0===child.textContent.trim().length&&child.remove()})}}}function isPrevBr(el){return"BR"===el.previousElementSibling?.tagName}function findLineParent(el){let parent=el.parentElement,found=!1;for(;!found;)parent.__lineParent&&(found=parent),parent=parent.parentElement;return found}function isCJTChar(char){return/[\u4E00-\u9FFF\u3400-\u4DBF\u3040-\u309F\u30A0-\u30FF\uAC00-\uD7AF\u0E00-\u0E7F]/.test(char)}function splitElement(el,key){el.normalize();const elements=[],F=document.createDocumentFragment(),allElements=[];return toArray(el.childNodes).forEach(next=>{if(next.tagName&&!next.hasChildNodes())return allElements.push(next);next.childNodes.length?(allElements.push(next),elements.push(...splitElement(next,key))):function handleRawElement(parentEl,el,key,elements,allElements){const wholeText=el.wholeText||"";let contents=wholeText;if(contents.trim().length){if("word"===key||"char"===key){if(contents=wholeText.trim(),SplitText.SPACES.includes(wholeText[0])&&allElements.push(document.createTextNode(wholeText[0])),_this.options.handleCJT&&"word"===key){const words=contents.split(/(\s+)/).filter(Boolean);for(let i=0;i<words.length;i++){const word=words[i];if(/^\s+$/.test(word)){allElements.push(document.createTextNode(word));continue}let currentWord="",isCJTMode=!1;for(let j=0;j<word.length;j++){const char=word[j],isCurrentCharCJT=isCJTChar(char);if(isCurrentCharCJT!==isCJTMode||j===word.length-1){if(j===word.length-1&&(currentWord+=char),currentWord){const splitEl=createElement(parentEl,key,currentWord);elements.push(splitEl),allElements.push(splitEl),isCJTMode&&(splitEl.__isCJT=!0,_this.chars.push(...splitElement(splitEl,"char")))}currentWord=j===word.length-1?"":char,isCJTMode=isCurrentCharCJT}else currentWord+=char}}}else"char"===key?Array.from(contents).forEach(char=>{const splitEl=createElement(parentEl,key,char);elements.push(splitEl),allElements.push(splitEl)}):contents.split(/([\s\u00A0\u202F]+)/).forEach((part,i)=>{if(i%2==1)allElements.push(document.createTextNode(part));else if(part){const splitEl=createElement(parentEl,key,part);elements.push(splitEl),allElements.push(splitEl)}});SplitText.SPACES.includes(wholeText[wholeText.length-1])&&allElements.push(document.createTextNode(wholeText[wholeText.length-1]))}}else allElements.push(document.createTextNode(wholeText))}(F,next,key,elements,allElements)}),allElements.forEach(e=>F.appendChild(e)),el.innerHTML="",el.appendChild(F),elements}function createLine(parent){const line=document.createElement("span");return line.style.setProperty("display","block"),line.className="line",parent?parent.appendChild(line):line}function createElement(parent,key,text){const el=document.createElement("span");return"word"===key&&el.style.setProperty("display","inline-block"),el.className=key,el.textContent=text,el.setAttribute("aria-hidden",!0),parent.appendChild(el)}function toArray(e,parent){return e&&0!==e.length?e.nodeName?[e]:[].slice.call(e[0].nodeName?e:(parent||document).querySelectorAll(e)):[]}!async function(){if(_this.isHydraX&&await _this.wait(()=>void 0!==_element.div.innerText&&!_element.div.innerText.includes("@[")),_element instanceof HydraObject&&(_element=_element.div),SplitText.usingStega){let stegaSplit=SanityUtils.stegaSplit(_element.textContent);if(stegaSplit.encoded){_element.innerHTML="";let stegaSpan=document.createElement("span");stegaSpan.textContent=stegaSplit.encoded,stegaSpan.setAttribute("aria-hidden",!0),stegaSpan.style.display="none",_element.appendChild(stegaSpan);let cleanText=document.createElement("span");cleanText.textContent=stegaSplit.cleaned,_element.appendChild(cleanText),_element=cleanText}}_this.elements=toArray(_element),_this.options=_options,_this.options.lineThreshold="number"==typeof _this.options.lineThreshold?_this.options.lineThreshold:.2,_this.options.asHydraObject="boolean"!=typeof _this.options.asHydraObject||_this.options.asHydraObject,_this.options.noAriaLabel="boolean"==typeof _this.options.noAriaLabel&&_this.options.noAriaLabel,_this.options.noBalance="boolean"==typeof _this.options.noBalance&&_this.options.noBalance,_this.options.minLines="number"==typeof _this.options.minLines?_this.options.minLines:1,_this.options.handleCJT="boolean"==typeof _this.options.handleCJT&&_this.options.handleCJT,_this.options.type="string"==typeof _this.options.type?_this.options.type:"lines,words",split()}(),_this.split=split,_this.revert=revert,_this.ready=()=>_this.wait("isSplit")},_=>{SplitText.usingStega=!1;const NBSP=String.fromCharCode(160),NNBSP=String.fromCharCode(8239);SplitText.NBSPACES=[NBSP,NNBSP],SplitText.SPACES=[" ",NBSP,NNBSP],SplitText.BLOCK_TAGS=["DIV","H1","H2","H3","H4","H5","H6","P","UL","OL","LI"];const promise=Promise.create();SplitText.isFontReady=function(){return document.fonts.ready.then(promise.resolve),promise}}),Class(function Sprite(_id,_options,...rest){Inherit(this,Element,"svg","Sprite");const $this=this.element;async function applySprite(){if(!_id)return;if(await Spritesheet.ready(),!$this.destroy)return;const symbol=Spritesheet.element.div.querySelector(`#sprite-${_id}`);if(symbol&&_options.viewBox){let value=symbol.getAttribute("viewBox");$this.attr("viewBox",value)}if(symbol&&_options.useChildren){let{childNodes:childNodes}=symbol;for(let i=0;i<childNodes.length;++i)$this.div.appendChild(childNodes[i].cloneNode(!0))}else{let use=document.createElementNS("http://www.w3.org/2000/svg","use");use.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",`#sprite-${_id}`),$this.div.appendChild(use)}}"object"!=typeof _id||_options&&void 0!==_options[0]&&!_options[0].div||(rest=_id,_options={...rest},_id=rest.id),async function(){if(_options&&["css","title","viewBox","useChildren"].find(opt=>Object.prototype.hasOwnProperty.call(_options,opt))||(_options={css:_options,title:rest[0],viewBox:rest[1]},"boolean"==typeof rest[2]&&(_options.useChildren=rest[2])),$this.attr("role","img"),_options.css&&$this.css(_options.css),_options.title&&"string"==typeof _options.title){let el=document.createElementNS("http://www.w3.org/2000/svg","title");el.textContent=_options.title,$this.div.appendChild(el)}applySprite()}(),this.get("id",()=>_id),this.set("id",id=>{if(id!==_id){for(_id=id;$this.div.childNodes.length;)$this.div.removeChild($this.div.childNodes[$this.div.childNodes.length-1]);applySprite()}})}),Class(function Spritesheet(){Inherit(this,Component);const _this=this;_this.url="assets/images/sprite.svg",async function(){await Hydra.ready();const html=await get(Assets.getPath(_this.url));_this.element=Stage.create("Sprites"),_this.element.css({position:"absolute",overflow:"hidden"}),_this.element.size(0,0).setZ(-1).html(html),_this.element.attr("aria-hidden","true"),Stage.add(_this.element),_this.flag("isReady",!0)}(),_this.ready=function(){return _this.wait("isReady")}},"static"),Class(function TheatreJSLoader(){Inherit(this,Component);var _loadPromise,_this=this;_this.loaded=!1,async function(){}(),_this.load=async function(){if(_loadPromise)return _loadPromise;_this.loaded||(_loadPromise=Promise.create(),await AssetLoader.loadAssets(["~assets/js/lib/theatrejs.js"]),await AssetLoader.waitForLib("Theatre"),Theatre.core.setCoreRafDriver(Theatre.core.createRafDriver({name:"no-op driver"})),_this.loaded=!0,_loadPromise.resolve())}},"static"),Class(function UIL(){Inherit(this,Component);const _this=this;let _style,$el,_ui={};this.cms="CMS_FLAG",Hydra.ready(async _=>{if(await UILStorage.ready(),_this.CMS_ONLY=Utils.query("cms")&&!Utils.query("uil"),!Utils.query("cms")&&!Utils.query("uil")||UILStorage.USE_CACHED_FILE)return function doNotLoad(){Hydra.LOCAL&&Utils.query("remoteUIL")&&(_this.sidebar=_this.global=new UILPanel({title:"null"}))}();!async function init(){(function initContainer(){$el=$("UIL"),$el.css({position:"fixed",contain:"strict",top:0}).size("100%","100%").mouseEnabled(!1),document.body.insertAdjacentElement("beforeend",$el.div),$el.setZ(1e5)})(),function initStyle(){let initial='\n.UIL {\n  /********** Range Input Styles **********/\n  /*Range Reset*/\n  /* Removes default focus */\n  /***** Chrome, Safari, Opera and Edge Chromium styles *****/\n  /* slider track */\n  /* slider thumb */\n  /******** Firefox styles ********/\n  /* slider track */\n  /* slider thumb */\n}\n.UIL {\n  --color-black: #000000;\n  --color-white: #ffffff;\n  --color-neutral-0: var(--color-black);\n  --color-neutral-10: #161616;\n  --color-neutral-20: #272727;\n  --color-neutral-30: #303030;\n  --color-neutral-40: #363636;\n  --color-neutral-70: #737373;\n  --color-neutral-80: #8b8c8a;\n  --color-neutral-90: #cccccc;\n  --color-neutral-100: var(--color-white);\n  --color-accent-50: #1a6dea;\n  --color-accent-60: #3787ff;\n  --color-accent-80: #79aeff;\n  --color-error-60: #e64040;\n  --color-error: var(--color-error-60);\n  --color-highlight: var(--color-accent-50);\n  --color-hightlight-light: var(--color-accent-60);\n  --color-highlight-transparent: rgba(26, 109, 234, 0.24);\n  --font-color-base: var(--color-white);\n  --font-color-highlight: var(--color-accent-80);\n  --color-action: var(--color-highlight);\n  --color-action--alt: var(--color-hightlight-light);\n  --color-action--contrast: var(--color-white);\n  --color-action--disabled: var(--color-neutral-70);\n  --color-icon-default: var(--color-neutral-70);\n  --color-divider-main: var(--color-neutral-40);\n  --panel-background-color: var(--color-neutral-10);\n  --font-primary: "Manrope", Helvetica Neue, Helvetica, sans-serif;\n  --font-secondary: var(--font-primary);\n  --font-tertiary: Courier New, Courier, Lucida Sans Typewriter,\n    Lucida Typewriter, monospace;\n  --font-size-base: 11px;\n  --font-family: var(--font-primary);\n  --label1: normal 400 10px/120% var(--font-primary);\n  --label2: normal 400 12px/130% var(--font-primary);\n  --label3: normal 400 13px/130% var(--font-primary);\n  --label3-semi: normal 600 11px/130% var(--font-primary);\n  --label3-bold: normal 700 13px/130% var(--font-primary);\n  --label4-medium: 500 12px/15px var(--font-primary);\n  --line-height: 1.3;\n  --border-radius: 8px;\n  --spacing: 10px;\n  --spacing-small: 8px;\n  --spacing-large: 20px;\n  --border-width: 1px;\n  --border: var(--border-width) solid var(--color-neutral-40);\n  --focus-outline-width: 1px;\n  --focus-outline-offset: 0;\n  --focus-outline: var(--focus-outline-width) solid var(--color-action);\n  --duration: 300ms;\n  --timing: ease-out;\n}\n.UIL *,\n.UIL :after,\n.UIL :before {\n  background-repeat: no-repeat;\n  box-sizing: inherit;\n}\n.UIL :after,\n.UIL :before {\n  text-decoration: inherit;\n  vertical-align: inherit;\n}\n.UIL hr {\n  color: inherit;\n  height: 0;\n  overflow: visible;\n}\n.UIL details,\n.UIL main {\n  display: block;\n}\n.UIL summary {\n  display: list-item;\n}\n.UIL small {\n  font-size: 80%;\n}\n.UIL ul,\n.UIL ol {\n  list-style: none;\n  padding-left: 0;\n}\n.UIL [hidden] {\n  display: none;\n}\n.UIL abbr[title] {\n  border-bottom: none;\n  text-decoration: underline;\n  -webkit-text-decoration: underline dotted;\n          text-decoration: underline dotted;\n}\n.UIL a {\n  background-color: transparent;\n}\n.UIL a:active,\n.UIL a:hover {\n  outline-width: 0;\n}\n.UIL code,\n.UIL kbd,\n.UIL pre,\n.UIL samp {\n  font-family: monospace, monospace;\n}\n.UIL pre {\n  font-size: 1em;\n}\n.UIL b,\n.UIL strong {\n  font-weight: bolder;\n}\n.UIL sub,\n.UIL sup {\n  font-size: 75%;\n  line-height: 0;\n  position: relative;\n  vertical-align: baseline;\n}\n.UIL sub {\n  bottom: -0.25em;\n}\n.UIL sup {\n  top: -0.5em;\n}\n.UIL table {\n  border-color: inherit;\n  text-indent: 0;\n}\n.UIL iframe {\n  border-style: none;\n}\n.UIL [type=number]::-webkit-inner-spin-button,\n.UIL [type=number]::-webkit-outer-spin-button {\n  height: 30px;\n  position: absolute;\n  right: -3px;\n  top: 50%;\n  -webkit-transform: translateY(-50%);\n          transform: translateY(-50%);\n}\n.UIL [type=search] {\n  -webkit-appearance: textfield;\n  outline-offset: -2px;\n}\n.UIL [type=search]::-webkit-search-decoration {\n  -webkit-appearance: none;\n}\n.UIL textarea {\n  overflow: auto;\n  resize: vertical;\n}\n.UIL optgroup {\n  font-weight: 700;\n}\n.UIL button {\n  overflow: visible;\n}\n.UIL button,\n.UIL select {\n  text-transform: none;\n}\n.UIL [role=button],\n.UIL [type=button],\n.UIL [type=reset],\n.UIL [type=submit],\n.UIL button {\n  cursor: pointer;\n}\n.UIL [type=button]::-moz-focus-inner,\n.UIL [type=reset]::-moz-focus-inner,\n.UIL [type=submit]::-moz-focus-inner,\n.UIL button::-moz-focus-inner {\n  border-style: none;\n  padding: 0;\n}\n.UIL [type=button]::-moz-focus-inner,\n.UIL [type=reset]::-moz-focus-inner,\n.UIL [type=submit]::-moz-focus-inner,\n.UIL button:-moz-focusring {\n  outline: 1px dotted ButtonText;\n}\n.UIL [type=reset],\n.UIL [type=submit],\n.UIL button,\n.UIL html [type=button] {\n  -webkit-appearance: button;\n}\n.UIL a:focus,\n.UIL button:focus,\n.UIL input:focus,\n.UIL select:focus,\n.UIL textarea:focus {\n  outline-width: 0;\n}\n.UIL select {\n  -moz-appearance: none;\n  -webkit-appearance: none;\n}\n.UIL select::-ms-expand {\n  display: none;\n}\n.UIL select::-ms-value {\n  color: currentColor;\n}\n.UIL legend {\n  border: 0;\n  color: inherit;\n  display: table;\n  max-width: 100%;\n  white-space: normal;\n}\n.UIL ::-webkit-file-upload-button {\n  -webkit-appearance: button;\n  color: inherit;\n  font: inherit;\n}\n.UIL [disabled] {\n  cursor: default;\n}\n.UIL img {\n  border-style: none;\n}\n.UIL progress {\n  vertical-align: baseline;\n}\n.UIL [aria-busy=true] {\n  cursor: progress;\n}\n.UIL [aria-controls] {\n  cursor: pointer;\n}\n.UIL [aria-disabled=true] {\n  cursor: default;\n}\n.UIL button,\n.UIL [type=button],\n.UIL [type=reset],\n.UIL [type=submit] {\n  -webkit-appearance: none;\n          appearance: none;\n  background-color: transparent;\n  border: var(--border);\n  border-color: var(--color-white);\n  border-radius: calc(var(--border-radius) * 1.5);\n  color: var(--color-action--contrast);\n  cursor: pointer;\n  display: inline-block;\n  font: var(--label4-medium);\n  padding: calc(var(--spacing-small) * 1.5) calc(var(--spacing) * 2);\n  text-align: center;\n  text-decoration: none;\n  transition: background-color var(--duration) var(--timing);\n  -webkit-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  vertical-align: middle;\n  white-space: nowrap;\n}\n.UIL button:hover,\n.UIL [type=button]:hover,\n.UIL [type=reset]:hover,\n.UIL [type=submit]:hover {\n  background-color: var(--color-action);\n  border-color: var(--color-action);\n}\n.UIL button:focus,\n.UIL [type=button]:focus,\n.UIL [type=reset]:focus,\n.UIL [type=submit]:focus {\n  outline: var(--focus-outline);\n  outline-offset: var(--focus-outline-offset);\n}\n.UIL button:disabled,\n.UIL [type=button]:disabled,\n.UIL [type=reset]:disabled,\n.UIL [type=submit]:disabled {\n  cursor: not-allowed;\n  opacity: 0.5;\n}\n.UIL button.solid,\n.UIL [type=button].solid,\n.UIL [type=reset].solid,\n.UIL [type=submit].solid {\n  background-color: var(--color-action);\n  border-color: var(--color-action);\n}\n.UIL button.solid:hover,\n.UIL [type=button].solid:hover,\n.UIL [type=reset].solid:hover,\n.UIL [type=submit].solid:hover {\n  background-color: transparent;\n  border-color: var(--color-white);\n}\n.UIL button.small,\n.UIL [type=button].small,\n.UIL [type=reset].small,\n.UIL [type=submit].small {\n  border-radius: var(--border-radius);\n  font: var(--label1);\n  padding: calc(var(--spacing) / 2) var(--spacing);\n}\n.UIL {\n  --form-box-shadow: inset 0 --border-width 0.1875rem rgba(#000, 0.06);\n  --form-box-shadow-focus: var(--form-box-shadow),\n    0 0 0.3125rem var(--color-action);\n  --form-group-width: 256px;\n  --form-content-max-width: 180px;\n}\n.UIL fieldset {\n  background-color: transparent;\n  border: 0;\n  margin: 0;\n  padding: 0;\n}\n.UIL legend {\n  font-weight: 600;\n  margin-bottom: var(--spacing-small);\n  padding: 0;\n}\n.UIL .form-group {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: var(--spacing-small);\n  width: 100%;\n}\n.UIL .form-group > label,\n.UIL .form-group > .label {\n  word-wrap: break-word;\n  -webkit-hyphens: auto;\n      -ms-hyphens: auto;\n          hyphens: auto;\n  white-space: normal;\n  padding-left: 5px;\n  max-width: calc( (var(--form-group-width) - var(--form-content-max-width) - var(--spacing-small)) * 1.5 );\n}\n.UIL .form-group > *:last-child {\n  width: 100%;\n  max-width: var(--form-content-max-width);\n}\n.UIL .label,\n.UIL label {\n  display: block;\n  font: var(--label2);\n  margin-bottom: 0;\n}\n.UIL input,\n.UIL select,\n.UIL textarea {\n  display: block;\n  font-family: var(--font-family);\n}\n.UIL select {\n  background-color: transparent;\n  border: none;\n  padding-right: calc(var(--spacing) * 2);\n  margin: 0;\n}\n.UIL .select-wrapper {\n  width: 100%;\n}\n.UIL select,\n.UIL [type=color],\n.UIL [type=date],\n.UIL [type=datetime],\n.UIL [type=datetime-local],\n.UIL [type=email],\n.UIL [type=month],\n.UIL [type=number],\n.UIL [type=password],\n.UIL [type=search],\n.UIL [type=tel],\n.UIL [type=text]:not(.no-style),\n.UIL [type=time],\n.UIL [type=url],\n.UIL [type=week],\n.UIL input:not([type]),\n.UIL textarea {\n  -webkit-appearance: none;\n          appearance: none;\n  background-color: var(--color-black);\n  border: var(--border);\n  border-radius: var(--border-radius);\n  box-shadow: var(--form-box-shadow);\n  box-sizing: border-box;\n  color: var(--font-color-highlight);\n  font: var(--label2);\n  margin-bottom: 0;\n  padding: var(--spacing-small);\n  transition: border-color var(--duration) var(--timing);\n  width: 100%;\n  position: relative;\n}\n.UIL select:focus,\n.UIL [type=color]:focus,\n.UIL [type=date]:focus,\n.UIL [type=datetime]:focus,\n.UIL [type=datetime-local]:focus,\n.UIL [type=email]:focus,\n.UIL [type=month]:focus,\n.UIL [type=number]:focus,\n.UIL [type=password]:focus,\n.UIL [type=search]:focus,\n.UIL [type=tel]:focus,\n.UIL [type=text]:focus:not(.no-style),\n.UIL [type=time]:focus,\n.UIL [type=url]:focus,\n.UIL [type=week]:focus,\n.UIL input:not([type]):focus,\n.UIL textarea:focus {\n  box-shadow: var(--form-box-shadow-focus);\n}\n.UIL select:disabled,\n.UIL [type=color]:disabled,\n.UIL [type=date]:disabled,\n.UIL [type=datetime]:disabled,\n.UIL [type=datetime-local]:disabled,\n.UIL [type=email]:disabled,\n.UIL [type=month]:disabled,\n.UIL [type=number]:disabled,\n.UIL [type=password]:disabled,\n.UIL [type=search]:disabled,\n.UIL [type=tel]:disabled,\n.UIL [type=text]:disabled,\n.UIL [type=time]:disabled,\n.UIL [type=url]:disabled,\n.UIL [type=week]:disabled,\n.UIL input:not([type]):disabled,\n.UIL textarea:disabled {\n  cursor: not-allowed;\n}\n.UIL select:disabled:hover,\n.UIL [type=color]:disabled:hover,\n.UIL [type=date]:disabled:hover,\n.UIL [type=datetime]:disabled:hover,\n.UIL [type=datetime-local]:disabled:hover,\n.UIL [type=email]:disabled:hover,\n.UIL [type=month]:disabled:hover,\n.UIL [type=number]:disabled:hover,\n.UIL [type=password]:disabled:hover,\n.UIL [type=search]:disabled:hover,\n.UIL [type=tel]:disabled:hover,\n.UIL [type=text]:disabled:hover,\n.UIL [type=time]:disabled:hover,\n.UIL [type=url]:disabled:hover,\n.UIL [type=week]:disabled:hover,\n.UIL input:not([type]):disabled:hover,\n.UIL textarea:disabled:hover {\n  border: var(--border);\n}\n.UIL select::-webkit-input-placeholder, .UIL [type=color]::-webkit-input-placeholder, .UIL [type=date]::-webkit-input-placeholder, .UIL [type=datetime]::-webkit-input-placeholder, .UIL [type=datetime-local]::-webkit-input-placeholder, .UIL [type=email]::-webkit-input-placeholder, .UIL [type=month]::-webkit-input-placeholder, .UIL [type=number]::-webkit-input-placeholder, .UIL [type=password]::-webkit-input-placeholder, .UIL [type=search]::-webkit-input-placeholder, .UIL [type=tel]::-webkit-input-placeholder, .UIL [type=text]::-webkit-input-placeholder, .UIL [type=time]::-webkit-input-placeholder, .UIL [type=url]::-webkit-input-placeholder, .UIL [type=week]::-webkit-input-placeholder, .UIL input:not([type])::-webkit-input-placeholder, .UIL textarea::-webkit-input-placeholder {\n  color: var(--font-color-base);\n  opacity: 0.25;\n}\n.UIL select:-ms-input-placeholder, .UIL [type=color]:-ms-input-placeholder, .UIL [type=date]:-ms-input-placeholder, .UIL [type=datetime]:-ms-input-placeholder, .UIL [type=datetime-local]:-ms-input-placeholder, .UIL [type=email]:-ms-input-placeholder, .UIL [type=month]:-ms-input-placeholder, .UIL [type=number]:-ms-input-placeholder, .UIL [type=password]:-ms-input-placeholder, .UIL [type=search]:-ms-input-placeholder, .UIL [type=tel]:-ms-input-placeholder, .UIL [type=text]:-ms-input-placeholder, .UIL [type=time]:-ms-input-placeholder, .UIL [type=url]:-ms-input-placeholder, .UIL [type=week]:-ms-input-placeholder, .UIL input:not([type]):-ms-input-placeholder, .UIL textarea:-ms-input-placeholder {\n  color: var(--font-color-base);\n  opacity: 0.25;\n}\n.UIL select::-ms-input-placeholder, .UIL [type=color]::-ms-input-placeholder, .UIL [type=date]::-ms-input-placeholder, .UIL [type=datetime]::-ms-input-placeholder, .UIL [type=datetime-local]::-ms-input-placeholder, .UIL [type=email]::-ms-input-placeholder, .UIL [type=month]::-ms-input-placeholder, .UIL [type=number]::-ms-input-placeholder, .UIL [type=password]::-ms-input-placeholder, .UIL [type=search]::-ms-input-placeholder, .UIL [type=tel]::-ms-input-placeholder, .UIL [type=text]::-ms-input-placeholder, .UIL [type=time]::-ms-input-placeholder, .UIL [type=url]::-ms-input-placeholder, .UIL [type=week]::-ms-input-placeholder, .UIL input:not([type])::-ms-input-placeholder, .UIL textarea::-ms-input-placeholder {\n  color: var(--font-color-base);\n  opacity: 0.25;\n}\n.UIL select::placeholder,\n.UIL [type=color]::placeholder,\n.UIL [type=date]::placeholder,\n.UIL [type=datetime]::placeholder,\n.UIL [type=datetime-local]::placeholder,\n.UIL [type=email]::placeholder,\n.UIL [type=month]::placeholder,\n.UIL [type=number]::placeholder,\n.UIL [type=password]::placeholder,\n.UIL [type=search]::placeholder,\n.UIL [type=tel]::placeholder,\n.UIL [type=text]::placeholder,\n.UIL [type=time]::placeholder,\n.UIL [type=url]::placeholder,\n.UIL [type=week]::placeholder,\n.UIL input:not([type])::placeholder,\n.UIL textarea::placeholder {\n  color: var(--font-color-base);\n  opacity: 0.25;\n}\n.UIL [type=search] {\n  -webkit-appearance: textfield;\n}\n.UIL textarea {\n  resize: vertical;\n}\n.UIL [type=file] {\n  width: 100%;\n}\n.UIL select {\n  width: 100%;\n}\n.UIL input:focus-visible:not(.no-style),\n.UIL textarea:focus-visible,\n.UIL select:focus-visible {\n  outline: var(--focus-outline);\n  outline-offset: var(--focus-outline-offset);\n}\n.UIL input[type=checkbox]:not(.regular-checkbox),\n.UIL input[type=radio] {\n  height: 0;\n  width: 0;\n  visibility: visible;\n  margin: 0;\n}\n.UIL input[type=checkbox]:not(.regular-checkbox) + label,\n.UIL input[type=radio] + label {\n  cursor: pointer;\n  border: var(--border);\n  text-indent: -9999px;\n  width: 44px;\n  height: 28px;\n  background: var(--color-black);\n  display: block;\n  border-radius: 28px;\n  position: relative;\n}\n.UIL input[type=checkbox]:not(.regular-checkbox) + label:after,\n.UIL input[type=radio] + label:after {\n  content: "";\n  position: absolute;\n  top: 8px;\n  left: 8px;\n  width: 12px;\n  height: 12px;\n  background-color: var(--color-action--disabled);\n  border-radius: 12px;\n  transition: 0.3s;\n}\n.UIL input[type=checkbox]:not(.regular-checkbox):checked + label,\n.UIL input[type=radio]:checked + label {\n  background: var(--color-action);\n}\n.UIL input[type=checkbox]:not(.regular-checkbox):checked + label:after,\n.UIL input[type=radio]:checked + label:after {\n  background-color: var(--color-white);\n}\n.UIL input[type=checkbox]:not(.regular-checkbox):checked + label:after,\n.UIL input[type=radio]:checked + label:after {\n  left: calc(100% - 8px);\n  -webkit-transform: translateX(-100%);\n          transform: translateX(-100%);\n}\n.UIL input[type=checkbox]:not(.regular-checkbox) + label:active:after,\n.UIL input[type=radio] + label:active:after {\n  width: 16px;\n}\n.UIL input[type=checkbox]:not(.regular-checkbox):focus-visible,\n.UIL input[type=radio]:focus-visible {\n  outline: none;\n  border: none;\n}\n.UIL input[type=checkbox]:not(.regular-checkbox):focus-visible + label,\n.UIL input[type=checkbox]:not(.regular-checkbox):focus-visible + .label,\n.UIL input[type=radio]:focus-visible + label,\n.UIL input[type=radio]:focus-visible + .label {\n  border: var(--border);\n  border-color: var(--color-action);\n}\n.UIL input[type=checkbox]:not(.regular-checkbox):focus-visible:checked + label,\n.UIL input[type=checkbox]:not(.regular-checkbox):focus-visible:checked + .label,\n.UIL input[type=radio]:focus-visible:checked + label,\n.UIL input[type=radio]:focus-visible:checked + .label {\n  border: var(--border);\n  border-color: var(--color-white);\n}\n.UIL .checkbox-control {\n  display: flex;\n  gap: calc(var(--spacing-small) / 2);\n  align-items: center;\n  line-height: 1;\n}\n.UIL .regular-checkbox {\n  -webkit-appearance: none;\n          appearance: none;\n  background-color: var(--color-black);\n  margin: 0;\n  width: 20px;\n  height: 20px;\n  max-width: 20px;\n  min-width: 20px;\n  color: currentColor;\n  border: var(--border);\n  border-radius: calc(var(--border-radius) / 2);\n  -webkit-transform: translateY(-0.075em);\n          transform: translateY(-0.075em);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.UIL .regular-checkbox:before {\n  border-radius: calc(var(--border-radius) / 4);\n  content: "";\n  width: calc(20px / 2);\n  height: calc(20px / 2);\n  -webkit-transform: scale(0);\n          transform: scale(0);\n  transition: 120ms -webkit-transform ease-in-out;\n  transition: 120ms transform ease-in-out;\n  transition: 120ms transform ease-in-out, 120ms -webkit-transform ease-in-out;\n  box-shadow: inset 1em 1em var(--color-action);\n}\n.UIL .regular-checkbox:checked::before {\n  -webkit-transform: scale(1);\n          transform: scale(1);\n}\n.UIL {\n  box-sizing: border-box;\n  scroll-behavior: smooth;\n}\n.UIL *,\n.UIL *::before,\n.UIL *::after {\n  box-sizing: inherit;\n}\n.UIL figure {\n  margin: 0;\n}\n.UIL img,\n.UIL picture {\n  display: block;\n  margin: 0;\n  max-width: 100%;\n}\n.UIL {\n  color: var(--font-color-base);\n  font-family: var(--font-family);\n  font-size: var(--font-size-base);\n  line-height: var(--line-height);\n  letter-spacing: 0.01em;\n}\n.UIL ::selection {\n  background-color: var(--color-action);\n  color: var(--color-action--contrast);\n}\n.UIL p {\n  margin: 0 0 var(--spacing-small);\n  overflow-wrap: break-word;\n  -webkit-hyphens: auto;\n      -ms-hyphens: auto;\n          hyphens: auto;\n}\n.UIL a {\n  -webkit-text-decoration-skip: ink;\n          text-decoration-skip-ink: auto;\n  transition: color var(--duration) var(--timing);\n}\n.UIL a:focus {\n  outline: var(--focus-outline);\n  outline-offset: var(--focus-outline-offset);\n}\n.UIL hr {\n  border-bottom: var(--border);\n  border-left: 0;\n  border-right: 0;\n  border-top: 0;\n  margin: var(--spacing) 0;\n}\n.UIL .color-selector {\n  background-color: var(--color-black);\n  border: var(--border);\n  border-radius: var(--border-radius);\n  box-shadow: var(--form-box-shadow);\n  color: var(--font-color-highlight);\n  font: var(--label2);\n  margin-bottom: 0;\n  padding: var(--spacing-small);\n  transition: border-color var(--duration) var(--timing);\n  width: 100%;\n  position: relative;\n  display: flex;\n  gap: var(--spacing-small);\n  align-items: center;\n}\n.UIL .color-selector:has(input:focus-visible) {\n  outline: var(--focus-outline);\n  outline-offset: var(--focus-outline-offset);\n}\n.UIL .color-selector .color-chip {\n  width: 20px;\n  height: 16px;\n  border-radius: calc(var(--border-radius) / 2);\n  border: var(--border);\n}\n.UIL .color-selector .color-text {\n  text-transform: uppercase;\n}\n.UIL .color-selector .hidden {\n  position: absolute;\n  left: 0;\n  opacity: 0;\n}\n.UIL {\n  --thumb-size: var(--spacing-small);\n  --thumb-radius: calc(var(--thumb-size) / 2);\n  --color-track: var(--color-black);\n  --track-height: calc(var(--thumb-size) / 2);\n}\n.UIL input[type=range] {\n  -webkit-appearance: none;\n  appearance: none;\n  background: transparent;\n  cursor: pointer;\n  width: 100%;\n}\n.UIL input[type=range]:focus {\n  outline: none;\n}\n.UIL input[type=range]::-webkit-slider-runnable-track {\n  background-color: var(--color-track);\n  border-radius: calc(var(--track-height) / 2);\n  height: var(--track-height);\n  border: var(--border);\n}\n.UIL input[type=range]::-webkit-slider-thumb {\n  -webkit-appearance: none;\n  /* Override default look */\n  appearance: none;\n  margin-top: -4px;\n  /* Centers thumb on the track */\n  /*custom styles*/\n  background-color: var(--color-action);\n  height: var(--thumb-size);\n  width: var(--thumb-size);\n  border-radius: var(--thumb-radius);\n}\n.UIL input[type=range]:focus::-webkit-slider-thumb {\n  border: var(--border);\n  outline: 1px solid var(--color-hightlight-light);\n  outline-offset: 0.125rem;\n}\n.UIL input[type=range]::-moz-range-track {\n  background-color: var(--color-track);\n  border-radius: calc(var(--track-height) / 2);\n  height: var(--track-height);\n  border: var(--border);\n}\n.UIL input[type=range]::-moz-range-thumb {\n  border: none;\n  /*Removes extra border that FF applies*/\n  border-radius: var(--thumb-radius);\n  /*Removes default border-radius that FF applies*/\n  /*custom styles*/\n  background-color: var(--color-action);\n  height: var(--thumb-size);\n  width: var(--thumb-size);\n}\n.UIL input[type=range]:focus::-moz-range-thumb {\n  border: var(--border);\n  outline: 1px solid var(--color-hightlight-light);\n  outline-offset: 0.125rem;\n}\n.UIL ::-webkit-scrollbar {\n  width: 2px;\n  height: 2px;\n}\n.UIL ::-webkit-scrollbar-track {\n  background: var(--color-neutral-10);\n}\n.UIL ::-webkit-scrollbar-thumb {\n  background: var(--color-highlight);\n}\n.UIL .sr-only,\n.UIL .visibility-hidden {\n  position: absolute;\n  width: 1px;\n  height: 1px;\n  margin: -1px;\n  padding: 0;\n  overflow: hidden;\n  clip: rect(0, 0, 0, 0);\n  border: 0;\n}\n',style=document.head.appendChild(document.createElement("style"));style.type="text/css",style.id="uil-style",style.appendChild(document.createTextNode(initial)),_style=style}(),function initSidebar(){_this.add(new UILPanel({title:"sidebar"})),_this.add(new UILPanel({title:"global",options:{side:"left",hideToolbar:!0}}));let list=[{id:"playground",label:"Graph",content:null,active:!0,disabled:!1,hidden:!1,draggable:!1,hideToobar:!0},{id:"global",label:"Global",content:null,active:!1,disabled:!1,hidden:!1,draggable:!1},{id:"performance",label:"Performance",content:UILPerformance,active:!1,disabled:!1,hidden:!1,draggable:!1},{id:"memory",label:"Memory",content:UILMemory,active:!1,disabled:!1,hidden:!1,draggable:!1},{id:"tools",label:"",content:UILToolsTab,active:!1,disabled:!1,hidden:!1,draggable:!1}];_this.CMS_ONLY?(_this.add(new UILPanel({title:"cms",options:{side:"left",hideToolbar:!0}})),list=[list[0]],_this.globalTabs=_this.initClass(UILBaseTabs,list,[_this.cms.element])):_this.globalTabs=_this.initClass(UILBaseTabs,list,[_this.global.element])}(),function initGraph(){if(!_this.sidebar)return;_this.globalTabs.addGraph(UILGraph.instance().element.div)}(),function initSaveIndicator(){_this.saveIndicator=_this.initClass(UILSaveIndicator,[$el])}(),function initAssetsExplorer(){_this.assetsExplorer=_this.initClass(UILAssetsExplorer,[$el])}(),UILRemote.auth.isAuthenticated||function initGate(){_this.gate=_this.initClass(UILGate,[$el]),_this.gate.animateIn()}();AppState.bind("UIL/publish",async({type:type})=>{let requestId=Utils.uuid();try{AppState.set("UIL/publishError",null),AppState.set("UIL/publishing",{requestId:requestId,type:type}),await UILPublish.publish(type)}catch(error){AppState.set("UIL/publishError",{requestId:requestId,type:type,error:error})}finally{AppState.get("UIL/publishing")?.requestId===requestId&&AppState.set("UIL/publishing",!1)}})}(),_this.loaded=!0}),this.ready=function(){return _this.wait(_this,"loaded")},this.add=function(panel){return _ui[panel.id]=panel,_this[panel.id]=panel,$el.add(panel),_this},this.remove=function(id){let $panel=_ui[id];return $panel.eliminate&&$panel.eliminate(),$panel.destroy(),delete _ui[id],delete _this[id],_this},this.find=function(id){return Object.values(_ui).reduce((acc,el)=>acc.concat(el.find(id)),[])},this.enableSorting=function(id,enable){let el=_this.find(id)[0];return el&&el.enableSorting&&el.enableSorting(enable),_this},this.addCSS=function(control,style){if(control.styled)return;let node=document.createTextNode(style);return _style&&_style.appendChild(node),control.styled=!0,_this},this.REORDER="uil_reorder"},"static"),Class(function CameraUIL(){this.UPDATE="camera_uil_update",this.add=function(light,group){return new CameraUILConfig(light,null===group?null:group||UIL.global)}},"static"),Class(function CameraUILConfig(_camera,_uil){const _this=this;if(!_camera.prefix)throw"camera.prefix required when using MeshUIL";var prefix="CAMERA_"+_camera.prefix,_group=_uil?createFolder():null,_dynamicFOVCallback=null;function createFolder(){if(!UIL.sidebar)return null;let folder=new UILFolder(prefix,{label:_camera.prefix,closed:!0});return _uil.add(folder),folder}function initFOV(key){let initValue=UILStorage.get(`${prefix}${key}`)||_camera.camera.fov||9999;if(_group){let number=new UILControlNumber(`${prefix}${key}`,{label:key,value:initValue,step:.05});number.onFinishChange(e=>{_group&&_this["tweenUIL_"+key]?.(e),_camera.setFOV(e),UILStorage.set(`${prefix}${key}`,e)}),_group.add(number)}defer(_=>{_camera.setFOV(initValue)})}function initVec(key){let initValue=UILStorage.get(`${prefix}${key}`)||_camera[key]?.toArray();if(initValue){if(_group){UILStorage.state.bind(`${prefix}${key}`,val=>_camera[key].fromArray(val));let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:initValue,step:.05});vector.onChange(e=>{_group&&_this["tweenUIL_"+key]?.(e),_camera[key].fromArray(e)}),vector.onFinishChange(e=>UILStorage.set(`${prefix}${key}`,e)),_group.add(vector),_this["forceUpdate"+key.toUpperCase()]=_=>{let val=_camera[key].toArray();_this["tweenUIL_"+key]?_this["tweenUIL_"+key](val):vector.force(_camera[key].toArray(),!0)}}_camera[key].fromArray(initValue)}}function initNumber(key){let initValue=UILStorage.get(`${prefix}${key}`)||(void 0===_camera[key]?9999:_camera[key]);if(_group){UILStorage.state.bind(`${prefix}${key}`,val=>_camera[key]=val);let number=new UILControlNumber(`${prefix}${key}`,{label:key,value:initValue,step:.05});number.onChange(e=>{_camera[key]=e,_group&&_this["tweenUIL_"+key]?.(e)}),number.onFinishChange(e=>UILStorage.set(`${prefix}${key}`,e)),_group.add(number)}_camera[key]=initValue}function initRotation(key,applyValue){let toRadians=array=>array?(array.length=3,array.map(x=>Math.radians(x))):[0,0,0],initValue=toRadians(UILStorage.get(`${prefix}${key}`));if(_group){UILStorage.state.bind(`${prefix}${key}`,val=>{(_camera[key]||_camera.group[key]).fromArray(toRadians(val))});let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:(array=initValue,array?(array.length=3,array.map(x=>Math.degrees(x))):[0,0,0])});vector.onChange(e=>{_group&&_this["tweenUIL_"+key]?.(toRadians(e)),applyValue(toRadians(e),key)}),vector.onFinishChange(e=>UILStorage.set(`${prefix}${key}`,e)),_group.add(vector)}var array;applyValue(initValue,key)}function initDynamicFOV(key){let defaultCode="",code=UILStorage.get(`${prefix}${key}Code`)||defaultCode,evalCode=function(value){let method=value.includes("return")?`(function(){ return function getFOV() { ${value}}})()`:`(function(){ return function getFOV() { return ${value}}})()`;_camera._getDynamicFOV=eval(method)};if(_group){let editCode=_=>{let editor=new UILExternalEditor(`${prefix}${key}`,400,900);editor.setCode(code,"c"),editor.onSave=value=>{UILStorage.set(`${prefix}${key}Code`,value),evalCode(value),code=value,_camera.dynamicFOV()}},btn=new UILControlButton("btn",{actions:[{title:"Dynamic FOV",callback:editCode}],hideLabel:!0});_group.add(btn)}defer(_=>{evalCode(code),_camera.dynamicFOV=_=>{if(_camera.camera.isOrthographicCamera)return;let fov=_camera._getDynamicFOV?.()||_camera.camera.fov;if(isNaN(fov))return console.warn(`${prefix} Dynamic FOV requires a float value`);_camera.setFOV(fov)},_camera.onResize(_=>_camera.dynamicFOV())})}function initType(){let initValue=UILStorage.get(`${prefix}type`)||"perspective";if(_group){let control=new UILControlSelect(`${prefix}type`,{label:"Type",value:initValue,options:[{label:"Perspective",value:"perspective"},{label:"Orthographic",value:"orthographic"}]});UILStorage.state.bind(`${prefix}type`,val=>control.onChange(val)),control.onChange(e=>{"orthographic"===e?_camera.useOrthographic():_camera.usePerspective()}),control.onFinishChange(e=>UILStorage.set(`${prefix}type`,e)),_group.add(control)}"orthographic"===initValue&&_camera.useOrthographic()}function addListeners(){Events.emitter._addEvent(CameraUIL.UPDATE,update,_this)}function update(e){e.prefix==prefix&&e.group!=_this&&(e.fov&&_camera.setFOV(e.val),e.number&&(_camera[e.key]=e.val),e.rotation&&_camera.group[e.key].fromArray(e.val),e.vec&&_camera[e.key].fromArray(e.val))}initType(),_camera.position&&initVec("position"),_camera.group&&(_camera.groupPos=_camera.group.position,initVec("groupPos"),initRotation("rotation",(value,key)=>{_camera.group[key].fromArray(value)})),initFOV("fov"),initNumber("zoom"),initNumber("near"),initNumber("far"),_camera.moveXY&&(initVec("moveXY"),initVec("lookAt"),initRotation("cameraRotation",(value,key)=>{_camera[key].fromArray(value)}),initVec("viewportFocus"),initNumber("lerpSpeed"),initNumber("lerpSpeed2"),initNumber("deltaRotate"),initNumber("deltaLerp"),initNumber("wobbleSpeed"),initNumber("wobbleStrength"),initNumber("wobbleZ")),initDynamicFOV("dynamicFOV"),_group&&addListeners(),this.setLabel=function(name){_group&&_group.setLabel(name)}}),Class(function InputUIL(){this.UPDATE="inputUil_Update",this.create=function(name,group,decoupled){return new InputUILConfig(name,null===group?null:group||UIL.global,decoupled)}},"static"),Class(function InputUILConfig(_name,_uil,_decoupled,_slim){var _cache,_this=this;const prefix="INPUT_"+_name;var _group=_uil?function createFolder(){if(!UIL.sidebar)return null;let folder=new UILFolder(_name,{closed:!0});_decoupled||(_uil.add?.(folder),_uil==UIL.sidebar&&folder.hide());return folder}():null,_fields=_uil?{}:null;function getUILStorage(){return _this.CMS?UILStorage.setCMS:UILStorage.set}function externalUpdate(e){e.prefix==prefix&&e.group!=_this&&(getUILStorage()(`${prefix}_${e.key}`,e.value),_this.onUpdate&&_this.onUpdate(e.key))}_this.group=_group,_this.keys=[],_uil?.add&&function addListeners(){Events.emitter._addEvent(InputUIL.UPDATE,externalUpdate,_this)}(),this.state=AppState.createLocal(),this.get=function(key){if(_cache&&void 0!==_cache[key])return _cache[key];let val=UILStorage.get(`${prefix}_${key}`);return"boolean"==typeof val?val:val&&""!=val?"true"===val||"false"!==val&&(val.charAt&&"["==val.charAt(0)?JSON.parse(val):(UIL.global||(_cache||(_cache={}),_cache[key]||(_cache[key]=val)),val)):void 0},this.getFilePath=function(key){let data=this.get(key);return"{"===data?.charAt?.(0)?(data=JSON.parse(data),data.relative.includes(".")?data.relative:data.src):"object"==typeof data?data.relative.includes(".")?data.relative:data.src:data},this.getNumber=function(key){let number=Number(this.get(key));return isNaN(number)&&(number=0),number},_slim||(this.add=function(key,initValue,uil=window.UILControlText,options,params={}){if(_this.CMS&&defer(_=>{_this.onUpdate(key)}),_this.keys.push(key),!_group||"hidden"==initValue||!UIL.sidebar)return this;let fallback;"string"==typeof uil&&(fallback=uil,uil=window.UILControlText);let value=UILStorage.get(`${prefix}_${key}`);if(void 0===value&&fallback&&(value=UILStorage.get(`${prefix}_${fallback}`)),"true"===value&&(value=!0),"false"===value&&(value=!1),uil==UILControlVector&&"string"==typeof value&&(value=JSON.parse(value)),void 0===value&&(value=initValue),"string"==typeof value&&(uil==UILControlImage||uil==UILControlFile))try{value=JSON.parse(value)}catch(e){}let change=(val,fromInit)=>{val="string"==typeof val?val:JSON.stringify(val),getUILStorage()(`${prefix}_${key}`,val),_this.onUpdate&&_this.onUpdate(key,val),fromInit||Events.emitter._fireEvent(InputUIL.UPDATE,{prefix:prefix,key:key,value:val,group:_this})};"string"!=typeof initValue&&"number"!=typeof initValue&&uil!=UILControlVector||UILStorage.get(`${prefix}_${key}`)||change(initValue,!0);let opts=Utils.mergeObject(params,{label:key,value:value,options:options});uil==window.UILControlButton&&(opts=options);let config=new uil(`${prefix}_${key}`,opts);return config.onFinishChange(change),UILStorage.state.bind(`${prefix}_${key}`,val=>_this.state.set(key,val)),uil!=UILControlVector&&uil!=UILControlRange||config.onChange(change),_group.add(config),_fields[key]=config,this},this.addToggle=function(key,initValue){return UIL.sidebar?this.add(key,initValue,UILControlCheckbox):this},this.addSelect=function(key,options){return UIL.sidebar?this.add(key,null,UILControlSelect,options):this},this.addImage=function(key,options){return UIL.sidebar?this.add(key,null,UILControlImage,null,options):this},this.addFile=function(key,options){if(!UIL.sidebar)return this;this.get(key);return this.add(key,null,UILControlFile,null,options)},this.addRange=function(key,initValue,options){return UIL.sidebar?this.add(key,initValue,UILControlRange,null,options):this},this.addNumber=function(key,initValue,step){return UIL.sidebar?this.add(key,initValue,UILControlNumber,null,{step:step}):this},this.addColor=function(key,initValue=new Color){return UIL.sidebar?this.add(key,initValue.getHexString(),UILControlColor):this},this.addTextarea=function(key,initValue){return UIL.sidebar?this.add(key,initValue,UILControlTextarea,null,{monospace:!0,rows:4}):this},this.addButton=function(key,options){if(!UIL.sidebar)return this;if("function"==typeof options){let cb=options;options={actions:[{title:key,callback:_=>cb(key)}],hideLabel:!0}}return this.add(key,null,UILControlButton,options)},this.addVector=function(key,initValue,options){return UIL.sidebar?(options||(options={step:.05}),this.add(key,initValue,UILControlVector,null,options)):this},this.getImage=function(key){let data=this.get(key);if(data)return"object"!=typeof data&&(data=JSON.parse(data)),data?.src},this.setValue=function(key,value){if(getUILStorage()(`${prefix}_${key}`,value),_this.onUpdate&&_this.onUpdate(key),_this.state.set(key,value),_fields){let field=_fields[key];field&&(field.value=value,field.update&&field.update())}return this},this.copyFrom=function(input,fields){fields.forEach(key=>{let val=input.get(key);void 0!==val&&("string"!=typeof val&&(val=JSON.stringify(val)),_this.setValue(key,val))})},this.setLabel=function(name){_group&&_group.setLabel(name)},this.getField=function(key){if(_fields)return _fields[key]},this.setDescription=function(key,desc){_this.getField(key)?.setDescription(desc)})}),Class(function ListUIL(){Inherit(this,Component);const _this=this;var _panel,_created={};function removePanel(){_panel&&_panel.destroy&&(_this.events.unsub(_panel,Events.COMPLETE,removePanel),_panel=_panel.destroy())}this.create=function(id,version=1,group){"number"!=typeof version&&(group=version,version=1),group=null===group?null:group||UIL.global;let config=new ListUILConfig(id,version,UIL.global&&!_created[id]);return UIL.global&&(_created[id]||(_created[id]=config,null!=group&&config.appendUILGroup(group||UIL.global))),config},this.openPanel=function(id,name,template){return removePanel(),_panel=new ListUILEditor(id,name,template),_this.events.sub(_panel,Events.COMPLETE,removePanel),_panel},this.set=function(){},this.get=function(){},this.getPanel=function(){return _panel}},"static"),Class(function ListUILConfig(_id,_version=1,_store){Inherit(this,Component);const _this=this;var _items,_folder,_config,_template={onSort:_=>{},onAdd:_=>{},onRemove:_=>{}},_name="";function updateConfig(){_config.version=_version}function edit(){let panel=ListUIL.openPanel(_id,_name,_this.template);_this.events.bubble(panel,Events.UPDATE),_this.events.fire(ListUIL.OPEN)}_store&&(_items=[]),function initConfig(){(_config=UILStorage.get(function name(){return`LIST_${_id}_config`}()))?_config.version!=_version&&updateConfig():(_config={},updateConfig())}(),this.add=function(item){return _items&&_items.push(item),item},this.template=function(config){return"function"==typeof config&&(_template=config),_template},this.appendUILGroup=function(uil){let folder=new UILFolder("LIST_"+_id,{closed:!0}),button=new UILControlButton("button",{actions:[{title:"Edit List",callback:edit}],hideLabel:!0});folder.add(button),uil.add(folder),_folder=folder},this.setLabel=function(name){_folder&&_folder.setLabel(name),_name=name},this.onAdd=function(cb){_template.onAdd=cb},this.onRemove=function(cb){_template.onRemove=cb},this.onSort=function(cb){_template.onSort=cb},this.internalAddItems=function(count){if(!count)return;let array=[];for(let i=0;i<count;i++){let id=`${_id}_${Utils.timestamp()}`;array.push(id)}UILStorage.set(`${_id}_list_items`,JSON.stringify(array))}},_=>{ListUIL.OPEN="list_uil_open"}),Class(function ListUILEditor(_id,_name,_template){Inherit(this,Component);const _this=this,PANEL_CONFIG={label:_name||"List",width:"400px",height:"auto",drag:!0};var _gui,_list,_add,_items,_tabs=[],_index=0;function initList(){!function read(){let data=UILStorage.get(`${_id}_list_items`);void 0===data&&(data="[]");_items=JSON.parse(data)}(),(_list=new UILFolder(`${_id}_list`,{hideTitle:!0})).enableSorting(_id),_gui.add(_list);for(let id of _items){let view=new ListUILItem(id,_list,_template,_index++);_this.events.sub(view,Events.UPDATE,reorder),_this.events.sub(view,Events.END,remove),_tabs.push(view)}}function initAdd(){!function initButton(title,callback){_add=new UILControlButton("button",{actions:[{title:title,callback:callback}],hideLabel:!0}),_gui.add(_add)}("Add Item",add)}function add(){let id=`${_id}_${Utils.timestamp()}`,view=new ListUILItem(id,_list,_template,_index++);_this.events.sub(view,Events.UPDATE,reorder),_this.events.sub(view,Events.END,remove),_tabs.push(view),_items.push(id),write()}function reorder(e){let order=[];for(let item of e.order)order.push(item.split("_folder")[0]);_items=order,_template().onSort(_items),write(),_this.events.fire(Events.UPDATE,{order:order})}function close(){_this.events.fire(Events.COMPLETE)}function remove(e){_items.remove(e.id),write(),refresh()}function write(){let data=JSON.stringify(_items);UILStorage.set(`${_id}_list_items`,data)}function refresh(){_index=0,_list&&_list.destroy&&(_list=_list.destroy()),_add&&_add.destroy&&(_add=_add.destroy()),initList(),initAdd()}!function initPanel(){_this.gui=_gui=new UILWindow(_id,PANEL_CONFIG),_this.gui.onClose=close,UIL.add(_gui)}(),refresh(),this.onDestroy=function(){_gui.destroy()},this.add=function(){add()}}),Class(function ListUILItem(_id,_parent,_template,_index){Inherit(this,Component);const _this=this;var _folder;function onDelete(){if(!confirm("You sure you want to delete this?"))return;let id=_id;_template().onRemove(id),_this.events.fire(Events.END,{id:id})}function onReorder(e){_this.events.fire(Events.UPDATE,e)}!async function initFolder(){(_folder=InputUIL.create(`${_id}_folder`,_parent)).setLabel("Item"),_folder.group.draggable(!0),_this.events.sub(_folder.group,UIL.REORDER,onReorder),_folder.listUILItem=_this}(),function initTemplate(){let id=_id;(0,_template().onAdd)(id,_folder,_index)}(),function initUI(){let actions=[{title:"Delete",callback:onDelete}],hideLabel=!0;_folder.addButton("delete",{actions:actions,hideLabel:hideLabel})}(),this.setLabel=function(label){_folder.setLabel(label)},this.forceSort=function(index){_folder.group.forceSort(index)},this.open=function(){_folder.group.open(),_folder.group.openChildren()},this.close=function(){_folder.group.close()}}),Class(function MeshUIL(){Inherit(this,Component);this.exists={},this.UPDATE="mesh_uil_update",this.add=function(mesh,group){return(group=null===group?null:group)&&(mesh.__uilGroup=group),new MeshUILConfig(mesh,group)}},"static"),Class(function MeshUILConfig(_mesh,_uil){const _this=this;if(!_mesh.prefix)throw"mesh.prefix required when using MeshUIL";var _hmr,prefix="MESH_"+_mesh.prefix,_group=_uil&&!MeshUIL.exists[prefix]?function createFolder(){if(!UIL.sidebar)return null;let folder=new UILFolder(prefix,{label:_mesh.prefix,closed:!0});return _uil.add(folder),folder}():null,_controls=_group?{}:null;function initVec(key){let initValue=UILStorage.get(`${prefix}${key}`)||_mesh[key].toArray();if(_group){UILStorage.state.bind(`${prefix}${key}`,val=>_mesh[key].fromArray(val));let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:initValue,step:.05});vector.onChange(e=>{_mesh[key].fromArray(e),_group&&_this["tweenUIL_"+key]?.(e)}),vector.onFinishChange(save),_group.add(vector),_this["forceUpdate"+key.toUpperCase()]=_=>{let val=_mesh[key].toArray();_this["tweenUIL_"+key]?_this["tweenUIL_"+key](val):vector.force(_mesh[key].toArray(),!0)},_controls[key]=vector}_mesh[key].fromArray(initValue)}function save(){for(let key in _controls){let value=_controls[key].value;UILStorage.set(`${prefix}${key}`,value)}}function update(e){e.prefix==prefix&&e.group!=_this&&_mesh[e.key].fromArray(e.val)}function handleInstanceReloaded({className:className,oldInstance:oldInstance,newInstance:newInstance}){if(className===_hmr.className){let prefix=_mesh.prefix;(_mesh=newInstance.group).prefix=prefix,_mesh.position.fromArray(_hmr.position||_controls.position.value),_mesh.rotation.fromArray(_hmr.rotation||_controls.rotation.value.map(Math.radians)),_mesh.scale.fromArray(_hmr.scale||_controls.scale.value)}}this.group=_group,initVec("position"),initVec("scale"),function initRotation(){let key="rotation",toRadians=array=>array?(array.length=3,array.map(x=>Math.radians(x))):[0,0,0],toDegrees=array=>array?(array.length=3,array.map(x=>Math.degrees(x))):[0,0,0],initValue=toRadians(UILStorage.get(`${prefix}${key}`));if(_group){UILStorage.state.bind(`${prefix}${key}`,val=>_mesh[key].fromArray(toRadians(val)));let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:toDegrees(initValue)});vector.onChange(e=>{_mesh[key].fromArray(toRadians(e)),_group&&_this["tweenUIL_"+key]?.(e)}),vector.onFinishChange(save),_group.add(vector),_controls[key]=vector}_mesh[key].fromArray(initValue);let rotationEuler=(new Euler).fromArray(initValue);_mesh.customRotation=(new Quaternion).setFromEuler(rotationEuler)}(),_group&&function addListeners(){Events.emitter._addEvent(MeshUIL.UPDATE,update,_this)}(),Hydra.LOCAL&&function initHotReload(){_mesh.prefix&&_mesh.classRef&&(_hmr={className:Utils.getConstructorName(_mesh.classRef)},_group||(_hmr.position=_mesh.position.toArray(),_hmr.rotation=_mesh.rotation.toArray(),_hmr.scale=_mesh.scale.toArray()),Events.emitter._addEvent(Component.HMR_INSTANCE_RELOADED,handleInstanceReloaded,_this))}(),this.setLabel=function(name){_group&&_group.setLabel(name)},this.forceUpdate=function(key,val){_mesh[key].fromArray(val),_this["forceUpdate"+key.toUpperCase()]?.()}}),Class(function ShaderUIL(){this.exists={},this.UPDATE="shader_update",this.TEXTURE_UPDATE="shader_texture_update",this.SHADER_UPDATE="shader_shader_update",this.add=function(shader,group,options){return new ShaderUILConfig(shader.shader||shader,null===group?null:group||UIL.global,options)},this.createOverride=function(prefix,obj,group,shaderOnly,newClone){let uniforms={};Array.isArray(obj)?obj.forEach(o=>{o=o.uniforms||o;for(let key in o)o[key].ignoreUIL||(uniforms[key]=o[key])}):uniforms=obj.uniforms||obj;let shader=Utils3D.getTestShader();if(shader.vertexShader=shader.fragmentShader="",newClone)for(let key in uniforms){let value=uniforms[key].value;value?.clone&&(value=value.clone()),shader.uniforms[key]={value:value,type:uniforms[key].type}}else for(let key in uniforms)shader.uniforms[key]=uniforms[key];return shader.UILPrefix=prefix,null===shaderOnly?shader:this.add(shader,group)},this.createDecorator=function(shader,prefix,obj,group){let uniforms={};for(let key in obj)uniforms[key]=shader.uniforms[key];let nShader=Utils3D.getTestShader();return nShader.vertexShader=shader.fragmentShader="",nShader.uniforms=uniforms,nShader.UILPrefix=prefix,this.add(nShader,group)},this.createClone=function(prefix,obj){let uniforms=obj.uniforms||obj,shader=Utils3D.getTestShader();for(let key in uniforms){let value=uniforms[key].value,ignoreUIL=uniforms[key].ignoreUIL||null===value;!ignoreUIL&&value.clone&&(value=value.clone()),shader.uniforms[key]={value:value,ignoreUIL:ignoreUIL}}return shader.UILPrefix=prefix,shader},this.lerpShader=function(from,to,alpha,hz,uniformsFilter){from=from.uniforms||from,to=to.uniforms||to;for(let key in from){let f=from[key],t=to[key];f&&t&&(uniformsFilter&&-1===uniformsFilter.indexOf(key)||("number"==typeof t.value?f.value=Math.lerp(t.value,f.value,alpha,hz):"c"===f.type?(f.value.r=Math.lerp(t.value.r,f.value.r,alpha,hz),f.value.g=Math.lerp(t.value.g,f.value.g,alpha,hz),f.value.b=Math.lerp(t.value.b,f.value.b,alpha,hz)):"v3"===f.type?(f.value.x=Math.lerp(t.value.x,f.value.x,alpha,hz),f.value.y=Math.lerp(t.value.y,f.value.y,alpha,hz),f.value.z=Math.lerp(t.value.z,f.value.z,alpha,hz)):"v2"===f.type?(f.value.x=Math.lerp(t.value.x,f.value.x,alpha,hz),f.value.y=Math.lerp(t.value.y,f.value.y,alpha,hz)):f.value&&f.value.lerp&&f.value.lerp(t.value,alpha,hz)))}}},"static"),Class(function ShaderUILConfig(_shader,_uil,_options){var _textures,_this=this;const prefix=_shader.UILPrefix;var _group=_uil&&!ShaderUIL.exists[prefix]?function createFolder(){if(!UIL.sidebar)return null;let label=function getName(){let split=_shader.UILPrefix.split("/");return split.length>2?split[0]+"_"+split[2]:split[0]}();"_"==label.charAt(label.length-1)&&(label=label.slice(0,-1));let folder=new UILFolder(prefix+label,{label:label,closed:!0});_options?.noGraph||_uil.add(folder);return folder}():null;function createVector(obj,key){let initValue=UILStorage.get(`${prefix}${key}`)||obj.value.toArray();if(_group){let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:initValue,step:.05,description:obj.description});vector.onChange(val=>{obj.value.fromArray(val),_shader.ubo&&(_shader.ubo.needsUpdate=!0)}),_this["forceUpdate"+key.toUpperCase()]=_=>{let val=_shader.get(key).toArray();vector.force(val,!0)},vector.onFinishChange(e=>UILStorage.set(`${prefix}${key}`,e)),UILStorage.state.bind(`${prefix}${key}`,val=>vector.setValue(val)),_group.add(vector)}obj.value.fromArray(initValue)}function createTexture(obj,key){let getTexture;_group&&!_textures&&(_textures={}),getTexture=obj.cube?obj.getTexture||ShaderUIL.getCubeTexture||Utils3D.getCubeTexture:obj.getTexture||ShaderUIL.getTexture||Utils3D.getTexture;const set=_shader.parent&&_shader.parent.setOverride?_shader.parent.setOverride:_shader.setUniform||_shader.set;let prefix=_shader.UILPrefix+"_tx",data=UILStorage.get(`${prefix}${key}`);"string"==typeof data&&(data=JSON.parse(data));let value=data?data.src:null,change=data=>{if("string"==typeof data&&(data=JSON.parse(data)),!data)return;let val=data.src,cleanPath=val.includes("?")&&!data.hotreload?val.split("?")[0]:val;data.compressed&&(val+="-compressedKtx","ktx2"===data.compressed&&(val+="2")),_textures&&(_textures[cleanPath]=change),data.src=cleanPath,UILStorage.set(`${prefix}${key}`,data),set(key,getTexture(val,{premultiplyAlpha:obj.premultiplyAlpha,scale:obj.scale}),_shader)};if(value&&value.length&&change(data),_group){let compressOptions={};obj.cube&&(compressOptions.cube=!0);let img=new UILControlImage(prefix+key,{label:key,value:data,description:obj.description,compressOptions:compressOptions});img.onFinishChange(change),_group.add(img),UILStorage.state.bind(`${prefix}${key}`,val=>change(val)),_this["forceUpdate"+key.toUpperCase()]=_=>{img.force(_shader.get(key),!0)}}}function createNumber(obj,key){let initValue=UILStorage.get(`${prefix}${key}`);if(void 0===initValue&&(initValue=obj.value),_group){let number=new UILControlNumber(`${prefix}${key}`,{label:key,value:initValue,step:.05,description:obj.description});number.onChange(val=>{_shader.ubo&&(_shader.ubo.needsUpdate=!0),obj.value=Number(val)}),number.onFinishChange(e=>UILStorage.set(`${prefix}${key}`,e)),_group.add(number),_this["forceUpdate"+key.toUpperCase()]=_=>{number.forceUpdate(Number(_shader.get(key)),!0)},UILStorage.state.bind(`${prefix}${key}`,val=>number.setValue(val))}obj.value=initValue}function createColor(obj,key){let initValue=UILStorage.get(`${prefix}${key}`)||obj.value.getHexString();if(_group){let color=new UILControlColor(`${prefix}${key}`,{label:key,value:initValue,description:obj.description});UILStorage.state.bind(`${prefix}${key}`,val=>color.setValue(val)),color.onChange(val=>{obj.value.set(val),_shader.ubo&&(_shader.ubo.needsUpdate=!0)}),color.onFinishChange(e=>UILStorage.set(`${prefix}${key}`,e)),_group.add(color),_this["forceUpdate"+key.toUpperCase()]=_=>{color.force(_shader.get(key).getHexString(),!0)}}initValue&&obj.value.set(initValue)}function createSelect(obj,key){let initValue=UILStorage.get(`${prefix}${key}`);if(_group){UILStorage.state.bind(`${prefix}${key}`,val=>obj.val=val);let{options:options,description:description}=obj,select=new UILControlSelect(`${prefix}${key}`,{label:key,value:initValue,options:options,description:description});select.onChange(val=>{_group&&Events.emitter._fireEvent(ShaderUIL.UPDATE,{prefix:prefix,key:key,val:val,group:_this}),obj.value=val,UILStorage.set(`${prefix}${key}`,val)}),_group.add(select)}initValue&&(obj.value=initValue)}function textureUpdate(e){if(!_textures)return;let cleanPath=e.file.split("?")[0];for(let key in _textures){cleanPath==(key.includes("?")?key.split("?")[0]:key)&&_textures[key]({src:e.file,hotreload:!0})}}function update(e){if(e.prefix==_shader.UILPrefix&&e.group!=_this)if(e.color){let val=e.val,obj=_shader.uniforms[e.key];Array.isArray(val)?obj.value.setRGB(val[0],val[1],val[2]):obj.value.set(val)}else e.texture?"remote"!=e.texture&&_shader.set(e.key,e.texture):e.vector?_shader.uniforms[e.key].value.fromArray(e.val):_shader.uniforms[e.key].value=e.val}this.group=_group,this.shader=_shader,_group&&(_shader.shaderUIL=_this),function initItems(){for(var key in _shader.uniforms){let obj=_shader.uniforms[key];obj&&!obj.ignoreUIL&&(obj.options&&Array.isArray(obj.options)?createSelect(obj,key):("number"==typeof obj.value&&createNumber(obj,key),obj.value instanceof Color&&createColor(obj,key),(null===obj.value||obj.value instanceof Texture)&&createTexture(obj,key),obj.value instanceof Vector2&&createVector(obj,key),obj.value instanceof Vector3&&createVector(obj,key),obj.value instanceof Vector4&&createVector(obj,key)))}}(),_group&&function addListeners(){Events.emitter._addEvent(ShaderUIL.UPDATE,update,_this),Events.emitter._addEvent(ShaderUIL.TEXTURE_UPDATE,textureUpdate,_this)}(),this.setLabel=function(name){_group&&_group.setLabel(name)},this.forceUpdate=function(e){e.prefix=_shader.UILPrefix,update(e),_this["forceUpdate"+e.key.toUpperCase()]?.()},this.copyTexture=function(key,shader){let newPrefix=shader.UILPrefix+"_tx",prefix=_shader.UILPrefix+"_tx",data=UILStorage.get(`${prefix}${key}`);data&&UILStorage.set(`${newPrefix}${key}`,data)}}),Class(function ShadowUIL(){this.add=function(light,group){return new ShadowUILConfig(light,null===group?null:group||UIL.global)}},"static"),Class(function ShadowUILConfig(_light,_uil){if(!_light.prefix)throw"light.prefix required when using MeshUIL";var prefix="SHADOW_"+_light.prefix,_group=_uil?function createFolder(){if(!UIL.sidebar)return null;let folder=new UILFolder(prefix,{label:_light.prefix,closed:!0});return _uil.add(folder),folder}():null;function initNumber(key){let initValue=UILStorage.get(`${prefix}${key}`)||_light.shadow[key];if(_group){UILStorage.state.bind(`${prefix}${key}`,val=>_light.shadow[key]=val);let number=new UILControlNumber(`${prefix}${key}`,{label:key,value:initValue,step:.05});number.onFinishChange(e=>{_light.shadow[key]=e,UILStorage.set(`${prefix}${key}`,e)}),_group.add(number)}_light.shadow[key]=initValue}function initVec(key){let initValue=UILStorage.get(`${prefix}${key}`)||_light[key].toArray();if(_group){UILStorage.state.bind(`${prefix}_${key}`,val=>_light[key].fromArray(val));let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:initValue,step:.05});vector.onChange(e=>{_light[key].fromArray(e),"target"==key&&_light.shadow.camera.lookAt(_light.target)}),vector.onFinishChange(e=>{_light[key].fromArray(e),"target"==key&&_light.shadow.camera.lookAt(_light.target),UILStorage.set(`${prefix}${key}`,e)}),_group.add(vector)}_light[key].fromArray(initValue)}_light.target=_light.shadow.target,initVec("position"),initVec("target"),initNumber("fov"),initNumber("size"),initNumber("area"),initNumber("near"),initNumber("far"),function initTick(key){let initValue=UILStorage.get(`${prefix}${key}`);if(_group){UILStorage.state.bind(`${prefix}_${key}`,val=>_light[key]=val);let tick=new UILControlCheckbox(`${prefix}${key}`,{label:key,value:initValue});tick.onFinishChange(e=>{_light[key]=e,UILStorage.set(`${prefix}${key}`,e)}),_group.add(tick)}_light[key]=initValue}("static"),this.setLabel=function(name){_group&&_group.setLabel(name)}}),Class(function TimelineUIL(){Inherit(this,Component);const _this=this;var _panel,_created={};function removePanel(){_panel&&_panel.destroy&&(_this.events.unsub(_panel,Events.COMPLETE,removePanel),_panel=_panel.destroy())}this.create=function(id,version=1,group){"number"!=typeof version&&(group=version,version=1),group=null===group?null:group||UIL.global;let config=new TimelineUILConfig(id,version,UIL.global&&!_created[id]);return UIL.global&&(_created[id]||(_created[id]=config,null!=group&&config.appendUILGroup(group||UIL.global))),config},this.openPanel=function(id,name,template){return removePanel(),_panel=new TimelineUILEditor(id,name,template),_this.events.sub(_panel,Events.COMPLETE,removePanel),_panel},this.set=function(){},this.get=function(){}},"static"),Class(function TimelineUILConfig(_id,_version=1,_store){Inherit(this,Component);const _this=this;var _items,_folder,_config,_template={onSort:_=>{},onAdd:_=>{},onRemove:_=>{}},_name="";function name(){return`TL_${_id}_config`}function updateConfig(){_config.version=_version}function edit(){let panel=TimelineUIL.openPanel(name(),_name,_this.template);_this.events.bubble(panel,Events.UPDATE),_this.events.fire(TimelineUIL.OPEN)}this.model=new TimelineUILModel(name()),_store&&(_items=[]),function initConfig(){(_config=UILStorage.get(name()))?_config.version!=_version&&updateConfig():(_config={},updateConfig())}(),this.add=function(item){return _items&&_items.push(item),item},this.template=function(config){return"function"==typeof config&&(_template=config),_template},this.appendUILGroup=function(uil){let folder=new UILFolder("TL_"+_id,{closed:!0}),button=new UILControlButton("button",{actions:[{title:"Edit Timeline",callback:edit}],hideLabel:!0});folder.add(button),uil.add(folder),_folder=folder},this.setLabel=function(name){_folder&&_folder.setLabel(name),_name=name},this.onAdd=function(cb){_template.onAdd=cb},this.onRemove=function(cb){_template.onRemove=cb},this.onSort=function(cb){_template.onSort=cb},this.internalAddItems=function(count){if(!count)return;let array=[];for(let i=0;i<count;i++){let id=`${_id}_${Utils.timestamp()}`;array.push(id)}UILStorage.set(`${_id}_list_items`,JSON.stringify(array))}},_=>{TimelineUIL.OPEN="list_uil_open"}),Class(function TimelineUILEditor(_id,_name,_template){Inherit(this,Component);const _this=this,PANEL_CONFIG={label:"Timeline Editor",width:"800px",height:"auto",drag:!0};var _gui,_list,_add,_config,_items,_tabs=[],_index=0;function initList(){!function read(){let data=UILStorage.get(`${_id}_list_items`);void 0===data&&(data="[]");_items=JSON.parse(data)}(),_list=new UILFolder(`${_id}_list`,{hideTitle:!0}),_gui.add(_list);for(let id of _items){let view=_this.initClass(TimelineUILItem,id,_list,_template,_index++);_this.events.sub(view,Events.UPDATE,reorder),_this.events.sub(view,Events.END,remove),_tabs.push(view)}_config.rails&&function attachRails(){_tabs.forEach((t,i)=>{t.onUpdate=v=>{_tabs.forEach((t2,j)=>{t2!=t&&(j<i&&t.getValue()<t2.getValue()&&t2.setValue(t.getValue()),j>i&&t.getValue()>t2.getValue()&&t2.setValue(t.getValue()))})}})}()}function initButton(title,callback){let btn=new UILControlButton("button",{actions:[{title:title,callback:callback}],hideLabel:!0});return _gui.add(btn),btn}function spaceEvenly(){_tabs.forEach((t,i)=>{let perc=Math.range(i,0,_tabs.length-1,0,1);t.setValue(perc)})}function add(){let id=`${_id}_${Utils.timestamp()}`,view=new TimelineUILItem(id,_list,_template,_index++);_this.events.sub(view,Events.UPDATE,reorder),_this.events.sub(view,Events.END,remove),_tabs.push(view),_items.push(id),write()}function reorder(e){let order=[];for(let item of e.order)order.push(item.split("_folder")[0]);_items=order,_template().onSort(_items),write(),_this.events.fire(Events.UPDATE,{order:order})}function remove(e){_items.remove(e.id),write(),refresh()}function write(){let data=JSON.stringify(_items);UILStorage.set(`${_id}_list_items`,data)}function refresh(){_index=0,_list&&_list.destroy&&(_list=_list.destroy()),_add&&_add.destroy&&(_add=_add.destroy()),initList(),function initAdd(){_config.lock||(_add=initButton("Add Item",add)).element.css({width:"20%"}),initButton("Space Evenly",spaceEvenly).element.css({width:"20%"})}()}_this.config=_config=JSON.parse(UILStorage.get(`${_id}_config`)||"{}"),function initPanel(){_this.gui=_gui=new UILWindow(_id,PANEL_CONFIG),UIL.add(_gui)}(),refresh(),this.onDestroy=function(){_gui.destroy()}}),Class(function TimelineUILItem(_id,_parent,_template,_index){Inherit(this,Component);const _this=this;var _folder;function onDelete(){if(!confirm("You sure you want to delete this?"))return;let id=_id;_template().onRemove(id),_this.events.fire(Events.END,{id:id})}function onReorder(e){_this.events.fire(Events.UPDATE,e)}!async function initFolder(){(_folder=InputUIL.create(`${_id}_folder`,_parent)).setLabel("Item"),_this.parent&&_this.parent.config.lock||_folder.group.draggable(!0),_this.events.sub(_folder.group,UIL.REORDER,onReorder),_folder.group.open()}(),function initTemplate(){let id=_id;(0,_template().onAdd)(id,_folder,_index)}(),function initUI(){_folder.add("label",_this.parent&&_this.parent.config.lock?"hidden":void 0),_folder.addRange("keyframe"),_folder.add("percent","hidden"),_folder.getField("keyframe").force(Math.round(100*_folder.getNumber("percent"))||0),_folder.onUpdate=key=>{if("keyframe"==key){let val=_folder.getNumber(key)/100;_folder.setValue("percent",val),_this.onUpdate&&_this.onUpdate(val)}};let label=_folder.get("label");if(label&&_folder.setLabel(label),!_this.parent||!_this.parent.config.lock){let actions=[{title:"Delete",callback:onDelete}],hideLabel=!0,btn=(_folder.addButton("delete",{actions:actions,hideLabel:hideLabel}),_folder.getField("delete"));btn&&btn.$content.css({width:"20%"})}}(),this.setLabel=function(label){_folder.setLabel(label)},this.getValue=function(value){return _folder.getNumber("percent")},this.setValue=function(value){_folder.setValue("percent",value),_folder.getField("keyframe").force(Math.round(100*value)||0)}}),Class(function TimelineUILModel(_id){var _items,_config,_data=[],_map={};!function initItems(){_config=JSON.parse(UILStorage.get(`${_id}_config`)||"{}"),_items=JSON.parse(UILStorage.get(`${_id}_list_items`)||"[]")}(),function initData(){_items.forEach((item,i)=>{let input=InputUIL.create(`${item}_folder`,null,null,!!UIL.global),data={};data.label=input.get("label")||"Item",data.value=input.getNumber("percent")||0,data.arbitrary=input.get("arbitrary"),_data.push(data),_map[data.label]=data,UIL.global&&Render.start(_=>{data.label=input.get("label")||"Item",data.value=input.getNumber("percent")||0},10)})}(),this.setState=function(array){for(let i=0;i<array.length;i++)_items[i]||_items.push(`${_id}_${Utils.timestamp()}`);_items.length>array.length&&(_items=_items.slice(0,array.length)),_items.forEach((item,i)=>{let data=array[i],input=InputUIL.create(`${item}_folder`,null);input.setValue("label",data.label),data.percent&&input.setValue("percent",data.percent),data.arbitrary&&input.setValue("percent",data.arbitrary)}),UILStorage.set(`${_id}_list_items`,JSON.stringify(_items))},this.lock=function(){return _config.lock||(_config.lock=!0,UIL.global&&UILStorage.set(`${_id}_config`,JSON.stringify(_config))),this},this.rails=function(){return _config.rails||(_config.rails=!0,UIL.global&&UILStorage.set(`${_id}_config`,JSON.stringify(_config))),this},this.getData=function(){return _data},this.get=function(key){return _map[key]}}),Class(function CameraLookAtHelper(){Inherit(this,Component);const _this=this;let _camera,_object,_defaultLookAt,_tweener={alpha:0},_lookAt=new Vector3;function update(){_lookAt.copy(_defaultLookAt),_tweener.alpha>0&&_lookAt.lerp(_object.position,_tweener.alpha,!1)}_this.get("tweener",()=>_tweener),_this.create=async function(camera,object,tween){_camera=camera,_object=object,_defaultLookAt=_camera.lookAt,await tween.loaded(),_camera.lookAt=_lookAt,_this.events.sub(tween,TweenUIL.UPDATED,update)}}),Class(function TweenUIL(){Inherit(this,Component);const _this=this;var _getServerTime,_folders={},_activeFolder="Tweens",_cache={},_counters={},_synchronizedTweens=[];function synchronizedPlaybackLoop(){let i=_synchronizedTweens.length-1;if(i<0)return;let serverTime=_getServerTime();for(;i>=0;){let tween=_synchronizedTweens[i];if(tween.seekImmediate){let duration=1e3*tween.duration,progress=serverTime%duration/duration;tween.seekImmediate(progress),i-=1}else if(_synchronizedTweens.splice(i,1),0===_synchronizedTweens.length){_this.stopRender(synchronizedPlaybackLoop);break}}}_this.jsons={},this.TOGGLE="tweenuil_toggle",_this.startRender(synchronizedPlaybackLoop),this.create=function(name,config,group){if("undefined"==typeof TheatreJSLoader)throw TweenUIL.moduleWarned||(console.error('Theatre.js not found. Add "theatrejs" to your project.json'),TweenUIL.moduleWarned=!0),new Error("theatrejs module required");"boolean"==typeof group&&(group=void 0);let noCache=!1;"nocache"==group&&(_counters[name]=(_counters[name]||0)+1,noCache=!0,group=void 0);let folderName=_activeFolder;if("string"==typeof group&&(folderName=group,group=null),_folders[folderName]||function initFolder(){if(UIL.global){let folder=new UILFolder(_activeFolder,{label:_activeFolder,closed:!0});_folders[_activeFolder]=folder,UIL.global.add(folder)}}(),!_cache[name]||noCache){let tween=new TweenUILConfig(name,config,group||_folders[folderName],_counters[name]);tween._bindOnDestroy(_=>{delete _cache[name]}),_cache[name]=tween}return _cache[name]},this.setFolder=function(name){_activeFolder=name},this.setServerTimeGetter=function(getServerTime){_getServerTime=getServerTime},this.playSynchronized=async function(tween){_getServerTime?(await tween.preload(),tween.progress,tween.manualRender=!0,_synchronizedTweens.unshift(tween)):console.error("Need to call TweenUIL.setServerTimeGetter(() => time) before using TweenUIL.playSynchronized()")},this.stopSynchronized=function(tween){_synchronizedTweens.remove(tween)}},"static"),Class(function TweenUILAnchor(){Inherit(this,Object3D);this.isTweenAnchor=!0}),Class(function TweenUILConfig(_name,_config,_group,_noCache){Inherit(this,Component);const _this=this;var _input,_editor,_promise,_project,_meshes,_keyframes,_pathVisualization,_projectInstanceId,_objectsWithTracks,_savedState,_rafDriver,_layersWithWarnings={},_flatMap={},_sheets={},_duration=0,_manualRender=!1,_changedKeys={},_cameras=[],_audioFile=!1;function loop(){_this.events.fire(TweenUIL.BEFORE_UPDATE),Object.keys(_flatMap).forEach(key=>_changedKeys[key]=!1),_rafDriver.tick(Render.TIME),_this.events.fire(TweenUIL.UPDATED,{changed:_changedKeys}),_cameras.forEach(camera=>camera?.update?.())}function initObjectsWithTracks(state){_objectsWithTracks||(_objectsWithTracks={}),[state.staticOverrides?.byObject,state.sequence?.tracksByObject].filter(Boolean).forEach(table=>{Object.keys(table).forEach(key=>{let parts=key.split("  "),name=parts.length>1?parts.last():key,matches=/(.*)_(shader|behavior)$/.exec(name);matches&&(name=matches[1]),_objectsWithTracks[name]=!0})})}function ignoreObject(name,layoutName){return!!_objectsWithTracks&&!_objectsWithTracks[name]}function findTrueDuration(sequence){let duration=0,tracks=sequence.tracksByObject;for(let k1 in tracks){let obj=tracks[k1];"tween_anchor"==k1&&findAnchorKeyframes(obj);for(let k2 in obj.trackData){let trackData=obj.trackData[k2];for(let k3 in trackData.keyframes){let keyframe=trackData.keyframes[k3];keyframe.position&&(duration=Math.max(duration,keyframe.position))}}}return duration}function checkDuration(){if(0===_duration)for(let key in _sheets)_duration=Math.max(_duration,_sheets[key].length)}function findAnchorKeyframes(obj){for(let k1 in obj)for(let k2 in obj[k1]){let keyframes=obj[k1][k2].keyframes;keyframes&&(_keyframes=keyframes)}}async function play(options={}){_config.sheets||(await prepareConfig(),linkLocally()),checkDuration();for(let key in _sheets)options.disableAutoPosition||(_sheets[key].sequence.position="reverse"===options?.direction?_duration:0),_sheets[key].sequence.play({...options,rafDriver:_rafDriver});return _promise=_this.wait(1e3*_duration)}function linkLocally(){makeSendable().sheets.forEach(obj=>{const sheet=_sheets[_config.mergedSheetName];if(sheet)for(let key in obj){for(let key2 in obj[key]){let finalObj=obj[key][key2];"number"==typeof finalObj.r&&"number"==typeof finalObj.g&&"number"==typeof finalObj.b&&Object.assign(finalObj,Theatre.core.types.rgba(finalObj))}sheet.object(getTrackNameFromKey(key),obj[key]).onValuesChange(newValue=>{_changedKeys[key]=!0,completeDataLink(newValue,_flatMap[key])},_rafDriver)}})}function getTrackNameFromKey(key,disambiguate=!1){let name=key.split("&"),prefix=name[0];return name.shift(),name=name.join("_"),disambiguate&&(name=`${prefix}  ${name}`),name}async function prepareConfig(){let array=Array.isArray(_config)?_config:[_config];_config={},_audioFile&&(_config.audioFile=_audioFile),_config.nudgeMultiplier=.05;let sheet={};_config.sheets=[sheet];for(let i=0;i<array.length;i++){let layoutName,objects=array[i],options={};if(objects instanceof SceneLayout)layoutName=objects.name,options.isSceneLayout=!0,objects=await getObjectsFromLayout(objects);else{if("object"!=typeof objects)throw"TweenUIL :: Type not supported";if(0===i){let obj0=objects[Object.keys(objects)[0]];obj0 instanceof Mesh?layoutName="Scene":obj0.uniforms?layoutName="Shader":isElement(obj0)&&(layoutName="Elements")}}layoutName||(layoutName=`Scene${i+1}`),mergeSheets(sheet,createSheetFromObjects(objects,layoutName,options)),0===i&&(_config.mergedSheetName=layoutName)}_this.flag("isLoaded",!0)}function mergeSheets(sheet1,sheet2){let usedNames={};return Object.keys(sheet1).forEach(key=>{usedNames[getTrackNameFromKey(key)]=!0}),Object.keys(sheet2).forEach(key=>{let name=getTrackNameFromKey(key),newKey=key;usedNames[name]&&(name=getTrackNameFromKey(key,!0),newKey=`${key.split("&")[0]}&${name}`,_flatMap[newKey]=_flatMap[key],delete _flatMap[key]),usedNames[name]=!0,sheet1[newKey]=sheet2[key]}),sheet1}function makeEulerLink(layer,key){return{copy:obj=>{layer[key].set(Math.radians(obj.x),Math.radians(obj.y),Math.radians(obj.z))},get x(){return Math.degrees(layer[key].x)},get y(){return Math.degrees(layer[key].y)},get z(){return Math.degrees(layer[key].z)}}}function getMeshObject(layer,parent,layerName){if(parent?.isTweenAnchor){let obj={};return obj.anchor={anchor:0,link:{copy(){}}},obj}layer.rotationLink=makeEulerLink(layer,"rotation");let obj={position:{x:layer.position.x,y:layer.position.y,z:layer.position.z,link:layer.position},scale:{x:layer.scale.x,y:layer.scale.y,z:layer.scale.z,link:layer.scale},rotation:{x:Math.degrees(layer.rotation.x),y:Math.degrees(layer.rotation.y),z:Math.degrees(layer.rotation.z),link:layer.rotationLink}};if(layer._cameraUIL){parent.position&&(obj.cameraPos={x:parent.position.x,y:parent.position.y,z:parent.position.z,link:{copy(from){parent.move(from)}}}),obj.projection={zoom:parent.zoom,near:parent.near,far:parent.far,link:{copy(from){parent.setProjectionProperties(from)}}};let fov=parent.getFOV();void 0!==fov&&(obj.projection.fov=fov),parent.lookAt&&(obj.lookAt={x:parent.lookAt.x,y:parent.lookAt.y,z:parent.lookAt.z,link:parent.lookAt}),parent.moveXY&&(obj.moveXY={x:parent.moveXY.x,y:parent.moveXY.y,link:parent.moveXY}),parent.cameraRotation&&(obj.cameraRotation={x:Math.degrees(parent.cameraRotation.x),y:Math.degrees(parent.cameraRotation.y),z:Math.degrees(parent.cameraRotation.z),link:makeEulerLink(parent,"cameraRotation")}),parent.viewportFocus&&(obj.viewportFocus={x:parent.viewportFocus.x,y:parent.viewportFocus.y,link:parent.viewportFocus});let camera=layer.classRef;camera.manualRender=!0,_cameras.push(camera),camera.onDestroy=_=>_cameras.remove(camera)}return UIL.global&&(_meshes||(_meshes=[]),layer._uilLayerName=layerName,_meshes.push(layer)),parent?.tweenToggle&&(obj.toggle={on:0,link:{copy:e=>{0==e.on&&parent.flag("tweenToggle")?(parent.flag("tweenToggle",!1),parent.events.fire(TweenUIL.TOGGLE,{on:!1})):1!=e.on||parent.flag("tweenToggle")||(parent.events.fire(TweenUIL.TOGGLE,{on:!0}),parent.flag("tweenToggle",!0))}}}),obj}function getShaderObject(shader){let obj={};for(let key in shader.uniforms){let uniform=shader.uniforms[key],value=uniform.value;void 0===value||uniform.ignoreUIL&&!uniform.enableTweenUIL||"HZ"==key||("number"==typeof value?obj[key]={value:value,link:uniform}:value instanceof Vector2?obj[key]={x:value.x,y:value.y,link:value}:value instanceof Vector3?obj[key]={x:value.x,y:value.y,z:value.z,link:value}:value instanceof Vector4?obj[key]={x:value.x,y:value.y,z:value.z,w:value.w,link:value}:value instanceof Color&&(obj[key]={r:value.r,g:value.g,b:value.b,a:1,link:value}))}return obj}function isElement(object){return!!object?.div?.hydraObject||void 0!==GLUIObject&&(object instanceof GLUIObject||object instanceof GLUIText)}function getElementObject($element){let obj={_config:{nudgeMultiplier:1}};return void 0!==$element.x&&(obj.x={value:$element.x,link:$element}),void 0!==$element.y&&(obj.y={value:$element.y,link:$element}),void 0!==$element.z&&(obj.z={value:$element.z,link:$element}),void 0!==$element.scale&&(obj.scale={value:$element.scale,link:$element}),void 0!==$element.scaleX&&(obj.scaleX={value:$element.scaleX,link:$element}),void 0!==$element.scaleY&&(obj.scaleY={value:$element.scaleY,link:$element}),void 0!==$element.rotation&&(obj.rotation={value:$element.rotation,link:$element}),void 0!==$element.rotationX&&(obj.rotationX={value:$element.rotationX,link:$element}),void 0!==$element.rotationY&&(obj.rotationY={value:$element.rotationY,link:$element}),void 0!==$element.rotationZ&&(obj.rotationZ={value:$element.rotationZ,link:$element}),void 0!==$element.alpha&&(obj.alpha={value:$element.alpha,link:$element}),obj}function getPlainObject(object){let obj={};for(let key in object){let value=object[key];"number"==typeof value?obj[key]={value:value,link:object}:value instanceof Vector2?obj[key]={x:value.x,y:value.y,link:value}:value instanceof Vector3?obj[key]={x:value.x,y:value.y,z:value.z,link:value}:value instanceof Vector4?obj[key]={x:value.x,y:value.y,z:value.z,w:value.w,link:value}:value instanceof Color&&(obj[key]={r:value.r,g:value.g,b:value.b,a:1,link:value})}if(Object.keys(obj).length)return obj}async function getObjectsFromLayout(layout){let layers=await layout.getAllLayers(),objects={};for(let key in layers){let layer=layers[key];ignoreObject(key,layout.name)||!1!==layer.animates&&(layer.ready&&!layer.disabled&&await layer.ready(),objects[key]=layer)}return objects}function createSheetFromObjects(objects,layoutName,{isSceneLayout:isSceneLayout}){let sheet={};for(let name in objects){let object=objects[name],key=`${layoutName}&${name}`;if(ignoreObject(name))continue;let matched=!1;if(object.uniforms)_flatMap[key]=sheet[key]=getShaderObject(object);else if(isElement(object))_flatMap[key]=sheet[key]=getElementObject(object);else{if((object instanceof Mesh||object instanceof Group)&&(_flatMap[key]=sheet[key]=getMeshObject(object,null,key),matched=!0),object.shader&&(_flatMap[`${key}&shader`]=sheet[`${key}&shader`]=getShaderObject(object.shader),matched=!0),object.behavior&&(_flatMap[`${key}&behavior`]=sheet[`${key}&behavior`]=getShaderObject(object.behavior),matched=!0),object.lifeBehavior&&(_flatMap[`${key}&lifeBehavior`]=sheet[`${key}&lifeBehavior`]=getShaderObject(object.lifeBehavior),matched=!0),object.group){try{_flatMap[key]=sheet[key]=getMeshObject(object.group,object,key)}catch(e){console.warn(e)}matched=!0}if(!matched&&!isSceneLayout){let obj=getPlainObject(object);obj?_flatMap[key]=sheet[key]=obj:console.warn(`Unclear how to animate object ${key}`,object)}}}return sheet}function makeSendable(){const cleanObject=obj=>{let newObj={};for(let key in obj)"link"!=key&&(newObj[key]=obj[key]);return newObj};let obj={sheets:[],nudgeMultiplier:_config.nudgeMultiplier};return _audioFile&&(obj.audioFile=_audioFile),obj.filePath=Assets.getPath(`assets/data/timeline-${_name}.json`),obj.filePath.includes("http")||(obj.filePath=Hydra.absolutePath(obj.filePath)),_config.sheets.forEach(sheet=>{let newSheet={};for(let key in sheet){let top=sheet[key];newSheet[key]={};for(let key2 in top)newSheet[key][key2]=cleanObject(top[key2])}obj.sheets.push(newSheet)}),obj}function completeDataLink(dataObj,realObj){let transform;for(let key2 in realObj){if("_config"===key2)continue;let valueObj=dataObj[key2],link=realObj[key2].link;void 0!==valueObj.value?(!Object.prototype.hasOwnProperty.call(link,key2)&&Object.prototype.hasOwnProperty.call(link,"value")?link.value=valueObj.value:link[key2]=valueObj.value,transform=link.transform,transform&&"alpha"==key2&&link.css("opacity",valueObj.value)):link.copy(valueObj)}transform&&transform()}function linkData(data){for(let key in data){let dataObj=data[key],realObj=_flatMap[key];_changedKeys[key]=!0,completeDataLink(dataObj,realObj)}}async function openEditor(){_config.sheets||await prepareConfig(),_editor&&_editor.close(),(_editor=new UILExternalTimeline(_name,800,1200,makeSendable())).onMessage=linkData,_editor.onVisualizePath=handleVisualizePath,_editor.onPositionChange=onPositionChange,_this.state.editorOpen=!0,_editor.onDestroy=_=>{_editor=null,_this.state.editorOpen=!1,handleVisualizePath({}),_meshes?.forEach(mesh=>{mesh._cameraUIL&&(mesh._cameraUIL.tweenUIL_groupPos=null,mesh._cameraUIL.tweenUIL_scale=null,mesh._cameraUIL.tweenUIL_rotation=null,mesh._cameraUIL.tweenUIL_position=null,mesh._cameraUIL.tweenUIL_zoom=null,mesh._cameraUIL.tweenUIL_fov=null,mesh._cameraUIL.tweenUIL_near=null,mesh._cameraUIL.tweenUIL_far=null,mesh._cameraUIL.tweenUIL_lookAt=null,mesh._cameraUIL.tweenUIL_cameraRotation=null,mesh._cameraUIL.tweenUIL_viewportFocus=null),mesh._meshUIL&&(mesh._meshUIL.tweenUIL_scale=null,mesh._meshUIL.tweenUIL_position=null,mesh._meshUIL.tweenUIL_rotation=null)})},_meshes?.forEach(mesh=>{mesh._cameraUIL?(mesh._cameraUIL.tweenUIL_groupPos=value=>_editor.sendUpdate(mesh._uilLayerName,value,"position"),mesh._cameraUIL.tweenUIL_scale=value=>_editor.sendUpdate(mesh._uilLayerName,value,"scale"),mesh._cameraUIL.tweenUIL_rotation=value=>_editor.sendUpdate(mesh._uilLayerName,value,"rotation"),mesh._cameraUIL.tweenUIL_position=value=>_editor.sendUpdate(mesh._uilLayerName,value,"cameraPos"),mesh._cameraUIL.tweenUIL_zoom=value=>_editor.sendUpdate(mesh._uilLayerName,{zoom:value},"projection"),mesh._cameraUIL.tweenUIL_fov=value=>_editor.sendUpdate(mesh._uilLayerName,{fov:value},"projection"),mesh._cameraUIL.tweenUIL_near=value=>_editor.sendUpdate(mesh._uilLayerName,{near:value},"projection"),mesh._cameraUIL.tweenUIL_far=value=>_editor.sendUpdate(mesh._uilLayerName,{far:value},"projection"),mesh._cameraUIL.tweenUIL_lookAt=value=>_editor.sendUpdate(mesh._uilLayerName,value,"lookAt"),mesh._cameraUIL.tweenUIL_cameraRotation=value=>_editor.sendUpdate(mesh._uilLayerName,value,"cameraRotation"),mesh._cameraUIL.tweenUIL_viewportFocus=value=>_editor.sendUpdate(mesh._uilLayerName,value,"viewportFocus")):mesh._meshUIL&&(mesh._meshUIL.tweenUIL_position=value=>_editor.sendUpdate(mesh._uilLayerName,value,"position"),mesh._meshUIL.tweenUIL_scale=value=>_editor.sendUpdate(mesh._uilLayerName,value,"scale"),mesh._meshUIL.tweenUIL_rotation=value=>_editor.sendUpdate(mesh._uilLayerName,value,"rotation"))})}function updateKeyframeData(){for(let key in _sheets)_this.keyframeTotalProgress=_keyframes.positionObject.position/_sheets[key].length;_this.keyframeIndex=_keyframes.current,_this.keyframeLocalProgress=Math.fract(_keyframes.positionObject.position)}function updateKeyframeLoop(hz){_keyframes.positionObject.position=Math.lerp(_keyframes.positionObject.target,_keyframes.positionObject.position,.07*hz,!1);for(let key in _sheets)_sheets[key].sequence.position=_keyframes.positionObject.position;updateKeyframeData()}function onPositionChange(position){_this.state.editorPosition=position}function handleVisualizePath(data){if(!_pathVisualization&&!data.position)return;let object;if(_pathVisualization||(_pathVisualization=_this.initClass(TweenUILPathVisualization)),data.sheetId){let parts=data.objectKey.split("  "),prefix=parts.length>1?parts[0]:data.sheetId,objectKey=parts.length>1?parts.last():data.objectKey,key=`${prefix}&${objectKey}`;object=_meshes.find(({_uilLayerName:_uilLayerName})=>_uilLayerName===key),!object&&parts.length<=1&&(object=_meshes.find(({_uilLayerName:_uilLayerName})=>_uilLayerName?.split("&")?.[1]===objectKey)),object||_layersWithWarnings[key]||(console.warn(`Couldnt find mesh for object ${key}.`),_layersWithWarnings[key]=!0)}_pathVisualization.object=object,_pathVisualization.update(data)}!async function(){_this.state=AppState.createLocal({editorOpen:!1,editorPosition:0}),TheatreJSLoader.loaded||(!Hydra.LOCAL||Global.PLAYGROUND||TheatreJSLoader.warned||(console.warn("TheatreJS was not loaded in a preload step, so it will be loaded now.\n\nTo optimize, call `await TheatreJSLoader.load()` in a preload step. A good spot to add this is in Container.js -> loadView() -> add it to the array of promises being awaited."),TheatreJSLoader.warned=!0),await TheatreJSLoader.load()),function initRafDriver(){_rafDriver=Theatre.core.createRafDriver({name:["TweenUIL",_name,_noCache].filter(Boolean).join("_")}),_this.startRender(loop)}(),(_input=InputUIL.create(_name+"_tween",_group)).setLabel(_name),_input.addButton("edit",{label:"Edit",actions:[{title:"Editor",callback:openEditor}]});try{if(_savedState=TweenUIL.jsons[_name],_savedState?.then&&(_savedState=await _savedState),!_savedState){let promise=get(Assets.getPath(`assets/data/timeline-${_name}.json`));if(_noCache&&(TweenUIL.jsons[_name]=promise),"string"==typeof(_savedState=await promise))throw new Error("Malformed TweenUIL timeline")}_noCache&&(_projectInstanceId=`instance_${_noCache}`,TweenUIL.jsons[_name]=_savedState)}catch{Hydra.LOCAL&&console.warn(`No saved TweenUIL timeline timeline-${_name}.json, create one with the Editor`),_savedState={sheetsById:{},definitionVersion:"0.4.0",revisionHistory:[]}}_project=Theatre.core.getProject(_name,{state:_savedState}),_this._bindOnDestroy(_=>{_project.destroy()}),await _project.ready;for(let key in _savedState.sheetsById){_sheets[key]=_project.sheet(key,{instanceId:_projectInstanceId});let state=_savedState.sheetsById[key];_group||initObjectsWithTracks(state),_sheets[key].length=findTrueDuration(state.sequence)}_input.addButton("play",{label:"Play",actions:[{title:"Play",callback:play}]}),_input.addRange("Scrub",0,{min:0,max:1,step:5e-4}),_input.onUpdate=async key=>{if("Scrub"==key){_config.sheets||await play();let value=_input.getNumber("Scrub");_this.seek(value)}},_this.flag("ready",!0)}(),this.play=async function(options){return await _this.wait("ready"),play(options)},this.seek=function(value){if(_this.flag("ready")){checkDuration();for(let key in _sheets)_sheets[key].sequence.position=Math.min(_sheets[key].length,_duration*value)}},this.seekTime=function(value){if(_this.flag("ready")){checkDuration();for(let key in _sheets)_sheets[key].sequence.position=Math.min(_sheets[key].length,value);loop()}},this.seekImmediate=function(value){_this.seek(value),loop()},this.promise=async function(){return await _this.wait("ready"),_promise},this.setLabel=function(label){_input&&_input.setLabel(label)},this.preload=async function(){if(await _this.wait("ready"),_config.sheets){if(!_this.flag("isLoaded"))return _this.wait("isLoaded")}else await prepareConfig(),linkLocally();_this.seek(0)},this.loaded=async function(){if(!_this.flag("isLoaded")&&_config.sheets)return _this.wait("isLoaded");await _this.preload()},this.seekToKeyframe=async function(index){if(_this.flag("isLoaded")||await _this.preload(),!_keyframes)return console.warn("TweenUILConfig :: Missing keyframes! Add tween_anchor layer");_keyframes.current=index,_keyframes.positionObject={position:_keyframes[index].position,target:_keyframes[index].position},_this.seek(_keyframes[index].position),updateKeyframeData(),_this.startRender(updateKeyframeLoop,RenderManager.NATIVE_FRAMERATE)},this.playToKeyframe=async function(index,time,ease="linear",delay){await _this.wait("ready"),_keyframes.positionObject||await _this.seekToKeyframe(0);let nextKeyframe=_keyframes[index],currentKeyframe=_keyframes[_keyframes.current];if(!nextKeyframe)return;let position=nextKeyframe.position;return time||(time=1e3*Math.abs(nextKeyframe.position-currentKeyframe.position)),_keyframes.tween&&(_keyframes.tween=clearTween(_keyframes.tween)),_keyframes.current=index,_this.flag("playingToKeyframe",!0,time+50),_keyframes.tween=tween(_keyframes.positionObject,{target:position},time,ease,delay),_keyframes.tween.promise()},this.peekInKeyframeDirection=function(dir,percent){if(!_keyframes||_this.flag("playingToKeyframe"))return;let currentKeyframe=_keyframes[_keyframes.current],nextKeyframe=_keyframes[_keyframes.current+dir];nextKeyframe&&(_keyframes.positionObject.target=Math.mix(currentKeyframe.position,nextKeyframe.position,percent))},this.playToNextKeyframe=async function(time,ease,delay){return this.playToKeyframe(_keyframes.current+1,time,ease,delay)},this.playToPrevKeyframe=async function(time,ease,delay){return this.playToKeyframe(_keyframes.current-1,time,ease,delay)},this.playToDirKeyframe=async function(dir,time,ease,delay){return this.playToKeyframe(_keyframes.current+dir,time,ease,delay)},this.get("position",_=>{let position=0;for(let key in _sheets)position=Math.max(position,_sheets[key]?.sequence?.position||0);return _this.state.editorOpen&&(position=_this.state.editorPosition),position}),this.get("progress",_=>(checkDuration(),_this.position/_duration)),_this.get("duration",()=>_duration),this.get("totalKeyframes",_=>_keyframes?_keyframes.length:0),this.get("currentKeyframe",_=>_keyframes?_keyframes.current:0),this.get("keyframeValue",_=>{if(!_keyframes)return 0;let position=_this.position;for(let i=0;i<_keyframes.length;++i){let keyframe=_keyframes[i];if(position>=keyframe.position){let nextKeyframe=_keyframes[i+1];if(!nextKeyframe)return keyframe.value;if(position<nextKeyframe.position)return Math.range(position,keyframe.position,nextKeyframe.position,keyframe.value,nextKeyframe.value,!0)}}return _keyframes[0]?.value||0}),_this.get("keyframeSection",_=>Math.fract(_this.keyframeValue)),_this.getPositionAtKeyframeValue=keyframeValue=>{let index=Math.floor(keyframeValue),position=_keyframes[index]?.position||0,progress=Math.fract(keyframeValue);if(progress){let nextPosition=_keyframes[index+1]?.position;nextPosition&&(position=Math.mix(position,nextPosition,progress))}return position},_this.getProgressAtKeyframeValue=keyframeValue=>(checkDuration(),_this.getPositionAtKeyframeValue(keyframeValue)/_duration),_this.getTrackData=function(objectName){for(let key in _savedState.sheetsById){let tracks=_savedState.sheetsById[key].sequence.tracksByObject;if(tracks[objectName])return tracks[objectName]}},this.get("manualRender",()=>_manualRender),this.set("manualRender",value=>{(value=!!value)!==_manualRender&&((_manualRender=value)?_this.stopRender(loop):_this.startRender(loop))}),this.get("sheets",()=>_sheets),_this.update=()=>{_manualRender||!Hydra.LOCAL||_this.flag("manualRenderWarned")||(console.warn("Set manualRender to true if using TweenUIL.update()"),_this.flag("manualRenderWarned",!0)),loop()},_this.setAudio=async function(path){await _this.loaded();let source=Assets.getPath(path);for(let sheet in _this.sheets)_this.sheets[sheet].sequence.attachAudio({source:source});_audioFile=source,_config&&(_config.audioFile=source)}},()=>{TweenUIL.BEFORE_UPDATE="TweenUIL.BEFORE_UPDATE",TweenUIL.UPDATED="TweenUIL.UPDATED"}),Class(function UILFile(_offline,_path){Inherit(this,Component);this.load=async function(){let path=window.UIL_STATIC_PATH||"assets/data/uil.json",cmsPath=window.UIL_CMS_STATIC_PATH||"assets/data/cms.json",jsonFiles=[path];window.ENABLE_UIL_CMS&&jsonFiles.push(cmsPath);try{const allFiles=await Promise.all(jsonFiles.map(jsonFile=>get(jsonFile)));let data=Object.assign(...allFiles);return"string"==typeof data?Hydra.LOCAL?null:{}:data}catch(e){return{}}},this.save=async function(sessionData,data){if(data=function getSortedData(data){return Object.keys(data).sort().reduce((obj,key)=>(obj[key]=data[key],obj),{})}(data),Dev.writeFile(window.UIL_STATIC_PATH||"assets/data/uil.json",data),_offline){let partial={};try{partial=await get("assets/data/uil-partial.json",data);for(let key in sessionData)partial[key]=sessionData[key]}catch(e){partial=sessionData}Dev.writeFile("assets/data/uil-partial.json",partial),Storage.set("uil_update_partial",!0)}}}),Class(function UILStorage(){Inherit(this,Model);const _this=this;var _fs;_this.USE_CACHED_FILE=window.USE_CACHED_FILE||!1,_this.ID=window.UIL_ID;var _data={},_dataSession={},_id=window.UIL_ID||"default";const OFFLINE_FIREBASE=Utils.query("offlineFB");if(!_this.ID)throw new Error("Missing UIL ID!");this.SAVE="uil_save",this.UPLOADING="uil_uploading",this.UPLOADED="uil_uploaded";const _persistentIds=[];async function write(direct,silent){let prevent=!1,e={prevent:_=>prevent=!0};if(_this.events.fire(_this.SAVE,e),direct||(e.wait&&await e.wait(),!prevent)){for(let key in _dataSession)if(key.includes("/")){let newKey=key.replace(/\//g,"@");_dataSession[newKey]=_dataSession[key],delete _dataSession[key]}AppState.set("UILStorage/saving",!0),await UILRemote.write(_dataSession,`${_this.ID}/${_id}`),await _this.wait(800),AppState.set("UILStorage/saving",!1),_dataSession={}}}Hydra.ready(async()=>{_this.state=AppState.createLocal(),_this.USE_CACHED_FILE||await UILRemote.ready(),_this.init(),__window.bind("keydown",e=>{(e.ctrlKey||e.metaKey)&&83==e.keyCode&&(e.preventDefault(),write())})}),_this.write=write,_this.ready=()=>_this.wait(_this,"loaded"),_this.init=async(id=null,extension="",persist=!1)=>{let data;_fs&&_fs.destroy(),_fs=_this.initClass(UILFile,OFFLINE_FIREBASE),data=_this.USE_CACHED_FILE?await _fs.load():await UILRemote.fetchAllData(`${_this.ID}/${_id}`);for(let key in data){if(key.includes("@")){let newKey=key.replace(/@/g,"/");data[newKey]=data[key],delete data[key],key=newKey}_this.state.set(key,data[key])}if(_data[_id]=data,_this.loaded=!0,!OFFLINE_FIREBASE&&Storage.get("uil_update_partial")&&!function uilFile(){return!(Utils.query("editMode")||Hydra.LOCAL&&(window.Config&&Config.PLATFORM_CONFIG&&Utils.query("uil")||!Device.mobile&&!OFFLINE_FIREBASE&&(!window._BUILT_||Hydra.LOCAL)&&!window.AURA&&!window._UIL_FILE_&&(window._FIREBASE_UIL_||window.UIL_ID)&&(Device.detect("hydra")||Utils.query("uil"))))}()){if(!confirm("Looks like you have UIL data captured offline, do you want to sync it to Firebase?"))return clearOfflineData();let data=await get("assets/data/uil-partial.json");for(let key in data)_this.set(key,data[key]);write(!0),clearOfflineData()}},_this.get=key=>{let val=_this.state[key];if(null===val&&null in _this.state&&(val=_this.state.null[key]),null===val&&_persistentIds.length>0)for(const id of _persistentIds)try{val=_this.state[id][key]}catch{val=null}return val},_this.getKeys=()=>Array.from(_this.state.getMap().keys()),_this.set=(key,value)=>{if(JSON.stringify(_this.state[key])!==JSON.stringify(value)){if(void 0===value)return console.warn(`Trying to set UILStorage with an undefined value for ${key}`);_this.state.set(key,value),null===value?(delete _data[_id][key],_dataSession[key]=value):(_data[_id][key]=value,_dataSession[key]=value)}},_this.setCMS=function(key,value){if(JSON.stringify(_this.state[key])===JSON.stringify(value))return;if(void 0===value)return console.warn(`Trying to set UILStorage with an undefined value for ${key}`);_this.state.set(key,value);let obj={};obj[key]=value,UILRemote.writeCMS(obj,`${_this.ID}/${_id}`)},_this.duplicateData=async(targetLayerDataKeys,newId)=>{targetLayerDataKeys.filter(key=>!key.includes("renderOrder")&&(!key.includes("sortIndex")&&_data[_id][key])).map(key=>({key:key.replace(/_([\d]+)_/,`_${newId}_`),value:_data[_id][key]})).forEach(item=>{_this.set(item.key,item.value)})},_this.pasteLayerData=({layerData:layerData,newLayerNumber:newLayerNumber,sceneName:sceneName,oldSceneName:oldSceneName})=>{layerData.map(item=>{let newKey=item.key.replace(/_([\d]+)_/,`_${newLayerNumber}_`);return oldSceneName&&sceneName&&oldSceneName!==sceneName&&(newKey=newKey.replace(`_${oldSceneName}`,`_${sceneName}`)),{key:newKey,value:item.value}}).forEach(item=>{_this.set(item.key,item.value)})},_this.getDataForKeys=keys=>keys.map(key=>({key:key,value:_data[_id][key]})).filter(item=>void 0!==item.value),_this.deleteItemsWithKeys=keys=>{keys.forEach(key=>{_data[_id][key]=null,_dataSession[key]=null})},_this.getAssets=async()=>{try{return UILRemote.getAssets(file)}catch(err){Hydra.LOCAL&&console.error(err)}},_this.handleUpdate=function(ref,data){let[_,id]=ref.split("/");for(let key in data){if(key.includes("@")){let newKey=key.replace(/@/g,"/");data[newKey]=data[key],delete data[key],key=newKey}_this.state.set(key,data[key])}_data[id]=data},_this.uploadAsset=async file=>{try{_this.events.fire(_this.UPLOADING,{file:file});let asset=await UILRemote.uploadAsset(file);return _this.events.fire(_this.UPLOADED,{asset:asset,file:file}),asset}catch(err){Hydra.LOCAL&&console.error(err)}},_this.getHistory=(actorId=null)=>null,_this.getUsers=async()=>[],_this.hasData=()=>_this.state.getMap().size>0,_this.parse=function(key,hint){const data=_this.state[key];if(void 0===data)return null;if(Array.isArray(data)){if(hint instanceof Vector2)return{value:(new Vector2).fromArray(data)};if(hint instanceof Vector3)return{value:(new Vector3).fromArray(data)};if(hint instanceof Vector4)return{value:(new Vector4).fromArray(data)}}else if("string"==typeof data&&"#"===data.charAt(0))return{value:new Color(data)};return{value:data}}},"static"),Class(function UILClipboard(){Inherit(this,Component);var _store={};this.copy=function(folders){_store={};for(let key in folders){let folder=folders[key];_store[folder.label]=folder.value}},this.paste=function(folders){for(let key in folders){let folder=folders[key];folder&&(null!=_store[folder.label]&&(key.includes("name")||key.includes("shader")||(folder.force(_store[folder.label],!0),folder.finish())))}},this.get("store",_=>_store)},"static"),Class(function UILExternalColor(_title,_value){Inherit(this,Component);const _this=this;var _window;function onReload(){_this.onDestroy()}(_window=window.open(location.protocol+"//localhost/hydra/editor/color/index.html",`hydra_color_${_title}`,"width=480,height=220,left=200,top=100,location=no")).window.onload=_=>{_window.window.initPicker(_title,_value,_this)},window.addEventListener("beforeunload",onReload),this.update=function(value){_this.events.fire(Events.UPDATE,{value:value})},this.onDestroy=function(){window.removeEventListener("beforeunload",onReload),_window&&_window.window&&_window.window.close()}}),Class(function UILExternalEditor(_title,_height=500,_width=700){Inherit(this,Component);const _this=this;var _window,_code,_language;_window=window.open(location.protocol+"//localhost/hydra/editor/code/index.html","_blank",`width=${_width},height=${_height},left=200,top=100`),_this.events.sub(Events.UNLOAD,_=>_window.close()),_window.window.onload=_=>{_window.window.initEditor(_title,_code,_language,_this)},this.setCode=function(code,language){_code=code,_language=language},this.saved=async function(code){_this.onSave&&_this.onSave(code),await defer(),UILStorage.write()}}),Class(function UILExternalFilePicker(callback,type="textures"){Inherit(this,Component);const _this=this;var _window;async function init(){const assets=await get(Assets.getPath("assets/js/app/config/UILAssetsConfig.js"));let basePath,list;eval(assets),"textures"===type&&(basePath=`${document.location.pathname}/assets/images`,list=window.UIL_ASSETS_TEXTURES),"geometries"===type&&(basePath=`${document.location.pathname}/assets/geometry`,list=window.UIL_ASSETS_GEOMETRIES),_window=window.open(`${location.protocol}//localhost/hydra/editor/filepicker/index.html`,"pick file","width=800,height=700"),_this.events.sub(Events.UNLOAD,_=>_window.close()),_window.window.onload=_=>{_window.window.initPicker(_this,basePath,list)},window.addEventListener("beforeunload",onReload)}function onReload(){_this.onDestroy()}!async function(){await Dev.execUILScript("assetsconfig"),await init()}(),this.refresh=function(){_window&&_window.window&&_window.window.close(),init()},this.update=function(value){callback&&callback(value)},this.onDestroy=function(){window.removeEventListener("beforeunload",onReload),_window&&_window.window&&_window.window.close()}}),Namespace("FX"),FX.Class(function UnrealBloom(_nuke,options,_unique){Inherit(this,Component);var _triangleGeometry,_luminosityShader,_compositeShader,_mesh,_inputTexture,_this=this;if("object"==typeof _nuke&&_nuke.isAppState){let params=_nuke;_nuke=_this.parent.nuke||params.nuke||World.NUKE,_unique=params.unique,options=params}"string"==typeof options?(_unique=_params,options={},_nuke=World.NUKE):"string"==typeof _nuke?(_unique=_nuke,options={},_nuke=World.NUKE):!_nuke||_nuke instanceof Nuke?(_nuke=_nuke||World.NUKE,options=options||{},_unique=_unique||""):(options=_nuke,_nuke=World.NUKE);var _oldClearColor=new Color,_oldClearAlpha=1,_renderTargetsHorizontal=[],_renderTargetsVertical=[],_separableBlurShaders=[],_nMips=options.nMips||3,_DPR=options.dpr||_nuke.dpr,_blurDirectionX=new Vector2(_DPR,0),_blurDirectionY=new Vector2(0,_DPR),_kernelSizeArray=options.kernelSizeArray||[3,5,7,9,11],_bloomFactors=options.bloomFactors||[1,.8,.6,.4,.2],_useRTPool=!1!==options.useRTPool;function render(){if(!_this.enabled||_this._invisible)return;let renderer=_nuke.renderer;_oldClearColor.copy(renderer.getClearColor()),_oldClearAlpha=renderer.getClearAlpha();let oldAutoClear=renderer.autoClear;renderer.autoClear=!0,renderer.setClearColor(_this.clearColor,0);let inputRenderTarget=_inputTexture||_nuke.rttBuffer.texture;_luminosityShader.uniforms.luminosityThreshold.value>.01&&(_luminosityShader.uniforms.tDiffuse.value=inputRenderTarget,_mesh.shader=_luminosityShader,renderer.renderSingle(_mesh,_nuke.camera,_this.renderTargetBright),inputRenderTarget=_this.renderTargetBright);for(let i=0;i<_nMips;i++)_mesh.shader=_separableBlurShaders[i],_separableBlurShaders[i].uniforms.colorTexture.value=inputRenderTarget,_separableBlurShaders[i].uniforms.direction.value=_blurDirectionX,renderer.renderSingle(_mesh,_nuke.camera,_renderTargetsHorizontal[i]),_separableBlurShaders[i].uniforms.colorTexture.value=_renderTargetsHorizontal[i].texture,_separableBlurShaders[i].uniforms.direction.value=_blurDirectionY,renderer.renderSingle(_mesh,_nuke.camera,_renderTargetsVertical[i]),inputRenderTarget=_renderTargetsVertical[i];_mesh.shader=_compositeShader,renderer.renderSingle(_mesh,_nuke.camera,_renderTargetsHorizontal[0]),renderer.setClearColor(_oldClearColor,_oldClearAlpha),renderer.autoClear=oldAutoClear}function resizeHandler(){_this.resolution.set(_nuke.stage.width,_nuke.stage.height).multiplyScalar(_DPR),_blurDirectionX.x=_DPR,_blurDirectionY.y=_DPR;let resx=Math.round(_this.resolution.x/2),resy=Math.round(_this.resolution.y/2);_this.renderTargetBright&&_this.renderTargetBright.setSize(resx,resy);for(var i=0;i<_renderTargetsHorizontal.length;i++){_renderTargetsHorizontal[i].setSize(resx,resy),_renderTargetsVertical[i].setSize(resx,resy);let shader=_separableBlurShaders[i];shader&&(shader.uniforms.texSize.value=new Vector2(resx,resy)),resx=Math.round(resx/2),resy=Math.round(resy/2)}}this.uniforms={tUnrealBloom:{value:null,ignoreUIL:!0},unique:_unique},this.resolution=new Vector2(_nuke.stage.width*_DPR,_nuke.stage.height*_DPR),this.clearColor=new Color(0,0,0),this.enabled=void 0===options.enabled||options.enabled,this.outputTexture=null,function initRTs(){if(FX.UnrealBloom.hasRTs)return;let pars={minFilter:Texture.LINEAR,magFilter:Texture.LINEAR,format:Texture.RGBAFormat},resx=Math.round(_this.resolution.x/2),resy=Math.round(_this.resolution.y/2);_this.renderTargetBright=new RenderTarget(resx,resy,pars),_this.renderTargetBright.texture.generateMipmaps=!1,FX.UnrealBloom.putRT("renderTargetBright",_this.renderTargetBright);for(let i=0;i<_nMips;i++){let renderTargetHorizonal=new RenderTarget(resx,resy,pars);renderTargetHorizonal.texture.generateMipmaps=!1,_renderTargetsHorizontal.push(renderTargetHorizonal),FX.UnrealBloom.putRT("mipHorizontal"+i,renderTargetHorizonal);let renderTargetVertical=new RenderTarget(resx,resy,pars);renderTargetVertical.texture.generateMipmaps=!1,_renderTargetsVertical.push(renderTargetVertical),FX.UnrealBloom.putRT("mipVertical"+i,renderTargetVertical),resx=Math.round(resx/2),resy=Math.round(resy/2)}_this.outputTexture=_renderTargetsHorizontal[0].texture,_this.uniforms.tUnrealBloom.value=_renderTargetsHorizontal[0].texture}(),function initScene(){_triangleGeometry=World.QUAD,_luminosityShader=_this.initClass(Shader,"UnrealBloomLuminosity",{tDiffuse:{value:null,ignoreUIL:!0},luminosityThreshold:{value:1},smoothWidth:{value:.01,ignoreUIL:!0},defaultColor:{value:new Color(0),ignoreUIL:!0},defaultOpacity:{value:0,ignoreUIL:!0},unique:_unique}),(_mesh=new Mesh(_triangleGeometry,_luminosityShader)).frustumCulled=!1}(),function initBlurShaders(){let resx=Math.round(_this.resolution.x/2),resy=Math.round(_this.resolution.y/2);for(let i=0;i<_nMips;i++){let shader=_this.initClass(Shader,"UnrealBloomGaussian",{unique:_unique,colorTexture:{value:null},texSize:{value:new Vector2(resx,resy)},direction:{value:new Vector2(.5,.5)}},null,glsl=>`\n#define KERNEL_RADIUS ${_kernelSizeArray[i]}\n#define SIGMA ${_kernelSizeArray[i]}\n${glsl}`,`gaussian${i}`);_separableBlurShaders.push(shader),resx=Math.round(resx/2),resy=Math.round(resy/2)}}(),function initCompositeShader(){let uniforms={bloomStrength:{value:1},bloomTintColor:{value:new Color("#ffffff")},bloomRadius:{value:0},unique:_unique};for(let i=0;i<_nMips;i++)uniforms[`blurTexture${i+1}`]={value:_useRTPool?null:_renderTargetsVertical[i].texture,ignoreUIL:!0};(_compositeShader=_this.initClass(Shader,"UnrealBloomComposite",uniforms,null,(glsl,type)=>{if("vs"===type)return glsl;let compositeUniforms="",compositeMain="";for(let i=0;i<_nMips;i++)compositeUniforms+=`uniform sampler2D blurTexture${i+1};\n`,compositeMain+=`lerpBloomFactor(${_bloomFactors[i].toFixed(4)}) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture${i+1}, vUv) ${i<_nMips-1?"+ ":""}`;return(glsl=glsl.replace("uniform sampler2D blurTexture1;",compositeUniforms)).replace("lerpBloomFactor(1.0) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture1, vUv)",compositeMain)})).needsUpdate=!0}(),function initPass(){_this.pass=_this.initClass(NukePass,"UnrealBloomPass",_this.uniforms)}(),function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler),_this.events.sub(_nuke,Nuke.BEFORE_PASSES,render),_this.startRender(()=>{})}(),options.noUIL||_this.delayedCall(_=>{ShaderUIL.add(_luminosityShader).setLabel("UnrealBloom Luminosity"),ShaderUIL.add(_compositeShader).setLabel("UnrealBloom Composite")},2e3),this.set("texture",texture=>{_inputTexture=texture}),this.get("luminosityShader",_=>_luminosityShader),this.get("compositeShader",_=>_compositeShader),this.set("dpr",dpr=>{_DPR=dpr,resizeHandler()}),this.renderBloom=render,this.renderMesh=_mesh,this.onDestroy=function(){_renderTargetsHorizontal.forEach(r=>r.destroy()),_renderTargetsVertical.forEach(r=>r.destroy()),_this.renderTargetBright&&_this.renderTargetBright.destroy()},this.getRTs=function(){const rt=FX.UnrealBloom.getRT;_this.renderTargetBright=rt("renderTargetBright"),_renderTargetsHorizontal=[],_renderTargetsVertical=[];for(let i=0;i<_nMips;i++)_renderTargetsHorizontal.push(rt("mipHorizontal"+i)),_renderTargetsVertical.push(rt("mipVertical"+i)),_compositeShader.uniforms[`blurTexture${i+1}`].value=_renderTargetsVertical[i].texture;_this.outputTexture=_renderTargetsHorizontal[0].texture,_this.uniforms.tUnrealBloom.value=_renderTargetsHorizontal[0].texture,resizeHandler()},this.putRTs=function(){_this.renderTargetBright=null,_renderTargetsHorizontal=[],_renderTargetsVertical=[]},this.onInvisible=function(){_this.putRTs()},this.onVisible=function(){_this.getRTs()}},_=>{var _pool={};FX.UnrealBloom.putRT=function(key,rt){FX.UnrealBloom.hasRTs=!0,_pool[key]=rt},FX.UnrealBloom.getRT=function(key){return _pool[key]}}),Class(function UnsupportedRedirect(){Inherit(this,Component);var _this=this,_tests=[];this.BOTS=["google","apis-google","mediapartners-google","adsbot-google","googlebot","feedfetcher-google","google-read-aloud","storebot-google","bingbot","facebot","facebookexternalhit","slurp","duckduckbot","baiduspider","yandexbot","sogou","exabot"],this.chrome=55,this.firefox=51,this.safari=8,this.ie=13,this.requiresWebGL=!0,this.url="./fallback",this.test=function(){_this.unsupported()&&function redirect(){window.location=_this.url}()},this.unsupported=function(){if(_this.BOTS.find(bot=>Device.detect(bot)))return!1;if(_tests.find(test=>test()))return!0;if(_this.requiresWebGL&&(!Device.graphics.webgl||GPU.BLOCKLIST))return!0;if(Device?.system?.browserVersion>=0){if("chrome"===Device.system.browser&&Device.system.browserVersion<_this.chrome)return!0;if("firefox"===Device.system.browser&&Device.system.browserVersion<_this.firefox)return!0;if("safari"===Device.system.browser&&Device.system.browserVersion<_this.safari)return!0;if("ie"===Device.system.browser&&Device.system.browserVersion<_this.ie)return!0}return!!Utils.query("unsupported")},this.custom=function(...tests){_tests.push(...tests)}},"static"),Namespace("FX"),FX.Class(function Upscale({nuke:nuke=World.NUKE,texture:texture=(nuke.rttBuffer.read||nuke.rttBuffer).texture,unique:unique}={}){Inherit(this,Component);const _this=this;_this.nuke=nuke,_this.input=texture,_this.uniform={value:null};let _outputBuffer,_upscaleProgram;_this.resolution=new Vector2(Math.round(_this.nuke.stage.width*_this.nuke.dpr*1),Math.round(_this.nuke.stage.height*_this.nuke.dpr*1));const _quad=World.QUAD;!function init(){!function initBuffers(){_outputBuffer=new RenderTarget(_this.resolution.x,_this.resolution.y,{generateMipmaps:!1})}(),function initProgram(){const upShader=_this.initClass(Shader,"lanczosUpscale",{tDiffuse:{value:_this.input,ignoreUIL:!0},uTexSize:{value:new Vector2(1280,720)},uSharpenStrength:{value:1},uLanczosA:{value:3},uUpsampleBlend:{value:1}});ShaderUIL.add(upShader).setLabel("Lanczos Upscale"),_upscaleProgram=new Mesh(_quad,upShader)}()}(),_this.onResize(function handleResize(){_this.resolution.set(Math.round(_this.nuke.stage.width*_this.nuke.dpr*1),Math.round(_this.nuke.stage.height*_this.nuke.dpr*1)),_outputBuffer.setSize(_this.resolution.x,_this.resolution.y),_upscaleProgram.shader.set("uTexSize",_this.resolution.clone())}),_this.render=function render(){_upscaleProgram.shader.set("tDiffuse",_this.input),World.RENDERER.renderSingle(_upscaleProgram,_this.nuke.camera,_outputBuffer),_this.uniform.value=_outputBuffer.texture},_this.get("rawOutput",_=>_outputBuffer.texture)}),Class(function Video(_params){Inherit(this,Component);const _this=this;let $video,_video,_loadingState,_handlers,_sharedVideo=!1,_ready=Promise.create(),_loaded=Promise.create(),_initialPlay=!0,_buffering=!0;function startPreload(){return _loadingState=!0,_video.load(),_ready}async function startPlayback(){if(!_this.playing&&(_loadingState=!1,!_this.playing)){_initialPlay&&(_initialPlay=!1,_params.currentTime&&(_video.currentTime=_params.currentTime)),_this.playing=!0;try{await _video.play()}catch(error){let wasStopped=!_this.playing;if(_this.playing=!1,!wasStopped)throw error}}}function getSource(src=""){return src&&!src.includes(["webm","mp4","ogv","blob","?","m3u8"])&&(src+="."+Device.media.video),src}function progress(e){_this.events.fire(Video.PROGRESS,e)}function timeupdate(e){_this.events.fire(Video.UPDATE,e)}function play(e){if(_loadingState)return _loadingState=!1;_this.events.fire(Video.PLAY,e)}function pause(e){_this.playing=!1,_this.events.fire(Video.PAUSE,e)}function playing(e){_this.events.fire(Video.PLAYING,e)}function buffering(state){_this.events.fire(Video.BUFFERING,{isBuffering:state})}function ended(e){_this.events.fire(Video.ENDED,e),_this.playing=!1}function waiting(e){_this.events.fire(Video.WAITING,e)}function canplay(e){loadeddata(),_this.events.fire(Video.CANPLAY,e)}function canplaythrough(e){loadeddata(),_this.events.fire(Video.CANPLAYTHROUGH,e)}function loadedmetadata(e){_this.dimensions.width=_video.videoWidth,_this.dimensions.height=_video.videoHeight,_this.events.fire(Video.LOADEDMETADATA,e)}function loadeddata(e){_video.readyState>=2&&_ready.resolve(),_video.readyState>=4&&_loaded.resolve()}function error(){_this.playing&&(_this.playing=!1),_this.events.fire(Video.ERROR,_video.error)}_params.toJSON&&((_params=_params.toJSON()).autoplay=_params.autoPlay,"string"==typeof _params.events&&(_params.events=_params.events.split(","))),function initParam(){let defaults={muted:!0,loop:!1,autoplay:!1,inline:!0,controls:!1,currentTime:0,playback:1,preload:!1,width:640,height:360,events:[],disableRemotePlayback:!0};_params=Object.assign(defaults,_params)}(),function init(){return _params.src instanceof HTMLVideoElement?(_video=_params.src,_sharedVideo=!0):(_video=document.createElement("video"),_params.src&&(_video.src=getSource(_params.src)),_video.setAttribute("crossorigin","anonymous"),_video.disableRemotePlayback=_params.disableRemotePlayback,_video.autoplay=_params.autoplay,_video.loop=_params.loop,_video.controls=_params.controls,_video.height=_params.height,_video.width=_params.width,_video.defaultMuted=_params.muted,_video.defaultPlaybackRate=_params.playback,_video.preload="string"==typeof _params.preload?_params.preload:_params.preload?"auto":"none",_video.muted=_params.autoplay||_params.muted,_video.setAttribute("webkit-playsinline",_params.inline),_video.setAttribute("playsinline",_params.inline),_params.poster&&(_video.poster=_params.poster),_video.autoplay&&_video.setAttribute("autoplay",_params.autoplay),_video.setAttribute("muted",_params.muted),_params.loop&&_video.setAttribute("loop",_params.loop)),_this.dimensions={width:_params.width,height:_params.height},_this.div=_video,$video=$(_video),_params.autoplay?startPlayback():_params.preload?startPreload():void 0}(),function addHandlers(){["play","pause","ended","loadedmetadata","loadeddata","canplay","canplaythrough","error"].forEach(ev=>{_params.events.includes(ev)||_params.events.push(ev)}),_handlers={play:play,pause:pause,ended:ended,playing:playing,progress:progress,waiting:waiting,timeupdate:timeupdate,loadedmetadata:loadedmetadata,loadeddata:loadeddata,canplay:canplay,canplaythrough:canplaythrough,error:error},_params.events.forEach(ev=>_video.addEventListener(ev,_handlers[ev],!0)),_video.onwaiting=e=>{_buffering=!0,buffering(_buffering)},_video.onplaying=e=>{_buffering=!1,buffering(_buffering)}}(),function initSharedVideo(){_sharedVideo&&(_video.readyState>=1&&(_this.dimensions.width=_video.videoWidth,_this.dimensions.height=_video.videoHeight),_video.readyState>=2&&_ready.resolve(),_video.readyState>=4&&_loaded.resolve())}(),this.set("loop",bool=>_video.loop=bool),this.get("loop",()=>_video.loop),this.set("src",src=>{(src=getSource(src))!==_video.src&&(_ready=Promise.create(),_loaded=Promise.create(),_video.src=src,_this.playing?(_this.playing=!1,startPlayback()):_params.preload&&startPreload())}),this.get("src",()=>_video.currentSrc),this.set("volume",v=>{v<.001&&(_video.muted=!0),_video.volume=v}),this.get("volume",()=>_video.volume),this.set("muted",bool=>_video.muted=bool),this.get("muted",()=>_video.muted),this.set("controls",bool=>_video.controls=bool),this.get("controls",()=>_video.controls),this.get("duration",()=>_video.duration),this.get("ended",()=>_video.ended),this.get("playback",()=>_video.playbackRate),this.get("time",()=>_video.currentTime),this.get("canRender",()=>_video.readyState>=2),this.get("canPlayThrough",()=>_video.readyState>=4),this.get("paused",()=>_video.paused),this.get("buffering",()=>_buffering),this.get("element",()=>$video),this.get("object",()=>$video),this.get("video",()=>_video),this.get("poster",()=>_video.poster),this.set("poster",poster=>{poster?_video.poster=poster:_video.removeAttribute("poster")}),this.get("bufferedSeconds",_=>_video.readyState<2?0:_video.buffered.end(0)-_video.buffered.start(0)),this.load=async function(){return startPreload()},this.play=async function(){return startPlayback()},this.pause=function(){_this.playing=!1,_video.pause()},this.stop=function(){_this.playing=!1,_video.pause(),_this.seek(0)},this.seek=function(t){if(_video.fastSeek)return _video.fastSeek(t);_video.currentTime=t},this.seekExact=function(t){_video.currentTime=t},this.ready=function(){return _ready},this.loaded=function(){return _loaded},this.onDestroy=function(){_this.stop(),_sharedVideo||(_video.src=""),function removeListeners(){_params.events.forEach(ev=>_video.removeEventListener(ev,_handlers[ev],!0)),_video.onwaiting=()=>{},_video.onplaying=()=>{}}(),_video=null},this.setSize=function(width,height){_video.width=width,_video.height=height,_this.dimensions.width=width,_this.dimensions.height=height}},()=>{Video.PLAY="hydra_video_play",Video.CANPLAY="hydra_video_can_play",Video.CANPLAYTHROUGH="hydra_video_can_play_through",Video.LOADEDMETADATA="hydra_video_loaded_metadata",Video.PAUSE="hydra_video_pause",Video.PROGRESS="hydra_video_progress",Video.UPDATE="hydra_video_update",Video.PLAYING="hydra_video_playing",Video.BUFFERING="hydra_video_buffering",Video.ENDED="hydra_video_ended",Video.WAITING="hydra_video_waiting",Video.ERROR="hydra_video_error"}),Class(function VideoTexture(_path,_props={}){Inherit(this,Component);const _this=this;let _video,_requestId,_hasRequestCallback=!1,_sharedVideo=!1;if(_this.canUpdate=!0,"object"==typeof _path&&!(_path instanceof HTMLVideoElement)){let path=_path.path;_props=_path,_path=path,delete _props.path}let{loop:loop,preload:preload,autoplay:autoplay,muted:muted,firstFrame:firstFrame,parseColor:parseColor,fps:fps,events:events=[]}=_props;function update(){if(_requestId=null,!_this.destroy||!_video.destroy)return;let updateTex=_video.canRender&&_this.canUpdate;if(firstFrame&&updateTex&&(updateTex=_video.time>0),updateTex){_this.videoTexture&&(_this.texture.destroy(),_this.texture=_this.videoTexture,delete _this.videoTexture,firstFrame=null),_this.texture.image||(_this.texture.image=_video.video,_this.texture.upload()),_this.colorParser&&_this.colorParser.update(_video.time);let first=!_this.texture.loaded;_this.texture.loaded=_this.texture.needsUpdate=!0,_this.uniform.value=_this.texture,first&&_this.texture.promise.resolve()}_hasRequestCallback&&(_requestId=_video.element.div.requestVideoFrameCallback(update))}function noop(){}function handleSharedVideoPlaying(){start()}function handleSharedVideoPause(){stop()}function start(){_this.active=!0,_requestId&&(_video.element.div.cancelVideoFrameCallback(_requestId),_requestId=null),_hasRequestCallback?_this.startRender(noop):_this.startRender(update,fps,RenderManager.BEFORE_RENDER),update()}function stop(){_this.active=!1,_hasRequestCallback?_requestId&&_video.element.div.cancelVideoFrameCallback(_requestId):_this.stopRender(update)}void 0===loop&&(loop=!0),void 0===preload&&(preload=!0),void 0===autoplay&&(autoplay=!0),void 0===muted&&(muted=!0),void 0===firstFrame&&(firstFrame=!1),void 0===parseColor&&(parseColor=!1),void 0===events&&(events=[]),void 0===fps&&(fps=30),_this.uniform={value:null,ignoreUIL:!0},function(){let src;if(_props.start&&defer(_=>_this.start()),_path instanceof HTMLVideoElement?(_sharedVideo=!0,src=_path,autoplay=!1,preload=!1,events=[...events,"pause"]):src=_path.includes("blob")?_path:Assets.getPath(_path),!_sharedVideo&&_path.includes(["jpg","png"])){let noop=_=>{};_this.texture=Utils3D.getTexture(src),_this.video={play:noop,pause:noop},parseColor&&(_this.colorParser=_this.initClass(VideoTextureColorParser,src,!0))}else{let videoEvents=["timeupdate","playing","ended"];events.forEach(ev=>{videoEvents.includes(ev)||videoEvents.push(ev)}),_video=_this.initClass(Video,{src:src,loop:loop,preload:preload,autoplay:autoplay,muted:muted,events:videoEvents}),_this.texture=new Texture,_this.texture.format=Texture.RGBFormat,_this.texture.minFilter=_this.texture.magFilter=Texture.LINEAR,_this.texture.generateMipmaps=!1,_this.texture.promise=Promise.create(),_this.texture.uploadIgnore=!0,_this.texture.loaded=!1,_this.video=_video,_this.dimensions=_video.dimensions,_this.texture.dimensions=_this.dimensions,_this.events.bubble(_video,Video.PLAYING),parseColor&&(_this.colorParser=_this.initClass(VideoTextureColorParser,src,!1)),firstFrame&&(_this.videoTexture=_this.texture,_this.texture=Utils3D.getTexture(firstFrame))}_this.uniform.value=_this.texture,_hasRequestCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,"safari"===Device.system.browser&&(_hasRequestCallback=!1),_sharedVideo&&function initSharedVideo(){_this.events.sub(_video,Video.PLAYING,handleSharedVideoPlaying),_this.events.sub(_video,Video.PAUSE,handleSharedVideoPause),!_video.paused&&_video.video.readyState>=2&&handleSharedVideoPlaying()}()}(),this.set("loop",loop=>_video.loop=loop),this.set("muted",muted=>_video.muted=muted),this.get("src",()=>_video.src),this.set("src",src=>{src!==_this.src&&(_requestId&&(_video.element.div.cancelVideoFrameCallback(_requestId),_requestId=null),_video.src=src.includes("blob")?src:Assets.getPath(src),_hasRequestCallback&&_this.active&&(_requestId=_video.element.div.requestVideoFrameCallback(update)))}),this.get("firstFrame",()=>firstFrame),this.set("firstFrame",nextFirstFrame=>{firstFrame!==nextFirstFrame&&(firstFrame=nextFirstFrame,firstFrame&&_video.time<=0&&(_this.videoTexture||(_this.videoTexture=_this.texture),_this.texture=Utils3D.getTexture(firstFrame),_this.uniform.value=_this.texture))}),this.start=async function(){_sharedVideo||_video&&(start(),await _video.play())},this.stop=function(){_sharedVideo||_video&&(stop(),_video.pause())},this.seek=function(time){_sharedVideo||_video&&_video.seek(time)},this.onInvisible=function(){_sharedVideo||(_this.active&&_video.pause(),VideoTexture.element().removeChild(_this.video.object,!0))},this.onVisible=function(){_sharedVideo||(_this.active&&_video.play(),VideoTexture.element().add(_this.video.object))},this.onDestroy=function(){_this.texture.destroy(),_sharedVideo||VideoTexture.element().removeChild(_this.video.object,!0)}},_=>{var $element;VideoTexture.element=function(){return $element||(($element=Stage.create("VideoTextures")).css({position:"absolute",pointerEvents:"none",left:0,top:0,overflow:"hidden"}),$element.size(0,0).setZ(-10),Stage.add($element)),$element}}),Class(function VideoTextureColorParser(_path,_static){Inherit(this,Component);const _this=this;var _colorData,_color=new Color;this.color=new Color,this.lerp=1,async function(){let path=_path.split(".")[0]+".json";_colorData=await get(path)}(),this.update=function(time){if(_colorData)for(let key in _colorData)if(time<=key){_color.set("#"+_colorData[key]),_this.color.lerp(_color,_this.lerp);break}}}),Class(function VimeoAPI(){Inherit(this,Component);const DOMAINS=["player.vimeo.com"];function isVimeoAPIUrl(url,suffix){if(!url)return!1;for(let i=0;i<DOMAINS.length;i++)if(url.indexOf(`//${DOMAINS[i]}/${suffix}`)>=0)return!0;return!1}this.ready=this.api=async function getAPI(){if(window.Vimeo)return window.Vimeo;if(!function scriptAdded(){let scripts=document.getElementsByTagName("script");for(let i=0;i<scripts.length;++i){if(isVimeoAPIUrl(scripts[i].getAttribute("src"),"api/player.js"))return!0}}()){let tag=document.createElement("script");tag.src="https://player.vimeo.com/api/player.js";let firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)}return await AssetLoader.waitForLib("Vimeo"),window.Vimeo},this.getVideoUrl=function(url){return!!url.includes("vimeo.com")&&url}},"static"),Class(function SocketConnection(_server,_channel,_options={}){Inherit(this,Component);var _socket,_pingPong,_this=this,_fail=0,_binary={},_time=Render.TIME;function connect(){_this.pending=!1,(_socket=_options.noDeflate?new WebSocket(_server):new WebSocket(_server,["permessage-deflate"])).binaryType="arraybuffer",_socket.onopen=open,_socket.onmessage=message,_socket.onclose=close,_socket.onerror=close}function sendPing(){_socket&&_socket.readyState==WebSocket.OPEN&&_socket.send("ping")}function checkIfConnected(){_this.blocked||_this.connected||(_this.blocked=!0,_this.events.fire(SocketConnection.BLOCKED))}function open(e){_fail=0,_this.connected=!0,_this.events.fire(SocketConnection.OPEN,{socket:_this},!0),_channel&&_this.send("register",{channel:_channel}),_pingPong=setInterval(sendPing,5e3)}function message(e){if("pong"!==e.data&&"ping"!==e.data)if("string"==typeof e.data)try{let data=JSON.parse(e.data),evt=data._evt;evt?(delete data._evt,_this.events.fire(evt,data,!0)):(_binary.data=data,_this.events.fire(SocketConnection.BINARY,_binary))}catch(er){}else _binary.data=e.data,_this.events.fire(SocketConnection.BINARY,_binary)}function close(e){if(Render.TIME-_time<50&&!_this.blocked)return _this.blocked=!0,_this.events.fire(SocketConnection.BLOCKED);_this.pending||_fail++>250||(_this.connected=!1,_this.pending=!0,_this.events.fire(SocketConnection.CLOSE,{socket:_this},!0),_this.timer=_this.delayedCall(connect,250),clearTimeout(_pingPong))}this.connected=!1,async function(){try{connect()}catch(e){await defer(),_this.events.fire(SocketConnection.ERROR,{socket:_this}),_this.timer=_this.delayedCall(connect,250),_this.delayedCall(checkIfConnected,2e4)}}(),this.send=function(evt,data={}){if(!_this.connected)return _this.delayedCall(_=>_this.send(evt,data),100);data._evt=evt,_socket&&_socket.readyState==WebSocket.OPEN&&_socket.send(null!=data.length?data:JSON.stringify(data))},this.sendBinary=function(data){_socket&&_socket.readyState==WebSocket.OPEN&&_socket.bufferedAmount<1024&&_socket.send("binary:"+(null!=data.length?data:JSON.stringify(data)))},this.close=function(){_socket.onclose=null,_socket.onerror=null,clearTimeout(_this.timer),_socket.close()}},_=>{SocketConnection.OPEN="socket_connection_open",SocketConnection.CLOSE="socket_connection_close",SocketConnection.ERROR="socket_connection_error",SocketConnection.BINARY="socket_connection_binary",SocketConnection.BLOCKED="socket_connection_blocked"}),Class(function YoutubeAPI(){Inherit(this,Component);const DOMAINS=["www.youtube.com","www.youtube-nocookie.com"];function isYoutubeAPIUrl(url,suffix){if(!url)return!1;for(let i=0;i<DOMAINS.length;i++)if(url.indexOf(`//${DOMAINS[i]}/${suffix}`)>=0)return!0;return!1}this.ready=this.api=async function getAPI(){if(window.YT)return window.YT;let otherReady,promise=Promise.create();if(window.onYouTubeIframeAPIReady&&(otherReady=window.onYouTubeIframeAPIReady),window.onYouTubeIframeAPIReady=()=>{otherReady&&otherReady(),promise.resolve(window.YT)},!function scriptAdded(){let scripts=document.getElementsByTagName("script");for(let i=0;i<scripts.length;++i){let src=scripts[i].getAttribute("src");if(isYoutubeAPIUrl(src,"iframe_api")||isYoutubeAPIUrl(src,"player_api"))return!0}}()){let tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";let firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)}return promise},this.getVideoId=function(url){return!!new RegExp(/^((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube\.com|youtu.be))(\/(?:[\w\-]+\?v=|embed\/|v\/)?)([\w\-]+)(\S+)?$/gm).test(url)&&(void 0!==(url=url.split(/(vi\/|v%3D|v=|\/v\/|youtu\.be\/|\/embed\/)/))[2]?url[2].split(/[^0-9a-z_\-]/i)[0]:url[0])}},"static"),Class(function OptionalFragFXScene(){Inherit(this,FragFXScene);const _this=this;let _initLayout=_this.initLayout;_this.initLayout=function(name){let promise=_initLayout.call(_this,name);return _this.cameraController&&!Utils.query("orbit")&&_this.useCamera(_this.cameraController.worldCamera),promise}}),Class(function CMS(){Inherit(this,Model);const _this=this;let _sanityLib,_client,_liveModeEnabled,_pageSubscription,_siteSettingsSubscription,_disableVisualEditing,_ssgContent,_ssgSiteSettings,_usingSSG,_richTextDictionary;function initSSG(){if(!Hydra.LOCAL&&!AppState.get("CMS/preview")){let contentEl=document.getElementById("ssgContent"),siteSettingsEl=document.getElementById("ssgSiteSettings");contentEl&&siteSettingsEl&&(_ssgContent=JSON.parse(contentEl.textContent),_ssgSiteSettings=JSON.parse(siteSettingsEl.textContent),_usingSSG=!0,contentEl.parentNode.removeChild(contentEl),siteSettingsEl.parentNode.removeChild(siteSettingsEl))}}async function initSanityClient(){if(_usingSSG)_client=null,_liveModeEnabled=!1,SplitText.usingStega=_liveModeEnabled,AppState.set("CMS/liveModeEnabled",_liveModeEnabled),(Utils.query("sanity-preview-secret")||Utils.query("sanity-preview-perspective")||Utils.query("sanity-preview-pathname"))&&Utils.removeQuery("sanity-preview-secret","sanity-preview-perspective","sanity-preview-pathname");else{_sanityLib||(_sanityLib=await LibLoader.import("sanity"),SanityUtils.stegaClean=_sanityLib.stegaClean,SanityUtils.stegaSplit=_sanityLib.stegaSplit);let previewToken=AppState.get("CMS/previewToken");_liveModeEnabled=!!previewToken&&[...location.ancestorOrigins].includes(Config.SANITY_STUDIO_URL),SplitText.usingStega=_liveModeEnabled,AppState.set("CMS/liveModeEnabled",_liveModeEnabled),_client=_sanityLib.createSanityClient({projectId:"61nocsj5",apiVersion:"2025-03-18",dataset:Config.SANITY_DATASET||"development"},previewToken,_liveModeEnabled?Config.SANITY_STUDIO_URL:null);let isHash=Hydra.LOCAL||!Device.system.pushstate;if(Utils.query("sanity-preview-secret")||Utils.query("sanity-preview-perspective")||Utils.query("sanity-preview-pathname")){let href=location.href;Utils.removeQuery("sanity-preview-secret","sanity-preview-perspective","sanity-preview-pathname");let result=await _sanityLib.validatePreviewUrl(_client,href);if(!result.isValid)return Utils.removeQuery("token"),Utils.removeQuery("preview"),sessionStorage.removeItem("sanityPreviewToken"),AppState.get("CMS/previewToken",null),AppState.get("CMS/preview",!1),initSSG(),initSanityClient();{let redirectTo=new URL(result.redirectTo||"/",location.origin);isHash&&(redirectTo.hash=`#!${redirectTo.pathname}`,redirectTo.pathname=location.pathname),redirectTo.searchParams.delete("sanity-preview-perspective"),window.history.replaceState(null,null,`${redirectTo.pathname}${redirectTo.search}${redirectTo.hash}`)}}_liveModeEnabled&&(isHash&&Utils.query("route")&&window.history.replaceState(null,null,`${location.origin}${location.pathname}#!/${Utils.query("route")}`),_disableVisualEditing=_sanityLib.enableVisualEditing({history:{subscribe(navigate){let hasFired=!1,ignoreNext=!0,doNavigate=()=>{hasFired=!0,ignoreNext?ignoreNext=!1:navigate({type:"push",url:`${location.pathname}${location.hash}`})},routeBinding=_this.bindState(AppState,"Router/state",()=>{doNavigate()}),firstRouteBinding=_this.bindState(AppState,"ViewController/transitioning",()=>{hasFired||doNavigate(),firstRouteBinding.destroy(),firstRouteBinding=null});return()=>{routeBinding.destroy(),firstRouteBinding&&firstRouteBinding.destroy()}},update(update){let route=function getRouteFromUrl(url){let route=url.pathname,isHash=Hydra.LOCAL||!Device.system.pushstate;if(isHash)if(route=url.hash,route&&route.startsWith("#!"))route=route.slice(2);else{let buggyPrefix=encodeURIComponent("#!"),index=url.search.lastIndexOf(buggyPrefix);index>=0?route=decodeURIComponent(url.search.substring(index+buggyPrefix.length)):route||(route=url.searchParams.get("route")||"")}return route}(new URL(location.origin+update.url));switch(update.type){case"push":_this.events.fire(ViewController.NAVIGATE,{route:route});break;case"pop":_this.events.fire(ViewController.BACK);break;case"replace":_this.events.fire(ViewController.REPLACE,{route:route})}}},refresh(payload){if("manual"!==payload.source)return!1;location.reload()}}))}_this.dataReady=!0}function processPageContent(content){if(!content)return content;let slices=content.slices;if("article"===content._type){let newsArticleContent={_type:"newsArticleContent",slices:slices,title:content.title,summary:content.summary};slices=[],content.slices=slices,slices.push({_type:"navColorSlice",navColorMode:"dark"}),slices.push({_type:"newsHeaderSlice",title:content.title,date:content.date,image:content.image,categories:content.categories,authors:content.authors}),slices.push(newsArticleContent),content.relatedArticles?.length&&slices.push({_type:"newsFeaturedSlice",header:AppState.get("Global/siteSettings").newsRelatedArticlesTitle,cta:AppState.get("Global/siteSettings").newsFeaturedArticlesCta,featureArticles:content.relatedArticles.slice(0,3).map(article=>({link:article,tag:article.categories?.[0]?.title})),showThumbnail:!0})}let bookCollection,bookTitle,deepLinks=slices.filter(slice=>slice.slug?.current).map(slice=>({_type:"internalLink",hash:slice.slug.current,text:slice.deepLinkTitle||slice.title,reference:{_id:content._id,title:content.title,slug:content.slug,parent:content.parent}}));return deepLinks.length>1&&(content.subsectionLinks=deepLinks),"book"===content.viewType&&(content.bookCollection&&(bookCollection=content.bookCollection),content.title&&(bookTitle=content.title)),AppState.set("CMS/bookCollection",bookCollection||null),AppState.set("CMS/bookTitle",bookTitle||null),slices.forEach(slice=>{switch(slice._type){case"navColorSlice":content.navState=slice.navColorMode;break;case"product3dSlice":if(_liveModeEnabled){let{encoded:encoded,cleaned:cleaned}=SanityUtils.stegaSplit(slice.sceneName);encoded&&(slice.sceneName=cleaned,slice.sceneNameStega=encoded)}break;case"accordionSlice":case"announcementSlice":case"featureSlice":case"formSlice":case"headlineSlice":case"imageCollectionSlice":case"latticeFeaturesSlice":case"latticeMissionSlice":case"linkCarousel":case"modalFormSlice":case"oneColumnRichText":case"pageHero":case"productApplicationSlice":case"productHeaderSlice":case"productQualitiesSlice":case"spacerSlice":case"textContentSlice":case"threeColumnRichText":case"twoColumnRichText":if(_liveModeEnabled){let{encoded:encoded,cleaned:cleaned}=SanityUtils.stegaSplit(slice.backgroundColor.contrastColor);encoded&&(slice.backgroundColor.contrastColor=cleaned,slice.backgroundColor.contrastColorStega=encoded)}}}),content.slices=content.slices.filter(slice=>"navColorSlice"!==slice._type),content}function wrapAppState({object:object,isRoot:isRoot=!0,wrapInitial:wrapInitial=!0,parentType:parentType=""}){if("string"==typeof object)throw new Error(`Found an array of type string/text in the schema for ${parentType}. This is not supported due to StateArray entries needing to be objects.\n                Please convert the array's "of" type to an object with a "text" field.\n                Example:\n                    type: 'array',\n                    of: [{ type: 'text', rows: 1 }],\n\n                    becomes\n\n                    type: 'array',\n                    of: [{ type: 'object', fields: [{name: 'text', title: 'Text', type: 'text', rows: 1 }] }],\n                `);for(let key in object)if("map"!==key&&"bindings"!==key&&"onUpdate"!==key&&"origin"!==key&&Object.hasOwnProperty.call(object,key)){let value=object[key];if("object"==typeof value)if(Array.isArray(value)){let isRichText=!1;if(_richTextDictionary[object._type]&&(isRichText=_richTextDictionary[object._type].includes(key)),_richTextDictionary[parentType]&&(isRichText=_richTextDictionary[parentType].includes(key)),isRichText)object[key]=value;else{let newArray=value.map(item=>wrapAppState({object:item,isRoot:!1,parentType:object._type}));object[key]=new StateArray(newArray);let customProps=Object.keys(value).filter(key=>isNaN(parseInt(key))&&"length"!==key);customProps.forEach(prop=>object[key][prop]=value[prop])}}else value&&!value.isAppState&&isRoot&&(object[key]=AppState.createLocal(value))}return wrapInitial?AppState.createLocal(object):object}function updateContentAppState(appState,content){let diffs=_sanityLib.diff(appState,content),changes=[];diffs.forEach(diff=>{let changedPropName=diff.p[diff.p.length-1];if("_updatedAt"===changedPropName||"_rev"===changedPropName)return;let[statePath,prop]=function findStatePathToUpdate(appState,path){let prop;for(;prop=path.last(),(path=path.slice(0,-1)).length;){let parent=_sanityLib.get(appState,path);if(parent.constructor===AppState.constructor||parent.constructor===StateArray.constructor)break}return[path,prop]}(appState,diff.p),propPath=diff.p.slice(statePath.length);propPath.shift(),changes.push({statePath:statePath,propPath:propPath,prop:prop,type:diff.t,value:diff.v})});for(let change of changes){let path=change.statePath,localState=path.length?_sanityLib.get(appState,path):appState;if(!localState)return;if(3===change.type){if(localState[change.prop]?.constructor===StateArray){let orderedUIDs=change.value.map(key=>{let item=localState[change.prop].find(item=>item._key===key);return item?._uid}).filter(Boolean);localState[change.prop].reorder(orderedUIDs)}}else if(0===change.propPath.length)change.value?localState[change.prop]=wrapAppState({object:change,isRoot:!1,wrapInitial:!1}).value:localState[change.prop]?.constructor===StateArray?localState[change.prop]=new StateArray([]):localState[change.prop]?.isAppState?(console.warn("AppState deletion case not handled:",localState[change.prop]),localState[change.prop]=null):localState[change.prop]=null;else{let copy;copy=Array.isArray(localState[change.prop])?[...localState[change.prop]]:localState[change.prop]?.refresh?localState[change.prop]:{...localState[change.prop]};let target=copy;for(let i=0;i<change.propPath.length-1;i++){target=target[change.propPath[i]]}target?.constructor===StateArray?change.value?change.value&&!target[change.propPath[change.propPath.length-1]]?target.push(change.value):target[change.propPath[change.propPath.length-1]]=change.value:target.remove(target[change.propPath[change.propPath.length-1]]):target[change.propPath[change.propPath.length-1]]=change.value,localState[change.prop]=copy}}}function needsRegex(pattern){return/[.*+?^${}()|[\]\\]/.test(pattern)}function replaceGroups(match,destination){return destination.replace(/\$(\d+)/g,(_,n)=>match[n]||"")}async function loadGlobalContent(){let settings=await Data.request("settings");AppState.set("Global/siteSettings",settings),SanityImageUrlBuilder.configure(settings.imageUrlBuilderOptions)}function richTextImageRenderer(richTextImage,$img,parent){let params=AppState.createLocal(richTextImage);return parent.initClass(RichTextImage,params,null)}function videoWithMetaRenderer(videoWithMeta,$div,parent){let params=AppState.createLocal({videoWithMeta:videoWithMeta});return parent.initClass(ResponsiveVideo,params,null)}function downloadRenderer(download,$div,parent){let params=AppState.createLocal({download:download});return parent.initClass(Downloadable,params,null)}function decalRenderer(decal,$div,parent){let params=AppState.createLocal({decal:decal});return parent.initClass(Decal,params,null)}function externalLinkButtonRenderer(externalLinkButton,$div,parent){let params=AppState.createLocal({externalLinkButton:externalLinkButton});return parent.initClass(ExternalLinkButton,params,null)}function internalLinkButtonRenderer(internalLinkButton,$div,parent){let params=AppState.createLocal({internalLinkButton:internalLinkButton});return parent.initClass(InternalLinkButton,params,null)}function actionButtonRenderer(actionButton,$div,parent){let params=AppState.createLocal({actionButton:actionButton});return parent.initClass(ActionButton,params,null)}function videoEmbedRenderer(videoEmbed,$div,parent){let params=AppState.createLocal({videoEmbed:videoEmbed});return parent.initClass(VideoEmbed,params,null)}function mediaCaptionBlockRenderer(mediaCaptionBlock,$div,parent){let params=AppState.createLocal({mediaCaptionBlock:mediaCaptionBlock});return parent.initClass(MediaCaptionBlock,params,null)}function animatedChartsRenderer(animatedCharts,$div,parent){let params=AppState.createLocal({animatedCharts:animatedCharts});return parent.initClass(AnimatedCharts,params,null)}function animatedImageRenderer(animatedImage,$div,parent){let params=AppState.createLocal({animatedImage:animatedImage});return parent.initClass(AnimatedImage,params,null)}function tableRenderer(table,$div,parent){let params=AppState.createLocal({table:table});return parent.initClass(Table,params,null)}function textRenderer({children:children,value:value}){return`<p class="${value.style}">${children}</p>`}function highlightRenderer(highlightName){let className=`highlight${highlightName.capitalize()}`;return function highlightRenderer({children:children,value:value}){let classes=className;return"swipe"===value?.animation&&(classes+=" swipe"),`<span class="highlight ${classes}">${children}</span>`}}function displayRenderer({children:children,value:value}){return`<h2 class="${value.style}">${children}</h2>`}async function handlePreviewChange(preview,wasPreview){!preview&&wasPreview&&(_this.dataReady=!1,_liveModeEnabled=!1,SplitText.usingStega=_liveModeEnabled,AppState.set("CMS/liveModeEnabled",_liveModeEnabled),_pageSubscription&&(_pageSubscription.destroy(),_pageSubscription=null),_siteSettingsSubscription&&(_siteSettingsSubscription.destroy(),_siteSettingsSubscription=null),_disableVisualEditing&&(_disableVisualEditing(),_disableVisualEditing=null),AppState.set("CMS/previewToken",null),AppState.set("CMS/preview",!1),await initSanityClient(),await loadGlobalContent(),_this.dataReady=!0)}!async function(){!function initRichText(){PortableText.registerTypeRenderer("richTextImage",richTextImageRenderer,"figure"),PortableText.registerTypeRenderer("videoWithMeta",videoWithMetaRenderer,"div"),PortableText.registerTypeRenderer("download",downloadRenderer,"a"),PortableText.registerTypeRenderer("decal",decalRenderer,"div"),PortableText.registerTypeRenderer("externalLinkButton",externalLinkButtonRenderer,"a"),PortableText.registerTypeRenderer("internalLinkButton",internalLinkButtonRenderer,"a"),PortableText.registerTypeRenderer("actionButton",actionButtonRenderer,"button"),PortableText.registerTypeRenderer("videoEmbed",videoEmbedRenderer,"div"),PortableText.registerTypeRenderer("mediaCaptionBlock",mediaCaptionBlockRenderer,"div"),PortableText.registerTypeRenderer("animatedCharts",animatedChartsRenderer,"div"),PortableText.registerTypeRenderer("animatedImage",animatedImageRenderer,"div"),PortableText.registerTypeRenderer("table",tableRenderer,"div"),PortableText.registerBlockRenderer("h7",displayRenderer),PortableText.registerBlockRenderer("h8",displayRenderer),PortableText.registerBlockRenderer("display1",displayRenderer),PortableText.registerBlockRenderer("display2",displayRenderer),PortableText.registerBlockRenderer("display3",displayRenderer),PortableText.registerBlockRenderer("display4",displayRenderer),PortableText.registerBlockRenderer("lead",textRenderer),PortableText.registerBlockRenderer("body1",textRenderer),PortableText.registerBlockRenderer("body2",textRenderer),PortableText.registerBlockRenderer("body3",textRenderer),PortableText.registerBlockRenderer("cta",textRenderer),PortableText.registerBlockRenderer("detail",textRenderer),PortableText.registerBlockRenderer("detailElios",textRenderer),PortableText.registerMarkRenderer("highlightYellow",highlightRenderer("yellow")),PortableText.registerMarkRenderer("highlightGraphite",highlightRenderer("graphite")),PortableText.registerMarkRenderer("highlightDarkGray",highlightRenderer("darkgray"))}(),function initPreview(){let token=Utils.query("token"),preview=Utils.query("preview");preview&&!["enable","disable"].includes(preview)&&(preview="enable");token&&"enable"===preview?(token=function rot13(str){let result="";const ca="a".charCodeAt(0),cA="A".charCodeAt(0),c0="0".charCodeAt(0);for(let i=0;i<str.length;i++){let c=str.charAt(i);result+=c>="a"&&c<="z"?String.fromCharCode((c.charCodeAt(0)-ca+13)%26+ca):c>="A"&&c<="Z"?String.fromCharCode((c.charCodeAt(0)-cA+13)%26+cA):c>="0"&&c<="9"?String.fromCharCode((c.charCodeAt(0)-c0+5)%10+c0):c}return result}(token),sessionStorage.setItem("sanityPreviewToken",token),Utils.removeQuery("token","preview")):(token=sessionStorage.getItem("sanityPreviewToken"),preview=token?"enable":"disable");"enable"===preview?(AppState.set("CMS/previewToken",token),AppState.set("CMS/preview",!0)):(AppState.set("CMS/previewToken",null),AppState.set("CMS/preview",!1));if(Config.DEV){let dataset=Utils.query("cms");dataset?(Utils.removeQuery("cms"),"production"===dataset&&sessionStorage.setItem("cmsDataset","production")):dataset=sessionStorage.getItem("cmsDataset"),"production"===dataset?AppState.set("CMS/dataset","production"):(dataset=null,sessionStorage.removeItem("cmsDataset"))}}(),initSSG(),await initSanityClient(),function initRequests(){Data.handleRequest("settings",async()=>_siteSettingsSubscription?_siteSettingsSubscription.promise:_usingSSG?_ssgSiteSettings:_liveModeEnabled?(_siteSettingsSubscription=_sanityLib.subscribeSiteSettings(_client),_siteSettingsSubscription.promise=Promise.create(),_siteSettingsSubscription.onChange(settings=>{_siteSettingsSubscription.settingsAppState?(updateContentAppState(_siteSettingsSubscription.settingsAppState,settings),_this.events.fire(Events.UPDATE,{settings:_siteSettingsSubscription.settingsAppState})):(_siteSettingsSubscription.settingsAppState=wrapAppState({object:settings}),_siteSettingsSubscription.promise.resolve(_siteSettingsSubscription.settingsAppState))}),_siteSettingsSubscription.promise):_sanityLib.fetchSiteSettings(_client)),Data.handleRequest("page",async path=>{if(path||(path=""),path.endsWith("/")&&(path=path.slice(0,-1)),_pageSubscription){if(_pageSubscription.path===path)return _pageSubscription.promise;_pageSubscription.destroy(),_pageSubscription=null}let page;if(_usingSSG)if(!_ssgContent||_ssgContent.path!==path&&"404"!==_ssgContent.path){let url=Config.CONTENT_URL;url.endsWith("/")||(url+="/"),url+=`${path||"index"}.json`,page=await get(url)}else page=_ssgContent,_ssgContent=null;else{if(_liveModeEnabled)return _pageSubscription=_sanityLib.subscribePage(_client,path),_pageSubscription.path=path,_pageSubscription.promise=Promise.create(),_pageSubscription.onChange(page=>{page=processPageContent(page),_pageSubscription.pageAppState?(updateContentAppState(_pageSubscription.pageAppState,page),_this.events.fire(Events.UPDATE,{page:_pageSubscription.pageAppState})):(_pageSubscription.pageAppState=wrapAppState({object:page}),_pageSubscription.promise.resolve(_pageSubscription.pageAppState))}),_pageSubscription.promise;page=await _sanityLib.fetchPage(_client,path)}return processPageContent(page)})}(),function addHandlers(){_this.bindState(AppState,"CMS/preview",handlePreviewChange)}();const{richTextDictionary:richTextDictionary}=require("RichTextDictionary");_richTextDictionary=richTextDictionary,_this.imageUrlBuilder=SanityUtils.imageUrlBuilder,_this.rawImageUrlBuilder=SanityUtils.rawImageUrlBuilder,_this.getImageDimensions=SanityUtils.getImageDimensions,_this.resolveLinks=SanityUtils.resolveLinks,_this.resolveLink=SanityUtils.resolveLink,_this.resolvePath=SanityUtils.resolvePath,loadGlobalContent()}(),_this.getImageSrcSet=function(imageWithMetaOrImageUrl,cropAspectRatio){let width,height,aspectRatio,source,vector=!1;if("string"==typeof imageWithMetaOrImageUrl)({width:width,height:height,aspectRatio:aspectRatio}=_this.getImageDimensions(imageWithMetaOrImageUrl)),source=imageWithMetaOrImageUrl;else{let imageWithMeta=imageWithMetaOrImageUrl;if(!imageWithMeta?.asset?.metadata)return[];source=imageWithMeta,vector="image/svg+xml"===source.asset.mimeType;const metadata=source.asset.metadata;({width:width,height:height,aspectRatio:aspectRatio}=metadata.dimensions)}const sizes=[];if(!vector){const resizeBuilder=_this.imageUrlBuilder(source);let byWidth=!0,max=width;(cropAspectRatio||aspectRatio)<1&&(byWidth=!1,max=height);for(let v=320;v<max-160;v+=320){let w=byWidth?v:Math.round(v*(cropAspectRatio||aspectRatio)),h=byWidth?Math.round(v/(cropAspectRatio||aspectRatio)):v,builder=resizeBuilder[byWidth?"width":"height"](v);cropAspectRatio&&(builder=builder[byWidth?"height":"width"](byWidth?h:w)),sizes.push({width:w,height:h,url:builder.url()})}}if(cropAspectRatio&&!vector){let w=width,h=height;cropAspectRatio<aspectRatio?w=Math.round(h*cropAspectRatio):h=Math.round(width/cropAspectRatio),sizes.push({width:w,height:h,url:_this.imageUrlBuilder(source).width(w).height(h).url()})}else sizes.push({width:width,height:height,url:(vector?_this.rawImageUrlBuilder:_this.imageUrlBuilder)(source).url()});return vector&&(sizes[0].vector=!0),sizes},_this.getCroppedImageSrc=function(imageWithMetaOrImageUrl,croppedWidth,croppedHeight){let width,height,source,vector=!1;if("string"==typeof imageWithMetaOrImageUrl)({width:width,height:height}=_this.getImageDimensions(imageWithMetaOrImageUrl)),source=imageWithMetaOrImageUrl;else{let imageWithMeta=imageWithMetaOrImageUrl;if(!imageWithMeta?.asset?.metadata)return[];source=imageWithMeta.asset,vector="image/svg+xml"===source.mimeType;const metadata=source.metadata;({width:width,height:height}=metadata.dimensions)}if(vector)return{width:width,height:height,url:_this.rawImageUrlBuilder(source).url()};let requestWidth=Math.clamp(320*Math.ceil(croppedWidth/320),0,width);requestWidth<width&&width-requestWidth<=160&&(requestWidth=width);let requestHeight=Math.round(requestWidth/croppedWidth*croppedHeight);return{width:requestWidth,height:requestHeight,url:_this.imageUrlBuilder(source).width(requestWidth).height(requestHeight).url()}},_this.getImageAltText=function(imageWithMeta){return imageWithMeta?.alt||imageWithMeta?.asset?.altText||""},_this.getImageCaption=function(imageWithMeta){return imageWithMeta?.caption||imageWithMeta?.asset?.caption||""},_this.redirect=function redirect(path){path=`/${path}`;let cmsRedirects=AppState.get("Global/siteSettings")?.redirects?.rules||[];for(let i=0;i<cmsRedirects.length;i++){const cmsRedirect=cmsRedirects[i];try{let match;if(needsRegex(cmsRedirect.from)){match=new RegExp(cmsRedirect.from).exec(path)}else match=path===cmsRedirect.from?[path]:null;if(match){let destination=cmsRedirect.to.includes("$")?replaceGroups(match,cmsRedirect.to):cmsRedirect.to;return destination.startsWith("/")&&(destination=destination.slice(1)),destination}}catch(error){console.error(`Invalid redirect pattern: ${cmsRedirect.from}`,error)}}return!1}},"static"),Class(function Search(){Inherit(this,Model);const _this=this;let _client;!async function initAlgolia(){let algolia=await LibLoader.import("algolia");_client=algolia.searchClient("EKYOZ1VARX","cc7c97f46dd432f640dc8a1babb30233"),_this.dataReady=!0}(),Data.handleRequest("search",async({query:query="",page:page=0}={})=>(_this.dataReady||await _this.ready(),_client.searchSingleIndex({indexName:"content",searchParams:{query:query,page:page,hitsPerPage:12}}))),Data.handleRequest("news",async({query:query="",categorySlug:categorySlug,page:page=0}={})=>{_this.dataReady||await _this.ready();let filters=["_type:article"];return categorySlug&&filters.push(`categories:"${categorySlug}"`),_client.searchSingleIndex({indexName:"content",searchParams:{query:query,filters:filters.join(" AND "),page:page,hitsPerPage:12}})}),Data.handleRequest("jobs",async({query:query="",department:department=[],location:location=[],employmentType:employmentType=[],page:page=0}={})=>{_this.dataReady||await _this.ready();let departmentFilter=[],locationFilter=[],employmentTypeFilter=[];return department&&department.forEach(dept=>{departmentFilter.push(`department:${dept}`)}),location&&location.forEach(loc=>{locationFilter.push(`location:${loc}`)}),employmentType&&employmentType.forEach(type=>{employmentTypeFilter.push(`employmentType:${type}`)}),_client.searchSingleIndex({indexName:"jobs",searchParams:{query:query,facetFilters:[departmentFilter,locationFilter,employmentTypeFilter],page:page,hitsPerPage:100}})}),Data.handleRequest("facets",async()=>{let[departmentValues,employmentTypeValues,locationValues]=await Promise.all([_client.searchForFacetValues({indexName:"jobs",facetName:"department"}),_client.searchForFacetValues({indexName:"jobs",facetName:"employmentType"}),_client.searchForFacetValues({indexName:"jobs",facetName:"location"})]);return{departments:departmentValues.facetHits.map(dept=>dept.value),employmentTypes:employmentTypeValues.facetHits.map(type=>type.value),locations:locationValues.facetHits.map(loc=>loc.value)}})},"static"),Module(function RichTextDictionary(){this.exports={richTextDictionary:{settings:["cookieBannerText"],person:["bio"],imageWithMeta:["caption"],videoWithMeta:["caption"],announcementSlice:["col1","col2","col3"],announcementList:["headerText","subheadText"],pageHero:["description"],openRolesHero:["description"],oneColumnRichText:["content"],twoColumnRichText:["column1","column2"],threeColumnRichText:["column1","column2","column3"],fourColumnRichText:["column1","column2","column3","column4"],productHeaderSlice:["column1","column2"],subdomainHeaderSlice:["column1","column2"],subdomainMediaSlice:["col1","col2"],latticeMediaSlice:["paragraph"],connectedHeaderSlice:["column1","column2"],rebootHeaderSlice:["description"],featureSliceBlock:["description"],productApplicationBlock:["text"],latticeMissionSliceBlock:["description"],standardForm:["label"],accordionItem:["description"],keyFeatureItem:["content"],mediaAccordionItem:["description","fullBleedDescription"],tableColumn:["column"],decal:["column1","column2"],mediaCaptionBlock:["column1","column2","column3"]}}}),Class(function Container(){Inherit(this,Element);const _this=this,$this=this.element;var _app;AppState.set("Global/playground",!1),_app=_this.initClass(App),function initHTML(){Stage.add($this),$this.css({position:"relative",zIndex:1})}(),async function loadView(){let loader=_this.initClass(AssetLoader,Assets.list().filter(_app.loaderData.assets.split(",").map(f=>f.trim()))),promises=(_this.initClass(window[_app.loaderData.fragment],{loader:loader},[Stage]),[CMS.ready(),_this.wait("Global/siteSettings")]);_app.firebaseData&&promises.push(Firebase.boot(_app.firebaseData,loader)),loader.add(1),await Promise.all([...promises,Initializer3D.createWorld(),TheatreJSLoader.load()]),loader.trigger(1),AppState.set("Global/loadComplete",!0),function initView(){World.instance(),$this.add(World.ELEMENT);let entryPoint=_app.entryPointData;entryPoint=entryPoint?.startsWith("$")?window[_app[entryPoint.slice(1)]()]:window[entryPoint],_this.initClass(entryPoint)}()}()},"singleton"),Class(function Playground(){Inherit(this,Component);const _this=this;let _view,_isRT,_mesh;function initGLUIView(element){GLUI.Stage.add(element)}function handleInstanceReloaded({oldInstance:oldInstance,newInstance:newInstance}){if(oldInstance===_view){if(_view=newInstance,Dev.expose("view",_view),_isRT)_mesh.shader.set("tMap",_view);else{let group=_view.group||_view.mesh||_view.object3D;group&&World.SCENE.add(group)}_view.animateIn?.()}}!async function(){Global.PLAYGROUND=Utils.query("p"),await GPU.ready(),await UILStorage.ready(),await async function bootFirebase(){let app=_this.initClass(App);app.firebaseData&&await Firebase.boot(app.firebaseData)}(),await TheatreJSLoader.load(),AppState.set("Global/loadComplete",!0),AppState.set("Global/playground",Global.PLAYGROUND),function initThree(){World.instance(),Stage.add(World.ELEMENT),function initDoubleClick(){_this.lastClick=performance.now();const speed=180;Stage.bind("click",function(){performance.now()-_this.lastClick<speed&&function onDoubleClick(){let camera=_isRT?_view.nuke.camera:World.NUKE.camera,scene=_isRT?_view.scene:World.SCENE,raycaster=Raycaster.find(camera),objs=[];scene.traverse(obj=>{objs.push(obj)});let intersects=raycaster.checkHit(objs,Mouse),found=!1;intersects.forEach(element=>{if(found)return;const uilGraph=element?.object?.uilGraph;uilGraph&&(found=!0,uilGraph?.find?.(element?.object?.uilName)?.focus?.())})}(),_this.lastClick=performance.now()})}()}(),function initView(){let request=Global.PLAYGROUND.split("/")[0],view=window[`Playground${request}`]||window[request]||null;if(!view)throw`No Playground class ${request} found.`;_view=view.instance?view.instance():_this.initClass(view),_view.element?_view.element.mesh?initGLUIView(_view.element):(Stage.add(_view.element),_view.animateIn?.()):_view.root&&_view.$gluiObject&&function initUI3DView(ui3d){Device.mobile?initGLUIView(ui3d.root):(GLUI.Scene.add(ui3d.$gluiObject),function addUIToWorldScene(uiGroup){let group=new Group,v3=new Vector3,distance=USING_XR?1.5:2;return v3.set(0,0,-distance).applyQuaternion(World.CAMERA.quaternion),group.position.copy(World.CAMERA.position).add(v3),group.lookAt(World.CAMERA.position),group.add(uiGroup),World.SCENE.add(group),group}(ui3d.$gluiObject.anchor))}(_view);if(_view.rt&&_view.scene&&_view.nuke)if(request.includes("Figma")){let dimensions=_view.dimensions,$obj=$gl(dimensions[0],dimensions[1],_view.rt.texture);$obj.x=40,$obj.y=40,"portrait"===Utils.query("orientation")&&($obj.scale=.5,$obj.y=-300),GLUI.Stage.add($obj)}else{let shader=_this.initClass(Shader,"ScreenQuad",{tMap:{value:_view}});_mesh=new Mesh(World.QUAD,shader),_mesh.frustumCulled=!1,World.SCENE.add(_mesh),_isRT=!0}else World.SCENE.add(_view.group||_view.mesh||_view.object3D||new Group);(function initCameraHelper(nuke){let orbitCamera=new PerspectiveCamera(30,nuke.stage.width/nuke.stage.height,.1,1e3);orbitCamera.position.z=6;let lastCamera,timer0,timer1,timer2,wasdCamera=orbitCamera.clone();_this.onResize(_=>{orbitCamera.aspect=wasdCamera.aspect=nuke.stage.width/nuke.stage.height,orbitCamera.updateProjectionMatrix(),wasdCamera.updateProjectionMatrix()});let orbit=new DebugControls(orbitCamera,World.ELEMENT.div),wasd=new WASDControls(wasdCamera,World.ELEMENT.div);orbit.enabled=!1,wasd.enabled=!1,_this.startRender(_=>{orbit.update(),wasd.update()}),_this.orbitControls=orbit,_this.wasdControls=wasd;const clearTimers=_=>{clearTimeout(timer0),clearTimeout(timer1),clearTimeout(timer2)},goToMain=_=>{orbit.enabled=!1,wasd.enabled=!1,lastCamera&&(nuke.camera=lastCamera),AppState.set("playground_camera_active",!1),clearTimers()},goToOrbit=_=>{orbit.enabled=!0,wasd.enabled=!1,nuke.camera!=wasdCamera&&nuke.camera!=orbitCamera&&(lastCamera=nuke.camera),nuke.camera=orbitCamera,AppState.set("playground_camera_active",nuke.camera),_this.activeControls=orbit,clearTimers()},goToWASD=_=>{wasd.enabled=!0,orbit.enabled=!1,nuke.camera!=wasdCamera&&nuke.camera!=orbitCamera&&(lastCamera=nuke.camera),nuke.camera=wasdCamera,AppState.set("playground_camera_active",nuke.camera),_this.activeControls=wasd,clearTimers()};Utils.query("orbit")&&(goToOrbit(),timer0=_this.delayedCall(goToOrbit,500),timer1=_this.delayedCall(goToOrbit,1e3),timer2=_this.delayedCall(goToOrbit,3e3));_this.events.sub(Keyboard.DOWN,_=>{document.activeElement.tagName.toLowerCase().includes(["textarea","input"])||(Keyboard.pressing.includes("!")&&goToMain(),Keyboard.pressing.includes("@")&&goToOrbit(),Keyboard.pressing.includes("#")&&goToWASD())})})(_view.nuke||World.NUKE),Dev.expose("view",_view)}(),_this.events.sub(Component.HMR_INSTANCE_RELOADED,handleInstanceReloaded),Events._fireResize()}()},"singleton"),Class(function World(){Inherit(this,Component);const _this=this;let _renderer,_scene,_camera,_nuke,_controls;function resize(){_renderer.setSize(Stage.width,Stage.height),_camera.aspect=Stage.width/Stage.height,_camera.updateProjectionMatrix()}function loop(t,delta){_controls&&_controls.enabled&&_controls.update(),RenderManager.render()}World.DPR=Tests.getDPR(),function initWorld(){(World.PLANE=new PlaneGeometry(1,1)).keepAlive=!0,World.PLANE.destroyDataAfterUpload=!1,(World.QUAD=Utils3D.getQuad()).keepAlive=!0,World.QUAD.destroyDataAfterUpload=!1,(World.BOX=new BoxGeometry(1,1,1)).keepAlive=!0,World.BOX.destroyDataAfterUpload=!1,(World.SPHERE=new SphereGeometry(1,16,16)).keepAlive=!0,World.SPHERE.destroyDataAfterUpload=!1;let options={powerPreference:"high-performance"};Tests.enableWorldNukeMSAA()&&(options.samplesAmount=Tests.msaaSamples()||void 0,options.multisample=!!options.samplesAmount),RenderManager.initialize(RenderManager.NORMAL,options),_renderer=RenderManager.gl,_scene=RenderManager.scene,_camera=RenderManager.camera.worldCamera,_nuke=RenderManager.nuke,World.SCENE=_scene,World.RENDERER=_renderer,World.ELEMENT=$(_renderer.domElement),World.CAMERA=_camera,World.NUKE=_nuke,World.ELEMENT.css({position:"absolute",top:0,left:0}),Tests.renderFXAA()&&_nuke.add(new FXAA)}(),RenderManager.type==RenderManager.NORMAL&&(Camera.instance(_camera),Render.capFPS=Tests.capFPS()),function initControls(){if(!window.DebugControls||!Utils.query("orbit")){const camera=new BaseCamera;return camera.group.position.set(0,0,6),void camera.lock()}const Controls=Utils.query("wasd")?WASDControls:DebugControls;_controls=new Controls(_camera,World.ELEMENT.div),RenderManager.type===RenderManager.NORMAL?_controls.target=new Vector3(0,0,0):_controls.enabled=!1,World.CONTROLS=_controls,World.CAMERA.position.z=6}(),function addHandlers(){_this.events.sub(Events.RESIZE,resize)}(),Utils.query("uilOnly")||Render.onDrawFrame(loop)},function(){var _instance;World.instance=function(){return _instance||(_instance=new World),_instance}}),Class(function AccordionSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="AccordionSlice",_this.contexts="ViewStateElement,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{className:"accordion",_type:"UI",refName:"unnamed",children:[{className:"accordion__container",_type:"div",refName:"unnamed",children:[{className:"accordion__title",_type:"h1",_innerText:"$data.title",refName:"title",children:[]},{_type:"div",refName:"border",children:[]},{view:"AccordionSliceItem",data:"$data.items",_type:"ViewState",refName:"items",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.title.hide(),_this.bind(_this.data,"backgroundColor",function handleBackgroundColor(backgroundColor){if(!backgroundColor)return;_this.element.css({backgroundColor:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)}),_this.element.div.style.setProperty("--background-color",SanityUtils.stegaClean(backgroundColor.contrastColor)),_this.element.div.style.setProperty("--text-color",SanityUtils.stegaClean(backgroundColor.hex)),_this.data.items=_this.data.items.map(item=>({...item,backgroundColor:SanityUtils.stegaClean(backgroundColor.hex),contrastColor:SanityUtils.stegaClean(backgroundColor.contrastColor)}))}),_this.bind(_this.data,"title",function handleTitle(title){title?(_this.title.show(),_this.title.text(title)):_this.title.hide()}),_this.onMounted=()=>{_this.border.transform({scaleX:0})},_this.onInView=()=>{_this.border.tween({scaleX:1},1500,"easeOutExpo")},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"AccordionSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function AccordionSliceItem(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element,"button"),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="AccordionSliceItem",_this.contexts="ViewStateElement,Element, 'button',InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{className:"accordion-item",_type:"UI",refName:"unnamed",children:[{className:"accordion-item__container",_type:"div",refName:"unnamed",children:[{className:"accordion-item__top",_type:"div",refName:"top",children:[{className:"accordion-item__button-container",_type:"div",refName:"unnamed",children:[{id:"plus",_type:"Sprite",refName:"sprite",children:[]}]},{className:"accordion-item__title",_type:"h2",_innerText:"$data.title",refName:"title",children:[]},{class:"accordion-item__logo",imageWithMeta:"$data.displayFirstLogo",_type:"ResponsiveImage",refName:"logo",children:[]}]},{className:"accordion-item__content",_type:"div",refName:"content",children:[{className:"accordion-item__content-container",_type:"div",refName:"unnamed",children:[{class:"accordion-item__description",content:"$data.description",_type:"RichText",refName:"description",children:[]}]},{className:"accordion-item__images-container",_type:"div",refName:"images",children:[{view:"AccordionSliceItemImages",data:"$data.images",_type:"ViewState",refName:"accordionImages",children:[]}]}]}]},{className:"accordion-item__background",_type:"div",refName:"background",children:[]},{_type:"div",refName:"border",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit,closedHeight=0,height=0,tweenObj={filterProgress:0};function resize(){closedHeight=_this.top.div.getBoundingClientRect().height,height=_this.content.div.scrollHeight,_this.state.isMobile=Stage.width<769,_this.state.isOpen?_this.element.tween({height:closedHeight+height},500,"easeOutSine"):_this.element.tween({height:closedHeight},500,"easeOutSine")}function onEnter(){_this.state.isHovered=!0}function onLeave(e){_this.state.isHovered=!1}_this.onMounted=()=>{_this.element.attr("role","accordion"),_this.state.isHovered=!1,_this.state.isOpen=!1,_this.state.showBackground=!1,_this.state.isMobile=Stage.width<769,_this.element.div.setAttribute("aria-expanded","false"),_this.content.css({height:0,overflow:"visible"}),closedHeight=_this.top.div.getBoundingClientRect().height,_this.element.css({height:closedHeight}),_this.element.click(_this.onClick),_this.element.bind("mouseenter",onEnter),_this.element.bind("mouseleave",onLeave),_this.onResize(resize),_this.border.transform({scaleX:0}),_this.top.transform({x:"-10%"}).css({opacity:0})},_this.onClick=async function(){_this.state.isOpen=!_this.state.isOpen,_this.element.div.setAttribute("aria-expanded",_this.state.isOpen?"true":"false"),await defer(),_this.state.isOpen?(_this.content.css({height:_this.content.div.scrollHeight}),await defer(),height=_this.content.div.scrollHeight,_this.content.tween({height:height},500,"easeOutSine"),_this.element.tween({height:closedHeight+height},500,"easeOutSine"),_this.sprite.id="minus"):(Device.mobile.phone&&_this.content.css({paddingTop:0}),_this.content.tween({height:0},500,"easeOutSine"),_this.element.tween({height:closedHeight},500,"easeOutSine"),_this.sprite.id="plus"),_this.fire("AccordionItem/toggle",{id:_this.data.id,isOpen:_this.state.isOpen})},_this.bind(_this.state,"isHovered",isHovered=>{isHovered&&!1===_this.state.isOpen?_this.state.showBackground=!0:_this.state.showBackground=!1}),_this.bind(_this.state,"isOpen",isOpen=>{isOpen?(_this.state.showBackground=!1,_this.logo.element.css({opacity:0}),_this.wait(_=>_this.accordionImages&&_this.accordionImages.views.length>0).then(()=>{_this.accordionImages.views.map((view,index)=>{view.element.visible?.().tween({opacity:1},250,"easeOutSine",50*index)})})):(_this.state.showBackground=!0,_this.logo.element.css({opacity:1}),_this.wait(_=>_this.accordionImages&&_this.accordionImages.views.length>0).then(()=>{_this.accordionImages.views.map((view,index)=>{0===index&&_this.data.displayFirstLogo||view.element.tween({opacity:0},100,"easeOutSine").onComplete(()=>{view.element.invisibile?.()})})}))}),_this.bind(_this.state,"showBackground",showBackground=>{_this.state.isMobile||(showBackground?(_this.background.css({background:"var(--background-color)"}),_this.background.tween({scaleY:1},300,"easeOutSine"),tween(tweenObj,{filterProgress:1},300,"easeOutSine").onUpdate(()=>{_this.element.div.style.setProperty("--filterProgress",tweenObj.filterProgress)}),_this.top.css({color:"var(--text-color)"})):(_this.background.tween({scaleY:0},300,"easeOutSine"),tween(tweenObj,{filterProgress:0},300,"easeOutSine").onUpdate(()=>{_this.element.div.style.setProperty("--filterProgress",tweenObj.filterProgress)}),_this.top.css({color:"inherit"})))}),_this.onInView=()=>{!function animateIn(){_this.border.tween({scaleX:1},1500,"easeOutExpo"),_this.top.tween({x:"0%",opacity:1},1500,"easeOutExpo")}()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"AccordionSliceItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function AccordionSliceItemImages(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="AccordionSliceItemImages",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{className:"accordion-item-images",_type:"UI",refName:"unnamed",children:[{imageWithMeta:"$data",sizes:"(min-width: 769px) 10vw, 50vw",_type:"ResponsiveImage",refName:"previewImage",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"AccordionSliceItemImages"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ActionButton(_params,...restArgs){const _this=this;Inherit(_this,Element,"a"),Inherit(_this,BindUtils),Inherit(_this,XComponent),_this.fragName="ActionButton",_this.contexts="Element, 'a',BindUtils",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"p",refName:"text",children:[]},{"aria-hidden":!0,tabIndex:-1,_type:"div",refName:"iconWrapper",children:[{id:"top-right-arrow",_type:"Sprite",refName:"icon",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function updateText(text){text&&_this.text.text(text)}function handleType(type,previousType){previousType&&_this.element.classList().remove(previousType),type&&_this.element.classList().add(type),"secondary"===type?_this.iconWrapper.hide():_this.iconWrapper.show()}_this.bindToNestedParams("actionButton",bind=>{bind("buttonText",updateText),bind("type",handleType)}),_this.element.click(function handleClick(){if("openForm"===_this.params.actionButton.actionType)_this.fire("openForm",{formId:_this.params.actionButton.formId.current})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ActionButton"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function AlgoliaPagination(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="AlgoliaPagination",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{click:function handlePrev(){if(0===_this.state.page)return;_this.state.page=_this.state.page-1,_this.fire("pageChange")},"aria-label":"Previous page",role:"button",_type:"button",refName:"prev",children:[{id:"left-arrow",_type:"Sprite",refName:"unnamed",children:[]}]},{_type:"div",refName:"pages",children:[]},{click:function handleNext(){if(_this.state.page===_this.state.totalPage-1)return;_this.state.page=_this.state.page+1,_this.fire("pageChange")},"aria-label":"Next page",role:"button",_type:"button",refName:"next",children:[{id:"arrow-right",_type:"Sprite",refName:"unnamed",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function setupPagination(){let startIndex,pageList=[];if(_this.params.totalPages<=1)_this.element.hide();else{_this.element.show(),startIndex=_this.params.currentPage>_this.params.totalPages-3?_this.params.totalPages-3:_this.params.currentPage-1,startIndex<0&&(startIndex=0);for(let i=0;i<3&&!(i+1+startIndex>_this.params.totalPages);i++)pageList.push(i+1+startIndex);_this.params.totalPages>3&&(_this.params.currentPage<=_this.params.totalPages-3&&(_this.params.totalPages-pageList[pageList.length-1]>1&&pageList.push("..."),pageList.push(_this.params.totalPages)),pageList[0]>2&&(pageList.unshift("..."),pageList.unshift(1)),2===pageList[0]&&pageList.unshift(1)),_this.pages.empty(),pageList.forEach((page,index)=>{if("number"==typeof page){let pageButton=_this.pages.create("pageButton","button");pageButton.attr("aria-label",`Page ${page}`),pageButton.text(page),page===_this.params.currentPage+1&&(pageButton.attr("aria-current","page"),pageButton.classList().add("active")),pageButton.click(e=>{_this.state.page=page-1,_this.fire("pageChange")})}else if("..."===page){_this.pages.create("ellipsis","span").text(page)}else console.error(`Unknown page type ${page}`)})}}function debouncedSetupPagination(){return Utils.debounce(setupPagination)}_this.params.currentPage=_this.params.currentPage||0,_this.params.totalPages=_this.params.totalPages||0,_this.state.page=_this.params.currentPage,_this.onMounted=async()=>{await _this.wait("pages"),_this.bind(_this.params,"currentPage",debouncedSetupPagination),_this.bind(_this.params,"totalPages",debouncedSetupPagination),_this.bind(_this.params,"currentPage",currentpage=>{_this.prev.classList().toggle("disabled",0===currentpage),_this.prev.attr("aria-disabled",0===currentpage),_this.next.classList().toggle("disabled",currentpage===_this.params.totalPages-1),_this.next.attr("aria-disabled",currentpage===_this.params.totalPages-1)})},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"AlgoliaPagination"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function AnimatedCharts(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,BindUtils),Inherit(_this,XComponent),_this.fragName="AnimatedCharts",_this.contexts="Element,BindUtils",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function updateChartType(chartType){switch(chartType){case"fighter-jet-trend":_this.chart=_this.createFragment(FighterJetTrend);break;case"industry-trend":_this.chart=_this.createFragment(IndustryTrend);break;case"defense-industry-market":_this.chart=_this.createFragment(DefenseIndustryMarket);break;case"rebuild-china-ship":_this.chart=_this.createFragment(RebuildChinaShip);break;case"drag-branch-chart":_this.chart=_this.createFragment(DragBranchChart)}}_this.bindToNestedParams("animatedCharts",bind=>{bind("chartType",updateChartType)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"AnimatedCharts"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function AnimatedImage(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,BindUtils),Inherit(_this,XComponent),_this.fragName="AnimatedImage",_this.contexts="Element,BindUtils",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function updateImageType(){if(_this.image&&_this.image.destroy(),"hello-war"===_this.params.animatedImage.imageType)_this.image=_this.createFragment(HelloWar,AppState.createLocal({image:_this.params.animatedImage.image}))}_this.bindToNestedParams("animatedImage",bind=>{bind("imageType",updateImageType),bind("image",updateImageType)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"AnimatedImage"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function AnimationSwitch(_params,...restArgs){const _this=this;Inherit(_this,Element,"button"),Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="AnimationSwitch",_this.contexts="Element, 'button',Component",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"span",_innerText:"Animations",refName:"title",children:[]},{_type:"div",refName:"switch",children:[{_type:"span",_innerText:"Off",refName:"off",children:[]},{_type:"span",_innerText:"On",refName:"on",children:[]},{_type:"div",refName:"background",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function handleBackgroundResize(animationEnabled){let width=animationEnabled?_this.on.div.offsetWidth:_this.off.div.offsetWidth;_this.background.css({width:`${width}px`,left:`${animationEnabled?_this.off.div.offsetWidth+4:0}px`}),animationEnabled?(_this.on.classList().add("active"),_this.off.classList().remove("active")):(_this.on.classList().remove("active"),_this.off.classList().add("active"))}_this.element.bind("click",function toggleAnimation(){_this.set("animationEnabled",!_this.get("animationEnabled"))}),_this.bind("animationEnabled",handleBackgroundResize),_this.onMounted=()=>{if(async function initBackground(){await _this.wait("off"),_this.off.onResize(e=>{0!==e.borderBoxSize[0].inlineSize&&handleBackgroundResize(_this.getSync("animationEnabled"))})}(),_this.element.attr("tabindex","10"),_this.element.attr("role","switch"),_this.switch.attr("aria-label","Toggle animations on and off"),localStorage.getItem("animationEnabled"))_this.set("animationEnabled","true"===localStorage.getItem("animationEnabled"));else{const animationPreference=window.matchMedia("(prefers-reduced-motion: reduce)").matches;_this.set("animationEnabled",!animationPreference)}},_this.bind("animationEnabled",animationEnabled=>{_this.element.attr("aria-checked",animationEnabled),localStorage.setItem("animationEnabled",animationEnabled)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"AnimationSwitch"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function AnnouncementList(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView),Inherit(_this,XComponent),_this.fragName="AnnouncementList",_this.contexts="ViewStateElement,Element,InView",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"topWrapper",children:[{_type:"h2",_innerText:"$data.header",refName:"header",children:[]},{class:"headerText",content:"$data.headerText",_type:"RichText",refName:"headerText",children:[]}]},{_type:"div",refName:"divider",children:[]},{_type:"div",refName:"bottomWrapper",children:[{_type:"h6",_innerText:"$data.subhead",refName:"subhead",children:[]},{class:"subheadText",content:"$data.subheadText",_type:"RichText",refName:"subheadText",children:[]},{_type:"ul",refName:"list",children:[{view:"AnnouncementListItem",data:"$state.list",_type:"ViewState",refName:"vs",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.list=new StateArray,_this.onMounted=()=>{_this.header.transform({x:"-20%"}).css({opacity:0}),_this.headerText.element.transform({x:"-20%"}).css({opacity:0}),_this.divider.transform({scaleX:0}).css({transformOrigin:"left center"}),_this.subhead.transform({x:"-20%"}).css({opacity:0}),_this.subheadText.element.transform({x:"-20%"}).css({opacity:0}),_this.list.transform({y:"-10%"}).css({opacity:0})},_this.bind(_this.data,"colorPair",colorPair=>{colorPair&&_this.element.css({backgroundColor:SanityUtils.stegaClean(colorPair.background.hex),color:SanityUtils.stegaClean(colorPair.foreground.hex)})}),_this.bind(_this.data,"list",list=>{_this.state.list.refresh(list.map(item=>({item:item})))}),_this.onInView=()=>{!function animateIn(){const baseDelay=90;_this.header.tween({x:"0%",opacity:1},800,"easeOutExpo",0),_this.headerText.element.tween({x:"0%",opacity:1},800,"easeOutExpo",baseDelay),_this.divider.tween({scaleX:1},800,"easeOutExpo",2*baseDelay),_this.subhead.tween({x:"0%",opacity:1},800,"easeOutExpo",3*baseDelay),_this.subheadText.element.tween({x:"0%",opacity:1},800,"easeOutExpo",4*baseDelay),_this.list.tween({y:"0%",opacity:1},800,"easeOutExpo",5*baseDelay),_this.vs.views.forEach((view,index)=>{view.animateIn()})}()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"AnnouncementList"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function AnnouncementListItem(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="AnnouncementListItem",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"li",refName:"item",children:[{_type:"p",_innerText:"$state.index",refName:"unnamed",children:[]},{_type:"h7",refName:"title",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.index=(_this.index+1).toString().padStart(2,"0"),_this.bind(_this.data,"item",item=>{item&&_this.title.text(item?.text)}),_this.onMounted=()=>{_this.item.transform({y:"20%"}).css({opacity:0})},_this.animateIn=()=>{_this.item.tween({y:"0%",opacity:1},600,"easeOutExpo",120*_this.index+400)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"AnnouncementListItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function AnnouncementSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView),Inherit(_this,XComponent),_this.fragName="AnnouncementSlice",_this.contexts="ViewStateElement,Element,InView",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"topWrapper",children:[{_type:"h5",_innerText:"$data.title",refName:"title",children:[]},{data:"$data.cta",_type:"CtaButton",refName:"cta",children:[]}]},{_type:"div",refName:"imageWrapper",children:[{imageWithMeta:"$data.image",sizes:"(min-width: 769px) 100vw, 100vw",_type:"ResponsiveImage",refName:"image",children:[]}]},{_type:"div",refName:"bottomWrapper",children:[{class:"col1",content:"$data.col1",_type:"RichText",refName:"col1",children:[]},{class:"col2",content:"$data.col2",_type:"RichText",refName:"col2",children:[]},{class:"col3",content:"$data.col3",_type:"RichText",refName:"col3",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onMounted=()=>{[_this.topWrapper,_this.imageWrapper,_this.col1.element,_this.col2.element,_this.col3.element].forEach(element=>{element.transform({x:"-10%"}).css({opacity:0})})},_this.bind(_this.data,"backgroundColor",backgroundColor=>{backgroundColor&&_this.element.css({backgroundColor:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)})}),_this.onInView=()=>{!function animateIn(){[_this.topWrapper,_this.imageWrapper,_this.col1.element,_this.col2.element,_this.col3.element].forEach((element,index)=>{element.tween({x:"0%",opacity:1},1e3,"easeOutExpo",100*index).promise()})}()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"AnnouncementSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function App(){const _this=this;Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="App",_this.contexts="Component",this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_this.loaderData={fragment:"LoaderView",assets:"shaders, lenis.min"},_this.entryPointData="ViewController",_promises=null,_this.flag?.("__ready",!0),onInit||"App"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function BindUtils(_params,...restArgs){const _this=this;Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="BindUtils",_this.contexts="Component",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bindToNestedParams=(key,callback)=>{let binds=[];_this.params.isAppState||(_this.params=AppState.createLocal(_this.params)),_this.bind(_this.params,key,data=>{binds.forEach(bind=>bind.destroy()),binds=[],callback(function bind(nestedKey,onChange){data&&(data.isAppState?binds.push(_this.bind(data,nestedKey,onChange)):onChange(data[nestedKey]))})})},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"BindUtils"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function BookHeader(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="BookHeader",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"BookHeaderDesktop",refName:"unnamed",children:[]},{_type:"BookHeaderMobile",refName:"unnamed",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onInit=async _=>{await defer(),Stage.add(_this.element,Container.instance().element)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"BookHeader"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function BookHeaderDesktop(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="BookHeaderDesktop",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"left",children:[{"aria-label":"Menu button",role:"button",autoFocus:!0,_type:"button",refName:"menuButton",children:[{_type:"div",refName:"bar1",children:[]},{_type:"div",refName:"bar2",children:[]}]}]},{_type:"div",refName:"menu",children:[{_type:"div",refName:"top",children:[{_type:"p",_innerText:"Mission Doc.",refName:"label",children:[]},{_type:"h6",refName:"title",children:[]}]},{_type:"div",refName:"scrollContainer",children:[{_type:"div",refName:"content",children:[{_type:"ul",refName:"mid",children:[{view:"BookHeaderLink",data:"$state.links",_type:"ViewState",refName:"vsLink",children:[]}]},{_type:"div",refName:"bottom",children:[{_type:"div",refName:"collectionContainer",children:[{view:"BookHeaderSmallLink",data:"$state.collection",_type:"ViewState",refName:"vs",children:[]}]},{_type:"AnimationSwitch",refName:"unnamed",children:[]}]}]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.links=new StateArray,_this.state.collection=new StateArray,_this.state.openMenu=!1;let sliceContainer,menuButtonBounds,currentBookTitle,darkModeSlices=["rebuildHeaderSlice","chapterHeaderOne","chapterHeaderTwo","chapterHeaderThree","nextLinkSlice"];async function initMenuButtons(){await _this.wait("menuButton"),sliceContainer=document.querySelector("main"),menuButtonBounds=_this.menuButton.div.getBoundingClientRect()}function handleOutsideClick(event){if(!_this.state.openMenu)return;const isClickOnMenu=_this.menu.div.contains(event.target),isClickOnMenuButton=_this.menuButton.div.contains(event.target);isClickOnMenu||isClickOnMenuButton||(_this.state.openMenu=!1)}_this.bind(_this.state,"overlapSlices",overlapSlices=>{_this.menuButton.classList().toggle("dark",overlapSlices.length>0)}),_this.menuButton.bind("click",_=>{_this.state.openMenu=!_this.state.openMenu,_this.menuButton.attr("aria-expanded",_this.state.openMenu?"true":"false")}),_this.bind(_this.state,"openMenu",openMenu=>{openMenu?(_this.menu.show(),_this.menu.transform({x:"-120%"}),_this.menu.tween({x:0},1e3,"easeInOutCubic"),_this.menuButton.classList().add("open"),Global.lenis.stop()):(_this.menu.transform({x:0}),_this.menu.tween({x:"-120%"},1e3,"easeInOutCubic").onComplete(()=>{_this.menu.hide()}),_this.menuButton.classList().remove("open"),Global.lenis.start())}),_this.bind("ViewController/transitioning",transitioning=>{transitioning||(bookCollection=_this.getSync("CMS/bookCollection"),hashLinks=_this.getSync("ViewController/subsectionLinks"),bookTitle=_this.getSync("CMS/bookTitle"),bookTitle===currentBookTitle&&bookCollection||(currentBookTitle=bookTitle,function setupNav(bookCollection,hashLinks,bookTitle){if(function setupLinks(bookCollection,hashLinks){let links=[],collection=[];hashLinks.forEach((link,index)=>{links.push({link:link,title:link.text,index:index,totalSize:hashLinks.length})}),bookCollection.forEach((item,index)=>{collection.push({link:item,text:item.text,_type:"internalLink"})}),collection.push({link:{href:"mailto:contact@anduril.com",_type:"externalLink"},text:"Contact"}),_this.state.links.refresh(links),_this.state.collection.refresh(collection)}(bookCollection,hashLinks),bookTitle)switch(_this.title.text(bookTitle),bookTitle){case"Rebooting the Aresenal":_this.menuButton.css({outlineColor:"#000000"});break;case"Rebuild the Aresenal":_this.menuButton.css({outlineColor:"#FFFFFF"})}}(bookCollection,hashLinks,bookTitle)))}),_this.listen("BookHeaderLink/click",path=>{_this.state.openMenu=!1}),_this.listen("BookHeaderSmallLink/click",_=>{_this.state.openMenu=!1}),_this.listen("ViewController/transitionComplete",()=>{initMenuButtons()}),_this.onMounted=()=>{!function setInitialState(){_this.menu.hide(),_this.menu.transform({x:"-120%"})}(),function setAttributes(){_this.menuButton.attr("tabIndex","10"),_this.menuButton.attr("aria-expanded","false"),_this.menuButton.div.focus()}(),async function initClipPathValue(){await _this.wait("menu"),_this.menu.transform({x:"-120%"}),_this.menu.onResize(_=>{_this.element.div.style.setProperty("--clip-path-width",_this.menu.div.offsetWidth-60+"px"),_this.element.div.style.setProperty("--clip-path-height","60px")})}(),initMenuButtons(),function initMenuLenis(){const lenisOptions={wrapper:_this.scrollContainer.div,content:_this.content.div,duration:.8,easing:TweenManager.Interpolation.Quart.Out,direction:"vertical",gestureDirection:"vertical",smooth:!0,smoothTouch:!1,touchMultiplier:2,lerp:!1};_this.state.menuLenis=new Lenis(lenisOptions),_this.startRender(_=>{_this.state.menuLenis&&_this.state.menuLenis.raf(_)})}(),Stage.bind("click",handleOutsideClick)},_this.onDestroy=()=>{Stage.unbind("click",handleOutsideClick)},_this.startRender(function loop(){if(!sliceContainer)return;if(!menuButtonBounds)return;let overlapSlices=[];[...sliceContainer.children].forEach(child=>{let childBounds=child.getBoundingClientRect();childBounds.y<menuButtonBounds.bottom&&childBounds.bottom>menuButtonBounds.y&&darkModeSlices.includes(child.dataset.sliceType)&&overlapSlices.push(child)}),_this.state.overlapSlices=overlapSlices}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"BookHeaderDesktop"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function BookHeaderLink(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Link),Inherit(_this,XComponent),_this.fragName="BookHeaderLink",_this.contexts="ViewStateElement,Link",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"span",refName:"index",children:[]},{_type:"span",refName:"title",children:[]},{_type:"div",refName:"iconContainer",children:[{id:"arrow-right",_type:"Sprite",refName:"right",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onMounted=()=>{_this.element.attr("tabIndex","10"),_this.element.attr("role","menuitem")},_this.bind("Global/chapterIndex",chapterIndex=>{chapterIndex===_this.data.index?(_this.element.classList().add("active"),_this.element.attr("aria-current","location"),_this.element.attr("aria-selected",!0)):(_this.element.classList().remove("active"),_this.element.div.removeAttribute("aria-current"),_this.element.div.removeAttribute("aria-selected"))}),_this.bind(_this.data,"index",index=>{void 0!==index&&(_this.state.index=index,_this.index.text(`[PT-0${index}]`),_this.element.attr("aria-label",`Section ${index}: ${_this.data.title}, (${index+1} of ${_this.data.totalSize})`),_this.element.attr("aria-posinset",`${index+1}`),_this.element.attr("aria-setsize",`${_this.data.totalSize}`))}),_this.bind(_this.data,"title",title=>{title&&(_this.title.text(title),_this.element.attr("aria-label",`Section ${_this.data.index}: ${title}, (${_this.data.index+1} of ${_this.data.totalSize})`))}),_this.bind(_this.data,"link",link=>{link&&_this.setupLink(link,!1)}),_this.element.bind("click",_=>{_this.fire("BookHeaderLink/click",_this.data.link.path)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"BookHeaderLink"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function BookHeaderMobile(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="BookHeaderMobile",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"topMenu",children:[{_type:"p",refName:"topCaption",children:[]},{"aria-label":"Menu button",role:"button",autoFocus:!0,_type:"button",refName:"menuButton",children:[{_type:"div",refName:"bar1",children:[]},{_type:"div",refName:"bar2",children:[]}]}]},{_type:"div",refName:"menu",children:[{_type:"div",refName:"top",children:[{_type:"p",_innerText:"Mission Doc.",refName:"label",children:[]},{_type:"h6",refName:"title",children:[]}]},{_type:"div",refName:"scrollContainer",children:[{_type:"div",refName:"content",children:[{_type:"ul",refName:"mid",children:[{view:"BookHeaderLink",data:"$state.links",_type:"ViewState",refName:"vs",children:[]}]},{_type:"div",refName:"bottom",children:[{_type:"div",refName:"collectionContainer",children:[{view:"BookHeaderSmallLink",data:"$state.collection",_type:"ViewState",refName:"vs",children:[]}]},{_type:"AnimationSwitch",refName:"unnamed",children:[]}]}]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.isMobile=Stage.width<769,_this.state.links=new StateArray,_this.state.collection=new StateArray,_this.state.openMenu=!1,_this.set("overlapImages",[]);let sliceContainer,menuButtonBounds,images,currentBookTitle,darkModeSlices=["rebuildHeaderSlice","chapterHeaderOne","chapterHeaderTwo","chapterHeaderThree","nextLinkSlice"];async function initMenuButtons(){await _this.wait("menuButton"),sliceContainer=document.querySelector("main"),menuButtonBounds=_this.menuButton.div.getBoundingClientRect()}_this.menuButton.bind("click",_=>{_this.state.openMenu=!_this.state.openMenu,_this.menuButton.attr("aria-expanded",_this.state.openMenu?"true":"false")}),_this.bind(_this.state,"openMenu",openMenu=>{openMenu?(_this.menu.show(),_this.menu.transform({x:"100%"}),_this.menu.tween({x:0},500,"easeInOutCubic"),_this.menuButton.classList().add("open"),_this.topCaption.tween({opacity:0},500,"easeInOutCubic"),Global.lenis.stop()):(_this.menu.tween({x:"100%"},500,"easeInOutCubic").onComplete(()=>{_this.menu.hide()}),_this.menuButton.classList().remove("open"),_this.topCaption.tween({opacity:1},500,"easeInOutCubic"),Global.lenis.start())}),_this.bind(_this.state,"overlapImages",image=>{_this.menuButton.classList().toggle("img-dark",image.length>0)}),_this.bind(_this.state,"overlapSlices",overlapSlices=>{_this.menuButton.classList().toggle("dark",overlapSlices.length>0)}),_this.bind("ViewController/transitioning",transitioning=>{transitioning||(bookCollection=_this.getSync("CMS/bookCollection"),hashLinks=_this.getSync("ViewController/subsectionLinks"),bookTitle=_this.getSync("CMS/bookTitle"),bookTitle===currentBookTitle&&bookCollection||(currentBookTitle=bookTitle,function setupNav(bookCollection,hashLinks,bookTitle){if(function setupLinks(bookCollection,hashLinks){let links=[],collection=[];hashLinks.forEach((link,index)=>{links.push({link:link,title:link.text,index:index,totalSize:hashLinks.length})}),bookCollection.forEach((item,index)=>{collection.push({link:item,text:item.text,_type:"internalLink"})}),collection.push({link:{href:"mailto:contact@anduril.com",_type:"externalLink"},text:"Contact"}),_this.state.links.refresh(links),_this.state.collection.refresh(collection)}(bookCollection,hashLinks),bookTitle)switch(_this.title.text(bookTitle),bookTitle){case"Rebooting the Aresenal":_this.menuButton.css({outlineColor:"#000000"});break;case"Rebuild the Aresenal":_this.menuButton.css({outlineColor:"#FFFFFF"})}}(bookCollection,hashLinks,bookTitle)))}),_this.listen("BookHeaderLink/click",path=>{_this.state.openMenu=!1}),_this.listen("BookHeaderSmallLink/click",_=>{_this.state.openMenu=!1}),_this.listen("ViewController/transitionComplete",()=>{initMenuButtons()}),_this.onMounted=()=>{!function setInitialState(){_this.menu.hide(),_this.menu.transform({x:"100%"})}(),async function initClipPathValue(){await _this.wait("menu"),_this.menu.transform({x:"100%"}),_this.menu.onResize(_=>{_this.element.div.style.setProperty("--clip-path-width",_this.menu.div.offsetWidth-60+"px"),_this.element.div.style.setProperty("--clip-path-height","60px")})}(),initMenuButtons(),function setAttributes(){_this.menuButton.attr("tabIndex","10"),_this.menuButton.attr("aria-expanded","false"),_this.menuButton.div.focus()}(),function initMenuLenis(){const lenisOptions={wrapper:_this.scrollContainer.div,content:_this.content.div,duration:.8,easing:TweenManager.Interpolation.Quart.Out,direction:"vertical",gestureDirection:"vertical",smooth:!0,smoothTouch:!1,touchMultiplier:2,lerp:!1};_this.state.menuLenis=new Lenis(lenisOptions),_this.startRender(_=>{_this.state.menuLenis&&_this.state.menuLenis.raf(_)})}()},_this.startRender(function loop(){if(!_this.state.isMobile)return;if(!sliceContainer)return;if(!menuButtonBounds)return;sliceContainer&&(images=sliceContainer.querySelectorAll("img"));let overlapSlices=[];[...sliceContainer.children].forEach(child=>{let childBounds=child.getBoundingClientRect();childBounds.y<menuButtonBounds.bottom&&childBounds.bottom>menuButtonBounds.y&&darkModeSlices.includes(child.dataset.sliceType)&&overlapSlices.push(child)});let overlapImages=[];[...images].forEach(image=>{let imageBounds=image.getBoundingClientRect();imageBounds.y<menuButtonBounds.bottom&&imageBounds.bottom>menuButtonBounds.y&&overlapImages.push(image)}),_this.state.overlapImages=overlapImages,_this.state.overlapSlices=overlapSlices}),_this.onResize(_=>{_this.state.isMobile=Stage.width<769}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"BookHeaderMobile"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function BookHeaderSmallLink(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Link),Inherit(_this,XComponent),_this.fragName="BookHeaderSmallLink",_this.contexts="ViewStateElement,Link",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"span",refName:"title",children:[]},{id:"top-right-arrow",_type:"Sprite",refName:"icon",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onMounted=()=>{_this.element.attr("tabIndex","10"),_this.element.attr("role","link")},_this.bind(_this.data,"link",link=>{link&&_this.setupLink(link,!1)}),_this.bind(_this.data,"text",text=>{text&&(_this.title.text(text),_this.element.attr("aria-label",text))}),_this.element.bind("click",_=>{_this.fire("BookHeaderSmallLink/click")}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"BookHeaderSmallLink"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function BookPageView(_params,...restArgs){const _this=this;Inherit(_this,SlicesView,_params),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="BookPageView",_this.contexts="SlicesView, _params,Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"GridOverlay",refName:"unnamed",children:[]},{_type:"main",refName:"unnamed",children:[{view:"$determineView",data:"$params.content.slices",onAddView:function onAddView(view,index){_this.onAddView(view),slicesData.push({hydraObject:view.element,content:_this.params.content.slices[index]}),index>=_this.params.content.slices.length-1&&_this.set("PageView/slicesData",slicesData)},_type:"ViewState",refName:"slices",children:[]},{_type:"div",refName:"chapterInfoContainer",children:[{_type:"div",refName:"chapterInfo",children:[{_type:"p",refName:"chapterTitle",children:[]},{_type:"p",refName:"chapterNumber",children:[]}]}]}]},{_type:"Footer",refName:"unnamed",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;const slicesData=[];let sliceContainer,chapterInfoBounds,darkModeSlices=["rebuildHeaderSlice","rebootHeaderSlice","chapterHeaderOne","chapterHeaderTwo","chapterHeaderThree"];_this.bind("Global/chapterTitle",(chapterTitle,previousChapterTitle)=>{chapterTitle&&_this.chapterTitle.text(chapterTitle)}),_this.bind("Global/chapterIndex",chapterIndex=>{chapterIndex&&_this.chapterNumber.text(`PT.${chapterIndex}`)}),_this.bind("overlapSlices",slices=>{_this.chapterInfo.classList().toggle("hide",slices.length>0)}),_this.onMounted=()=>{!async function initChapterInfo(){await _this.wait("chapterInfo"),sliceContainer=document.querySelector("main"),chapterInfoBounds=_this.chapterInfoContainer.div.getBoundingClientRect()}()},_this.startRender(function loop(){if(!sliceContainer)return;if(!chapterInfoBounds)return;let overlapSlices=[];[...sliceContainer.children].forEach(child=>{let childBounds=child.getBoundingClientRect();childBounds.y<chapterInfoBounds.bottom&&childBounds.bottom>chapterInfoBounds.y&&darkModeSlices.includes(child.dataset.sliceType)&&overlapSlices.push(child)}),_this.set("overlapSlices",overlapSlices)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"BookPageView"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function CareerHero(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="CareerHero",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"CareerHero__container",_type:"div",refName:"unnamed",children:[{_type:"div",refName:"titleWrapper",children:[{_type:"h5",_innerText:"$data.shortTitle",refName:"shortTitle",children:[]},{_type:"h3",_innerText:"$data.title",refName:"title",children:[]}]},{_type:"div",refName:"buttonWrapper",children:[{data:"$state.headline",variant:"secondary",icon:!1,_type:"CtaButton",refName:"button",children:[]}]}]},{className:"CareerHero__background",_type:"div",refName:"unnamed",children:[]},{className:"CareerHero__media",_type:"div",refName:"unnamed",children:[{video:"$data.video",image:"$data.image",_type:"Media",refName:"unnamed",children:[]},{className:"CareerHero__media-overlay",_type:"div",refName:"unnamed",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.headline=AppState.createLocal(_this.data.headline),_this.bind(_this.data,"headline",data=>_this.state.headline.setAll(data)),_this.bind(_this.data,"colorPair",colorPair=>{colorPair&&(_this.element.div.style.setProperty("--background-color",SanityUtils.stegaClean(colorPair.background.hex)),_this.element.div.style.setProperty("--contrast-color",SanityUtils.stegaClean(colorPair.foreground.hex)),_this.buttonWrapper.classList().toggle("light","#010101"===SanityUtils.stegaClean(colorPair.background.contrastColor)))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"CareerHero"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function CarouselLink(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Link),Inherit(_this,XComponent),_this.fragName="CarouselLink",_this.contexts="ViewStateElement,Link",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"image",children:[{sizes:"(min-width: 769px) 36vw, 100vw",_type:"ResponsiveImage",refName:"thumbnail",children:[]}]},{_type:"div",refName:"content",children:[{_type:"div",refName:"titleWrapper",children:[{_type:"h6",refName:"title",children:[]},{"aria-hidden":!0,_type:"h6",refName:"hiddenTitle",children:[]}]},{_type:"div",refName:"details",children:[{_type:"p",refName:"date",children:[]},{_type:"p",refName:"tag",children:[]}]}]},{_type:"div",refName:"sprite",children:[{id:"top-right-arrow",_type:"Sprite",refName:"unnamed",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.defaultImage.hide(),_this.data.link.image||(_this.thumbnail.element.hide(),_this.defaultImage.show());let bounds,newPos=new Vector2(0,0),finalPos=new Vector2(0,0);_this.bind(_this.data,"link",function handleLink(link){if(link){_this.setupLink({_type:"internalLink",reference:link},!1),_this.title.text(link.title),_this.title.show(),_this.hiddenTitle.text(link.title),_this.hiddenTitle.show();let formattedDate=new Date(link.date).toLocaleDateString("en-GB",{month:"numeric",day:"numeric",year:"numeric"});_this.date.text(formattedDate),_this.thumbnail.args[0].imageWithMeta=link.image||_this.getSync("Global/siteSettings").newsDefaultImage,link.categories&&link.categories.length>0?_this.tag.text(link.categories[0].title):_this.tag.hide()}}),_this.bind(_this.data,"index",function handleIndex(index){_this.element.attr("data-index",index)}),_this.onInit=async()=>{await _this.wait("title"),function addHandlers(){_this.listen("LinkCarouselSlider/slider_interact",({action:action})=>{"move"===action?_this.element.css("pointer-events","none"):_this.element.css("pointer-events","auto")})}()},_this.startRender(function loop(){if(!_this.sprite)return;finalPos.lerp(newPos,.1),_this.sprite.css("transform",`translate(${finalPos.x}px, ${finalPos.y}px)`)}),_this.element.bind("mousemove",e=>{bounds=_this.sprite.div.getBoundingClientRect(),newPos=new Vector2(e.offsetX-bounds.width/2,e.offsetY-bounds.height/2)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"CarouselLink"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ChapterHeaderOne(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,ScrollUtils),Inherit(_this,XComponent),_this.fragName="ChapterHeaderOne",_this.contexts="ViewStateElement,Element,ScrollUtils",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"top",children:[{_type:"div",refName:"index",children:[{_type:"h4",refName:"currentIndex",children:[]},{_type:"h4",refName:"totalIndex",children:[]}]},{_type:"p",refName:"topCaption",children:[]}]},{_type:"h2",refName:"currentSection",children:[]},{_type:"div",refName:"bottom",children:[{_type:"div",refName:"left",children:[{_type:"div",refName:"imageCaptionContainer",children:[{_type:"div",refName:"border",children:[]},{_type:"p",refName:"imageCaption",children:[]}]},{_type:"h1",refName:"title",children:[]}]},{_type:"div",refName:"right",children:[{imageWithMeta:"$data.thumbnailImage",_type:"ResponsiveImage",refName:"thumbnailImage",children:[]},{"aria-label":"Scroll down",_type:"button",refName:"button",children:[{id:"arrow-down",_type:"Sprite",refName:"icon",children:[]}]}]}]},{_type:"div",refName:"backgroundImageContainer",children:[{imageWithMeta:"$data.backgroundImage",_type:"ResponsiveImage",refName:"backgroundImage",children:[]},{imageWithMeta:"$data.thumbnailImage",_type:"ResponsiveImage",refName:"backgroundImageMobile",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;async function initClipPathValue(){await _this.wait("thumbnailImage"),_this.element.div.style.setProperty("--clip-path-width",_this.thumbnailImage.element.div.offsetWidth-60+"px"),_this.element.div.style.setProperty("--clip-path-height","60px")}_this.bind(_this.state,"scrollProgress",function handleScrollProgress(progress){if(progress===1/0)return;progress>0&&(_this.set("Global/chapterTitle",_this.data.title),_this.set("Global/chapterIndex",_this.data.currentSection))}),_this.state.mobile=Stage.width<769,_this.onResize(()=>{_this.state.mobile=Stage.width<769}),_this.data.backgroundImage||_this.backgroundImage.element.hide(),_this.data.thumbnailImage||(_this.button.show(),_this.thumbnailImage.element.hide(),_this.imageCaptionContainer.hide(),_this.left.css({"grid-column":"1 / 10"}),_this.right.css({"grid-column":"10 / 13"})),_this.onMounted=()=>{initClipPathValue()},_this.thumbnailImage.element.onResize(_=>{initClipPathValue()}),_this.bind(_this.data,"backgroundColor",backgroundColor=>{backgroundColor&&(_this.element.css({background:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)}),_this.border.css({background:SanityUtils.stegaClean(backgroundColor.contrastColor)}),_this.icon.element.css({color:SanityUtils.stegaClean(backgroundColor.contrastColor)}))}),_this.bind(_this.data,"currentSection",currentSection=>{if(currentSection){let finalString=`PT0${currentSection.toString()}/`,currentSectionString=`PT${currentSection.toString()}`;_this.currentIndex.text(finalString),_this.currentSection.text(currentSectionString)}}),_this.bind(_this.data,"totalSections",totalSections=>{totalSections&&_this.totalIndex.text(`0${totalSections}`)}),_this.bind(_this.data,"topCaption",topCaption=>{topCaption&&_this.topCaption.text(topCaption)}),_this.bind(_this.data,"imageCaption",imageCaption=>{imageCaption&&_this.imageCaption.text(imageCaption)}),_this.bind(_this.data,"thumbnailImage",thumbnailImage=>{thumbnailImage&&(_this.button.hide(),_this.thumbnailImage.element.show(),_this.backgroundImageMobile.element.hide(),_this.imageCaptionContainer.show(),_this.currentSection.css({color:"#FFFFFF"}))}),_this.bind(_this.data,"backgroundImage",backgroundImage=>{backgroundImage&&(_this.backgroundImage.element.show(),_this.top.css({color:"#DFF140"}),_this.currentSection.css({color:"#DFF140"}))}),_this.bind(_this.data,"title",title=>{title&&_this.title.text(title)}),_this.bind(_this.state,"mobile",function handleMobile(isMobile){isMobile?(_this.thumbnailImage.element.hide(),_this.backgroundImageMobile.element.show()):(_this.thumbnailImage.element.show(),_this.backgroundImageMobile.element.hide());_this.data.thumbnailImage&&isMobile?(_this.top.css({color:"#FFFFFF"}),_this.bottom.css({color:"#FFFFFF"}),_this.icon.element.css({color:"#FFFFFF"}),_this.button.show()):(_this.top.css({color:SanityUtils.stegaClean(_this.data.backgroundColor.contrastColor)}),_this.bottom.css({color:SanityUtils.stegaClean(_this.data.backgroundColor.contrastColor)}),_this.icon.element.css({color:SanityUtils.stegaClean(_this.data.backgroundColor.contrastColor)}));_this.data.thumbnailImage&&!isMobile&&_this.button.hide();_this.data.backgroundImage&&!isMobile&&(_this.top.css({color:"#DFF140"}),_this.currentSection.css({color:"#DFF140"}))}),_this.button.bind("click",()=>{Global.lenis?.scrollTo(_this.element.div.getBoundingClientRect().bottom+Global.lenis.animatedScroll,{duration:2.5,lerp:.1})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ChapterHeaderOne"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ChapterHeaderThree(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,ScrollUtils),Inherit(_this,XComponent),_this.fragName="ChapterHeaderThree",_this.contexts="ViewStateElement,Element,ScrollUtils",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"top",children:[{_type:"div",refName:"index",children:[{_type:"h4",refName:"currentIndex",children:[]},{_type:"h4",refName:"totalIndex",children:[]}]}]},{_type:"div",refName:"bottom",children:[{_type:"h2",refName:"currentSection",children:[]},{_type:"h1",refName:"title",children:[]},{"aria-label":"Scroll down",_type:"button",refName:"button",children:[{id:"arrow-down",_type:"Sprite",refName:"unnamed",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.state,"scrollProgress",function handleScrollProgress(progress){if(progress===1/0)return;progress>0&&(_this.set("Global/chapterTitle",_this.data.title),_this.set("Global/chapterIndex",_this.data.currentSection))}),_this.bind(_this.data,"backgroundColor",backgroundColor=>{backgroundColor&&_this.element.css({background:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)})}),_this.bind(_this.data,"currentSection",currentSection=>{if(currentSection){let finalString=`PT0${currentSection.toString()}/`,currentSectionString=`PT${currentSection.toString()}`;_this.currentIndex.text(finalString),_this.currentSection.text(currentSectionString)}}),_this.bind(_this.data,"totalSections",totalSections=>{totalSections&&_this.totalIndex.text(`0${totalSections}`)}),_this.bind(_this.data,"title",title=>{title&&_this.title.text(title)}),_this.button.bind("click",()=>{Global.lenis?.scrollTo(_this.element.div.getBoundingClientRect().bottom+Global.lenis.animatedScroll,{duration:2.5,lerp:.1})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ChapterHeaderThree"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ChapterHeaderTwo(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,ScrollUtils),Inherit(_this,XComponent),_this.fragName="ChapterHeaderTwo",_this.contexts="ViewStateElement,Element,ScrollUtils",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{imageWithMeta:"$data.backgroundImage",_type:"ResponsiveImage",refName:"backgroundImage",children:[]},{_type:"div",refName:"container",children:[{_type:"div",refName:"top",children:[{_type:"div",refName:"index",children:[{_type:"h4",refName:"currentIndex",children:[]},{_type:"h4",refName:"totalIndex",children:[]}]},{_type:"p",refName:"topCaption",children:[]},{_type:"h2",refName:"currentSection",children:[]}]},{_type:"div",refName:"bottom",children:[{_type:"h1",refName:"title",children:[]},{"aria-label":"Scroll down",_type:"button",refName:"button",children:[{id:"arrow-down",_type:"Sprite",refName:"unnamed",children:[]}]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.state,"scrollProgress",function handleScrollProgress(progress){if(progress===1/0)return;progress>0&&(_this.set("Global/chapterTitle",_this.data.title),_this.set("Global/chapterIndex",_this.data.currentSection))}),_this.state.elementBottom=0,_this.state.isMobile=Stage.width<769,_this.onResize(()=>{_this.state.isMobile=Stage.width<769}),_this.data.backgroundImage||_this.backgroundImage.element.hide(),_this.bind(_this.data,"backgroundImage",backgroundImage=>{backgroundImage&&(_this.backgroundImage.element.show(),_this.top.css({color:"#DFF140"}),_this.button.css({color:"#FFFFFF"}))}),_this.bind(_this.data,"backgroundColor",backgroundColor=>{backgroundColor&&(_this.element.css({background:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)}),_this.button.css({color:SanityUtils.stegaClean(backgroundColor.contrastColor)}))}),_this.bind(_this.data,"topCaption",topCaption=>{topCaption&&_this.topCaption.text(topCaption)}),_this.bind(_this.data,"currentSection",currentSection=>{if(currentSection){let finalString=`PT0${currentSection.toString()}/`,currentSectionString=`PT${currentSection.toString()}`;_this.currentIndex.text(finalString),_this.currentSection.text(currentSectionString)}}),_this.bind(_this.data,"totalSections",totalSections=>{totalSections&&_this.totalIndex.text(`0${totalSections}`)}),_this.bind(_this.data,"title",title=>{title&&_this.title.text(title)}),_this.bind(_this.state,"isMobile",function handleResize(isMobile){isMobile&&_this.index.css({color:SanityUtils.stegaClean(_this.data.backgroundColor.contrastColor)})}),_this.button.bind("click",()=>{Global.lenis?.scrollTo(_this.element.div.getBoundingClientRect().bottom+Global.lenis.animatedScroll,{duration:2.5,lerp:.1})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ChapterHeaderTwo"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function CircleButton(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="CircleButton",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{onClick:"$handleClick","aria-label":"$params.ariaLabel",role:"button",_type:"button",refName:"button",children:[{id:"$params.icon",_type:"Sprite",refName:"unnamed",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.handleClick=()=>{_this.params?.onClick?.()},_this.setDisabled=(disabled=!0)=>{_this.element.div.classList.toggle("disabled",disabled),disabled?_this.button.attr("aria-disabled","true"):_this.button.attr("aria-disabled","false")},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"CircleButton"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function CompanyDomainWrapper(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,TextAnimationHelper),Inherit(_this,InView),Inherit(_this,XComponent),_this.fragName="CompanyDomainWrapper",_this.contexts="Element,TextAnimationHelper,InView",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"column-1",_type:"div",refName:"unnamed",children:[{role:"heading","aria-level":3,className:"label",_type:"h3",refName:"cLabel",children:[]},{className:"content",_type:"div",refName:"unnamed",children:[{className:"description",_type:"div",refName:"cDescription",children:[]}]},{className:"bottom-wrapper",_type:"div",refName:"unnamed",children:[{_type:"div",refName:"unnamed",children:[{role:"heading","aria-level":3,className:"label",_type:"h3",refName:"contactTitle",children:[]},{className:"contact-email",_type:"Link",refName:"contactEmail",children:[]}]},{_type:"div",refName:"unnamed",children:[{role:"heading","aria-level":3,className:"label",_type:"h3",refName:"socialTitle",children:[]},{className:"link-container",_type:"div",refName:"unnamed",children:[{view:"HeaderSocialLink",data:"$links",_type:"ViewState",refName:"socialLinks",children:[]}]}]}]}]},{className:"column-2",_type:"div",refName:"col2",children:[{className:"center-wrapper",_type:"div",refName:"centerWrapper",children:[{view:"HeaderDomainLink",data:"$headerDomainItems",_type:"ViewState",refName:"domainItems",children:[]}]},{view:"HeaderListLinks",data:"$sections",_type:"ViewState",refName:"unnamed",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.headerDomainItems=new StateArray,_this.headerDomainItems.setFilter(item=>"menuSection"===item._type,!1),_this.sections=new StateArray,_this.links=new StateArray;let settings=await _this.get("Global/siteSettings");_this.bind(settings,"companySection",data=>{_this.sections.refresh(data.linkLists),_this.cLabel.text(data.descriptionTitle),_this.cDescription.text(data.description)}),_this.bind(settings,"menuSections",data=>{_this.headerDomainItems.refresh(data||[])}),_this.bind(settings,"contactTitle",data=>_this.contactTitle.text(data)),_this.bind(settings,"contactLink",data=>_this.contactEmail.setupLink(data)),_this.bind(settings,"socialLinksTitle",data=>_this.socialTitle.text(data)),_this.bind(settings,"socialLinks",data=>_this.links.refresh(data)),_this.onInView=()=>{_this.animateText(_this.cLabel,400,!0),_this.animateText(_this.contactTitle,400,!0),_this.animateText(_this.socialTitle,400,!0)},_this.onMounted=async()=>{!async function setWidth(){await _this.wait("domainItems"),await async function viewStateReady(vs,data){return _this.wait(_=>vs.views.length===data.length)}(_this.domainItems,_this.headerDomainItems),_this.col2.onResize(e=>{if(0===e.borderBoxSize[0].inlineSize)return;let col2Width=_this.centerWrapper.div.offsetWidth;_this.col2.css({width:`${col2Width}px`})})}()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"CompanyDomainWrapper"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ConnectedHeaderSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="ConnectedHeaderSlice",_this.contexts="ViewStateElement,TextAnimationHelper,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"SecondaryNavigationSlice",refName:"unnamed",children:[]},{className:"top-wrapper",_type:"div",refName:"topWrapper",children:[{text:"$data.shortTitle",_type:"p",refName:"shortTitle",children:[]},{text:"$data.title",_type:"h1",refName:"title",children:[]},{_type:"div",refName:"details",children:[{_type:"div",refName:"textWrapper1",children:[{content:"$data.column1",class:"col1",_type:"RichText",refName:"rich1",children:[]},{"aria-hidden":!0,content:"$data.column1",class:"col1Hidden",_type:"RichText",refName:"rich1Hidden",children:[]}]},{_type:"div",refName:"textWrapper2",children:[{content:"$data.column2",class:"col2",_type:"RichText",refName:"rich2",children:[]},{"aria-hidden":!0,content:"$data.column2",class:"col2Hidden",_type:"RichText",refName:"rich2Hidden",children:[]}]},{className:"col3","aria-label":"Scroll to next section",role:"button",_type:"button",refName:"button",children:[{id:"arrow-down",_type:"Sprite",refName:"icon1",children:[]},{id:"arrow-down",_type:"Sprite",refName:"icon2",children:[]}]}]}]},{className:"SubdomainHeaderSlice__media",_type:"div",refName:"unnamed",children:[{video:"$data.video",image:"$data.image",_type:"Media",refName:"unnamed",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;const requiresFallback=Tests.requiresFallbackGraphics();_this.scrollsInline=!0,_this.onInit=()=>{_this.rich1.element.css({opacity:0}),_this.rich2.element.css({opacity:0}),_this.shortTitle.css({opacity:0}).transform({x:"-3rem"}),_this.title.css({opacity:0}).transform({x:"-3rem"}),_this.bind("ViewController/transitioning",stage=>{stage||function animateParagraphText(){_this.rich1.element.tween({opacity:1},500,"easeOutCubic",200),_this.rich2.element.tween({opacity:1},500,"easeOutCubic",300),_this.shortTitle.tween({opacity:1,x:0},500,"easeOutCubic",100),_this.title.tween({opacity:1,x:0},500,"easeOutCubic",0),[..._this.rich1.element.children()].forEach(child=>{let hydraObject=new HydraObject(child);if(child.innerHTML.includes("<br>")){let splitLines=child.innerHTML.split("<br>");return child.innerHTML="",void splitLines.forEach(line=>{let span=_this.h("p","p");span.text(String(line)),hydraObject.add(span),_this.animateText(span,500,!0)})}hydraObject.text(child.textContent),_this.animateText(hydraObject,500,!0)}),[..._this.rich2.element.children()].forEach(child=>{let hydraObject=new HydraObject(child);if(child.innerHTML.includes("<br>")){let splitLines=child.innerHTML.split("<br>");return child.innerHTML="",void splitLines.forEach(line=>{let span=_this.h("p","p");span.text(String(line)),hydraObject.add(span),_this.animateText(span,500,!0)})}hydraObject.text(child.textContent),_this.animateText(hydraObject,500,!0)})}()})},_this.button.click(e=>{Global.lenis?.scrollTo(_this.element.div.offsetHeight,{duration:2.5,lerp:.1})}),requiresFallback||_this.bind(_this.data,"colorPair",colorPair=>{colorPair&&_this.element.css({backgroundColor:SanityUtils.stegaClean(colorPair.background.hex)})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ConnectedHeaderSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function CookieBanner(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="CookieBanner",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"content",children:[]},{_type:"div",refName:"buttons",children:[{_type:"button",_innerText:"$data.cookieAcceptText",refName:"accept",children:[]},{_type:"button",_innerText:"$data.cookieRejectText",refName:"reject",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function handleCookeState(){let currentState=Storage.get("acceptsCookies");!function setVisibilityState(state){switch(clearTimeout(_this.timer),state){case!0:case!1:_this.element.classList().remove("visible"),_this.timer=_this.delayedCall(_=>_this.element.hide(),500);break;default:_this.element.show().classList().add("visible")}}(currentState),function setFunctionalState(state){if(_this.flag("initializedAnalytics"))return;if(!0===state)!function initAnalytics(){if(_this.flag("initializedAnalytics",!0),Hydra.LOCAL&&!Utils.query("debug"))return console.warn("use the debug query to allow analytics locally");let script=document.createElement("script");function gtag(){dataLayer.push(arguments)}script.async=!0,script.src="https://www.googletagmanager.com/gtag/js?id=G-CH6GNPSEPE",document.head.appendChild(script),window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-CH6GNPSEPE")}()}(currentState)}_this.onMounted=async _=>{Utils.query("showCookieBanner")&&(Storage.set("acceptsCookies",void 0),Storage.noTracking=!1),await async function initContent(){let content=await Data.request("settings");_this.data=AppState.createLocal(content)}(),function initBindings(){_this.bind(_this.data,"cookieBannerText",text=>{text&&(_this.richText=_this.createFragment(RichText,AppState.createLocal({content:text}),[_this.content]))}),_this.bind(_this.data,"cookieAcceptText",text=>{_this.accept.html(text)}),_this.bind(_this.data,"cookieRejectText",text=>{_this.reject.html(text)})}(),function addHandlers(){_this.accept.bind("click",()=>{Storage.set("acceptsCookies",!0),Storage.noTracking=!1,handleCookeState()}),_this.reject.bind("click",()=>{Storage.set("acceptsCookies",!1),handleCookeState(),defer(_=>Storage.noTracking=!0)})}(),_this.delayedCall(handleCookeState,1e3)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"CookieBanner"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function CtaButton(_params,...restArgs){const _this=this;Inherit(_this,Link,_params,...restArgs),Inherit(_this,BindUtils),Inherit(_this,XComponent),_this.fragName="CtaButton",_this.contexts="Link, _params, ...restArgs,BindUtils",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"p",refName:"buttonText",children:[]},{_type:"div",refName:"iconWrapper",children:[{id:"top-right-arrow",_type:"Sprite",refName:"icon",children:[]}]},{_type:"SideModalView",refName:"sideModalView",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function handleText(text){text&&_this.buttonText.text(text)}function handleLink(link){link&&_this.setupLink(link,!1)}function handleType(type,previousType){previousType&&_this.element.classList().remove(previousType),type&&_this.element.classList().add(type),"secondary"===type?_this.iconWrapper.hide():_this.iconWrapper.show()}_this.element.click(function handleClick(){if("openForm"===_this.params.data.actionType)_this.fire("openForm",{formId:_this.params.data.formId.current})}),_this.bindToNestedParams("data",bind=>{"actionButton"===_this.params.data?._type&&bind("buttonText",handleText),bind("link",handleLink),bind("text",handleText),bind("type",handleType)}),_this.hide=()=>{_this.element.hide()},_this.show=()=>{_this.element.show()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"CtaButton"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function CubeScene(_params,...restArgs){const _this=this;Inherit(_this,Frag3D,_params?.sceneLayoutName||"CubeScene"),Inherit(_this,XComponent),_this.fragName="CubeScene",_this.contexts='Frag3D, _params?.sceneLayoutName || "CubeScene"',_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit,mesh=new Mesh(World.BOX,Utils3D.getTestShader());World.SCENE.add(mesh),_this.startRender(_=>{mesh.rotation.x+=.03*Render.HZ_MULTIPLIER,mesh.rotation.y+=.01*Render.HZ_MULTIPLIER,mesh.rotation.z+=.04*Render.HZ_MULTIPLIER}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"CubeScene"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function Decal(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,TextAnimationHelper),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="Decal",_this.contexts="Element,TextAnimationHelper,InView, 0.5",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"decalColumn1",children:[]},{_type:"div",refName:"decalColumn2",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.isInView=!1,_this.state.setAll(_this.params.decal),_this.bind(_this.state,"column1",function updateColumn1(column1){_this.richText1=_this.initClass(RichText,AppState.createLocal({content:column1,className:"decal-column-1"})),_this.decalColumn1.add(_this.richText1)}),_this.bind(_this.state,"column2",function updateColumn2(column2){_this.richText2=_this.initClass(RichText,AppState.createLocal({content:column2,className:"decal-column-2"})),_this.decalColumn2.add(_this.richText2)}),_this.onMounted=()=>{_this.richText1.element.css({opacity:0}),_this.richText2.element.css({opacity:0})},_this.onInView=()=>{_this.state.isInView||(_this.state.isInView=!0,_this.richText1.element.tween({opacity:1},1e3,"easeOutCubic"),_this.richText2.element.tween({opacity:1},1e3,"easeOutCubic"),[..._this.richText1.element.children()].forEach(child=>{let hydraObject=new HydraObject(child);if(child.innerHTML.includes("<br>")){let splitLines=child.innerHTML.split("<br>");return child.innerHTML="",void splitLines.forEach(line=>{let span=_this.h("p","p");span.text(String(line)),hydraObject.add(span),_this.animateText(span,500,!0)})}hydraObject.text(child.textContent),_this.animateText(hydraObject,500,!0)}),[..._this.richText2.element.children()].forEach(child=>{let hydraObject=new HydraObject(child);if(child.innerHTML.includes("<br>")){let splitLines=child.innerHTML.split("<br>");return child.innerHTML="",void splitLines.forEach(line=>{let span=_this.h("p","p");span.text(String(line)),hydraObject.add(span),_this.animateText(span,500,!0)})}hydraObject.text(child.textContent),_this.animateText(hydraObject,500,!0)}))},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"Decal"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function DefenseIndustryMarket(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="DefenseIndustryMarket",_this.contexts="Element,InView, 0.5",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let mainChart,verticalLines,lines,legends,labels,dotLine,xLabel,yLabel,onInit=_this.onInit;_this.state.scrolled=!1,_this.onInit=async()=>{await _this.element.svg("assets/images/book-charts/reboot/defense-industry.svg"),mainChart=_this.element.div.querySelector("#defense-industry"),verticalLines=mainChart.querySelector("#vertical-lines"),lines=mainChart.querySelector("#lines"),legends=mainChart.querySelector("#legends"),labels=mainChart.querySelector("#labels"),dotLine=mainChart.querySelector("#dot-line"),xLabel=mainChart.querySelector("#x-label"),yLabel=mainChart.querySelector("#y-label"),_this.flag("isReady",!0)},_this.onInView=async()=>{await _this.wait("isReady"),!_this.state.scrolled&&_this.getSync("AnimationSwitch/animationEnabled")&&(_this.state.scrolled=!0,function animateIn(){(function animateVerticalLines(){[...verticalLines.children].forEach((line,index)=>{let hydraObj=new HydraObject(line);hydraObj.css({opacity:0}),hydraObj.tween({opacity:.12},75,"easeOutQuad",20*index)})})(),function animateLines(){[...lines.children].forEach((line,index)=>{let tweenObj={dashArray:2e3,dashOffset:2e3};line.setAttribute("stroke-dasharray",tweenObj.dashArray),line.setAttribute("stroke-dashoffset",tweenObj.dashOffset),tween(tweenObj,{dashOffset:0},2500,"easeInOutSine",200+400*index).onUpdate(()=>{line.setAttribute("stroke-dashoffset",tweenObj.dashOffset)})})}(),function animateDotLine(){[...dotLine.children].forEach((line,index)=>{let dashArray=line.getAttribute("stroke-dasharray"),tweenObj={dashArray:2e3,dashOffset:2e3};dashArray||(line.setAttribute("stroke-dasharray",tweenObj.dashArray),line.setAttribute("stroke-dashoffset",tweenObj.dashOffset),tween(tweenObj,{dashOffset:0},3e3,"linear").onUpdate(()=>{line.setAttribute("stroke-dashoffset",tweenObj.dashOffset)}))})}(),function animateLegends(){[...legends.children].forEach((legend,index)=>{[...legend.children].forEach((child,childIndex)=>{if(child.getAttribute("id").includes("bar")){new HydraObject(child).css({clipPath:"polygon(0 0, 0 100%, 0% 100%, 0% 0%)"})}child.getAttribute("id").includes("text")&&[...child.children].forEach((text,textIndex)=>{new HydraObject(text).css({opacity:0})})}),_this.delayedCall(()=>{[...legend.children].forEach((child,childIndex)=>{if(child.getAttribute("id").includes("bar")){let hydraObj=new HydraObject(child);hydraObj.css({clipPath:"polygon(0 0, 0 100%, 0% 100%, 0% 0%)"}),hydraObj.tween({clipPath:"polygon(0 0, 0 100%, 100% 100%, 100% 0)"},300,"easeInQuart",50)}child.getAttribute("id").includes("text")&&[...child.children].forEach((text,textIndex)=>{let hydraObj=new HydraObject(text);hydraObj.css({opacity:0}),hydraObj.tween({opacity:1},100,"easeOutQuad",250+40*textIndex)})})},600*index)})}(),function animateXLabel(){[...xLabel.children].forEach((child,index)=>{let hydraObj=new HydraObject(child);hydraObj.css({opacity:0}),hydraObj.tween({opacity:1},50,"easeOutQuad",350*index)})}(),function animateYLabel(){[...yLabel.children].forEach((child,index)=>{let hydraObj=new HydraObject(child);hydraObj.css({opacity:0}),hydraObj.tween({opacity:1},50,"easeOutQuad",350*index)})}()}())},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"DefenseIndustryMarket"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function DesktopFilter(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="DesktopFilter",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"form",refName:"form",children:[{_type:"div",refName:"searchWrapper",children:[{type:"text",placeholder:"Search",_type:"input",refName:"search",children:[]},{id:"search",_type:"Sprite",refName:"searchIcon",children:[]}]},{_type:"ul",refName:"filters",children:[{view:"NewsListCategory",data:"$params.categories",_type:"ViewState",refName:"filterItem",children:[]},{_type:"div",refName:"activeBorder",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function handleActiveBorder(){[..._this.filters.children()].slice(1).forEach(category=>{if(_this.state.categorySlug===category.dataset.slug){let currentTabOffset=category.getBoundingClientRect().x,offsetLeft=_this.filterItem.views[0].element.div.getBoundingClientRect().x,currentTabWidth=category.getBoundingClientRect().width/_this.filters.div.getBoundingClientRect().width*100;_this.activeBorder.tween({x:""+(currentTabOffset-offsetLeft),scaleX:`${currentTabWidth}%`},1e3,"easeOutExpo").promise()}})}async function viewStateReady(vs,data){return _this.wait(_=>vs.views.length===data.length)}_this.params.categories=_this.params.categories||[],_this.parent.state.bind("categorySlug",slug=>{_this.state.categorySlug=slug}),_this.parent.state.bind("search",search=>{_this.state.search=search}),_this.form.bind("submit",e=>{e.preventDefault()}),_this.form.bind("keydown",e=>{"Enter"===e.key&&e.preventDefault()}),_this.state.categorySlug="all",_this.state.search="",_this.state.page=0,_this.search.bind("input",function handleSearch(e){_this.state.search=_this.search.val()}),_this.filters.bind("input",function handleCategory(e){let selectedValue=_this.filters.div.querySelector("input:checked")?.value;_this.state.categorySlug=selectedValue,handleActiveBorder()}),_this.bind(_this.state,"search",function updateTextInput(){_this.search.val(_this.state.search?_this.state.search:"")}),_this.bind(_this.state,"categorySlug",async function updateCategoryInput(){await defer(),await viewStateReady(_this.filterItem,_this.params.categories);let selectedCategory=_this.state.categorySlug;_this.filterItem.views.forEach(view=>{let radioButton=view.input.div;radioButton.checked=radioButton.value===selectedCategory})}),_this.onMounted=()=>{!async function handleActiveBorderInit(){await _this.wait("filterItem"),await viewStateReady(_this.filterItem,_this.params.categories),_this.filterItem.views.forEach(view=>{view.element.onResize(e=>{0!==e.borderBoxSize[0].inlineSize&&(_this.state.categorySlug="all",handleActiveBorder())})})}()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"DesktopFilter"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function Downloadable(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,BindUtils),Inherit(_this,TextAnimationHelper),Inherit(_this,XComponent),_this.fragName="Downloadable",_this.contexts="Element,BindUtils,TextAnimationHelper",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{download:!0,target:"_blank",_type:"a",refName:"downloadContainer",children:[{_type:"p",_innerText:"Download file!",refName:"downloadTitle",children:[]},{"aria-hidden":!0,tabIndex:-1,_type:"div",refName:"downloadIcon",children:[{id:"download",_type:"Sprite",refName:"icon",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function updateTitle(title){_this.downloadTitle.text(TextUtils.capitalize(title)),_this.downloadContainer.attr("aria-label",`download ${title}`),_this.downloadContainer.attr("role","link")}function updateOnClick(){_this.element.classList()[_this.state.useExternalLink?"add":"remove"]("externalLink")}function updateHref(){_this.downloadContainer.attr("href",_this.state.useExternalLink?_this.state.href:"")}function updateUseIcon(){_this.state.useIcon?_this.downloadIcon.show():_this.downloadIcon.hide()}function onClick(){}_this.onMounted=_=>{_this.downloadContainer.click(onClick),_this.element.attr("role","link"),_this.icon.element.attr("aria-hidden","true"),_this.icon.element.attr("tabindex","-1")},_this.bindToNestedParams("download",bind=>{_this.bind("title",updateTitle),_this.bind("useExternalLink",updateOnClick),_this.bind("href",updateHref),_this.bind("useIcon",updateUseIcon)}),_this.bind(_this.params,"title",updateTitle),_this.bind(_this.params,"useExternalLink",updateOnClick),_this.bind(_this.params,"href",updateHref),_this.bind(_this.params,"useIcon",updateUseIcon),_this.element.click(function downloadAsset(){_this.params.asset?ImageUtils.download(_this.params.asset?.url,_this.state.title):ImageUtils.download(_this.state.asset?.url,_this.state.title)}),_this.element.hover(e=>{}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"Downloadable"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function DragAndDrop(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="DragAndDrop",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.element.attr("draggable","true"),_this.dragEl=_this.element;let _dragId,initialized=!1;function setDragging(){_this.set("UIL/Graph/dragging",_this.dragId)}function removeDragListeners(){_this.set("UIL/Graph/dragging",!1),_this.dragEl.div.removeEventListener("mousedown",setDragging,!1),window.removeEventListener("mouseup",_this.removeDragListeners,!1),_this.dropTarget.classList?.().remove("hover"),_this.dragEl.div.removeEventListener("dragstart",_this.dragStart,!1),_this.dragEl.div.removeEventListener("dragend",_this.dragEnd,!1),_this.dropTarget.div.removeEventListener("dragenter",_this.dragEnter),_this.dropTarget.div.removeEventListener("dragleave",_this.dragLeave),_this.dropTarget.div.removeEventListener("dragover",_this.dragOver),_this.dropTarget.div.removeEventListener("drop",_this.drop),_this.dragEl?.div?.removeEventListener("mousedown",_this.addDragListeners,!1)}_this.setDragEnabled=function(val){_this.dragEl.attr("draggable",val),!1===val&&removeDragListeners()},_this.setDragElement=function(el){_this.element.div.removeEventListener("mousedown",setDragging,!1),_this.element.attr("draggable",!1),_this.dragEl=el,_this.dragEl.attr("draggable",!0)},_this.onInit=async function(){initialized||(initialized=!0,await _this.wait("dropTarget"),function addDragListeners(){if(_this.dragEl.div.addEventListener("mousedown",setDragging,!1),window.addEventListener("mouseup",_this.removeDragListeners,!1),!_this.element||!_this.dropTarget)return;_this.dragEl.div.addEventListener("dragstart",_this.dragStart,!1),_this.dragEl.div.addEventListener("dragend",_this.dragEnd,!1),_this.dropTarget.div.addEventListener("dragenter",_this.dragEnter),_this.dropTarget.div.addEventListener("dragleave",_this.dragLeave),_this.dropTarget.div.addEventListener("dragover",_this.dragOver),_this.dropTarget.div.addEventListener("drop",_this.drop)}(),_dragId=_this.data?_this.data.id:!!_this.id&&_this.id)},_this.onRemoveView=function(){removeDragListeners()},_this.bind("UIL/Graph/dragging",isDragging=>{}),_this.dragStart=function(event){event.stopPropagation(),_dragId||console.warn("No Drag Id is set on Drag and Drop. Set either _this.data.id or _this.id on the class inheriting from DragAndDrop",_this),event.dataTransfer.setData("text/plain",_dragId),event.dataTransfer.effectAllowed="move",event.dropEffect="move",_this.element.css({opacity:.4}),_this.onDragStart?.(event)},_this.dragEnd=function(event){event.stopPropagation(),_this.onDragEnd?.(event),_this.element?.css({opacity:1})},_this.dragEnter=function(event){_this.dropTarget.classList().add("hover"),_this.onDragEnter?.(event)},_this.dragLeave=function(event){_this.dropTarget.classList().remove("hover"),_this.onDragLeave?.(event)},_this.dragOver=function(event){event.preventDefault(),event.stopPropagation(),event.dataTransfer.dropEffect="move",_this.onDragOver?.(event)},_this.drop=function(event){return event.stopPropagation(),_this.dropTarget.classList().remove("hover"),_this.onDrop?.(event.dataTransfer.getData("text")),!1},_this.element.goob("\n    cursor: pointer;\n    .highlight {\n        pointer-events: none;\n    }\n"),"UILGraphGroupChildren"===Utils.getConstructorName(_this)&&_this.element.goob("\n        .highlight {\n            background: #1aeade !important;\n        }\n    "),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"DragAndDrop"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function DragBranchChart(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="DragBranchChart",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.isMobile=Stage.width<769,_this.onResize(_=>{_this.state.isMobile=Stage.width<769}),_this.bind(_this.state,"isMobile",isMobile=>{isMobile?(_this.chart&&_this.chart.destroy(),_this.chart=_this.initClass(DragBranchChartMobile)):(_this.chart&&_this.chart.destroy(),_this.chart=_this.initClass(DragBranchChartDesktop))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"DragBranchChart"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function DragBranchChartDesktop(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,ScrollUtils),Inherit(_this,XComponent),_this.fragName="DragBranchChartDesktop",_this.contexts="Element,ScrollUtils",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"yearInputs",children:[]},{_type:"div",refName:"scubbers",children:[{_type:"div",refName:"scrubContainer",children:[{_type:"div",refName:"topOverlay",children:[]},{_type:"div",refName:"dragContainer",children:[{role:"scrollbar",_type:"div",refName:"dragLineContainer",children:[{_type:"div",refName:"dragLine",children:[{id:"anchor",_type:"Sprite",refName:"unnamed",children:[]},{id:"anchor",_type:"Sprite",refName:"unnamed",children:[]}]},{_type:"p",_innerText:"1980",refName:"year",children:[]}]}]},{_type:"div",refName:"bottomOverlay",children:[{_type:"div",refName:"border",children:[]},{_type:"div",refName:"textContainer",children:[{_type:"p",_innerText:"1980",refName:"startYear",children:[]},{_type:"p",_innerText:"2001",refName:"endYear",children:[]}]}]}]}]},{"aria-label":"Consolidation of U.S. Defense Contractors (19802001): This chart illustrates the wave of mergers and acquisitions that reshaped the U.S. defense industry between 1980 and 2001. Dozens of aerospace, electronics, and defense companiessuch as McDonnell Douglas, Hughes, TRW, and Grummanwere gradually absorbed into a handful of major firms. By the early 2000s, five dominant players emerged: Lockheed Martin, Boeing, Raytheon, Northrop Grumman, and General Dynamics, reflecting the concentration of military-industrial capacity into a small number of powerful corporations.",_type:"div",refName:"base",children:[]},{"aria-label":"Between 1980 and 2001, more than 70 U.S. aerospace and defense companies were consolidated into just five major contractors. Feeding into Lockheed Martin were: GD Ft. Worth, MEL Defense Systems, Sanders Associates, Lockheed, GE Aerospace Business, Martin Marietta, Gould (Ocean Systems), GD Space Systems, Honeywell (E-Optics), Fairchild Weston Systems, Loral, Goodyear Aerospace, BDM International, Unisys, LTV (Missile Business), IBM Federal Systems, Vink Def. (Electronics), and Comsat. Feeding into Boeing were: Hughes Electronics Sat., Jappensen Sanderson, Hughes Helicopters, McDonnell Douglas, Boeing IT, Argo Systems, Litton Precision Gear, Rockwell Intl. Aerospace, and Autometric. Feeding into Raytheon were: Marine Sys Grp Allian Tec, CAE Link, Magnavox Electronics, GD (Missile Business), Radii/Simulation, Hughes Aircraft, GM (Hughes Aircraft), Corporate Jets, Raytheon, E-Systems, Chrysler Tech Airborne, and TI Defense. Feeding into Northrop Grumman were: Avondale Industries, TASC, PRC, GI Defense, Litton Industries, Varian (Solid State Elec.), Sperry Marine (Storage), Grumman, Northrop, Voight Aircraft, Westinghouse Defense, Syscon, Logicon, Geodynamics, Ryan Aeronautical, Comptek, Federal Data, Steering Software, Aerojet, Newport News Shipping, and TRW. Feeding into General Dynamics were: Princess Technologies, GTS Govt Systems, NASCO Holdings, Teledisc Vehicle Systems, Bath Iron Works, Cessna Aircraft, Chrysler Defense, General Dynamics, Cardiac Computing, Defense & Armament Sys, Advanced Tech Sys, Gulf Stream Aerospace, K-C Aviation, Galaxy Aerospace, and Motorola Info Sys Grp. By the early 2000s, this sweeping wave of mergers and acquisitions reshaped the once-crowded defense industry into todays five dominant giants: Lockheed Martin, Boeing, Raytheon, Northrop Grumman, and General Dynamics.",_type:"div",refName:"lines",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let linesChart,width,yearGap,onInit=_this.onInit;async function setSize(){await _this.wait("isReady"),width=linesChart.getBoundingClientRect().width,_this.dragContainer.css({width:width}),_this.border.css({width:width}),_this.textContainer.css({width:width}),_this.dragger.setBoundsX([0,width])}_this.bind(_this.state,"scrollProgress",function handleScrollProgress(progress){if(progress===1/0)return;progress>-.3&&!_this.state.scrolled&&(_this.state.scrolled=!0,tween(_this.draggerTarget,{x:150},1e3,"easeInOutCubic").onComplete(()=>{_this.dragger.moveToX(150)}))}),_this.yearInputs.bind("input",function handleYearInput(e){let selectedYear=_this.yearInputs.div.querySelector("input:checked");_this.state.selectedYear=selectedYear?.value,_this.state.selectedYearIndex=selectedYear?.dataset.index}),_this.element.div.style.setProperty("--progress","0%"),_this.draggerTarget={x:0,y:0},_this.startRender(function loop(){if(!linesChart)return;_this.dragLineContainer.css({transform:`translate(${Math.round(_this.draggerTarget.x)}px, ${Math.round(_this.draggerTarget.y)}px)`}),_this.state.normalizedProgress=_this.draggerTarget.x/width,_this.element.div.style.setProperty("--progress",100*_this.state.normalizedProgress+"%"),_this.state.selected=_this.yearInputs.div.contains(document.activeElement)}),_this.state.scrolled=!1,_this.onInit=async()=>{await _this.base.svg("assets/images/book-charts/reboot/drag-chart/base-chart.svg"),await _this.lines.svg("assets/images/book-charts/reboot/drag-chart/lines.svg"),linesChart=_this.lines.div.querySelector("#lines"),_this.flag("isReady",!0)},_this.onMounted=()=>{!async function setAttributes(){await _this.wait("isReady"),_this.base.attr("tabIndex","1"),_this.lines.attr("tabIndex","1")}(),setSize(),function setKeyboardControl(){yearGap=21;let yearInputs=[];for(let i=0;i<yearGap+1;i++){let input=document.createElement("input");input.type="radio",input.name="year",input.value=1980+i,input.setAttribute("aria-label",`Year ${1980+i}`),input.dataset.index=i,yearInputs.push(input),_this.yearInputs.add(input)}}()},_this.element.onResize(()=>{setSize()}),_this.bind(_this.state,"normalizedProgress",progress=>{yearGap=21;let currentYear=1980+Math.round(progress*yearGap);_this.year.text(currentYear),_this.dragLineContainer.attr("aria-label",`Current year: ${currentYear}`),_this.state.startYearVisible=!(progress<.1),_this.state.endYearVisible=!(progress>.9)}),_this.bind(_this.state,"startYearVisible",visible=>{visible?(_this.startYear.css({opacity:0}),_this.startYear.tween({opacity:1},100,"easeInOutCubic")):(_this.startYear.css({opacity:1}),_this.startYear.tween({opacity:0},100,"easeInOutCubic"))}),_this.bind(_this.state,"endYearVisible",visible=>{visible?(_this.endYear.css({opacity:0}),_this.endYear.tween({opacity:1},100,"easeInOutCubic")):(_this.endYear.css({opacity:1}),_this.endYear.tween({opacity:0},100,"easeInOutCubic"))}),_this.bind(_this.state,"selectedYear",function updateSelectedYear(selectedYear){[..._this.yearInputs.children()].forEach(radio=>{radio.checked=radio.value===selectedYear})}),_this.bind(_this.state,"selectedYearIndex",function updateScrubberPosition(index){let targetWidth=width/yearGap*Number(index),targetX=Math.min(targetWidth,width);tween(_this.draggerTarget,{x:targetX},1e3,"easeInOutCubic").onUpdate(()=>{_this.dragger.moveToX(_this.draggerTarget.x)})}),_this.bind(_this.state,"selected",selected=>{_this.dragLineContainer.classList().toggle("selected",selected)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_this.dragger=_this.initClass(Interaction.Dragger,AppState.createLocal({object:_this.draggerTarget,element:_this.dragLineContainer,lerp:1,boundsMinX:0,boundsMaxX:1e3,boundsMinY:0,boundsMaxY:0})),_this.dragger.isFragment&&_promises.push(_this.wait(_this.dragger,"__ready")),_promises=null,_this.flag?.("__ready",!0),onInit||"DragBranchChartDesktop"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function DragBranchChartMobile(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="DragBranchChartMobile",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"yearInputs",children:[]},{_type:"div",refName:"scubbers",children:[{_type:"div",refName:"scrubContainer",children:[{_type:"div",refName:"topOverlay",children:[]},{_type:"div",refName:"dragContainer",children:[{"aria-label":"Drag to scroll through the chart",role:"scrollbar",_type:"div",refName:"dragLineContainer",children:[{_type:"div",refName:"dragLine",children:[{id:"anchor",_type:"Sprite",refName:"unnamed",children:[]},{id:"anchor",_type:"Sprite",refName:"unnamed",children:[]}]},{_type:"p",_innerText:"1980",refName:"year",children:[]}]}]},{_type:"div",refName:"bottomOverlay",children:[]}]}]},{_type:"div",refName:"chartContainer",children:[{_type:"div",refName:"base",children:[]},{_type:"div",refName:"lines",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let linesChart,width,yearGap,onInit=_this.onInit;_this.element.div.style.setProperty("--progress","0%"),_this.draggerTarget={x:0,y:0},_this.startRender(function loop(){if(!linesChart||!_this.state.initialBound)return;_this.chartContainer.css({transform:`translate(${Math.round(_this.draggerTarget.x)}px, ${Math.round(_this.draggerTarget.y)}px)`}),_this.state.normalizedProgress=Math.abs(_this.draggerTarget.x)/width,_this.element.div.style.setProperty("--progress",100*_this.state.normalizedProgress+"%");let lineChartBound=linesChart.getBoundingClientRect();lineChartBound.right-_this.state.initialBound.left+_this.state.dragLineOffset<_this.state.dragLineOffset?_this.dragLineContainer.x=Math.max(lineChartBound.right-_this.state.initialBound.left+_this.state.dragLineOffset,_this.state.dragLineOffset-paddingRight):_this.dragLineContainer.x=_this.state.dragLineOffset;_this.dragLineContainer.transform()});let paddingRight=60;async function setSize(){await _this.wait("isReady"),width=linesChart.getBoundingClientRect().width,_this.dragger.setBoundsX([-width-paddingRight,0]);let center=window.innerWidth/2;_this.state.initialBound=linesChart.getBoundingClientRect(),(_this.state.initialBound.left>center||_this.state.initialBound.left<center)&&(_this.state.dragLineOffset=_this.state.initialBound.left-center)}_this.state.initialBound,_this.state.dragLineOffset,_this.state.scrolled=!1,_this.onInit=async()=>{await _this.base.svg("assets/images/book-charts/reboot/drag-chart/base-chart.svg"),await _this.lines.svg("assets/images/book-charts/reboot/drag-chart/lines.svg"),linesChart=_this.lines.div.querySelector("#lines"),_this.flag("isReady",!0)},_this.onMounted=()=>{setSize(),function setKeyboardControl(){yearGap=21;let yearInputs=[];for(let i=0;i<yearGap+1;i++){let input=document.createElement("input");input.type="radio",input.name="year",input.value=1980+i,input.dataset.index=i,yearInputs.push(input),_this.yearInputs.add(input)}}()},_this.element.onResize(()=>{setSize()}),_this.bind(_this.state,"normalizedProgress",progress=>{yearGap=20;let currentYear=1980+Math.round(progress*yearGap);_this.year.text(currentYear)}),_this.yearInputs.bind("input",function handleYearInput(e){let selectedYear=_this.yearInputs.div.querySelector("input:checked");_this.state.selectedYear=selectedYear?.value,_this.state.selectedYearIndex=selectedYear?.dataset.index}),_this.bind(_this.state,"selectedYear",function updateSelectedYear(selectedYear){[..._this.yearInputs.children()].forEach(radio=>{radio.checked=radio.value===selectedYear})}),_this.bind(_this.state,"selectedYearIndex",function updateScrubberPosition(index){let targetWidth=width/(yearGap+1)*Number(index),targetX=Math.max(-targetWidth,-width);tween(_this.draggerTarget,{x:targetX},1e3,"easeInOutCubic").onUpdate(()=>{_this.dragger.moveToX(_this.draggerTarget.x)})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_this.dragger=_this.initClass(Interaction.Dragger,AppState.createLocal({object:_this.draggerTarget,element:_this.chartContainer,lerp:1,boundsMinX:0,boundsMaxX:1e3,boundsMinY:0,boundsMaxY:0})),_this.dragger.isFragment&&_promises.push(_this.wait(_this.dragger,"__ready")),_promises=null,_this.flag?.("__ready",!0),onInit||"DragBranchChartMobile"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ExternalLinkButton(_params,...restArgs){const _this=this;Inherit(_this,Element,"a"),Inherit(_this,TextAnimationHelper),Inherit(_this,XComponent),_this.fragName="ExternalLinkButton",_this.contexts="Element, 'a',TextAnimationHelper",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"p",refName:"text",children:[]},{"aria-hidden":!0,tabIndex:-1,_type:"div",refName:"iconWrapper",children:[{id:"top-right-arrow",_type:"Sprite",refName:"icon",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function updateText(text){_this.text.text(TextUtils.capitalize(text))}function handleLink(link){link&&(_this.element.attr("target","_blank"),_this.element.attr("rel","noopener noreferrer"),_this.element.attr("href",link))}_this.params.tabindex&&_this.element.attr("tabindex",_this.params.tabindex),_this.onMounted=()=>{_this.element.attr("role","link"),_this.icon.element.attr("aria-hidden","true"),_this.icon.element.attr("tabindex","-1")},_this.state.setAll(_this.params.externalLinkButton),_this.bind(_this.state,"linkText",updateText),_this.bind(_this.state,"href",handleLink),_this.bind(_this.params,"ariaLabel",function updateAriaLabel(label){label&&_this.element.attr("aria-label",label)}),_this.params?.linkText&&updateText(_this.params.linkText),_this.params?.href&&handleLink(_this.params.href),_this.element.hover(e=>{}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ExternalLinkButton"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FXSceneSlice(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,OptionalFragFXScene),Inherit(_this,XComponent),_this.fragName="FXSceneSlice",_this.contexts="Element,OptionalFragFXScene",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this._initFXScene(World.NUKE,null,{format:Texture.RGBFormat,type:void 0,minFilter:void 0,magFilter:void 0,multiRenderTarget:void 0,mipmaps:void 0,screenQuad:void 0,vrMode:void 0,multisample:void 0,samplesAmount:void 0}),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;if(!_params.preventAutoInit){const requiresFallback=Tests.requiresFallbackGraphics(_params.attemptAllMobile)||_params.fallbackMobile&&Device.mobile;requiresFallback?(_this.visible=!1,_this.nuke.disable(),_this.nuke.paused=!0,_this.requiresFallback=requiresFallback):(_params.sceneName||_params.sceneLayoutName)&&(_this.initLayout(_params.sceneName||_params.sceneLayoutName),initMesh())}function initTimeline(){_this.wait(_=>_this.layout&&_this.layout.getAllLayers&&(_this.sceneName||_params.sceneLayoutName)).then(_=>{if(!_this.timeline)try{let isMobile=Hydra.LOCAL&&Utils.query("mobile")||Device.system.mobile,name=_this.sceneName||_params.sceneLayoutName,tweenName=_params.timelineName||`FXSceneSlice_${name}${isMobile?"_m":""}`;_this.timeline=TweenUIL.create(tweenName,_this.layout),_this.timeline.preload()}catch(error){console.error("Error initializing timeline",error)}})}function onObservation(entries){if(0===entries[0].intersectionRatio)return hide();show()}async function cacheSize(){await defer(),_this.targetElement.cacheHeight=_this.targetElement.div.offsetHeight,_this.targetElement.cacheTop=_this.targetElement.div.offsetTop,_this.targetElement!==_this.element&&(_this.targetElement.cacheTop+=_this.element.div.offsetTop)}function loop(){if(!_this.targetElement||isNaN(_this.targetElement.cacheHeight)||isNaN(_this.targetElement.cacheTop))return;let scroll=Global.lenis?Global.lenis.scroll:window.scrollY,top=_this.targetElement.cacheTop-scroll,height=_this.targetElement.cacheHeight,bottom=top+height-Stage.height,topOffset=top/Stage.height,bottomOffset=bottom/Stage.height;_this.scrollTop=_this.targetElement.cacheTop,_this.scrollHeight=height,_this.scrollBottom=_this.scrollTop+height,_this.totalProgress=Math.range(top,Stage.height,-height,0,.999,!0),_this.visibleProgress=Math.range(top,0,-height+Stage.height,0,.999,!0),height>=Stage.height?_this.progress=_this.visibleProgress:_this.progress=_this.totalProgress,_this.timeline&&_this.timeline.duration>0&&(_this.timeline.state.editorOpen||!Global.lenis||Global.PLAYGROUND?_this.progress=_this.timeline.progress:_this.timeline.seek(_this.progress));let offset,vertClip=Math.min(1,height/Stage.height);if(height>=Stage.height&&!_this.scrollsInline)offset=bottomOffset<0?bottomOffset:topOffset>0?topOffset:0;else{offset=(top+height/2-Stage.height/2)/Stage.height}_this.shader&&(_this.shader.set("uVertOffset",offset),_this.shader.set("uVertClip",vertClip),Global.PLAYGROUND?_this.shader.set("uTransition",1):_this.shader.set("uTransition",_this.get("PageTransition/transition"))),_this.scene.scale.setScalar(vertClip*_this.responsiveScale),_this.widthMultiplier=1/vertClip}function hide(){_this.visible=!1,_this.mesh&&(_this.mesh.visible=!_this.requiresFallback&&_this.visible)}function show(){_this.visible=!_this.flag("preventVisible"),_this.mesh&&(_this.mesh.visible=!_this.requiresFallback&&_this.visible)}function initMesh(){_this.shader=_this.initClass(Shader,"SliceScreenQuad",{tMap:{value:_this},uVertOffset:{value:0},uVertClip:{value:0},uTransition:{value:0}}),_this.mesh=new Mesh(World.QUAD,_this.shader),_this.mesh.frustumCulled=!1,_this.mesh.renderOrder=-1,World.SCENE.add(_this.mesh)}_this.widthMultiplier=1,_this.totalProgress=0,_this.visibleProgress=0,_this.progress=0,_this.responsiveScale=1,_params.timeline&&!_this.requiresFallback&&initTimeline(),_this.initTimeline=initTimeline,_this.initMesh=initMesh,_this.setTargetElement=element=>{_this.targetElement&&_this.observer.unobserve(_this.targetElement.div),_this.targetElement=element,_this.observer.observe(_this.targetElement.div),cacheSize()},Render.start(loop),_this._bindOnDestroy(()=>{Render.stop(loop)}),_this.onDestroy=_=>{_this.observer.disconnect(),_this.mesh&&World.SCENE.remove(_this.mesh)},(async()=>{await _this.wait("targetElement"),await _this.targetElement.mounted(),Render.start(cacheSize,1),_this._bindOnDestroy(()=>{Render.stop(cacheSize)}),_this.onResize(cacheSize)})(),_this.delayedCall(_=>{!function initObserver(){_this.observer=new IntersectionObserver(onObservation,{root:document.html,threshold:[0]})}(),_this.targetElement||_this.setTargetElement(_this.element)},100),_this.show=_=>show(),_this.hide=_=>hide(),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FXSceneSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FakeProgress(_params,...restArgs){const _this=this;Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="FakeProgress",_this.contexts="Component",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;const _state=_this.params.state;let _tween,_speed=(_this.params.expectedDuration||3e3)/3,_seekTween=null,_seekingTo=null;async function inc(amount,speed=_speed){let n=(_state.progress||0)/100;if(!(n>=1))return"number"!=typeof amount&&(amount=n>=0&&n<.2?.1:n>=.2&&n<.5?.04:n>=.5&&n<.8?.02:n>=.8&&n<.99?.005:0),n=Math.clamp(n+amount,0,.994),_tween&&_tween.stop(),_tween=tween(_state,{progress:100*n},speed,"linear"),_tween.promise()}_this.flag("isDone",!0),_this.start=async function(){for(_this.flag("isDone",!1),_seekTween&&(_seekTween.stop(),_seekTween=null,_seekingTo=null),_state.progress=0;_state.progress<100&&!_this.flag("isDone");)await inc()},_this.pause=async function(){_this.flag("isDone")||_tween&&(_tween.stop(),_tween=null)},_this.resume=async function(){if(!_tween&&!_this.flag("isDone"))for(_seekTween&&await _seekTween.promise();_state.progress<100;)await inc()},_this.seek=async function(seek){if(!_this.flag("isDone"))return _this.pause(),seek!==_seekingTo?(_seekTween&&_seekTween.stop(),_seekingTo=seek,_seekTween=tween(_state,{progress:_seekingTo},200,"easeOutCubic").onComplete(()=>{_seekTween=null,_seekingTo=null}),_seekTween.promise()):void 0},_this.seekAndResume=async function(seek){await _this.seek(seek),_this.resume()},_this.done=async function(){_this.flag("isDone")||(_this.flag("isDone",!0),await inc(.3+.5*Math.random(),200),_state.progress=100,_this.flag("isDone",!1))},_this.bind(_this.params,"expectedDuration",()=>{let nextSpeed=(_this.params.expectedDuration||3e3)/3;nextSpeed!==_speed&&(_speed=nextSpeed,_tween&&(_this.pause(),_this.resume()))}),Object.defineProperty(_this,"speed",{get:()=>_speed}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FakeProgress"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FeatureSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="FeatureSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{view:"FeatureSliceBlock",data:"$data.features",_type:"ViewState",refName:"features",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"backgroundColor",color=>{color&&_this.element.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FeatureSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FeatureSliceBlock(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView),Inherit(_this,XComponent),_this.fragName="FeatureSliceBlock",_this.contexts="ViewStateElement,Element,InView",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"border",children:[]},{_type:"div",refName:"container",children:[{_type:"h5",_innerText:"$data.headline",refName:"headline",children:[]},{_type:"p",_innerText:"$data.subheadline",refName:"subheadline",children:[]},{_type:"div",refName:"description",children:[{content:"$data.description",_type:"RichText",refName:"unnamed",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.isMobile=Stage.width<769,_this.onResize(_=>{_this.state.isMobile=Stage.width<769}),_this.data.subheadline?(_this.headline.css({gridColumn:"1 / 4"}),_this.subheadline.css({gridColumn:"5 / 8"}),_this.description.css({gridColumn:"9 / 13"})):(_this.subheadline.hide(),_this.headline.css({gridColumn:"1 / 6"}),_this.description.css({gridColumn:"7 / 13"})),_this.bind(_this.state,"isMobile",isMobile=>{isMobile?_this.data.subheadline?(_this.headline.css({gridColumn:"1 / 13"}),_this.subheadline.css({gridColumn:"1 / 13"}),_this.description.css({gridColumn:"1 / 13"})):(_this.headline.css({gridColumn:"1 / 13"}),_this.description.css({gridColumn:"1 / 13"})):_this.data.subheadline?(_this.headline.css({gridColumn:"1 / 4"}),_this.subheadline.css({gridColumn:"5 / 8"}),_this.description.css({gridColumn:"9 / 13"})):(_this.subheadline.hide(),_this.headline.css({gridColumn:"1 / 6"}),_this.description.css({gridColumn:"7 / 13"}))}),_this.onMounted=()=>{_this.border.transform({scaleX:0})},_this.onInView=()=>{_this.border.tween({scaleX:1},2e3,"easeOutExpo"),[_this.headline,_this.subheadline,_this.description].forEach((element,index)=>{element.tween({x:"0%",opacity:1},1e3,"easeOutExpo",200+100*index).promise()})};let featureParent=_this.findParent("FeatureSlice");_this.bind(featureParent.data,"backgroundColor",color=>{color&&_this.border.css({backgroundColor:color.contrastColor})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FeatureSliceBlock"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FeaturedProducts(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="FeaturedProducts",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{view:"FeaturedProductsCard",data:"$data.cards",_type:"ViewState",refName:"vs",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.element.classList().add(["one","two","three","four","five","six","seven","eight","nine"][_this.data.cards.length-1]),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FeaturedProducts"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FeaturedProductsCard(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Link),Inherit(_this,TextAnimationHelper),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="FeaturedProductsCard",_this.contexts="ViewStateElement,Link,TextAnimationHelper,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"mediaContainer",children:[]},{_type:"div",refName:"overlayer",children:[]},{className:"content-wrapper",_type:"div",refName:"unnamed",children:[{_type:"h2",_innerText:"$data.title",refName:"title",children:[]},{_type:"div",refName:"descriptionWrapper",children:[{_type:"h4",refName:"description",children:[]},{"aria-hidden":!0,_type:"h4",refName:"descriptionHidden",children:[]}]}]},{_type:"div",refName:"icons",children:[{id:"top-right-arrow",_type:"Sprite",refName:"unnamed",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.descriptionWrapper.hide(),_this.state.aspect=1,_this.state.isMobile=Stage.width<769,_this.state.scrolled=!1,_this.onResize(_=>{_this.state.isMobile=Stage.width<769}),_this.element.onResize(_=>{animateOut()});function animateIn(){_this.description.css({height:"0px",marginTop:"0px",opacity:0}),_this.descriptionHidden.css({height:"0px",marginTop:"0px"}),_this.icons.css({opacity:0}),_this.state.isMobile?(_this.description.tween({height:"1.5rem",marginTop:"0.5rem",opacity:1},500,"easeOutCubic"),_this.descriptionHidden.tween({height:"1.5rem",marginTop:"0.5rem"},500,"easeOutCubic"),_this.icons.tween({opacity:1},500,"easeOutCubic"),_this.animateText(_this.description,750,!0)):(_this.description.tween({height:"1.25rem",marginTop:"0.5rem",opacity:1},500,"easeOutCubic"),_this.descriptionHidden.tween({height:"1.25rem",marginTop:"0.5rem"},500,"easeOutCubic"),_this.icons.tween({opacity:1},500,"easeOutCubic"),_this.animateText(_this.description,750,!0))}function animateOut(){_this.state.isMobile||(_this.description.css({height:"1.25rem",marginTop:"0.5rem",opacity:1}),_this.descriptionHidden.css({height:"1.25rem",marginTop:"0.5rem"}),_this.icons.css({opacity:1}),_this.description.tween({height:"0px",marginTop:"0px",opacity:0},500,"easeOutCubic"),_this.descriptionHidden.tween({height:"0px",marginTop:"0px"},500,"easeOutCubic"),_this.icons.tween({opacity:0},500,"easeOutCubic"))}function updateMedia(){_this.mediaContainer.div.children.length>0&&_this.mediaContainer.empty();let mediaData;if(mediaData="video"===(_this.data.mediaType||"image")?_this.data.video:_this.data.image,mediaData){const mediaParams=AppState.createLocal(mediaData);mediaParams.cropAspect=_this.state.aspect,mediaParams.sizes="(min-width: 769px) 56vw, 100vw",mediaParams.disableLiveEditOverlay=!0,_this.createFragment(ResponsiveMedia,mediaParams,[_this.mediaContainer])}}function handleDescription(description){description&&(_this.description.text(description),_this.descriptionHidden.text(description),_this.description.show(),_this.descriptionWrapper.show())}function handleLayout(){_this.element.classList().remove("wide","tall"),"wide"===_this.data.layout?(_this.element.classList().add("wide"),_this.state.aspect=2):"tall"===_this.data.layout?(_this.element.classList().add("tall"),_this.state.aspect=.5):_this.state.aspect=1,updateMedia()}_this.onInit=_=>{updateMedia(),_this.bind(_this.data,"page",pages=>_this.setupLink(pages[0],!1)),_this.bind(_this.data,"description",handleDescription),_this.bind(_this.data,"layout",handleLayout),_this.bind(_this.data,"mediaType",updateMedia),_this.bind(_this.data,"image",updateMedia),_this.bind(_this.data,"video",updateMedia),_this.bind(_this.data,"title",title=>{let cleanedTitle=SanityUtils.stegaClean(title);_this.state.maskId=`mask-${cleanedTitle}`,_this.element.div.style.setProperty("--mask-id",`url(#${_this.state.maskId})`),_this.element.attr("aria-label",cleanedTitle),_this.element.attr("role","link")})},_this.onMounted=()=>{_this.element.css({opacity:0}),_this.description.css({height:"0px",marginTop:"0px",opacity:0}),_this.descriptionHidden.css({height:"0px",marginTop:"0px"}),_this.icons.css({opacity:0}),_this.element.div.getBoundingClientRect().top<window.innerHeight&&(_this.element.tween({opacity:1},1e3,"easeOutExpo"),_this.state.scrolled=!0),_this.element.bind("mouseenter",animateIn),_this.element.bind("mouseleave",animateOut)},_this.onInView=()=>{_this.element.tween({opacity:1},1e3,"easeOutExpo"),!_this.state.scrolled&&_this.state.isMobile&&(_this.state.scrolled=!0,animateIn())},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FeaturedProductsCard"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FighterJetTrend(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,InView,.9),Inherit(_this,XComponent),_this.fragName="FighterJetTrend",_this.contexts="Element,InView, 0.9",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let mainChart,lines,triangles,dotSquares,dots,diamonds,hexagons,text,onInit=_this.onInit;_this.state.scrolled=!1,_this.onInit=async()=>{await _this.element.svg("assets/images/book-charts/reboot/fighter-jet.svg"),mainChart=_this.element.div.querySelector("#fighter-jet"),lines=mainChart.querySelector("#line"),triangles=mainChart.querySelector("#triangle"),dotSquares=mainChart.querySelector("#dot-square"),dots=mainChart.querySelector("#dot"),diamonds=mainChart.querySelector("#diamond"),hexagons=mainChart.querySelector("#hexagon"),text=mainChart.querySelector("#text"),_this.flag("isReady",!0)},_this.onInView=async()=>{await _this.wait("isReady"),!_this.state.scrolled&&_this.getSync("AnimationSwitch/animationEnabled")&&(_this.state.scrolled=!0,function animateIn(){(function animateLines(){[...lines.children].forEach((line,index)=>{let dashArray=line.getAttribute("stroke-dasharray"),tweenObj={dashArray:1e3,dashOffset:1e3};dashArray||(line.setAttribute("stroke-dasharray",tweenObj.dashArray),line.setAttribute("stroke-dashoffset",tweenObj.dashOffset),tween(tweenObj,{dashOffset:0},2e3,"easeInOutQuart",100*index).onUpdate(()=>{line.setAttribute("stroke-dashoffset",tweenObj.dashOffset)}))})})(),function animateHexagons(){[...hexagons.children].forEach((hexagon,index)=>{switch(index){case 0:{let hydraObj=new HydraObject(hexagon),tweenObj={opacity:0};hydraObj.css({opacity:tweenObj.opacity}),tween(tweenObj,{opacity:1},1e3,"easeInOutBounce",200+100*index).onUpdate(()=>{hydraObj.css({opacity:tweenObj.opacity})});break}case 1:{let tweenObj={opacity:0},hydraObj=new HydraObject(hexagon);hydraObj.css({opacity:tweenObj.opacity}),tween(tweenObj,{opacity:1},1e3,"easeInOutBounce",200+100*index).onUpdate(()=>{hydraObj.css({opacity:tweenObj.opacity})});break}case 2:{let tweenObj={opacity:0},hydraObj=new HydraObject(hexagon);hydraObj.css({opacity:tweenObj.opacity}),tween(tweenObj,{opacity:1},1e3,"easeInOutBounce",200+100*index).onUpdate(()=>{hydraObj.css({opacity:tweenObj.opacity})});break}}})}(),function animateDotSquares(){[...dotSquares.children].forEach((dotSquare,index)=>{let squareRect=dotSquare.querySelector("rect"),opacityObj={value:0};squareRect.style.opacity=opacityObj.value,tween(opacityObj,{value:1},1e3,"easeInOutBounce",100*index).onUpdate(()=>{squareRect.style.opacity=opacityObj.value})})}(),function animateDots(){[...dots.children].forEach((dot,index)=>{let circle=dot.querySelector("circle"),opacityObj={value:0};circle.style.opacity=opacityObj.value,tween(opacityObj,{value:1},1e3,"easeInOutBounce",25*index).onUpdate(()=>{circle.style.opacity=opacityObj.value})})}(),function animateDiamonds(){[...diamonds.children].forEach((diamond,index)=>{let tweenObj={},hydraObj=new HydraObject(diamond);tweenObj.opacity=0,hydraObj.css({opacity:tweenObj.opacity}),tween(tweenObj,{opacity:1},1e3,"easeInOutBounce",25*index).onUpdate(()=>{hydraObj.css({opacity:tweenObj.opacity})})})}(),function animateTriangles(){[...triangles.children].forEach((triangle,index)=>{let tweenObj={opacity:0},hydraObj=new HydraObject(triangle);hydraObj.css({opacity:tweenObj.opacity}),tween(tweenObj,{opacity:1},1e3,"easeInOutBounce",100*index).onUpdate(()=>{hydraObj.css({opacity:tweenObj.opacity})})})}(),function animateText(){[...text.children].forEach((element,index)=>{let tweenObj={opacity:0},hydraObj=new HydraObject(element);hydraObj.css({opacity:tweenObj.opacity}),tween(tweenObj,{opacity:1},1e3,"easeInOutBounce",200+100*Math.mod(index,3)).onUpdate(()=>{hydraObj.css({opacity:tweenObj.opacity})})})}()}())},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FighterJetTrend"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FileUpload(_params,...restArgs){const _this=this;Inherit(_this,Component),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="FileUpload",_this.contexts="Component,Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{type:"file",id:"$state.label",accept:"$state.limitedFileType",style:"display: none;",_type:"input",refName:"input",children:[]},{htmlFor:"$params.label",_type:"label",refName:"unnamed",children:[{id:"upload",_type:"Sprite",refName:"unnamed",children:[]},{_type:"span",_innerText:"$state.buttonText",refName:"buttonText",children:[]}]},{_type:"p",refName:"caption",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.setAll(_this.params),_this.bind(_this.state,"limitedFileType",function handleLimitedFileType(limitedFileType){if(limitedFileType){let captionString=`Accepted file types: ${limitedFileType}`;_this.caption.text(captionString)}}),_this.bind(_this.state,"error",function handleError(error){error&&(_this.element.classList().add("error"),_this.caption.text("File size must be less than 10MB."),_this.buttonText.text("Reupload file"),_this.input.val(""))}),_this.bind(_this.state,"success",function handleSuccess(){_this.element.classList().remove("error"),_this.element.classList().add("uploaded"),_this.caption.text("File uploaded successfully!"),_this.buttonText.text("Change file")}),_this.input.bind("change",function handleInput(e){_this.state.error=!1,_this.state.success=!1;let fileList=e.target.files,file=fileList[0];if(file.size>1048576)return _this.state.error=!0,void(_this.state.success=!1);1===fileList.length&&(_this.state.error=!1,_this.state.success=!0);if(file){const reader=new FileReader;reader.onload=function(e){_this.state.fileContent=e.target.result},reader.readAsDataURL(file)}}),_this.getValue=()=>_this.state.fileContent,onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FileUpload"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FilterButton(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="FilterButton",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"filter-button",onClick:"$onClick","aria-label":"$params.ariaLabel",role:"button",_type:"button",refName:"unnamed",children:[{className:"filter-button__text",_type:"div",refName:"text",children:[]},{className:"filter-button__icon",_type:"div",refName:"unnamed",children:[{id:"close",_type:"Sprite",refName:"unnamed",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.params?.text&&_this.text.text(_this.params.text),_this.onClick=_=>{_this.params.onClick&&_this.params.onClick(_this.element,_)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FilterButton"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FlagHeader(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="FlagHeader",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{imageWithMeta:"$data.flag",_type:"ResponsiveImage",refName:"previewImage",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FlagHeader"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function Footer(_params,...restArgs){const _this=this;Inherit(_this,Element,"footer"),Inherit(_this,TextAnimationHelper),Inherit(_this,InView),Inherit(_this,XComponent),_this.fragName="Footer",_this.contexts="Element, 'footer',TextAnimationHelper,InView",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"wrapper",_type:"div",refName:"wrapper",children:[{className:"top",_type:"div",refName:"unnamed",children:[{href:"/","data-path":"/","aria-label":"Home",_type:"a",refName:"logo",children:[{role:"img","aria-label":"Anduril Logo",viewBox:"0 0 100 19",fill:"none",xmlns:"http://www.w3.org/2000/svg",_type:"svg",refName:"unnamed",children:[{d:"M30.5504 2.55978L35.3712 15.8877H32.7057L31.6856 13.0207H26.3712L25.3511 15.8877H22.735L27.5394 2.55978H30.5504ZM27.2103 10.7169H30.8465L29.0202 5.59739L27.2103 10.7169ZM47.4809 15.9048H45.1938L39.1719 6.70662V15.9048H36.6381V2.57684H39.3035L44.947 11.3142V2.55978H47.4809V15.9048ZM49.735 2.55978H54.1609C58.2085 2.55978 60.6765 5.17075 60.6765 9.23227C60.6765 13.2938 58.2085 15.9048 54.1609 15.9048H49.735V2.55978ZM54.1609 13.5668C56.6454 13.5668 58.0768 11.8603 58.0768 9.24934C58.0768 6.60423 56.6454 4.91478 54.1445 4.91478H52.3181V13.5668H54.1609ZM62.1079 10.5804V2.57684H64.7569V10.478C64.7569 12.7306 65.8099 13.6863 67.4223 13.6863C69.0348 13.6863 70.0878 12.7136 70.0878 10.478V2.57684H72.7203V10.5804C72.7203 14.2665 70.5814 16.0925 67.4059 16.0925C64.2304 16.0925 62.1079 14.2494 62.1079 10.5804ZM77.3931 15.9048H74.7605V2.57684H80.0256C82.9872 2.57684 84.83 4.02739 84.83 6.77488C84.83 8.78858 83.777 10.1538 81.9671 10.6999L85.1755 15.9218H82.1646L79.203 10.9559H77.4095V15.9048H77.3931ZM79.894 8.66912C81.4406 8.66912 82.2139 7.96945 82.2139 6.79195C82.2139 5.58032 81.4241 4.89771 79.894 4.89771H77.4095V8.66912H79.894ZM89.2066 15.9048H86.5741V2.57684H89.223L89.2066 15.9048ZM91.4442 2.55978H94.0932V13.5327H100V15.9048H91.4607L91.4442 2.55978ZM19.5266 12.1163C19.2633 11.9798 19.0165 11.8432 18.7862 11.6897C17.9635 11.1948 17.2067 10.5975 16.5156 9.93195C16.2853 9.7101 16.0385 9.47118 15.8246 9.21521C13.8337 6.9626 12.6491 4.07858 12.4681 1.02391L12.4352 0.221848V0.153586C12.4352 0.0682598 12.3858 0 12.3036 0H7.23594C7.15367 0 7.10431 0.0682598 7.10431 0.153586V0.221848L7.0714 1.02391C6.89042 4.02739 5.73868 6.89434 3.78073 9.12988C3.56684 9.38586 3.32004 9.62477 3.08969 9.86369C2.39865 10.5463 1.64179 11.1436 0.819125 11.6555C0.572324 11.8091 0.325524 11.9456 0.0787231 12.0822C0.0129097 12.1163 -0.0199973 12.2016 0.0129094 12.2699C0.128083 12.5429 0.243256 12.7989 0.35843 13.0378C0.802671 13.9252 1.36209 14.7443 2.02022 15.4781C2.21766 15.7 2.43155 15.9048 2.62899 16.1096C6.67652 19.9492 12.8794 19.9663 16.9434 16.1437C17.1573 15.9389 17.3712 15.7171 17.5522 15.5123C18.2103 14.7785 18.7697 13.9593 19.2304 13.0719C19.3621 12.816 19.4772 12.56 19.576 12.304C19.6253 12.2187 19.5924 12.1334 19.5266 12.1163ZM4.25788 15.6829C4.25788 15.8024 4.1427 15.8706 4.04398 15.8024C3.87945 15.6829 3.73137 15.5464 3.58329 15.4099C3.35294 15.2051 3.1555 15.0003 2.97451 14.8126C2.38219 14.1812 1.87214 13.4644 1.46081 12.6794C1.4279 12.6112 1.44435 12.5429 1.51017 12.4917C2.23411 12.031 2.92515 11.5019 3.56684 10.9047C3.79718 10.6999 4.02753 10.461 4.24142 10.2391C5.96903 8.41314 7.18658 6.14347 7.76244 3.66902C7.76244 3.4813 8.0257 3.4813 8.0257 3.66902C8.2725 4.94891 8.63447 6.21173 9.14453 7.4063C9.16098 7.44043 9.16098 7.49162 9.14453 7.52575C8.28895 9.38586 7.12076 11.0753 5.67287 12.5088C5.45897 12.7136 5.24508 12.9184 5.06409 13.1402C4.66921 13.618 4.40596 14.1982 4.29078 14.8297C4.25788 15.0344 4.24142 15.2392 4.24142 15.444L4.25788 15.6829ZM12.8301 13.0378C12.8959 13.1061 12.8794 13.2085 12.7972 13.2597C11.9087 13.8057 10.8721 14.0959 9.83557 14.1129H9.80266C8.73319 14.1129 7.68018 13.8057 6.75879 13.2255C6.69298 13.1743 6.67652 13.0719 6.72588 13.0207C6.98913 12.7477 7.25239 12.4576 7.49919 12.1675C8.32186 11.1948 9.04581 10.1367 9.65458 8.99336C9.70394 8.90803 9.83557 8.90803 9.88493 8.99336C10.6747 10.461 11.6619 11.8262 12.8301 13.0378ZM5.73868 14.0788C5.77159 14.0105 5.87031 13.9935 5.91967 14.0447C7.0714 14.8467 8.42058 15.2734 9.80266 15.2734L10.1153 15.2563C10.395 15.2392 10.6747 15.2051 10.9379 15.171C11.9251 15.0003 12.863 14.6078 13.7021 14.0447C13.7515 14.0105 13.8173 14.0105 13.8666 14.0617C14.4425 14.5737 15.0677 15.0515 15.7094 15.4781C15.7917 15.5293 15.7917 15.6488 15.7094 15.7C14.0476 17.0652 12.0074 17.8161 9.90138 17.8331H9.81911C9.39133 17.8331 8.94709 17.799 8.5193 17.7478C7.58146 17.6113 6.67652 17.3382 5.82095 16.9287C5.80449 16.9116 5.78804 16.8945 5.77159 16.8775C5.19572 16.0413 5.17926 14.915 5.73868 14.0788ZM14.5248 13.1573L13.8831 12.56C12.4023 11.0924 11.1847 9.35173 10.3127 7.42336C10.1482 7.06499 10.0001 6.70662 9.86847 6.34825C9.27615 4.74412 8.91418 3.03761 8.81546 1.33109C8.79901 1.24576 8.86482 1.1775 8.94709 1.1775H11.2341C11.2999 1.1775 11.3657 1.22869 11.3822 1.31402L11.448 2.08195C11.8429 5.20489 13.2085 8.10597 15.3474 10.3415C15.5613 10.5634 15.7917 10.7852 16.022 11.0071C16.6637 11.6043 17.3548 12.1163 18.0787 12.5771C18.1445 12.6112 18.161 12.6965 18.1281 12.7648C17.7496 13.4644 17.2889 14.13 16.7624 14.7273C16.7131 14.7785 16.6473 14.7955 16.5979 14.7614C15.874 14.2494 15.1829 13.7375 14.5248 13.1573Z",fill:"currentColor",_type:"path",refName:"unnamed",children:[]}]}]},{_type:"div",refName:"spacer",children:[]},{view:"FooterListLinks",data:"$sections",_type:"ViewState",refName:"vs",children:[]}]},{className:"bottom",_type:"div",refName:"unnamed",children:[{className:"small-links",_type:"div",refName:"unnamed",children:[{className:"copyright",_type:"p",refName:"copyright",children:[]},{view:"FooterListSmallLink",data:"$links",_type:"ViewState",refName:"unnamed",children:[]}]},{className:"contact-container",_type:"div",refName:"unnamed",children:[{className:"contact-title",_type:"p",_innerText:"Contact",refName:"contactTitle",children:[]},{className:"contact-email",_type:"Link",refName:"contactLink",children:[]}]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.sections=new StateArray;let settings=await _this.get("Global/siteSettings");_this.links=settings.footerSmallPrintLinks,_this.bind(settings,"copyright",data=>_this.copyright.text(data)),_this.bind(settings,"contactTitle",data=>_this.contactTitle.text(data)),_this.bind(settings,"contactLink",data=>_this.contactLink.setupLink(data)),_this.spacer.css({gridColumn:"span "+(12-2*_this.sections.length)}),_this.state.isMobile=Stage.width<769,_this.onResize(_=>_this.state.isMobile=Stage.width<769);let contactSection={title:settings.contactTitle,links:[settings.contactLink]};await _this.wait("vs"),_this.bind(_this.state,"isMobile",isMobile=>{let footerLinks=[];settings.footerLinks.forEach(link=>{footerLinks.push(link)}),isMobile&&footerLinks.push(contactSection),_this.sections.refresh(footerLinks),_this.spacer.css({gridColumn:"span "+(12-2*_this.sections.length)})}),_this.onInView=()=>{_this.animateText(_this.contactTitle,400,!0)},_this.wait(_=>Global.lenis&&Global.lenis.scroll&&Global.lenis.scroll>0).then(_=>{_this.wrapper.css({display:"flex"})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"Footer"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FooterListLink(_data,_index,_params){const _this=this;Inherit(_this,Link),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="FooterListLink",_this.contexts="Link,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.setupLink(_this.data),_this.bind(_this.state,"textWrapper",_=>{}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FooterListLink"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FooterListLinks(_data,_index,_params){const _this=this;Inherit(_this,Element,"button"),Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,InView),Inherit(_this,XComponent),_this.fragName="FooterListLinks",_this.contexts="Element, 'button',ViewStateElement,TextAnimationHelper,InView",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"title-wrapper",_type:"div",refName:"titleWrapper",children:[{className:"title",_type:"p",refName:"title",children:[]},{className:"plus-sign",_type:"div",refName:"unnamed",children:[{_type:"div",refName:"unnamed",children:[]},{_type:"div",refName:"unnamed",children:[]}]}]},{className:"links-wrapper",_type:"div",refName:"linksWrapper",children:[{view:"FooterListLink",data:"$data.links",_type:"ViewState",refName:"vs",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;async function resize(){let totalHeight=0;_this.linksWrapper.css({overflow:"visible",opacity:0}),await _this.wait(_=>_this.vs.views.every(view=>view?.element?.div?.offsetHeight>0)),_this.vs.views.forEach(view=>totalHeight+=view.element.div.offsetHeight),_this.linksWrapper.css({overflow:"clip",opacity:1}),_this.state.linksHeight=totalHeight}_this.state.linksHeight=0,_this.state.isOpen=!1,_this.state.animated=!1,_this.state.isMobile=Stage.width<769,_this.titleWrapper.click(_=>{Stage.width>769||(_this.state.isOpen=!_this.state.isOpen)}),_this.element.bind("keydown",e=>{"Enter"===e.key&&(_this.state.isOpen=!_this.state.isOpen)}),_this.bind(_this.state,"isMobile",isMobile=>{isMobile||(_this.state.isOpen=!0)}),_this.bind(_this.state,"isOpen",async isOpen=>{await resize(),_this.element.classList().toggle("isOpen",_this.state.isOpen),_this.element.div.style.setProperty("--links-height",_this.state.isOpen?1.5*_this.state.linksHeight+"px":"0px"),_this.linksWrapper.attr("aria-hidden",isOpen?"false":"true"),_this.element.attr("aria-expanded",isOpen?"true":"false"),_this.element.attr("tabindex",0),await async function viewStateReady(vs,data){return _this.wait(_=>vs.views.length===data.length)}(_this.vs,_this.data.links),_this.vs.views.forEach(view=>{view.element.attr("tabindex",isOpen?0:-1),view.element.attr("aria-hidden",isOpen?"false":"true")})}),_this.bind(_this.data,"title",title=>{_this.title.text(title)}),_this.onResize(_=>Utils.debounce(resize,100),!0),_this.onInView=()=>{_this.state.animated||(_this.state.animated=!0,_this.animateText(_this.title,400,!0))},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FooterListLinks"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FooterListSmallLink(_data,_index,_params){const _this=this;Inherit(_this,Link),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="FooterListSmallLink",_this.contexts="Link,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;"download"===_this.data._type?_this.button=_this.initClass(Downloadable,AppState.createLocal({asset:_this.data.asset,title:_this.data.title,useExternalLink:_this.data.useExternalLink,useIcon:_this.data.useIcon})):_this.setupLink(_this.data),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FooterListSmallLink"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FormComponent(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="FormComponent",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"formContainer",children:[{_type:"div",refName:"inputsList",children:[]},{id:"send-form",click:"$openForm",role:"button",_type:"button",refName:"button",children:[{_type:"span",_innerText:"$data.submitButtonText",refName:"unnamed",children:[]},{id:"top-right-arrow",_type:"Sprite",refName:"icon",children:[]}]},{_type:"p",_innerText:"$data.formError",refName:"formInvalid",children:[]}]},{_type:"div",refName:"formConfirmation",children:[{_type:"h3",_innerText:"$data.confirmationTitle",refName:"confirmationTitle",children:[]},{_type:"p",_innerText:"$data.confirmationText",refName:"confirmationText",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function submitForm(){let isFormValid=!0;const formData={};_this.params.formId&&(formData.formId=_this.params.formId.current),formData.fields=[],_this.formInputs.forEach(input=>{const validationResult=input.validate();if("checkboxField"!==input.params.type)if(validationResult.isValid){let formLabel=SanityUtils.richTextToPlainText(input.params.label).toLowerCase().split(" ").join("_"),fieldObject={};fieldObject[input.params.id||formLabel]=input.getValue(),formData.fields.push(fieldObject)}else isFormValid=!1}),isFormValid?function sendFormData(formData){fetch(_this.data.formEndpoint,{method:"POST",headers:{"content-type":"application/json",accept:"application/json"},body:JSON.stringify(formData)}).then(response=>{if(!response.ok)throw _this.formInvalid.css({display:"block"}),_this.formInvalid.text("Error submitting form. Please try again later."),new Error(`Network response was not ok: ${response.status} ${response.statusText}`);{_this.formContainer.hide(),_this.formConfirmation.css({display:"block"}),function clearForm(){_this.formInputs.forEach(input=>{input.clearValue(),input.clearError()})}();const formId=formData.formId||"unknown";MixpanelAnalytics.track(`form_${formId}_submit`,{formId:formId})}return response.json()}).then(data=>{}).catch(error=>{console.error("Error submitting form:",error)})}(formData):_this.formInvalid.css({display:"block"})}_this.formInputs=[],_this.data=AppState.createLocal(_this.params.data),_this.state.formStructure=_this.data.inputsList?_this.data:_this.data.form,_this.button.bind("click",submitForm),_this.onMounted=()=>{const formId=_this.params.formId?.current||"unknown";MixpanelAnalytics.track(`form_${formId}_view`)},_this.state.formStructure.inputsList.forEach((input,index)=>{const formInput=_this.createFragment(FormInput,{type:input.inputType,id:input.id,label:input.label,placeholder:input.placeholder,isRequired:input.isRequired,errorMessage:input.errorMessage,textType:input.textType,checkboxesList:input.checkboxesList,buttonText:input.buttonText?input.buttonText:"",limitedFileType:input.limitedFileType?input.limitedFileType:"",index:index,total:_this.state.formStructure.inputsList.length},[_this.inputsList]);"textLine"!==input.inputType&&_this.formInputs.push(formInput)}),_this.showForm=function(){_this.formInvalid.hide(),_this.formConfirmation.hide(),_this.formContainer.show()},_this.submitForm=submitForm,onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FormComponent"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FormInput(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="FormInput",_this.contexts="Element,InView, 0.5",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"inputContainer",children:[{htmlFor:"$state.labelPlainText",clsx:{required:_this.params.isRequired},_type:"label",refName:"unnamed",children:[{content:"$params.label",_type:"RichText",refName:"unnamed",children:[]}]}]},{_type:"p",refName:"errorMessageContainer",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit,countries=(await _this.get("Global/siteSettings")).countries;function validatePhone(e){/[0-9()-]/.test(e.data)||(_this.input.value=_this.input.value.slice(0,-1),e.preventDefault())}function handleTextAreaResize(){let lineHeight,newHeight,numberOfLineBreaks=(_this.input.value.match(/\n/g)||[]).length;0!==numberOfLineBreaks?(lineHeight=parseInt(window.getComputedStyle(_this.input).lineHeight),newHeight=numberOfLineBreaks*lineHeight):newHeight=0,_this.input.value?_this.boxHeightElement.text(_this.input.value):_this.boxHeightElement.text(_this.params.placeholder),_this.input.style.height=`${newHeight+_this.boxHeightElement.div.offsetHeight}px`}_this.state.labelPlainText=SanityUtils.richTextToPlainText(_this.params.label),function createInput(){switch(_this.params.type){case"textField":_this.input=document.createElement("input"),_this.input.type=_this.params.textType,_this.input.placeholder=_this.params.placeholder,_this.input.maxLength=35,"url"===_this.params.textType&&(_this.input.maxLength=2048),"tel"===_this.params.textType&&(_this.input.maxLength=13,_this.input.pattern="/^([0-9]{3})[0-9]{3}-[0-9]{4}/");break;case"checkboxField":_this.input=document.createElement("input"),_this.input.type="checkbox",_this.input.id=_this.state.labelPlainText,_this.inputContainer.classList().add("checkboxContainer");break;case"textAreaField":_this.input=document.createElement("textArea"),_this.input.placeholder=_this.params.placeholder,_this.input.maxLength=2e3,_this.boxHeightElement=_this.inputContainer.create("box-height","div"),_this.boxHeightElement.text(_this.params.placeholder),_this.input.addEventListener("input",handleTextAreaResize);break;case"textLine":_this.element.css({"margin-bottom":"1rem"}),_this.inputContainer.css({border:"none"});break;case"selectField":_this.input=_this.createFragment(MultiSelect,{placeholder:"Please select",singleSelect:!0},[_this.inputContainer]);const selectData=_this.params.checkboxesList.map(checkbox=>({value:checkbox.checkbox,label:checkbox.checkbox,id:checkbox.checkboxId}));_this.input.setOptions(selectData);break;case"multiSelectField":_this.input=_this.createFragment(MultiSelect,{placeholder:"Select all that apply",singleSelect:!1},[_this.inputContainer]);const multiSelectData=_this.params.checkboxesList.map(checkbox=>({value:checkbox.checkbox,label:checkbox.checkbox,id:checkbox.checkboxId}));_this.input.setOptions(multiSelectData);break;case"singleSelectField":_this.input=_this.createFragment(SingleSelect,{label:_this.state.labelPlainText,options:_this.params.checkboxesList.map(checkbox=>({value:checkbox.checkbox,label:checkbox.checkbox,id:checkbox.checkboxId}))},[_this.inputContainer]);break;case"fileUpload":_this.input=_this.createFragment(FileUpload,{buttonText:_this.params.buttonText,label:_this.state.labelPlainText,limitedFileType:_this.params.limitedFileType},[_this.inputContainer]);break;case"countrySelect":_this.input=_this.createFragment(MultiSelect,{placeholder:"Please select",singleSelect:!0},[_this.inputContainer]);let globalCountries=countries.map(country=>({value:country.checkbox,label:country.checkbox}));_this.input.setOptions(globalCountries)}_this.input&&(_this.input.name=_this.state.labelPlainText,_this.input.required=_this.params.isRequired,_this.inputContainer.add(_this.input),"tel"===_this.params.textType&&_this.input.addEventListener("input",validatePhone))}(),_this.element.transform({x:"-10%"}).css({opacity:0,zIndex:_this.params.total-_this.params.index,position:"relative"}),_this.onMounted=()=>{!function boxHeightInit(){_this.boxHeightElement&&_this.boxHeightElement.onResize(e=>{0!==e.borderBoxSize[0].inlineSize&&handleTextAreaResize()})}()},_this.clearError=function(){_this.errorMessageContainer.text(""),_this.errorMessageContainer.hide(),_this.inputContainer.classList().remove("notValid")},_this.clearValue=function(){"selectField"===_this.params.type?_this.input.setValue([]):"checkboxField"===_this.params.type?_this.input.checked=!1:_this.input&&(_this.input.value="")},_this.getValue=function(){return"selectField"===_this.params.type||"countrySelect"===_this.params.type||"singleSelectField"===_this.params.type||"multiSelectField"===_this.params.type||"fileUpload"===_this.params.type?_this.input.getValue():_this.input.value},_this.validate=function(){_this.clearError();const value=_this.getValue();let isValid=!0,errorMessage=_this.params.errorMessage||"This field is required.";const isRequiredButEmpty=_this.params.isRequired&&(Array.isArray(value)&&0===value.length||!value),isRequiredButUnchecked=_this.params.isRequired&&"checkboxField"===_this.params.type&&!_this.input.checked,isInvalidEmail="email"===_this.params.textType&&value&&!TextUtils.validateEmail(value),isInvalidMonth="month"===_this.params.textType&&value&&!TextUtils.validateMonth(value),isInvalidPhone="tel"===_this.params.textType&&value&&!TextUtils.validatePhone(value),isInvalidLinkedIn="url"===_this.params.textType&&value&&!TextUtils.validateLinkedIn(value);return(isRequiredButEmpty||isRequiredButUnchecked||isInvalidEmail||isInvalidMonth||isInvalidPhone||isInvalidLinkedIn)&&(isValid=!1,isInvalidEmail&&(errorMessage="Please enter a valid email address."),isInvalidMonth&&(errorMessage="Please enter a valid month."),isInvalidPhone&&(errorMessage="Please enter a valid phone number."),isInvalidLinkedIn&&(errorMessage="Please enter a valid LinkedIn URL."),function showError(message){_this.errorMessageContainer.text(message),_this.errorMessageContainer.css({display:"block"}),_this.inputContainer.classList().add("notValid")}(errorMessage)),{isValid:isValid,errorMessage:errorMessage}},_this.onInView=()=>{_this.element.tween({x:"0%",opacity:1},800,"easeOutExpo",50*_this.params.index)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FormInput"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FormSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="FormSlice",_this.contexts="ViewStateElement,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"SideModalView",refName:"sideModalView",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onMounted=_=>{_this.formComponent=_this.createFragment(FormComponent,{data:_this.data.form,formId:_this.data.formId},[_this.sideModalView.panel]),_this.bind(_this.data,"backgroundColor",backgroundColor=>{_this.sideModalView.params.panelBgColor=SanityUtils.stegaClean(backgroundColor.hex)})},_this.listen("CtaButton/openForm",({formId:formId})=>{formId===_this.data.formId.current&&(_this.formComponent.showForm(),_this.sideModalView.open())}),_this.listen("ActionButton/openForm",({formId:formId})=>{formId===_this.data.formId.current&&(_this.formComponent.showForm(),_this.sideModalView.open())}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FormSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FourColumnRichText(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="FourColumnRichText",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{class:"column1",content:"$data.column1",_type:"RichText",refName:"unnamed",children:[]},{class:"column2",content:"$data.column2",_type:"RichText",refName:"unnamed",children:[]},{class:"column3",content:"$data.column3",_type:"RichText",refName:"unnamed",children:[]},{class:"column4",content:"$data.column4",_type:"RichText",refName:"unnamed",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FourColumnRichText"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function FourOhFourSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,FXSceneSlice,{sceneLayoutName:"FourOhFour"}),Inherit(_this,TextAnimationHelper),Inherit(_this,XComponent),_this.fragName="FourOhFourSlice",_this.contexts="ViewStateElement,FXSceneSlice, { sceneLayoutName: 'FourOhFour' },TextAnimationHelper",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"p",_innerText:"$data.subtitle",refName:"unnamed",children:[]},{_type:"h1",_innerText:"$data.title",refName:"header",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onInit=async _=>{const requiresFallback=Tests.requiresFallbackGraphics();requiresFallback||_this.useCamera(_this.layers.camera),requiresFallback&&function fallbackInit(){let fallbackVideo=_this.getSync("Global/siteSettings").fallbackVideo404;_this.responsiveVideo=_this.initClass(ResponsiveVideo,AppState.createLocal({videoWithMeta:fallbackVideo,preload:!0,muted:!0,autoplay:!0,loop:!0}),[_this.element]),_this.video=_this.responsiveVideo.video}(),await defer(),_this.animateText(_this.header,400,!0)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"FourOhFourSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function GlobeScene(_params,...restArgs){const _this=this;Inherit(_this,Frag3D,_params?.sceneLayoutName||"GlobeScene"),Inherit(_this,XComponent),_this.fragName="GlobeScene",_this.contexts='Frag3D, _params?.sceneLayoutName || "GlobeScene"',_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"GlobeScene"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function GridOverlay(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="GridOverlay",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;if(_this.showGrid=!1,_this.colsCount=12,_this.showGrid=_this.showGrid||Utils.query("uigrid"),_this.showGrid||_this.element.hide(),!Hydra.LOCAL)return defer(_=>_this.destroy());_this.events.sub(Keyboard.DOWN,function onKeyDown(e){"KeyG"===e.code&&(_this.showGrid=!_this.showGrid,_this.showGrid?_this.element.show():_this.element.hide())});for(let i=0;i<_this.colsCount;i++){let gridItem=document.createElement("div");_this.element.add(gridItem)}onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"GridOverlay"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function Header(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="Header",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"HeaderDesktop",refName:"unnamed",children:[]},{_type:"HeaderMobile",refName:"unnamed",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onInit=async _=>{await defer(),Stage.add(_this.element,Container.instance().element)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"Header"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HeaderController(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="HeaderController",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onMounted=()=>{_this.bind("ViewController/HeaderType",async headerType=>{switch(headerType){case"main":_this.header&&_this.header.destroy(),_this.header=_this.initClass(Header);break;case"book":_this.header&&_this.header.destroy(),_this.header=_this.initClass(BookHeader)}})},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HeaderController"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HeaderDesktop(_params,...restArgs){const _this=this;Inherit(_this,Element,"nav"),Inherit(_this,TextAnimationHelper),Inherit(_this,XComponent),_this.fragName="HeaderDesktop",_this.contexts="Element, 'nav',TextAnimationHelper",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"navOverlay",children:[]},{_type:"div",refName:"navWrapper",children:[{className:"top-nav",_type:"div",refName:"mainNav",children:[{className:"left-wrapper",_type:"div",refName:"unnamed",children:[{href:"/","data-path":"/","aria-label":"Anduril Homepage",_type:"a",refName:"home",children:[{role:"img",viewBox:"0 0 100 19",fill:"none",xmlns:"http://www.w3.org/2000/svg",_type:"svg",refName:"unnamed",children:[{_type:"title",_innerText:"Anduril Logo",refName:"unnamed",children:[]},{d:"M30.5504 2.55978L35.3712 15.8877H32.7057L31.6856 13.0207H26.3712L25.3511 15.8877H22.735L27.5394 2.55978H30.5504ZM27.2103 10.7169H30.8465L29.0202 5.59739L27.2103 10.7169ZM47.4809 15.9048H45.1938L39.1719 6.70662V15.9048H36.6381V2.57684H39.3035L44.947 11.3142V2.55978H47.4809V15.9048ZM49.735 2.55978H54.1609C58.2085 2.55978 60.6765 5.17075 60.6765 9.23227C60.6765 13.2938 58.2085 15.9048 54.1609 15.9048H49.735V2.55978ZM54.1609 13.5668C56.6454 13.5668 58.0768 11.8603 58.0768 9.24934C58.0768 6.60423 56.6454 4.91478 54.1445 4.91478H52.3181V13.5668H54.1609ZM62.1079 10.5804V2.57684H64.7569V10.478C64.7569 12.7306 65.8099 13.6863 67.4223 13.6863C69.0348 13.6863 70.0878 12.7136 70.0878 10.478V2.57684H72.7203V10.5804C72.7203 14.2665 70.5814 16.0925 67.4059 16.0925C64.2304 16.0925 62.1079 14.2494 62.1079 10.5804ZM77.3931 15.9048H74.7605V2.57684H80.0256C82.9872 2.57684 84.83 4.02739 84.83 6.77488C84.83 8.78858 83.777 10.1538 81.9671 10.6999L85.1755 15.9218H82.1646L79.203 10.9559H77.4095V15.9048H77.3931ZM79.894 8.66912C81.4406 8.66912 82.2139 7.96945 82.2139 6.79195C82.2139 5.58032 81.4241 4.89771 79.894 4.89771H77.4095V8.66912H79.894ZM89.2066 15.9048H86.5741V2.57684H89.223L89.2066 15.9048ZM91.4442 2.55978H94.0932V13.5327H100V15.9048H91.4607L91.4442 2.55978ZM19.5266 12.1163C19.2633 11.9798 19.0165 11.8432 18.7862 11.6897C17.9635 11.1948 17.2067 10.5975 16.5156 9.93195C16.2853 9.7101 16.0385 9.47118 15.8246 9.21521C13.8337 6.9626 12.6491 4.07858 12.4681 1.02391L12.4352 0.221848V0.153586C12.4352 0.0682598 12.3858 0 12.3036 0H7.23594C7.15367 0 7.10431 0.0682598 7.10431 0.153586V0.221848L7.0714 1.02391C6.89042 4.02739 5.73868 6.89434 3.78073 9.12988C3.56684 9.38586 3.32004 9.62477 3.08969 9.86369C2.39865 10.5463 1.64179 11.1436 0.819125 11.6555C0.572324 11.8091 0.325524 11.9456 0.0787231 12.0822C0.0129097 12.1163 -0.0199973 12.2016 0.0129094 12.2699C0.128083 12.5429 0.243256 12.7989 0.35843 13.0378C0.802671 13.9252 1.36209 14.7443 2.02022 15.4781C2.21766 15.7 2.43155 15.9048 2.62899 16.1096C6.67652 19.9492 12.8794 19.9663 16.9434 16.1437C17.1573 15.9389 17.3712 15.7171 17.5522 15.5123C18.2103 14.7785 18.7697 13.9593 19.2304 13.0719C19.3621 12.816 19.4772 12.56 19.576 12.304C19.6253 12.2187 19.5924 12.1334 19.5266 12.1163ZM4.25788 15.6829C4.25788 15.8024 4.1427 15.8706 4.04398 15.8024C3.87945 15.6829 3.73137 15.5464 3.58329 15.4099C3.35294 15.2051 3.1555 15.0003 2.97451 14.8126C2.38219 14.1812 1.87214 13.4644 1.46081 12.6794C1.4279 12.6112 1.44435 12.5429 1.51017 12.4917C2.23411 12.031 2.92515 11.5019 3.56684 10.9047C3.79718 10.6999 4.02753 10.461 4.24142 10.2391C5.96903 8.41314 7.18658 6.14347 7.76244 3.66902C7.76244 3.4813 8.0257 3.4813 8.0257 3.66902C8.2725 4.94891 8.63447 6.21173 9.14453 7.4063C9.16098 7.44043 9.16098 7.49162 9.14453 7.52575C8.28895 9.38586 7.12076 11.0753 5.67287 12.5088C5.45897 12.7136 5.24508 12.9184 5.06409 13.1402C4.66921 13.618 4.40596 14.1982 4.29078 14.8297C4.25788 15.0344 4.24142 15.2392 4.24142 15.444L4.25788 15.6829ZM12.8301 13.0378C12.8959 13.1061 12.8794 13.2085 12.7972 13.2597C11.9087 13.8057 10.8721 14.0959 9.83557 14.1129H9.80266C8.73319 14.1129 7.68018 13.8057 6.75879 13.2255C6.69298 13.1743 6.67652 13.0719 6.72588 13.0207C6.98913 12.7477 7.25239 12.4576 7.49919 12.1675C8.32186 11.1948 9.04581 10.1367 9.65458 8.99336C9.70394 8.90803 9.83557 8.90803 9.88493 8.99336C10.6747 10.461 11.6619 11.8262 12.8301 13.0378ZM5.73868 14.0788C5.77159 14.0105 5.87031 13.9935 5.91967 14.0447C7.0714 14.8467 8.42058 15.2734 9.80266 15.2734L10.1153 15.2563C10.395 15.2392 10.6747 15.2051 10.9379 15.171C11.9251 15.0003 12.863 14.6078 13.7021 14.0447C13.7515 14.0105 13.8173 14.0105 13.8666 14.0617C14.4425 14.5737 15.0677 15.0515 15.7094 15.4781C15.7917 15.5293 15.7917 15.6488 15.7094 15.7C14.0476 17.0652 12.0074 17.8161 9.90138 17.8331H9.81911C9.39133 17.8331 8.94709 17.799 8.5193 17.7478C7.58146 17.6113 6.67652 17.3382 5.82095 16.9287C5.80449 16.9116 5.78804 16.8945 5.77159 16.8775C5.19572 16.0413 5.17926 14.915 5.73868 14.0788ZM14.5248 13.1573L13.8831 12.56C12.4023 11.0924 11.1847 9.35173 10.3127 7.42336C10.1482 7.06499 10.0001 6.70662 9.86847 6.34825C9.27615 4.74412 8.91418 3.03761 8.81546 1.33109C8.79901 1.24576 8.86482 1.1775 8.94709 1.1775H11.2341C11.2999 1.1775 11.3657 1.22869 11.3822 1.31402L11.448 2.08195C11.8429 5.20489 13.2085 8.10597 15.3474 10.3415C15.5613 10.5634 15.7917 10.7852 16.022 11.0071C16.6637 11.6043 17.3548 12.1163 18.0787 12.5771C18.1445 12.6112 18.161 12.6965 18.1281 12.7648C17.7496 13.4644 17.2889 14.13 16.7624 14.7273C16.7131 14.7785 16.6473 14.7955 16.5979 14.7614C15.874 14.2494 15.1829 13.7375 14.5248 13.1573Z",fill:"currentColor",_type:"path",refName:"unnamed",children:[]}]}]}]},{className:"center-wrapper",_type:"div",refName:"centerWrapper",children:[{view:"$determineLink",data:"$data",_type:"ViewState",refName:"domainItems",children:[]}]},{className:"right-wrapper",_type:"div",refName:"unnamed",children:[{className:"right-wrapper-inner",_type:"div",refName:"unnamed",children:[{tabIndex:0,_type:"span",_innerText:"Search",refName:"searchLink",children:[]},{className:"company-wrapper",tabIndex:0,_type:"div",refName:"companyLink",children:[{_type:"span",_innerText:"Company",refName:"companyLinkText",children:[]},{"aria-hidden":!0,_type:"span",_innerText:"Company",refName:"companyLinkTextHidden",children:[]},{className:"plus-sign",_type:"div",refName:"unnamed",children:[{_type:"div",refName:"unnamed",children:[]},{_type:"div",refName:"unnamed",children:[]}]}]}]}]}]},{_type:"div",refName:"menuWrapper",children:[{className:"domains",_type:"div",refName:"domainWrapper",children:[{view:"HeaderDomainWrapper",data:"$data",_type:"ViewState",refName:"domainWrapperItems",children:[]}]},{className:"search",_type:"div",refName:"searchWrapper",children:[{_type:"SearchDomainWrapper",refName:"sdw",children:[]}]},{className:"company",_type:"div",refName:"companyWrapper",children:[{_type:"CompanyDomainWrapper",refName:"cdw",children:[]}]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.determineLink=data=>{switch(data._type){case"externalLink":case"internalLink":return HeaderLink;case"menuSection":return HeaderDomainLink}};let settings=await _this.get("Global/siteSettings");function handleExit(e,force=!1){if(!force){let target=e.toElement?e.toElement:e.target;for(;target&&target.parentElement;){if(target===_this.element.div)return;target=target.parentElement}}_this.state.linkHovered=!1,updateDomain(null)}function resize(){_this.height=_this.navWrapper.div.offsetHeight}function highlightDomain(domain){_this.domains.map(labelDomain=>{domain&&labelDomain.attr("data-domain")!==domain.attr("data-domain")&&labelDomain.attr("data-domain")!==_this.state.focusedDomain?labelDomain.tween({opacity:.5},500,"easeOutCubic"):labelDomain.tween({opacity:1},domain?150:500,"easeOutCubic",domain?0:150)})}function updateDomain(domainOrNumber){_this.state.focusedDomain=domainOrNumber?domainOrNumber.attr("data-domain"):domainOrNumber,_this.domains.map(labelDomain=>{_this.state.focusedDomain&&labelDomain.attr("data-domain")!==_this.state.focusedDomain?labelDomain.tween({opacity:1},500,"easeOutCubic"):labelDomain.tween({opacity:_this.state.focusedDomain?.5:1},150,"easeOutCubic")})}function hoverCompany(e){"over"===e.action&&(_this.state.linkHovered=!0,highlightDomain(!1),updateDomain(0),_this.state.companyHover=!0)}function hoverSearch(e){"over"===e.action&&(_this.state.linkHovered=!0,highlightDomain(!1),updateDomain(0),_this.state.searchHover=!0)}function handleNavOnScroll(lenis){lenis.isStopped||(_this.state.hasScrolled=lenis.animatedScroll>30)}function updateNavState(){_this.state.linkHovered||_this.state.hasScrolled?_this.state.showFrosted=!0:_this.state.showFrosted=!1}function handleFrosted(showFrosted){if(showFrosted)switch(SanityUtils.stegaClean(_this.state.navColorMode)){case"dark":case"light":case"frosted-white":_this.element.css({color:"#010101"}),tween(_this.state,{frosted:1,backgroundOpacity:.5},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(255, 255, 255, var(--backgroundOpacity))");break;case"solid-black":_this.element.css({color:"#FFFFFF"}),tween(_this.state,{frosted:1,backgroundOpacity:1},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(0, 0, 0, var(--backgroundOpacity))")}else switch(SanityUtils.stegaClean(_this.state.navColorMode)){case"dark":_this.element.css({color:"#010101"}),tween(_this.state,{frosted:0,backgroundOpacity:0},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(255, 255, 255, var(--backgroundOpacity))");break;case"solid-black":_this.element.css({color:"#FFFFFF"}),tween(_this.state,{frosted:1,backgroundOpacity:1},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(0, 0, 0, var(--backgroundOpacity))");break;case"light":_this.element.css({color:"#FFFFFF"}),tween(_this.state,{frosted:0,backgroundOpacity:0},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(255, 255, 255, var(--backgroundOpacity))");break;case"frosted-white":_this.element.css({color:"#010101"}),tween(_this.state,{frosted:1,backgroundOpacity:.5},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(255, 255, 255, var(--backgroundOpacity))")}}_this.data=settings.menuSections,_this.navOverlay.hide(),_this.state.hasScrolled=!1,_this.state.linkHovered=!1,_this.state.showFrosted=!1,_this.state.frosted=0,_this.state.backgroundOpacity=0,_this.bind("ViewController/transitioning",transitioning=>{1===transitioning&&(_this.state.hasScrolled=!1,_this.state.linkHovered=!1)}),await Promise.all([_this.wait(_=>_this.domainItems&&_this.domainItems.views.length==_this.data.length),_this.wait(_=>_this.domainWrapperItems&&_this.domainWrapperItems.views.length==_this.data.length)]),_this.sections=[_this.domainWrapper,_this.searchWrapper,_this.companyWrapper],_this.domains=[..._this.domainItems.views.map(item=>item.element)],_this.domainWrappers=[..._this.domainWrapperItems.views.map(wrapper=>wrapper.element)],_this.sections.map(section=>section.hide()),_this.domainWrappers.map(wrapper=>wrapper.hide()),_this.element.bind("mouseleave",handleExit),Stage.bind(Device.mobile?"touchend":"mouseup",handleExit),Global.lenis.on("scroll",handleNavOnScroll),window.addEventListener("keyup",async function handleFocusTrap(e){if("Tab"!==e.key||!_this.element?.div)return;_this.element.div.contains(document.activeElement)?_this.centerWrapper.div.contains(document.activeElement)||_this.domainWrapper.div.contains(document.activeElement)?_this.state.setTabOrder=!0:_this.state.setTabOrder=!1:(_this.state.setTabOrder=!1,handleExit(null,!0))},!1),_this.bind("ViewController/transitionBegin",_=>{handleExit(null,!0),handleFrosted(!1)}),_this._bindOnDestroy(()=>{Stage.unbind(Device.mobile?"touchend":"mouseup",handleExit),Global.lenis.off("scroll",handleNavOnScroll),_this.domainWrappers.forEach(wrapper=>{wrapper._resizeHandler&&(wrapper.offResize(wrapper._resizeHandler),wrapper._resizeHandler=null)})}),_this.state.focusedDomain=null,_this.bind(_this.state,"focusedDomain",_=>{_this.state.companyHover=!1,_this.state.searchHover=!1,_this.state.focusedDomain?(_this.element.classList().add("isOpen"),_this.domainWrappers.map(wrapper=>{wrapper.attr("data-domain")===_this.state.focusedDomain?wrapper.css({display:"grid",opacity:0,position:"absolute"}).tween({opacity:1},500,"easeOutCubic",100):wrapper.css({position:"absolute"}).tween({opacity:0},500,"easeOutCubic").onComplete(_=>{wrapper.hide()})}),_this.flag("isDomainsOpen")||_this.flag("isDomainsOpen",!0),async function tweenDomainHeight(){_this.domainWrapper.css({height:0,display:"grid"}),_this.domainWrappers.forEach(wrapper=>{wrapper._resizeHandler&&(wrapper.offResize(wrapper._resizeHandler),wrapper._resizeHandler=null)});const focusedWrapper=_this.domainWrappers.find(wrapper=>wrapper.attr("data-domain")===_this.state.focusedDomain);if(!focusedWrapper)return;await _this.wait(_=>(focusedWrapper.css({display:"grid"}),focusedWrapper.div.offsetHeight>0));const updateHeight=()=>{const domainHeight=focusedWrapper.div.offsetHeight;_this.menuWrapper.attr("aria-hidden","false"),_this.menuWrapper.tween({height:domainHeight},500,"easeOutCubic").onComplete(_=>{resize()}),_this.domainWrapper.tween({height:domainHeight},500,"easeOutCubic").onComplete(_=>{resize()})};focusedWrapper._resizeHandler=e=>{0!==e.borderBoxSize[0].inlineSize&&updateHeight()},focusedWrapper.onResize(focusedWrapper._resizeHandler),updateHeight()}()):(_this.element.classList().remove("isOpen"),_this.flag("isDomainsOpen")&&(_this.domainWrappers.map(wrapper=>{wrapper.css({position:"absolute"}).tween({opacity:0},500,"easeOutCubic").onComplete(_=>{wrapper.hide()})}),_this.menuWrapper.tween({height:0},500,"easeOutCubic").onComplete(_=>{_this.menuWrapper.attr("aria-hidden","true"),resize()}),_this.domainWrapper.tween({height:0},500,"easeOutCubic").onComplete(_=>{_this.domainWrapper.hide(),resize()}),_this.flag("isDomainsOpen",!1)))}),_this.domains.map(domain=>{function hover({action:action}){switch(action){case"over":highlightDomain(domain),updateDomain(domain),_this.state.linkHovered=!0;break;case"out":highlightDomain(!1)}}domain.bind("focus",_=>hover({action:"over"})),domain.bind("blur",_=>hover({action:"out"})),domain.hover(hover),domain.click(function click(){})}),_this.state.companyHover=!1,_this.companyLink.bind("focus",_=>hoverCompany({action:"over"})),_this.companyLink.bind("blur",_=>hoverCompany({action:"out"})),_this.companyLink.hover(hoverCompany),_this.state.searchHover=!1,_this.searchLink.bind("focus",_=>hoverSearch({action:"over"})),_this.searchLink.bind("blur",_=>hoverSearch({action:"out"})),_this.searchLink.hover(hoverSearch),_this.bind(_this.state,"companyHover",async _=>{if(_this.state.companyHover){_this.state.searchHover=!1,_this.companyWrapper.css({display:"block",height:"unset",opacity:0}),_this.element.classList().add("isOpen"),_this.element.classList().add("isCompanyOpen"),await _this.wait(_=>_this.companyWrapper.div.offsetHeight>0);let companyHeight=_this.companyWrapper.div.offsetHeight;_this.companyWrapper.css({height:companyHeight,opacity:0,position:"absolute",top:0,left:0}).tween({opacity:1},500,"easeOutCubic",100).onComplete(_=>{resize()}),_this.menuWrapper.attr("aria-hidden","false"),_this.menuWrapper.tween({height:companyHeight,opacity:1},500,"easeOutCubic")}else _this.element.classList().remove("isCompanyOpen"),_this.menuWrapper.tween({height:0},500,"easeOutCubic"),_this.companyWrapper.css({height:0}),_this.companyWrapper.tween({opacity:0},1e3,"easeOutCubic").onComplete(_=>{_this.menuWrapper.attr("aria-hidden","true"),_this.companyWrapper.hide(),resize()})}),_this.bind(_this.state,"searchHover",async _=>{if(_this.state.searchHover){_this.state.companyHover=!1,_this.searchWrapper.css({display:"block",height:"unset"}),_this.element.classList().add("isOpen"),await _this.wait(_=>_this.searchWrapper.div.offsetHeight>0);let searchHeight=_this.searchWrapper.div.offsetHeight+60;_this.searchWrapper.css({height:searchHeight,opacity:0,position:"absolute",top:0,left:0}).tween({opacity:1},500,"easeOutCubic",100).onComplete(_=>{resize(),_this.sdw.focus()}),_this.menuWrapper.attr("aria-hidden","false"),_this.menuWrapper.tween({height:searchHeight,opacity:1},500,"easeOutCubic")}else _this.element.classList().remove("isSearchOpen"),_this.menuWrapper.tween({height:0},500,"easeOutCubic"),_this.searchWrapper.css({height:0}),_this.searchWrapper.tween({opacity:0},500,"easeOutCubic").onComplete(_=>{_this.menuWrapper.attr("aria-hidden","true"),_this.searchWrapper.hide(),resize()})}),_this.bind(_this.sdw.state,"height",_=>{_this.state.searchHover&&_this.searchWrapper.tween({height:_this.sdw.state.height,opacity:_this.state.searchHover?1:0},200,"easeOutCubic").onComplete(_=>{resize()})}),_this.onResize(resize),_this.bind("ViewController/navState",navState=>{_this.state.navColorMode=navState,function updateNavColorMode(navState){switch(SanityUtils.stegaClean(navState)){case"dark":_this.element.css({color:"#010101"}),tween(_this.state,{frosted:0,backgroundOpacity:0},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(255, 255, 255, var(--backgroundOpacity))");break;case"solid-black":_this.element.css({color:"#FFFFFF"}),tween(_this.state,{frosted:1,backgroundOpacity:1},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(0, 0, 0, var(--backgroundOpacity))");break;case"light":_this.element.css({color:"#FFFFFF"}),tween(_this.state,{frosted:0,backgroundOpacity:0},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(255, 255, 255, var(--backgroundOpacity))");break;case"frosted-white":_this.element.css({color:"#010101"}),tween(_this.state,{frosted:1,backgroundOpacity:.5},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(255, 255, 255, var(--backgroundOpacity))")}}(navState)}),_this.listen("ViewController/transitionMidway",_=>{tween(_this.state,{frosted:0,backgroundOpacity:0},1,"easeOutCubic")}),_this.listen("ViewController/transitionComplete",_=>{_this.state.set("showFrosted",!1),_this.state.set("hasScrolled",!1),_this.state.set("linkHovered",!1),_this.events.fire(Events.RESIZE),handleFrosted(!1)}),_this.bind(_this.state,"linkHovered",updateNavState),_this.bind(_this.state,"hasScrolled",updateNavState),_this.bind(_this.state,"showFrosted",handleFrosted),_this.bind(_this.state,"linkHovered",hovered=>{hovered?(_this.navOverlay.show(),_this.navOverlay.css({opacity:0}).tween({opacity:1},600,"easeOutCubic")):_this.navOverlay.css({opacity:.5}).tween({opacity:0},300,"easeOutCubic").onComplete(_=>{_this.navOverlay.hide()})}),_this.navWrapper.y=0;let previousScroll=0;_this.startRender(_=>{if(_this.element.div.style.setProperty("--backgroundOpacity",_this.state.backgroundOpacity),_this.element.div.style.setProperty("--frosted",_this.state.frosted),!Global.lenis)return;if(_this.getSync("ViewController/transitioning"))return;let currentScroll=Math.max(0,Global.lenis.scroll);if(currentScroll===previousScroll)return;0===_this.height&&resize();let delta=currentScroll-previousScroll;delta>0&&(delta/=2),_this.navWrapper.y-=delta,_this.navWrapper.y=Math.max(-_this.height,_this.navWrapper.y),_this.navWrapper.y=Math.min(0,_this.navWrapper.y),_this.navWrapper.transform(),previousScroll=currentScroll}),_this.bind(_this.state,"setTabOrder",function handleTabOrder(isOpen){let currTabIndex=0;isOpen?(currTabIndex++,_this.home.attr("tabindex",currTabIndex),currTabIndex++,_this.domainItems.views.forEach(item=>{let links=_this.domainWrapperItems.views.find(wrapper=>wrapper.data._key===item.data._key).element.div.querySelectorAll("a");item.element.attr("tabindex",currTabIndex),currTabIndex++;for(let i=0;i<links.length;i++)links[i].setAttribute("tabindex",currTabIndex),currTabIndex++})):(_this.home.attr("tabindex",currTabIndex),_this.domainItems.views.forEach(item=>{let links=_this.domainWrapperItems.views.find(wrapper=>wrapper.data._key===item.data._key).element.div.querySelectorAll("a");item.element.attr("tabindex",currTabIndex);for(let i=0;i<links.length;i++)links[i].setAttribute("tabindex",currTabIndex)}))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HeaderDesktop"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HeaderDomainLink(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,TextAnimationHelper),Inherit(_this,XComponent),_this.fragName="HeaderDomainLink",_this.contexts="ViewStateElement,Element,TextAnimationHelper",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"span",_innerText:"$data.title",refName:"name",children:[]},{"aria-hidden":!0,_type:"span",_innerText:"$data.title",refName:"hiddenName",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit,linkLength=_this.getSync("Global/siteSettings").menuSections.length;function handleOver(){_this.state.isHovered||(_this.state.isHovered=!0,_this.set("hoveredLinkCount",_this.getSync("hoveredLinkCount")+1))}_this.set("allLinksHovered",!1),_this.state.isHovered=!1,_this.set("hoveredLinkCount",0),_this.bind(_this.data,"title",title=>{_this.element.attr("data-domain",title),_this.element.attr("aria-label",title),_this.element.attr("role","link")}),_this.element.attr("tabIndex",0),_this.element.bind("mouseenter",handleOver),_this.element.bind("focus",handleOver),_this.bind("hoveredLinkCount",count=>{count>=linkLength-1&&_this.set("allLinksHovered",!0)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HeaderDomainLink"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HeaderDomainWrapper(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,Element),Inherit(_this,InView),Inherit(_this,XComponent),_this.fragName="HeaderDomainWrapper",_this.contexts="ViewStateElement,TextAnimationHelper,Element,InView",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"column-1",_type:"div",refName:"col1",children:[{"aria-level":3,className:"label",_type:"h3",_innerText:"$data.descriptionTitle",refName:"descriptionTitle",children:[]},{className:"content",_type:"div",refName:"unnamed",children:[{className:"description",_type:"div",_innerText:"$data.description",refName:"unnamed",children:[]}]}]},{className:"column-2",_type:"div",refName:"col2",children:[{role:"heading","aria-level":3,className:"label",_type:"h3",refName:"title",children:[]},{className:"content",_type:"div",refName:"links",children:[]},{className:"center-wrapper",_type:"div",refName:"centerWrapper",children:[{view:"HeaderDomainLink",data:"$headerDomainItems",_type:"ViewState",refName:"domainItems",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.headerDomainItems=new StateArray,_this.headerDomainItems.setFilter(item=>"menuSection"===item._type,!1);let settings=await _this.get("Global/siteSettings");_this.bind(settings,"menuSections",data=>{_this.headerDomainItems.refresh(data||[])}),_this.bind(_this.data,"_type",type=>{if("menuSection"===type){_this.data.linkLists[0].links.map(item=>{let link=_this.initClass(Link);link.setupLink(item),_this.links.add(link)}),_this.onMounted=async()=>{!async function setMaxHeight(){await _this.wait("col1"),await _this.wait("col2"),_this.col1.onResize(e=>{if(0===e.borderBoxSize[0].inlineSize)return;let col1Height=_this.col1.div.offsetHeight,col2Height=_this.col2.div.offsetHeight;_this.col1.css({height:`${Math.max(col1Height,col2Height)}px`})}),_this.col2.onResize(e=>{if(0===e.borderBoxSize[0].inlineSize)return;let col1Height=_this.col1.div.offsetHeight,col2Height=_this.col2.div.offsetHeight;_this.col2.css({height:`${Math.max(col1Height,col2Height)}px`})})}(),async function setWidth(){await _this.wait("domainItems"),await async function viewStateReady(vs,data){return _this.wait(_=>vs.views.length===data.length)}(_this.domainItems,_this.headerDomainItems),_this.col2.onResize(e=>{if(0===e.borderBoxSize[0].inlineSize)return;let col2Width=_this.centerWrapper.div.offsetWidth;_this.col2.css({width:`${col2Width}px`})})}()},_this.bind(_this.data,"title",title=>{_this.title.text(title),_this.element.attr("data-domain",title)}),_this.onInView=()=>{!function animateIn(){_this.animateText(_this.title,400,!0),_this.animateText(_this.descriptionTitle,400,!0)}()}}}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HeaderDomainWrapper"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HeaderLink(_data,_index,_params){const _this=this;Inherit(_this,Link),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="HeaderLink",_this.contexts="Link,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.setupLink(_this.data),_this.element.bind("click",()=>{_this.fire("linkClick")}),_this.bind(_this.data,"text",text=>{"Subterranean"===text&&(_this.element.classList().add("subterranean"),_this.element.hide())}),_this.bind("HeaderDomainLink/allLinksHovered",allLinksHovered=>{allLinksHovered&&"Subterranean"===_this.data.text&&(_this.element.show(),_this.element.css({opacity:0}).tween({opacity:1},500,"easeOutCubic"))}),_this.bind("HeaderMobileMenuItem/allLinksClicked",allLinksClicked=>{allLinksClicked&&"Subterranean"===_this.data.text&&(_this.element.show(),_this.element.css({opacity:0}).tween({opacity:1},500,"easeOutCubic"))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HeaderLink"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HeaderListLinks(_data,_index,_params){const _this=this;Inherit(_this,Element),Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,InView),Inherit(_this,XComponent),_this.fragName="HeaderListLinks",_this.contexts="Element,ViewStateElement,TextAnimationHelper,InView",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"title-wrapper",_type:"div",refName:"titleWrapper",children:[{className:"title",_type:"p",refName:"title",children:[]},{className:"plus-sign",_type:"div",refName:"unnamed",children:[{_type:"div",refName:"unnamed",children:[]},{_type:"div",refName:"unnamed",children:[]}]}]},{className:"links-wrapper",_type:"div",refName:"linksWrapper",children:[{view:"FooterListLink",data:"$data.links",_type:"ViewState",refName:"vs",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;async function resize(){let totalHeight=0;_this.linksWrapper.css({overflow:"visible",opacity:0}),await _this.wait(_=>_this.vs.views.every(view=>view?.element?.div?.offsetHeight>0)),_this.vs.views.forEach(view=>totalHeight+=view.element.div.offsetHeight),_this.linksWrapper.css({overflow:"clip",opacity:1}),_this.state.linksHeight=totalHeight}_this.state.linksHeight=0,_this.state.isOpen=!1,_this.titleWrapper.click(_=>{Stage.width>768||(_this.state.isOpen=!_this.state.isOpen)}),_this.bind(_this.state,"isOpen",_=>{_this.element.classList().toggle("isOpen",_this.state.isOpen),_this.element.div.style.setProperty("--links-height",_this.state.isOpen?`${_this.state.linksHeight}px`:"0px")}),_this.onResize(_=>Utils.debounce(resize,100),!0),_this.bind(_this.data,"title",title=>{_this.title.text(title)}),_this.onInView=()=>{_this.animateText(_this.title,400,!0)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HeaderListLinks"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HeaderMobile(_params,...restArgs){const _this=this;Inherit(_this,Element,"nav"),Inherit(_this,TextAnimationHelper),Inherit(_this,XComponent),_this.fragName="HeaderMobile",_this.contexts="Element, 'nav',TextAnimationHelper",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"background",children:[]},{_type:"div",refName:"mainScreen",children:[{className:"nav-bg",_type:"div",refName:"unnamed",children:[{href:"/","data-path":"/","aria-label":"Anduril Homepage",_type:"a",refName:"home",children:[{role:"img",viewBox:"0 0 100 19",fill:"none",xmlns:"http://www.w3.org/2000/svg",_type:"svg",refName:"unnamed",children:[{_type:"title",_innerText:"Anduril Logo",refName:"unnamed",children:[]},{d:"M30.5504 2.55978L35.3712 15.8877H32.7057L31.6856 13.0207H26.3712L25.3511 15.8877H22.735L27.5394 2.55978H30.5504ZM27.2103 10.7169H30.8465L29.0202 5.59739L27.2103 10.7169ZM47.4809 15.9048H45.1938L39.1719 6.70662V15.9048H36.6381V2.57684H39.3035L44.947 11.3142V2.55978H47.4809V15.9048ZM49.735 2.55978H54.1609C58.2085 2.55978 60.6765 5.17075 60.6765 9.23227C60.6765 13.2938 58.2085 15.9048 54.1609 15.9048H49.735V2.55978ZM54.1609 13.5668C56.6454 13.5668 58.0768 11.8603 58.0768 9.24934C58.0768 6.60423 56.6454 4.91478 54.1445 4.91478H52.3181V13.5668H54.1609ZM62.1079 10.5804V2.57684H64.7569V10.478C64.7569 12.7306 65.8099 13.6863 67.4223 13.6863C69.0348 13.6863 70.0878 12.7136 70.0878 10.478V2.57684H72.7203V10.5804C72.7203 14.2665 70.5814 16.0925 67.4059 16.0925C64.2304 16.0925 62.1079 14.2494 62.1079 10.5804ZM77.3931 15.9048H74.7605V2.57684H80.0256C82.9872 2.57684 84.83 4.02739 84.83 6.77488C84.83 8.78858 83.777 10.1538 81.9671 10.6999L85.1755 15.9218H82.1646L79.203 10.9559H77.4095V15.9048H77.3931ZM79.894 8.66912C81.4406 8.66912 82.2139 7.96945 82.2139 6.79195C82.2139 5.58032 81.4241 4.89771 79.894 4.89771H77.4095V8.66912H79.894ZM89.2066 15.9048H86.5741V2.57684H89.223L89.2066 15.9048ZM91.4442 2.55978H94.0932V13.5327H100V15.9048H91.4607L91.4442 2.55978ZM19.5266 12.1163C19.2633 11.9798 19.0165 11.8432 18.7862 11.6897C17.9635 11.1948 17.2067 10.5975 16.5156 9.93195C16.2853 9.7101 16.0385 9.47118 15.8246 9.21521C13.8337 6.9626 12.6491 4.07858 12.4681 1.02391L12.4352 0.221848V0.153586C12.4352 0.0682598 12.3858 0 12.3036 0H7.23594C7.15367 0 7.10431 0.0682598 7.10431 0.153586V0.221848L7.0714 1.02391C6.89042 4.02739 5.73868 6.89434 3.78073 9.12988C3.56684 9.38586 3.32004 9.62477 3.08969 9.86369C2.39865 10.5463 1.64179 11.1436 0.819125 11.6555C0.572324 11.8091 0.325524 11.9456 0.0787231 12.0822C0.0129097 12.1163 -0.0199973 12.2016 0.0129094 12.2699C0.128083 12.5429 0.243256 12.7989 0.35843 13.0378C0.802671 13.9252 1.36209 14.7443 2.02022 15.4781C2.21766 15.7 2.43155 15.9048 2.62899 16.1096C6.67652 19.9492 12.8794 19.9663 16.9434 16.1437C17.1573 15.9389 17.3712 15.7171 17.5522 15.5123C18.2103 14.7785 18.7697 13.9593 19.2304 13.0719C19.3621 12.816 19.4772 12.56 19.576 12.304C19.6253 12.2187 19.5924 12.1334 19.5266 12.1163ZM4.25788 15.6829C4.25788 15.8024 4.1427 15.8706 4.04398 15.8024C3.87945 15.6829 3.73137 15.5464 3.58329 15.4099C3.35294 15.2051 3.1555 15.0003 2.97451 14.8126C2.38219 14.1812 1.87214 13.4644 1.46081 12.6794C1.4279 12.6112 1.44435 12.5429 1.51017 12.4917C2.23411 12.031 2.92515 11.5019 3.56684 10.9047C3.79718 10.6999 4.02753 10.461 4.24142 10.2391C5.96903 8.41314 7.18658 6.14347 7.76244 3.66902C7.76244 3.4813 8.0257 3.4813 8.0257 3.66902C8.2725 4.94891 8.63447 6.21173 9.14453 7.4063C9.16098 7.44043 9.16098 7.49162 9.14453 7.52575C8.28895 9.38586 7.12076 11.0753 5.67287 12.5088C5.45897 12.7136 5.24508 12.9184 5.06409 13.1402C4.66921 13.618 4.40596 14.1982 4.29078 14.8297C4.25788 15.0344 4.24142 15.2392 4.24142 15.444L4.25788 15.6829ZM12.8301 13.0378C12.8959 13.1061 12.8794 13.2085 12.7972 13.2597C11.9087 13.8057 10.8721 14.0959 9.83557 14.1129H9.80266C8.73319 14.1129 7.68018 13.8057 6.75879 13.2255C6.69298 13.1743 6.67652 13.0719 6.72588 13.0207C6.98913 12.7477 7.25239 12.4576 7.49919 12.1675C8.32186 11.1948 9.04581 10.1367 9.65458 8.99336C9.70394 8.90803 9.83557 8.90803 9.88493 8.99336C10.6747 10.461 11.6619 11.8262 12.8301 13.0378ZM5.73868 14.0788C5.77159 14.0105 5.87031 13.9935 5.91967 14.0447C7.0714 14.8467 8.42058 15.2734 9.80266 15.2734L10.1153 15.2563C10.395 15.2392 10.6747 15.2051 10.9379 15.171C11.9251 15.0003 12.863 14.6078 13.7021 14.0447C13.7515 14.0105 13.8173 14.0105 13.8666 14.0617C14.4425 14.5737 15.0677 15.0515 15.7094 15.4781C15.7917 15.5293 15.7917 15.6488 15.7094 15.7C14.0476 17.0652 12.0074 17.8161 9.90138 17.8331H9.81911C9.39133 17.8331 8.94709 17.799 8.5193 17.7478C7.58146 17.6113 6.67652 17.3382 5.82095 16.9287C5.80449 16.9116 5.78804 16.8945 5.77159 16.8775C5.19572 16.0413 5.17926 14.915 5.73868 14.0788ZM14.5248 13.1573L13.8831 12.56C12.4023 11.0924 11.1847 9.35173 10.3127 7.42336C10.1482 7.06499 10.0001 6.70662 9.86847 6.34825C9.27615 4.74412 8.91418 3.03761 8.81546 1.33109C8.79901 1.24576 8.86482 1.1775 8.94709 1.1775H11.2341C11.2999 1.1775 11.3657 1.22869 11.3822 1.31402L11.448 2.08195C11.8429 5.20489 13.2085 8.10597 15.3474 10.3415C15.5613 10.5634 15.7917 10.7852 16.022 11.0071C16.6637 11.6043 17.3548 12.1163 18.0787 12.5771C18.1445 12.6112 18.161 12.6965 18.1281 12.7648C17.7496 13.4644 17.2889 14.13 16.7624 14.7273C16.7131 14.7785 16.6473 14.7955 16.5979 14.7614C15.874 14.2494 15.1829 13.7375 14.5248 13.1573Z",fill:"currentColor",_type:"path",refName:"unnamed",children:[]}]}]},{"aria-label":"Open Mobile Menu",className:"menu-button",role:"button",_type:"button",refName:"menuButton",children:[{id:"hamburger",_type:"Sprite",refName:"unnamed",children:[]}]}]}]},{_type:"div",refName:"menuScreen",children:[{_type:"div",refName:"topWrapper",children:[{"aria-label":"Search within the website",className:"search-button",role:"button",_type:"button",refName:"searchButton",children:[{role:"heading","aria-level":3,_type:"h3",_innerText:"Search",refName:"searchText",children:[]},{id:"chevron-left",_type:"Sprite",refName:"searchBack",children:[]}]},{"aria-label":"Close Mobile Menu",className:"close-button",role:"button",_type:"button",refName:"closeButton1",children:[{id:"close",_type:"Sprite",refName:"unnamed",children:[]}]}]},{_type:"SearchDomainWrapper",refName:"sdw",children:[]},{_type:"div",refName:"contentWrapper",children:[{_type:"div",refName:"topMenuElements",children:[{className:"menu-links",_type:"div",refName:"unnamed",children:[{"aria-label":"Anduril Homepage",href:"/","data-path":"/",_type:"a",_innerText:"Home",refName:"homeButton",children:[]},{view:"$determineLink",data:"$state.mobileLinks",onAddView:"$handleAddMenuItem",_type:"ViewState",refName:"menuLinks",children:[]}]},{className:"contact-container",_type:"div",refName:"unnamed",children:[{role:"heading","aria-level":3,className:"contact-title",_type:"h3",_innerText:"Contact",refName:"contactTitle",children:[]},{className:"contact-email",_type:"Link",refName:"contactLink",children:[]}]},{className:"social-container",_type:"div",refName:"unnamed",children:[{role:"heading","aria-level":3,className:"label",_type:"h3",_innerText:"Socials",refName:"socialTitle",children:[]},{className:"link-container",_type:"div",refName:"unnamed",children:[{view:"HeaderSocialLink",data:"$links",_type:"ViewState",refName:"socialLinks",children:[]}]}]}]}]}]},{_type:"div",refName:"subMenuScreen",children:[{_type:"div",refName:"topWrapperSub",children:[{"aria-label":"Go Back",className:"back-button",role:"button",_type:"button",refName:"backButton",children:[{id:"chevron-left",_type:"Sprite",refName:"unnamed",children:[]}]},{"aria-label":"Close Submenu",className:"close-button",role:"button",_type:"button",refName:"closeButton2",children:[{id:"close",_type:"Sprite",refName:"unnamed",children:[]}]}]},{view:"HeaderMobileSubmenuItem",data:"$state.mobileLinks",_type:"ViewState",refName:"subMenuLinks",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.determineLink=data=>{switch(data._type){case"externalLink":case"internalLink":return HeaderLink;case"menuSection":return HeaderMobileMenuItem}},_this.state.isMenuOpen=!1,_this.state.isSubMenuOpen=!1,_this.state.subMenu=null,_this.state.searchOpen=!1,window.addEventListener("keyup",async function handleFocusTrap(e){if("Tab"!==e.key)return;if(!_this.state.isMenuOpen)return;if(_this.state.searchOpen)_this.sdw.element.div.contains(document.activeElement)||_this.topWrapper.div.contains(document.activeElement)||_this.searchButton.div.focus();else if(_this.state.isSubMenuOpen){let menuLink=_this.menuLinks?.views?.find(view=>view.data._key===_this.state.subMenu),subMenuLink=_this.subMenuLinks?.views?.find(view=>view.data._key===_this.state.subMenu);document.activeElement===menuLink.element.div||subMenuLink.element.div.contains(document.activeElement)||_this.topWrapperSub.div.contains(document.activeElement)||_this.backButton.div.focus()}else _this.element.div.contains(document.activeElement)||_this.searchButton.div.focus()},!1),_this.bind(_this.state,"isMenuOpen",debouncedHandleMenuSlide),_this.bind(_this.state,"isSubMenuOpen",debouncedHandleMenuSlide),_this.bind(_this.state,"searchOpen",open=>{open?(_this.sdw.element.css({opacity:1,pointerEvents:"auto"}),_this.sdw.showAria(),_this.searchText.hide(),_this.searchBack.element.show(),_this.contentWrapper.css({opacity:0,pointerEvents:"none"}),_this.contentWrapper.hide()):(_this.sdw.element.css({opacity:0,pointerEvents:"none"}),_this.sdw.hideAria(),_this.searchText.show(),_this.searchBack.element.hide(),_this.contentWrapper.css({opacity:1,pointerEvents:"auto"}),_this.contentWrapper.show())}),_this.state.hasScrolled=!1,_this.state.linkHovered=!1,_this.state.showFrosted=!1,_this.state.frosted=0,_this.state.backgroundOpacity=0,_this.home.click(navigateHome),_this.homeButton.click(navigateHome),_this.menuButton.click(handleOpenMainMenu),_this.closeButton1.click(handleCloseMainMenu),_this.closeButton2.click(handleCloseMainMenu),_this.backButton.click(handleOpenMainMenu),_this.searchButton.click(()=>{_this.state.searchOpen=!_this.state.searchOpen});let settings=await _this.getSync("Global/siteSettings");function navigateHome(){handleCloseMainMenu()}function debouncedHandleMenuSlide(){return Utils.debounce(handleMenuSlide)}function handleMenuSlide(){updateNavState(),_this.element.css({pointerEvents:_this.state.isMenuOpen?"auto":"none"}),Global.lenis?.[_this.state.isMenuOpen?"stop":"start"](),_this.mainScreen.css({opacity:_this.state.isMenuOpen?0:1}),_this.mainScreen.classList().toggle("open",_this.state.isMenuOpen);_this.state.isMenuOpen&&!_this.state.isSubMenuOpen&&(_this.background.css({display:"block"}).transform({x:"100%"}),_this.menuScreen.css({display:"flex",opacity:1}).transform({x:"100%"}),_this.subMenuScreen.css({pointerEvents:"none",opacity:0}),defer(_=>{_this.menuScreen.css({pointerEvents:"auto"}).transform({x:"0%"}),_this.background.transform({x:"0%"}),"dark"===_this.state.navColorMode||"light"===_this.state.navColorMode||"frosted-white"===_this.state.navColorMode?(_this.element.css({color:"#010101"}),tween(_this.state,{backgroundOpacity:.5},300,"easeOutCubic")):(_this.element.css({color:"#FFFFFF"}),tween(_this.state,{backgroundOpacity:1},300,"easeOutCubic")),_this.menuScreen.attr("aria-hidden","false"),_this.animateText(_this.contactTitle,600,!0),_this.animateText(_this.socialTitle,700,!0)}),_this.delayedCall(_=>{_this.subMenuScreen.css({display:"none"}),_this.subMenuScreen.attr("aria-hidden","true")},300));_this.state.isMenuOpen&&_this.state.isSubMenuOpen&&(_this.menuScreen.css({pointerEvents:"none",opacity:0}),_this.subMenuScreen.css({display:"flex",opacity:0}).transform({x:"0%"}),defer(_=>{_this.subMenuScreen.css({pointerEvents:"auto",opacity:1}),"dark"===_this.state.navColorMode||"light"===_this.state.navColorMode||"frosted-white"===_this.state.navColorMode?(_this.element.css({color:"#010101"}),tween(_this.state,{backgroundOpacity:.5},300,"easeOutCubic")):(_this.element.css({color:"#FFFFFF"}),tween(_this.state,{backgroundOpacity:1},300,"easeOutCubic")),_this.subMenuScreen.attr("aria-hidden","false"),_this.subMenuLinks?.views?.forEach((view,i)=>view?.animateIn?.(300+50*i))}));!_this.state.isMenuOpen&&!_this.state.isSubMenuOpen&&(_this.subMenuScreen.css({pointerEvents:"none"}).transform({x:"100%"}),_this.menuScreen.css({pointerEvents:"none"}).transform({x:"100%"}),_this.background.css({pointerEvents:"none"}).transform({x:"100%"}),_this.state.showFrosted&&("dark"===_this.state.navColorMode||"light"===_this.state.navColorMode||"frosted-white"===_this.state.navColorMode?(_this.element.css({color:"#010101"}),tween(_this.state,{backgroundOpacity:.5},300,"easeOutCubic")):(_this.element.css({color:"#FFFFFF"}),tween(_this.state,{backgroundOpacity:1},300,"easeOutCubic")))),_this.state.isMenuOpen?(_this.menuButton.attr("aria-hidden","true"),_this.menuButton.attr("tabindex","-1")):(_this.menuButton.attr("aria-hidden","false"),_this.menuButton.attr("tabindex","0"),_this.menuButton.div.focus())}function handleOpenMainMenu(){_this.state.isMenuOpen=!0,_this.state.isSubMenuOpen=!1,_this.searchButton.div.focus()}function handleOpenSubMenu(){_this.state.isMenuOpen=!0,_this.state.isSubMenuOpen=!0}async function handleCloseMainMenu(){_this.state.isSubMenuOpen=!1,_this.state.isMenuOpen=!1}function handleNavOnScroll(lenis){lenis.isStopped||(_this.state.hasScrolled=lenis.animatedScroll>30)}function updateNavState(){_this.state.linkHovered||_this.state.hasScrolled||_this.state.isMenuOpen||_this.state.isSubMenuOpen?_this.state.showFrosted=!0:_this.state.showFrosted=!1}function handleFrosted(showFrosted){if(showFrosted)switch(SanityUtils.stegaClean(_this.state.navColorMode)){case"dark":case"light":case"frosted-white":_this.element.css({color:"#010101"}),tween(_this.state,{frosted:1,backgroundOpacity:.5},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(255, 255, 255, var(--backgroundOpacity))");break;case"solid-black":_this.element.css({color:"#FFFFFF"}),tween(_this.state,{frosted:1,backgroundOpacity:1},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(0, 0, 0, var(--backgroundOpacity))")}else switch(SanityUtils.stegaClean(_this.state.navColorMode)){case"dark":_this.element.css({color:"#010101"}),tween(_this.state,{frosted:0,backgroundOpacity:0},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(255, 255, 255, var(--backgroundOpacity))");break;case"solid-black":_this.element.css({color:"#FFFFFF"}),tween(_this.state,{frosted:1,backgroundOpacity:1},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(0, 0, 0, var(--backgroundOpacity))");break;case"light":_this.element.css({color:"#FFFFFF"}),tween(_this.state,{frosted:0,backgroundOpacity:0},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(255, 255, 255, var(--backgroundOpacity))");break;case"frosted-white":_this.element.css({color:"#010101"}),tween(_this.state,{frosted:1,backgroundOpacity:.5},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(255, 255, 255, var(--backgroundOpacity))")}}_this.state.mobileLinks=function getMenuList(){let menuList=[];return settings.menuSections.forEach(section=>{menuList.push(section)}),settings.companySection.linkLists.forEach(list=>{let object={...settings.companySection};object.linkLists=[list],object.title=list.title,object._key=list.title.toLowerCase().replace(/ /g,"-"),menuList.push(object)}),new StateArray(menuList)}(),_this.onMounted=()=>{!function initMenuLenis(){const lenisOptions={wrapper:_this.contentWrapper.div,content:_this.topMenuElements.div,duration:.8,easing:TweenManager.Interpolation.Quart.Out,direction:"vertical",gestureDirection:"vertical",smooth:!0,smoothTouch:!1,touchMultiplier:2,lerp:!1};_this.state.menuLenis=new Lenis(lenisOptions),_this.startRender(_=>{_this.state.menuLenis&&_this.state.menuLenis.raf(_)})}(),_this.background.tween({x:"100%"},1,"easeOutExpo")},_this.contactTitle.text(settings.contactTitle),_this.contactLink.setupLink(settings.contactLink),_this.socialTitle.text(settings.socialLinksTitle),_this.links=settings.socialLinks,_this.handleAddMenuItem=view=>{"menuSection"===view.data._type&&(view.element.click(handleOpenSubMenu),view.element.click(_=>{_this.state.subMenu=view.data._key,_this.backButton.div.focus()}))},_this.listen("HeaderMobileSubmenuItem/linkClick",()=>{_this.state.isSubMenuOpen=!1,_this.state.isMenuOpen=!1}),_this.listen("SearchDomainResult/linkClick",()=>{_this.state.isSubMenuOpen=!1,_this.state.isMenuOpen=!1}),_this.listen("HeaderLink/linkClick",()=>{_this.state.isSubMenuOpen=!1,_this.state.isMenuOpen=!1}),_this.height=90,Global.lenis?.on("scroll",handleNavOnScroll),_this._bindOnDestroy(()=>{Global.lenis?.off("scroll",handleNavOnScroll)}),_this.bind("ViewController/transitionBegin",_=>{handleFrosted(!1)}),_this.listen("ViewController/transitionComplete",_=>{_this.state.set("showFrosted",!1),_this.state.set("hasScrolled",!1),_this.state.set("linkHovered",!1),_this.events.fire(Events.RESIZE),handleFrosted(!1)}),_this.listen("ViewController/transitionMidway",_=>{tween(_this.state,{frosted:0,backgroundOpacity:0},100,"easeOutCubic")}),_this.bind("ViewController/navState",navState=>{_this.state.navColorMode=navState,function updateNavColorMode(navState){switch(SanityUtils.stegaClean(navState)){case"dark":_this.element.css({color:"#010101"}),tween(_this.state,{frosted:0,backgroundOpacity:0},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(255, 255, 255, var(--backgroundOpacity))");break;case"solid-black":_this.element.css({color:"#FFFFFF"}),tween(_this.state,{frosted:1,backgroundOpacity:1},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(0, 0, 0, var(--backgroundOpacity))");break;case"light":_this.element.css({color:"#FFFFFF"}),tween(_this.state,{frosted:0,backgroundOpacity:0},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(255, 255, 255, var(--backgroundOpacity))");break;case"frosted-white":_this.element.css({color:"#010101"}),tween(_this.state,{frosted:1,backgroundOpacity:.5},300,"easeOutCubic"),_this.element.div.style.setProperty("--backgroundColor","rgba(255, 255, 255, var(--backgroundOpacity))")}}(navState)}),_this.bind(_this.state,"linkHovered",updateNavState),_this.bind(_this.state,"hasScrolled",updateNavState),_this.bind(_this.state,"showFrosted",handleFrosted),_this.mainScreen.y=0;let previousScroll=0;_this.startRender(_=>{if(_this.element.div.style.setProperty("--backgroundOpacity",_this.state.backgroundOpacity),_this.mainScreen.div.style.setProperty("--frosted",_this.state.frosted),_this.mainScreen.div.style.setProperty("--backgroundOpacity",Math.max(.3,_this.state.backgroundOpacity)),!Global.lenis)return;let currentScroll=Math.max(0,Global.lenis.scroll);if(currentScroll===previousScroll)return;let delta=currentScroll-previousScroll;_this.mainScreen.y-=delta,_this.mainScreen.y=Math.max(-_this.height,_this.mainScreen.y),_this.mainScreen.y=Math.min(0,_this.mainScreen.y),_this.mainScreen.transform(),previousScroll=currentScroll}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HeaderMobile"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HeaderMobileMenuItem(_data,_index,_params){const _this=this;Inherit(_this,Element,"button"),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="HeaderMobileMenuItem",_this.contexts="Element, 'button',ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"span",_innerText:"$data.title",refName:"title",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.set("clickedLinkCount",0);let linkLength=_this.getSync("Global/siteSettings").menuSections.length;_this.state.isClicked=!1,_this.element.attr("tabIndex",0),_this.bind(_this.data,"title",title=>{_this.element.attr("aria-label",`Go to ${title} submenu.`)}),_this.element.bind("click",()=>{_this.state.isClicked||(_this.state.isClicked=!0,_this.set("clickedLinkCount",_this.getSync("clickedLinkCount")+1))}),_this.bind("clickedLinkCount",count=>{count>=linkLength-1&&_this.set("allLinksClicked",!0)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HeaderMobileMenuItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HeaderMobileSubmenuItem(_data,_index,_params){const _this=this;Inherit(_this,Element),Inherit(_this,TextAnimationHelper),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="HeaderMobileSubmenuItem",_this.contexts="Element,TextAnimationHelper,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"top-container",_type:"div",refName:"unnamed",children:[{role:"heading","aria-level":3,_type:"h3",_innerText:"$data.title",refName:"title",children:[]},{view:"FooterListSmallLink",data:"$state.links",_type:"ViewState",refName:"viewState",children:[]}]},{className:"bottom-container",_type:"div",refName:"unnamed",children:[{role:"heading","aria-level":3,_type:"h3",_innerText:"$data.descriptionTitle",refName:"descriptionTitle",children:[]},{className:"description",_type:"div",_innerText:"$data.description",refName:"unnamed",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"_type",type=>{if("menuSection"===type){_this.state.links=_this.data.linkLists[0].links;let headerMobileParent=_this.findParent("HeaderMobile");_this.bind(headerMobileParent.state,"subMenu",key=>{key===_this.data._key?_this.element.css({display:"flex"}):_this.element.css({display:"none"})}),_this.onMounted=async()=>{await _this.wait("viewState"),async function handleLinkClick(){await async function viewStateReady(vs,data){return _this.wait(_=>vs.views.length===data.length)}(_this.viewState,_this.state.links),_this.viewState.views.forEach(view=>{view.element.click(e=>{_this.fire("linkClick")})})}()},_this.animateIn=(duration=250)=>{_this.animateText(_this.title,duration,!0),_this.animateText(_this.descriptionTitle,duration+100,!0)}}}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HeaderMobileSubmenuItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HeaderSocialLink(_data,_index,_params){const _this=this;Inherit(_this,Link),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="HeaderSocialLink",_this.contexts="Link,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.setupLink(_this.data),_this.bind(_this.data,"name",name=>{_this.element.attr("aria-label",name)}),_this.bind(_this.data,"shortName",shortName=>{_this.element.text(shortName)}),_this.onClick=()=>{const platform=(_this.data.shortName||_this.data.name||"unknown").toLowerCase();MixpanelAnalytics.track(`link_social_${platform}`)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HeaderSocialLink"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HeadlineSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="HeadlineSlice",_this.contexts="ViewStateElement,TextAnimationHelper,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"textWrapper",children:[{_type:"h3",_innerText:"$data.subheadline",refName:"subheadline",children:[]},{"aria-hidden":!0,_type:"h3",_innerText:"$data.subheadline",refName:"subheadlineHidden",children:[]}]},{_type:"div",refName:"right",children:[{_type:"p",_innerText:"$data.headline",refName:"bottom",children:[]},{_type:"p",refName:"body",children:[]},{_type:"CtaButton",refName:"link",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.data.cta||_this.link?.element?.hide?.(),_this.state.scrollProgress=0,_this.bind(_this.data,"backgroundColor",function handleBackgroundColor(color){_this.element.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)}),_this.element.div.style.setProperty("--background-color",SanityUtils.stegaClean(color.hex)),_this.element.div.style.setProperty("--text-color",SanityUtils.stegaClean(color.contrastColor))}),_this.bind(_this.data,"headline",function handleHeadline(title){title&&_this.bottom.text(title)}),_this.bind(_this.data,"body",function handleBody(body){body?_this.body.text(body):_this.body.hide()}),_this.bind(_this.data,"cta",function setCta(cta){cta&&(_this.link.params.data=cta[0])}),_this._bindOnDestroy(()=>{}),_this.onMounted=async()=>{await _this.wait("link"),_this.link.hide(),_this.bind(_this.data,"cta",data=>_this.link[data?"show":"hide"]())},_this.onInView=()=>{_this.animateText(_this.subheadline,500,!0)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HeadlineSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HelloWar(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,InView,.9),Inherit(_this,XComponent),_this.fragName="HelloWar",_this.contexts="Element,InView, 0.9",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"textContainer",children:[{_type:"div",refName:"text",children:[{_type:"h1",refName:"title",children:[]},{_type:"div",refName:"bar",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit,string=">Hello, War!_",tweenObj={textProgress:0};_this.bind(_this.params,"image",image=>{image&&(_this.image=_this.createFragment(ResponsiveImage,AppState.createLocal({imageWithMeta:image})))}),_this.onInView=()=>{_this.bind("AnimationSwitch/animationEnabled",animationEnabled=>{animationEnabled?(!async function animateText(){await _this.wait("title");let text="";tween(tweenObj,{textProgress:1},1e3,"linear",500).onUpdate(()=>{text=string.slice(0,Math.floor(13*tweenObj.textProgress)),_this.title.text(text)})}(),_this.bar.classList().remove("noAnimation")):(_this.title.text(string),_this.bar.classList().add("noAnimation"))})},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HelloWar"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HighlightedArticle(_params,...restArgs){const _this=this;Inherit(_this,Link),Inherit(_this,XComponent),_this.fragName="HighlightedArticle",_this.contexts="Link",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"highlightedContent",children:[{_type:"div",refName:"contentWrapper",children:[{_type:"div",refName:"details",children:[{_type:"p",refName:"date",children:[]}]},{_type:"div",refName:"titleWrapper",children:[{_type:"h5",refName:"title",children:[]},{"aria-hidden":!0,_type:"h5",refName:"hiddenTitle",children:[]}]}]},{_type:"p",refName:"description",children:[]},{data:"$state.linkData",_type:"CtaButton",refName:"cta",children:[]}]},{_type:"div",refName:"image",children:[{sizes:"(min-width: 769px) 50vw, 100vw",_type:"ResponsiveImage",refName:"thumbnail",children:[]}]},{_type:"div",refName:"sprite",children:[{id:"top-right-arrow",_type:"Sprite",refName:"unnamed",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.params.data=_this.params.data||{},_this.data,_this.state.linkData=AppState.createLocal();new Vector2(0,0),new Vector2(0,0);_this.bind(_this.params,"data",data=>{_this.state.data=AppState.createLocal(data)}),_this.bind(_this.state,"data",function handleLink(link){if(link.link){_this.linkData={_type:"internalLink",reference:link.link,text:"Read more"},_this.setupLink(_this.linkData,!1),_this.state.linkData.setAll(_this.linkData),_this.description.text(link.link.title),_this.title.text(link.link.title),_this.title.show(),_this.hiddenTitle.text(link.link.title),_this.hiddenTitle.show();let formattedDate=new Date(link.link.date).toLocaleDateString("en-US",{day:"numeric",month:"numeric",year:"numeric"});_this.date.text(formattedDate),_this.thumbnail.args[0].imageWithMeta=link.link.image||_this.getSync("Global/siteSettings").newsDefaultImage}}),_this.onMounted=async()=>{await _this.wait("cta"),_this.cta.element.div.tabIndex=-1},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HighlightedArticle"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HighlightedSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,ScrollUtils),Inherit(_this,XComponent),_this.fragName="HighlightedSlice",_this.contexts="ViewStateElement,Element,ScrollUtils",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"container",children:[{_type:"div",refName:"top",children:[]},{_type:"div",refName:"bottom",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function handleSplitText(){_this.topSplitTextInstance?(_this.topSplitTextInstance.revert(),_this.top.empty(),_this.data.textList.forEach((text,index)=>{_this.topText=_this.top.create(`text-${index}`,"h3"),_this.topText.text(SanityUtils.stegaClean(text.text)),_this.topText.css({maxWidth:"100%"})}),defer(_this.topSplitTextInstance.split)):(_this.top.css({position:"block"}),_this.data.textList&&_this.data.textList.forEach((text,index)=>{_this.topText=_this.top.create(`text-${index}`,"h3"),_this.topText.text(SanityUtils.stegaClean(text.text))}),_this.topSplitTextInstance=_this.initClass(SplitText,_this.top,{type:"chars"})),_this.bottomSplitTextInstance?(_this.bottomSplitTextInstance.revert(),_this.bottom.empty(),_this.data.textList.forEach((text,index)=>{_this.bottomText=_this.bottom.create(`text-${index}`,"h3"),_this.bottomText.text(SanityUtils.stegaClean(text.text))}),defer(_this.bottomSplitTextInstance.split)):(_this.data.textList&&_this.data.textList.forEach((text,index)=>{_this.bottomText=_this.bottom.create(`text-${index}`,"h3"),_this.bottomText.text(SanityUtils.stegaClean(text.text))}),_this.bottomSplitTextInstance=_this.initClass(SplitText,_this.bottom,{type:"chars"}))}function handleScrollProgress(progress){_this.topSplitTextInstance.chars.forEach((char,index)=>{let charPosition=index/_this.topSplitTextInstance.chars.length,opacity=1-Math.smoothStep(progress-.01,progress,charPosition);char.css({opacity:opacity})})}_this.onMounted=async()=>{await SplitText.isFontReady(),await _this.wait("top"),await _this.wait("bottom"),_this.bind(_this.data,"textList",handleSplitText),_this.bind(_this.data,"backgroundColor",backgroundColor=>{backgroundColor&&_this.element.css({background:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)})}),async function addHandlers(){await _this.topSplitTextInstance.ready(),await _this.bottomSplitTextInstance.ready(),_this.top.css({position:"absolute"}),_this.bind(_this.state,"scrollProgress",handleScrollProgress)}()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HighlightedSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HomeHero(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="HomeHero",_this.contexts="ViewStateElement,TextAnimationHelper,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"mediaWrapper",children:[]},{_type:"div",refName:"content",children:[{_type:"div",refName:"headlineWrapper",children:[{_type:"div",refName:"header",children:[{role:"heading","aria-level":1,_type:"h1",_innerText:"$data.shortTitle",refName:"shortTitle",children:[]},{role:"heading","aria-level":2,_type:"h2",_innerText:"$data.title",refName:"title",children:[]}]},{"aria-label":"Scroll to next section",role:"button",_type:"button",refName:"button",children:[{id:"arrow-down",_type:"Sprite",refName:"icon1",children:[]}]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function handleHeroMedia(heroMedia){let maxBreakpoint=0;maxBreakpoint=Math.max(...heroMedia.map(({breakpoint:breakpoint})=>breakpoint)),heroMedia.forEach(({breakpoint:breakpoint,video:video})=>{let videoElement=_this.initClass(ResponsiveVideo,AppState.createLocal({videoWithMeta:video,controls:!1,autoplay:!0,loop:!0}),[_this.mediaWrapper]);breakpoint>0?(videoElement.element.classList().add(`breakpoint-${breakpoint}`),videoElement.element.goob(`& {\n                display: none !important;\n\n                @media (max-width: ${breakpoint}px) {\n                    display: block !important;\n                }\n            }`)):(videoElement.element.classList().add("default"),videoElement.element.goob(`& {\n                display: none !important;\n\n                @media (min-width: ${maxBreakpoint}px) {\n                    display: block !important;\n                }\n            }`))})}async function handleTitle(title){title?(_this.content.show(),_this.title.show(),_this.mediaWrapper.css({height:"76svh"}),_this.titleSplitTextInstance?(_this.titleSplitTextInstance.revert(),_this.title.text(title),defer(_this.titleSplitTextInstance.split)):(await defer(),_this.title.text(title),_this.titleSplitTextInstance=_this.initClass(SplitText,_this.title,{type:"lines"}))):_this.content.hide()}function handleShortTitle(shortTitle){shortTitle?(_this.content.show(),_this.shortTitle.show(),_this.mediaWrapper.css({height:"76svh"}),_this.shortTitle.text(shortTitle)):_this.content.hide()}_this.mediaWrapper.css({height:"96svh"}),_this.content.hide(),_this.title.hide(),_this.shortTitle.hide(),_this.state.isMobile=Stage.width<769,_this.bind(_this.state,"isMobile",isMobile=>{isMobile?_this.title.css({minWidth:"100%"}):_this.title.css({minWidth:"50%"})}),_this.onMounted=async()=>{_this.data.title&&(await SplitText.isFontReady(),await _this.wait("title"),_this.title.css({opacity:0})),_this.data.shortTitle&&_this.shortTitle.css({opacity:0}),_this.mediaWrapper.css({opacity:0}),_this.bind(_this.data,"title",handleTitle),_this.bind(_this.data,"shortTitle",handleShortTitle),_this.bind(_this.data,"heroMedia",handleHeroMedia),_this.bind("ViewController/transitioning",stage=>{!1===stage&&async function animateIn(){_this.data.title&&(await _this.wait("titleSplitTextInstance"),await _this.titleSplitTextInstance.ready(),_this.title.css({opacity:1}),_this.titleSplitTextInstance.lines.forEach((line,index)=>{_this.title.create("line-wrapper","div").div.append(line.div),line.transform({y:"100%"}),line.tween({y:"0%"},1e3,"easeOutExpo",100*index).promise()}));_this.data.shortTitle&&(_this.shortTitle.tween({opacity:.6},1e3,"easeOutExpo"),_this.animateText(_this.shortTitle,500,!0));_this.mediaWrapper.tween({opacity:1},1e3,"easeOutExpo")}()})},_this.button.click(e=>{Global.lenis?.scrollTo(_this.element.div.offsetHeight,{duration:2.5,lerp:.1})}),_this.onResize(function resize(){handleTitle(_this.data.title),_this.state.isMobile=Stage.width<769}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HomeHero"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function HorizontalRule(_params,...restArgs){const _this=this;Inherit(_this,Element,"hr"),Inherit(_this,XComponent),_this.fragName="HorizontalRule",_this.contexts="Element, 'hr'",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"HorizontalRule"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ImageColumnSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="ImageColumnSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{view:"ResponsiveMedia",data:"$data.images",_type:"ViewState",refName:"viewstate",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"images",function handleColumnCount(){switch(_this.element.classList().remove("one","two","three"),_this.data.images.length){case 1:_this.element.classList().add("one");break;case 2:_this.element.classList().add("two");break;case 3:_this.element.classList().add("three")}}),_this.bind(_this.data,"backgroundColor",color=>{_this.element.css({background:SanityUtils.stegaClean(color.hex)})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ImageColumnSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ImageHeaderSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="ImageHeaderSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"headline",_type:"div",refName:"unnamed",children:[{data:"$state.headline",icon:!1,_type:"CtaButton",refName:"link",children:[]},{id:"top-right-arrow",_type:"Sprite",refName:"icon",children:[]}]},{imageWithMeta:"$data.image",sizes:"(min-width: 769px) 100vw, 100vw",_type:"ResponsiveImage",refName:"previewImage",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.headline=AppState.createLocal(_this.data.headline),_this.bind(_this.data,"headline",data=>_this.state.headline.setAll(data)),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ImageHeaderSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ImageUtils(){const _this=this;Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="ImageUtils",_this.contexts="Component",this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.download=async function(url,string="image"){const image=await fetch(url),imageBlog=await image.blob(),imageURL=URL.createObjectURL(imageBlog),link=document.createElement("a");link.href=imageURL,link.download=string,document.body.appendChild(link),link.click(),document.body.removeChild(link)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ImageUtils"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()},"static"),Class(function InView(_params,...restArgs){const _this=this;Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="InView",_this.contexts="Component",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;if(_this._inView=!!Global.PLAYGROUND,_this.threshold=_this.params?.threshold??.05,Global.PLAYGROUND)await _this.wait("onInView"),_this.element.onMount(_this.onInView);else{_this.element.createObserver(function handleObserver([entry]){entry.isIntersecting?_this.onInView?.():_this.onOutView?.()},{threshold:_this.threshold}),_this.element.observe()}onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"InView"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function IndustryTrend(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="IndustryTrend",_this.contexts="Element,InView, 0.5",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"legend",children:[]},{_type:"div",refName:"graph",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let labels,lines,hexagons,onInit=_this.onInit;_this.state.scrolled=!1,_this.onInit=async()=>{await _this.legend.svg("assets/images/book-charts/reboot/industry-trend/legend.svg"),await _this.graph.svg("assets/images/book-charts/reboot/industry-trend/graph.svg"),legend=_this.legend.div.querySelector("#legend"),graph=_this.graph.div.querySelector("#graph"),labels=legend.querySelector("#labels"),lines=graph.querySelector("#lines"),hexagons=graph.querySelector("#hexagons"),_this.flag("isReady",!0)},_this.onInView=async()=>{await _this.wait("isReady"),!_this.state.scrolled&&_this.getSync("AnimationSwitch/animationEnabled")&&(_this.state.scrolled=!0,await function setInitialState(){(function setLabels(){[...labels.children].forEach((label,index)=>{[...label.children].forEach((child,childIndex)=>{if(0===childIndex)return;new HydraObject(child).css({opacity:0})})})})(),function setLines(){[...lines.children].forEach((line,index)=>{line.getAttribute("stroke-dasharray")||(line.setAttribute("stroke-dasharray",1e3),line.setAttribute("stroke-dashoffset",-1e3))})}(),function setHexagons(){[...hexagons.children].forEach((hexagon,index)=>{new HydraObject(hexagon).css({opacity:0})})}()}(),function animateIn(){(function animateLabels(){[...labels.children].forEach((label,index)=>{[...label.children].forEach((child,childIndex)=>{if(0===childIndex)return;new HydraObject(child).css({opacity:0})}),_this.delayedCall(()=>{[...label.children].forEach((child,childIndex)=>{if(0===childIndex)return;let hydraObj=new HydraObject(child);hydraObj.css({opacity:0}),hydraObj.tween({opacity:1},25,"easeOutQuad",200+50*childIndex)})},100*index)})})(),function animateLines(){[...lines.children].forEach((line,index)=>{line.getAttribute("stroke-dasharray");let tweenObj={};"line-5-dash"!==line.id&&6!==index&&7!==index&&("safari"===Device.system.browser?(tweenObj.dashArray=1e3,tweenObj.dashOffset=1e3,line.setAttribute("stroke-dasharray",tweenObj.dashArray),line.setAttribute("stroke-dashoffset",tweenObj.dashOffset),tween(tweenObj,{dashOffset:2e3},2e3,"easeInOutQuart",100*index).onUpdate(()=>{line.setAttribute("stroke-dashoffset",tweenObj.dashOffset)})):(tweenObj.dashArray=1e3,tweenObj.dashOffset=-1e3,line.setAttribute("stroke-dasharray",tweenObj.dashArray),line.setAttribute("stroke-dashoffset",tweenObj.dashOffset),tween(tweenObj,{dashOffset:0},2e3,"easeInOutQuart",100*index).onUpdate(()=>{line.setAttribute("stroke-dashoffset",tweenObj.dashOffset)}))),"line-5-dash"===line.id||6!==index&&7!==index||(tweenObj.dashArray=1e3,tweenObj.dashOffset=1e3,line.setAttribute("stroke-dasharray",tweenObj.dashArray),line.setAttribute("stroke-dashoffset",tweenObj.dashOffset),tween(tweenObj,{dashOffset:0},2e3,"easeInOutQuart",100*index).onUpdate(()=>{line.setAttribute("stroke-dashoffset",tweenObj.dashOffset)}))})}(),function animateHexagons(){[...hexagons.children].forEach((hexagon,index)=>{let hydraObj=new HydraObject(hexagon);hydraObj.css({opacity:0}),hydraObj.tween({opacity:1},1e3,"easeInOutBounce",1e3+100*index)})}()}())},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"IndustryTrend"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function InternalLinkButton(_params,...restArgs){const _this=this;Inherit(_this,Link),Inherit(_this,BindUtils),Inherit(_this,TextAnimationHelper),Inherit(_this,XComponent),_this.fragName="InternalLinkButton",_this.contexts="Link,BindUtils,TextAnimationHelper",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"p",refName:"text",children:[]},{"aria-hidden":!0,tabIndex:-1,_type:"div",refName:"iconWrapper",children:[{id:"top-right-arrow",_type:"Sprite",refName:"icon",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function updateText(text){_this.text.text(text)}function handleLink(link){link&&(_this.setupLink(link,!1),link.type&&handleType(link.type))}function handleType(type){type&&_this.element.classList().add(type)}_this.bindToNestedParams("internalLinkButton",bind=>{bind("text",updateText),bind("internalLink",handleLink),bind("type",handleType)}),_this.onMounted=()=>{_this.element.attr("role","link"),_this.icon.element.attr("aria-hidden","true"),_this.icon.element.attr("tabindex","-1")},_this.element.hover(e=>{}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"InternalLinkButton"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function KTXShaderTest(_mesh,_shader,_input,_group){const _this=this;if(Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="KTXShaderTest",_this.contexts="Component",_this.mesh=_mesh,_this.shader=_shader,_this.uilInput=_input,_this.uilFolder=_group,_this.uilFolder?.addButton){let a=_this.uilFolder;_this.uilFolder=_this.uilInput,_this.uilInput=a}this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.shader.addUniforms({tMap:{value:null},uFrame:{value:0}}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"KTXShaderTest"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function KeyFeatureAccordion(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="KeyFeatureAccordion",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{view:"KeyFeatureItem",data:"$state.items",_type:"ViewState",refName:"vs",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function handleBackgroundColor(backgroundColor){backgroundColor&&_this.element.css({background:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)})}function handleItems(items){if(items){let itemsArray=[];_this.data.items.forEach((item,index)=>{itemsArray.push({...item,index:index})}),_this.state.items.refresh(itemsArray)}}_this.state.items=new StateArray,_this.onMounted=()=>{_this.bind(_this.data,"items",handleItems),_this.bind(_this.data,"backgroundColor",handleBackgroundColor)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"KeyFeatureAccordion"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function KeyFeatureItem(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="KeyFeatureItem",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"header",children:[{_type:"h2",refName:"desktopIndex",children:[]},{_type:"h2",refName:"title",children:[]},{_type:"p",refName:"mobileIndex",children:[]}]},{_type:"div",refName:"content",children:[{content:"$data.content",_type:"RichText",refName:"richText",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function toggleOpen(){_this.state.isOpen=!_this.state.isOpen,_this.element.attr("aria-expanded",_this.state.isOpen?"true":"false")}function handleIsOpen(isOpen){isOpen?_this.content.tween({height:_this.content.div.scrollHeight},500,"easeOutSine"):_this.content.tween({height:0},500,"easeOutSine")}_this.onResize(function resize(){_this.state.isMobile=Stage.width<769}),_this.richText.element.onResize(()=>{_this.state.contentHeight=_this.richText.element.div.scrollHeight,_this.content.css({height:_this.state.contentHeight})}),_this.element.onResize(()=>{_this.state.contentHeight=_this.richText.element.div.scrollHeight,_this.state.isMobile||_this.content.tween({height:_this.state.contentHeight},500,"easeOutSine")}),_this.onMounted=()=>{!async function setState(){await _this.wait("content"),_this.state.isMobile=Stage.width<769,_this.state.contentHeight=_this.richText.element.div.scrollHeight,_this.state.isOpen=!1}()},_this.bind(_this.data,"title",title=>{title&&(_this.title.text(title),_this.element.attr("aria-label",title))}),_this.bind(_this.data,"index",index=>{if(void 0!==index){let desktopIndex=`${index+1}`,mobileIndex=`0${index+1}`;_this.desktopIndex.text(desktopIndex),_this.mobileIndex.text(mobileIndex)}}),_this.bind(_this.state,"isMobile",function handleIsMobile(isMobile){_this.state.contentHeight=_this.richText.element.div.scrollHeight,isMobile?(_this.bind(_this.state,"isOpen",handleIsOpen),_this.element.bind("click",toggleOpen),_this.element.attr("aria-expanded","false"),_this.element.attr("role","button"),_this.element.attr("tabIndex","0")):(_this.state.isOpen=!0,_this.element.unbind("click",toggleOpen),_this.element.div.removeAttribute("aria-expanded"),_this.element.div.removeAttribute("role"),_this.element.div.removeAttribute("tabIndex"))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"KeyFeatureItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function Landscape(_params,...restArgs){const _this=this;Inherit(_this,FragFXScene,"LandscapeTest"),Inherit(_this,XComponent),_this.fragName="Landscape",_this.contexts="FragFXScene, 'LandscapeTest'",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this._initFXScene(World.NUKE,null,{format:void 0,type:void 0,minFilter:void 0,magFilter:void 0,multiRenderTarget:void 0,mipmaps:void 0,screenQuad:void 0,vrMode:void 0,multisample:void 0,samplesAmount:void 0}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.makeCanvasGrid=async function(){let canvas=document.createElement("canvas");canvas.width=4096,canvas.height=4096;let ctx=canvas.getContext("2d"),loading=[],i=1;for(let y=0;y<4096;y+=256)for(let x=0;x<4096;x+=256){let img=new Image,load=Promise.create();loading.push(load),img.src=`../Tools/video/particles/isolines-${i}.png`,img.onload=img.onerror=()=>{load.resolve(),ctx.drawImage(img,x,y)},i++}await Promise.all(loading);let obj=new HydraObject(canvas);obj.css({zIndex:1e3}),Stage.add(obj)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"Landscape"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LandscapeParticles(_params,...restArgs){const _this=this;Inherit(_this,Object3D),Inherit(_this,XComponent),_this.fragName="LandscapeParticles",_this.contexts="Object3D",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onInit=_=>{!function createLandscapeParticles(){const config={width:3,height:3,total:3025},geometry=function createGeometry(positions){const geometry=new Geometry,uvs=new Float32Array(positions.length/3*2);for(let i=0;i<uvs.length;i+=2)uvs[i]=.5,uvs[i+1]=.5;return geometry.addAttribute("position",new GeometryAttribute(positions,3)),geometry.addAttribute("uv",new GeometryAttribute(uvs,2)),geometry.drawRange.end=positions.length/3,geometry}(function generateLandscapePositions(config){const layers=12,positions=new Float32Array(3*config.total*layers),gridSize=Math.ceil(Math.sqrt(config.total)),stepX=2/(gridSize-1),stepZ=2/(gridSize-1),stepY=1/(layers-1);let index=0;for(let layer=0;layer<layers;layer++)for(let i=0;i<gridSize;i++){const offset=(i%2==0?-1:1)*stepX;for(let j=0;j<gridSize&&!(index>=config.total*layers);j++){const x=i*stepX-1,y=layer*stepY,z=j*stepZ-1+offset;positions[3*index]=x,positions[3*index+1]=y,positions[3*index+2]=z,index++}}return positions}(config)),points=function createPoints(config,geometry){config.yDistance;const gridSize=Math.ceil(Math.sqrt(config.total)),shader=_this.initClass(Shader,"LandscapeParticles",{tLandscape:{value:Utils3D.getTexture("assets/images/texture/heightmap.png")},uParticleSize:{value:1},uParticleColor:{value:new Color("#ffffff")},uGridSize:{value:new Vector2(gridSize,gridSize)},uTotalParticles:{value:config.total},DPR:{value:1},transparent:!0}),points=new Points(geometry,shader);return points.frustumCulled=!1,_this.shader=shader,points}(config,geometry);_this.add(points)}()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LandscapeParticles"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LatticeCharacteristicItem(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="LatticeCharacteristicItem",_this.contexts="ViewStateElement,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"content",children:[{_type:"h3",_innerText:"$data.title",refName:"unnamed",children:[]},{_type:"div",refName:"media",children:[]},{_type:"h6",_innerText:"$data.subtitle",refName:"h6",children:[]},{_type:"p",_innerText:"$data.description",refName:"unnamed",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.data.media?_this.createFragment(ResponsiveMedia,AppState.createLocal(_this.data.media[0]),[_this.media]):_this.h6.clsx("top-spacing"),_this.bind(_this.data,"backgroundColor",color=>{color&&(_this.content.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)}),_this.h6.css({"border-color":SanityUtils.stegaClean(color.contrastColor)}))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LatticeCharacteristicItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LatticeCharacteristicsSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="LatticeCharacteristicsSlice",_this.contexts="ViewStateElement,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"h5",_innerText:"$data.header",refName:"unnamed",children:[]},{className:"carousel",_type:"div",refName:"carousel",children:[{view:"LatticeCharacteristicItem",data:"$data.items",_type:"ViewState",refName:"vs",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;async function setupSlider(){await _this.wait("carousel"),await async function viewStateReady(vs,data){return _this.wait(_=>vs.views.length===data.length)}(_this.vs,_this.data.items),_this.slider&&_this.slider.destroy(),_this.slider=_this.initClass(Interaction.Slider,_this.carousel,{x:1},{hit:_this.carousel,width:[..._this.carousel.children()][0].offsetWidth,slides:_this.data.items.length,gap:12}),_this.slider.maxSlides=_this.data.items.length,_this.slider.interpolate=.3,_this.slider.ease="easeOutCubic",_this.slider.easeTime=750,_this.slider.flickable=!0,function addHandlers(){_this.rawInput=new Interaction(_this.carousel),_this.events.sub(_this.rawInput,Interaction.DRAG,e=>{Math.abs(_this.rawInput.move.x)>=Math.abs(_this.rawInput.move.y)&&Math.abs(e.x)>40?Global.lenis.stop():Global.lenis.start()})}()}function debouncedSetupSlider(){return Utils.debounce(setupSlider)}_this.bind(_this.data,"backgroundColor",color=>{_this.element.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)})}),_this.state.isMobile=Stage.width<769,_this.onResize(function resize(){_this.state.isMobile=Stage.width<769,_this.state.isMobile?debouncedSetupSlider():Global.lenis.start()}),_this.onMounted=()=>{_this.state.isMobile&&debouncedSetupSlider()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LatticeCharacteristicsSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LatticeFeatureItem(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="LatticeFeatureItem",_this.contexts="ViewStateElement,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"content",children:[{_type:"h6",_innerText:"$data.title",refName:"unnamed",children:[]},{_type:"div",refName:"media",children:[]},{_type:"p",_innerText:"$data.description",refName:"unnamed",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.createFragment(ResponsiveMedia,AppState.createLocal(_this.data[_this.data.type]),[_this.media]),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LatticeFeatureItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LatticeFeaturesSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="LatticeFeaturesSlice",_this.contexts="ViewStateElement,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"h5",_innerText:"$data.title",refName:"title",children:[]},{_type:"div",refName:"border",children:[]},{_type:"div",refName:"carousel",children:[{view:"LatticeFeatureItem",data:"$data.items",_type:"ViewState",refName:"vs",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;async function setupSlider(){await _this.wait("carousel"),_this.slider&&_this.slider.destroy(),await async function viewStateReady(vs,data){return _this.wait(_=>vs.views.length===data.length)}(_this.vs,_this.data.items),_this.slider=_this.initClass(Interaction.Slider,_this.carousel,{x:1},{hit:_this.carousel,width:[..._this.carousel.children()][0].offsetWidth,slides:_this.data.items.length,gap:12}),_this.slider.maxSlides=_this.data.items.length,_this.slider.interpolate=.3,_this.slider.ease="easeOutCubic",_this.slider.easeTime=750,_this.slider.flickable=!0}function debouncedSetupSlider(){return Utils.debounce(setupSlider)}_this.state.isMobile=Stage.width<769,_this.onResize(function resize(){_this.state.isMobile=Stage.width<769,_this.state.isMobile&&debouncedSetupSlider()}),_this.border.hide(),_this.title.hide(),_this.bind(_this.data,"backgroundColor",color=>{_this.element.css({backgroundColor:color.hex}),_this.title.css({color:color.contrastColor}),_this.border.css({background:color.contrastColor}),_this.element.div.style.setProperty("--background-color","#010101"===color.contrastColor?"#ffffff":"#010101"),_this.element.div.style.setProperty("--contrast-color",color.contrastColor)}),_this.bind(_this.data,"title",title=>{title?(_this.title.show(),_this.border.show(),_this.title.text(title)):(_this.title.hide(),_this.border.hide())}),_this.bind(_this.data,"showHorizontalRule",showHorizontalRule=>{showHorizontalRule?_this.border.show():_this.border.hide()}),_this.onMounted=()=>{_this.border.transform({scaleX:0}),_this.state.isMobile&&debouncedSetupSlider()},_this.onInView=()=>{_this.border.tween({scaleX:1},1500,"easeOutExpo")},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LatticeFeaturesSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LatticeHeaderSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,FXSceneSlice,{sceneLayoutName:"LatticeHeaderScene"}),Inherit(_this,XComponent),_this.fragName="LatticeHeaderSlice",_this.contexts="ViewStateElement,TextAnimationHelper,FXSceneSlice, { sceneLayoutName: 'LatticeHeaderScene' }",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"titleWrapper",children:[{text:"$data.shortTitle",_type:"p",refName:"shortTitle",children:[]},{text:"$data.title",_type:"h1",refName:"unnamed",children:[]}]},{_type:"div",refName:"details",children:[{_type:"p",_innerText:"$data.description",refName:"description",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.maxHeight=0;const requiresFallback=Tests.requiresFallbackGraphics();_this.data.description?_this.description.show():_this.description.hide(),_this.bind(_this.data,"description",description=>{description?_this.description.text(description):_this.description.hide()}),_this.onInit=_=>{requiresFallback&&function fallbackInit(){let fallbackVideo=_this.getSync("Global/siteSettings").fallbackVideoLatticeHeader;_this.responsiveVideo=_this.initClass(ResponsiveVideo,AppState.createLocal({videoWithMeta:fallbackVideo,preload:!0,muted:!0,autoplay:!0,loop:!0,controls:!1}),[_this.element]),_this.video=_this.responsiveVideo.video,defer(async _=>{await _this.video.load(),await defer(),_this.video.play()})}(),_this.titleWrapper.css({opacity:0}).transform({x:"-3rem"}),_this.bind("ViewController/transitioning",stage=>{stage||_this.titleWrapper.tween({opacity:1,x:0},1e3,"easeOutExpo")}),_this.flag("hasInit",!0)},_this.bind(_this.data,"disableBackgroundAnimation",async disableBackgroundAnimation=>{await _this.wait("hasInit"),disableBackgroundAnimation?(requiresFallback&&_this.video.element.hide(),_this.layout.visible=!1,_this.element.css({backgroundColor:SanityUtils.stegaClean(_this.data.colorPair.background.hex)})):(requiresFallback&&_this.video.element.show(),_this.layout.visible=!0,_this.element.css({backgroundColor:"transparent"}))}),_this.bind(_this.data,"colorPair",colorPair=>{colorPair&&_this.element.css({color:SanityUtils.stegaClean(colorPair.foreground.hex)})}),requiresFallback||(_this.bind(_this.data,"colorPair",colorPair=>{colorPair&&_this.layers.background.shader.set("uColor",new Color(SanityUtils.stegaClean(colorPair.background.hex)))}),_this.wait(_=>_this.layers&&_this.layers.camera).then(_=>{_this.useCamera(_this.layers.camera)})),Global.PLAYGROUND&&(_this.element.css({height:"100vh"}),_this.layers.background.shader.set("uColor",new Color("#D8D8D4"))),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LatticeHeaderSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LatticeMediaSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="LatticeMediaSlice",_this.contexts="ViewStateElement,TextAnimationHelper,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"image-container",_type:"div",refName:"unnamed",children:[{video:"$data.video",image:"$data.image",_type:"Media",refName:"unnamed",children:[]}]},{className:"content",_type:"div",refName:"unnamed",children:[{_type:"h5",_innerText:"$data.shortTitle",refName:"shortTitle",children:[]},{className:"content-paragraph",_type:"div",refName:"unnamed",children:[{content:"$data.paragraph",_type:"RichText",refName:"top",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onMounted=()=>{_this.shortTitle.css({opacity:0}),_this.element.div.getBoundingClientRect().top<window.innerHeight&&(_this.shortTitle.tween({opacity:.6},1e3,"easeOutExpo"),_this.animateText(_this.shortTitle,500,!0))},_this.onInView=()=>{_this.shortTitle.tween({opacity:.6},1e3,"easeOutExpo"),_this.animateText(_this.shortTitle,500,!0)},_this.bind(_this.data,"backgroundColor",color=>{_this.element.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)}),_this.element.classList().toggle("light","#010101"===SanityUtils.stegaClean(color.contrastColor))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LatticeMediaSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LatticeMissionBlock(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView),Inherit(_this,XComponent),_this.fragName="LatticeMissionBlock",_this.contexts="ViewStateElement,Element,InView",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"border",children:[]},{_type:"div",refName:"container",children:[{_type:"div",refName:"headline",children:[]},{_type:"h6",_innerText:"$data.headline",refName:"subheadline",children:[]},{_type:"div",refName:"description",children:[{content:"$data.description",_type:"RichText",refName:"unnamed",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"textColor",textColor=>{_this.border.css({background:textColor})}),_this.onMounted=()=>{_this.border.transform({scaleX:0}),_this.headline.text((_this.index+1).toString().padStart(2,"0"))},_this.onInView=()=>{_this.border.tween({scaleX:1},2e3,"easeOutExpo"),[_this.headline,_this.subheadline,_this.description].forEach((element,index)=>{element.tween({x:"0%",opacity:1},1e3,"easeOutExpo",200+100*index).promise()})},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LatticeMissionBlock"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LatticeMissionSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="LatticeMissionSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"h5",_innerText:"$data.title",refName:"unnamed",children:[]},{_type:"div",refName:"content",children:[{_type:"div",refName:"mediaBlock",children:[]},{_type:"div",refName:"blocks",children:[{view:"LatticeMissionBlock",data:"$blocksData",_type:"ViewState",refName:"unnamed",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.blocksData=new StateArray,_this.mediaBlock.hide(),_this.state.isMobile=Stage.width<769,_this.state.hasMedia=!1,_this.state.fullBleed=!1,_this.onResize(_=>{_this.state.isMobile=Stage.width<769}),_this.onInit=()=>{let blocksData=[];_this.data.blocks.forEach(block=>{blocksData.push({...block,textColor:SanityUtils.stegaClean(_this.data.backgroundColor.contrastColor)})}),_this.blocksData.refresh(blocksData)},_this.bind(_this.data,"media",function handleMedia(media){media.length>0?(_this.mediaBlock.show(),_this.state.hasMedia=!0,_this.blocks.classList().toggle("half-width",!_this.state.isMobile),_this.media=_this.initClass(ResponsiveMedia,AppState.createLocal({...media[0],autoplay:!0,loop:!0}),0,AppState.createLocal(),[_this.mediaBlock])):(_this.mediaBlock.hide(),_this.state.hasMedia=!1)}),_this.bind(_this.state,"isMobile",isMobile=>{isMobile&&_this.state.hasMedia||!isMobile&&!_this.state.hasMedia||isMobile?_this.state.fullBleed=!0:_this.state.fullBleed=!1}),_this.bind(_this.state,"hasMedia",hasMedia=>{hasMedia&&_this.state.isMobile||!hasMedia&&!_this.state.isMobile||_this.state.isMobile?_this.state.fullBleed=!0:_this.state.fullBleed=!1}),_this.bind(_this.state,"fullBleed",fullBleed=>{_this.blocks.classList().toggle("half-width",!fullBleed)}),_this.bind(_this.data,"backgroundColor",color=>{_this.element.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LatticeMissionSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function Link(_params,...restArgs){const _this=this;Inherit(_this,Element,"a"),Inherit(_this,TextAnimationHelper),Inherit(_this,XComponent),_this.fragName="Link",_this.contexts="Element, 'a',TextAnimationHelper",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;const _isHashRouter=Hydra.LOCAL||!Device.system.pushstate;function setupLink(dataOrArray,noText=!0,syncBinds=!0){let data=Array.isArray(dataOrArray)?dataOrArray[0]:dataOrArray;const link=data?CMS.resolveLink(data):{};_this.state.path=link.path,_this.state.href=link.url,_this.state.searchQuery=link.searchQuery,_this.element.css({textDecoration:"none"}),noText&&(_this.state.label=link.text,_this.state.title||(_this.state.title=_this.element.create("link-label","span")),_this.state.title.text(_this.state.label)),"internalLink"===data?._type&&(_this.element.attr("data-path",`${_this.state.path}`),_this.state.searchQuery&&_this.element.attr("data-query",`${_this.state.searchQuery}`),link.hash&&_this.element.attr("data-hash",link.hash),_this.state.href=_isHashRouter?`#!/${_this.state.path}`:`/${_this.state.path}${_this.state.searchQuery?`?${_this.state.searchQuery}`:""}`),link.target&&(_this.element.attr("target",link.target),_this.element.attr("rel","noopener noreferrer")),_this.state.href?(_this.element.attr("href",_this.state.href),_this.element.classList().add("link"),_this.element.attr("data-label",SanityUtils.stegaClean(_this.state.label))):_this.element.attr("href",null),function setupMenu(){let menuParent=_this.findParent("MenuListItem");if(!menuParent)return;_this.bind(menuParent.state,"toggledOpen",isOpen=>{menuParent.state?.subLinks&&_this.element.attr("disabled",isOpen?"":"disabled")})}(),syncBinds&&function setupBinds(data){if(!data?.isAppState)return;[...data.getMap().keys()].forEach(key=>{key.startsWith("_")||_this.bind(data,key,_=>{setupLink(data,!0,!1)})})}(data),_this.events.fire(Events.UPDATE,{state:_this.state},!0)}function updateClass(className){_this.element.classList().add(className)}_this.params?.bind?.("data",setupLink),_this.params?.bind?.("class",updateClass),_this.params?.bind?.("className",updateClass),_this.onClick=()=>{_this.state.href&&_this.state.href.startsWith("mailto:")&&MixpanelAnalytics.track("cta_contact_email")},_this.setupLink=setupLink,onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"Link"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LinkCarousel(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="LinkCarousel",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"top",children:[{_type:"h4",_innerText:"$data.header",refName:"header",children:[]},{data:"$state.viewAllLink",_type:"CtaButton",refName:"link",children:[]}]},{_type:"div",refName:"carousel",children:[{data:"$data.links",_type:"LinkCarouselSlider",refName:"slider",children:[]}]},{_type:"div",refName:"controls",children:[{icon:"left-arrow",onClick:function handlePrev(){_this.fire("LinkCarouselSlider/prev")},_type:"CircleButton",refName:"prev",children:[]},{icon:"arrow-right",onClick:function handleNext(){_this.fire("LinkCarouselSlider/next")},_type:"CircleButton",refName:"next",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function handleResize(){window.innerWidth>_this.slider.element.div.offsetWidth?_this.controls.hide():_this.controls.show()}_this.state.viewAllLink=AppState.createLocal(_this.data.viewAllLink),_this.bind(_this.data,"viewAllLink",data=>_this.state.viewAllLink.setAll(data)),_this.onMounted=async()=>{await _this.wait("carousel"),await _this.slider.cardsReady(),_this.onResize(handleResize)},_this.bind(_this.data,"backgroundColor",backgroundColor=>{_this.element.css({backgroundColor:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)})}),_this.bind("LinkCarouselSlider/elementPosition",elementPosition=>{"start"===elementPosition&&_this.prev.setDisabled(!0),"end"===elementPosition&&_this.next.setDisabled(!0),"middle"===elementPosition&&(_this.prev.setDisabled(!1),_this.next.setDisabled(!1))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LinkCarousel"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LinkCarouselSlider(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="LinkCarouselSlider",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.params.data=_this.params.data||[],_this.finalData=new StateArray([]),_this.isReady=!1;let isResizing=!1;function handleResize(){isResizing=!0,isResizing=!1}_this.sliderObj={x:0},_this.sliderOffset=0,_this.startRender(function loop(){if(!_this.isReady)return;if(isResizing)return;_this.element.x=Math.max(_this.sliderObj.x,-1*(_this.element.div.offsetWidth-window.innerWidth)),window.innerWidth>_this.element.div.offsetWidth&&(_this.element.x=0);_this.element.transform(),_this.element.x>=-1&&_this.set("LinkCarouselSlider/elementPosition","start");_this.element.x<=-1&&_this.element.x>=-1*(_this.element.div.offsetWidth-window.innerWidth)&&_this.set("LinkCarouselSlider/elementPosition","middle");_this.element.x===-1*(_this.element.div.offsetWidth-window.innerWidth)&&_this.set("LinkCarouselSlider/elementPosition","end")}),_this.onInit=()=>{!function setupSlides(){for(let i=0;i<_this.params.data.length;i++)_this.params.data[i]={..._this.params.data[i],index:i},_this.createFragment(CarouselLink,AppState.createLocal(_this.params.data[i]))}()},_this.onMounted=async()=>{await _this.wait("element"),function setupSlider(){_this.slider=_this.initClass(Interaction.Slider,_this.sliderObj,{x:1},{hit:_this.element,width:[..._this.element.children()][0].offsetWidth,slides:_this.params.data.length,gap:12}),_this.slider.maxSlides=_this.params.data.length-1,_this.slider.interpolate=.3,_this.slider.ease="easeOutCubic",_this.slider.easeTime=750,_this.slider.flickable=!0}(),_this.onResize(handleResize),function addHandlers(){_this.events.sub(_this.slider,Interaction.Slider.START_INTERACTION,_=>{_this.fire("LinkCarouselSlider/slider_interact",{action:"start"})}),_this.events.sub(_this.slider,Interaction.Slider.MOVE,_=>{_this.fire("LinkCarouselSlider/slider_interact",{action:"move"})}),_this.events.sub(_this.slider,Interaction.Slider.END_INTERACTION,_=>{_this.fire("LinkCarouselSlider/slider_interact",{action:"end"})})}(),_this.isReady=!0},_this.listen("LinkCarouselSlider/prev",()=>{_this.slider.prev()}),_this.listen("LinkCarouselSlider/next",()=>{_this.slider.next()}),_this.cardsReady=async()=>(await _this.wait("isReady"),!0),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LinkCarouselSlider"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LoaderView(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="LoaderView",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.params.loader,Events.COMPLETE,async _=>{await _this.wait("animatedIn"),await async function animateOut(){return _this.element.tween({opacity:0},300,"easeOutCubic").promise()}(),_this.destroy()}),_this.onInit=_=>{!async function animateIn(){_this.flag("animatedIn",!0)}()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LoaderView"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LocationCard(_data,_index,_params){const _this=this;Inherit(_this,Element),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="LocationCard",_this.contexts="Element,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"location-card",_type:"div",refName:"unnamed",children:[{className:"location-card__content",_type:"div",refName:"unnamed",children:[{className:"location-card__location",_type:"div",refName:"text",children:[{_type:"p",refName:"location",children:[]}]},{className:"location-card__images",_type:"div",refName:"image",children:[{imageWithMeta:"$data.image1",cropAspect:1.8,className:"location-card__image",_type:"ResponsiveImage",refName:"image",children:[]}]},{className:"location-card__text",_type:"div",refName:"text",children:[{_type:"p",_innerText:"$data.description",refName:"unnamed",children:[]}]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"city",function handleLocation(city){city&&_this.location.text(`${city}, ${_this.data.nation}`)}),_this.hide=_=>{_this.element.hide()},_this.show=_=>{_this.element.show()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LocationCard"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LocationListItem(_data,_index,_params){const _this=this;Inherit(_this,Element),Inherit(_this,ViewStateElement),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="LocationListItem",_this.contexts="Element,ViewStateElement,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"LocationListItem__container",onClick:"$handleClick",_type:"div",refName:"unnamed",children:[{className:"LocationListItem__leftContent",_type:"div",refName:"unnamed",children:[{className:"LocationListItem__index",_type:"div",refName:"unnamed",children:[{_type:"span",refName:"indexElement",children:[]}]},{className:"LocationListItem__city",_type:"div",refName:"unnamed",children:[{_type:"span",_innerText:"$data.city",refName:"unnamed",children:[]}]}]},{className:"LocationListItem__state",_type:"div",refName:"unnamed",children:[{_type:"span",_innerText:"$data.state",refName:"stateElement",children:[]},{_type:"span",_innerText:"$data.nation",refName:"nationElement",children:[]}]}]},{_type:"div",refName:"separator",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.indexElement.text(String(_this.data.siteIndex+1).padStart(2,"0")),_this.data.state||_this.stateElement.hide(),_this.data.nation||_this.nationElement.hide(),_this.onMounted=()=>{_this.separator.transform({scaleX:0}),_this.element.css({opacity:0}).transform({x:"-10%"})},_this.handleClick=()=>{_this.createFragment(LocationModal,{location:_this.data.city,state:[_this.data.state,_this.data.nation].filter(Boolean).join(", "),description:_this.data.description,image1:_this.data?.image1,image2:_this.data?.image2,alt:_this.data.alt,noBackdropFilter:!0,backdropOpacity:1}).open()},_this.onInView=()=>{!function animateIn(){_this.separator.tween({scaleX:1},1500,"easeOutExpo"),_this.element.tween({x:"0%",opacity:1},1500,"easeOutExpo")}()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LocationListItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LocationModal(_params,...restArgs){const _this=this;Inherit(_this,ModalView,{fade:!1,backdropOpacity:1}),Inherit(_this,XComponent),_this.fragName="LocationModal",_this.contexts="ModalView, { fade: false, backdropOpacity: 1 }",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"LocationModal__container",_type:"div",refName:"container",children:[{className:"LocationModal__content",_type:"div",refName:"content",children:[{className:"LocationModal__content__location",_type:"div",_innerText:"$params.location",refName:"unnamed",children:[]},{className:"LocationModal__content__state",_type:"div",_innerText:"$params.state",refName:"unnamed",children:[]},{className:"LocationModal__content__image-container",_type:"div",refName:"unnamed",children:[{imageWithMeta:"$params.image1",cropAspect:1.8,className:"LocationModal__content__image",_type:"ResponsiveImage",refName:"image1",children:[]},{imageWithMeta:"$params.image2",cropAspect:1.8,className:"LocationModal__content__image",_type:"ResponsiveImage",refName:"image2",children:[]}]},{className:"LocationModal__content__description",_type:"div",_innerText:"$params.description",refName:"unnamed",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onMounted=_=>{!function initLocationModalLenis(){const lenisOptions={wrapper:_this.container.div,content:_this.content.div,duration:.8,easing:TweenManager.Interpolation.Quart.Out,direction:"vertical",gestureDirection:"vertical",smooth:!0,smoothTouch:!1,touchMultiplier:2,lerp:!1};_this.state.locationModalLenis=new Lenis(lenisOptions),_this.startRender(_=>{_this.state.locationModalLenis&&_this.state.locationModalLenis.raf(_)})}()},_this.onOpen=_=>{Stage.add(_this.element),Global.lenis.stop(),_this.element.transform({x:"100%"}),_this.element.tween({x:"0%"},250,"easeInOutQuad")},_this.close=_=>{_this.element.tween({x:"100%"},250,"easeInOutQuad").onComplete(()=>{Global.lenis.start(),_this.element.hide(),_this.element.destroy()})},_this.element.hide(),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LocationModal"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LocationPoint(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,TextAnimationHelper),Inherit(_this,XComponent),_this.fragName="LocationPoint",_this.contexts="Element,TextAnimationHelper",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"location-point",_type:"div",refName:"unnamed",children:[{_type:"button",refName:"pointer",children:[{id:"pointer-dot",_type:"Sprite",refName:"pointerDot",children:[]},{id:"pointer-circle",_type:"Sprite",refName:"pointerCiccle",children:[]}]},{className:"location-point__line",_type:"div",refName:"line",children:[]},{className:"location-point__location",_type:"div",refName:"unnamed",children:[{className:"location-point__location-name",_type:"div",refName:"unnamed",children:[{className:"location-point__location-cityState",_type:"div",_innerText:"$params.cityState",refName:"cityState",children:[]}]},{className:"location-point__location-nation",_type:"div",_innerText:"$params.nation",refName:"nation",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let timeout,timeoutClicked,onInit=_this.onInit,isActive=!1,isVisible=!1;_this.mounted=Promise.create();let isOver=!1;function animateIn(){_this.line.tween({scaleX:1},500,"easeOutSine"),_this.cityState.tween({opacity:1},500,"easeOutSine",200),_this.nation.tween({opacity:1},500,"easeOutSine",280),_this.animateText(_this.cityState,650,!0),_this.animateText(_this.nation,650,!0),isVisible=!0}function animateOut(){_this.line.tween({scaleX:0},300,"easeOutSine"),_this.cityState.tween({opacity:0},300,"easeOutSine"),_this.nation.tween({opacity:0},300,"easeOutSine"),_this.animateText(_this.cityState,300,!1),_this.animateText(_this.nation,300,!1),isVisible=!1,_this.state.isActive=!1}_this.animateIn=()=>{_this.params.index===_this.get("active",!0)&&animateIn()},_this.animateOut=()=>{animateOut()},_this.onMounted=()=>{_this.pointer.attr("data-index",_this.params.index),_this.pointer.transform({scale:.8}),_this.pointerDot.element.classList().add("pointer-dot"),_this.pointerCiccle.element.classList().add("pointer-circle"),_this.line.transform({scaleX:0}),_this.cityState.css({opacity:0}),_this.nation.css({opacity:0}),_this.pointer.bind("click",_=>{_this.fire("clicked",{element:_this.element.div,index:_this.params.index})}),_this.pointer.bind("mouseover",_=>{_this.fire("over",{element:_this.element.div,index:_this.params.index})}),_this.pointer.bind("mouseout",_=>{_this.fire("out",{element:_this.element.div,index:_this.params.index})}),_this.listen("clicked",({element:element})=>{clearTimeout(timeoutClicked),element!==_this.element.div?(_this.pointer.classList().remove("active"),_this.pointer.tween({scale:.8},300,"easeOutSine"),isActive=!1):(_this.pointer.classList().add("active"),timeoutClicked=setTimeout(()=>{_this.pointer.tween({scale:1.2},500,"easeOutSine")},700),isVisible||animateIn(),isActive=!0,_this.set("active",_this.params.index))}),_this.listen("LocationPoint/clicked",({element:element,index:index})=>{element!==_this.element.div?(animateOut(),isActive=!1):(animateIn(),isActive=!0,_this.set("active",_this.params.index))}),_this.listen("over",({element:element})=>{element!==_this.element.div?animateOut():animateIn(),isOver=!0}),_this.listen("out",()=>{clearTimeout(timeout),_this.params.index===_this.get("active",!0)?timeout=setTimeout(()=>{isOver||animateIn()},500):animateOut(),isOver=!1}),_this.mounted.resolve()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LocationPoint"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function LocationsSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,FXSceneSlice,{sceneLayoutName:"PointGlobeScene"}),Inherit(_this,XComponent),_this.fragName="LocationsSlice",_this.contexts="ViewStateElement,FXSceneSlice, { sceneLayoutName: 'PointGlobeScene' }",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"border top",_type:"div",refName:"unnamed",children:[]},{className:"border bottom",_type:"div",refName:"unnamed",children:[]},{className:"border left",_type:"div",refName:"unnamed",children:[]},{className:"border right",_type:"div",refName:"unnamed",children:[]},{className:"location-slice__title",_type:"div",_innerText:"\n            Anduril Around The World\n        ",refName:"title",children:[]},{className:"location-slice__container",_type:"div",refName:"container",children:[{className:"location-slice__nav",_type:"div",refName:"unnamed",children:[{icon:"left-arrow",onClick:function handlePrevGlobe(){_this.locationDOMElements[_this.currentLocationIndex].animateOut(),_this.currentLocationIndex--,_this.currentLocationIndex<0&&(_this.currentLocationIndex=_this.locations.length-1);updateGlobeLocation()},_type:"CircleButton",refName:"prevButton",children:[]},{icon:"arrow-right",onClick:function handleNextGlobe(){_this.locationDOMElements[_this.currentLocationIndex].animateOut(),_this.currentLocationIndex++,_this.currentLocationIndex>=_this.locations.length&&(_this.currentLocationIndex=0);updateGlobeLocation()},_type:"CircleButton",refName:"nextButton",children:[]}]},{className:"location-slice__selected",_type:"div",refName:"locationPoints",children:[]},{className:"location-slice__content",_type:"div",refName:"locationContainer",children:[{view:"LocationCard",data:"$data.locations",_type:"ViewState",refName:"viewLocations",children:[]}]},{className:"location-slice__list",_type:"div",refName:"locationList",children:[{view:"LocationListItem",_type:"ViewState",refName:"viewLocationItems",children:[]},{className:"location-slice__pagination",_type:"div",refName:"pagination",children:[{icon:"left-arrow",onClick:function handlePrev(){_this.currentPage>1&&(_this.currentPage--,updatePaginatedData(),scrollToTop())},_type:"CircleButton",refName:"prevButton",children:[]},{className:"location-slice__page-info",_type:"span",refName:"pageInfo",children:[]},{icon:"arrow-right",onClick:function handleNext(){_this.currentPage<_this.totalPages&&(_this.currentPage++,updatePaginatedData(),scrollToTop())},_type:"CircleButton",refName:"nextButton",children:[]}]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;const requiresFallback=Tests.requiresFallbackGraphics();let sceneCamera,orbitCamera;function updatePaginatedData(){const startIndex=(_this.currentPage-1)*_this.itemsPerPage,endIndex=startIndex+_this.itemsPerPage,paginatedLocations=_this.locations.slice(startIndex,endIndex).map((location,index)=>({...location,siteIndex:startIndex+index}));_this.pagination.invisible(),_this.paginatedStateArray.refresh(paginatedLocations),_this.pageInfo.empty();let startPage=Math.max(1,_this.currentPage-Math.floor(3.5)),endPage=Math.min(_this.totalPages,startPage+7-1);if(endPage===_this.totalPages?(startPage=Math.max(1,endPage-7+1),_this.pagination.show()):_this.pagination.show(),_this.prevButton.setDisabled(1===_this.currentPage),startPage>1){const firstPageButton=_this.pageInfo.create("firstPageButton","button");firstPageButton.text("1"),firstPageButton.div.className="location-slice__page-number",firstPageButton.bind("click",()=>{_this.currentPage=1,updatePaginatedData(),scrollToTop()});const firstEllipsis=_this.pageInfo.create("firstEllipsis","span");firstEllipsis.text("..."),firstEllipsis.div.className="location-slice__page-ellipsis"}for(let i=startPage;i<=endPage;i++){const pageButton=_this.pageInfo.create(`pageButton${i}`,"button");pageButton.text(i),pageButton.div.className="location-slice__page-number",i===_this.currentPage&&pageButton.div.classList.add("active"),pageButton.bind("click",()=>{_this.currentPage=i,updatePaginatedData(),scrollToTop()})}if(endPage<_this.totalPages){const lastEllipsis=_this.pageInfo.create("lastEllipsis","span");lastEllipsis.text("..."),lastEllipsis.div.className="location-slice__page-ellipsis";const lastPageButton=_this.pageInfo.create("lastPageButton","button");lastPageButton.text(_this.totalPages),lastPageButton.div.className="location-slice__page-number",lastPageButton.bind("click",()=>{_this.currentPage=_this.totalPages,updatePaginatedData(),scrollToTop()})}_this.nextButton.setDisabled(_this.currentPage===_this.totalPages),_this.delayedCall(_=>{_this.pagination.visible(),_this.viewLocationItems.views.map(view=>{view.onInView()})},100)}function scrollToTop(){defer().then(()=>{Global.lenis?.scrollTo(_this.element.div.offsetTop,{duration:1,lerp:.1})})}function updateGlobeLocation(){_this.fire("LocationPoint/clicked",{element:_this.locationDOMElements[_this.currentLocationIndex].element.div,index:_this.currentLocationIndex})}function cartesianToSpherical(lat,lon,radius=1){var phi=lat*Math.PI/180,theta=lon*Math.PI/180,x=-radius*Math.cos(phi)*Math.cos(theta),y=radius*Math.sin(phi),z=radius*Math.cos(phi)*Math.sin(theta);return new Vector3(x,y,z)}_this.currentPage=1,_this.itemsPerPage=5,_this.totalPages=1,_this.currentLocationIndex=0,_this.locations=Array.from(_this.data.locations),_this.paginatedStateArray=new StateArray([]),_this.topClip=0,_this.locationMeshes=[],_this.locationDOMElements=[],_this.bind(_this.data,"title",title=>_this.title.text(title)),_this.onInit=async()=>{sceneCamera=requiresFallback?World.CAMERA:Utils3D.findParentCamera(_this.layout.group),requiresFallback||(orbitCamera=await _this.layout.getLayer("orbit_camera"),orbitCamera.orbit.lock()),await defer();const _input=_this.initClass(Interaction,Stage);_this.events.sub(_input,Interaction.START,()=>{_this.fire("LocationPoint/animateOut")}),_this.events.sub(_input,Interaction.END,()=>{_this.fire("LocationPoint/animateIn")}),_this.bind(_this.data,"locations",async locations=>{locations&&(_this.totalPages=Math.ceil(_this.data.locations.length/_this.itemsPerPage),_this.viewLocationItems.setSourceData(_this.paginatedStateArray),updatePaginatedData(),await _this.wait(_=>_this.viewLocations?.views?.length===locations.length),_this.viewLocations.views.forEach((view,i)=>{if(view.hide(),Hydra.LOCAL&&Utils.query("debug")){const mesh=new Mesh(new SphereGeometry(.05,32,32),Utils3D.getTestShader(0===i&&new Color(1,0,0)));mesh.position.copy(cartesianToSpherical(view.data.latitude,view.data.longitude)),_this.scene.add(mesh)}const position=cartesianToSpherical(view.data.latitude,view.data.longitude);_this.locationMeshes.push(position.clone().multiplyScalar(.9).sub({x:0,y:-.2,z:0}));const locationPoint=_this.createFragment(LocationPoint,{cityState:`${view.data.city}`,nation:view.data.nation,index:i},[_this.locationPoints]);view.locationPoint=locationPoint,0===i&&locationPoint.mounted.then(()=>{_this.fire("LocationPoint/clicked",{element:locationPoint.element.div,index:0})}),_this.locationDOMElements.push(locationPoint)}))})},(async()=>{await _this.wait(_=>Stage?.div?.contains(_this.element?.div)),_this.onResize(()=>{!function setSizeGlobeContainer(){const containerBbox=_this.container.div.getBoundingClientRect(),locationContainerBbox=_this.locationContainer.div.getBoundingClientRect();_this.globeContainerWidth=containerBbox.width-locationContainerBbox.width+20}(),function resize(){Responsive.isMobile()||Device.mobile.phone?(_this.element.classList().add("mobile"),_this.locationList.show(),_this.locationContainer.hide(),_this.locationPoints.hide(),_this.layout&&_this.layout.group&&(_this.layout.group.visible=!1,_this.flag("preventVisible",!0))):(_this.element.classList().remove("mobile"),_this.locationList.hide(),_this.locationContainer.show(),_this.locationPoints.show(),_this.layout&&_this.layout.group&&(_this.layout.group.visible=!0,_this.flag("preventVisible",!1)))}()},!0),_this.startRender(()=>{!function updateDOMPositions(){if(!_this.locationMeshes||!sceneCamera)return;_this.scene.updateMatrixWorld(!0);const cameraPosition=sceneCamera.getWorldPosition(new Vector3);_this.locationMeshes.forEach((meshPosition,index)=>{const domElement=_this.locationDOMElements[index];if(domElement&&domElement?.element?.div){const screenPosition=ScreenProjection.find(sceneCamera).project(meshPosition),pointDirection=meshPosition.clone().normalize(),cameraDirection=cameraPosition.clone().normalize(),dotProduct=pointDirection.dot(cameraDirection),opacity=Math.range(dotProduct,-1,1,0,1,!0);domElement.element.div.style.opacity=opacity,domElement.element.div.style.transform=`translate(0%, 0%) translate(${screenPosition.x-_this.container.div.offsetLeft}px, ${screenPosition.y-_this.container.div.offsetTop}px)`}})}()})})(),_this.listen("LocationPoint/clicked",({element:element,index:index})=>{requiresFallback||(_this.globeStatic=!1,_this.viewLocations.views.forEach((view,i)=>{i===index?(view.show(),_this.locationMeshes[i]&&(orbitCamera.orbit.center(view.data.latitude,view.data.longitude+180),setTimeout(()=>{_this.globeStatic=!0},1e3))):view.hide()}))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"LocationsSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function Media(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="Media",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"Media__container",_type:"div",refName:"unnamed",children:[{className:"Media__video",_type:"div",refName:"video",children:[{videoWithMeta:"$params.video",loop:!0,autoplay:!0,_type:"ResponsiveVideo",refName:"videoLoop",children:[]}]},{className:"Media__image",_type:"div",refName:"image",children:[{imageWithMeta:"$params.image",sizes:"(min-width: 769px) 100vw, 100vw",cropAspect:"$state.crop",_type:"ResponsiveImage",refName:"previewImage",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.isMobile=Stage.width<769,_this.onResize(_=>_this.state.isMobile=Stage.width<769),_this.bind(_this.state,"isMobile",isMobile=>{_this.state.crop=isMobile?.8:null}),_this.params?.video?._type?(_this.video.show(),_this.image.hide()):(_this.video.hide(),_this.image.show()),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"Media"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function MediaAccordionItem(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element,"button"),Inherit(_this,ScrollUtils),Inherit(_this,XComponent),_this.fragName="MediaAccordionItem",_this.contexts="ViewStateElement,Element, 'button',ScrollUtils",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"border",children:[]},{_type:"div",refName:"header",children:[{_type:"p",refName:"index",children:[]},{_type:"h4",refName:"title",children:[]}]},{_type:"div",refName:"content",children:[{content:"$data.description",_type:"RichText",refName:"description",children:[]},{content:"$data.fullBleedDescription",_type:"RichText",refName:"fullBleedDescription",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;async function setMargin(){await _this.wait("content"),await _this.wait("header"),_this.state.isMobile?_this.content.css({top:0}):_this.content.css({top:`-${_this.header.div.offsetHeight}px`})}_this.state.hasScrolled=!1,_this.data.fullBleedDescription||_this.fullBleedDescription.element.hide(),_this.onMounted=()=>{!async function setState(){await _this.wait("content"),_this.state.isMobile=Stage.width<768,_this.state.isOpen=!1,_this.state.contentHeight=_this.content.div.scrollHeight}(),setMargin(),setLabel()},_this.fullBleedDescription.element.onResize(()=>{_this.state.contentHeight=_this.content.div.scrollHeight}),_this.element.onResize(()=>{_this.state.contentHeight=_this.content.div.scrollHeight}),_this.onResize(function resize(){_this.state.isMobile=Stage.width<768,setMargin()}),_this.bind(_this.data,"color",color=>{color&&(_this.border.css({background:SanityUtils.stegaClean(color.contrastColor)}),_this.header.css({color:SanityUtils.stegaClean(color.contrastColor)}),_this.content.css({color:SanityUtils.stegaClean(color.contrastColor)}))}),_this.bind(_this.data,"index",index=>{void 0!==index&&(_this.index.text(`0${index+1}`),setLabel())}),_this.bind(_this.data,"title",title=>{title&&(_this.title.text(title),setLabel())}),_this.bind(_this.state,"isOpen",function handleIsOpen(isOpen){isOpen?(_this.content.tween({height:_this.state.contentHeight},800,"easeOutSine"),_this.element.attr("aria-expanded","true"),_this.content.attr("aria-hidden","false")):(_this.content.tween({height:0},800,"easeOutSine"),_this.element.attr("aria-expanded","false"),_this.content.attr("aria-hidden","true"))}),_this.element.bind("click",function toggleOpen(){_this.state.isOpen=!_this.state.isOpen}),_this.bind(_this.state,"scrollProgress",function handleScrollProgress(progress){if(_this.flag("hasClickedLink"))return;let delta=Math.abs(progress-previous);if(previous=progress,progress===1/0||delta>.5)return;progress>1.5&&progress<2&&!_this.state.hasScrolled&&(_this.state.hasScrolled=!0,_this.state.isOpen=!0)}),_this.listen("BookHeaderLink/click",_=>_this.flag("hasClickedLink",!0,1e3));let previous=0;function setLabel(){_this.element.attr("role","button"),_this.element.attr("aria-labelledby",_this.data.title),_this.element.attr("aria-label",`Section ${_this.data.index+1}: ${_this.data.title}`),_this.element.attr("aria-describedby",_this.data._key),_this.content.attr("id",_this.data._key)}onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"MediaAccordionItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function MediaAccordionSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="MediaAccordionSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{view:"MediaAccordionItem",data:"$state.items",_type:"ViewState",refName:"vs",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.items=new StateArray,_this.onInit=()=>{let items=[];_this.data.items.forEach((item,index)=>{items.push({...item,color:_this.data.backgroundColor,index:index})}),_this.state.items.refresh(items)},_this.bind(_this.data,"backgroundColor",backgroundColor=>{backgroundColor&&_this.element.css({background:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"MediaAccordionSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function MediaCaptionBlock(_params,...restArgs){const _this=this;Inherit(_this,Element,"div"),Inherit(_this,BindUtils),Inherit(_this,XComponent),_this.fragName="MediaCaptionBlock",_this.contexts="Element, 'div',BindUtils",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"mediaContainer",children:[]},{_type:"div",refName:"captionContainer",children:[{_type:"RichText",refName:"column1",children:[]},{_type:"RichText",refName:"column2",children:[]},{_type:"RichText",refName:"column3",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function updateMedia(media){media&&(_this.state.media=_this.initClass(ResponsiveMedia,AppState.createLocal({...media[0]}),0,AppState.createLocal(),[_this.mediaContainer]))}function updateColumn1(column1){column1?(_this.column1.element.show(),_this.column1.params.content=column1):_this.column1.element.hide()}function updateColumn2(column2){column2?(_this.column2.element.show(),_this.column2.params.content=column2):_this.column2.element.hide()}function updateColumn3(column3){column3?(_this.column3.element.show(),_this.column3.params.content=column3):_this.column3.element.hide()}_this.onMounted=async()=>{await _this.wait("mediaContainer"),_this.column1.element.hide(),_this.column2.element.hide(),_this.column3.element.hide(),_this.bindToNestedParams("mediaCaptionBlock",bind=>{bind("media",updateMedia),bind("column1",updateColumn1),bind("column2",updateColumn2),bind("column3",updateColumn3)})},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"MediaCaptionBlock"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function MediaLinkCard(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="MediaLinkCard",_this.contexts="ViewStateElement,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"content-wrapper",_type:"div",refName:"contentWrapper",children:[{_type:"div",refName:"topWrapper",children:[{_type:"h5",_innerText:"$data.title",refName:"title",children:[]},{_type:"CtaButton",refName:"cta",children:[]}]},{_type:"div",refName:"border",children:[]},{_type:"div",refName:"bottomWrapper",children:[{_type:"h5",_innerText:"$data.label",refName:"label",children:[]},{imageWithMeta:"$data.image",sizes:"(min-width: 769px) 100vw, 100vw",cropAspect:1.8,_type:"ResponsiveImage",refName:"previewImage",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.data.label||_this.label.hide(),_this.bind(_this.data,"color",function handleColor(color){_this.element.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)}),_this.contentWrapper.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)}),_this.bottomWrapper.css({color:SanityUtils.stegaClean(color.contrastColor)})}),_this.data.image||(_this.border.show(),_this.previewImage.element.hide()),_this.bind(_this.data,"cta",function setCta(cta){cta&&(_this.cta.params.data=cta[0])}),_this.onMounted=()=>{_this.border.transform({scaleX:0}),[_this.topWrapper,_this.label,_this.previewImage.element].forEach(element=>{element.transform({x:"-10%"}).css({opacity:0})}),async function setLabel(){await _this.wait("cta"),_this.cta.element.attr("aria-label",`Read more about ${_this.data.title}`)}()},_this.onInView=()=>{!function animateIn(){_this.border.tween({scaleX:1},1500,"easeOutExpo"),[_this.topWrapper,_this.label,_this.previewImage.element].forEach((element,index)=>{element.tween({x:"0%",opacity:1},1e3,"easeOutExpo",100*index).promise()})}()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"MediaLinkCard"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function MediaLinkSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="MediaLinkSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"sticky-wrapper",_type:"div",refName:"unnamed",children:[{view:"MediaLinkCard",data:"$data.cards",_type:"ViewState",refName:"vs",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"MediaLinkSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function MediaQuad(_mesh,_shader,_input,_group){const _this=this;if(Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="MediaQuad",_this.contexts="Component",_this.mesh=_mesh,_this.shader=_shader,_this.uilInput=_input,_this.uilFolder=_group,_this.uilFolder?.addButton){let a=_this.uilFolder;_this.uilFolder=_this.uilInput,_this.uilInput=a}this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.mesh.frustumCulled=!1,_this.shader.addUniforms({tMap:{value:null,getTexture:function getTexture(name){_this.media&&(_this.media=_this.media.destroy());if((async()=>{await _this.wait(_=>_this.media&&(_this.media.texture||_this.media.isTexture));let texture=_this.media.texture||_this.media;await texture.promise,_this.shader.uniforms.uAspect.value.set(texture.dimensions.width,texture.dimensions.height)})(),name.includes(".mp4"))return _this.media=_this.mesh.media=_this.initClass(VideoTexture,name,{preload:!1}),_this.isPlayground()||_this.start(),_this.media;return _this.media=_this.mesh.media=Utils3D.getTexture(name),_this.media}},uOffset:{value:new Vector2},uAspect:{value:new Vector2(1,1),ignoreUIL:!0},uScale:{value:new Vector2(1,1)}}),_this.start=_this.mesh.start=function(){_this.media&&_this.media.start&&_this.media.start()},_this.stop=_this.mesh.stop=function(){_this.media&&_this.media.stop&&_this.media.stop()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"MediaQuad"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function MediaRessourceCard(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,Element,"a"),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="MediaRessourceCard",_this.contexts="ViewStateElement,TextAnimationHelper,Element, 'a',InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"image-container",_type:"div",refName:"unnamed",children:[{disableLiveEditOverlay:!0,imageWithMeta:"$data.image",sizes:"(min-width: 769px) 20vw, 100vw",_type:"ResponsiveImage",refName:"unnamed",children:[]}]},{className:"flex-container",_type:"div",refName:"unnamed",children:[{_type:"h6",_innerText:"$data.caption",refName:"caption",children:[]},{_type:"div",refName:"downloadIcon",children:[{id:"download",_type:"Sprite",refName:"icon",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function updateLink(){_this.element.attr("target","_blank").attr("rel","noopener noreferrer").attr("aria-label",`Download ${_this.data?.caption}`).attr("href",_this.data?.image?.asset?.url)}function animateIn(){_this.element.tween({x:"0%",opacity:1},1e3,"easeOutExpo")}_this.onMounted=()=>{_this.bind(_this.data,"image",updateLink),_this.bind(_this.data,"caption",updateLink),_this.element.click(_this.downloadImage),_this.element.transform({x:"-10%"}).css({opacity:0}),_this.element.div.getBoundingClientRect().top<window.innerHeight&&animateIn()},_this.downloadImage=e=>{e.preventDefault(),ImageUtils.download(_this.data.image.asset.url,_this.data.caption)},_this.element.hover(e=>{}),_this.onInView=()=>{animateIn()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"MediaRessourceCard"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function MediaRessourceSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="MediaRessourceSlice",_this.contexts="ViewStateElement,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{text:"$data.description",_type:"p",refName:"description",children:[]},{_type:"div",refName:"border",children:[]},{className:"container",_type:"div",refName:"unnamed",children:[{_type:"h5",_innerText:"$data.title",refName:"title",children:[]},{className:"wrapper",_type:"div",refName:"unnamed",children:[{view:"MediaRessourceCard",data:"$data.mediaRessourceCards",_type:"ViewState",refName:"unnamed",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function animateIn(){_this.border.tween({scaleX:1},1e3,"easeOutExpo"),[_this.description,_this.title].forEach((element,index)=>{element.tween({x:"0%",opacity:1},1e3,"easeOutExpo")})}_this.onMounted=()=>{_this.border.transform({scaleX:0}),[_this.description,_this.title].forEach(element=>{element.transform({x:"-10%"}).css({opacity:0})}),_this.border.div.getBoundingClientRect().top<window.innerHeight&&animateIn()},_this.onInView=()=>{animateIn()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"MediaRessourceSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function MenaceTestScene(_params,...restArgs){const _this=this;Inherit(_this,FragFXScene,_params?.sceneLayoutName||"MenaceTestScene"),Inherit(_this,XComponent),_this.fragName="MenaceTestScene",_this.contexts='FragFXScene, _params?.sceneLayoutName || "MenaceTestScene"',_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this._initFXScene(World.NUKE,null,{format:void 0,type:void 0,minFilter:void 0,magFilter:void 0,multiRenderTarget:void 0,mipmaps:void 0,screenQuad:void 0,vrMode:void 0,multisample:void 0,samplesAmount:void 0}),(_this.nuke||World.NUKE).paused=!0,_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_this.composite=_this.initClass(NukePass,AppState.createLocal({shader:"MovecComposite",uniforms:_this.uniforms})),_this.composite.isFragment&&_promises.push(_this.wait(_this.composite,"__ready")),_this.nuke&&(_this.composite.texture=_this.nuke.rttBuffer),_this.bloom=_this.initClass(FX.UnrealBloom,AppState.createLocal({unique:"menacex",nuke:_this.nuke,dpr:.5,enabled:!0})),_this.bloom.isFragment&&_promises.push(_this.wait(_this.bloom,"__ready")),_this.bloom.uniforms&&_this.composite.addUniforms(_this.bloom.uniforms),(_this.composite.upload||_this.composite.pass)&&((_this.nuke||World.NUKE).add(_this.composite.pass instanceof NukePass?_this.composite.pass:_this.composite),ShaderUIL.add(_this.composite.pass instanceof NukePass?_this.composite.pass:_this.composite)),(_this.nuke||World.NUKE).paused=!1,_promises=null,_this.flag?.("__ready",!0),onInit||"MenaceTestScene"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function MobileFilter(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="MobileFilter",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"mobileToggles",children:[{click:toggleSearch,role:"button",_type:"button",_innerText:"Search",refName:"searchButton",children:[]},{click:toggleCategories,role:"button",_type:"button",refName:"categoriesButton",children:[{_type:"span",_innerText:"Filters",refName:"unnamed",children:[]},{id:"plus",_type:"Sprite",refName:"filterIcon",children:[]}]}]},{_type:"form",refName:"searchForm",children:[{_type:"div",refName:"searchWrapper",children:[{type:"text",placeholder:"Search",_type:"input",refName:"search",children:[]},{id:"search",_type:"Sprite",refName:"searchIcon",children:[]}]},{type:"button",click:toggleSearch,"aria-label":"Close search filter",role:"button",_type:"button",refName:"closeButtonSearch",children:[{id:"close",_type:"Sprite",refName:"closeIcon",children:[]}]}]},{_type:"form",refName:"categoryForm",children:[{_type:"ul",refName:"categoryWrapper",children:[{_type:"p",_innerText:"Sort by",refName:"sortBy",children:[]},{view:"NewsListCategory",data:"$params.categories",_type:"ViewState",refName:"filterItem",children:[]}]},{type:"button",click:toggleCategories,"aria-label":"Close categories filter",role:"button",_type:"button",refName:"closeButtonCategory",children:[{id:"close",_type:"Sprite",refName:"closeIcon",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function toggleCategories(){_this.state.categoriesToggle=!_this.state.categoriesToggle,_this.state.categoriesToggle&&(_this.state.searchToggle=!1)}function toggleSearch(){_this.state.searchToggle=!_this.state.searchToggle,_this.state.searchToggle&&(_this.state.categoriesToggle=!1)}async function viewStateReady(vs,data){return _this.wait(_=>vs.views.length===data.length)}_this.params.categories=_this.params.categories||[],_this.parent=_this.findParent("NewsListSlice"),_this.parent.state.bind("categorySlug",slug=>{_this.state.categorySlug=slug}),_this.parent.state.bind("search",search=>{_this.state.search=search}),_this.state.categoriesToggle=!1,_this.state.searchToggle=!1,_this.state.search="",_this.state.categorySlug="",_this.searchForm.hide(),_this.categoryForm.hide(),_this.search.bind("input",function handleSearch(e){_this.state.search=_this.search.val()}),_this.search.bind("submit",e=>{e.preventDefault(),_this.state.searchToggle=!1}),_this.search.bind("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),_this.state.searchToggle=!1)}),_this.categoryWrapper.bind("input",function handleCategory(e){let selectedValue=_this.categoryWrapper.div.querySelector("input:checked")?.value;_this.state.categorySlug=selectedValue,_this.state.categoriesToggle=!1}),_this.bind(_this.state,"search",function updateTextInput(){_this.search.val(_this.state.search?_this.state.search:"")}),_this.bind(_this.state,"categorySlug",async function updateCategoryInput(){await defer(),await viewStateReady(_this.filterItem,_this.params.categories);let selectedCategory=_this.state.categorySlug;_this.filterItem.views.forEach(view=>{let radioButton=view.input.div;radioButton.value===selectedCategory&&(radioButton.checked=!0)})}),_this.bind(_this.state,"categoriesToggle",async toggle=>{if(toggle){_this.categoryForm.show(),_this.categoryForm.attr("tabindex",0),_this.categoryForm.div.focus(),await defer(),await viewStateReady(_this.filterItem,_this.params.categories);let selectedCategory=_this.state.categorySlug;_this.filterItem.views.forEach(view=>{let radioButton=view.input.div;radioButton.value===selectedCategory&&radioButton.focus()})}else _this.categoryForm.hide()}),_this.bind(_this.state,"searchToggle",toggle=>{toggle?(_this.searchForm.show(),_this.search.div.focus()):(_this.searchForm.hide(),_this.search.div.blur())}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"MobileFilter"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ModalFormSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="ModalFormSlice",_this.contexts="ViewStateElement,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"h5",_innerText:"$data.title",refName:"title",children:[]},{_type:"div",refName:"border",children:[]},{_type:"div",refName:"container",children:[{_type:"h6",_innerText:"$data.col1",refName:"col1",children:[]},{_type:"h6",_innerText:"$data.col2",refName:"col2",children:[]},{_type:"div",refName:"col3",children:[{_type:"p",_innerText:"$data.col3Text",refName:"unnamed",children:[]},{className:"internalLink",click:"$openForm",role:"button",_type:"button",refName:"button",children:[{_type:"span",_innerText:"$data.col3FormLink",refName:"unnamed",children:[]},{id:"top-right-arrow",_type:"Sprite",refName:"icon",children:[]}]},{data:"$data.col3ExternaLink",_type:"CtaButton",refName:"ctaButton",children:[]}]}]},{_type:"SideModalView",refName:"sideModalView",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.data.col3FormLink||_this.button.hide(),_this.data.col3ExternaLink||_this.ctaButton.element.hide();const formComponent=_this.createFragment(FormComponent,{data:_this.data.form},[_this.sideModalView.panel]);_this.bind(_this.data,"backgroundColor",backgroundColor=>{backgroundColor&&(_this.element.css({backgroundColor:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)}),_this.col3.css({color:SanityUtils.stegaClean(backgroundColor.contrastColor)}),_this.button.css({color:SanityUtils.stegaClean(backgroundColor.contrastColor)}),_this.ctaButton.element.css({color:SanityUtils.stegaClean(backgroundColor.contrastColor)}))}),_this.onMounted=function(){const panelBgColor=window.getComputedStyle(_this.element.div).getPropertyValue("--bgColor");_this.sideModalView.params.panelBgColor=panelBgColor,_this.border.transform({scaleX:0}),[_this.title,_this.col1,_this.col2,_this.col3].forEach(element=>{element.transform({x:"-10%"}).css({opacity:0})})},_this.onInView=function(){_this.border.tween({scaleX:1},1500,"easeOutExpo"),[_this.title,_this.col1,_this.col2,_this.col3].forEach((element,index)=>{element.tween({x:"0%",opacity:1},1500,"easeOutExpo",100*index)})},_this.openForm=function(){formComponent.showForm(),_this.sideModalView.open()},Utils.query("form")&&(Utils.removeQuery("form"),_this.openForm()),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ModalFormSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ModalView(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="ModalView",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"backdrop",onClick:"$close",_type:"div",refName:"backdrop",children:[]},{"aria-label":"Close video modal",className:"close-button",click:"$close",role:"button",_type:"button",refName:"closeButton",children:[{id:"close",className:"close-icon",_type:"Sprite",refName:"unnamed",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.element.classList().add("ModalView");const filter={blur:0};_this.open=function(){_this.set("Global/lenisStopped",!0),_this.element.css({display:"block"}),_this.params.noBackdropFilter||tween(filter,{blur:30},1e3,"easeOutSine").onUpdate(_=>{_this.element.css({backdropFilter:`blur(${filter.blur}px)`})}),_this.backdrop.css({opacity:_this.params.fade?0:1}),_this.backdrop.tween({opacity:_this.params?.backdropOpacity||.7},1e3,"easeOutSine").onComplete(_=>{_this.closeButton.div.focus()}),_this.onOpen?.()},_this.close=async function(){await defer(),_this.set("Global/lenisStopped",!1),_this.backdrop.tween({opacity:_this.params.fade?0:1},1e3,"easeOutSine").onComplete(_=>{_this.params.noBackdropFilter&&_this.element.css({display:"none"})}),_this.params.noBackdropFilter||tween(filter,{blur:0},1e3,"easeOutSine").onUpdate(_=>{_this.element.css({backdropFilter:`blur(${filter.blur}px)`})}).onComplete(_=>{_this.element.css({display:"none"})}),_this.onClose?.()},_this.element.hide(),Stage.add(_this.element),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ModalView"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function MultiSelect(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="MultiSelect",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"multiselect",_type:"div",refName:"container",children:[{className:"multiselect__selected",role:"button",type:"button",_type:"button",refName:"selected",children:[{className:"multiselect__selected-text",role:"heading","aria-level":4,_type:"div",refName:"text",children:[]},{tabIndex:-1,className:"multiselect__selected-icon",_type:"div",refName:"unnamed",children:[{id:"plus",_type:"Sprite",refName:"icon",children:[]}]}]},{className:"multiselect__dropdown hidden",role:"listbox",_type:"div",refName:"dropdown",children:[{className:"multiselect__options",role:"list",_type:"div",refName:"optionsItems",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.data={selectedOptions:[],selectedOption:null,dropdownLenis:null},_this.state.isOpen=!1;const singleSelectMode=_this.params.singleSelect??!1;function toggleDropdown(){_this.state.isOpen=!_this.state.isOpen}function handleOutsideClick(e){_this.element?.div&&!1!==_this.element.div.contains(e.target)||!_this.state.isOpen||(_this.state.isOpen=!1)}function renderOptions(){const checkboxes=[];_this.optionsItems.empty(),_this.options.forEach(option=>{const label=_this.optionsItems.create("multiselect__option","div").create("multiselect__label","label");label.attr("role","option");const checkbox=label.create("multiselect__checkbox","input");checkbox.div.type="checkbox",checkbox.div.value=option.id?option.id.current:option.value,checkbox.div.checked=singleSelectMode?_this.data.selectedOption?.value===option.value:_this.data.selectedOptions.some(selected=>selected.value===option.value),checkboxes.push(checkbox);label.create("multiselect__label__text","span").text(option.label),checkbox.bind("input",e=>{singleSelectMode&&(checkboxes.forEach(checkboxItem=>checkboxItem.div.checked=!1),checkbox.div.checked=!0),function handleOptionChange(option,isChecked){singleSelectMode?_this.data.selectedOption=option:isChecked?_this.data.selectedOptions.push(option):_this.data.selectedOptions=_this.data.selectedOptions.filter(selected=>selected.value!==option.value);if(renderSelectedText(),_this.onChange){const currentSelection=singleSelectMode?_this.data.selectedOption:_this.data.selectedOptions;_this.onChange(currentSelection)}}(option,checkbox.div.checked)})})}function renderSelectedText(){let displayLabel=_this.params.placeholder,hasSelection=!1;singleSelectMode?_this.data.selectedOption&&(displayLabel=_this.data.selectedOption.label,hasSelection=!0):_this.data.selectedOptions.length>0&&(displayLabel=_this.params.placeholder,hasSelection=!0),_this.text.html(displayLabel),hasSelection?_this.selected.div.classList.remove("placeholder"):_this.selected.div.classList.add("placeholder")}_this.onMounted=()=>{_this.element.attr("role","combobox"),_this.element.attr("aria-expanded",_this.state.isOpen),_this.selected.attr("aria-label",`${_this.params.placeholder} multiselect dropdown`),_this.selected.attr("role","heading"),_this.selected.attr("aria-level",4),_this.icon.element.attr("tabindex","-1"),renderSelectedText(),_this.selected.click(toggleDropdown),document.addEventListener("click",handleOutsideClick),Device.hoverCapable&&_this.dropdown.div.addEventListener("mouseleave",_=>{_this.state.isOpen=!1}),function initDropdownLenis(){const lenisOptions={wrapper:_this.dropdown.div,content:_this.optionsItems.div,duration:.8,easing:TweenManager.Interpolation.Quart.Out,direction:"vertical",gestureDirection:"vertical",smooth:!0,smoothTouch:!1,touchMultiplier:2,lerp:!1};_this.data.dropdownLenis=new Lenis(lenisOptions),_this.startRender(_=>{_this.data.dropdownLenis&&_this.data.dropdownLenis.raf(_)})}()},_this.onUpdate=(key,value)=>{"options"===key&&renderOptions()},_this.bind(_this.state,"isOpen",isOpen=>{isOpen?_this.dropdown.div.classList.remove("hidden"):(_this.dropdown.div.classList.add("hidden"),Global.lenis&&Global.lenis.start()),function changeIcon(){_this.onDropdownToggle&&_this.onDropdownToggle(_this.state.isOpen);_this.state.isOpen?(_this.icon.id="minus",_this.icon.element.div.classList.add("invert")):(_this.icon.id="plus",_this.icon.element.div.classList.remove("invert"))}()}),_this.getValue=()=>{if(singleSelectMode&&_this.data.selectedOption){return _this.data.selectedOption?.id?_this.data.selectedOption?.id.current:_this.data.selectedOption?.value}return _this.data.selectedOptions.map(option=>option.id?option.id.current:option.value)},_this.setValue=values=>{_this.data.selectedOptions=_this.options.filter(option=>values.includes(option.value)),renderSelectedText(),renderOptions()},_this.clearSelection=()=>{_this.data.selectedOption=null,_this.data.selectedOptions=[],renderSelectedText(),renderOptions()},_this.removeValue=valueToRemove=>{if(singleSelectMode?_this.data.selectedOption?.value===valueToRemove&&(_this.data.selectedOption=null):_this.data.selectedOptions=_this.data.selectedOptions.filter(option=>option.value!==valueToRemove),renderSelectedText(),renderOptions(),_this.onChange){const currentSelection=singleSelectMode?_this.data.selectedOption:_this.data.selectedOptions;_this.onChange(currentSelection)}},_this.addOption=option=>{_this.options.some(existingOption=>existingOption.value===option.value)||(_this.options.push(option),renderOptions())},_this.setOptions=options=>{_this.options=options,renderOptions()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"MultiSelect"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function NewsArticleContent(_params,...restArgs){const _this=this;Inherit(_this,SlicesView,_params),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="NewsArticleContent",_this.contexts="SlicesView, _params,Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"left",children:[{_type:"div",refName:"information",children:[{_type:"p",refName:"summary",children:[]},{_type:"div",refName:"share",children:[{_type:"p",refName:"shareTitle",children:[]},{click:()=>handleShare("X"),"aria-label":"Share on X",role:"button",_type:"button",_innerText:"X",refName:"shareX",children:[]},{click:()=>handleShare("LI"),"aria-label":"Share on LinkedIn",role:"button",_type:"button",_innerText:"LI",refName:"shareLI",children:[]},{click:()=>handleShare("RD"),"aria-label":"Share on Reddit",role:"button",_type:"button",_innerText:"RD",refName:"shareRD",children:[]}]}]}]},{_type:"div",refName:"right",children:[{view:"$determineView",data:"$state.slices",onAddView:_this.onAddView,_type:"ViewState",refName:"slices",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function handleScroll(lenis){lenis.isStopped||(-1===lenis.direction?_this.information.css({top:"6rem"}):_this.information.css({top:"2rem"}))}function handleShare(type){const platform="rd"===type.toLowerCase()?"reddit":"li"===type.toLowerCase()?"linkedin":type.toLowerCase();if(MixpanelAnalytics.track(`link_social_${platform}`),"RD"===type)Share.reddit(location.href,_this.params.title);else if("LI"===type){let finalText=_this.get("Global/siteSettings").shareTemplate.replace("[TITLE]",_this.params.title);Share.linkedin(location.href,_this.params.title,finalText)}else if("X"===type){let finalText=_this.get("Global/siteSettings").shareTemplate.replace("[TITLE]",_this.params.title);Share.twitter(finalText,location.href)}}_this.state.slices=new StateArray([]),_this.bind("Global/siteSettings",setting=>{_this.shareTitle.text(setting.shareTitle||"Share")}),_this.bind(_this.params,"summary",summary=>{_this.summary.text(summary)}),_this.bind(_this.params,"title",title=>{_this.params.summary||_this.summary.text(title)}),_this.bind(_this.params,"slices",slices=>{_this.state.slices.refresh(slices)}),Global.lenis?.on("scroll",handleScroll),_this._bindOnDestroy(()=>{Global.lenis?.off("scroll",handleScroll)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"NewsArticleContent"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function NewsFeaturedSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="NewsFeaturedSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"top",children:[{_type:"h4",_innerText:"$data.header",refName:"header",children:[]},{data:"$state.cta",_type:"CtaButton",refName:"cta",children:[]},{_type:"div",refName:"border",children:[]}]},{_type:"div",refName:"mid",children:[{data:"$data.highlightedArticle",_type:"HighlightedArticle",refName:"article",children:[]}]},{_type:"div",refName:"bottom",children:[{view:"NewsListItem",data:"$featureArticles",_type:"ViewState",refName:"viewstate",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.featureArticles=new StateArray([]),_this.state.cta=AppState.createLocal(_this.data.cta),_this.bind(_this.data,"cta",data=>_this.state.cta.setAll(data)),_this.onInit=()=>{_this.data.featureArticles.forEach(article=>{let link={...article,showThumbnail:_this.data.showThumbnail};_this.featureArticles.push(link)})},_this.data.highlightedArticle?(_this.mid.show(),_this.border.show()):(_this.mid.hide(),_this.border.hide()),0===_this.data.featureArticles.length?_this.bottom.hide():_this.bottom.show(),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"NewsFeaturedSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function NewsHeaderSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="NewsHeaderSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"content",children:[{_type:"h1",refName:"title",children:[]},{_type:"div",refName:"details",children:[{_type:"div",refName:"dateWrapper",children:[{_type:"p",refName:"date",children:[]}]},{_type:"p",refName:"author",children:[]}]},{_type:"div",refName:"image",children:[{imageWithMeta:"$state.image",cropAspect:1.78,sizes:"(min-width: 769px) 96vw, 100vw",_type:"ResponsiveImage",refName:"thumbnail",children:[]}]}]},{_type:"div",refName:"border",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onMounted=()=>{_this.title.css({opacity:0}).transform({x:"-3rem"}),_this.details.css({opacity:0}).transform({x:"-3rem"}),_this.bind("ViewController/transitioning",stage=>{stage||(_this.title.tween({opacity:1,x:0},500,"easeOutExpo"),_this.details.tween({opacity:1,x:0},500,"easeOutExpo"))})},_this.data.image||_this.image.hide(),_this.bind(_this.data,"image",image=>{image&&(_this.state.image=AppState.createLocal({asset:image.asset,_type:"imageWithMeta",alt:_this.data.title}))}),_this.bind(_this.data,"title",title=>{_this.title.text(title)}),_this.bind(_this.data,"date",date=>{let formattedDate=new Date(date).toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"});_this.date.text(formattedDate)}),_this.bind(_this.data,"authors",authors=>{if(!authors)return;let authorList=[];authors.forEach(author=>{authorList.push(author.fullName)});let finalText=authorList.join(" & ");_this.author.text(`By ${finalText}`)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"NewsHeaderSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function NewsListCategory(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="NewsListCategory",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{"aria-label":_this.data.title,_type:"label",refName:"label",children:[{type:"radio",name:"category","aria-label":_this.data.title,_type:"input",refName:"input",children:[]},{_type:"span",_innerText:"$data.title",refName:"labelText",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.input.div.tabIndex=0,_this.bind(_this.data,"slug",slug=>{_this.input.attr("value",slug.current),_this.element.attr("data-slug",slug.current),"all"===slug.current&&_this.input.attr("checked","checked")}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"NewsListCategory"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function NewsListItem(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,Link),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="NewsListItem",_this.contexts="ViewStateElement,TextAnimationHelper,Link,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"border",children:[]},{_type:"div",refName:"gridContent",children:[{_type:"div",refName:"left",children:[{_type:"div",refName:"content",children:[{_type:"div",refName:"details",children:[{_type:"p",refName:"date",children:[]}]},{_type:"h6",refName:"title",children:[]}]},{_type:"CtaButton",refName:"cta",children:[]}]},{_type:"div",refName:"right",children:[{_type:"div",refName:"image",children:[{sizes:"(min-width: 769px) 15vw, 20vw",_type:"ResponsiveImage",refName:"thumbnail",children:[]}]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function handleLink(link){if(link){let linkData={_type:"internalLink",text:"Read more"};link.path?(link.path=link.path.split("/").slice(1).join("/"),linkData.path=link.path):linkData.reference=link,_this.setupLink(linkData,!1),_this.state.linkData.link=linkData,_this.cta.args[0].data=_this.state.linkData.link,_this.cta.element.div.tabIndex=-1,_this.title.text(link.title);let formattedDate=new Date(link.date).toLocaleDateString("en-US",{day:"numeric",month:"numeric",year:"numeric"});_this.date.text(formattedDate),!1===_this.data.showThumbnail?(_this.image.hide(),_this.left.css({gridColumn:(_this.state.isMobile,"1 / 13"),gap:"1rem"}),_this.title.css({width:"100%"})):(_this.image.show(),_this.thumbnail.args[0].imageWithMeta=link.image||_this.getSync("Global/siteSettings").newsDefaultImage)}}function animateIn(){_this.border.tween({scaleX:1},2e3,"easeOutExpo"),[_this.left,_this.right].forEach((element,index)=>{element.tween({x:"0%",opacity:1},1e3,"easeOutExpo",200+100*index).promise()})}_this.linkData={},_this.state.linkData=AppState.createLocal({text:"Read more"}),_this.state.isMobile=Stage.width<769,_this.onResize(_=>_this.state.isMobile=Stage.width<769),_this.onMounted=async()=>{await _this.wait("cta"),_this.bind(_this.data,"link",handleLink),_this.border.transform({scaleX:0}),[_this.left,_this.right].forEach(element=>{element.transform({x:"-10%"}).css({opacity:0})}),_this.element.div.getBoundingClientRect().top<window.innerHeight&&animateIn()},_this.element.hover(e=>{}),_this.onInView=()=>{animateIn()},_this.animateIn=animateIn,onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"NewsListItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function NewsListSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="NewsListSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"h5",_innerText:"$data.header",refName:"header",children:[]},{"aria-label":"News ListFilters",_type:"div",refName:"filters",children:[{categories:"$categories",_type:"MobileFilter",refName:"mobileFilter",children:[]},{categories:"$categories",_type:"DesktopFilter",refName:"desktopFilter",children:[]}]},{"aria-label":"News List",_type:"div",refName:"newsList",children:[{view:"NewsListItem",data:"$newsList",_type:"ViewState",refName:"viewstate",children:[]},{_type:"p",_innerText:"No results found",refName:"noResults",children:[]}]},{"aria-label":"Pagination",role:"region",_type:"div",refName:"paginationWrapper",children:[{currentPage:"$state.page",totalPages:"$state.totalPages",_type:"AlgoliaPagination",refName:"pagination",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;async function getNews(page){let queryParams={};_this.state.search&&(queryParams.query=_this.state.search),"all"!==_this.state.categorySlug&&(queryParams.categorySlug=_this.state.categorySlug),page&&(queryParams.page=page);let result=await _this.requestData("news",queryParams),newsList=[];_this.state.currentPage=result.page,_this.state.totalPages=result.nbPages,_this.pagination.params.currentPage=_this.state.currentPage,_this.pagination.params.totalPages=_this.state.totalPages,0===result.hits.length?_this.noResults.show():_this.noResults.hide(),result.hits.forEach(hit=>{let newsItem={link:{...hit}};newsList.push(newsItem)}),_this.newsList.refresh(newsList),_this.state.initialLoad>2&&async function animateCards(){await async function viewStateReady(vs,data){return _this.wait(_=>vs.views.length===data.length)}(_this.viewstate,_this.newsList),_this.viewstate.views.forEach(view=>{view.animateIn()})}(),_this.state.initialLoad++}function debouncedGetNews(){return Utils.debounce(getNews)}_this.categories=[],_this.newsList=new StateArray([]),_this.state.search="",_this.state.categorySlug="all",_this.noResults.hide(),_this.bind(_this.state,"categorySlug",debouncedGetNews),_this.bind(_this.state,"search",debouncedGetNews),_this.onInit=()=>{_this.state.initialLoad=0,_this.categories.push({title:"All",slug:{current:"all"}}),_this.data.categories.forEach(category=>{_this.categories.push(category)})},_this.onMounted=async()=>{await _this.wait("pagination"),await _this.wait("desktopFilter"),_this.desktopFilter.state.bind("categorySlug",slug=>{_this.state.categorySlug=slug}),_this.desktopFilter.state.bind("search",search=>{_this.state.search=search}),_this.mobileFilter.state.bind("categorySlug",slug=>{_this.state.categorySlug=slug}),_this.mobileFilter.state.bind("search",search=>{_this.state.search=search}),_this.pagination.state.bind("page",page=>{getNews(page)})},_this.listen("AlgoliaPagination/pageChange",function scrollToTop(){defer().then(()=>{Global.lenis?.scrollTo(_this.element.div.offsetTop-80,{duration:2.5,lerp:.1})})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"NewsListSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function NewsroomHeader(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="NewsroomHeader",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"top",children:[{_type:"p",_innerText:"$data.headerLabel",refName:"label",children:[]},{_type:"h3",_innerText:"$data.header",refName:"header",children:[]}]},{_type:"div",refName:"mid",children:[{data:"$data.highlightedArticle",_type:"HighlightedArticle",refName:"highlight",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"NewsroomHeader"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function NextLinkSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,Link),Inherit(_this,XComponent),_this.fragName="NextLinkSlice",_this.contexts="ViewStateElement,Element,Link",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"h4",_innerText:"Next",refName:"unnamed",children:[]},{_type:"h1",refName:"title",children:[]},{id:"arrow-right",_type:"Sprite",refName:"sprite",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"backgroundColor",backgroundColor=>{backgroundColor&&_this.element.css({background:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)})}),_this.bind(_this.data,"title",title=>{title&&_this.title.text(title)}),_this.bind(_this.data,"link",link=>{link&&_this.setupLink(link,!1)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"NextLinkSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function NumberCallOutBlock(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="NumberCallOutBlock",_this.contexts="ViewStateElement,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"border",children:[]},{_type:"div",refName:"content",children:[{_type:"div",refName:"left",children:[{_type:"h1",_innerText:"$data.stat",refName:"stat",children:[]},{_type:"h6",_innerText:"$data.label",refName:"label",children:[]}]},{_type:"p",_innerText:"$data.description",refName:"right",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function animateIn(){[_this.stat,_this.label,_this.right].forEach((el,index)=>{el.tween({x:0,opacity:1},1e3,"easeOutExpo",200+100*index)}),_this.border.tween({scaleX:1},1e3,"easeOutExpo")}_this.onMounted=()=>{_this.border.transform({scaleX:0}),[_this.stat,_this.label,_this.right].forEach(el=>{el.transform({x:"-10%"}).css({opacity:0})}),_this.element.div.getBoundingClientRect().top<window.innerHeight&&animateIn()},_this.onInView=()=>{animateIn()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"NumberCallOutBlock"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function NumberCallOutSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="NumberCallOutSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{data:"$data.callOutList",view:"NumberCallOutBlock",_type:"ViewState",refName:"vs",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"backgroundColor",function handleBackgroundColor(backgroundColor){_this.element.css({backgroundColor:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)}),_this.element.div.style.setProperty("--border-color",SanityUtils.stegaClean(backgroundColor.contrastColor))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"NumberCallOutSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function OneColumnRichText(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="OneColumnRichText",_this.contexts="ViewStateElement,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{class:"content",content:"$data.content",_type:"RichText",refName:"content",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"fullBleed",(fullBleed,prevState)=>{_this.element.classList().remove("full-bleed"),fullBleed&&_this.element.classList().add("full-bleed")}),_this.bind(_this.data,"backgroundColor",color=>{color&&(_this.element.classList().toggle("light","#010101"===SanityUtils.stegaClean(color.contrastColor)),_this.element.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)}))}),_this.bind(_this.data,"arsenalPadding",arsenalPadding=>{arsenalPadding&&_this.element.classList().add("arsenal-padding")}),_this.bind(_this.data,"paragraphWidth",(width,prevWidth)=>{let clearedWidth=SanityUtils.stegaClean(width),clearedPrevWidth=SanityUtils.stegaClean(prevWidth);prevWidth&&_this.element.classList().remove(clearedPrevWidth),_this.element.classList().add(clearedWidth)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"OneColumnRichText"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function OpenRolesHero(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,TextAnimationHelper),Inherit(_this,XComponent),_this.fragName="OpenRolesHero",_this.contexts="ViewStateElement,Element,TextAnimationHelper",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"titleWrapper",children:[{_type:"h1",_innerText:"$data.shortTitle",refName:"unnamed",children:[]},{_type:"h2",_innerText:"$data.title",refName:"unnamed",children:[]}]},{_type:"div",refName:"counterContainer",children:[{_type:"div",refName:"counter-wrapper",children:[{_type:"h3",refName:"counter",children:[{_type:"span",refName:"counterText",children:[]},{"aria-hidden":!0,_type:"span",refName:"counterTextHidden",children:[]}]},{_type:"div",refName:"counterDescription",children:[]}]}]},{_type:"div",refName:"bottomWrapper",children:[{className:"description",content:"$data.description",_type:"RichText",refName:"description",children:[]},{"aria-label":"Scroll to next section",role:"button",_type:"button",refName:"scrollToNext",children:[{id:"arrow-down",_type:"Sprite",refName:"icon1",children:[]},{id:"arrow-down",_type:"Sprite",refName:"icon2",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.contrastColor,_this.state.counterTextReady=!1,_this.state.transitionIn=!1,_this.state.animateText=!1,_this.state.firstLoad=!0,_this.icon1.element.css({color:"white"}),_this.icon2.element.css({color:"white"}),_this.scrollToNext.click(e=>{Global.lenis?.scrollTo(_this.element.div.offsetHeight,{duration:2.5,lerp:.1})}),_this.onMounted=()=>{_this.bottomWrapper.css({opacity:0}),_this.titleWrapper.css({opacity:0}).transform({x:"-3rem"}),_this.bind("ViewController/transitioning",async stage=>{if(1===stage&&(_this.state.transitionIn=!1,_this.state.counterTextReady=!1),2===stage&&(_this.counterText.text(_this.data.counterValue.toString().padStart(3,"0")),_this.counterTextHidden.text(_this.data.counterValue.toString().padStart(3,"0"))),!stage){await _this.wait("OpenRolesSlice/rolesCount");let counterValue=_this.getSync("OpenRolesSlice/rolesCount");_this.counterText.text(counterValue),_this.counterTextHidden.text(counterValue);let fontSizeMultiplier=Math.range(counterValue.toString().length,3,4,.9,.7,!0);_this.element.div.style.setProperty("--fontSizeMultiplier",fontSizeMultiplier),_this.state.counterTextReady=!0,_this.state.transitionIn=!0,async function animateParagraphText(){await _this.wait("description"),_this.titleWrapper.tween({opacity:1,x:0},500,"easeOutExpo"),_this.bottomWrapper.css({maxHeight:`${_this.bottomWrapper.div.offsetHeight}px`,overflow:"clip"}),_this.bottomWrapper.tween({opacity:1},1e3,"easeOutExpo"),[..._this.description.element.children()].forEach(child=>{let hydraObject=new HydraObject(child);hydraObject.text(child.textContent),_this.animateText(hydraObject,500,!0)})}()}})},_this.bind(_this.data,"counterValue",counterValue=>{_this.counterText.text(counterValue.toString().padStart(3,"0")),_this.counterTextHidden.text(counterValue.toString().padStart(3,"0"))}),_this.bind(_this.data,"showCounter",showCounter=>{showCounter?(_this.counterContainer.show(),_this.scrollToNext.show()):(_this.counterContainer.hide(),_this.scrollToNext.hide())}),_this.bind(_this.state,"transitionIn",transitionIn=>{transitionIn&&_this.state.counterTextReady&&(_this.state.animateText=!0)}),_this.bind(_this.state,"counterTextReady",ready=>{ready&&_this.state.transitionIn&&(_this.state.animateText=!0)}),_this.bind(_this.state,"animateText",animateText=>{animateText&&_this.animateText(_this.counterText,500,!0)}),_this.bind("OpenRolesSlice/rolesCount",async rolesCount=>{rolesCount&&(_this.counterText.text(rolesCount),_this.counterTextHidden.text(rolesCount))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"OpenRolesHero"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function OpenRolesSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="OpenRolesSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{className:"open-roles",_type:"UI",refName:"unnamed",children:[{className:"open-roles__container",_type:"div",refName:"container",children:[{className:"open-roles__filters","aria-label":"Open Roles Filters",_type:"form",refName:"unnamed",children:[{className:"open-roles__filter-selects",_type:"form",refName:"form",children:[{className:"open-roles__filter-group",_type:"div",refName:"unnamed",children:[{placeholder:"DEPARTMENT",_type:"MultiSelect",refName:"departmentFilter",children:[]}]},{className:"open-roles__filter-group",_type:"div",refName:"unnamed",children:[{placeholder:"LOCATION",_type:"MultiSelect",refName:"locationFilter",children:[]}]},{className:"open-roles__filter-group",_type:"div",refName:"unnamed",children:[{placeholder:"EMPLOYMENT TYPE",_type:"MultiSelect",refName:"employmentFilter",children:[]}]},{className:"open-roles__search-container",_type:"div",refName:"unnamed",children:[{type:"text",placeholder:"Search jobs","aria-label":"Search jobs",_type:"input",refName:"search",children:[]},{id:"search",_type:"Sprite",refName:"searchIcon",children:[]}]}]},{className:"open-roles__filter-buttons",_type:"div",refName:"unnamed",children:[{_type:"span",_innerText:"Don't see the right role?",refName:"unnamed",children:[]},{data:"$data.openForm",_type:"CtaButton",refName:"cta",children:[]}]}]},{className:"open-roles__stats",_type:"div",refName:"stats",children:[{role:"status","aria-atomic":!0,tabIndex:0,className:"open-roles__stats-text",_type:"p",refName:"textStats",children:[{_type:"inlinetext",_innerText:"Showing ",refName:"unnamed",children:[]},{_type:"span",refName:"startEndCount",children:[]},{_type:"inlinetext",_innerText:" results out of total ",refName:"unnamed",children:[]},{_type:"span",refName:"totalCount",children:[]},{_type:"inlinetext",_innerText:". ",refName:"unnamed",children:[]},{_type:"span",_innerText:"Continue to the following pages for more listings.",refName:"pageCopy",children:[]}]},{className:"open-roles__filters-selected-container",_type:"div",refName:"unnamed",children:[{className:"open-roles__filters-selected",_type:"div",refName:"filterButtons",children:[]}]}]},{className:"open-roles__items",_type:"div",refName:"items",children:[]},{className:"open-roles__pagination","aria-label":"Pagination",role:"region",_type:"div",refName:"pagination",children:[{currentPage:"$state.page",totalPages:"$state.totalPages",_type:"AlgoliaPagination",refName:"pagination",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.loadingPromise=Promise.create(),_this.state.initialLoaded=!1,_this.state.isMobile=Stage.width<769,_this.onResize(_=>_this.state.isMobile=Stage.width<769);const _isHashRouter=Hydra.LOCAL||!Device.system.pushstate;let facets,urlParams=new URLSearchParams(window.location.search);async function getJobs(page){let queryParams={};_this.state.search&&(queryParams.query=_this.state.search),_this.state.department.length>0&&(queryParams.department=_this.state.department),_this.state.employmentType.length>0&&(queryParams.employmentType=_this.state.employmentType),_this.state.location.length>0&&(queryParams.location=_this.state.location),page&&(queryParams.page=page);let result=await _this.requestData("jobs",queryParams);_this.totalCount.text(result.nbHits),_this.startEndCount.text(result.hits.length),_this.set("rolesCount",result.nbHits),result.nbPages>1?_this.pageCopy.show():_this.pageCopy.hide(),_this.state.currentPage=result.page,_this.state.totalPages=result.nbPages,_this.pagination.params.currentPage=_this.state.currentPage,_this.pagination.params.totalPages=_this.state.totalPages,_this.state.jobs=result.hits,function updateSearch(){_this.search.val(_this.state.search?_this.state.search:""),_this.state.searchQuery=_this.state.search.replace(/ /g,"-"),updateUrlParams()}()}function debouncedGetJobs(){return Utils.debounce(getJobs)}function handleSearch(e){_this.state.search=_this.search.val()}function setNewArray(targetArray,newArray){for(const value of newArray)targetArray.includes(value)||targetArray.push(value);return targetArray=targetArray.filter(value=>newArray.includes(value))}function updateFiltersState(){let departmentValues=_this.departmentFilter.getValue(),employmentTypeValues=_this.employmentFilter.getValue(),locationValues=_this.locationFilter.getValue();_this.state.departmentQuery=setNewArray(_this.state.departmentQuery,departmentValues.map(value=>value.toLowerCase().replace("&","and").split(" ").join("-"))),_this.state.employmentTypeQuery=setNewArray(_this.state.employmentTypeQuery,employmentTypeValues.map(value=>value.toLowerCase().replace("&","and").split(" ").join("-"))),_this.state.locationQuery=setNewArray(_this.state.locationQuery,locationValues.map(value=>value.replaceAll(",","").replaceAll("&","and").replaceAll(";","").toLowerCase().split(" ").join("-"))),applyFilters()}function applyFilters(){_this.state.departmentQuery.length>0&&_this.state.departmentQuery.map(query=>query.split("-").map(word=>word.charAt(0).toUpperCase()+word.slice(1)).join(" ")),_this.state.searchQuery&&(_this.state.search=_this.state.searchQuery.replace(/-/g," ")),_this.state.department=_this.state.departmentQuery.map(query=>_this.data.departments.find(department=>department.value===query)?.label),_this.state.employmentType=_this.state.employmentTypeQuery.map(query=>_this.data.employmentTypes.find(employmentType=>employmentType.value===query)?.label),_this.state.location=_this.state.locationQuery.map(query=>_this.data.locations.find(location=>location.value===query)?.label),_this.departmentFilter.setValue(_this.state.department.map(department=>department.toLowerCase().split(" ").join("-"))),_this.employmentFilter.setValue(_this.state.employmentType.map(employmentType=>employmentType.toLowerCase().split(" ").join("-"))),_this.locationFilter.setValue(_this.state.location.map(location=>location.replaceAll(",","").replaceAll("&","and").replaceAll(";","").toLowerCase().split(" ").join("-"))),_this.state.allFilters=[..._this.state.department.map(value=>({value:value,source:"department"})),..._this.state.employmentType.map(value=>({value:value,source:"employment"})),..._this.state.location.map(value=>({value:value,source:"location"}))].filter((filter,_index,self)=>_index===self.findIndex(f=>f.value===filter.value&&f.source===filter.source)),function renderSelectedFilters(filters){_this.filterButtons.div.innerHTML="",filters.forEach(filter=>{_this.createFragment(FilterButton,{text:filter.value.split("-").map(word=>word.charAt(0).toUpperCase()+word.slice(1)).join(" "),ariaLabel:`Remove ${filter.value} filter`,onClick:element=>{_this.get("isAnyDropdownOpen")||("department"===filter.source?(Utils.removeQuery("department",filter.value.toLowerCase().replace("&","and").split(" ").join("-")),_this.departmentFilter.removeValue(filter.value.toLowerCase().replace("&","and").split(" ").join("-"))):"employment"===filter.source?(Utils.removeQuery("employmentType",filter.value.toLowerCase().replace("&","and").split(" ").join("-")),_this.employmentFilter.removeValue(filter.value.toLowerCase().replace("&","and").split(" ").join("-"))):"location"===filter.source&&(Utils.removeQuery("location",filter.value.replaceAll(",","").replaceAll("&","and").replaceAll(";","").toLowerCase().split(" ").join("-")),_this.locationFilter.removeValue(filter.value.replaceAll(",","").replaceAll("&","and").replaceAll(";","").toLowerCase().split(" ").join("-"))),element.remove(),applyFilters())}},[_this.filterButtons])}),filters.length>0&&_this.createFragment(TextButton,{text:"Clear filters",ariaLabel:"Clear all filters",onClick:e=>{_this.get("isAnyDropdownOpen")||(Utils.removeQuery("department"),Utils.removeQuery("employmentType"),Utils.removeQuery("location"),_this.state.departmentQuery=[],_this.state.employmentTypeQuery=[],_this.state.locationQuery=[],_this.state.department=[],_this.state.employmentType=[],_this.state.location=[],_this.state.allFilters=[],_this.departmentFilter.clearSelection(),_this.employmentFilter.clearSelection(),_this.locationFilter.clearSelection(),_this.filterButtons.div.innerHTML="")},icon:"close"},[_this.filterButtons])}(_this.state.allFilters),updateUrlParams(_this.state.allFilters)}function updateUrlParams(){let replacementString="";_this.state.allFilters.length>0&&(replacementString="?",_this.state.allFilters.forEach(filter=>{"department"===filter.source?replacementString+=`department=${filter.value.toLowerCase().replace("&","and").split(" ").join("-")}&`:"employment"===filter.source?replacementString+=`employmentType=${filter.value.toLowerCase().replace("&","and").split(" ").join("-")}&`:"location"===filter.source&&(replacementString+=`location=${filter.value.replaceAll(",","").replaceAll("&","and").replaceAll(";","").toLowerCase().split(" ").join("-")}&`)})),replacementString+=""+(_this.state.searchQuery?`search=${_this.state.searchQuery}&`:""),_isHashRouter?replacementString?history.replaceState(null,null,`${replacementString}#!/open-roles`):history.replaceState(null,null,"#!/open-roles"):replacementString?history.replaceState(null,null,`/open-roles${replacementString}`):history.replaceState(null,null,"/open-roles")}function renderRoles(roles){if(_this.items.div.innerHTML="",0===roles.length)return void _this.items.html('<div class="open-roles__no-results">No open roles found</div>');const rolesByLocation={};roles.forEach(role=>{const location=role.location;rolesByLocation[location]||(rolesByLocation[location]=[]),rolesByLocation[location].push(role)});const sortedLocations=Object.keys(rolesByLocation).sort();let renderedRoles=[];sortedLocations.forEach(location=>{const locationRoles=rolesByLocation[location],count=locationRoles.length,locationHeader=document.createElement("div");locationHeader.className="open-roles__location-header",locationHeader.innerHTML=`<h3 tabIndex="0" class="open-roles__location-header-title">${location} <span class="open-roles__location-header-count">(${count})</span> </h3>`,_this.items.div.appendChild(locationHeader),locationRoles.forEach(role=>{let roleItem=_this.createFragment(OpenRolesSliceItem,{title:role.title,location:role.location,department:role.department,employmentType:role.employmentType,id:`Req ID: ${role.requisitionId}`,apply:role.url},[_this.items]);renderedRoles.push(roleItem)})}),_this.state.initialLoaded&&renderedRoles.forEach(role=>{role.animateIn()}),_this.state.initialLoaded=!0}function updateDropdownState(isOpen){isOpen?_this.filterButtons.div.classList.add("disabled"):_this.filterButtons.div.classList.remove("disabled"),_this.set("isAnyDropdownOpen",isOpen)}_this.data={departments:[],employmentTypes:[],locations:[]},_this.state.search="",_this.state.department=[],_this.state.employmentType=[],_this.state.location=[],_this.onMounted=async()=>{_this.searchIcon.element.attr("tabindex","-1"),_this.searchIcon.element.attr("aria-hidden","true"),_this.container.hide(),_this.search.bind("input",handleSearch),_this.form.bind("submit",e=>{e.preventDefault()}),_this.form.bind("keydown",e=>{"Enter"===e.key&&e.preventDefault()}),_this.set("isAnyDropdownOpen",!1),_this.departmentFilter.onDropdownToggle=isOpen=>updateDropdownState(isOpen),_this.employmentFilter.onDropdownToggle=isOpen=>updateDropdownState(isOpen),_this.locationFilter.onDropdownToggle=isOpen=>updateDropdownState(isOpen),facets=await _this.requestData("facets"),_this.data.departments=facets.departments.map(dept=>({value:dept.toLowerCase().replaceAll("&","and").split(" ").join("-"),label:dept})),_this.data.employmentTypes=facets.employmentTypes.map(type=>({value:type.toLowerCase().replaceAll("&","and").split(" ").join("-"),label:type})),_this.data.locations=facets.locations.map(loc=>({value:loc.replaceAll(",","").replaceAll("&","and").replaceAll(";","").toLowerCase().split(" ").join("-"),label:loc})),_this.departmentFilter.setOptions(_this.data.departments),_this.locationFilter.setOptions(_this.data.locations),_this.employmentFilter.setOptions(_this.data.employmentTypes),_this.container.show(),_this.loadingPromise.resolve(),_this.state.departmentQuery=urlParams.getAll("department").filter(query=>!!_this.data.departments.find(dept=>dept.value===query.toLowerCase().replace("&","and").split(" ").join("-"))),_this.state.employmentTypeQuery=urlParams.getAll("employmentType").filter(query=>!!_this.data.employmentTypes.find(type=>type.value===query.toLowerCase().replace("&","and").split(" ").join("-"))),_this.state.locationQuery=urlParams.getAll("location").filter(query=>!!_this.data.locations.find(loc=>loc.value===query.toLowerCase().replaceAll(",","").replaceAll("&","and").replaceAll(";","").split(" ").join("-"))),_this.state.searchQuery=urlParams.get("search"),_this.bind(_this.state,"departmentQuery",applyFilters),_this.bind(_this.state,"locationQuery",applyFilters),_this.bind(_this.state,"employmentTypeQuery",applyFilters),_this.bind(_this.state,"searchQuery",applyFilters),_this.bind(_this.state,"search",debouncedGetJobs),_this.bind(_this.state,"department",debouncedGetJobs),_this.bind(_this.state,"employmentType",debouncedGetJobs),_this.bind(_this.state,"location",debouncedGetJobs),_this.departmentFilter.onChange=()=>updateFiltersState(),_this.employmentFilter.onChange=()=>updateFiltersState(),_this.locationFilter.onChange=()=>updateFiltersState(),_this.pagination.state.bind("page",getJobs),_this.bind(_this.state,"jobs",renderRoles)},_this.listen("AlgoliaPagination/pageChange",function scrollToTop(){defer().then(()=>{Global.lenis?.scrollTo(_this.container.div.offsetTop-80,{duration:2.5,lerp:.1})})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"OpenRolesSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function OpenRolesSliceItem(_params,...restArgs){const _this=this;Inherit(_this,Element,"button"),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="OpenRolesSliceItem",_this.contexts="Element, 'button',InView, 0.5",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{className:"open-roles-item",_type:"UI",refName:"unnamed",children:[{className:"open-roles-item__content",onClick:"$handleClick",_type:"div",refName:"content",children:[{className:"open-roles-item__location",_type:"div",_innerText:"$params.location",refName:"unnamed",children:[]},{className:"open-roles-item__title",_type:"div",_innerText:"$params.title",refName:"unnamed",children:[]},{className:"open-roles-item__id",_type:"div",_innerText:"$params.id",refName:"reqId",children:[]},{className:"open-roles-item__apply",_type:"div",refName:"unnamed",children:[{href:"$params.apply",linkText:"Apply",ariaLabel:"$params.title",tabindex:-1,_type:"ExternalLinkButton",refName:"apply",children:[]}]}]},{className:"open-roles-item__border-bottom",_type:"div",refName:"border",children:[]},{className:"open-roles-item__background",_type:"div",refName:"unnamed",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function animateIn(){_this.border.tween({scaleX:1},1500,"easeOutExpo"),_this.content.tween({x:"0%",opacity:1},1500,"easeOutExpo")}_this.handleClick=()=>{MixpanelAnalytics.track("link_job",{job:_this.params.title}),_this.apply.element.div.click()},"Req ID: null"===_this.params.id&&_this.reqId.hide(),_this.element.hover(e=>{}),_this.onMounted=()=>{_this.element.attr("aria-label",`Apply for ${_this.params.title}`),_this.element.attr("role","link"),_this.border.transform({scaleX:0}),_this.content.transform({x:"-10%"}).css({opacity:0})},_this.onInView=()=>{animateIn()},_this.animateIn=animateIn,onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"OpenRolesSliceItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function PCMVParticles(_mesh,_shader,_input,_group){const _this=this;if(Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="PCMVParticles",_this.contexts="Component",_this.mesh=_mesh,_this.shader=_shader,_this.uilInput=_input,_this.uilFolder=_group,_this.uilFolder?.addButton){let a=_this.uilFolder;_this.uilFolder=_this.uilInput,_this.uilInput=a}this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.shader.addUniforms({tPos:{value:null},tMap:{value:null,getTexture:Utils3D.getLookupTexture},uCellSize:{value:new Vector2(256,256)},uTextureSize:{value:new Vector2(4096,4096)},uParticleColor:{value:new Color("#ffffff")},uBackgroundColor:{value:new Color("#505544")},uMotionScale:{value:new Vector3(1,1,1)},uFrames:{value:48},uFPS:{value:24},uParticleSize:{value:.1},DPR:{value:1},uScroll:{value:0,ignoreUIL:!0},transparent:!0}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"PCMVParticles"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function PageHero(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,TextAnimationHelper),Inherit(_this,XComponent),_this.fragName="PageHero",_this.contexts="ViewStateElement,Element,TextAnimationHelper",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"topWrapper",children:[{_type:"div",refName:"titleWrapper",children:[{_type:"h1",_innerText:"$data.shortTitle",refName:"unnamed",children:[]},{_type:"h2",_innerText:"$data.title",refName:"unnamed",children:[]}]},{_type:"div",refName:"bottomWrapper",children:[{_type:"div",refName:"textWrapper",children:[{className:"description",content:"$data.description",_type:"RichText",refName:"description",children:[]},{className:"descriptionHidden",content:"$data.description","aria-hidden":!0,_type:"RichText",refName:"descriptionHidden",children:[]}]},{"aria-label":"Scroll to next section",role:"button",_type:"button",refName:"scrollToNext",children:[{id:"arrow-down",_type:"Sprite",refName:"icon1",children:[]},{id:"arrow-down",_type:"Sprite",refName:"icon2",children:[]}]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.contrastColor,_this.bind(_this.data,"backgroundColor",backgroundColor=>{backgroundColor&&(_this.icon1.element.css({color:SanityUtils.stegaClean(backgroundColor.contrastColor)}),_this.icon2.element.css({color:SanityUtils.stegaClean(backgroundColor.contrastColor)}),_this.element.css({backgroundColor:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)}))}),_this.bind(_this.data,"showIcon",showIcon=>{_this.scrollToNext.hide(),showIcon&&_this.scrollToNext.show()}),_this.onInit=()=>{(_this.data.video||_this.data.image)&&(_this.mediaContainer=_this.h("media-container","div"),_this.element.add(_this.mediaContainer),_this.state.media=AppState.createLocal({video:_this.data.video,image:_this.data.image}),_this.media=_this.createFragment(Media,_this.state.media,[_this.mediaContainer]),_this.bind(_this.data,"video",video=>_this.state.media.video=video),_this.bind(_this.data,"image",image=>_this.state.media.image=image))},_this.onMounted=()=>{_this.bottomWrapper.css({opacity:0}),_this.bind("ViewController/transitioning",stage=>{stage||async function animateDescription(){await _this.wait("description"),_this.description.element.css({maxHeight:`${_this.description.element.div.offsetHeight}px`,overflow:"clip"}),_this.bottomWrapper.tween({opacity:1},1e3,"easeOutExpo"),[..._this.description.element.children()].forEach(child=>{let hydraObject=new HydraObject(child);if(child.innerHTML.includes("<br>")){let splitLines=child.innerHTML.split("<br>");return child.innerHTML="",void splitLines.forEach(line=>{let span=_this.h("p","p");span.text(String(line)),hydraObject.add(span),_this.animateText(span,500,!0)})}hydraObject.text(child.textContent),_this.animateText(hydraObject,500,!0)})}()})},_this.scrollToNext.click(e=>{Global.lenis?.scrollTo(_this.element.div.offsetHeight,{duration:2.5,lerp:.1})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"PageHero"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function PageLoadProgress(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="PageLoadProgress",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"bar",_type:"div",refName:"bar",children:[{className:"peg",_type:"div",refName:"unnamed",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.start=()=>{_this.element.show().tween({opacity:1},300,"easeOutCubic"),_this.ticker.start()},_this.done=()=>_this.ticker.done(),_this.bind(_this.state,"progress",progress=>{_this.bar.x=`${-100+progress}%`,_this.bar.css({transition:`all ${_this.ticker.speed}ms linear`}).transform(),progress>=100&&_this.element.tween({opacity:1},300,"easeOutCubic").onComplete(()=>{_this.element.hide()})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_this.ticker=_this.initClass(FakeProgress,AppState.createLocal({state:_this.state,expectedDuration:2e3})),_this.ticker.isFragment&&_promises.push(_this.wait(_this.ticker,"__ready")),_promises=null,_this.flag?.("__ready",!0),onInit||"PageLoadProgress"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function PageTransition(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="PageTransition",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.element.hide(),_this.set("transition",0);var transition={value:0};_this.transition=async function(view,prevView){transition.value=0,_this.element.css({opacity:0}).show(),prevView&&_this.parent.element.css({transformOrigin:`50vw ${Global.lenis.scroll+Stage.height/2}px`}).transform({scale:1}).tween({scale:1.02},350,"easeOutSine").promise(),tween(transition,{value:1},350,"easeOutSine").onUpdate(_=>{_this.set("transition",transition.value)}),await _this.element.tween({opacity:1},350,"easeOutSine").promise(),_this.set("transition",-1),transition.value=-1,_this.parent.element.transform({scale:1}).css({transform:"none"}),prevView?.destroy(),tween(transition,{value:0},350,"easeInSine").onUpdate(_=>{_this.set("transition",transition.value)}),view.element.css({visibility:""}).transform({scale:.98}).tween({scale:1},350,"easeInSine").onComplete(_=>{view.element.css({transform:"none"})}),await _this.element.tween({opacity:0},350,"easeInSine").promise(),_this.element.hide()},_this.onInit=async _=>{await defer(),Stage.add(_this.element)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"PageTransition"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function PageView(_params,...restArgs){const _this=this;Inherit(_this,SlicesView,_params),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="PageView",_this.contexts="SlicesView, _params,Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"GridOverlay",refName:"unnamed",children:[]},{_type:"main",refName:"unnamed",children:[{view:"$determineView",data:"$params.content.slices",onAddView:function onAddView(view,index){_this.onAddView(view),slicesData.push({hydraObject:view.element,content:_this.params.content.slices[index]}),index>=_this.params.content.slices.length-1&&_this.set("PageView/slicesData",slicesData)},_type:"ViewState",refName:"slices",children:[]}]},{_type:"Footer",refName:"unnamed",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;const slicesData=[];onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"PageView"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function PaginationTest(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="PaginationTest",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{currentPage:0,totalPages:2,_type:"NewsListPagination",refName:"pagination",children:[]},{currentPage:0,totalPages:3,_type:"NewsListPagination",refName:"pagination",children:[]},{currentPage:1,totalPages:14,_type:"NewsListPagination",refName:"pagination",children:[]},{currentPage:2,totalPages:14,_type:"NewsListPagination",refName:"pagination",children:[]},{currentPage:3,totalPages:14,_type:"NewsListPagination",refName:"pagination",children:[]},{currentPage:5,totalPages:14,_type:"NewsListPagination",refName:"pagination",children:[]},{currentPage:8,totalPages:14,_type:"NewsListPagination",refName:"pagination",children:[]},{currentPage:9,totalPages:14,_type:"NewsListPagination",refName:"pagination",children:[]},{currentPage:11,totalPages:14,_type:"NewsListPagination",refName:"pagination",children:[]},{currentPage:12,totalPages:14,_type:"NewsListPagination",refName:"pagination",children:[]},{currentPage:13,totalPages:14,_type:"NewsListPagination",refName:"pagination",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"PaginationTest"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function PeopleSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="PeopleSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"people-grid",_type:"div",refName:"unnamed",children:[{view:"ProfileCard",data:"$data.profiles",_type:"ViewState",refName:"vs",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"PeopleSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function Plane3DTest(_params,...restArgs){const _this=this;Inherit(_this,Object3D),Inherit(_this,XComponent),_this.fragName="Plane3DTest",_this.contexts="Object3D",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onInit=_=>{let shader=Utils3D.getTestShader();shader.side=Shader.DOUBLE_SIDE;for(let i=0;i<30;i++){let plane=new Mesh(World.PLANE,shader);if(i<15)plane.position.y=.5*-i,plane.rotation.x=-Math.PI/2;else{let angle=Math.range(i,15,20,-Math.PI/2,-Math.PI/1.25,!0);plane.position.y=.5*-i,plane.rotation.x=angle,plane.position.z=Math.range(i,15,30,0,5,!0)}_this.group.add(plane)}},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"Plane3DTest"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function Playground3D(_params,...restArgs){const _this=this;Inherit(_this,FragFXScene,!1),Inherit(_this,XComponent),_this.fragName="Playground3D",_this.contexts="FragFXScene, false",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this._initFXScene(World.NUKE,null,{format:void 0,type:void 0,minFilter:void 0,magFilter:void 0,multiRenderTarget:void 0,mipmaps:void 0,screenQuad:void 0,vrMode:void 0,multisample:void 0,samplesAmount:void 0}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.initLayout(`Playground3D${Utils.query("name")}`),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"Playground3D"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function PlaygroundLatticeHeaderSlice(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="PlaygroundLatticeHeaderSlice",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{view:"LatticeHeaderSlice",data:"$config",_type:"ViewState",refName:"nodes",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.config=new StateArray([{title:"Playground",shortTitle:"Playground",introduction:{content:"This is a playground for the LatticeHeaderSlice.",class:"p",clasName:"body1"},colorPair:{background:{hex:"transparent"},foreground:{hex:"#fff"}}}]),_this.element.css({position:"relative",zIndex:10}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"PlaygroundLatticeHeaderSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function PlaygroundProduct3DSlice(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="PlaygroundProduct3DSlice",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{sceneName:"$sceneName",_type:"Product3DSlice",refName:"layout",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.sceneName=Utils.query("sceneName"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"PlaygroundProduct3DSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function PointGlobeScene(_params,...restArgs){const _this=this;Inherit(_this,Frag3D,_params?.sceneLayoutName||"PointGlobeScene"),Inherit(_this,XComponent),_this.fragName="PointGlobeScene",_this.contexts='Frag3D, _params?.sceneLayoutName || "PointGlobeScene"',_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;const points=[];function updatePointPosition({uil:uil,mesh:mesh,latitude:latitude,longitude:longitude},index){const latRad=Math.radians(latitude),lonRad=Math.radians(longitude);mesh.position.x=1*Math.cos(latRad)*Math.cos(lonRad),mesh.position.y=1*Math.sin(latRad),mesh.position.z=1*Math.cos(latRad)*Math.sin(lonRad)}Global.PLAYGROUND||Array.from({length:4}).forEach((_,i)=>{points[i]={uil:InputUIL.create(`coordinates_globe-${i}`),mesh:new Mesh(new SphereGeometry(.05,32,32),Utils3D.getTestShader()),latitude:0,longitude:0},points[i].uil.setLabel(`Point - ${parseInt(i)||0}`),points[i].uil.addRange("latitude",0,{min:-90,max:90,step:1}),points[i].uil.addRange("longitude",0,{min:-180,max:180,step:1}),points[i].latitude=points[i].uil.getField("latitude").getValue(),points[i].longitude=points[i].uil.getField("longitude").getValue(),updatePointPosition(points[i],i),points[i].uil.onUpdate=(k,v)=>{isNaN(v)||(points[i][k]=v,updatePointPosition(points[i],i))},_this.group.add(points[i].mesh)}),Utils.query("spin")&&Global.PLAYGROUND&&_this.startRender(_=>{_this.group.rotation.y+=-.001*Utils.query("spin")}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"PointGlobeScene"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function PreviewBanner(_params,...restArgs){const _this=this;Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="PreviewBanner",_this.contexts="Component",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function updateShowing(){_this.state.showing=!(!_this.getSync("CMS/preview")||_this.getSync("CMS/liveModeEnabled"))}_this.bind(_this.state,"showing",function handleShowingChange(showing){showing?(_this.banner=_this.createFragment(PreviewBannerView),_this.parent.element.add(_this.banner)):_this.banner&&(_this.banner.destroy(),_this.banner=null)}),_this.bind("CMS/preview",updateShowing),_this.bind("CMS/liveModeEnabled",updateShowing),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"PreviewBanner"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function PreviewBannerView(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="PreviewBannerView",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"span",_innerText:"Draft Preview Mode",refName:"unnamed",children:[]},{role:"button",_type:"button",refName:"exitButton",children:[{_type:"span",_innerText:"Exit Draft Preview Mode",refName:"unnamed",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.exitButton.click(()=>{_this.set("CMS/preview",!1)}),_this.element.onHeightChange(height=>{Stage.css({marginBottom:height||0})}),_this._bindOnDestroy(()=>{Stage.css({marginBottom:""})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"PreviewBannerView"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function PrivacySlice(_params,...restArgs){const _this=this;Inherit(_this,SlicesView,_params),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="PrivacySlice",_this.contexts="SlicesView, _params,Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{view:"$determineView",data:"$data.slices",_type:"ViewState",refName:"unnamed",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"PrivacySlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function Product3DNode(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,TextAnimationHelper),Inherit(_this,XComponent),_this.fragName="Product3DNode",_this.contexts="ViewStateElement,Element,TextAnimationHelper",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"contentWrapper",children:[{_type:"h8",_innerText:"$data.title",refName:"title",children:[]},{_type:"p",_innerText:"$data.description",refName:"description",children:[]}]},{className:"line",_type:"div",refName:"line1",children:[]},{className:"line",_type:"div",refName:"line2",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.responsiveScale=1,_this.focusTime=0,_this.onInit=async _=>{_this.set("Product3DNode/lastActiveIndex",1),await Promise.all([_this.line1.svg("assets/images/icons/callout-target-icon.svg"),_this.line2.svg("assets/images/icons/callout-target-icon.svg")]),await _this.wait(100),_this.svgs=[..._this.element.div.querySelectorAll("svg")],_this.title.__cacheText=_this.data.title,_this.description.__cacheText=_this.data.description,_this.hasAnimated=!1,_this.data.title&&0!==_this.data.title.trim().length||(_this.title.hide(),_this.flag("hasNoTitle",!0)),_this.data.description&&0!==_this.data.description.trim().length||(_this.description.hide(),_this.flag("hasNoDescription",!0));let focusTime,fxParent=_this.findParent("Product3DSlice"),{getConfig:getConfig}=require("Product3DNodeConfig");_this.onResize(_=>{let{x:x,y:y,angles:angles,distances:distances,focus:focus,direction:direction,origin:origin,offsets:offsets}=getConfig(_this.index,fxParent.sceneName);1===angles.length&&_this.line2.hide(),focusTime=focus,_this.focusTime=focus,angles.map((angle,index)=>{let line=[_this.line1,_this.line2][index],xTransform=-15*Math.sin(Math.radians(angle))+"vh",yTransform=8*Math.cos(Math.radians(angle))+"vh",{offsetX:offsetX,offsetY:offsetY}=offsets[index];line.rotation=angle,line.y=yTransform,line.x=xTransform,line.scale=1/_this.state.responsiveScale,line.css({left:`calc(${x} + ${offsetX})`,top:`calc(${y} + ${offsetY})`,height:distances[index]*_this.state.responsiveScale+"vh"}).transform()}),_this.contentWrapper.css({transformOrigin:origin}),_this.element.classList().add(direction),_this.element.css({left:x,top:y})}),_this.isPlayground()||_this.startRender(_=>{let progress=_this.parent.parent.progress;if(isNaN(progress))return;let showProgress=Math.range(Math.abs(progress-focusTime),.065,.07,1,0,!0);showProgress>.999&&!_this.hasAnimated&&_this.parent.parent.visible?(clearTimeout(_this.showTimer),_this.showTimer=_this.delayedCall(_=>{_this.element.classList().add("active"),_this.element.tween({opacity:1},500,"easeOutCubic"),_this.flag("hasNoTitle")||_this.animateText(_this.title,700,!0),_this.flag("hasNoDescription")||_this.animateText(_this.description,700,!0),_this.set("Product3DNode/lastActiveIndex",_this.index)},250),_this.hasAnimated=!0):showProgress<=0&&_this.hasAnimated&&(clearTimeout(_this.showTimer),_this.element.css({opacity:0}).classList().remove("active"),_this.hasAnimated=!1,_this.flag("hasNoTitle")||_this.animateText(_this.title,1,!1),_this.flag("hasNoDescription")||_this.animateText(_this.description,1,!1))})},_this.bind("Product3DSlice/responsiveScale",scale=>{_this.state.responsiveScale=scale,_this.contentWrapper.transform({scale:1/scale})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"Product3DNode"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function Product3DSlice(_params,...restArgs){const _this=this;Inherit(_this,FXSceneSlice,{timeline:!1,sceneLayoutName:_params.sceneName,preventAutoInit:!0}),Inherit(_this,XComponent),_this.fragName="Product3DSlice",_this.contexts="FXSceneSlice, { timeline: false, sceneLayoutName: _params.sceneName, preventAutoInit: true }",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"node-wrapper",_type:"div",refName:"nodeWrapper",children:[{view:"Product3DNode",data:"$items",_type:"ViewState",refName:"nodes",children:[]}]},{className:"product-3d-slice-nav",_type:"div",refName:"nav",children:[{icon:"left-arrow",onClick:function handlePrevNode(){const focusTimes=getSortedUniqueFocusTimes();if(0===focusTimes.length)return;const currentNode=_this.nodes.views[_this.lastIndex],currentFocusTime=currentNode?currentNode.focusTime:0,currentTimeIndex=focusTimes.findIndex(time=>Math.abs(time-currentFocusTime)<.001),prevTimeIndex=currentTimeIndex>0?currentTimeIndex-1:focusTimes.length-1,nodeIndex=findNodeIndexByFocusTime(focusTimes[prevTimeIndex]);nodeIndex>=0&&handleNodeClick(nodeIndex)},_type:"CircleButton",refName:"prevButton",children:[]},{icon:"arrow-right",onClick:function handleNextNode(){const focusTimes=getSortedUniqueFocusTimes();if(0===focusTimes.length)return;const currentNode=_this.nodes.views[_this.lastIndex],currentFocusTime=currentNode?currentNode.focusTime:0,currentTimeIndex=focusTimes.findIndex(time=>Math.abs(time-currentFocusTime)<.001),nextTimeIndex=currentTimeIndex<focusTimes.length-1?currentTimeIndex+1:-1,nodeIndex=findNodeIndexByFocusTime(focusTimes[nextTimeIndex]);nodeIndex>=0?handleNodeClick(nodeIndex):currentTimeIndex!==focusTimes.length-1&&0!==nextTimeIndex||Global.lenis.scrollTo(_this.element.div.offsetTop+_this.element.div.offsetHeight-Stage.height/3,{force:!0,duration:2.5})},_type:"CircleButton",refName:"nextButton",children:[]}]}]}),(_this.nuke||World.NUKE).paused=!0,_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let fallbackVideo,fallbackVideoThumbnail,thumbnailUrl,onInit=_this.onInit;_this.element.classList().add(_params.sceneName),_this.sceneName=_params.sceneName;try{fallbackVideo=_this.getSync("Global/siteSettings")[`fallbackVideo${_params.sceneName}`],fallbackVideoThumbnail=_this.getSync("Global/siteSettings")[`fallbackThumbnail${_params.sceneName}`],thumbnailUrl=fallbackVideoThumbnail?.asset?.url}catch(error){console.warn(error)}function requiresFallback(){const mobileBlocklist=Utils.query("preventFallback")?[]:["barracuda","baracuda"];return!Global.PLAYGROUND&&(Tests.requiresFallbackGraphics()||_params.sceneName.toLowerCase().includes(mobileBlocklist))}function getSortedUniqueFocusTimes(){if(!_this.nodes||!_this.nodes.views||0===_this.nodes.views.length)return[];const focusTimes=_this.nodes.views.map(view=>view.focusTime);return[...new Set(focusTimes)].sort((a,b)=>a-b)}function findNodeIndexByFocusTime(focusTime){return _this.nodes&&_this.nodes.views&&0!==_this.nodes.views.length?_this.nodes.views.findIndex(view=>Math.abs(view.focusTime-focusTime)<.001):-1}function handleNodeClick(index){let targetScroll;index=Math.max(0,Math.min(index,_this.nodes.views.length));let targetProgress=_this.nodes.views[index].focusTime;if(targetScroll=_this.scrollHeight>=Stage.height?_this.scrollTop-Math.range(targetProgress,0,.999,0,-_this.scrollHeight+Stage.height,!0):_this.scrollTop-Math.range(targetProgress,0,.999,Stage.height,-_this.scrollHeight,!0),isNaN(targetScroll)||targetScroll<0||targetScroll>document.body.scrollHeight){let sectionStart=_this.scrollTop;targetScroll=sectionStart+(_this.scrollTop+(_this.scrollHeight-Stage.height)-sectionStart)*targetProgress}targetScroll=Math.max(0,Math.min(targetScroll,document.body.scrollHeight-Stage.height)),scrollToPoint(index,targetScroll)}function scrollToPoint(index,targetScroll){_this.flag("animating",!0),_this.lastIndex=index,_this.lastScroll=targetScroll,_this.targetNodeIndex=index;let options={force:!0,duration:2,onComplete:_=>{if(-1!==_this.targetNodeIndex&&(_this.scrollAttempts++,_this.scrollAttempts<5)){const targetNode=_this.nodes.views[_this.targetNodeIndex];if(!targetNode)return _this.flag("animating",!1),_this.targetNodeIndex=-1,void(_this.scrollAttempts=0);if(Math.abs(targetNode.focusTime-_this.progress)>.015){let progressDiff=targetNode.focusTime-_this.progress,scaleFactor=Math.min(1,3*Math.abs(progressDiff)),scrollAdjustment=progressDiff*(_this.scrollHeight*scaleFactor),newTargetScroll=Global.lenis.scroll+scrollAdjustment;return void Global.lenis.scrollTo(newTargetScroll,{force:!0,duration:1.5-.3*_this.scrollAttempts})}return _this.flag("animating",!1),_this.targetNodeIndex=-1,void(_this.scrollAttempts=0)}_this.flag("animating",!1),_this.targetNodeIndex=-1,_this.scrollAttempts=0}};_this.flag("hasEntered")&&Global.lenis.scrollTo(targetScroll,options)}async function initLayout(){_this.flag("hasInitLayout",!0),_this.initMesh(),_this.initLayout(_params.sceneName),await _this.layout.getAllLayers(),_this.uploadSync();let promises=[];for(let key in _this.layout.layers)if(_this.layout.layers[key].shader){"ProductShader"===_this.layout.layers[key].shader.vsName&&(_this.layout.layers[key].visible=!0);for(let uniform in _this.layout.layers[key].shader.uniforms)_this.layout.layers[key].shader.uniforms[uniform]?.value?.promise&&promises.push(_this.layout.layers[key].shader.uniforms[uniform].value.promise)}_this.flag("hasInitialized",!0),Promise.all(promises).then(_=>{_this.composite.tween("uLoaded",1,250,"easeOutCubic")})}_this.requiresFallback=requiresFallback(),_this.requiresFallback?_this.visible=!1:initLayout(),_this.uniforms={uExposure:{value:0},uHighlight:{value:.05},uBlacks:{value:.3},uBlacksThreshold:{value:.6},uHue:{value:0},uSat:{value:1},tUpscaled:{value:null,ignoreUIL:!0},tLoader:{value:thumbnailUrl?Utils3D.getTexture(thumbnailUrl):null,ignoreUIL:!0},uLoaded:{value:0,ignoreUIL:!0}},Global.PLAYGROUND||(_this.prevButton.setDisabled(!0),_this.items=new StateArray([]),_this.bind(_params,"content",async function updateItems(content){_this.items.refresh(content),await _this.wait(_=>_this.nodes&&_this.nodes.views.length>0),_this.nodes.views.sort((a,b)=>a.focusTime-b.focusTime).map((node,index)=>{node.index=index})})),_this.onResize(_=>{_this.responsiveScale=Math.range(Stage.width/Stage.height,1.5,0,1.5,0,!0),_this.nodeWrapper.transform({scale:_this.responsiveScale,x:"-50%"}),_this.nodeWrapper.css({width:Stage.height/100*177.777+"px",height:`${Stage.height}px`}),_this.set("responsiveScale",_this.responsiveScale),_this.layout&&_this.layout.camera&&(_this.layout.camera.aspect=Stage.width/currentHeight,_this.layout.camera.updateProjectionMatrix())}),_this.onInit=_=>{_this.requiresFallback?function fallbackInit(){_this.nuke.paused=!0;let videoWrapper=_this.element.create("video-wrapper");_this.responsiveVideo=_this.initClass(ResponsiveVideo,AppState.createLocal({videoWithMeta:fallbackVideo,preload:!0,muted:!0,autoplay:!1,controls:!1,noObserver:!0})),_this.video=_this.responsiveVideo.video,videoWrapper.add(_this.video.element);let getProgress=_=>{let time=_this.progress;return isNaN(time)&&(time=0),time};_this.startRender(_=>{let progress=getProgress();0===progress?(videoWrapper.classList().add("top"),videoWrapper.classList().remove("bottom"),videoWrapper.classList().remove("fixed")):.999===progress?(videoWrapper.classList().remove("top"),videoWrapper.classList().add("bottom"),videoWrapper.classList().remove("fixed")):(videoWrapper.classList().add("fixed"),videoWrapper.classList().remove("top"),videoWrapper.classList().remove("bottom"))}),_this.delayedCall(async _=>{await _this.video.load();let prevTime=-1;_this.startRender(_=>{let time=getProgress()*_this.video.duration;const rate=1e3;time=Math.round(time*rate)/rate,Math.abs(time-prevTime)>.01&&(prevTime=time,_this.video.seek(time))},_this.video.div.fastSeek?30:15)},500)}():function normalInit(){_this.composite.addUniforms({tUpscaled:_this.upscale?.uniform}),_this.events.sub(_this.nuke,Nuke.BEFORE_PASSES,_this.upscale.render),_this.initTimeline(),_this.startRender(_=>{let progress=_this.progress;if(!isNaN(progress)){progress>0&&!_this.flag("hasInitLayout")&&initLayout(),progress+=.01*Mouse.tilt.x+.01*Mouse.tilt.y,_this.progress=progress;for(let key in _this.layers)_this.layers[key].scriptClass&&_this.layers[key].scriptClass.setPlayhead&&_this.layers[key].scriptClass.setPlayhead(Math.max(0,Math.min(progress,.99)))}})}(),Global.PLAYGROUND||(!function handleNodeFocus(){_this.startRender(_=>{if(_this.progress>.05&&_this.progress<.99&&_this.visible){if(!_this.nodes||!_this.nodes.views||0===_this.nodes.views.length)return;if(0===Global.lenis.velocity&&_this.flag("animating",!1),_this.flag("animating")||Math.abs(_this.lastScroll-Global.lenis.scroll)<15)return;if(Global.lenis.velocity<.01){let closestNode=[..._this.nodes.views].sort((a,b)=>Math.abs(a.focusTime-_this.progress)-Math.abs(b.focusTime-_this.progress))[0];if(!closestNode)return;let targetScroll,targetIndex=closestNode.index,targetProgress=closestNode.focusTime;if(Math.abs(targetProgress-_this.progress)<.01)return;if(_this.lastTargetTime===targetProgress&&_this.scrollAttempts>0)return;if(_this.lastTargetTime=targetProgress,_this.flag("animating",!0),_this.flag("hasEntered",!0),-1===targetIndex)return void _this.flag("animating",!1);if(targetScroll=_this.scrollHeight>=Stage.height?_this.scrollTop-Math.range(targetProgress,0,.999,0,-_this.scrollHeight+Stage.height,!0):_this.scrollTop-Math.range(targetProgress,0,.999,Stage.height,-_this.scrollHeight,!0),isNaN(targetScroll)||targetScroll<0||targetScroll>document.body.scrollHeight){let sectionStart=_this.scrollTop;targetScroll=sectionStart+(_this.scrollTop+(_this.scrollHeight-Stage.height)-sectionStart)*targetProgress}targetScroll=Math.max(0,Math.min(targetScroll,document.body.scrollHeight-Stage.height)),_this.scrollAttempts=0,scrollToPoint(targetIndex,targetScroll)}}else _this.flag("hasEntered",!1)}),_this.startRender(_=>{_this.progress>.05&&_this.progress<.99&&_this.visible?_this.flag("navVisible")||(_this.nav.css({opacity:0,display:"flex"}).tween({opacity:1},250,"easeOutCubic"),_this.flag("navVisible",!0)):_this.flag("navVisible")&&(_this.nav.tween({opacity:0},250,"easeOutCubic").onComplete(_=>_this.nav.hide()),_this.flag("navVisible",!1))}),_this.bind("Product3DNode/lastActiveIndex",index=>{if(!_this.nodes||!_this.nodes.views||0===_this.nodes.views.length)return;const focusTimes=getSortedUniqueFocusTimes();if(0===focusTimes.length)return;const currentNode=_this.nodes.views[index];if(!currentNode)return;const currentFocusTime=currentNode.focusTime,isFirst=0===focusTimes.findIndex(time=>Math.abs(time-currentFocusTime)<.001);_this.prevButton.setDisabled(isFirst)})}(),Device.mobile&&_this.startRender(_=>{const currentHeight=((window.visualViewport?window.visualViewport.height:window.innerHeight)+window.innerHeight)/2;_this.lastViewportHeight||(_this.lastViewportHeight=currentHeight),Math.abs(currentHeight-_this.lastViewportHeight)>3&&(_this.lastViewportHeight=currentHeight,_this.nodeWrapper.css({width:currentHeight/100*177.777+"px",height:`${currentHeight}px`}),_this.responsiveScale=Math.range(Stage.width/currentHeight,1.5,0,1.5,0,!0),_this.set("responsiveScale",_this.responsiveScale),_this.layout&&_this.layout.camera&&(_this.layout.camera.aspect=Stage.width/currentHeight,_this.layout.camera.updateProjectionMatrix()))}))},_this.lastIndex=0,_this.lastScroll=0,_this.scrollAttempts=0,_this.targetNodeIndex=-1,_this.lastTargetTime=-1,onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_this.composite=_this.initClass(NukePass,AppState.createLocal({shader:"MovecComposite",uniforms:_this.uniforms})),_this.composite.isFragment&&_promises.push(_this.wait(_this.composite,"__ready")),_this.nuke&&(_this.composite.texture=_this.nuke.rttBuffer),_this.bloom=_this.initClass(FX.UnrealBloom,AppState.createLocal({unique:"menacex",nuke:_this.nuke,dpr:2.5,enabled:!0})),_this.bloom.isFragment&&_promises.push(_this.wait(_this.bloom,"__ready")),_this.bloom.uniforms&&_this.composite.addUniforms(_this.bloom.uniforms),_this.upscale=_this.initClass(FX.Upscale,AppState.createLocal({nuke:_this.nuke,unique:"upscale"})),_this.upscale.isFragment&&_promises.push(_this.wait(_this.upscale,"__ready")),_this.upscale.uniforms&&_this.composite.addUniforms(_this.upscale.uniforms),(_this.composite.upload||_this.composite.pass)&&((_this.nuke||World.NUKE).add(_this.composite.pass instanceof NukePass?_this.composite.pass:_this.composite),ShaderUIL.add(_this.composite.pass instanceof NukePass?_this.composite.pass:_this.composite)),(_this.nuke||World.NUKE).paused=!1,requiresFallback()&&(_this.nuke||World.NUKE).disable(),_promises=null,_this.flag?.("__ready",!0),onInit||"Product3DSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ProductApplicationBlock(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="ProductApplicationBlock",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"h6",_innerText:"$data.title",refName:"title",children:[]},{_type:"div",refName:"media",children:[]},{content:"$data.text",_type:"RichText",refName:"text",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"media",function handleMedia(media){_this.media=_this.initClass(ResponsiveMedia,AppState.createLocal({...media[0],autoplay:!0,loop:!0,cropAspect:16/9}),0,AppState.createLocal(),[_this.media])}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ProductApplicationBlock"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ProductApplicationSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="ProductApplicationSlice",_this.contexts="ViewStateElement,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"content",children:[{view:"ProductApplicationBlock",data:"$data.applications",_type:"ViewState",refName:"unnamed",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"backgroundColor",color=>{_this.element.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)})}),_this.onMounted=()=>{_this.element.css({opacity:0})},_this.onInView=()=>{_this.element.tween({opacity:1},1e3,"easeOutExpo")},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ProductApplicationSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ProductCarouselCard(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="ProductCarouselCard",_this.contexts="ViewStateElement,TextAnimationHelper,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"card",children:[{_type:"p",_innerText:"$data.productTitle",refName:"title",children:[]},{disableLiveEditOverlay:!0,imageWithMeta:"$data.productImage",_type:"ResponsiveImage",refName:"image",children:[]},{_type:"div",refName:"details",children:[{_type:"p",_innerText:"$data.productLabel",refName:"label",children:[]},{_type:"p",_innerText:"$data.productDescription",refName:"description",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"index",function handleIndex(index){_this.element.attr("data-index",index)}),_this.onMounted=async()=>{await _this.wait("element"),_this.element.transform({y:"20%"}),_this.element.css({opacity:0})},_this.element.hover(e=>{_this.animateText(_this.title,"over"===e.action?650:1,"over"===e.action)}),_this.animateIn=async index=>{_this.element.tween({y:"0%",opacity:1},1e3,"easeOutExpo",100*index).promise()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ProductCarouselCard"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ProductCarouselSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView),Inherit(_this,XComponent),_this.fragName="ProductCarouselSlice",_this.contexts="ViewStateElement,Element,InView",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"top",children:[{_type:"h4",_innerText:"$data.title",refName:"header",children:[]}]},{_type:"div",refName:"carousel",children:[{data:"$data.products",_type:"ProductCarouselSlider",refName:"slider",children:[]}]},{_type:"div",refName:"controls",children:[{icon:"left-arrow",onClick:function handlePrev(){_this.fire("ProductCarouselSlider/prev")},_type:"CircleButton",refName:"prev",children:[]},{icon:"arrow-right",onClick:function handleNext(){_this.fire("ProductCarouselSlider/next")},_type:"CircleButton",refName:"next",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function handleResize(){window.innerWidth>_this.slider.element.div.offsetWidth?_this.controls.hide():_this.controls.show()}_this.bind("ProductCarouselSlider/elementPosition",elementPosition=>{"start"===elementPosition&&_this.prev.setDisabled(!0),"end"===elementPosition&&_this.next.setDisabled(!0),"middle"===elementPosition&&(_this.prev.setDisabled(!1),_this.next.setDisabled(!1))}),_this.onMounted=async()=>{await _this.wait("header"),_this.header.transform({y:"100%"}),await _this.wait("slider"),await _this.slider.cardsReady(),_this.onResize(handleResize)},_this.onInView=()=>{_this.header.tween({y:"0%"},1500,"easeOutExpo")},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ProductCarouselSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ProductCarouselSlider(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,InView),Inherit(_this,XComponent),_this.fragName="ProductCarouselSlider",_this.contexts="Element,InView",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.isReady=!1,_this.params.data=_this.params.data||[],_this.finalData=new StateArray([]);let isResizing=!1,allCards=[];function handleResize(){isResizing=!0,isResizing=!1}_this.sliderObj={x:0},_this.sliderOffset=0,_this.startRender(function loop(){if(!_this.isReady)return;if(isResizing)return;_this.element.x=Math.max(_this.sliderObj.x,-1*(_this.element.div.offsetWidth-window.innerWidth)),window.innerWidth>_this.element.div.offsetWidth&&(_this.element.x=0);_this.element.transform(),_this.element.x>=-1&&_this.set("ProductCarouselSlider/elementPosition","start");_this.element.x<=-1&&_this.element.x>=-1*(_this.element.div.offsetWidth-window.innerWidth)&&_this.set("ProductCarouselSlider/elementPosition","middle");_this.element.x===-1*(_this.element.div.offsetWidth-window.innerWidth)&&_this.set("ProductCarouselSlider/elementPosition","end")}),_this.onInit=()=>{!function setupSlides(){for(let i=0;i<_this.params.data.length;i++){_this.params.data[i]={..._this.params.data[i],index:i};let card=_this.createFragment(ProductCarouselCard,AppState.createLocal(_this.params.data[i]));allCards.push(card)}}()},_this.onMounted=async()=>{await _this.wait("element"),function setupSlider(){_this.slider=_this.initClass(Interaction.Slider,_this.sliderObj,{x:1},{hit:_this.element,width:[..._this.element.children()][0].offsetWidth,slides:_this.params.data.length,gap:12}),_this.slider.maxSlides=_this.params.data.length-1,_this.slider.interpolate=.3,_this.slider.ease="easeOutCubic",_this.slider.easeTime=750,_this.slider.flickable=!0}(),_this.onResize(handleResize),function addHandlers(){_this.events.sub(_this.slider,Interaction.Slider.START_INTERACTION,_=>{_this.fire("ProductCarouselSlider/interact",{action:"start"})}),_this.events.sub(_this.slider,Interaction.Slider.MOVE,_=>{_this.fire("ProductCarouselSlider/interact",{action:"move"})}),_this.events.sub(_this.slider,Interaction.Slider.END_INTERACTION,_=>{_this.fire("ProductCarouselSlider/interact",{action:"end"})})}(),_this.isReady=!0},_this.listen("ProductCarouselSlider/prev",()=>{_this.slider.prev()}),_this.listen("ProductCarouselSlider/next",()=>{_this.slider.next()}),_this.onInView=()=>{allCards.forEach((card,index)=>{card.animateIn(index)})},_this.cardsReady=async()=>(await _this.wait("isReady"),!0),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ProductCarouselSlider"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ProductExploreSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="ProductExploreSlice",_this.contexts="ViewStateElement,TextAnimationHelper,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"content",children:[{_type:"p",_innerText:"$data.subtitle",refName:"subtitle",children:[]},{_type:"h4",_innerText:"$data.title",refName:"title",children:[]}]},{className:"wrapper",_type:"div",refName:"unnamed",children:[{view:"ResponsiveMedia",data:"$coverMediaSrc",_type:"ViewState",refName:"coverMedia",children:[]},{"aria-label":"Play video button",className:"play-button",click:"$openModal",role:"button",_type:"button",refName:"unnamed",children:[]}]},{data:"$data",_type:"VideoPlayerModal",refName:"modal",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"coverMedia",function setupCover(){if(!_this.data.coverMedia?.video&&!_this.data.coverMedia?.image)return;let coverMedia=_this.data.coverMedia.video?_this.data.coverMedia.video:_this.data.coverMedia.image;coverMedia._type="mp4"===coverMedia?.asset?.extension?"videoWithMeta":"imageWithMeta",_this.coverMediaSrc=new StateArray([coverMedia]),_this.wait(_=>_this.coverMedia&&1===_this.coverMedia.views.length&&_this.coverMedia.views[0].mediaElement&&_this.coverMedia.views[0].mediaElement.params).then(_=>{_this.coverMedia.views[0].mediaElement.params.controls=!1,_this.coverMedia.views[0].mediaElement.params.loop=!0,_this.coverMedia.views[0].mediaElement.params.autoplay=!0})}),_this.bind(_this.data,"modalMedia",modalMedia=>{modalMedia&&(_this.modalMediaSrc=modalMedia.video?modalMedia.video:modalMedia.youtube?modalMedia.youtube:modalMedia.vimeo)}),(!_this.data.subtitle||_this.data.subtitle&&0===_this.data.subtitle.trim().length)&&_this.subtitle.hide(),_this.openModal=_=>_this.modal.open(),_this.element.click(_this.openModal),_this.onInView=()=>{_this.animateText(_this.subtitle,500,!0)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ProductExploreSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ProductHeaderSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView),Inherit(_this,TextAnimationHelper),Inherit(_this,XComponent),_this.fragName="ProductHeaderSlice",_this.contexts="ViewStateElement,Element,InView,TextAnimationHelper",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"textContainer",children:[{_type:"div",refName:"backgroundVideoContainer",children:[{videoWithMeta:"$data.backgroundVideo",loop:!0,autoplay:!0,_type:"ResponsiveVideo",refName:"videoLoop",children:[]}]},{_type:"div",refName:"textContent",children:[{_type:"div",refName:"titles",children:[{_type:"p",_innerText:"$data.shortTitle",refName:"shortTitle",children:[]},{_type:"h1",refName:"titleWrapper",children:[{_type:"span",_innerText:"$data.title",refName:"title",children:[]}]}]},{_type:"div",refName:"details",children:[{_type:"div",refName:"column1",children:[{className:"paragraph1",content:"$data.column1",_type:"RichText",refName:"paragraph1",children:[]},{"aria-hidden":!0,className:"paragraph1Hidden",content:"$data.column1",_type:"RichText",refName:"paragraph1Hidden",children:[]}]},{_type:"div",refName:"column2",children:[{className:"paragraph2",content:"$data.column2",_type:"RichText",refName:"paragraph2",children:[]},{"aria-hidden":!0,className:"paragraph2Hidden",content:"$data.column2",_type:"RichText",refName:"paragraph2Hidden",children:[]}]},{_type:"div",refName:"column3",children:[{_type:"div",refName:"ctaWrapper",children:[{data:"$data.cta",_type:"CtaButton",refName:"link",children:[]}]},{"aria-label":"Scroll to next section",_type:"button",refName:"iconWrapper",children:[{id:"arrow-down",_type:"Sprite",refName:"icon1",children:[]}]}]}]}]}]},{_type:"div",refName:"mediaContainer",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.data.cta?(_this.ctaWrapper.show(),_this.iconWrapper.hide()):(_this.ctaWrapper.hide(),_this.iconWrapper.show()),_this.data.shortTitle?_this.shortTitle.show():_this.shortTitle.hide(),_this.onMounted=()=>{!function setHiddenText(){[..._this.paragraph1Hidden.element.children()].forEach(child=>{child.setAttribute("aria-hidden","true")}),[..._this.paragraph2Hidden.element.children()].forEach(child=>{child.setAttribute("aria-hidden","true")})}(),function animateIn(){_this.title.transform({y:"100%"}),_this.column1.transform({y:"50%"}),_this.column1.css({opacity:0}),_this.column2.transform({y:"50%"}),_this.column2.css({opacity:0}),_this.mediaContainer.css({opacity:0}),_this.mediaContainer.transform({y:"15%"}),_this.column1.tween({y:"0%",opacity:1},1500,"easeOutExpo"),_this.column2.tween({y:"0%",opacity:1},1500,"easeOutExpo",250),_this.title.tween({y:"-6%"},1500,"easeOutExpo").promise(),_this.mediaContainer.tween({y:"0%",opacity:1},1500,"easeOutExpo",100).promise(),[..._this.paragraph1.element.children()].forEach(child=>{let hydraObject=new HydraObject(child);hydraObject.text(child.textContent),_this.animateText(hydraObject,750,!0)}),[..._this.paragraph2.element.children()].forEach(child=>{let hydraObject=new HydraObject(child);hydraObject.text(child.textContent),_this.animateText(hydraObject,750,!0)})}()},_this.bind(_this.data,"shortTitle",shortTitle=>{shortTitle?(_this.shortTitle.show(),_this.shortTitle.text(shortTitle)):_this.shortTitle.hide()}),_this.bind(_this.data,"title",title=>{let fontSizeMultiplier=Math.range(title.length,11,20,.8,.5,!0);_this.title.text(title),_this.element.div.style.setProperty("--fontSizeMultiplier",fontSizeMultiplier)}),_this.bind(_this.data,"backgroundColor",backgroundColor=>{_this.element.css({backgroundColor:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)}),_this.icon1.element.css({color:SanityUtils.stegaClean(backgroundColor.contrastColor)})}),_this.bind(_this.data,"media",media=>{if(media.length>0){let mediaParams=AppState.createLocal({...media[0],autoplay:!0,muted:!0,loop:!0,preload:!0});_this.media=_this.initClass(ResponsiveMedia,mediaParams,[_this.mediaContainer])}}),_this.iconWrapper.click(()=>{Global.lenis?.scrollTo(_this.element.div.offsetHeight,{duration:2.5,lerp:.1})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ProductHeaderSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ProductQualitiesSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="ProductQualitiesSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"h4",_innerText:"$data.title",refName:"unnamed",children:[]},{_type:"nav",refName:"nav",children:[{_type:"div",refName:"tabs",children:[{view:"ProductQualityTab",data:"$qualities",_type:"ViewState",refName:"tabViewState",children:[]},{_type:"div",refName:"activeBorder",children:[]}]}]},{_type:"div",refName:"contentWrapper",children:[{_type:"div",refName:"content",children:[{view:"ProductQualityContent",data:"$qualities",_type:"ViewState",refName:"unnamed",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function handleActiveIndex(activeIndex){if(!_this.tabViewState)return;let currentTabOffset=_this.tabViewState.views[activeIndex].element.div.getBoundingClientRect().x,offsetLeft=_this.tabViewState.views[0].element.div.getBoundingClientRect().x,currentTabWidth=_this.tabViewState.views[activeIndex].element.div.getBoundingClientRect().width/_this.tabs.div.getBoundingClientRect().width*100;_this.activeBorder.tween({x:""+(currentTabOffset-offsetLeft),scaleX:`${currentTabWidth}%`},1e3,"easeOutExpo").promise()}_this.state.activeIndex=0,_this.qualities=new StateArray([]),_this.bind(_this.data,"qualities",qualities=>{_this.data.fullIndex=qualities.length,_this.qualities.refresh(qualities),async function activeBorderInit(){await _this.wait("tabViewState"),await async function viewStateReady(vs,data){return _this.wait(_=>vs.views.length===data.length)}(_this.tabViewState,_this.qualities),_this.tabViewState.views.forEach(view=>{view.element.onResize(e=>{0!==e.borderBoxSize[0].inlineSize&&handleActiveIndex(_this.state.activeIndex,e.borderBoxSize[0].inlineSize)})})}()}),_this.bind(_this.state,"activeIndex",handleActiveIndex),_this.bind(_this.data,"backgroundColor",function handleBackgroundColor(color){_this.activeBorder.css({background:SanityUtils.stegaClean(color.contrastColor)}),_this.element.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)})}),_this.bind(_this.data,"cardColor",function handleCardColor(color){_this.content.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ProductQualitiesSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ProductQualityContent(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="ProductQualityContent",_this.contexts="ViewStateElement,TextAnimationHelper,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"counter",children:[{_type:"div",refName:"counterCurrent",children:[]},{_type:"div",refName:"counterFull",children:[]}]},{_type:"div",refName:"currentWrapper",children:[{_type:"div",refName:"current",children:[]}]},{_type:"div",refName:"titleWrapper",children:[{version:1.1,xmlns:"http://www.w3.org/2000/svg",_type:"svg",refName:"svgMask",children:[{_type:"defs",refName:"unnamed",children:[{width:"100%",height:"100%",id:"$state.gradientId",_type:"linearGradient",refName:"unnamed",children:[{offset:"0%",style:"stop-color:white;stop-opacity:1",_type:"stop",refName:"whiteAnchor",children:[]},{style:"stop-color:white;stop-opacity:1",_type:"stop",refName:"whiteMarker",children:[]},{style:"stop-color:black;stop-opacity:1",_type:"stop",refName:"blackMarker",children:[]},{offset:"100%",style:"stop-color:black;stop-opacity:1",_type:"stop",refName:"blackAnchor",children:[]}]},{id:"$state.maskIdIn",_type:"mask",refName:"unnamed",children:[{width:"100%",height:"100%",fill:"$state.gradientRef",_type:"rect",refName:"unnamed",children:[]}]}]}]},{_type:"p",_innerText:"$data.title",refName:"title",children:[]}]},{_type:"h6",_innerText:"$data.description",refName:"description",children:[]},{_type:"div",refName:"imageWrapper",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.image;let tweener={index:0};function handleMedia(media){_this.image=_this.initClass(ResponsiveMedia,AppState.createLocal({...media[0],autoplay:!0,loop:!0,cropAspect:16/9}),0,AppState.createLocal(),[_this.imageWrapper])}function handleFullIndex(fullIndex){if(fullIndex){_this.counterFull.text(`/ 0${fullIndex}`);for(let i=0;i<fullIndex;i++){let currentIndex=_this.counterCurrent.create("current-index","p"),currentIndexLarge=_this.current.create("current-index-large","h1");currentIndex.attr("data-index",i),currentIndex.text(`0${i+1}`),currentIndexLarge.attr("data-index",i),currentIndexLarge.text(`${i+1}`)}}}async function handleSplitText(){if(_this.data.description)if(_this.flag("splittingText"))_this.flag("splitTextQueued",!0);else{if(_this.flag("splittingText",!0),_this.description.css({minWidth:"100%"}),_this.descriptionSplitTextInstance?(_this.descriptionSplitTextInstance.revert(),_this.description.text(_this.data.description),defer(_this.descriptionSplitTextInstance.split)):(_this.description.text(_this.data.description),_this.descriptionSplitTextInstance=_this.initClass(SplitText,_this.description,{type:"lines,words"})),await _this.descriptionSplitTextInstance.ready(),_this.description.empty(),_this.descriptionSplitTextInstance.lines.forEach((line,index)=>{let lineWrapper=_this.description.create("line-wrapper","div");TextUtils.wrapRedactedText(line.div),lineWrapper.div.append(line.div)}),_this.flag("splittingText",!1),_this.flag("splitTextQueued"))return _this.flag("splitTextQueued",!1),void handleSplitText();_this.index===_this.parent.state.activeIndex?animateIn():animateOut()}}async function handleIndexChange(index,previousIndex){await _this.wait("descriptionSplitTextInstance"),function handleTopIndex(index,previousIndex){[..._this.counterCurrent.children()].forEach(child=>{if(parseInt(child.dataset.index)===previousIndex){let element=new HydraObject(child);element.transform({y:"0%"}),element.attr("aria-hidden","true"),element.tween({y:"-100%"},500,"easeInOutCubic").promise()}else if(parseInt(child.dataset.index)===index){let element=new HydraObject(child);element.transform({y:"100%"}),element.attr("aria-hidden","false"),element.tween({y:"0%"},500,"easeInOutCubic").promise()}else{let element=new HydraObject(child);element.attr("aria-hidden","true"),element.transform({y:"100%"})}})}(index,previousIndex),function handleBottomIndex(index,previousIndex){[..._this.current.children()].forEach(child=>{if(parseInt(child.dataset.index)===previousIndex){let element=new HydraObject(child);element.transform({y:"0%"}),element.attr("aria-hidden","true"),element.tween({y:"-100%"},450,"easeInOutCubic").promise()}else if(parseInt(child.dataset.index)===index){let element=new HydraObject(child);element.transform({y:"100%"}),element.attr("aria-hidden","false"),element.tween({y:"0%"},450,"easeInOutCubic").promise()}else{let element=new HydraObject(child);element.attr("aria-hidden","true"),element.transform({y:"100%"})}})}(index,previousIndex),index===_this.index?await animateIn():await animateOut()}function animateIn(){_this.element.css({opacity:1}),_this.counter.css({opacity:1}),_this.current.css({opacity:1}),async function titleAnimateIn(){if(await _this.wait("title"),_this.state.isMobile)_this.whiteMarker.attr("offset","100%"),_this.blackMarker.attr("offset","100%"),_this.title.css({opacity:0}),_this.title.tween({opacity:1},500,"easeOutExpo",200).promise();else{_this.title.css({opacity:1});let currentIndex=-1;tweener.index=0,_this.whiteMarker.attr("offset","0%"),_this.blackMarker.attr("offset","0%"),_this.whiteAnchor.attr("offset","0%"),_this.blackAnchor.attr("offset","100%"),tween(tweener,{index:_this.title.div.textContent.length},400,"easeOutCubic",200).onUpdate(_=>{let nextIndex=Math.floor(tweener.index);if(_this.title?.div&&_this.svgMask&&currentIndex!==nextIndex&&nextIndex<_this.title.div.textContent.length){currentIndex=nextIndex;let child=_this.title.div.childNodes[0];if(child.nodeType===Node.TEXT_NODE){let range=document.createRange();range.setStart(child,currentIndex),range.setEnd(child,currentIndex+1);let maskPos=range.getClientRects(),parentBound=_this.svgMask.div.getBoundingClientRect();if(!maskPos[0]||!parentBound)return;let startPos=(maskPos[0].left-parentBound.left)/parentBound.width*100,endPos=(maskPos[0].right-parentBound.left)/parentBound.width*100;_this.whiteMarker.attr("offset",`${startPos}%`),_this.blackMarker.attr("offset",`${endPos}%`)}}}).onComplete(_=>{_this.whiteMarker.attr("offset","100%"),_this.blackMarker.attr("offset","100%")}).promise()}_this.animateText(_this.title,500,!0)}(),async function descriptionAnimateIn(){await _this.descriptionSplitTextInstance.ready(),_this.descriptionSplitTextInstance.lines.forEach(async(line,index)=>{line.transform({y:"100%"}),await line.tween({y:"0%"},500,"easeInOutCubic",50*index).promise()})}(),async function imageAnimateIn(){await _this.wait("image"),_this.image.element.transform({y:"100%"}),_this.image.element.css({zIndex:1}),_this.image.element.tween({y:"0%"},500,"easeInOutCubic").promise()}()}function animateOut(){_this.counter.css({opacity:0}),_this.current.css({opacity:0}),async function titleAnimateOut(){await _this.wait("title"),_this.title.css({opacity:1}),_this.title.tween({opacity:0},500,"easeOutExpo").onComplete(()=>{_this.element.css({opacity:0})}).promise()}(),async function descriptionAnimateOut(){await _this.descriptionSplitTextInstance.ready(),_this.descriptionSplitTextInstance.lines.forEach((line,index)=>{line.transform({y:"0%"}),line.tween({y:"-100%"},500,"easeInOutCubic",50*index).promise()})}(),async function imageAnimateOut(){await _this.wait("image"),_this.image.element.transform({y:"0%"}),_this.image.element.css({zIndex:0}),_this.image.element.tween({y:"-50%"},500,"easeInOutCubic").promise()}()}_this.state.isMobile=Stage.width<769,_this.parent=_this.findParent("ProductQualitiesSlice"),_this.onMounted=async()=>{await SplitText.isFontReady(),await _this.wait("title"),await _this.wait("description"),_this.bind(_this.data,"description",handleSplitText),_this.bind(_this.data,"media",handleMedia),_this.bind(_this.parent.data,"fullIndex",handleFullIndex),_this.bind(_this.parent.state,"activeIndex",handleIndexChange),async function maskInit(){await _this.wait("title"),_this.state.maskIdIn=`mask-${_this.data._key}`,_this.state.gradientId=`gradient-${_this.data._key}`,_this.state.gradientRef=`url(#${_this.state.gradientId})`,_this.element.div.style.setProperty("--mask-id",`url(#${_this.state.maskIdIn})`),_this.title.onResize(e=>{0!==e.borderBoxSize[0].inlineSize&&(_this.svgMask.attr("width",_this.title.div.offsetWidth),_this.svgMask.attr("height",_this.title.div.offsetHeight))})}()},_this.element.onResize(function resize(){_this.state.isMobile=Stage.width<769,handleSplitText()}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ProductQualityContent"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ProductQualityTab(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element,"button"),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="ProductQualityTab",_this.contexts="ViewStateElement,Element, 'button',InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{"aria-label":"$data.title",role:"tab",_type:"UI",refName:"unnamed",children:[{_type:"p",_innerText:"$data.title",refName:"buttonText",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onMounted=()=>{_this.state.isMobile=Stage.width<769,_this.state.isMobile||_this.element.transform({x:"-10%"}).css({opacity:0})},_this.onInView=()=>{_this.state.isMobile||(_this.index===_this.parent.state.activeIndex?_this.element.tween({x:"0%",opacity:1},1e3,"easeOutExpo",100*(_this.index+1)):_this.element.tween({x:"0%",opacity:.6},1e3,"easeOutExpo",100*(_this.index+1)))},_this.parent=_this.findParent("ProductQualitiesSlice"),_this.bind(_this.parent.state,"activeIndex",function handleActiveIndex(activeIndex){_this.index===activeIndex?(_this.element.tween({color:SanityUtils.stegaClean(_this.parent.data.backgroundColor.contrastColor),opacity:1},250,"easeOutExpo"),_this.element.attr("aria-selected","true"),_this.element.tween({opacity:1},250,"easeOutExpo")):(_this.element.tween({color:SanityUtils.stegaClean(_this.parent.data.backgroundColor.contrastColor),opacity:.6},250,"easeOutExpo"),_this.element.attr("aria-selected","false"))}),_this.bind(_this.parent.data,"backgroundColor",function handleBackgroundColor(color){_this.buttonText.css({color:SanityUtils.stegaClean(color.contrastColor)})}),_this.element.click(e=>{_this.parent.state.activeIndex=_this.index}),_this.element.onResize(e=>{0!==e.borderBoxSize[0].inlineSize&&_this.element.css({minWidth:`${e.borderBoxSize[0].inlineSize}px`})}),_this.onResize(()=>{_this.state.isMobile=Stage.width<769}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ProductQualityTab"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ProductShader(_mesh,_shader,_input,_group){const _this=this;if(Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="ProductShader",_this.contexts="Component",_this.mesh=_mesh,_this.shader=_shader,_this.uilInput=_input,_this.uilFolder=_group,_this.uilFolder?.addButton){let a=_this.uilFolder;_this.uilFolder=_this.uilInput,_this.uilInput=a}this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.shader.addUniforms({uEdgeFade:{value:new Vector4},uEdgeFadeDist:{value:.4}}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ProductShader"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ProductVariationsCard(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,Element),Inherit(_this,InView),Inherit(_this,XComponent),_this.fragName="ProductVariationsCard",_this.contexts="ViewStateElement,TextAnimationHelper,Element,InView",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"card-header",_type:"div",refName:"unnamed",children:[{className:"card-title",_type:"div",_innerText:"$data.productTitle",refName:"unnamed",children:[]}]},{imageWithMeta:"$data.productImage",sizes:"(min-width: 769px) 36vw, 100vw",_type:"ResponsiveImage",refName:"unnamed",children:[]},{_type:"ul",refName:"characteristicsContainer",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function determineClipPathValues(){_this.element.div.offsetHeight<=80&&(_this.element.div.style.setProperty("--clip-path-width",_this.element.div.offsetWidth-12+"px"),_this.element.div.style.setProperty("--clip-path-height","12px")),_this.element.div.offsetHeight>80&&(_this.element.div.style.setProperty("--clip-path-width",_this.element.div.offsetWidth-16+"px"),_this.element.div.style.setProperty("--clip-path-height","16px")),_this.element.div.offsetHeight>=120&&(_this.element.div.style.setProperty("--clip-path-width",_this.element.div.offsetWidth-24+"px"),_this.element.div.style.setProperty("--clip-path-height","24px")),_this.element.div.offsetHeight>=160&&(_this.element.div.style.setProperty("--clip-path-width",_this.element.div.offsetWidth-32+"px"),_this.element.div.style.setProperty("--clip-path-height","32px")),_this.element.div.offsetHeight>=225&&(_this.element.div.style.setProperty("--clip-path-width",_this.element.div.offsetWidth-40+"px"),_this.element.div.style.setProperty("--clip-path-height","40px"))}_this.state.isInView=!1,_this.bind(_this.data,"characteristics",characteristics=>{characteristics&&(_this.characteristicsContainer.empty(),characteristics.forEach(characteristic=>{const container=_this.characteristicsContainer.create("characteristic-container","div"),label=container.create("label","p"),value=container.create("value","p");label.text(characteristic.label),value.text(characteristic.value),TextUtils.wrapRedactedText(label.div),TextUtils.wrapRedactedText(value.div)}))}),_this.onMounted=()=>{_this.element.transform({x:"-10%"}).css({opacity:0}),determineClipPathValues()},_this.element.onResize(_=>{determineClipPathValues()}),_this.onInView=()=>{_this.element.tween({x:"0%",opacity:1},750,"easeOutCubic"),_this.state.isInView||([..._this.characteristicsContainer.children()].forEach(view=>{[...view.children].forEach((child,index)=>{if(0===index){let label=new HydraObject(child);label.text(child.innerText),_this.animateText(label,500,!0)}})}),_this.state.isInView=!0)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ProductVariationsCard"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ProductVariationsSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="ProductVariationsSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"h4",_innerText:"$data.title",refName:"title",children:[]},{className:"grid-container",_type:"div",refName:"gridContainer",children:[{view:"ProductVariationsCard",data:"$data.products",_type:"ViewState",refName:"unnamed",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.title.hide(),_this.bind(_this.data,"title",title=>{title?(_this.title.show(),_this.title.text(title)):_this.title.hide()}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ProductVariationsSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ProfileCard(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="ProfileCard",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"person-image",_type:"div",refName:"unnamed",children:[{disableLiveEditOverlay:!0,imageWithMeta:"$data.person.image",sizes:"(min-width: 769px) 28vw, 100vw",_type:"ResponsiveImage",refName:"img",children:[]}]},{className:"person-name",_type:"div",refName:"unnamed",children:[{_type:"h7",refName:"h7",children:[]},{"aria-label":"Open profile modal",role:"button",_type:"button",refName:"button",children:[{id:"plus",_type:"Sprite",refName:"unnamed",children:[]}]}]},{_type:"p",refName:"p",children:[]},{_type:"SideModalView",refName:"sideModalView",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function handleDoubleClick(){_this.sideModalView.open()}_this.bind(_this.data,"person",person=>{_this.h7.text(person.fullName),_this.p.text(person.role),_this.img.setImage(person.image),_this.button.attr("aria-label",`Open ${person.role} ${person.fullName}'s profile.`),_this.createFragment(ProfileModal,{data:_this.data.person},[_this.sideModalView.panel])}),_this.onMounted=()=>{const panelBgColor=window.getComputedStyle(_this.element.div).getPropertyValue("--bgColor");_this.sideModalView.params.panelBgColor=panelBgColor,_this.button.click(_this.sideModalView.open),window.location.hash===`#${_this.data.person?.slug?.current}`&&_this.sideModalView.open(),_this.getSync("CMS/liveModeEnabled")&&_this.button.bind("dblclick",handleDoubleClick)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ProfileCard"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ProfileModal(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,TextAnimationHelper),Inherit(_this,XComponent),_this.fragName="ProfileModal",_this.contexts="Element,TextAnimationHelper",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"profile-header",_type:"div",refName:"unnamed",children:[{imageWithMeta:"$profile.image",sizes:"(min-width: 769px) 36vw, 100vw",_type:"ResponsiveImage",refName:"previewImage",children:[]},{className:"right",_type:"div",refName:"unnamed",children:[{text:"$profile.fullName",_type:"h5",refName:"unnamed",children:[]},{text:"$profile.role",_type:"p",refName:"unnamed",children:[]}]}]},{className:"profile-introduction",text:"$profile.introduction",_type:"h6",refName:"unnamed",children:[]},{class:"profile-bio",content:"$bio",_type:"RichText",refName:"biography",children:[]},{className:"profile-footer",_type:"ul",refName:"panelFooter",children:[{onClick:"$copyProfileUrl","aria-label":"Share Biography",role:"button",_type:"button",refName:"unnamed",children:[{_type:"span",_innerText:"Share Biography",refName:"unnamed",children:[]},{id:"share",_type:"Sprite",refName:"unnamed",children:[]}]},{onClick:"$copyBiography","aria-label":"Copy Biography",role:"button",_type:"button",refName:"unnamed",children:[{_type:"span",_innerText:"Copy biography",refName:"unnamed",children:[]},{id:"copy",_type:"Sprite",refName:"unnamed",children:[]}]},{onClick:"$downloadImage","aria-label":"Download Image",role:"button",_type:"button",refName:"unnamed",children:[{_type:"span",_innerText:"Download Image",refName:"unnamed",children:[]},{id:"download",_type:"Sprite",refName:"unnamed",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function replaceText(object,text){const originalText=object.div.innerText;object.text(text),_this.delayedCall(()=>{object.text(originalText)},2e3)}_this.profile=_this.params.data,_this.bio=_this.profile.bio??"",_this.copyProfileUrl=function(e){const formattedProfileName=_this.profile.fullName.toLowerCase().replace(/\s+/g,"-"),profileUrl=`${window.location.origin}${window.location.pathname}#${formattedProfileName}`;Utils.copyToClipboard(profileUrl),replaceText(e.object.children(!0)[0],"Shareable Link Copied")},_this.copyBiography=function(e){Utils.copyToClipboard(_this.biography.element.div.innerText),replaceText(e.object.children(!0)[0],"Biography Info Copied")},_this.downloadImage=function(e){ImageUtils.download(_this.profile.image.asset.url,_this.profile.fullName),replaceText(e.object.children(!0)[0],"Image Downloaded")},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ProfileModal"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function PullQuote(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="PullQuote",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"p",_innerText:"",refName:"quotationMark",children:[]},{_type:"blockquote",refName:"quote",children:[]},{_type:"h6",refName:"author",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.author.hide(),_this.bind(_this.data,"text",quoteText=>{_this.quote.text(quoteText)}),_this.bind(_this.data,"author",author=>{author?(_this.author.text(author),_this.author.show()):_this.author.hide()}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"PullQuote"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function QrCodeSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="QrCodeSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"left",children:[{_type:"h5",refName:"title",children:[]},{_type:"div",refName:"qrCode",children:[{_type:"p",refName:"qrCodeCta",children:[]},{imageWithMeta:"$data.qrCodeImage",crop:1,_type:"ResponsiveImage",refName:"image",children:[]}]}]},{_type:"div",refName:"right",children:[{imageWithMeta:"$data.thumbnailImage",crop:"16 / 9",_type:"ResponsiveImage",refName:"thumbnail",children:[]}]},{data:"$data.mobileCta",_type:"CtaButton",refName:"mobileCta",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.isMobile=Stage.width<769,_this.onResize(_=>{_this.state.isMobile=Stage.width<769}),_this.bind(_this.data,"backgroundColor",function handleBackgroundColor(backgroundColor){backgroundColor&&_this.element.css({backgroundColor:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)})}),_this.bind(_this.data,"title",function handleTitle(title){title&&_this.title.text(title)}),_this.bind(_this.data,"qrCodeCta",function handleQrCodeCta(cta){cta&&_this.qrCodeCta.text(cta)}),_this.bind(_this.state,"isMobile",function handleIsMobile(isMobile){isMobile?_this.thumbnail.element.css({aspectRatio:"1 / 1"}):_this.thumbnail.element.css({aspectRatio:"16 / 9"})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"QrCodeSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function QuoteCarouselItem(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="QuoteCarouselItem",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"flex-container",_type:"div",refName:"flexContainer",children:[{className:"image-content",_type:"div",refName:"imageContent",children:[{imageWithMeta:"$data.image",sizes:"(min-width: 769px) 20vw, 20vw",_type:"ResponsiveImage",refName:"image",children:[]},{className:"author-tablet",_type:"div",refName:"unnamed",children:[{_type:"h6",_innerText:"$data.author",refName:"unnamed",children:[]},{_type:"p",_innerText:"$data.role",refName:"unnamed",children:[]}]}]},{className:"text-content",_type:"div",refName:"textContent",children:[{className:"quote",_type:"div",refName:"unnamed",children:[{className:"symbol",_type:"div",_innerText:"",refName:"unnamed",children:[]},{_type:"h6",_innerText:"$data.quote",refName:"unnamed",children:[]}]},{className:"author",_type:"div",refName:"unnamed",children:[{_type:"h6",_innerText:"$data.author",refName:"unnamed",children:[]},{_type:"p",_innerText:"$data.role",refName:"unnamed",children:[]}]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.data.image||(_this.imageContent.hide(),_this.flexContainer.classList().add("no-image")),_this.bind(_this.data,"image",function handleImage(image){image?(_this.imageContent.show(),_this.image.params.imageWithMeta=image):(_this.image.hide(),_this.flexContainer.classList().add("no-image"))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"QuoteCarouselItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function QuoteCarouselSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="QuoteCarouselSlice",_this.contexts="ViewStateElement,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"wrapper",children:[{_type:"h5",_innerText:"$data.title",refName:"unnamed",children:[]},{_type:"div",refName:"carousel",children:[{view:"QuoteCarouselItem",data:"$data.items",_type:"ViewState",refName:"slide",children:[]}]},{_type:"div",refName:"controls",children:[{icon:"left-arrow",onClick:function handlePrev(){_this.slider.prev()},_type:"CircleButton",refName:"previousBtn",children:[]},{icon:"arrow-right",onClick:function handleNext(){_this.slider.next()},_type:"CircleButton",refName:"nextBtn",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function setupCarousel(){_this.slider?(_this.slider.width=(_this.slide.views?.[0]?.element?.div?.offsetWidth||0)+25,_this.slider.maxSlides=_this.data?.items?.length||0,Stage.width<769&&addHandlers()):(_this.slider=_this.initClass(Interaction.Slider,_this.carousel,{x:!0},{slides:_this.data?.items?.length||0}),_this.slider.flickable=!0,_this.onResize(_=>{_this.slider.snapPoint=50/Stage.width}),_this.slide.onAddView=async view=>{await _this.wait(_=>view?.element?.div?.offsetWidth),_this.slider.width=view.element.div.offsetWidth+25},_this.slider.events.sub(Interaction.Slider.UPDATE,handleControlsDisplay),Stage.width<769&&addHandlers())}function addHandlers(){_this.rawInput=new Interaction(_this.carousel),_this.events.sub(_this.rawInput,Interaction.DRAG,e=>{Math.abs(_this.rawInput.move.x)>=Math.abs(_this.rawInput.move.y)&&Math.abs(e.x)>40?Global.lenis.stop():Global.lenis.start()})}function handleControlsDisplay({slide:slide}){const isLastSlide=slide>=_this.slider.maxSlides-1,isFirstSlide=slide<=0;_this.nextBtn.element.css({pointerEvents:isLastSlide?"none":"all"}),_this.nextBtn.element.tween({opacity:isLastSlide?0:1},300,"easeOutSine"),_this.previousBtn.element.css({pointerEvents:isFirstSlide?"none":"all"}),_this.previousBtn.element.tween({opacity:isFirstSlide?0:1},300,"easeOutSine")}_this.onMounted=()=>{_this.bind(_this.data,"items",setupCarousel),handleControlsDisplay({slide:0}),_this.wrapper.transform({x:"-10%"}).css({opacity:0})},_this.onInView=()=>{_this.wrapper.tween({x:"0%",opacity:1},300,"easeOutSine")},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"QuoteCarouselSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function QuoteSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="QuoteSlice",_this.contexts="ViewStateElement,TextAnimationHelper,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"blockquote",refName:"quote",children:[]},{_type:"h6",refName:"author",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.scrolled=!1,_this.bind(_this.data,"backgroundColor",backgroundColor=>{backgroundColor&&_this.element.css({background:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)})}),_this.bind(_this.data,"text",text=>{if(text){let finalText=`"${text}"`;_this.quote.text(finalText)}}),_this.bind(_this.data,"author",author=>{if(author){let finalAuthor=` ${author}`;_this.author.text(finalAuthor)}else _this.author.hide()}),_this.onInView=()=>{_this.state.scrolled||(_this.animateText(_this.author,750,!0),_this.state.scrolled=!0)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"QuoteSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function RebootHeaderSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,ScrollUtils),Inherit(_this,XComponent),_this.fragName="RebootHeaderSlice",_this.contexts="ViewStateElement,Element,ScrollUtils",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"top",children:[{_type:"div",refName:"index",children:[{_type:"h4",_innerText:"PT00/",refName:"unnamed",children:[]},{_type:"h4",_innerText:"07",refName:"totalIndex",children:[]}]},{_type:"p",refName:"topCaption",children:[]}]},{_type:"div",refName:"mid",children:[{_type:"p",refName:"beginningText",children:[]},{_type:"p",refName:"endText",children:[]}]},{_type:"div",refName:"bottom",children:[{_type:"h1",refName:"title",children:[]},{_type:"div",refName:"right",children:[{content:"$data.description",_type:"RichText",refName:"description",children:[]},{"aria-label":"Scroll down",_type:"button",refName:"button",children:[{id:"arrow-down",_type:"Sprite",refName:"icon",children:[]}]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.state,"scrollProgress",function handleScrollProgress(progress){if(progress===1/0)return;progress>0&&(_this.set("Global/chapterTitle",_this.data.title),_this.set("Global/chapterIndex",0))}),_this.bind(_this.data,"backgroundColor",backgroundColor=>{backgroundColor&&(_this.element.css({background:SanityUtils.stegaClean(backgroundColor.hex),color:SanityUtils.stegaClean(backgroundColor.contrastColor)}),_this.icon.element.css({color:SanityUtils.stegaClean(backgroundColor.contrastColor)}))}),_this.bind(_this.data,"title",title=>{title&&_this.title.text(title)}),_this.bind(_this.data,"topCaption",topCaption=>{topCaption&&_this.topCaption.text(topCaption)}),_this.bind(_this.data,"beginningText",beginningText=>{beginningText&&_this.beginningText.text(beginningText)}),_this.bind(_this.data,"endText",endText=>{endText&&_this.endText.text(endText)}),_this.button.bind("click",()=>{Global.lenis?.scrollTo(_this.element.div.getBoundingClientRect().bottom+Global.lenis.animatedScroll,{duration:2.5,lerp:.1})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"RebootHeaderSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function RebuildChinaShip(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="RebuildChinaShip",_this.contexts="Element,InView, 0.5",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let mainChart,lines,labels,title,startShip,ships,onInit=_this.onInit;_this.state.scrolled=!1,_this.onInit=async()=>{await _this.element.svg("assets/images/book-charts/rebuild/rebuild-china.svg"),mainChart=_this.element.div.querySelector("#rebuild-china"),lines=mainChart.querySelector("#lines"),labels=mainChart.querySelector("#labels"),title=mainChart.querySelector("#title"),startShip=mainChart.querySelector("#start-ship"),ships=mainChart.querySelector("#ships"),_this.flag("isReady",!0)},_this.onInView=async()=>{await _this.wait("isReady"),!_this.state.scrolled&&_this.getSync("AnimationSwitch/animationEnabled")&&(_this.state.scrolled=!0,function animateIn(){(function animateLines(){[...lines.children].forEach((line,index)=>{let hydraObj=new HydraObject(line);0===index?(hydraObj.css({clipPath:"polygon(0 0, 0 100%, 0% 100%, 0% 0%)",opacity:0}),hydraObj.tween({clipPath:"polygon(0 0, 0 100%, 100% 100%, 100% 0)",opacity:1},250,"easeInCubic")):(hydraObj.css({opacity:0}),hydraObj.tween({opacity:1},75,"easeOutQuad",250+8*index))})})(),function animateLabels(){[...labels.children].forEach((label,index)=>{[...label.children].forEach((child,childIndex)=>{if(child.getAttribute("id").includes("line")){new HydraObject(child).css({clipPath:"polygon(0 100%, 0 100%, 100% 100%, 100% 100%)"})}child.getAttribute("id").includes("text")&&[...child.children].forEach((text,textIndex)=>{new HydraObject(text).css({opacity:0})})}),_this.delayedCall(()=>{[...label.children].forEach((child,childIndex)=>{if(child.getAttribute("id").includes("line")){new HydraObject(child).tween({clipPath:"polygon(0 0, 0 100%, 100% 100%, 100% 0)"},600,"easeInCubic")}child.getAttribute("id").includes("text")&&[...child.children].forEach((text,textIndex)=>{new HydraObject(text).tween({opacity:1},50,"easeOutQuad",800+100*textIndex)})})},800*index)})}(),function animateTitle(){[...title.children].forEach((child,index)=>{let hydraObj=new HydraObject(child);hydraObj.css({opacity:0}),hydraObj.tween({opacity:1},50,"easeOutQuad",100*index)})}(),function animateStartShip(){let hydraObj=new HydraObject(startShip);hydraObj.css({opacity:0}),hydraObj.tween({opacity:1},200,"easeOutQuad",1e3)}(),function animateShips(){[...ships.children].forEach((ship,index)=>{[...ship.children].forEach((child,childIndex)=>{new HydraObject(child).css({opacity:0})}),_this.delayedCall(()=>{[...ship.children].forEach((child,childIndex)=>{let hydraObj=new HydraObject(child);0===childIndex?hydraObj.tween({opacity:1},100,"easeOutQuad"):hydraObj.tween({opacity:1},200,"easeOutQuad",600+25*index+50*childIndex)})},1e3+150*index)})}()}())},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"RebuildChinaShip"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function RebuildHeaderSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,ScrollUtils),Inherit(_this,XComponent),_this.fragName="RebuildHeaderSlice",_this.contexts="ViewStateElement,Element,ScrollUtils",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"top",children:[{_type:"div",refName:"index",children:[{_type:"h4",_innerText:"PT00/",refName:"unnamed",children:[]},{_type:"h4",_innerText:"05",refName:"totalIndex",children:[]}]},{_type:"p",refName:"topCaption",children:[]}]},{_type:"div",refName:"mid",children:[{_type:"h1",refName:"unnamed",children:[{_type:"span",refName:"topTitle",children:[]},{_type:"span",refName:"bottomTitle",children:[]}]}]},{_type:"div",refName:"bottom",children:[{"aria-label":"Scroll down",_type:"button",refName:"button",children:[{id:"arrow-down",_type:"Sprite",refName:"unnamed",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.state,"scrollProgress",function handleScrollProgress(progress){if(progress===1/0)return;progress>0&&(_this.set("Global/chapterTitle",_this.data.title),_this.set("Global/chapterIndex",0))}),_this.bind(_this.data,"topCaption",topCaption=>{topCaption&&_this.topCaption.text(topCaption)}),_this.bind(_this.data,"topTitle",topTitle=>{topTitle&&_this.topTitle.text(topTitle)}),_this.bind(_this.data,"bottomTitle",bottomTitle=>{bottomTitle&&_this.bottomTitle.text(bottomTitle)}),_this.button.bind("click",()=>{Global.lenis?.scrollTo(_this.element.div.getBoundingClientRect().bottom+Global.lenis.animatedScroll,{duration:2.5,lerp:.1})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"RebuildHeaderSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function Responsive(){const _this=this;Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="Responsive",_this.contexts="Component",this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.isMobile=()=>!!parseInt(getComputedStyle(document.documentElement).getPropertyValue("--is-mob")),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"Responsive"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()},"static"),Class(function ResponsiveImage(_params,...restArgs){const _this=this;Inherit(_this,Element,"img"),Inherit(_this,XComponent),_this.fragName="ResponsiveImage",_this.contexts="Element, 'img'",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function setupObserver(){_this.observer||(_this.observer=new IntersectionObserver(entries=>{entries[0].isIntersecting&&!_this.loaded&&_this.pendingSource&&function loadImage(){if(!_this.pendingSource)return;updateImage(),_this.loaded=!0}()},{threshold:0,rootMargin:"250px"}),_this.observer.observe(_this.element.div))}function updateAspectRatio(){const source=_this.pendingSource||_this.params.imageWithMeta||_this.params.imageUrl;if(!source)return;let{aspectRatio:aspectRatio="",width:width=0,height:height=0}=CMS.getImageDimensions(source,_this.params.cropAspect);!_this.params.cropAspect&&aspectRatio?_this.element.css({aspectRatio:aspectRatio}):width&&height&&_this.element.css({aspectRatio:`${width}/${height}`})}function updateImage(){let source=_this.pendingSource||_this.params.imageWithMeta||_this.params.imageUrl;if(!source)return;source&&source.hotspot&&(source.asset.hotspot=source.hotspot);const srcs=CMS.getImageSrcSet(source,_this.params.cropAspect);if(_this.element.attr("srcset",srcs.map(src=>`${src.url} ${src.width}w`).join(",")),_this.element.attr("alt",CMS.getImageAltText(source)),!_this.params.disableLiveEditOverlay){let helpers=source?._visualEditingHelpers;helpers?_this.element.attr("data-sanity",helpers.attr()):_this.element.attr("data-sanity",null)}updateAspectRatio()}function updateSizes(sizes){_this.element.attr("sizes",sizes||"80vw")}_this.observer=null,_this.loaded=!1,_this.pendingSource=null,_this.bind(_this.params,"sizes",updateSizes),_this.bind(_this.params,"imageWithMeta",imageWithMeta=>{_this.pendingSource=imageWithMeta,updateAspectRatio(),setupObserver()}),_this.bind(_this.params,"imageUrl",imageUrl=>{_this.pendingSource=imageUrl,updateAspectRatio(),setupObserver()}),_this.bind(_this.params,"cropAspect",updateImage),_this.element.css({background:"transparent"}),_this.params.sizes||updateSizes(),_this.element.bind("load",_=>{_this.element.classList().add("loaded")}),_this.setImage=imageWithMeta=>{_this.pendingSource=imageWithMeta,updateAspectRatio(),setupObserver()},_this.onDestroy=()=>{_this.observer&&(_this.observer.disconnect(),_this.observer=null)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ResponsiveImage"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ResponsiveMedia(_data,_index,_params){const _this=this;Inherit(_this,Element,"figure"),Inherit(_this,ViewStateElement),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="ResponsiveMedia",_this.contexts="Element, 'figure',ViewStateElement,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function updateSizes(){_this.data.sizes&&_this.mediaElement&&(_this.mediaElement.params.sizes=_this.data.sizes)}_this.bind(_this.data,"asset",function updateCaption(){const caption=CMS.getImageCaption(_this.data);caption&&(_this.caption=_this.createFragment(RichText,AppState.createLocal({el:"figcaption",content:caption})))}),_this.bind(_this.data,"asset",function createMedia(){let asset;switch(function getType(mediaObject){return mediaObject?.asset?.mimeType?.startsWith("video")?"videoWithMeta":"imageWithMeta"}(_this.data)){case"imageWithMeta":{let imageParams=AppState.createLocal({imageWithMeta:_this.data});Object.prototype.hasOwnProperty.call(_this.data,"cropAspect")&&(imageParams.cropAspect=_this.data.cropAspect),Object.prototype.hasOwnProperty.call(_this.data,"useCrop")&&(imageParams.useCrop=_this.data.useCrop),Object.prototype.hasOwnProperty.call(_this.data,"disableLiveEditOverlay")&&(imageParams.disableLiveEditOverlay=_this.data.disableLiveEditOverlay),_this.mediaElement=_this.initClass(ResponsiveImage,imageParams),asset=_this.data.asset;break}case"videoWithMeta":{let videoParams=AppState.createLocal({videoWithMeta:_this.data});Object.prototype.hasOwnProperty.call(_this.data,"autoplay")&&(videoParams.autoplay=_this.data.autoplay),Object.prototype.hasOwnProperty.call(_this.data,"loop")&&(videoParams.loop=_this.data.loop),Object.prototype.hasOwnProperty.call(_this.data,"cropAspect")&&(videoParams.cropAspect=_this.data.cropAspect),Object.prototype.hasOwnProperty.call(_this.data,"disableLiveEditOverlay")&&(videoParams.disableLiveEditOverlay=_this.data.disableLiveEditOverlay),_this.mediaElement=_this.initClass(ResponsiveVideo,videoParams),asset=_this.data.thumbnail?.asset;break}}updateSizes();let aspectRatio=asset?.metadata?.dimensions?.aspectRatio;aspectRatio&&(_this.element.attr("data-aspect-ratio",aspectRatio),Math.abs(aspectRatio-1)<.01?_this.element.classList().add("square"):aspectRatio>1?_this.element.classList().add("landscape"):aspectRatio<1&&_this.element.classList().add("portrait"))}),_this.bind(_this.data,"sizes",updateSizes),_this.state.hasScrolled=!1,_this.onMounted=()=>{_this.element.transform({x:"-100"}).css({opacity:0}),_this.element.div.getBoundingClientRect().top<window.innerHeight&&(_this.state.hasScrolled=!0,_this.element.tween({x:0,opacity:1},1e3,"easeOutExpo"))},_this.onInView=()=>{_this.state.hasScrolled||(_this.state.hasScrolled=!0,_this.element.transform({x:"-100"}).css({opacity:0}),_this.element.tween({x:0,opacity:1},1e3,"easeOutExpo"))},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ResponsiveMedia"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ResponsiveVideo(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="ResponsiveVideo",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.params,"videoWithMeta",async videoWithMeta=>{let{alt:alt,asset:asset}=videoWithMeta;if(_this.video&&(_this.observer&&_this.video.element&&_this.video.element.div&&_this.observer.unobserve(_this.video.element.div),_this.video.element.remove(),_this.video.destroy()),asset?.optimized?.[0]?.asset&&(asset=asset.optimized[0].asset),!asset)return;_this.observer||(_this.observer=new IntersectionObserver(entries=>{if(!_this.video||_this.video.controls)return;entries[0].isIntersecting?(_this.flag("shouldPlay",!0),_this.video.play()):(_this.flag("shouldPlay",!1),_this.video.pause())},{threshold:0}));let videoParams={loop:_this.params.loop??!0,autoplay:(_this.params.autoplay&&_this.params.muted)??!0,muted:_this.params.muted??!1,preload:!1,controls:_this.params.controls,src:asset.url,events:["play","pause","ended"]};if(asset.width&&(videoParams.width=asset.width,videoParams.height=asset.height),asset.thumbnail&&(videoParams.poster=CMS.imageUrlBuilder(asset.thumbnail).width(Math.min(320*Math.ceil(Stage.width/320),asset.width||CMS.getImageDimensions(asset.thumbnail)?.width||1920)).url()),_this.video=_this.initClass(Video,videoParams),!_this.params.disableLiveEditOverlay){let helpers=videoWithMeta?._visualEditingHelpers;helpers&&_this.video.element.attr("data-sanity",helpers.attr())}asset.width&&_this.video.element.css({aspectRatio:asset.width/asset.height}),await _this.video.ready(),_this.video.element?.text?.(alt),_this.observer&&_this.video.element?.div&&!_this.params.noObserver&&_this.observer.observe(_this.video.element.div)}),_this.bind("VideoPlayerModal/isOpen",isOpen=>{_this.flag("shouldPlay")&&(isOpen?_this.video.pause():_this.video.play())}),_this.bind(_this.params,"controls",controls=>{_this.video&&(_this.video.controls=controls,_this.observer&&_this.video.element&&_this.video.element.div&&(controls?_this.observer.unobserve(_this.video.element.div):_this.params.noObserver||_this.observer.observe(_this.video.element.div)),_this.flag("shouldPlay",!1))}),_this.bind(_this.params,"autoplay",autoplay=>{_this.video&&(_this.video.muted=autoplay,_this.video.autoplay=autoplay)}),_this.bind(_this.params,"loop",loop=>{_this.video&&(_this.video.loop=loop)}),_this.bind(_this.params,"cropAspect",cropAspect=>{_this.video&&(_this.element.css({aspectRatio:cropAspect}),_this.video.element.css({aspectRatio:cropAspect}))}),_this.onDestroy=()=>{_this.observer&&(_this.observer.disconnect(),_this.observer=null)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ResponsiveVideo"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function RichText(_params,...restArgs){const _this=this;Inherit(_this,Element,_params.el),Inherit(_this,XComponent),_this.fragName="RichText",_this.contexts="Element, _params.el",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function updateClass(className){_this.element.classList().add(className)}_this.params.bind("class",updateClass),_this.params.bind("className",updateClass),_this.params.bind("content",function updateContent(blocks){PortableText.render(blocks,_this),TextUtils.wrapRedactedText(_this.element)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"RichText"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function RichTextImage(_params,...restArgs){const _this=this;Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="RichTextImage",_this.contexts="Component",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.media=_this.createFragment(ResponsiveMedia,AppState.createLocal(_this.params.image),0,_this.params),_this.element=_this.media.element,_this.element.classList().add("RichTextImage"),_this.bind(_this.params,"style",function updateStyle(){"left"===_this.params.style?_this.media.element.css({marginLeft:"0"}):"right"===_this.params.style?_this.media.element.css({marginRight:"0"}):_this.media.element.css({marginLeft:"auto",marginRight:"auto"})}),_this.bind(_this.params,"imageWidth",function updateImageWidth(width,prevWidth){prevWidth&&_this.media.element.classList().remove(`width-${prevWidth}`);_this.media.element.classList().add(`width-${width}`)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"RichTextImage"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function RollerCounter(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="RollerCounter",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"roller-counter",_type:"div",refName:"counter",children:[{className:"roller-counter__test",_type:"div",refName:"test",children:[]},{className:"roller-counter__inner",_type:"div",refName:"inner",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;async function animateTo(value,duration,easing,delay){if(value===_this.currentValue&&duration>0)return value;_this.currentValue=value,_this.fire("valueChanged",_this.currentValue);const digits=String(Math.abs(value)).padStart(_this.params.columns,"0").split("").map(Number),effectiveColumns=Math.min(digits.length,_this.params.columns),offset=_this.params.columns-effectiveColumns;if(digits.forEach((digit,i)=>{if(i<effectiveColumns){const testIndex=i+offset;_this.testDigits[testIndex].text(digit)}}),await defer(),"sequential"===_this.params.rollingMode);else{const animations=[];for(let i=0;i<_this.params.columns;i++){const column=_this.columns[i];if(i>=offset){const digitIndex=i-offset;if(digitIndex<digits.length){const targetDigit=digits[digitIndex],targetIndices=[];for(let j=0;j<column.pool.length;j++)column.pool[j]===targetDigit&&targetIndices.push(j);let targetIndex=-1,shortestDistance=1/0;for(const idx of targetIndices){const forwardDistance=idx>=column.currentIndex?idx-column.currentIndex:column.pool.length-column.currentIndex+idx,backwardDistance=idx<=column.currentIndex?column.currentIndex-idx:column.currentIndex+(column.pool.length-idx);let minDistance;minDistance="up"===_this.params.direction?backwardDistance<=1.2*forwardDistance?backwardDistance:forwardDistance:forwardDistance<=1.2*backwardDistance?forwardDistance:backwardDistance,minDistance<shortestDistance&&(shortestDistance=minDistance,targetIndex=idx)}if(-1!==targetIndex){const y=`-${100*targetIndex}%`;duration>0?animations.push(column.element.tween({y:y},duration,easing,delay)):column.element.div.style.transform=`translateY(${y})`,column.currentIndex=targetIndex}}}}animations.length>0&&await Promise.all(animations)}return _this.currentValue}_this.columns=[],_this.testDigits=[],_this.currentValue=_this.params?.start||0,_this.ready=Promise.create(),_this.params||(_this.params={}),_this.params.columns=_this.params?.columns||3,_this.params.duration=_this.params?.duration||1e3,_this.params.easing=_this.params?.easing||"easeOutSine",_this.params.delay=_this.params?.delay||0,_this.params.start="number"==typeof _this.params?.start?_this.params?.start:0,_this.params.digitsInView=_this.params?.digitsInView||1,_this.params.scale=_this.params?.scale||0,_this.params.direction=_this.params?.direction||"down",_this.params.rollingMode=_this.params?.rollingMode||"simultaneous",_this.onMounted=async()=>{_this.params.scale&&_this.element.div.style.setProperty("--roller-scale",_this.params.scale);for(let i=0;i<_this.params.columns;i++){const testDigit=new HydraObject("roller-counter__test-digit","div");testDigit.text("0"),testDigit.div.dataset.index=i,_this.test.add(testDigit),_this.testDigits.push(testDigit)}for(let i=0;i<_this.params.columns;i++){const column=new HydraObject("roller-counter__column","div");column.div.dataset.index=i,_this.inner.add(column);const digitPool=[];for(let j=0;j<_this.params.digitsInView;j++)if("up"===_this.params.direction){for(let k=0;k<=9;k++){const digit=new HydraObject("roller-counter__digit","div");digit.text(k),column.add(digit),digitPool.push(k)}for(let k=0;k<=9;k++){const digit=new HydraObject("roller-counter__digit","div");digit.text(k),column.add(digit),digitPool.push(k)}}else{for(let k=9;k>=0;k--){const digit=new HydraObject("roller-counter__digit","div");digit.text(k),column.add(digit),digitPool.push(k)}for(let k=9;k>=0;k--){const digit=new HydraObject("roller-counter__digit","div");digit.text(k),column.add(digit),digitPool.push(k)}}_this.columns.push({element:column,pool:digitPool,currentIndex:0,testDigit:_this.testDigits[i]})}await animateTo(_this.params.start,0),_this.ready.resolve()},_this.animateTo=(value,duration=1e3,easing="easeOutExpo",delay=0)=>animateTo(value,duration,easing,delay),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"RollerCounter"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SVGChart(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="SVGChart",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;const paths=[],circles=[],rects=[];function initComponent(selector){return[..._this.element.div.querySelectorAll(selector)].map(item=>new HydraObject(item))}function initStyling(){paths.map(path=>path.css({opacity:0})),circles.map(circle=>circle.css({opacity:0})),rects.map(rect=>rect.css({opacity:0}))}function animateIn(){paths.map((path,index)=>path.tween({opacity:1},200,"easeOutCubic",30*index)),circles.map((circle,index)=>circle.tween({opacity:1},200,"easeOutCubic",10*index)),rects.map((rect,index)=>rect.tween({opacity:1},200,"easeOutCubic",40*index))}_this.onInit=async _=>{await function loadChart(){return _this.element.svg("assets/images/chart.svg")}(),function initComponents(){paths.push(...initComponent("path")),circles.push(...initComponent("circle")),rects.push(...initComponent("rect"))}(),initStyling(),function addHandlers(){_this.events.sub(Keyboard.UP,({code:code})=>{"Space"===code&&(initStyling(),animateIn())})}(),animateIn()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SVGChart"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ScrollUtils(_params,...restArgs){const _this=this;Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="ScrollUtils",_this.contexts="Component",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit,scrollProgress=0;function handleScroll(lenis){if(!lenis)return;if(lenis.isStopped)return;let rect=_this.element.div.getBoundingClientRect(),scrollableDistance=rect.height,scrolled=window.innerHeight-rect.top;scrollProgress=scrolled/scrollableDistance,scrollProgress=Math.range(scrollProgress,0,1,-.5,.5),_this.state.scrollProgress=scrollProgress}Global.lenis.on("scroll",handleScroll),_this._bindOnDestroy(()=>{Global.lenis.off("scroll",handleScroll)}),_this.handleScroll=handleScroll,onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ScrollUtils"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SearchDomainResult(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Link),Inherit(_this,XComponent),_this.fragName="SearchDomainResult",_this.contexts="ViewStateElement,Link",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"h6",_innerText:"$data.title",refName:"title",children:[]},{_type:"p",_innerText:"$data.category",refName:"label",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"title",title=>{_this.title.text(title),defer(_=>{_this.title&&BalanceText.relayout(_this.title.div,.5,!1)})}),_this.bind(_this.data,"path",path=>{if(path){let linkData={_type:"internalLink",path:path=path.split("/").slice(1).join("/"),text:"Read more"};_this.setupLink(linkData,!1)}}),_this.animate=()=>{},_this.element.click(e=>{_this.fire("linkClick")}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SearchDomainResult"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SearchDomainWrapper(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="SearchDomainWrapper",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"search-wrapper",_type:"div",refName:"unnamed",children:[{_type:"input",refName:"searchbar",children:[]},{id:"search",_type:"Sprite",refName:"unnamed",children:[]}]},{_type:"div",refName:"resultsContainer",children:[{className:"results-wrapper",_type:"div",refName:"resultsWrapper",children:[{view:"SearchDomainResult",data:"$data",_type:"ViewState",refName:"results",children:[]},{_type:"p",_innerText:"No results found",refName:"noResults",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.data=new StateArray,_this.noResults.hide(),_this.searchbar.attr("placeholder","SEARCH ANDURIL"),_this.searchbar.bind("input",_=>{!function updateInput(){_this.state.search=_this.searchbar.val()?.trim()||""}()}),_this.state.height=0,_this.state.search="",_this.bind(_this.state,"search",search=>{!async function getSearchResults(search){if(""===search)return _this.noResults.hide(),void _this.data.refresh([]);let result=await _this.requestData("search",{query:search});const MAX_RESULTS_SHOWN=6;let resultsList=[];for(let i=0;i<MAX_RESULTS_SHOWN&&result.hits[i];i++)resultsList.push(result.hits[i]);0===resultsList.length?_this.noResults.show():_this.noResults.hide();_this.data.refresh(resultsList)}(search)}),_this.focus=_=>{_this.searchbar.div.focus(),_this.searchbar.div.select()},_this.showAria=_=>{_this.element.attr("aria-hidden","false"),_this.searchbar.attr("aria-hidden","false"),_this.searchbar.attr("tabindex","0"),_this.results?.views?.forEach(view=>{view.element.attr("aria-hidden","false"),view.element.attr("tabindex","0")})},_this.hideAria=_=>{_this.element.attr("aria-hidden","true"),_this.searchbar.attr("aria-hidden","true"),_this.searchbar.attr("tabindex","-1"),_this.results?.views?.forEach(view=>{view.element.attr("aria-hidden","true"),view.element.attr("tabindex","-1")})},_this.onMounted=async _=>{await _this.wait("results"),await _this.wait(_=>_this.element.div.offsetHeight>0),_this.state.height=_this.element.div.offsetHeight,function initSearchResultsLenis(){const lenisOptions={wrapper:_this.resultsContainer.div,content:_this.resultsWrapper.div,duration:.8,easing:TweenManager.Interpolation.Quart.Out,direction:"vertical",gestureDirection:"vertical",smooth:!0,smoothTouch:!1,touchMultiplier:2,lerp:!1};_this.state.searchResultsLenis=new Lenis(lenisOptions),_this.startRender(_=>{_this.state.searchResultsLenis&&_this.state.searchResultsLenis.raf(_)})}()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SearchDomainWrapper"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SecondaryNavigationSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="SecondaryNavigationSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"nav",refName:"nav",children:[]},{_type:"div",refName:"current",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit,selectedNavLink=null,slicesData=null,sliceIndex=0,navLinks=null,nearestSlice=null;async function onScroll(e){if(!slicesData)return;let minDistance=1/0;const slicePromises=slicesData.map(async slice=>{if("subdomainMediaSlice"===slice.content._type){await _this.wait(_=>slice?.hydraObject?.div?.offsetTop);const slicePosition=slice.hydraObject.div.offsetTop,distance=Math.abs(e.animatedScroll-slicePosition);distance<minDistance&&(minDistance=distance,nearestSlice=slice)}});await Promise.all(slicePromises),nearestSlice&&selectedNavLink!==navLinks[nearestSlice.index]&&(selectedNavLink?.classList.remove("selected"),selectedNavLink=navLinks[nearestSlice.index],selectedNavLink?.classList.add("selected"),_this.current.text(nearestSlice.content.title))}_this.state.isMobile=Stage.width<768,_this.state.isMobileNavActive=!1,_this.bind("PageView/slicesData",data=>{let subdomainMediaSlicesCount=0;slicesData=data,_this.nav.empty(),slicesData.forEach(slice=>{if("subdomainMediaSlice"===slice.content._type){subdomainMediaSlicesCount++;_this.nav.create("navLink","div").text(slice.content.title).attr("data-text",slice.content.title).click(async()=>{await _this.wait(_=>slice?.hydraObject?.div?.offsetTop),Global.lenis?.scrollTo(slice.hydraObject.div.offsetTop,{duration:2.5,lerp:.1})}),slice.index=sliceIndex,sliceIndex++}}),0!==subdomainMediaSlicesCount?(_this.element.show(),navLinks=_this.nav.children(),defer(_=>onScroll({animatedScroll:0}))):_this.element.hide()}),_this.onMounted=_=>{_this.onResize(_=>_this.state.isMobile=Stage.width<768),_this.current.click(_=>_this.state.isMobileNavActive=!_this.state.isMobileNavActive),_this.bind(_this.state,"isMobileNavActive",isActive=>{_this.state.isMobile&&_this.nav.css({display:isActive?"flex":" none"})}),Global.lenis?.on("scroll",onScroll)},_this._bindOnDestroy(()=>{Global.lenis?.off("scroll",onScroll)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SecondaryNavigationSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SideModalView(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="SideModalView",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"filter",click:"$close",_type:"div",refName:"filter",children:[]},{className:"panel","data-lenis-prevent":!0,_type:"div",refName:"panel",children:[{"aria-label":"Close profile modal",className:"panel-close",click:"$close",role:"button",_type:"button",refName:"button",children:[{id:"close",_type:"Sprite",refName:"unnamed",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;const filter={blur:0};function onPanelMove(){_this.panelInteraction.move.x>80&&_this.close()}_this.onMounted=function(){_this.panel.css({backgroundColor:_this.params.panelBgColor||"grey"}),_this.panelInteraction=_this.initClass(Interaction,_this.element),_this.events.sub(_this.panelInteraction,Interaction.MOVE,onPanelMove),Stage.add(_this.element)},_this.open=function(){_this.set("Global/lenisStopped",!0),_this.element.css({display:"block"}),tween(filter,{blur:30},250,"easeInOutQuad").onUpdate(_=>{_this.element.css({backdropFilter:`blur(${filter.blur}px)`})}).onComplete(_=>{_this.button.div.focus()}),_this.filter.tween({opacity:.7},250,"easeInOutQuad"),_this.panel.tween({x:0},250,"easeInOutQuad")},_this.close=function(){_this.set("Global/lenisStopped",!1),_this.filter.tween({opacity:0},250,"easeInOutQuad"),tween(filter,{blur:0},250,"easeInOutQuad").onUpdate(_=>{_this.element.css({backdropFilter:`blur(${filter.blur}px)`})}).onComplete(_=>{_this.element.css({display:"none"}),_this.parent?.button?.div.focus()}),_this.panel.tween({x:"100%"},250,"easeInOutQuad")},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SideModalView"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SingleSelect(_params,...restArgs){const _this=this;Inherit(_this,Component),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="SingleSelect",_this.contexts="Component,Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"ul",refName:"optionsList",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.optionsList.bind("input",function handleOptionChange(e){let selectedValue=_this.optionsList.div.querySelector("input:checked")?.value;_this.state.selectedValue=selectedValue}),_this.bind(_this.state,"selectedValue",async function updateSelectedValue(selectedValue){await defer(),[..._this.optionsList.children()].forEach(option=>{let label=option,radioButton=label.querySelector("input");radioButton.value===selectedValue?(label.classList.add("checked"),radioButton.checked=!0):(label.classList.remove("checked"),radioButton.checked=!1)})}),_this.onInit=()=>{!function renderOption(){_this.params.options.forEach(option=>{let optionLabel=_this.optionsList.create("select-option","li").create("option-label","label"),optionInput=(optionLabel.create("circle","div"),optionLabel.create("input","input")),optionText=optionLabel.create("span","span");optionInput.div.type="radio",optionInput.div.name=_this.params.label,optionInput.div.value=option.id?option.id.current:option.value.toLowerCase(),optionText.text(option.label)})}()},_this.getValue=()=>_this.state.selectedValue,onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SingleSelect"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SlicePlaceholder(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="SlicePlaceholder",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SlicePlaceholder"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SlicesView(_params,...restArgs){const _this=this;Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="SlicesView",_this.contexts="Component",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.ready=()=>_this.wait("isReady"),_this.determineView=data=>{switch(data._type){case"announcementList":return AnnouncementList;case"announcementSlice":return AnnouncementSlice;case"homeHero":return HomeHero;case"pageHero":return PageHero;case"careerHero":return CareerHero;case"openRolesHero":return OpenRolesHero;case"oneColumnRichText":return OneColumnRichText;case"twoColumnRichText":return TwoColumnRichText;case"threeColumnRichText":return ThreeColumnRichText;case"fourColumnRichText":return FourColumnRichText;case"mediaLinkSlice":return MediaLinkSlice;case"linkCarousel":return LinkCarousel;case"featuredProducts":case"productLinksSlice":return FeaturedProducts;case"featureSlice":return FeatureSlice;case"highlightedSlice":return HighlightedSlice;case"headlineSlice":return HeadlineSlice;case"horizontalRule":return HorizontalRule;case"productHeaderSlice":return ProductHeaderSlice;case"productCarouselSlice":return ProductCarouselSlice;case"productExploreSlice":return ProductExploreSlice;case"productQualitiesSlice":return ProductQualitiesSlice;case"product3dSlice":return Product3DSlice;case"productApplicationSlice":return ProductApplicationSlice;case"imageHeaderSlice":return ImageHeaderSlice;case"textContentSlice":return TextContentSlice;case"accordionSlice":return AccordionSlice;case"keyFeatureAccordion":return KeyFeatureAccordion;case"openRolesSlice":return OpenRolesSlice;case"locationsSlice":return LocationsSlice;case"mediaRessourceSlice":return MediaRessourceSlice;case"mediaAccordionSlice":return MediaAccordionSlice;case"imageColumnSlice":return ImageColumnSlice;case"peopleSlice":return PeopleSlice;case"newsroomHeader":return NewsroomHeader;case"newsFeaturedSlice":return NewsFeaturedSlice;case"newsHeaderSlice":return NewsHeaderSlice;case"newsListSlice":return NewsListSlice;case"numberCallOutSlice":return NumberCallOutSlice;case"newsArticleContent":return NewsArticleContent;case"pullQuote":return PullQuote;case"quoteSlice":return QuoteSlice;case"privacySlice":return PrivacySlice;case"subdomainHeaderSlice":return SubdomainHeaderSlice;case"subdomainMediaSlice":return SubdomainMediaSlice;case"subterraneanHeaderSlice":return SubterraneanHeaderSlice;case"latticeMediaSlice":return LatticeMediaSlice;case"latticeCharacteristicsSlice":return LatticeCharacteristicsSlice;case"latticeFeaturesSlices":return LatticeFeaturesSlice;case"quoteCarouselSlice":return QuoteCarouselSlice;case"latticeMissionSlice":return LatticeMissionSlice;case"latticeHeaderSlice":return LatticeHeaderSlice;case"modalFormSlice":return ModalFormSlice;case"formSlice":return FormSlice;case"productVariationsSlice":return ProductVariationsSlice;case"fourOhFourSlice":return FourOhFourSlice;case"spacerSlice":return SpacerSlice;case"connectedHeaderSlice":return ConnectedHeaderSlice;case"qrCodeSlice":return QrCodeSlice;case"rebootHeaderSlice":return RebootHeaderSlice;case"rebuildHeaderSlice":return RebuildHeaderSlice;case"chapterHeaderOne":return ChapterHeaderOne;case"chapterHeaderTwo":return ChapterHeaderTwo;case"chapterHeaderThree":return ChapterHeaderThree;case"nextLinkSlice":return NextLinkSlice;case"spiralGraphSlice":return SpiralGraph;case"flagHeader":return FlagHeader;default:return console.error(`Unknown slice type ${data._type}`,data.toJSON()),SlicePlaceholder}},_this.bind(_this.params.content,"slices",slices=>{_this.slices&&0!==slices.length?_this.slices.stateArray!==slices&&(_this.slices.stateArray.refresh([]),_this.slices.setSourceData(slices)):_this.flag("isReady",!0)}),_this.onAddView=async view=>{view.element&&(view.data.slug?.current&&(view.element.div.id=view.data.slug.current),view.element.div.setAttribute("data-slice-type",view.data._type)),_this.slices||await _this.wait("slices"),view?.loadingPromise&&await view.loadingPromise,_this.flag("isReady",_this.slices.views.length===(_this.params.content?_this.params.content.slices.length:_this.params.slices.length))},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SlicesView"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SolidBackgroundShader(_mesh,_shader,_input,_group){const _this=this;if(Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="SolidBackgroundShader",_this.contexts="Component",_this.mesh=_mesh,_this.shader=_shader,_this.uilInput=_input,_this.uilFolder=_group,_this.uilFolder?.addButton){let a=_this.uilFolder;_this.uilFolder=_this.uilInput,_this.uilInput=a}this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.shader.addUniforms({uColor:{value:new Color},depthWrite:!1,depthTest:!1}),_this.startRender(_=>{_this.mesh.renderOrder=-9999,_this.mesh.frustumCulled=!1}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SolidBackgroundShader"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SpacerSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView),Inherit(_this,XComponent),_this.fragName="SpacerSlice",_this.contexts="ViewStateElement,Element,InView",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"border",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.border.hide(),_this.bind(_this.data,"backgroundColor",color=>{_this.element.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)}),_this.border.css({background:SanityUtils.stegaClean(color.contrastColor)})}),_this.bind(_this.data,"spacerHeight",spacerHeight=>{_this.element.classList().add(`h-${SanityUtils.stegaClean(spacerHeight)}`)}),_this.bind(_this.data,"horizontalRule",horizontalRule=>{horizontalRule?_this.border.show():_this.border.hide()}),_this.onMounted=()=>{_this.border.transform({scaleX:0})},_this.onInView=()=>{_this.border.tween({scaleX:1},2e3,"easeOutExpo")},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SpacerSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SpiralGraph(_params,...restArgs){const _this=this;Inherit(_this,FXSceneSlice,{sceneLayoutName:"SpiralGraph",timelineName:"SpiralGraph",attemptAllMobile:!0}),Inherit(_this,XComponent),_this.fragName="SpiralGraph",_this.contexts="FXSceneSlice, { sceneLayoutName: 'SpiralGraph', timelineName: 'SpiralGraph', attemptAllMobile: true }",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.layers?.camera&&_this.useCamera(_this.layers.camera),_this.wrapper=_this.element.create("wrapper"),_this.wrapper.svg("assets/images/book-charts/reboot/spiral-chart.svg"),_this.element.attr("aria-label","Illustrative timeline of military technological development beginning in 1928 and ending in 2020. Aircraft Carriers, Nuclear Arms, Precision Arms, Strategic Airlift, Stealth, GPS, and Unmanned Vehicles are shown radiating from the timeline in that order."),_this.element.attr("tabindex","0"),_this.element.attr("role","img"),_this.requiresFallback?(_this.element.css({height:"auto",width:"100%"}).bg("#ffffff"),_this.wrapper.show()):(_this.initTimeline(),_this.bind("AnimationSwitch/animationEnabled",animationEnabled=>{animationEnabled?(_this.flag("preventVisible",!1),_this.element.css({height:"400vh",width:"100%"}).bg("transparent"),_this.wrapper.hide(),_this.show()):(_this.flag("preventVisible",!0),_this.element.css({height:"auto",width:"100%"}).bg("#ffffff"),_this.wrapper.show(),_this.hide())})),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SpiralGraph"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SpiralGraphChart(_params,...restArgs){const _this=this;Inherit(_this,Object3D),Inherit(_this,XComponent),_this.fragName="SpiralGraphChart",_this.contexts="Object3D",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit,wrapper=new Group;_this.group.add(wrapper),_this.onInit=_=>{_this.group.frustumCulled=!1,function createParticles(){_this.particles=_this.initClass(SpiralGraphParticles),wrapper.add(_this.particles.group)}(),function createLines(){_this.lines=_this.initClass(SpiralGraphLines),_this.group.add(_this.lines.group)}(),function createIcons(){_this.icons=_this.initClass(SpiralGraphIcons),_this.group.add(_this.icons.group)}(),_this.startRender(_=>{if(!_this.parent.parent.timeline||isNaN(_this.parent.parent.timeline.progress))return;let progress=Math.max(0,Math.min(1,3*_this.parent.parent.timeline.progress/_this.parent.parent.timeline.duration));_this.particles.shader.set("uProgress",progress),_this.lines.progress(.925*progress),_this.icons.progress(.925*progress)})},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SpiralGraphChart"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SpiralGraphIcons(_params,...restArgs){const _this=this;Inherit(_this,Object3D),Inherit(_this,XComponent),_this.fragName="SpiralGraphIcons",_this.contexts="Object3D",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;const ICONS=[],LABELS=[];_this.onInit=_=>{_this.group.frustumCulled=!1,function createIcons(){let video=_this.initClass(VideoTexture,"assets/video/timeline-grid-scaled.mp4",{muted:!0,autoplay:!0,preload:!0});_this.video=video;let parent=_this.findParent("SpiralGraph");parent&&parent.element.add(_this.video.video);let geo=World.PLANE,shader=_this.initClass(Shader,"SpiralGraphIcon",{uMainTexture:{value:video},uMainTextureGridSize:{value:new Vector2(3,3)},uSymbolTexture:{value:Utils3D.getTexture("assets/images/textures/spiral-graph/symbols-2.png")},uSymbolCount:{value:4},uGridSize:{value:(new Vector2).setScalar(45)},uSymbolColor:{value:new Color("#000000")},transparent:!0,side:Shader.DOUBLE_SIDE});const CELL_BY_INDEX=[[0,0,"Aircraft Carrier"],[2,0,"Nuclear Arms"],[0,1,"Precision Arms"],[2,1,"Strategic Airlift"],[1,1,"Stealth"],[1,0,"GPS"],[0,2,"Unmanned Vehicles"]];let batch=new MeshBatch;for(;ICONS.length<7;){let mesh=new Mesh(geo,shader),cellCoord=new Vector2(-1,1);cellCoord.x+=CELL_BY_INDEX[ICONS.length][0],cellCoord.y-=CELL_BY_INDEX[ICONS.length][1],mesh.attributes={progress:0,cellCoord:cellCoord},mesh.scale.setScalar(.66),mesh.position.y=.71*ICONS.length,mesh.position.z=.5;let size=Device.mobile.phone?.045:.035,label=_this.glText(CELL_BY_INDEX[ICONS.length][2],"HelveticaNowDisplay-Regular",size,{color:"#000000",align:"center"});_this.add(label),label.y=-mesh.position.y,label.z=.66,label.x=0,LABELS.push(label),_this.startRender(_=>{Utils3D.billboard(label.group)}),mesh.label=label,ICONS.push(mesh),batch.add(mesh),_this.startRender(_=>{Utils3D.billboard(mesh),mesh.rotation.x-=_this.parent.group.rotation.x,mesh.rotation.y-=_this.parent.group.rotation.y,mesh.rotation.z+=.375*_this.parent.group.rotation.z})}_this.group.add(batch.group)}()},_this.progress=progress=>{for(let i=0;i<ICONS.length;i+=1){let distance=Math.abs(i/ICONS.length-progress);ICONS[i].attributes.progress=Math.range(distance,.075,.1,1,0,!0),ICONS[i].label.alpha=Math.range(distance,.075,.1,1,0,!0)}},_this.onVisible=_=>{_this.video.start()},_this.onInvisible=_=>{_this.video.stop()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SpiralGraphIcons"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SpiralGraphLines(_params,...restArgs){const _this=this;Inherit(_this,Object3D),Inherit(_this,XComponent),_this.fragName="SpiralGraphLines",_this.contexts="Object3D",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;const SPOKES=[];function createReticle(){let p1=new Vector3,p2=new Vector3,p3=new Vector3,group=new Group;return group.lines=[],[{x:-1,y:1},{x:1,y:1},{x:-1,y:-1},{x:1,y:-1}].map(point=>{let line=new Line3D({width:2,color:"#000000",opacity:1});p1.set(.04*point.x,.04*point.y-.02*point.y,0),p2.set(.04*point.x,.04*point.y,0),p3.set(.04*point.x-.02*point.x,.04*point.y,0),line.draw(p1),line.draw(p2),line.draw(p3),group.add(line.mesh),group.lines.push(line)}),_this.startRender(_=>{Utils3D.billboard(group)}),group}_this.onInit=_=>{!function createLines(){(function createCenterLine(){const line=new Line3D({width:5,color:"#B0B0A9",opacity:1});_this.add(line);const startPoint=new Vector3(0,0,0),endPoint=new Vector3(0,5,0);_this.group.frustumCulled=!1,line.draw(startPoint),line.draw(endPoint)})(),function createRadiatingLines(){for(let i=0;i<5;i+=.72){const line=new Line3D({width:3,color:"#DFF140",opacity:.001});_this.add(line),SPOKES.push(line);Math.range(i,1,5,.23,.72);line.reticle=createReticle(),line.reticle.position.y=i,_this.add(line.reticle);const startPoint=new Vector3(0,i,0),endPoint=new Vector3(0,i,.33);line.draw(startPoint),line.draw(endPoint)}}(),function createDateLines(){for(let i=.5;i<6;i+=1.5){const scale=.035;let date=Math.floor(Math.range(i,0,5,1920,2020)),text=_this.glText(`${date}`,"HelveticaNowDisplay-Regular",.035,{color:"#B0B0A9",align:"center"});_this.add(text),text.y=-i,text.z=-.125,_this.startRender(_=>{Utils3D.billboard(text.group)}),["x","z"].map(axis=>{const line=new Line3D({width:5,color:"#B0B0A9",opacity:1});_this.add(line);const startPoint=new Vector3(0,i,0),endPoint=new Vector3(0,i,0);startPoint[axis]=scale,endPoint[axis]=-scale,line.draw(startPoint),line.draw(endPoint)})}}()}()},_this.progress=progress=>{for(let i=0;i<SPOKES.length;i+=1){let distance=Math.abs(i/SPOKES.length-progress),opacity=Math.range(distance,.075,.1,1,0,!0);SPOKES[i].opacity=opacity,SPOKES[i].reticle.scale.setScalar(Math.range(opacity,0,.8,0,1,!0)),SPOKES[i].reticle.lines.map(line=>{line.opacity=opacity})}},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SpiralGraphLines"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SpiralGraphParticles(_params,...restArgs){const _this=this;Inherit(_this,Object3D),Inherit(_this,XComponent),_this.fragName="SpiralGraphParticles",_this.contexts="Object3D",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function calculateSpiralLength(config){let length=0;for(let i=0;i<2e3;i++){const t2=(i+1)/2e3,pos1=getPositionAtParameter(i/2e3,config),pos2=getPositionAtParameter(t2,config),dx=pos2.x-pos1.x,dy=pos2.y-pos1.y,dz=pos2.z-pos1.z;length+=Math.sqrt(dx*dx+dy*dy+dz*dz)}return length}function getPositionAtDistance(distance,config){let t=distance/calculateSpiralLength(config),low=0,high=1;for(let i=0;i<20;i++){const currentDistance=calculateDistanceToParameter(t,config);if(Math.abs(currentDistance-distance)<.001)break;currentDistance<distance?(low=t,t=(t+high)/2):(high=t,t=(low+t)/2)}return getPositionAtParameter(t,config)}function getPositionAtParameter(t,config){const angle=2*t*Math.PI*5,radius=config.startRadius+t*config.radiusIncrease*10,y=t*config.yDistance*10;return{x:config.centerX+radius*Math.cos(angle),y:y,z:config.centerZ+radius*Math.sin(angle)}}function calculateDistanceToParameter(t,config){const angle=2*t*Math.PI*5,radius=config.startRadius+t*config.radiusIncrease*10,dr_dtheta=10*config.radiusIncrease/(2*Math.PI*5),dy_dtheta=10*config.yDistance/(2*Math.PI*5);return Math.sqrt(radius*radius+dr_dtheta*dr_dtheta+dy_dtheta*dy_dtheta)*angle}_this.onInit=_=>{!function createSpiralParticles(){const config={particleCount:300,desiredSpacing:1,radiusIncrease:.09,yDistance:.65,startRadius:.1,centerX:0,centerZ:0},geometry=function createGeometry(positions){const geometry=new Geometry,uvs=new Float32Array(positions.length/3*2);for(let i=0;i<uvs.length;i+=2)uvs[i]=.5,uvs[i+1]=.5;return geometry.addAttribute("position",new GeometryAttribute(positions,3)),geometry.addAttribute("uv",new GeometryAttribute(uvs,2)),geometry.drawRange.end=positions.length/3,geometry}(function generateSpiralPositions(config){const positions=new Float32Array(3*config.particleCount),totalLength=calculateSpiralLength(config),distancePerPoint=totalLength/(config.particleCount-1);for(let i=0;i<config.particleCount;i++){const pos=getPositionAtDistance(i*distancePerPoint,config);positions[3*i]=pos.x,positions[3*i+1]=pos.y,positions[3*i+2]=pos.z}return positions}(config)),points=function createPoints(config,geometry){const totalLength=10*config.yDistance,shader=_this.initClass(Shader,"SpiralGraphParticles",{uParticleSize:{value:1},uParticleDeactiveatedColor:{value:new Color("#7F7F7F")},uParticleColor:{value:new Color("#DFF140")},uProgress:{value:0},uDistRange:{value:new Vector2(0,totalLength)},DPR:{value:1}}),points=new Points(geometry,shader);return points.frustumCulled=!1,_this.shader=shader,points}(config,geometry);_this.add(points)}()},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SpiralGraphParticles"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SubdomainHeaderSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,TextAnimationHelper),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="SubdomainHeaderSlice",_this.contexts="ViewStateElement,TextAnimationHelper,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"SecondaryNavigationSlice",refName:"unnamed",children:[]},{className:"top-wrapper",_type:"div",refName:"unnamed",children:[{text:"$data.shortTitle",_type:"p",refName:"shortTitle",children:[]},{text:"$data.title",_type:"h1",refName:"title",children:[]},{_type:"div",refName:"details",children:[{_type:"div",refName:"textWrapper1",children:[{content:"$data.column1",class:"col1",_type:"RichText",refName:"rich1",children:[]},{"aria-hidden":!0,content:"$data.column1",class:"col1Hidden",_type:"RichText",refName:"rich1Hidden",children:[]}]},{_type:"div",refName:"textWrapper2",children:[{content:"$data.column2",class:"col2",_type:"RichText",refName:"rich2",children:[]},{"aria-hidden":!0,content:"$data.column2",class:"col2Hidden",_type:"RichText",refName:"rich2Hidden",children:[]}]},{className:"col3","aria-label":"Scroll to next section",role:"button",_type:"button",refName:"button",children:[{id:"arrow-down",_type:"Sprite",refName:"icon1",children:[]},{id:"arrow-down",_type:"Sprite",refName:"icon2",children:[]}]}]}]},{className:"SubdomainHeaderSlice__media",_type:"div",refName:"unnamed",children:[{video:"$data.video",image:"$data.image",_type:"Media",refName:"unnamed",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onMounted=()=>{_this.rich1.element.css({opacity:0}),_this.rich2.element.css({opacity:0}),_this.shortTitle.css({opacity:0}).transform({x:"-3rem"}),_this.title.css({opacity:0}).transform({x:"-3rem"}),_this.bind("ViewController/transitioning",stage=>{stage||function animateParagraphText(){_this.rich1.element.tween({opacity:1},500,"easeOutCubic",200),_this.rich2.element.tween({opacity:1},500,"easeOutCubic",300),_this.shortTitle.tween({opacity:1,x:0},500,"easeOutCubic",100),_this.title.tween({opacity:1,x:0},500,"easeOutCubic",0),[..._this.rich1.element.children()].forEach(child=>{let hydraObject=new HydraObject(child);if(child.innerHTML.includes("<br>")){let splitLines=child.innerHTML.split("<br>");return child.innerHTML="",void splitLines.forEach(line=>{let span=_this.h("p","p");span.text(String(line)),hydraObject.add(span),_this.animateText(span,500,!0)})}hydraObject.text(child.textContent),_this.animateText(hydraObject,500,!0)}),[..._this.rich2.element.children()].forEach(child=>{let hydraObject=new HydraObject(child);if(child.innerHTML.includes("<br>")){let splitLines=child.innerHTML.split("<br>");return child.innerHTML="",void splitLines.forEach(line=>{let span=_this.h("p","p");span.text(String(line)),hydraObject.add(span),_this.animateText(span,500,!0)})}hydraObject.text(child.textContent),_this.animateText(hydraObject,500,!0)})}()})},_this.button.click(e=>{Global.lenis?.scrollTo(_this.element.div.offsetHeight,{duration:2.5,lerp:.1})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SubdomainHeaderSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SubdomainMediaSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="SubdomainMediaSlice",_this.contexts="ViewStateElement,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"border",children:[]},{className:"content",_type:"div",refName:"content",children:[{content:"$data.col1",class:"col1",_type:"RichText",refName:"unnamed",children:[]},{className:"col2",_type:"div",refName:"unnamed",children:[{_type:"h5",_innerText:"$data.title",refName:"unnamed",children:[]},{content:"$data.col2",class:"col2Description",_type:"RichText",refName:"unnamed",children:[]},{_type:"CtaButton",refName:"cta",children:[]}]}]},{className:"images-container",_type:"div",refName:"imagesContainer",children:[{imageWithMeta:"$data.image",sizes:"(min-width: 769px) 96vw, 100vw",_type:"ResponsiveImage",refName:"unnamed",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.border.hide(),_this.border.transform({scaleX:0}),_this.onInView=()=>{_this.border.tween({scaleX:1},1500,"easeOutExpo")},_this.bind(_this.data,"rule",value=>{value&&_this.border.show()}),_this.bind(_this.data,"colorPair",color=>{color&&(_this.cta.element.classList().toggle("light","#010101"===SanityUtils.stegaClean(color.background.contrastColor)),_this.element.css({backgroundColor:SanityUtils.stegaClean(color.background.hex),color:SanityUtils.stegaClean(color.foreground.hex)}))}),_this.bind(_this.data,"col2Link",col2Link=>{col2Link&&col2Link.length?(_this.cta.args[0].data={...col2Link[0],type:"secondary"},_this.cta.show()):_this.cta.hide()}),_this.bind(_this.data,"alignment",alignment=>{_this.content.classList().remove("left-align","right-align"),_this.content.classList().add(`${alignment}-align`)}),_this.bind(_this.data,"swapColumns",swapColumns=>{_this.content.classList().toggle("swap",!!swapColumns)}),_this.bind(_this.data,"secondaryImage",secondaryImage=>{for(;_this.imagesContainer.div.children.length>1;)_this.imagesContainer.div.removeChild(_this.imagesContainer.div.lastChild);secondaryImage?(_this.createFragment(ResponsiveImage,AppState.createLocal({imageWithMeta:secondaryImage}),[_this.imagesContainer]),_this.content.classList().add("two-images")):_this.content.classList().remove("two-images")}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SubdomainMediaSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SubterraneanHeaderParticleShader(_mesh,_shader,_input,_group){const _this=this;if(Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="SubterraneanHeaderParticleShader",_this.contexts="Component",_this.mesh=_mesh,_this.shader=_shader,_this.uilInput=_input,_this.uilFolder=_group,_this.uilFolder?.addButton){let a=_this.uilFolder;_this.uilFolder=_this.uilInput,_this.uilInput=a}this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.shader.addUniforms({uProgress:{value:0}}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SubterraneanHeaderParticleShader"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SubterraneanHeaderParticles(_params,...restArgs){const _this=this;Inherit(_this,FragFXScene,_params?.sceneLayoutName||"SubterraneanHeaderParticles"),Inherit(_this,XComponent),_this.fragName="SubterraneanHeaderParticles",_this.contexts='FragFXScene, _params?.sceneLayoutName || "SubterraneanHeaderParticles"',_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this._initFXScene(World.NUKE,null,{format:Texture.RGBFormat,type:void 0,minFilter:void 0,magFilter:void 0,multiRenderTarget:void 0,mipmaps:void 0,screenQuad:void 0,vrMode:void 0,multisample:void 0,samplesAmount:void 0}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.camera=new BaseCamera,_this.camera.camera.position.z=10,_this.camera.camera.fov=20,_this.camera.camera.updateProjectionMatrix(),_this.camera.lock(),_this.useCamera(_this.camera),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SubterraneanHeaderParticles"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SubterraneanHeaderPatternSceneFour(_params,...restArgs){const _this=this;Inherit(_this,FragFXScene,"SubterraneanHeaderPatternSceneFour"),Inherit(_this,XComponent),_this.fragName="SubterraneanHeaderPatternSceneFour",_this.contexts="FragFXScene, 'SubterraneanHeaderPatternSceneFour'",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this._initFXScene(World.NUKE,null,{format:Texture.RGBFormat,type:void 0,minFilter:void 0,magFilter:void 0,multiRenderTarget:void 0,mipmaps:void 0,screenQuad:void 0,vrMode:void 0,multisample:void 0,samplesAmount:void 0}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.layers&&_this.layers.camera&&(_this.layers.camera.lock(),_this.useCamera(_this.layers.camera));let newPosition=new Vector3,initialPosition=new Vector3;_this.bind("SubterraneanHeaderSlice/colorPair",colorPair=>{if(!colorPair)return;if(_this.isPlayground())return;let color=new Color(SanityUtils.stegaClean(colorPair.background.hex));_this.layers.background.shader.uniforms.uColor.value=color}),_this.bind("SubterraneanHeaderSlice/scrollProgress",scrollProgress=>{let progress=Math.range(scrollProgress,3.75,5.25,0,1);newPosition.set(initialPosition.x,1*-progress+initialPosition.y,initialPosition.z)}),_this.startRender(_=>{_this.layers.video&&_this.layers.video.shader&&!_this.isPlayground()&&(_this.layers.video.shader.uniforms.uOffset.value.set(0,1.5*-newPosition.y),_this.layers.video.shader.uniforms.uScale.value.set(2,2))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SubterraneanHeaderPatternSceneFour"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SubterraneanHeaderPatternSceneOne(_params,...restArgs){const _this=this;Inherit(_this,FragFXScene,"LandscapeTest"),Inherit(_this,XComponent),_this.fragName="SubterraneanHeaderPatternSceneOne",_this.contexts="FragFXScene, 'LandscapeTest'",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this._initFXScene(World.NUKE,null,{format:Texture.RGBFormat,type:void 0,minFilter:void 0,magFilter:void 0,multiRenderTarget:void 0,mipmaps:void 0,screenQuad:void 0,vrMode:void 0,multisample:void 0,samplesAmount:void 0}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.layers&&_this.layers.camera&&(_this.layers.camera.lock(),_this.useCamera(_this.layers.camera));let newPosition=new Vector3,initialPosition=new Vector3;_this.bind("SubterraneanHeaderSlice/scrollProgress",scrollProgress=>{let progress=Math.range(scrollProgress,0,6,-.22,3.25);newPosition.set(initialPosition.x,1*-progress+initialPosition.y,initialPosition.z)}),_this.startRender(_=>{_this.layers.video&&_this.layers.video.shader&&!_this.isPlayground()&&_this.layers.video.shader.uniforms.uOffset.value.set(0,-newPosition.y)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SubterraneanHeaderPatternSceneOne"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SubterraneanHeaderPatternSceneThree(_params,...restArgs){const _this=this;Inherit(_this,FragFXScene,"SubterraneanHeaderPatternSceneThree"),Inherit(_this,XComponent),_this.fragName="SubterraneanHeaderPatternSceneThree",_this.contexts="FragFXScene, 'SubterraneanHeaderPatternSceneThree'",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this._initFXScene(World.NUKE,null,{format:Texture.RGBFormat,type:void 0,minFilter:void 0,magFilter:void 0,multiRenderTarget:void 0,mipmaps:void 0,screenQuad:void 0,vrMode:void 0,multisample:void 0,samplesAmount:void 0}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.layers&&_this.layers.camera&&(_this.layers.camera.lock(),_this.useCamera(_this.layers.camera));let newPosition=new Vector3,initialPosition=new Vector3;_this.bind("SubterraneanHeaderSlice/colorPair",colorPair=>{if(!colorPair)return;if(_this.isPlayground())return;let color=new Color(SanityUtils.stegaClean(colorPair.background.hex));_this.layers.background.shader.uniforms.uColor.value=color}),_this.bind("SubterraneanHeaderSlice/scrollProgress",scrollProgress=>{let progress=Math.range(scrollProgress,2.75,4.25,0,1);newPosition.set(initialPosition.x,1*-progress+initialPosition.y,initialPosition.z)}),_this.startRender(_=>{_this.layers.video&&_this.layers.video.shader&&!_this.isPlayground()&&(_this.layers.video.shader.uniforms.uOffset.value.set(0,.5*-newPosition.y),_this.layers.video.shader.uniforms.uScale.value.set(1.5,1.5))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SubterraneanHeaderPatternSceneThree"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SubterraneanHeaderPatternSceneTwo(_params,...restArgs){const _this=this;Inherit(_this,FragFXScene,"SubterraneanHeaderPatternSceneTwo"),Inherit(_this,XComponent),_this.fragName="SubterraneanHeaderPatternSceneTwo",_this.contexts="FragFXScene, 'SubterraneanHeaderPatternSceneTwo'",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this._initFXScene(World.NUKE,null,{format:Texture.RGBFormat,type:void 0,minFilter:void 0,magFilter:void 0,multiRenderTarget:void 0,mipmaps:void 0,screenQuad:void 0,vrMode:void 0,multisample:void 0,samplesAmount:void 0}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.layers&&_this.layers.camera&&(_this.layers.camera.lock(),_this.useCamera(_this.layers.camera));let newPosition=new Vector3,initialPosition=new Vector3;_this.bind("SubterraneanHeaderSlice/colorPair",colorPair=>{if(!colorPair)return;if(_this.isPlayground())return;let color=new Color(SanityUtils.stegaClean(colorPair.background.hex));_this.layers.background.shader.uniforms.uColor.value=color}),_this.bind("SubterraneanHeaderSlice/scrollProgress",scrollProgress=>{let progress=Math.range(scrollProgress,1.75,3.25,0,1);newPosition.set(initialPosition.x,1*-progress+initialPosition.y,initialPosition.z)}),_this.startRender(_=>{_this.layers.video&&_this.layers.video.shader&&!_this.isPlayground()&&(_this.layers.video.shader.uniforms.uOffset.value.set(0,.5*-newPosition.y),_this.layers.video.shader.uniforms.uScale.value.set(1.5,1.5))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SubterraneanHeaderPatternSceneTwo"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SubterraneanHeaderPlaneShader(_mesh,_shader,_input,_group){const _this=this;if(Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="SubterraneanHeaderPlaneShader",_this.contexts="Component",_this.mesh=_mesh,_this.shader=_shader,_this.uilInput=_input,_this.uilFolder=_group,_this.uilFolder?.addButton){let a=_this.uilFolder;_this.uilFolder=_this.uilInput,_this.uilInput=a}this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.shader.addUniforms({uProgress:{value:0},tGrain:{value:Utils3D.getRepeatTexture("assets/images/texture/grain_1024.png")}}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SubterraneanHeaderPlaneShader"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function SubterraneanHeaderSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,FXSceneSlice,{sceneLayoutName:"SubterraneanHeaderScene"}),Inherit(_this,XComponent),_this.fragName="SubterraneanHeaderSlice",_this.contexts="ViewStateElement,FXSceneSlice, { sceneLayoutName: 'SubterraneanHeaderScene' }",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.particleScene=_this.initClass(SubterraneanHeaderParticles),_this.particleScene.isFragment&&_promises.push(_this.wait(_this.particleScene,"__ready")),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"footerWrapper",children:[{_type:"blockquote",refName:"quote",children:[]},{_type:"h6",refName:"author",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;Tests.requiresFallbackGraphics()||(_this.wait(_=>_this.layers&&_this.layers.camera&&_this.layers.camera.lock).then(_=>_this.layers.camera.lock()),function initMesh(){_this.shader=_this.initClass(Shader,"SubterraneanHeaderShader",{tMap1:{value:_this.particleScene},uVertOffset:{value:0},uVertClip:{value:0},uTransition:{value:0},uGradient:{value:0},uProgress:{value:0}}),_this.mesh.shader=_this.shader}()),_this.author.css({opacity:0}).hide(),_this.quoteSplit=new SplitText(_this.quote,{type:"lines,words",asHydraObject:!0}),_this.bind(_this.data,"text",quoteText=>{quoteText&&(_this.quoteSplit.revert(),_this.quote.html(quoteText),_this.quoteSplit.split(),_this.quoteSplit.words.forEach(word=>{word.css({opacity:0,transform:"translate3d(0, 20px, 0)"})}))}),_this.bind(_this.data,"author",author=>{author?(_this.author.text(author),_this.author.show()):_this.author.hide()}),await _this.particleScene.waitLayers(),_this.startRender(function loop(){_this.requiresFallback||(_this.particleScene.layout.layers.plane.shader.uniforms.uProgress.value=_this.progress,_this.particleScene.layout.layers.particles.mesh.shader.uniforms.uProgress.value=_this.progress);if(_this.set("scrollProgress",_this.progress),_this.footerWrapper.classList()[_this.progress>=.999?"add":"remove"]("finished"),_this.author.css({opacity:Math.range(_this.progress,.97,.99,0,1,!0)}),_this.quoteSplit&&_this.quoteSplit.words.length>0){const animProgress=Math.range(_this.progress,.88,1,0,1,!0),overlapFactor=3,staggerDelay=1/(_this.quoteSplit.words.length+overlapFactor-1),wordAnimDuration=staggerDelay*overlapFactor;_this.quoteSplit.words.forEach((word,index)=>{const wordStart=index*staggerDelay,wordEnd=wordStart+wordAnimDuration,wordProgress=Math.range(animProgress,wordStart,wordEnd,0,1,!0),opacity=Math.pow(wordProgress,2),translateY=20*(1-wordProgress);word.css({opacity:opacity,transform:`translate3d(0, ${translateY}px, 0)`})})}}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"SubterraneanHeaderSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function Table(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,BindUtils),Inherit(_this,XComponent),_this.fragName="Table",_this.contexts="Element,BindUtils",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{view:"TableRow",data:"$state.rows",_type:"ViewState",refName:"unnamed",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function updateRows(rows){_this.state.rows.refresh(rows)}_this.state.rows=new StateArray,_this.bindToNestedParams("table",bind=>{bind("rows",updateRows)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"Table"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function TableRow(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="TableRow",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"columns",function updateColumns(columns){_this.element.css({gridTemplateColumns:`repeat(${columns.length}, 1fr)`}),columns.forEach(column=>{let container=_this.element.create("cell"),text=_this.createFragment(RichText,AppState.createLocal({content:column.column}),[container]);container.add(text)})}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"TableRow"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function Tests(){const _this=this;Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="Tests",_this.contexts="Component",this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.getDPR=_=>GPU.OVERSIZED?.8:GPU.lt(0)?1:GPU.lt(1)?Math.min(Device.pixelRatio,1.2):GPU.lt(2)?Math.min(Device.pixelRatio,1.35):GPU.lt(3)?Math.min(Device.pixelRatio,1.5):GPU.lt(4)?Math.min(Device.pixelRatio,2):GPU.lt(5)?Device.pixelRatio:GPU.mobileLT(0)?1:GPU.mobileLT(1)?Math.min(Device.pixelRatio,1.2):GPU.mobileLT(2)?Math.min(Device.pixelRatio,1.35):GPU.mobileLT(3)?Math.min(Device.pixelRatio,1.5):GPU.mobileLT(4)?Math.min(Device.pixelRatio,1.75):GPU.mobileLT(5)?Math.min(Device.pixelRatio,2):1,_this.requiresFallbackGraphics=(attemptAllMobile=!1)=>{if(Utils.query("preventFallback"))return!1;if(!Device.graphics.webgl)return!0;if(Utils.query("fallback"))return!0;if(Device.mobile.lowPowerMode)return!0;if(attemptAllMobile)return!1;const gpu=Device.graphics.webgl.gpu?.toLowerCase()||"",os=Device.system.os?.toLowerCase(),osVersion=parseFloat(Device.system.version),isIOS="ios"===os,isAppleA18=gpu.includes("apple a18"),isPhone=!0===Device.mobile?.phone,extensions=Device.graphics.webgl.extensions||[],lacksS3TC=!extensions.includes("WEBGL_compressed_texture_s3tc_srgb"),lacksBPTC=!extensions.includes("EXT_texture_compression_bptc");return isIOS&&isAppleA18&&isPhone&&osVersion>=18.5&&lacksS3TC&&lacksBPTC},_this.capFPS=_=>GPU.lt(0)||GPU.mobileLT(2)?30.001:GPU.lt(3)?Render.REFRESH_RATE>60?60.001:null:Device.mobile&&Render.REFRESH_RATE>100?100.001:null,_this.renderFXAA=_=>!1===_this.msaaSamples()&&(!GPU.lt(1)&&!GPU.mobileLT(2)),_this.enableWorldNukeMSAA=_=>!0,_this.msaaSamples=_=>!(!Device.graphics.webgl.webgl2||Utils.query("compat"))&&(!Device.system.xr?.vr&&(!GPU.lt(2)&&(!GPU.mobileLT(2)&&(GPU.lt(3)||GPU.mobileLT(3)?2:4)))),_this.getXRType=_=>Device.system.xr.ar&&!Device.system.xr.vr?RenderManager.AR:Device.system.xr.vr?RenderManager.VR:null,_this.pingPongRender=_=>_this.capFPS()<40?GPU.lt(0)||GPU.mobileLT(1):!!GPU.lt(3)||!!GPU.mobileLT(3),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"Tests"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()},"static"),Class(function TextAnimationHelper(_params,...restArgs){const _this=this;Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="TextAnimationHelper",_this.contexts="Component",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.animateText=function animateText(element,duration=500,over=!0){if(element.animation&&0===element.animation.v||(element.animation={v:0}),element.textAnimationState||(element.textAnimationState={cleanTextElement:element,cleanText:element.__cacheText,isCleaned:!1}),_this.getSync("CMS/liveModeEnabled")&&!element.textAnimationState.isCleaned){let stegaSplit=SanityUtils.stegaSplit(element.div.textContent);if(stegaSplit.encoded){element.div.innerHTML="",element.classList().add("st");let cleanSpan=element.create("clean","span");cleanSpan.text(stegaSplit.cleaned);let stegaSpan=element.create("stega","span");stegaSpan.text(stegaSplit.encoded),stegaSpan.attr("aria-hidden",!0),element.textAnimationState.cleanTextElement=cleanSpan,element.textAnimationState.cleanText=stegaSplit.cleaned,element.textAnimationState.isCleaned=!0}}let lastTick=-1;function tick(){if(lastTick===element.animation.v)return element.textAnimationState.cleanTextElement.text(element.textAnimationState.cleanText),void TextUtils.wrapRedactedText(element);lastTick=element.animation.v;let text=function replaceRandomLetters(str,startIndex,endIndex){let replacementChars="ABCDEFGHIJKLMNOPQRSTUVWXYZ";const specialChars=[" ","/","?",",","."];let stringified=str.toString(),result=stringified.split("");isNaN(Number(stringified))||(replacementChars="0123456789"),startIndex=Math.max(0,Math.min(Math.round(startIndex),stringified.length)),endIndex=Math.max(startIndex,Math.min(Math.round(endIndex),stringified.length));for(let i=startIndex;i<endIndex;i++){const randomChar=replacementChars.charAt(Math.floor(Math.random()*replacementChars.length));specialChars.includes(result[i])||(result[i]===result[i].toLowerCase()?result[i]=randomChar.toLowerCase():result[i]=randomChar.toUpperCase())}return result.join("")}(element.textAnimationState.cleanText,Math.range(element.animation.v,0,1,1,element.textAnimationState.cleanText.toString().length),element.textAnimationState.cleanText.toString().length);element.textAnimationState.cleanTextElement.text(text)}return _this.startRender(tick,20),_this.delayedCall(_=>{_this.stopRender(tick),element.textAnimationState.cleanTextElement.text(element.textAnimationState.cleanText),TextUtils.wrapRedactedText(element),lastTick=-1},duration),tween(element.animation,{v:over?1:0},duration,"easeInOutSine").onComplete(_=>{element?.textAnimationState?.cleanTextElement?.text?.(element.textAnimationState.cleanText),TextUtils.wrapRedactedText(element)})},_this.animateMask=function animateMask(element,duration){element.tweenObj||(element.tweenObj={index:0});let currentIndex=-1;element.tweenObj.index=0,tween(element.tweenObj,{index:element.div.textContent.length},duration,"easeOutCubic").onUpdate(_=>{let nextIndex=Math.floor(element.tweenObj.index);if(currentIndex!==nextIndex&&nextIndex<element.div.textContent.length){currentIndex=nextIndex;let child=element.div.childNodes[0];if(child.nodeType===Node.TEXT_NODE){let range=document.createRange();range.setStart(child,currentIndex),range.setEnd(child,currentIndex+1);let maskPos=range.getClientRects(),parentBound=element.div.getBoundingClientRect();element.css({clipPath:`path('M 0 0 v ${maskPos[0].height} h ${maskPos[0].left-parentBound.left} v -${maskPos[0].height} M ${maskPos[0].left-parentBound.left+maskPos[0].width} 0 v ${maskPos[0].height} h ${parentBound.width} v -${maskPos[0].height}')`})}}}).onComplete(_=>{let parentBound=element.div.getBoundingClientRect();element.css({clipPath:`path('M 0 0 v ${parentBound.height} h ${parentBound.width} v -${parentBound.height}')`})})},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"TextAnimationHelper"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()},()=>{TextAnimationHelper.animateMask=function animateMask(element,duration){element.tweenObj||(element.tweenObj={index:0});let currentIndex=-1,parentBound=element.div.getBoundingClientRect();element.tweenObj.index=0,tween(element.tweenObj,{index:element.div.textContent.length},duration,"easeOutCubic").onUpdate(_=>{let nextIndex=Math.floor(element.tweenObj.index);if(currentIndex!==nextIndex&&nextIndex<element.div.textContent.length){currentIndex=nextIndex;let child=element.div.childNodes[0];if(child.nodeType===Node.TEXT_NODE){let range=document.createRange();range.setStart(child,currentIndex),range.setEnd(child,currentIndex+1);let maskPos=range.getClientRects();element.css({clipPath:`path('M 0 0 v ${maskPos[0].height} h ${maskPos[0].left-parentBound.left} v -${maskPos[0].height} M ${maskPos[0].left-parentBound.left+maskPos[0].width} 0 v ${maskPos[0].height} h ${parentBound.width} v -${maskPos[0].height}')`})}}}).onComplete(_=>{element.css({clipPath:`path('M 0 0 v ${parentBound.height} h ${parentBound.width} v -${parentBound.height}')`})})}}),Class(function TextButton(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="TextButton",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{"aria-label":"$params.ariaLabel",role:"button",_type:"button",refName:"button",children:[{text:"$params.text",_type:"div",refName:"text",children:[]},{id:"$params.icon",_type:"Sprite",refName:"icon",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.button.bind("click",function handleClick(_){_this.params?.onClick?.(_this.element,_)}),_this.setDisabled=(disabled=!0)=>{_this.element.div.classList.toggle("disabled",disabled)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"TextButton"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function TextContentSlice(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="TextContentSlice",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"h2",refName:"text",children:[{_type:"span",_innerText:"$data.text",refName:"sp",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"backgroundColor",color=>{color&&_this.element.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)})}),_this.bind(_this.data,"width",(width,prevWidth)=>{prevWidth&&_this.text.classList().remove(`w-${SanityUtils.stegaClean(prevWidth)}`),_this.text.classList().add(`w-${SanityUtils.stegaClean(width)}`)}),_this.text.onResize(e=>{0!==e.borderBoxSize[0].inlineSize&&function setShrinkRatio(){let shrinkRatio=_this.text.div.offsetWidth/_this.sp.div.offsetWidth;!isNaN(shrinkRatio)&&shrinkRatio<1?_this.element.div.style.setProperty("--shrink-ratio",shrinkRatio):_this.element.div.style.setProperty("--shrink-ratio",1)}()}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"TextContentSlice"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function TextUtils(){const _this=this;Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="TextUtils",_this.contexts="Component",this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.capitalize=str=>str?str.split(" ").map(word=>word.charAt(0).toUpperCase()+word.slice(1)).join(" "):str,_this.sentenceCase=str=>str?str.split(".").map(sentence=>{let chars=sentence.split("");for(let i=0;i<chars.length;i++)if(/[a-zA-Z]/.test(chars[i])){chars[i]=chars[i].toUpperCase();break}return chars.join("")}).join("."):str,_this.validateEmail=email=>/\S+@\S+\.\S+/.test(email),_this.validateMonth=month=>/^[0-9]{4}-[0-9]{2}/.test(month),_this.validatePhone=phone=>/^\([0-9]{3}\)[0-9]{3}-[0-9]{4}/.test(phone),_this.validateLinkedIn=linkedin=>/^(https?:\/\/)?(www)?\.(linkedin)\.(com)\/(in)\/[a-zA-Z0-9-]+\/?/.test(linkedin),_this.validateDate=date=>/^[0-9]{4}-[0-9]{2}-[0-9]{2}/.test(date),_this.wrapRedactedText=async element=>{if(!(element.div?element.div:element).innerHTML.includes(""))return;let textTagList=["P","SPAN","H1","H2","H3","H4","H5","H6","BLOCKQUOTE","DIV"],hydraElement=element;function wrapRedactedText(element){if("FIGURE"!==(element=element.div?element.div:element).tagName){if("A"===element.tagName){let button=new HydraObject(element);_this.wrapRedactedText(button)}if(textTagList.includes(element.tagName)){const updatedHtml=element.innerHTML.replace(/({2,})/g,match=>`<span class="redacted">${match}</span>`);element.innerHTML=updatedHtml}}}element instanceof HydraObject||(hydraElement=new HydraObject(element)),(0===hydraElement.children().length?[hydraElement]:[...hydraElement.children()]).forEach(e=>{e instanceof HydraObject||(e=new HydraObject(e)),wrapRedactedText(element),e.children.length>0&&e.children.map(child=>wrapRedactedText(child))})},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"TextUtils"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()},"static"),Class(function TextureArrayTest(_mesh,_shader,_input,_group){const _this=this;if(Inherit(_this,Component),Inherit(_this,XComponent),_this.fragName="TextureArrayTest",_this.contexts="Component",_this.mesh=_mesh,_this.shader=_shader,_this.uilInput=_input,_this.uilFolder=_group,_this.uilFolder?.addButton){let a=_this.uilFolder;_this.uilFolder=_this.uilInput,_this.uilInput=a}this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.shader.addUniforms({tMotionVectors:{value:null,getTexture:Utils3D.getLookupTexture},uCellSize:{value:new Vector2(256,256)},uTextureSize:{value:new Vector2(4096,4096)}}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"TextureArrayTest"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ThreeColumnRichText(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="ThreeColumnRichText",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{class:"column1",content:"$data.column1",_type:"RichText",refName:"unnamed",children:[]},{class:"column2",content:"$data.column2",_type:"RichText",refName:"unnamed",children:[]},{class:"column3",content:"$data.column3",_type:"RichText",refName:"unnamed",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"backgroundColor",color=>{color&&(_this.element.classList().toggle("light","#010101"===SanityUtils.stegaClean(color.contrastColor)),_this.element.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)}))}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"ThreeColumnRichText"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function TwoColumnRichText(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,InView,.5),Inherit(_this,XComponent),_this.fragName="TwoColumnRichText",_this.contexts="ViewStateElement,Element,InView, 0.5",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{class:"column1",content:"$data.column1",_type:"RichText",refName:"col1",children:[]},{class:"column2",content:"$data.column2",_type:"RichText",refName:"col2",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind(_this.data,"backgroundColor",color=>{color&&(_this.element.classList().toggle("light","#010101"===SanityUtils.stegaClean(color.contrastColor)),_this.element.css({backgroundColor:SanityUtils.stegaClean(color.hex),color:SanityUtils.stegaClean(color.contrastColor)}))}),_this.bind(_this.data,"arsenalPadding",arsenalPadding=>{arsenalPadding&&_this.element.classList().add("arsenal-padding")}),_this.bind(_this.data,"columnRatio",ratio=>{_this.element.classList().add(SanityUtils.stegaClean(ratio))}),_this.bind(_this.data,"mobileSpacing",(spacing,previousValue)=>{previousValue&&_this.element.classList().remove(`spacing-${SanityUtils.stegaClean(previousValue)}`),_this.element.classList().add(`spacing-${SanityUtils.stegaClean(spacing)}`)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"TwoColumnRichText"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILAssetFile(_data,_index,_params){const _this=this;Inherit(_this,Element),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="UILAssetFile",_this.contexts="Element,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{click:"$onClick",_type:"article",refName:"file",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;const markupOptions={image:`\n        <figure>\n            <img class="thumbnail" src="${_this.data.url}" alt="${_this.data.filename}">\n            <figcaption>\n                <p>${_this.data.filename}</p>\n            </figcaption>\n        </figure>`,file:`\n        <p>${_this.data.filename}</p>`};_this.createState(),_this.state.set("markup",markupOptions[function getMarkupType(){return _this.data.type.includes("image")?"image":"file"}()]),_this.file.div.innerHTML=_this.state.markup,_this.onClick=event=>{event.preventDefault(),_this.fire("click",{id:_this.data.id})},_this.element.goob("\n    & {}\n\n    .file {\n        padding: var(--spacing-small);\n        text-align: center;\n\n        &:hover {\n            outline: 1px solid var(--color-action);\n            cursor: pointer;\n        }\n    }\n\n    .thumbnail {\n        display: block;\n        margin-bottom: calc(var(--spacing-small) / 2);\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILAssetFile"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILAssetsExplorer(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILAssetsExplorer",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"dialog",refName:"explorer",children:[{className:"header",_type:"header",refName:"unnamed",children:[{className:"title",_type:"h2",_innerText:"Assets Library",refName:"unnamed",children:[]},{_type:"button",refName:"closeButton",children:[{className:"sr-only",_type:"span",_innerText:"Close",refName:"unnamed",children:[]}]}]},{_type:"div",refName:"explorerContent",children:[{className:"compressed-option",_type:"div",refName:"unnamed",children:[{_type:"button",_innerText:"Sync To Folder",refName:"syncButton",children:[]}]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let monitorChangeInterval,onInit=_this.onInit;async function syncClick(){try{!async function monitorChanges(dirHandle){let previousFileStates={};clearInterval(monitorChangeInterval),monitorChangeInterval=setInterval(async()=>{for await(const entry of dirHandle.values())if("file"===entry.kind){const file=await entry.getFile();previousFileStates[file.name]&&previousFileStates[file.name].lastModified===file.lastModified||UILStorage.uploadAsset(file),previousFileStates[file.name]=file}},500)}(await window.showDirectoryPicker())}catch(err){console.error("Error selecting directory:",err)}}async function updateData(){_this.data=await Data.request("assets",()=>{}),_this.tabs.updateContent([{id:"image",label:"Image",content:_this.data.images,active:0==_this.tabs.state.activeIndex,disabled:!1,hidden:!1,draggable:!1,hideToobar:!0},{id:"geometry",label:"Geometry",content:_this.data.geometries,active:1==_this.tabs.state.activeIndex,disabled:!1,hidden:!1,draggable:!1},{id:"video",label:"Video",content:_this.data.videos,active:2==_this.tabs.state.activeIndex,disabled:!1,hidden:!1,draggable:!1},{id:"audio",label:"Audio",content:_this.data.audios,active:3==_this.tabs.state.activeIndex,disabled:!1,hidden:!1,draggable:!1},{id:"other",label:"Other",content:_this.data.other,active:4==_this.tabs.state.activeIndex,disabled:!1,hidden:!1,draggable:!1}])}_this.data={},_this.onMounted=async()=>{_this.flag("isReady",!0),function initListeners(){_this.closeButton.click(_this.close),_this.syncButton.div.addEventListener("click",syncClick),_this.events.sub(UILStorage.UPLOADED,updateData)}(),_this.tabs=_this.initClass(UILAssetsExplorerTabs,[{id:"image",label:"Image",content:_this.data.images,active:!0,disabled:!1,hidden:!1,draggable:!1,hideToobar:!0},{id:"geometry",label:"Geometry",content:_this.data.geometries,active:!1,disabled:!1,hidden:!1,draggable:!1},{id:"video",label:"Video",content:_this.data.videos,active:!1,disabled:!1,hidden:!1,draggable:!1},{id:"audio",label:"Audio",content:_this.data.audios,active:!1,disabled:!1,hidden:!1,draggable:!1},{id:"other",label:"Other",content:_this.data.other,active:!1,disabled:!1,hidden:!1,draggable:!1}],[_this.explorerContent])},_this.ready=_=>_this.wait("isReady"),_this.testCallback=()=>console.log("test callback"),_this.open=async(fileSelectedCallback,startIndex=0)=>{await _this.ready(),await updateData(),_this.explorer.div.showModal(),_this.tabs.setActiveTab(startIndex),_this.tabs.updateTabWidth(),_this.testCallback=fileSelectedCallback},_this.listen("UILAssetFile/click",event=>{_this.testCallback(event.id),_this.close()}),_this.close=()=>{_this.explorer.div.close()},_this.element.goob("\n    & {\n        --close-button-size: 20px;\n        pointer-events: all;\n    }\n    \n    .explorer {\n        background-color: var(--color-neutral-20);\n        color: var(--font-color-base);\n        border: none; \n        border-radius: 12px;\n        padding: 0;\n        width: min(980px, calc(100vw - var(--spacing)));\n        max-height: calc(100% - var(--spacing) * 2);\n    }\n\n    .header {\n        background-color: var(--color-neutral-40);\n        padding: var(--spacing-small);\n        text-align: center;\n        position: relative;\n    }\n    \n    .title {\n        font: var(--label2);\n        margin: 0;\n    }\n\n    .closeButton {\n        border: none;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        width: var(--close-button-size);\n        height: var(--close-button-size);\n        padding: calc(var(--spacing-small) / 2);\n        position: absolute;\n        top: calc(var(--spacing) / 1.75);\n        right: calc(var(--spacing) / 1.75);\n\n        &:after,\n        &:before {\n            background-color: var(--color-neutral-70);\n            content: '';\n            display: block;\n            width: calc(var(--close-button-size) / 1.75);\n            height: 1px;\n            transform: rotate(45deg);\n            position: absolute;\n            transition: color var(--duration) var(--timing);\n        }\n\n        &:after {\n            transform: rotate(-45deg);\n            transform-origin: center;\n        }\n\n        &:hover {\n            background-color: transparent;\n\n            &:before,\n            &:after {\n                background-color: var(--font-color-base);\n                \n            }\n        }\n\n        &:focus {\n            outline-offset: calc(var(--spacing-small) / 4);\n        }\n    }\n\n    .explorerContent {\n        position: relative;\n    }\n\n    .compressed-option {\n        font: var(--label3);\n        color: var(--color-neutral-80);\n        position: absolute;\n        top: var(--spacing-small);\n        right: var(--spacing-small);\n        z-index: 1;\n        \n        &:hover {\n            cursor: pointer;\n            color: var(--color-action);\n        }\n    }\n\n    .regular-checkbox,\n    .checkbox-control {\n        cursor: pointer;\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILAssetsExplorer"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILAssetsExplorerTabs(_params,...restArgs){const _this=this;Inherit(_this,UILBaseTabs),Inherit(_this,XComponent),_this.fragName="UILAssetsExplorerTabs",_this.contexts="UILBaseTabs",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.ready=!1,_this.onInit=()=>{_this.state.set("navView","UILTabsIconNavItem"),_this.state.set("contentView","UILAssetsLibraryTabsContentItem"),_this.state.tabsData.refresh(new StateArray(_this.params))},_this.listen("UILTabsIconNavItem/click",event=>{_this.state.tabsData.forEach((tab,index)=>{tab.id===event.id&&_this.state.set("activeIndex",index)})}),_this.updateContent=data=>{_this.state.tabsData.refresh(new StateArray(data))},_this.element.goob("\n    & {}\n\n    .tabsHeader {\n        background-color: transparent;\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILAssetsExplorerTabs"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILAssetsLibraryTabsContentItem(_data,_index,_params){const _this=this;Inherit(_this,Element),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="UILAssetsLibraryTabsContentItem",_this.contexts="Element,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"article",refName:"contentContainer",children:[{view:"UILAssetFile",data:"$state.tabData",_type:"ViewState",refName:"unnamed",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.createState(),_this.state.set("tabData",new StateArray(_this.data.content)),_this.element.goob("\n    .contentContainer {\n        display: flex;\n        flex-wrap: wrap;\n        padding: var(--spacing);\n    }\n\n    .UILAssetFile {\n        width: 124px;\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILAssetsLibraryTabsContentItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILBaseTabs(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILBaseTabs",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"header",refName:"tabsHeader",children:[{_type:"nav",refName:"nav",children:[{view:"$state.navView",data:"$state.tabsData",_type:"ViewState",refName:"unnamed",children:[]}]}]},{_type:"section",refName:"tabsContent",children:[{view:"$state.contentView",data:"$state.tabsData",_type:"ViewState",refName:"unnamed",children:[]}]},{click:"$handleHistoryClick",_type:"button",refName:"historyButton",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function updateTabWidth(width){const newWidth="number"==typeof width?width:_this.element.div.offsetWidth;_this.element.attr("style",`\n        --tab-content-width: ${newWidth}px;\n        --tab-count: ${_this.state.tabsData.length};\n    `)}_this.ready=!1,_this.createState(),_this.state.set("tabsData",new StateArray(_this.params)),_this.state.set("navView","UILTabsNavItem"),_this.state.set("contentView","UILTabsContentItem"),_this.state.set("activeIndex",0),_this.state.set("historyLabel","History"),_this.state.bind("historyLabel",_this.historyButton),_this.onMounted=async()=>{_this.historyButton.hide(),function initListeners(){_this.bindState(_this.state,"activeIndex",value=>{!function updateActiveTab(){_this.state.tabsData.forEach((tab,index)=>{tab.active=_this.state.activeIndex===index}),_this.tabsContent.tween({x:-_this.element.div.offsetWidth*_this.state.activeIndex},500,"easeOutCubic")}()}),_this.bind("UILPanel/historyPanelToggle",value=>{value?_this.state.set("historyLabel","Hide History"):_this.state.set("historyLabel","History")})}(),_this.updateTabWidth(300),_this.ready=!0},_this.onResize(updateTabWidth),_this.listen("UILTabsNavItem/click",event=>{_this.state.tabsData.forEach((tab,index)=>{tab.id===event.id&&_this.state.set("activeIndex",index)})}),_this.handleHistoryClick=()=>{_this.fire("toggle-history-panel")},_this.setActiveTab=index=>{_this.state.set("activeIndex",index)},_this.addTab=tabData=>{},_this.removeTab=tabId=>{},_this.setDisabledTab=tabId=>{},_this.setHiddenTab=tabId=>{},_this.addGraph=graph=>{_this.state.tabsData.find(tab=>"playground"===tab.id).content=graph},_this.addGlobalFolder=folder=>{const tabData=_this.state.tabsData.find(tab=>"global"===tab.id);tabData&&(tabData.content=folder)},_this.showHistoryButton=async()=>{await _this.wait(()=>_this.ready),await defer(),_this.historyButton.show()},_this.updateTabWidth=updateTabWidth,_this.element.goob('\n    & {\n        box-sizing: border-box;\n        color: #fff;\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n        position: relative;\n    }\n\n    .tabsHeader {\n        background-color: var(--panel-background-color);\n        border-bottom: var(--border);\n        font: var(--label3-semi);\n        padding-left: var(--spacing-small);\n    }\n\n    .nav {\n        display: flex;\n        width: 100%;\n    }\n\n    .tabsContent {\n        display: flex;\n        width: calc(var(--tab-content-width) * var(--tab-count));\n        height: 100%;\n\n        .UILPanel.global & {\n            height: calc(100% - 39px);\n        }\n    }\n\n    [class*="ContentItem"] {\n        width: var(--tab-content-width);\n    }\n\n    .historyButton {\n        background-color: var(--color-neutral-20);\n        border: none;\n        color: var(--color-neutral-70);\n        border-radius: 0;\n        width: 100%;\n        text-align-last: left;\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        padding: var(--spacing-small) calc(var(--spacing-small) * 2);\n\n        &:hover {\n            color: var(--color-white);\n        }\n    }\n'),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILBaseTabs"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILControl(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILControl",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;var _onChange=()=>{};_this.element.attr("data-type","UILControl"),_this.element.div._this=_this;let _onFinishChange=()=>{};function isEqual(a,b){return Array.isArray(a)||Array.isArray(b)?a+""==b+"":"object"==typeof a||"object"==typeof b?JSON.stringify(a)===JSON.stringify(b):a===b}function clone(value){return Array.isArray(value)?[...value]:null===value?"":"object"==typeof value?Object.assign({},value):value}_this.element.goob("\n    & {\n        padding: calc(var(--spacing) / 2) var(--spacing);\n        width: 100%;\n    }\n"),_this.init=(id,opts={})=>{_this.id=id,_this.opts=opts,_this.setValue(clone(opts.value)),_this.previous=clone(_this.value),_this.value&&_this.set("value",_this.value),_this.setLabel(opts.label||id),_this.element.attr("data-id",id)},_this.finish=(history=!0)=>{_onFinishChange(_this.value),isEqual(_this.value,_this.previous)||(history&&UILHistory.set(_this,_this.previous),UILLocalStorage.set(_this.id,_this.value),UILStorage.set(_this.id,_this.value),_this.previous=clone(_this.value))},_this.force=value=>{_this.setValue(clone(value)),_this.finish(!1)},_this.debounce=(callback,time=250)=>{let interval;return(...args)=>{clearTimeout(interval),interval=setTimeout(()=>{interval=null,callback(...args)},time)}},_this.onChange=cb=>(_onChange=cb,_this),_this.onFinishChange=cb=>(_onFinishChange=cb,_this),_this.getValue=function(){return _this.value},_this.setValue=value=>{isEqual(value,_this.value)||(_this.value=clone(value),_this.update&&_this.update(_this.value),"function"==typeof _onChange&&_onChange(_this.value))},_this.getView=function(){return _this.view},_this.setView=view=>{_this.view&&_this.view.destroy(),_this.view=view,_this.content.add(_this.view)},_this.hide=function(){return _this.visible=!1,_this.element.css({display:"none"}),_this},_this.show=function(){return _this.visible=!0,_this.element.css({display:"inline-block"}),_this},_this.isVisible=function(){return _this.visible},_this.setLabel=label=>{_this.label=label,_this.state.set("label",label)},_this.setDescription=function(desc){console.log("description: "+desc),_this.label.attr("title",desc)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILControl"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()},_=>{UILControl.infoIcon='<span><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9 9a3 3 0 016 1c0 2-3 3-3 3M12 17h0"/></svg></span>'}),Class(function UILControlButton(_params,...restArgs){const _this=this;Inherit(_this,UILControl),Inherit(_this,XComponent),_this.fragName="UILControlButton",_this.contexts="UILControl",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"form-group",_type:"div",refName:"unnamed",children:[{htmlFor:"$state.groupId",_type:"label",_innerText:"$state.label",refName:"componentLabel",children:[]},{id:"$state.groupId",className:"content",_type:"div",refName:"unnamed",children:[{view:"UILInputButton",data:"$data",_type:"ViewState",refName:"unnamed",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.params=Object.assign({},{id:_this.params},{options:restArgs[0]}),_this.state.set("id",_this.params.id),_this.state.set("groupId",`${_this.params.id}-group`),_this.data=new StateArray(_this.params.options.actions),_this.init(_this.params.id,_this.params.options),_this.params.options.hideLabel&&(_this.element.classList().add("hide-label"),_this.componentLabel.classList().add("visibility-hidden")),_this.setTitle=title=>{_this.data.forEach(button=>{button.title=title})},_this.element.goob("\n    .button {\n        width: 100%;\n    }\n\n    &.hide-label {\n        .form-group,\n        .content {\n            width: 100%;\n            max-width: 100% !important;\n        }\n\n    }\n    \n    .UILInputButton + .UILInputButton {\n        margin-top: 2px;\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILControlButton"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILControlCheckbox(_params,...restArgs){const _this=this;Inherit(_this,UILControl),Inherit(_this,XComponent),_this.fragName="UILControlCheckbox",_this.contexts="UILControl",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"form-group",_type:"div",refName:"unnamed",children:[{id:"$state.labelId",className:"label",_type:"div",_innerText:"$state.label",refName:"unnamed",children:[]},{className:"checkbox",_type:"div",refName:"unnamed",children:[{type:"checkbox",id:"$state.id",ariaLabelledBy:"$state.labelId",checked:"$state.isChecked",_type:"input",refName:"checkboxInput",children:[]},{htmlFor:"$state.id",_type:"label",_innerText:"$state.label",refName:"checkboxLabel",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function handleChecked(isChecked){_this.checkboxInput.div.checked=isChecked,isChecked?_this.checkboxInput.div.setAttribute("checked",_this.value):_this.checkboxInput.div.removeAttribute("checked")}function handleClick(){_this.value=!_this.value,_this.state.set("isChecked",_this.value),_this.finish()}_this.params=Object.assign({},{id:_this.params},{options:restArgs[0]}),_this.state.set("id",_this.params.id),_this.init(_this.params.id,_this.params.options),function initListeners(){_this.checkboxInput.click(handleClick)}(),_this.onInit=()=>{_this.state.set("labelId",`${_this.id}-label`),_this.state.set("isChecked",_this.params.options?.value),_this.state.bind("isChecked",handleChecked)},_this.element.goob("\n    & {\n        width: 50%;\n        \n        > .label, .content {\n            display: none;\n        }\n    }\n\n    .form-group > *:last-child {\n        width: auto;\n    }\n\n    .UILControlCheckbox:nth-of-type(even) {\n        padding-left: calc(var(--spacing-small) / 2);\n    }\n\n    .UILControlCheckbox:nth-of-type(odd) {\n        padding-right: calc(var(--spacing-small) / 2);\n    }\n\n\n"),_this.update=()=>{_this.state.set("isChecked",_this.value)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILControlCheckbox"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILControlColor(_params,...restArgs){const _this=this;Inherit(_this,UILControl),Inherit(_this,XComponent),_this.fragName="UILControlColor",_this.contexts="UILControl",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"form-group UIL",_type:"div",refName:"unnamed",children:[{_type:"label",_innerText:"$state.label",refName:"unnamed",children:[]},{className:"color-input",_type:"div",refName:"unnamed",children:[{className:"color-selector",_type:"div",refName:"unnamed",children:[{_type:"label",refName:"unnamed",children:[{className:"color-chip",_type:"div",refName:"colorChip",children:[]}]},{className:"color-text no-style",type:"text",_type:"input",refName:"textInput",children:[]},{id:"color",name:"color",type:"color",className:"color-box hidden",_type:"input",refName:"colorInput",children:[]}]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function onColorInput(){_this.state.set("value",_this.colorInput.div.value),Utils.debounce(_this.finish,200)}function onTextInput(){_this.state.set("value",_this.textInput.div.value),Utils.debounce(_this.finish,200)}function onTextClick(){_this.textInput.div.focus(),_this.textInput.div.select()}function finishChange(){_this.finish()}_this.params=Object.assign({},{id:_this.params},{options:restArgs[0]}),_this.state.set("id",_this.params.id),_this.state.set("value",_this.params.options.value),_this.state.bind("value",_this.textInput),_this.bindState(_this.state,"value",function handleColorState(color){_this.setValue(_this.state.value),function updateUI(){_this.colorChip.div.style.backgroundColor=_this.state.get("value"),_this.colorInput.div.value=_this.state.get("value")}()}),_this.colorInput.div.value=_this.params.options.value,_this.init(_this.params.id,_this.params.options),function initListeners(){_this.colorInput.div.addEventListener("input",onColorInput,!1),_this.colorInput.div.addEventListener("blur",finishChange,!1),_this.textInput.div.addEventListener("input",onTextInput,!1),_this.textInput.div.addEventListener("click",onTextClick,!1),_this.textInput.div.addEventListener("blur",finishChange,!1)}(),_this.update=function(){_this.state.set("value",_this.value)},_this.onDestroy=function(){_this.colorInput.div.removeEventListener("input",onInput,!1),_this.colorInput.div.removeEventListener("blur",finishChange,!1)},_this.element.goob("\n    & {}\n\n    #color {\n        cursor: pointer;\n    }\n\n    .color-box {\n        max-width: 35px;\n    }\n\n    .color-text {\n        -webkit-appearance: none;\n                appearance: none;\n        margin: 0;\n        border: 0;\n        outline: 0;\n        font: var(--label2);\n        color: var(--font-color-highlight);\n        background: transparent;\n        position: absolute;\n        width: 100%;\n        height: 100%;\n        top: 0;\n        left: 0;\n        padding: 0 0 0 37px;\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILControlColor"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILControlFile(_params,...restArgs){const _this=this;Inherit(_this,UILControl),Inherit(_this,XComponent),_this.fragName="UILControlFile",_this.contexts="UILControl",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"form-group",_type:"div",refName:"unnamed",children:[{id:"$state.id",_type:"label",_innerText:"$state.label",refName:"unnamed",children:[]},{type:"text",id:"geometry-text-input",ariaLabelledBy:"$state.id",placeholder:"$state.placeholder",_type:"input",refName:"inputText",children:[]}]},{className:"wrapper",_type:"div",refName:"unnamed",children:[{className:"preview",_type:"div",refName:"unnamed",children:[{type:"file",id:"imageFile",multiple:!0,accept:"file/*",_type:"input",refName:"picker",children:[]},{className:"copy",_type:"div",_innerText:"Drag and drop your file here",refName:"unnamed",children:[]}]},{className:"controls",_type:"div",refName:"unnamed",children:[{_type:"button",_innerText:"Browse Assets",refName:"browseButton",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.params=Object.assign({},{id:_this.params},{options:restArgs[0]}),_this.state.set("id",_this.params.id),_this.state.set("inputFileId",_this.params.id+"-inputFile"),_this.state.set("inputTextId",_this.params.id+"-inputText"),_this.state.set("placeholder",_this.params.options.relative);const ogValues={src:_this.params.options.src||"",relative:_this.params.options.relative||"",prefix:_this.params.options.prefix||"",filename:_this.params.options.filename||""};async function openAssetsExplorer(){UIL.assetsExplorer.open(onSelectExternalAsset,1)}async function onSelectExternalAsset(id){const asset=await UILRemote.getAsset(id);_this.inputText.div.value=asset.name,_this.value={filename:asset.name,prefix:asset.url.split("/").slice(0,-1).join("/"),relative:"",src:asset.url,prefix:""},_this.finish()}async function change(){let file=_this.picker.div.files[0];if(!file)return;const asset=await UILStorage.uploadAsset(file);_this.value={filename:asset.name,prefix:asset.url.split("/").slice(0,-1).join("/"),relative:"",src:asset.url},_this.finish()}async function inputTextChange(event){event.target.value&&_this.inputText.val().includes(["World","SceneLayout","assets/"])&&(_this.value={src:_this.inputText.val(),relative:_this.inputText.val(),prefix:"",filename:_this.inputText.val()},_this.finish())}_this.value=Object.assign({},ogValues),_this.browseButton.classList().add("small"),_this.init(_this.params.id,_this.params.options),function initListeners(){_this.browseButton.click(openAssetsExplorer),_this.picker.div.addEventListener("change",change,!1),_this.inputText.div.addEventListener("change",inputTextChange)}(),_this.onInit=()=>{_this.value&&_this.value.src&&(_this.state.set("hasFile",!0),_this.state.set("fileUrl",_this.value.src),_this.inputText.div.value=_this.value.filename)},_this.force=function(value,isClipboard){_this.picker.div.value=""},_this.onDestroy=function(){_this.picker.div.removeEventListener("change",change,!1)},_this.element.goob("\n    & {\n        padding: var(--spacing);\n        padding-bottom: 0;\n        margin-bottom: var(--spacing-small);\n    }\n    \n    .wrapper {\n        border-bottom: 1px solid var(--color-neutral-40);\n        display: flex;\n        gap: var(--spacing);\n        justify-content: space-between;\n        padding: calc(var(--spacing) * 1.5) 0;\n    }\n\n    .controls {\n        display: flex;\n        flex-direction: column;\n        gap: var(--spacing-small);\n    }\n\n    .copy {\n        font: var(--label2);\n        padding: var(--spacing-small);\n        text-align: center;\n        pointer-events: none;\n    }\n    \n    .preview {\n        color: var(--color-neutral-80);\n        border: 1px solid var(--color-neutral-40);\n        border-radius: calc(var(--border-radius) / 2);\n        box-sizing: border-box;\n        position: relative;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        flex: 1;\n        flex-shrink: 0;\n        overflow: hidden;\n        transition-property: border-color, color;\n        transition-duration: var(--duration);\n        transition-timing-function: var(--timing);\n\n        &:hover {\n            border-color: var(--color-action);\n            color: var(--color-action-contrast);\n        }\n    }\n\n    .picker {\n        position: absolute;\n        opacity: 0;\n        inset: 0px;\n\n        &:hover {\n            cursor: pointer;\n        }\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILControlFile"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILControlImage(_params,...restArgs){const _this=this;Inherit(_this,UILControl),Inherit(_this,XComponent),_this.fragName="UILControlImage",_this.contexts="UILControl",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"form-group",_type:"div",refName:"unnamed",children:[{htmlFor:"image",_type:"label",_innerText:"$state.label",refName:"unnamed",children:[]},{type:"text",className:"path",_type:"input",refName:"input",children:[]}]},{className:"wrapper",_type:"div",refName:"unnamed",children:[{className:"upload-message",_type:"div",refName:"uploadMessage",children:[]},{className:"preview",_type:"div",refName:"unnamed",children:[{_type:"div",refName:"img",children:[]},{className:"picker",type:"file",id:"imageFile",multiple:!0,accept:"image/*",_type:"input",refName:"picker",children:[]},{className:"progress",_type:"div",refName:"unnamed",children:[]},{className:"delete small",_type:"button",refName:"delete",children:[{width:10,height:10,viewBox:"0 0 10 10",fill:"none",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg",_type:"svg",refName:"unnamed",children:[{"stroke-width":2,strokeLinecap:"round",d:"M2 2l6 6M2 8l6-6",_type:"path",refName:"unnamed",children:[]}]}]},{className:"copy",_type:"div",_innerText:"Drag and drop your file here",refName:"unnamed",children:[]}]},{className:"preview-controls",_type:"div",refName:"unnamed",children:[{className:"control-button small",_type:"button",_innerText:"Browse Assets",refName:"browseButton",children:[]},{className:"control-button small",_type:"button",_innerText:"Compress",refName:"compress",children:[]},{className:"checkbox-control",htmlFor:"$state.compressedInput",_type:"label",refName:"unnamed",children:[{className:"regular-checkbox",type:"checkbox",name:"$state.compressedInput",id:"$state.compressedInput",_type:"input",refName:"check",children:[]},{_type:"span",_innerText:"Use Compressed",refName:"unnamed",children:[]}]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;async function remoteFileSelected(id){const asset=await UILRemote.getAsset(id),v={compressed:!1,filename:asset.name,prefix:asset.url.split("/").slice(0,-1).join("/"),relative:"",src:asset.url};_this.force(v,!0),_this.finish()}function textureUpdate(e){e.file?.split("?")[0]==_this.value.src&&_this.img.css({backgroundImage:`url(${e.file.split("-compress")[0]})`})}async function compressKtx2(){let result,options,output,src,path=_this.value.src.split("?")[0];if(_this.params.options.compressOptions?.cube)_this.compress.bg("#fdb460").html("Cubemap"),[output,src]=function parseCubePaths(path){let info=Utils3D.splitCubemapPath(path),src=Utils3D.getCubemapFacePaths(info);return[`${info.prefix}.ktx2`,src]}(path),options=["--genmipmap","--encode","etc1s","--cubemap"];else{let noext=function removeImageExtension(filename){const lastDotIndex=filename.lastIndexOf(".");return-1!==lastDotIndex?filename.substring(0,lastDotIndex):filename}(path.split("/").last());options=["--genmipmap","--encode","etc1s"],output=`${function getFolderPath(url){return(url=url.split("/")).last().includes(".")&&url.pop(),url.join("/")}(path)}/${noext}.ktx2`,src=[path]}let params={options:options,src:src},isLocal=!/^https?:\/\//.test(src);if(isLocal&&(params.output=output),result=await Dev.execUILScript("compressktx2",params),"Error"!==result&&!isLocal){if(!result.output.startsWith("data:image/ktx2;base64,"))return!1;let blob=await(await fetch(result.output)).blob();blob.name=output.split("/").last();await UILStorage.uploadAsset(blob);return!0}}async function compressClick(){if(!_this.value.src||_this.flag("compressPending"))return;_this.flag("compressPending",!0),_this.compress.bg("#f4ee42").text("---");let success=!1;try{success=await compressKtx2()}catch(e){console.error(e)}success?_this.compress.bg("#46f441").html("Success"):_this.compress.bg("#f44141").html("Failed"),_this.flag("compressPending",!1),_this.finish()}async function checkChange(){let compressed=!!_this.check.div.checked&&"ktx2";_this.value.compressed=compressed,_this.value.useCompressed=!!compressed,_this.finish()}async function change(e){let file=e.dataTransfer?.files[0]||_this.picker.div.files[0];if(!file)return;if(Utils.query("noRemote")){let name=file.name;_this.value.filename=name,_this.value.relative=function getRelative(){return _this.value.filename.includes("http")?"":_this.value.relative.includes(_this.value.prefix)?_this.value.relative.replace(`${_this.value.prefix}`,""):_this.value.relative}(),_this.value.src=function getSrc(){return _this.value.filename.includes("http")?_this.value.filename:`${_this.value.prefix?_this.value.prefix+"/":""}${_this.value.relative?_this.value.relative+"/":""}${_this.value.filename}`}(),_this.value.compressed=!!_this.check.div.checked,_this.value.useCompressed=_this.value.compressed,_this.value.prefix="assets/images/";let compressed=!!_this.check.div.checked&&"ktx2";return _this.value.compressed=compressed,_this.value.useCompressed=!!compressed,void(await function imageExists(url){return!!url.includes("http")||(url=Assets.getPath(url),fetch(url).then(e=>404!=e.status).catch(e=>console.warn("UILControlImage image url validation failed",e)))}(_this.value.src)?(_this.value=Object.assign({},_this.value),_this.picker.div.value="",_this.picker.attr("title",_this.value.src),_this.img.css({backgroundImage:`url(${Assets.getPath(_this.value.src)})`}),_this.delete.show(),_this.finish()):(_this.picker.div.value="",console.warn("UIL: Could not find image",_this.value),alert(`"${_this.value.src}" not found!\nMake sure "relative path" is correct.`)))}_this.uploadMessage.text("Uploading file(s) to remote"),_this.uploadMessage.classList().add("active");const asset=await UILStorage.uploadAsset(file);asset?_this.uploadMessage.text("Success! Uploaded file to remote ",asset):_this.uploadMessage.text("Failed to upload file to remote ",asset),_this.delayedCall(_=>{_this.uploadMessage.classList().remove("active")},4e3),_this.value.compressed=!1,_this.value.filename=asset.name,_this.value.prefix=asset.url.split("/").slice(0,-1).join("/"),_this.value.relative="",_this.value.src=asset.url,_this.picker.div.value="",_this.picker.attr("title",_this.value.src),_this.img.css({backgroundImage:`url(${_this.value.src})`}),_this.delete.show(),_this.finish()}function deleteImage(){_this.value={src:"",relative:"",prefix:"assets/images",filename:"",useCompressed:!1},_this.input.div.value="",_this.picker.div.value="",_this.picker.attr("title",null),_this.img.css({backgroundImage:""}),_this.delete.hide(),_this.value=Object.assign({},_this.value),_this.finish()}async function openAssetsExplorer(){UIL.assetsExplorer.open(remoteFileSelected)}function inputChange(){_this.value.relative=_this.input.div.value,_this.input.val().includes(["assets/"])&&(_this.value={src:_this.input.val(),relative:_this.input.val(),prefix:"",filename:_this.input.val()},_this.finish())}_this.params=Object.assign({},{id:_this.params},{options:restArgs[0]}),_this.state.set("id",_this.params.id),_this.state.set("compressedInput",`${_this.params.id}-compressed`),_this.params.options.value=Object.assign({src:"",relative:_this.params.options.relative||"",prefix:_this.params.options.prefix,filename:"",useCompressed:!1},_this.params.options.value),_this.value=Object.assign({},_this.params.options.value),_this.init(_this.params.id,_this.params.options),_this.check.div.checked=_this.params.options.value.useCompressed,_this.value.relative?_this.input.div.value=_this.value.relative:_this.input.attr("placeholder","Relative Path"),_this.delete.hide(),_this.value.src&&_this.img.css({backgroundImage:`url('${Assets.getPath(_this.value.src)}')`}),function initListeners(){_this.picker.div.addEventListener("change",change,!1),_this.input.div.addEventListener("change",inputChange,!1),_this.delete.div.onclick=deleteImage,_this.compress.div.onclick=compressClick,_this.check.div.onchange=checkChange,_this.browseButton.click(openAssetsExplorer),_this.events.sub(ShaderUIL.TEXTURE_UPDATE,textureUpdate)}(),_this.force=async function(value,isClipboard){_this.value=Object.assign({},value),_this.input.div.value=_this.value.filename,_this.picker.div.value="",_this.picker.attr("title",_this.value.src),_this.img.css({backgroundImage:`url('${Assets.getPath(_this.value.src)}')`}),_this.check.div.checked=_this.value.compressed;let compressed=!!_this.check.div.checked&&"ktx2";_this.value.compressed=compressed,_this.value.useCompressed=!!compressed,_this.delete.show()},_this.onDestroy=function(){_this.picker.div.removeEventListener("change",change,!1),_this.input.div.removeEventListener("change",inputChange,!1)},_this.element.goob("\n    & {}\n\n    .form-group {\n        margin-bottom: var(--spacing-small);\n    }\n\n    .picker {\n        &:focus {\n            .img {\n                border-color: var(--color-accent-80);\n            }\n        }\n    }\n\n    .wrapper {\n        display: flex;\n        gap: var(--spacing-small);\n    }\n\n    .upload-message {\n        position: absolute;\n        padding: 12px;\n        max-width: 54%;\n        text-align: center;\n        background: black;\n        margin-top: 34px;\n        opacity: 0;\n        transition: opacity 200ms ease-out;\n        z-index: 1;\n\n        &.active {\n            opacity: 1;\n        }\n    }\n\n    .preview {\n        width: 160px;\n        height: 128px;\n        box-sizing: border-box;\n        position: relative;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        overflow: hidden;\n        flex-shrink: 0;\n\n        &:has(.img[style*='url']) {\n            &:hover {\n                .delete {\n                    opacity: 1;\n                }\n            }\n        }\n    }\n\n    .img {\n        width: 100%;\n        height: 100%;\n        position: absolute;\n        inset: 0px;\n        background-size: cover;\n        background-repeat: no-repeat;\n        background-position: center center;\n        border: 1px dotted var(--color-neutral-40);\n        text-align: center;\n    }\n\n    .picker {\n        position: absolute;\n        opacity: 0;\n        inset: 0px;\n    }\n\n    .progress {\n        position: absolute;\n        bottom: 0px;\n        height: 10px;\n        left: 0px;\n        background: rgb(155, 156, 155);\n    }\n\n    .copy {\n        color: var(--color-neutral-80);\n        font: var(--label2);\n        padding: var(--spacing-small);\n        text-align: center;\n    }\n\n    .control-button {\n        margin-bottom: calc(var(--spacing-small) / 2);\n        width: 100%;\n    }\n\n    .delete {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        width: 22px;\n        height: 22px;\n        padding: 0 !important;\n        position: absolute;\n        top: var(--spacing);\n        right: var(--spacing);\n        z-index: 100;\n        opacity: 0;\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILControlImage"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()},_=>{UILControlImage.AUDIT="UILControlImage_audit"}),Class(function UILControlNumber(_params,...restArgs){const _this=this;Inherit(_this,UILControl),Inherit(_this,XComponent),_this.fragName="UILControlNumber",_this.contexts="UILControl",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"form-group",_type:"div",refName:"unnamed",children:[{id:"$state.labelId",_type:"label",_innerText:"$state.label",refName:"unnamed",children:[]},{view:"UILInputNumber",data:"$data",_type:"ViewState",refName:"unnamed",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.params=Object.assign({},{id:_this.params},{options:restArgs[0]}),_this.state.set("id",_this.params.id),_this.state.set("labelId",`${_this.params.id}-label`),_this.data=Data.request(`vectorInputData-${_this.params.id}`,()=>[{id:_this.params.id,value:_this.params.options.value||0,labelledBy:_this.state.labelId,min:_this.params.options.min||-1/0,max:_this.params.options.max||1/0,step:_this.params.options.step||1,precision:_this.params.options.precision||3,onInputCB:value=>function onInput(value){_this.setValue(Number(value)),_this.data[value]=value}(value),onFinishCB:()=>function onFinish(){_this.finish()}()}]),_this.init(_this.params.id,_this.params.options),_this.update=function(){_this.data.forEach(input=>{input.value=_this.value})},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILControlNumber"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILControlRange(_params,...restArgs){const _this=this;Inherit(_this,UILControl),Inherit(_this,XComponent),_this.fragName="UILControlRange",_this.contexts="UILControl",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"form-group",_type:"div",refName:"unnamed",children:[{htmlFor:"$state.id",_type:"label",_innerText:"$state.label",refName:"unnamed",children:[]},{type:"range",id:"$state.id",min:"$props.min",max:"$props.max",step:"$props.step",_type:"input",refName:"slider",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function change(){_this.finish()}function input(){_this.value=Number(_this.slider.div.value)}_this.props={min:0,max:100,step:1},_this.params=Object.assign({},{id:_this.params},{options:restArgs[0]}),_this.state.set("id",_this.params.id),Object.assign(_this.props,_this.params.options),_this.init(_this.params.id,_this.params.options),_this.slider.div.value=_this.params.options.value||"",function initListeners(){_this.slider.div.addEventListener("change",change,!1),_this.slider.div.addEventListener("input",input,!1)}(),_this.force=function(value){_this.value=value,_this.slider.div.value=value,_this.finish(!1)},_this.onDestroy=function(){_this.slider.div.removeEventListener("change",change,!1),_this.slider.div.removeEventListener("input",input,!1)},_this.element.goob("\n    & {}\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILControlRange"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILControlSelect(_params,...restArgs){const _this=this;Inherit(_this,UILControl),Inherit(_this,XComponent),_this.fragName="UILControlSelect",_this.contexts="UILControl",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"form-group",_type:"div",refName:"unnamed",children:[{htmlFor:"$state.id",_type:"label",_innerText:"$state.label",refName:"selectLabel",children:[]},{className:"select-wrapper",_type:"div",refName:"unnamed",children:[{id:"$state.id",_type:"select",refName:"select",children:[]},{className:"arrow",_type:"div",_innerText:"  ",refName:"unnamed",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;if(_this.params=Object.assign({},{id:_this.params},{options:restArgs[0]}),_this.state.set("id",_this.params.id),!_this.params.options.options)throw"UILControlSelect is missing select options";function change(){_this.finish()}function input(){let i=_this.select.div.selectedIndex;_this.value=_this.selectOptions[i].value}_this.params.options.value=_this.params.options.value||_this.params.options.options[0].value,function initOptions(){_this.selectOptions=_this.params.options.options.map(({value:value,label:label})=>{const el=document.createElement("option");return el.setAttribute("value",value),_this.value===value&&el.setAttribute("selected",!0),el.text=label||value,el.value=value,_this.select.add(el),el})}(),function initListeners(){_this.select.div.addEventListener("change",change,!1),_this.select.div.addEventListener("input",input,!1)}(),_this.init(_this.params.id,_this.params.options),_this.select.div.value=_this.params.options.value,_this.force=function(value){_this.select.div.value=value,_this.value=value},_this.onDestroy=function(){_this.select.div.removeEventListener("change",change,!1),_this.select.div.removeEventListener("input",input,!1)},_this.element.goob("\n    .select-wrapper {\n        position: relative;\n    }\n\n    .arrow {\n        color: var(--color-neutral-70);\n        font-size: 7px;\n        position: absolute;\n        right: var(--spacing-small);\n        top: 15px;\n        pointer-events: none;\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILControlSelect"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILControlText(_params,...restArgs){const _this=this;Inherit(_this,UILControl),Inherit(_this,XComponent),_this.fragName="UILControlText",_this.contexts="UILControl",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"form-group",_type:"div",refName:"unnamed",children:[{htmlFor:"$state.id",_type:"label",_innerText:"$state.label",refName:"textInputLabel",children:[]},{type:"text",id:"$state.id",_type:"input",refName:"textInput",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function onChange(){clearTimeout(_this.timeout),_this.timeout=setTimeout(onFinishChange,400),_this.value=_this.textInput.div.value}function onFinishChange(){null!==_this.timeout&&(clearTimeout(_this.timeout),_this.timeout=null,_this.finish())}_this.params=Object.assign({},{id:_this.params},{options:restArgs[0]}),_this.state.set("id",_this.params.id),function initListeners(){_this.textInput.div.addEventListener("input",onChange,!1),_this.textInput.div.addEventListener("change",onFinishChange,!1)}(),_this.init(_this.params.id,_this.params.options),_this.textInput.div.value=_this.params.options.value||"",_this.update=function(){_this.textInput.div.value=_this.value||""},_this.onDestroy=function(){_this.textInput.div.removeEventListener("input",onChange,!1),_this.textInput.div.removeEventListener("change",onBlur,!1)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILControlText"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILControlTextarea(_params,...restArgs){const _this=this;Inherit(_this,UILControl),Inherit(_this,XComponent),_this.fragName="UILControlTextarea",_this.contexts="UILControl",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"form-group",_type:"div",refName:"unnamed",children:[{htmlFor:"$state.id",title:"$state.label",_type:"label",_innerText:"$state.label",refName:"unnamed",children:[]},{type:"text",id:"$state.id",maxLength:"$props.max",minLength:"$props.min",rows:"$props.rows",readOnly:"$props.readonly",_type:"textarea",refName:"textareaInput",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let _timeout,onInit=_this.onInit;function onChange(){clearTimeout(_timeout),_timeout=setTimeout(onFinishChange,400),_this.value=_this.textareaInput.div.value}function onFinishChange(){null!==_timeout&&(clearTimeout(_timeout),_timeout=null,_this.finish())}_this.props={max:1/0,min:-1/0,rows:2,readonly:!1},_this.params=Object.assign({},{id:_this.params},{options:restArgs[0]}),_this.state.set("id",_this.params.id),Object.assign(_this.props,_this.params.options),_this.init(_this.params.id,_this.params.options),_this.textareaInput.div.value=_this.params.options.value||"",function initListeners(){_this.textareaInput.div.addEventListener("input",onChange,!1),_this.textareaInput.div.addEventListener("change",onFinishChange,!1)}(),_this.update=function(){_this.textareaInput.div.value=_this.value||""},_this.onDestroy=function(){_this.textareaInput.div.removeEventListener("input",onChange,!1),_this.textareaInput.div.removeEventListener("change",onFinishChange,!1)},_this.element.goob("\n    .textareaInput {\n        font-family: Consolas, monaco, monospace;\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILControlTextarea"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILControlVector(_params,...restArgs){const _this=this;Inherit(_this,UILControl),Inherit(_this,XComponent),_this.fragName="UILControlVector",_this.contexts="UILControl",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"form-group",_type:"div",refName:"unnamed",children:[{id:"$state.labelId",_type:"label",_innerText:"$state.label",refName:"unnamed",children:[]},{className:"number-inputs",_type:"div",refName:"unnamed",children:[{view:"UILInputNumber",data:"$inputData",_type:"ViewState",refName:"unnamed",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;if(_this.params=Object.assign({},{id:_this.params},{options:restArgs[0]}),_this.state.set("id",_this.params.id),_this.state.set("labelId",`${_this.params.id}-label`),_this.inputData=await Data.request(`vectorInputData-${_this.params.id}`,()=>_this.params.options.value.map((value,index)=>({value:value||0,labelledBy:_this.state.labelId,min:_this.params.options.min||-1/0,max:_this.params.options.max||1/0,step:_this.params.options.step||1,precision:_this.params.options.precision||3,onInputCB:(v,m)=>function onInput(value,index,master){master?_this.vector=_this.vector.map(v=>value):_this.vector[index]=value;_this.setValue([..._this.vector]),_this.inputData.forEach((input,idx)=>{input.value=_this.vector[idx]})}(v,index,m),onFinishCB:()=>function onFinish(){_this.finish()}(),index:index}))),_this.vector=[],_this.params.options.value)_this.length=_this.vector.length;else{if(!_this.params.options.components)throw'UILControlVector: Cannot detect vector type. Define "options.components" count or init with a initial value';_this.params.options.value=new Array(_this.params.options.components).fill(0)}_this.length=_this.params.options.value.length,_this.init(_this.params.id,_this.params.options),_this.vector=[..._this.value],_this.update=function(){_this.inputData.forEach((input,index)=>{input.value=_this.value[index]})},_this.element.goob("\n    .number-inputs {\n        display: flex;\n        gap: calc(var(--spacing-small) / 2);\n    }\n"),_this.force=function(value,history=!1){_this.vector=[...value],_this.setValue([..._this.vector]),_this.inputData.forEach((input,index)=>input.value=_this.value[index]),_this.finish(history)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILControlVector"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILFolder(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILFolder",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"a",refName:"header",children:[{htmlFor:"$state.label",_type:"label",_innerText:"$state.label",refName:"unnamed",children:[]},{_type:"div",_innerText:"",refName:"drag",children:[]}]},{_type:"div",refName:"container",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.params.options||(_this.params=Object.assign({},{id:_this.params},{options:restArgs[0]}));let _children={},_open=!_this.params.options.closed,_visible=!0,_order=[],_draggable=!1,_sortableChildren=!1,_headerDrag=!1,_hasClipboard=!1;_this.params.id;function removeDragHandlers(){_this.element.div.removeEventListener("dragstart",dragStart,!1),_this.element.div.removeEventListener("dragover",dragOver,!1),_this.element.div.removeEventListener("drop",drop,!1)}function onToggle(event){_this.state.open?_this.close():_this.open(),_this.state.open?_this.header.div.focus():_this.header.div.blur()}function onMouseDown(event){_headerDrag=!0,_this.header.div.addEventListener("mouseup",onMouseUp)}function onMouseUp(event){_headerDrag=!1,_this.header.div.removeEventListener("mouseup",onMouseUp)}function onKeydown(event){event.preventDefault(),13===event.which&&(_open?close():open())}function onKeyup(event){event.preventDefault(),_hasClipboard&&("c"==event.key&&event.metaKey?function onCopy(){UILClipboard.copy(_children)}():"v"==event.key&&event.metaKey&&function onPaste(){UILClipboard.paste(_children)}())}function onFocus(){_this.element.div.classList.add("active"),_hasClipboard=!0}function onBlur(){_this.element.div.classList.remove("active"),_hasClipboard=!1}function matchItem(str,item){return UILFuzzySearch.search(str,item.id.toLowerCase())||UILFuzzySearch.search(str,item.label.toLowerCase())}function dragStart(e){if(!UILFolder.DragLock){if(!_headerDrag)return e.preventDefault(),void e.stopPropagation();UILFolder.DragLock=_this.state.id,e.dataTransfer.setData("text/plain",_this.state.id),e.dataTransfer.effectAllowed="move",_this.element.css({opacity:.5})}}function dragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function drop(e){if(!UILFolder.DragLock)return;if(e.dataTransfer.items)for(var i=0;i<e.dataTransfer.items.length;i++)if("file"===e.dataTransfer.items[i].kind)return;e.preventDefault(),_headerDrag=!1;let target=e.currentTarget._this,dragging=_this.parent.getChildById(UILFolder.DragLock);UILFolder.DragLock=null,target&&target.parent&&dragging&&(dragging.element.css({opacity:1}),dragging.parent.getChildById(target.id)&&(e.stopPropagation(),target.parent.container.div.insertBefore(dragging.element.div,target.element.div),_order=[...target.parent.container.div.childNodes].map(el=>el._this.id),_this.events.fire(UIL.REORDER,{order:[..._order]}),function saveSort(){UILStorage.set(`UIL_${UIL.sortKey}_${_this.parent.id}_order`,JSON.stringify(_order))}()))}function getUrlID(){return`${Global.PLAYGROUND||"Global"}_folder_${_this.state.id}`}function saveFolderState(){sessionStorage.setItem(getUrlID(),JSON.stringify({open:_this.state.open}))}_this.id=_this.params.id,_this.label=String(_this.params.options.label||_this.params.id),_this.level=-1,_this.createState(),_this.state.set("id",_this.params.id),_this.state.set("label",_this.params.options.label||_this.params.id),_this.state.set("open",!_this.params.options.closed),_this.params.options.hideTitle&&_this.header.classList().add("hide-title"),_this.element.css({maxHeight:_this.params.options.maxHeight||"none"}),_this.element.attr("data-id",_this.params.id),_this.element.attr("data-type","UILFolder"),_this.element.div._this=_this,_this.onInit=()=>{!function restoreFolderState(){let json=JSON.parse(sessionStorage.getItem(getUrlID()));json?json.open?_this.open():_this.close():_this.open()}()},_this.onMounted=()=>{_this.flag("isReady",!0)},_this.ready=_=>_this.wait("isReady"),function initListeners(){_this.header.div.addEventListener("keydown",onKeydown,!1),_this.header.div.addEventListener("click",onToggle,!1),_this.header.div.addEventListener("mousedown",onMouseDown),_this.header.div.addEventListener("focus",onFocus,!1),_this.header.div.addEventListener("blur",onBlur,!1),_this.header.div.addEventListener("keydown",onKeyup,!1)}(),_this.add=async function(child){return await _this.wait(()=>_this.ready),await defer(),child.draggable&&child.draggable(_sortableChildren),child.parent=_this,_children[child.id]=child,_this.container.add(child),_this},_this.remove=function(x){},_this.getChildrenControlIds=function(node_id){const folder=_children[node_id];if(!folder)return[];const childControlFirebaseKeys=[];return folder.forEachControl(child=>{childControlFirebaseKeys.push(child.id)}),childControlFirebaseKeys},_this.getChildById=function(id){return _children[id]},_this.getAll=function(){return _children},_this.getVisible=function(){return Object.values(_children).filter(x=>x.isVisible())},_this.find=function(id){return id===_this.id?_this:Object.values(_children).reduce((acc,item)=>item.id===id?acc.concat(item):item instanceof UILFolder?acc.concat(item.find(id)):acc,[])},_this.filter=function filter(str,match=!1){str=str.toLowerCase();let result=[],haystack=Object.values(_children);for(let el of haystack)if(el instanceof UILFolder){let matches=el.filter(str,!0);matches.length?(result.concat(matches),el.show(),el.open()):matchItem(str,el)?(result.push(el),el.show(),el.showChildren(),el.close()):el.getVisible().length?el.show():el.hide()}else matchItem(str,el)?(result.push(el),el.show()):el.hide();return result},_this.filterSingle=function filterSingle(str){str=str.toLowerCase();let haystack=Object.values(_children);for(let el of haystack)el instanceof UILFolder?(el.filterSingle(str),str==el.state.label.toString().toLowerCase()||str==el.state.id.toString().toLowerCase()?(el.show(),el.showChildren(),el.open(!0)):el.getVisible().length?el.show():el.hide()):matchItem(str,el)?(el.show(),el.state.open&&el.open(!0)):el.hide();return[]},_this.open=function(keepClosed=!1){if(_this.element)return _this.state.set("open",!0),_this.element.classList().add("open"),_open=!0,1!=keepClosed&&_this.forEachFolder(f=>f.close()),saveFolderState(),_this.onOpen&&_this.onOpen(),_this},_this.close=function(){_this.state.set("open",!1),_this.element.classList().remove("open"),_open=!1,saveFolderState()},_this.setLabel=function(label){_this.state.set("label",label)},_this.hide=function(){if(_this.element)return _visible=!1,_this.element.css({display:"none"}),_this},_this.show=function(){if(_this.element)return _visible=!0,_this.element.css({display:"block"}),_this},_this.showChildren=function(){return Object.values(_children).forEach(el=>el instanceof UILFolder?el.showChildren():el.show()),_this.show(),_this},_this.isOpen=function(){return _open},_this.isVisible=function(){return _visible},_this.forEachFolder=function(cb){return Object.values(_children).forEach(el=>{el instanceof UILFolder&&(cb(el),el.forEachFolder(cb))}),_this},_this.forEachControl=function(cb){return Object.values(_children).forEach(el=>{el instanceof UILFolder?el.forEachControl(cb):cb(el)}),_this},_this.enableSorting=function(key){_sortableChildren=!0,UIL.sortKey=key,Object.values(_children).forEach(el=>{el instanceof UILFolder&&el.draggable(!0)});let order=function getSort(){let sort=UILStorage.get(`UIL_${UIL.sortKey}_${_this.id}_order`);if(sort)return JSON.parse(sort)}();return order&&(_order=order,function restoreSort(){_order.forEach(id=>{_children[id]&&_this.container.add(_children[id])})}()),_this},_this.draggable=function(enable){_draggable=enable,_this.element.attr("draggable",enable),enable?(!function addDragHandlers(){_this.element.div.addEventListener("dragstart",dragStart,!1),_this.element.div.addEventListener("dragover",dragOver,!1),_this.element.div.addEventListener("drop",drop,!1)}(),_this.drag&&_this.drag.show()):(removeDragHandlers(),_this.drag&&_this.drag.hide())},_this.toClipboard=function(){UILClipboard.copy(_children)},_this.fromClipboard=function(){UILClipboard.paste(_children)},_this.eliminate=function(){_this.params.options.hideTitle||(_this.header.div.removeEventListener("keydown",onToggle,!1),_this.header.div.removeEventListener("click",onToggle,!1),_this.header.div.removeEventListener("mousedown",onMouseDown),_this.header.div.removeEventListener("focus",onFocus,!1),_this.header.div.removeEventListener("blur",onBlur,!1)),_draggable&&removeDragHandlers()},_this.forceSort=function(index){_this.parent.container.div.insertBefore(_this.element.div,_this.parent.container.div.children[index]),_order=[..._this.parent.container.div.childNodes].map(el=>el._this.state.id),_this.events.fire(UIL.REORDER,{order:[..._order]})},_this.openChildren=function(){Object.values(_children).forEach(el=>el instanceof UILFolder?el.open():null)},_this.onToggle=onToggle,UIL.addCSS(UILFolder,"\n    .UILFolder .UILFolder .UILFolder .header { \n        padding-left: calc(var(--left-padding) + var(--spacing-small)); \n    }\n    .UILFolder .UILFolder .UILFolder .header:before {\n        left: calc(var(--spacing-small) * 2);\n    }\n\n    .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .header {\n        padding-left: calc(var(--left-padding) + var(--spacing-small) * 3); \n    }\n    .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .header:before {\n        left: calc(var(--spacing-small) * 3);\n    }\n\n    .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .header {\n        padding-left: calc(var(--left-padding) + var(--spacing-small) * 4); \n    }\n    .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .header:before {\n        left: calc(var(--spacing-small) * 4);\n    }\n\n    .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .header {\n        padding-left: calc(var(--left-padding) + var(--spacing-small) * 5); \n    }\n    .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .header:before {\n        left: calc(var(--spacing-small) * 5);\n    }\n\n    .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .header {\n        padding-left: calc(var(--left-padding) + var(--spacing-small) * 6); \n    }\n    .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .header:before {\n        left: calc(var(--spacing-small) * 6);\n    }\n\n"),_this.element.goob("\n    & {\n        --left-padding: calc(var(--spacing) * 1.75);\n\n        background-color: var(--panel-background-color);\n        width: 100%;\n\n        &:has(> .header:focus) {\n            border: 1px solid var(--color-action--alt);\n        }\n        \n        &.open {\n            > .header:before {\n                transform: rotate(90deg);\n            }\n    \n            > .container {\n                display: block;\n            }\n        }\n    }\n    \n    .header {\n        border-bottom: 1px solid var(--color-divider-main);\n        color: var(--color-white);\n        display: flex;\n        font: var(--label4);\n        padding: var(--spacing-large); \n        padding-left: var(--left-padding);\n        position: relative;\n        align-items: center;\n        text-decoration: none;\n        line-height: 1;\n        user-select: none;\n\n        &:hover {\n            outline: 1px solid var(--color-action--alt);\n        }\n\n        &:before {\n            content: '';\n            display: block;\n            width: 0;\n            height: 0;\n            border-color: transparent transparent transparent var(--color-icon-default);\n            border-style: solid;\n            border-width: 3px 0 3px 4px;\n            position: absolute;\n            left: var(--spacing-small);\n            transition: transform .3s ease-out;\n        }\n\n        &.hide-title {\n            display: none;\n        }\n    }\n\n    .container {\n        display: none;\n    }\n\n    .drag {\n        position: absolute;\n        right: 7px;\n        top: 8px;\n        display: inline-block;\n        pointerEvents: none;\n    }\n"),_this.listen("UILGraphLayout/destroy",label=>{let name=label.split("-")[0];_this.label.includes(name)&&_this.element.hide()}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILFolder"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILGate(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILGate",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"UILGateLogin",refName:"login",children:[]},{_type:"UILGateError",refName:"error",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.views={login:_this.login,error:_this.error},_this.createState(),_this.bindState(_this.state,"updateView",async function updateView(newView){_this.state.currentView&&await _this.views[_this.state.currentView].animateOut();_this.views[newView].animateIn(),_this.state.set("currentView",newView)}),_this.state.set("updateView","login"),_this.animateIn=function(){_this.element.tween({opacity:1},500,"easeOutCubic")},_this.animateOut=function(){_this.element.tween({opacity:0},500,"easeOutCubic").onComplete(()=>_this.destroy())},_this.element.goob("\n    & {\n        background-color: var(--color-black);\n        position: absolute;\n        inset: 0;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        pointer-events: all;\n        opacity: 0;\n        z-index: 100001;\n    }\n\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILGate"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILGateError(_params,...restArgs){const _this=this;Inherit(_this,UILGateView),Inherit(_this,XComponent),_this.fragName="UILGateError",_this.contexts="UILGateView",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"gate",_type:"article",refName:"unnamed",children:[{className:"gate-header",_type:"header",refName:"unnamed",children:[{_type:"div",refName:"logo",children:[]},{className:"version",_type:"h1",_innerText:"UIL v2.3",refName:"unnamed",children:[]}]},{className:"gate-main",_type:"div",refName:"unnamed",children:[{className:"error",_type:"h2",_innerText:"Error",refName:"unnamed",children:[]},{_type:"p",_innerText:"You do not have access to this page",refName:"unnamed",children:[]}]},{className:"gate-footer",_type:"footer",refName:"unnamed",children:[{_type:"button",_innerText:"Go Back",refName:"backButton",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function goBack(){_this.parent.state.set("updateView","login")}!function initListeners(){_this.backButton.click(goBack)}(),_this.logo.html(UILGate.logo),_this.element.goob("\n    & {\n        --logo-size: 25px;\n\n        opacity: 0;\n    }\n\n    .gate-header {\n        gap: var(--spacing);\n        justify-self: start;\n    }\n\n    .logo {\n        width: var(--logo-size);\n        height: var(--logo-size);\n    }\n\n    .error {\n        font-size: 64px;\n        font-weight: 300;\n        line-height: 1;\n        letter-spacing: 0.2rem;\n        margin: calc(var(--spacing) * 3) 0;\n    }\n\n    .gate-main {\n        font-size: 14px;\n        margin-bottom: calc(var(--spacing) * 3);\n    }\n\n    .gate-footer {\n        justify-self: start;\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILGateError"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILGateLogin(_params,...restArgs){const _this=this;Inherit(_this,UILGateView),Inherit(_this,XComponent),_this.fragName="UILGateLogin",_this.contexts="UILGateView",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"gate",_type:"article",refName:"unnamed",children:[{className:"gate-header",_type:"header",refName:"unnamed",children:[{className:"version",_type:"h1",_innerText:"UIL v2.3",refName:"unnamed",children:[]}]},{className:"gate-main",_type:"div",refName:"logoContainer",children:[]},{className:"gate-footer",_type:"footer",refName:"unnamed",children:[{_type:"button",_innerText:"Log in with Google",refName:"loginButton",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;async function openLoginModal(){_this.loginButton.div.disabled=!0,_this.user=await UILRemote.auth.login(),_this.user.success?async function handleLogin(){await _this.animateOut(),_this.parent.animateOut(),window.location.reload()}():async function handleError(){_this.parent.state.set("updateView","error"),await _this.wait(500),_this.loginButton.div.disabled=!1}()}!function initListeners(){_this.loginButton.click(openLoginModal)}(),_this.logoContainer.html(UILGate.logo),_this.element.goob("\n    & {\n        --max-spacing: 240px;\n        --logo-size: 145px;\n        --dot-size: 4px;\n    }\n\n    .gate-header {\n        justify-content: space-between;\n        width: 100%;\n    }\n    \n    .version {\n        margin-bottom: 0;\n        position: relative;\n        width: 100%;\n\n        &:after {\n            background-color: var(--color-white);\n            content: '';\n            display: block;\n            width: var(--dot-size);\n            height: var(--dot-size);\n            border-radius: 50%;\n            position: absolute;\n            right: 0;\n            top: 3px;\n        }\n    }\n\n    .gate-main {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        width: var(--logo-size);\n    }\n\n    .loginButton:disabled {\n        cursor: not-allowed !important;\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILGateLogin"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILGateView(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILGateView",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.element.hide(),_this.animateIn=function(){_this.element.css({opacity:0}).show().tween({opacity:1},500,"easeOutCubic")},_this.animateOut=function(){return _this.element.tween({opacity:0},500,"easeOutCubic").onComplete(()=>{_this.element.hide()}).promise()},_this.element.goob("\n    & {\n        opacity: 0;\n    }\n\n    .gate {\n        display: grid;\n        justify-items: center;\n        grid-template-rows: 1fr minmax(calc(var(--logo-size) + var(--spacing) * 2), calc(var(--logo-size) + var(--max-spacing))) 1fr;\n        max-height: 100%;\n    }\n\n    .gate-header {\n        display: flex;\n        align-items: center;\n    }\n\n    .version {\n        font: var(--label3);\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILGateView"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()},_=>{UILGate.logo='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 145 146">\n        <g fill="#F7F7F7" clip-path="url(#a)">\n            <path\n                d="M72.5.703C32.46.703 0 33.162 0 73.203c0 40.04 32.46 72.5 72.5 72.5 40.041 0 72.5-32.46 72.5-72.5 0-40.041-32.459-72.5-72.5-72.5Zm0 135.146c-34.6 0-62.646-28.047-62.646-62.646 0-34.6 28.047-62.647 62.646-62.647 34.6 0 62.646 28.047 62.646 62.647 0 34.599-28.046 62.646-62.646 62.646Z" />\n            <path\n                d="m89.002 42.766-26.976-.006-13.573 12.644s-4.06 4.033-7.464 7.523c-3.403 3.49-5.636 8.807-5.636 14.158 0 5.683 2.428 10.62 6.237 14.83a781.937 781.937 0 0 0 10.757 10.713c5.172 5.039 9.355 6.219 15.242 6.199 7.424-.025 11.03-3.311 13.602-5.638.911-.824 8.037-8.033 8.037-8.033l.01 13.651 12.903-12.551V55.903c0-8.16-5.208-13.333-13.14-13.141l.001.004Zm-.006 35.544S75.63 91.828 74.014 93.405c-2.029 1.979-3.812 2.507-6.22 2.507-2.406 0-3.64-.076-6.218-2.507-2.264-2.135-10.09-10.078-10.557-10.616-1.404-1.604-2.107-3.444-2.107-5.516 0-2.472.904-4.581 2.708-6.319l15.034-15.04L89 55.91l-.005 22.403.001-.002Z" />\n        </g>\n        <defs>\n            <clipPath id="a">\n                <path fill="#fff" d="M0 .703h145v145H0z" />\n            </clipPath>\n        </defs>\n    </svg>'}),Class(function UILGraph(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILGraph",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"wrapper",children:[{addTo:"$body",_type:"UILGraphContextMenu",refName:"contextMenu",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.body=__body;let _uniq=0;var _layouts={};UIL.sidebar&&UIL.sidebar.toolbar&&UIL.sidebar.toolbar.element.hide(),_this.onMounted=async function(){await _this.wait(1e3);const{x:x,y:y}=_this.element.div.getBoundingClientRect();_this.contextMenu.setOffset({x:x,y:y})},_this.add=function(_layout){_layouts[_layout.id]||(_layouts[_layout.id]=_layout,_this.element.add(_layout))},_this.getGraph=function(name,layoutInstance,isGL=!0){if(!UIL.sidebar)return;let _graph=new UILGraphLayout({name:name,layoutInstance:layoutInstance,isGL:isGL,uniq:_uniq++});return _this.add(_graph),_graph},_this.element.goob("\n    position:relative;\n    width: 100%;\n    height: auto;\n    user-select: none;\n    margin-bottom: 4px;\n    border-radius: 4px;\n    background-color: #161616;\n\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILGraph"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()},"singleton",()=>{UILGraph.FOCUSED="uilgraph_focused",UILGraph.BLURRED="uilgraph_blurred",UILGraph.GROUP_TYPE="uilgraph_group_type",UILGraph.LAYER_TYPE="uilgraph_layer_type",UILGraph.SPECIAL_TYPE="uilgraph_special_type",UILGraph.LAYOUT_TYPE="uilgraph_layout_type",UILGraph.OPEN_CONTEXT_MENU="uilgraph_open_context_menu",UILGraph.CLOSE_CONTEXT_MENU="uilgraph_close_context_menu",UILGraph.ACTION_DELETE="uilgraph_action_delete",UILGraph.ACTION_LAYER="uilgraph_action_layer",UILGraph.ACTION_GROUP="uilgraph_action_group",UILGraph.TREE_LAST="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAVAQMAAABFfO2wAAAABlBMVEUAAAC0tLQrlfMqAAAAAXRSTlMAQObYZgAAABFJREFUCNdjaGDAh/4fYMALACnuBsCqBlYuAAAAAElFTkSuQmCC')",UILGraph.TREE_GROUP="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAVAQMAAABFfO2wAAAABlBMVEUAAAC0tLQrlfMqAAAAAXRSTlMAQObYZgAAABFJREFUCNdjaGDAh/4fwK8AAHduC8BoO2AxAAAAAElFTkSuQmCC')",UILGraph.TREE_LAYER="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAVAQMAAABFfO2wAAAABlBMVEUAAAC0tLQrlfMqAAAAAXRSTlMAQObYZgAAAA1JREFUCNdjaGCgBAEAUE4KgSOykIMAAAAASUVORK5CYII=')",UILGraph.EYE_ICON='<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>',UILGraph.CONFIG_ICON='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 219.9 261.5"><path d="M85.6,226.6c-1.7,1-9.2,1.2-28.7,0.9l-26.4-0.3l-6.7-3.2c-12.3-5.8-20.4-16-22.7-28.7C-0.3,187.7-0.4,41.8,1,33.4\n    c1.4-8.5,5-15.6,11-21.7C17.8,6,25.3,2,32.8,0.7C35.4,0.2,56.2-0.1,79,0c41.3,0.2,41.5,0.2,46,2.5c5.6,2.9,54.2,51,57.3,56.7\n    c2.1,3.8,2.2,5.3,2.5,36.2c0.3,31.3,0.2,32.3-1.7,34.2c-2.7,2.7-7.5,2.7-10.1,0.1c-1.9-1.9-2-3.4-2-29.3c0-14.9-0.5-29-1-31.1\n    c-0.7-3.3-4.6-7.7-24.7-27.8c-13.1-13.2-25-24.6-26.5-25.4c-2.2-1.1-9.9-1.4-42.6-1.4c-45.2,0-46.1,0.1-53.5,7.4\n    c-8,7.8-7.7,3.9-7.7,91.1c0,84.9-0.1,83.3,6.2,90.9c1.7,2.1,5.4,4.9,8.2,6.2c4.9,2.3,6,2.4,29.3,2.4c16,0,25.1,0.4,26.7,1.1\n    C90.3,216.1,90.5,224,85.6,226.6z M78,85.5c27.7-0.3,29.9-0.4,31.9-2.2c2.9-2.6,2.9-8.6,0-11.2c-2-1.8-4.2-1.9-32.3-2.1\n    c-24.3-0.2-30.7,0-33.3,1.1c-6,2.7-5.7,10.7,0.3,13.2C47.6,85.6,53.4,85.8,78,85.5z M43.8,131.2h47.5c45.3,0,47.6-0.1,49.6-1.9\n    c2.7-2.5,2.8-7.9,0.1-10.6c-1.9-1.9-3.3-2-49.3-2H44.3l-2.1,2.3c-2.7,2.9-2.8,6.7-0.3,9.8L43.8,131.2z M219.8,209.8\n    c-0.5,8.9-1.4,10.4-7.6,13c-2.7,1.2-4.2,2.4-3.8,3.2c1.9,4.6,2.8,8.9,2.3,10.9c-0.8,3.1-12.4,14.7-15.5,15.5\n    c-2,0.5-6.4-0.4-10.9-2.3c-0.6-0.3-2,1.3-3.1,3.8c-1,2.4-2.6,4.9-3.5,5.6c-2.2,1.9-15.3,2.7-20.5,1.3c-3.6-1-4.6-1.9-6.8-6.2\n    c-2-4-2.9-4.9-4.2-4.4c-5.7,2.4-7.1,2.7-9.5,2.1c-3.4-0.8-14.1-10.8-15.7-14.6c-1.1-2.5-1-3.7,0.4-7.3c0.9-2.3,1.6-4.6,1.6-4.9\n    c0-0.4-2-1.6-4.4-2.7c-6-2.6-7-4.9-7-15.8c-0.1-8.3,0.2-9.4,2.3-11.7c1.3-1.4,3.9-3,5.7-3.6c3.9-1.3,3.9-1.5,1.9-6.3\n    c-0.8-2-1.5-4.5-1.5-5.6c0-2.6,7.8-12,12.9-15.5c4.3-3,5.7-3,13.6,0.1c0.9,0.3,2.3-1.4,3.9-4.6c1.7-3.3,3.4-5.2,4.9-5.5\n    c1.2-0.3,3.1-0.7,4.2-1c2.4-0.6,14.7,0.2,17,1c0.9,0.4,2.7,2.8,4.1,5.5c1.3,2.7,2.8,4.9,3.3,4.9s2.5-0.7,4.4-1.5c6-2.5,7.3-2,15.2,6\n    c8.2,8.1,8.7,9.5,5.9,16.5c-0.9,2.3-1.5,4.2-1.3,4.3c0.2,0.1,2.5,1.2,5.1,2.4C219.1,195.2,220.4,198.8,219.8,209.8z M205,207.7\n    c0-2.1-0.9-3-4.5-4.8c-4.7-2.3-8.5-7.1-8.5-10.8c0-1.2,0.7-4.1,1.5-6.4c1.4-3.9,1.4-4.5-0.1-6.1c-1.4-1.6-1.9-1.6-6-0.2\n    c-8.4,2.9-14.1,0.5-17.6-7.5c-2.6-5.7-5.8-5.8-8.3-0.3c-3.6,8.1-10.2,10.9-18,7.7c-3.7-1.6-4-1.6-5.7,0.2c-1.8,1.7-1.8,2-0.2,5.7\n    c3.2,7.8,0.4,14.4-7.7,18c-5.7,2.6-5.4,5.8,0.7,8.7c7.7,3.5,10.2,10.2,6.9,18.1c-1.3,3.2-1.3,3.6,0.5,5.2s2.2,1.7,6.2,0\n    c7.4-2.9,13.8-0.2,17.3,7.4c2.7,6,5.5,5.6,9.2-1.2c2.3-4.3,3.5-5.5,7-6.7c3.8-1.3,4.7-1.2,9.4,0.4c4.7,1.7,5.2,1.7,6.7,0.2\n    c1.5-1.4,1.5-2-0.2-6.6c-1.1-3.1-1.5-6-1.1-7.9c0.8-3.7,4.7-7.7,9.1-9.3C204.3,210.6,205,209.7,205,207.7z M175.7,228.3\n    c-12.3,5.7-25.7,1-31.3-11c-4.5-9.7-2.4-19.7,5.7-27c2.7-2.4,6.6-4.8,8.6-5.4c5.4-1.4,7.3-1.4,12.9,0.3\n    C192.2,191.3,194.9,219.3,175.7,228.3z M171.1,201.6c-3.6-3.6-7-3.7-11-0.3c-2.4,2-3.1,3.4-3.1,6c0,7.7,9.4,11.3,14.5,5.8\n    C174.9,209.4,174.8,205.3,171.1,201.6z M110,164.7c-1.9-1.9-3.3-2-34-2s-32.1,0.1-34,2c-3,3-2.7,8.3,0.6,10.9\n    c2.6,2,3.8,2.1,33.5,2.1c30.5,0,30.8,0,33.3-2.3C113,172.2,113.3,168,110,164.7z"/></svg>',UILGraph.TIMELINE_ICON='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 248.6 232"><path d="M245.3,145.4c-6.8,26.1-24.7,51.4-46.9,66.4c-20.7,13.9-41.2,20.2-66.2,20.2c-28.7-0.1-53.1-9.2-75.7-28.5\n    c-8-6.9-21.3-22.9-20.3-24.5c0.5-0.8,16.7-12.4,20.1-14.4c0.7-0.4,3.2,2,6,5.9c12.3,16.8,33.4,29.6,55,33.4c11.5,2,31,0.9,41.4-2.5\n    c36.7-11.8,61.1-42.8,62.7-79.7c1.3-27-6.6-48.3-24.6-67.2C163,19.2,108,17.7,72.3,51c-16.1,15.1-26.2,34.7-28.2,55.1l-0.7,7.1\n    l9.7-0.5c5.3-0.2,9.6-0.2,9.6,0s-7.3,9.5-16.1,20.8l-16.1,20.4l-15.2-20.2L0,113.4l8.2-0.3l8.2-0.3l0.7-7.9\n    C20.2,67.1,45.3,30.3,80,12.8c9.7-4.9,23-9.4,33.3-11.3c9.4-1.7,26.3-2,35.4-0.6c46.2,7,83.7,40,95.9,84.1\n    C249.7,103.8,250,127.2,245.3,145.4z M141.9,83.7L141.7,59l-2.7-2c-3.7-3-9.7-2.8-12.8,0.4l-2.5,2.4v31.1V122l2.5,2.4l2.4,2.5h30.5\n    c29.9,0,30.6,0,32.5-2.1c2.9-3.1,3.5-7.1,1.7-11.3c-0.8-2-1.6-3.7-1.8-3.8c-0.2-0.1-11.3-0.5-24.8-0.8l-24.5-0.5L141.9,83.7z\n     M87.1,66.9l-3.4,3.5l-3.4,3.5l6.9,7l7,7l3.5-3.5l3.5-3.5l-7-7L87.1,66.9z M171.7,88.4l7-7l7-7.1l-3.8-3.7l-3.8-3.7l-6.9,7l-7,7\n    l3.8,3.7L171.7,88.4z M67.7,110.9v5v5h10h10v-5v-5h-10H67.7z M90.2,152.9l-7,7l3.5,3.5l3.5,3.5l7-7l7-7l-3.5-3.5l-3.5-3.5\n    L90.2,152.9z M164.7,149.4l-3.4,3.5l6.9,7l6.9,7l3.8-3.7l3.8-3.7l-6.7-6.8c-3.7-3.7-7-6.8-7.3-6.8S166.6,147.5,164.7,149.4z\n     M127.7,170.4v9.5h5h5v-9.5v-9.5h-5h-5V170.4z"/></svg>'}),Class(function UILGraphContextMenu(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILGraphContextMenu",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"wrapper",children:[{_type:"div",refName:"buttons",children:[{view:"UILGraphContextMenuButton",data:"$buttonsData",_type:"ViewState",refName:"unnamed",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;const{LAYOUT_TYPE:LAYOUT_TYPE,STAGE_LAYOUT_TYPE:STAGE_LAYOUT_TYPE,GROUP_TYPE:GROUP_TYPE,LAYER_TYPE:LAYER_TYPE,SPECIAL_TYPE:SPECIAL_TYPE}=UILGraph,{ACTION:ACTION,DELETE:DELETE,COPY_LAYOUT:COPY_LAYOUT,PASTE_LAYOUT:PASTE_LAYOUT,ADD_LAYER:ADD_LAYER,COPY_LAYER:COPY_LAYER,PASTE_LAYER:PASTE_LAYER,DUPLICATE_LAYER:DUPLICATE_LAYER,CINEMA:CINEMA,FIGMA:FIGMA,ADD_GROUP:ADD_GROUP,DUPLICATE_GROUP:DUPLICATE_GROUP,COPY_GROUP:COPY_GROUP,PASTE_GROUP:PASTE_GROUP}=UILGraphContextMenu;let _sourceButtonsData=[{label:"Add Layer",uilContexts:[GROUP_TYPE,STAGE_LAYOUT_TYPE,LAYOUT_TYPE],action:ADD_LAYER},{label:"Copy Layer",uilContexts:[LAYER_TYPE],action:COPY_LAYER},{label:"Paste Layer",uilContexts:[LAYOUT_TYPE,GROUP_TYPE,LAYER_TYPE],action:PASTE_LAYER},{label:"Duplicate Layer",uilContexts:[STAGE_LAYOUT_TYPE,LAYER_TYPE],action:DUPLICATE_LAYER},{label:"Add Group",uilContexts:[LAYOUT_TYPE,GROUP_TYPE],action:ADD_GROUP},{label:"Duplicate Group",uilContexts:[GROUP_TYPE,STAGE_LAYOUT_TYPE],action:DUPLICATE_GROUP},{label:"Copy Group",uilContexts:[GROUP_TYPE],action:COPY_GROUP},{label:"Paste Group",uilContexts:[LAYOUT_TYPE,GROUP_TYPE,LAYER_TYPE],action:PASTE_GROUP},{label:"Copy Layout",uilContexts:[LAYOUT_TYPE],action:COPY_LAYOUT},{label:"Paste Layout",uilContexts:[LAYOUT_TYPE],action:PASTE_LAYOUT},{label:"Apply Figma Config",uilContexts:[],action:FIGMA},{label:"Delete",uilContexts:[GROUP_TYPE,STAGE_LAYOUT_TYPE,LAYER_TYPE],action:DELETE}];UIL.CMS_ONLY&&(_sourceButtonsData=[{label:"Add",uilContexts:[GROUP_TYPE,STAGE_LAYOUT_TYPE,LAYOUT_TYPE],action:ADD_LAYER},{label:"Delete",uilContexts:[GROUP_TYPE,STAGE_LAYOUT_TYPE,LAYER_TYPE],action:DELETE}]);const specialCases={};specialCases[CINEMA]=[()=>"Config"==_this.get("UIL/ContextMenu").targetId],specialCases[FIGMA]=[()=>_this.get("UIL/ContextMenu").targetId.endsWith("Root")],_this.buttonsData=new StateArray([]),_this.offset={},_this.element.hide(),window.addEventListener("click",()=>_this.set("UIL/ContextMenu",null)),_this.bind("UIL/ContextMenu",openContext=>{if(!openContext)return function hideContextMenu(){return _this.element.mouseEnabled(!1),_this.element.hide()}();openContext.fromKeyboard||(!function filterButtons(context){if(!context)return;_this.buttonsData.refresh(JSON.parse(JSON.stringify(_sourceButtonsData)).filter(b=>b.uilContexts.includes(context.type)||specialCases[b.action]&&specialCases[b.action].map(fn=>fn()).reduce((a,b)=>a()||b())))}(openContext),function positionAndShowContextMenu(){const margin=7;let x=Mouse.x+margin-_this.offset.x;x>Stage.width-160&&(x=Mouse.x-160-margin-_this.offset.x);let y=Mouse.y+margin-_this.offset.y;y>Stage.height-75&&(y=Mouse.y-75-margin-_this.offset.y);y+=UIL.global.element.div.querySelector(".UILTabsContentItem")?.scrollTop||0,_this.element.transform({x:x,y:y}),_this.element.show()}(),_this.element.mouseEnabled(!0))}),_this.setOffset=({x:x,y:y})=>_this.offset={x:x,y:y},_this.element.goob("\n    position: absolute;\n    width: auto;\n    height: auto;\n    padding-top: 10px;\n    padding-bottom: 10px;\n    color: black;\n    background-color: #303030;\n    border-radius: 12px;\n    line-height: 2px;\n    overflow: hidden;\n    user-select: none;\n    z-index: 999999;\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILGraphContextMenu"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()},"",()=>{UILGraphContextMenu.ACTION="uilgraph_action",UILGraphContextMenu.DELETE="uilgraph_delete",UILGraphContextMenu.COPY_LAYOUT="uilgraph_copy_layout",UILGraphContextMenu.PASTE_LAYOUT="uilgraph_paste_layout",UILGraphContextMenu.ADD_LAYER="uilgraph_add_layer",UILGraphContextMenu.COPY_LAYER="uilgraph_copy_layer",UILGraphContextMenu.COPY_GROUP="uilgraph_copy_group",UILGraphContextMenu.PASTE_GROUP="uilgraph_paste_group",UILGraphContextMenu.PASTE_LAYER="uilgraph_paste_layer",UILGraphContextMenu.DUPLICATE_LAYER="uilgraph_duplicate_layer",UILGraphContextMenu.CINEMA="uilgraph_cinema",UILGraphContextMenu.FIGMA="uilgraph_figma",UILGraphContextMenu.ADD_GROUP="uilgraph_add_group",UILGraphContextMenu.DUPLICATE_GROUP="uilgraph_duplicate_group"}),Class(function UILGraphContextMenuButton(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILGraphContextMenuButton",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{click:"$onClick",_type:"UI",refName:"unnamed",children:[{_type:"div",_innerText:"$data.label",refName:"button",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind("UILGraphContextMenu/open",openContext=>{if(openContext||_this.element.hide(),_this.data.targetNodeCases.reduce((a,b)=>a()||b()))return _this.element.show();const action=_this.data.uilContexts.includes(openContext.type)?"show":"hide";_this.element[action]()}),_this.onClick=function(){_this.fire("GraphContextMenu/action",_this.data.action)},_this.element.goob("\n    position: relative;\n    width: 100%;\n    height: 27px;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    cursor: default;\n    box-sizing: border-box;\n    padding: 0 18px;\n    user-select: none;\n    transition: background-color 300ms ease-in-out, color 300ms ease-in-out;\n    background-color: transparent;\n    color: white;\n    font-family: sans-serif;\n    font-size: 11px;\n\n    &:hover {\n        color: #fff;\n        background-color: #525252;\n    }\n\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILGraphContextMenuButton"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILGraphGroup(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,DragAndDrop),Inherit(_this,XComponent),_this.fragName="UILGraphGroup",_this.contexts="ViewStateElement,Element,DragAndDrop",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"wrapper",children:[{_type:"div",refName:"hitArea",children:[{_type:"div",refName:"dropTarget",children:[{_type:"div",refName:"highlight",children:[]}]},{click:"$onClick",_type:"div",refName:"header",children:[{click:"$toggleClick",_type:"div",refName:"toggleButton",children:[]},{_type:"div",refName:"typeIcon",children:[]},{tabIndex:1,_type:"div",refName:"title",children:[{_type:"div",_innerText:"$data.name",refName:"titleText",children:[]},{value:"$data.name",_type:"input",refName:"titleField",children:[]}]},{type:"group",data:"$data",layoutId:"$params.layoutId",_type:"UILGraphNodeMenu",refName:"unnamed",children:[]}]}]},{data:"$data",layoutId:"$params.layoutId",_type:"UILGraphGroupChildren",refName:"unnamed",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function detectCopyPaste(event){_this.data.focused&&!["input","textarea"].includes(document.activeElement.tagName.toLowerCase())&&("c"==event.key&&event.metaKey&&(_this.set("UIL/ContextMenu",{layoutId:_this.params.layoutId,targetId:_this.data.id,type:UILGraph.GROUP_TYPE,isStageLayout:_this.data.isStageLayout,fromKeyboard:!0}),_this.fire("GraphContextMenu/action",UILGraphContextMenu.COPY_GROUP)),"v"==event.key&&event.metaKey&&(_this.set("UIL/ContextMenu",{layoutId:_this.params.layoutId,targetId:_this.data.id,type:UILGraph.GROUP_TYPE,isStageLayout:_this.data.isStageLayout,fromKeyboard:!0}),_this.fire("GraphContextMenu/action",UILGraphContextMenu.PASTE_GROUP)),"Delete"!=event.key&&"Backspace"!=event.key||!event.metaKey||(_this.set("UIL/ContextMenu",{layoutId:_this.params.layoutId,targetId:_this.data.id,type:UILGraph.GROUP_TYPE,isStageLayout:_this.data.isStageLayout,fromKeyboard:!0}),_this.fire("GraphContextMenu/action",UILGraphContextMenu.DELETE)))}function handleNodeFocused(val){if(!_this.data)return;let focusedNode;_this.data.children?.forEach(node=>{node.focused=val==node.id,node.focused&&(focusedNode=node)}),focusedNode&&(UIL.sidebar.toolbar.filterSingle(val),Storage.set(`UIL:${_this.params.layoutId}/Graph/focused`,val),_this.events.fire(UILGraphNode.FOCUSED,{name:focusedNode.name,layoutInstance:_this.params.layoutInstance}))}function handleMoveNode(e){if(!_this.data||!_this.data.children)return;const find=id=>{let found;return _this.data.children.forEach(node=>{node.id==id&&(found=node)}),found};let moveNode=find(e.moveId),targetNode=find(e.targetId);try{if(!moveNode.parent||moveNode.parent!=targetNode?.parent)return}catch(e){return}if(1==_this.data.children.length&&(moveNode.sortIndex=0),"end-of-list"==e.type){let oldIndex=moveNode.sortIndex;_this.data.children.forEach(node=>{node.parent||node.sortIndex>oldIndex&&(node.sortIndex-=1)}),moveNode.sortIndex=_this.data.children.length-1,_this.data.children.sort((a,b)=>a.sortIndex-b.sortIndex)}else{let oldIndex=moveNode.sortIndex;if(_this.data.children.forEach(node=>{node.sortIndex>oldIndex&&(node.sortIndex-=1)}),"before"==e.type){let newIndex=targetNode.sortIndex;_this.data.children.forEach(node=>{node.sortIndex>=newIndex&&(node.sortIndex+=1)}),moveNode.sortIndex=newIndex}_this.data.children.sort((a,b)=>a.sortIndex-b.sortIndex),healSort()}}function healSort(){let lastIndex=-1;_this.data.children.forEach(node=>{let delta=node.sortIndex-lastIndex;delta>1&&(node.sortIndex-=delta-1),lastIndex=node.sortIndex})}async function handleContextMenuAction(event){if(!_this.get)return;const context=_this.get("UIL/ContextMenu");if(context&&context.layoutId==_this.params.layoutId&&event===UILGraphContextMenu.DELETE){let foundNode;if(_this.data.children.forEach(node=>{node.id==context.targetId&&(foundNode=node)}),foundNode){_this.params.getBridge().deleteNode(foundNode)&&(_this.data.children.remove(foundNode),_this.data.children.forEach(node=>{node.sortIndex>foundNode.sortIndex&&(node.sortIndex-=1)}),_this.set(`UIL/${_this.params.layoutId}/UILGraph/node/focused`,_this.data.id))}healSort()}}function onKey(event){return"enter"==event.key.toLowerCase()?function onTitleValidate(event){(function rename(name){let previousName=_this.data.nameLabel;_this.data.set("nameLabel",name),_this.title.text(_this.data.nameLabel),_this.titleField.val(_this.data.nameLabel),_this.events.fire(UILGraphNode.RENAMED,{layoutId:_this.data.layoutId,id:_this.data.id,name:previousName,value:_this.data.nameLabel}),_this.data.set("name",name),_this.name=name})(_this.titleField.val()),hideTitleEditor()}():"escape"==event.key.toLowerCase()?hideTitleEditor():void 0}function showTitleEditor(){_this.titleField.show(),_this.titleField.div.focus(),_this.titleField.div.select()}function hideTitleEditor(){_this.titleField.hide()}function openContextMenu(e){e.preventDefault(),_this.set("UIL/ContextMenu",{layoutId:_this.params.layoutId,targetId:_this.data.id,parentId:_this.data.parentId?.split(`${_this.data.scene}_`)[1],name:_this.data.name,type:UILGraph.GROUP_TYPE,isStageLayout:_this.data.isStageLayout})}_this.id=_this.data.id,_this.name=_this.data.name,_this.nameLabel=_this.data.name,_this.isGraphGroup=!0,_this.sortOrder=_this.params.order,_this.typeIcon.html(UILGraphLayout.GROUP_ICON),_this.toggleButton.html(UILGraphLayout.ARROW_ICON),_this.toggleButton.classList()[_this.data.open?"remove":"add"]("closed"),_this.titleField.hide(),_this.onClick=function(e){e.target.getAttribute("class")?.indexOf("toggleButton")>-1||e.target.getAttribute("class")?.indexOf("arrow")>-1||_this.fire(`UIL/${_this.params.layoutId}/UILGraph/node/focused`,_this.data.id)},_this.data.set("open",!0),_this.toggleClick=_=>{_this.data.set("open",!_this.data.open),_this.fire("UILGraphGroup/open",{open:_this.data.open,id:_this.data.id,layoutId:_this.data.layoutId})},_this.bind(_this.data,"open",val=>_this.toggleButton?.classList?.()[val?"remove":"add"]("closed")),_this.bind(_this.data,"locked",value=>{_this.wrapper.css({pointerEvents:value?"none":"auto"}),_this.setDragEnabled(!value)}),function addHandlers(){_this.hitArea.div.addEventListener("contextmenu",openContextMenu),_this.element.div.addEventListener("mousedown",_this.addDragListeners,!1),window.addEventListener("mouseup",_this.removeDragListeners,!1),_this.hitArea.div.addEventListener("dblclick",showTitleEditor,!1),_this.titleField.div.addEventListener("keyup",onKey,!1),_this.titleField.div.addEventListener("blur",hideTitleEditor,!1),_this.bind(`UIL/${_this.params.layoutId}/UILGraph/node/focused`,handleNodeFocused),_this.listen("UILGraph/MoveNode",handleMoveNode),_this.listen("GraphContextMenu/action",handleContextMenuAction),document.addEventListener("keydown",detectCopyPaste,!1)}(),_this.header.classList()[_this.data.selected?"add":"remove"]("focused"),_this.bind(_this.data,"focused",val=>{if(!_this.header)return;const focusedAction=val?"add":"remove";_this.header.classList()[focusedAction]("focused")}),_this.onMounted=function(){_this.element.div.classList.add("UILGraphNode"),_this.header.css({paddingLeft:32*_this.data.depth+"px"}),_this.setDragElement(_this.header),_this.data.locked&&(_this.wrapper.css({pointerEvents:"none"}),_this.data.special||_this.setDragEnabled(!1))},_this.onDrop=function(dropId){_this.fire("UILGraph/MoveNode",{moveId:dropId,targetId:_this.data.id,type:"before"})},_this._bindOnDestroy(()=>{document.removeEventListener("keydown",detectCopyPaste,!1)}),_this.element.goob(`\n    position: relative;\n    width: 300px;\n    height: auto;\n    font-family: sans-serif;\n    font-size: 11px;\n    width: 100%;\n    cursor: grab;\n\n    & > .wrapper > .hitArea > .header {\n        width: 100%;\n        height: auto;\n        outline: none;\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        padding: 9px;\n        padding-left: 32px;\n        box-sizing: border-box;\n        user-select: none;\n        border: 1px solid rgba(26, 109, 234, 0);\n    }\n\n    & > .wrapper > .hitArea > .header {\n        transition: border-color 200ms, background-color 200ms;\n    }\n\n    & > .wrapper > .hitArea > .header:hover {\n        border: 1px solid rgba(26, 109, 234, 1);\n    }\n\n\n    & > .wrapper > .hitArea > .header.focused {\n        background-color: rgba(26, 109, 234, 1);\n    }\n\n    & > .wrapper > .hitArea > .header.focused:hover {\n        border: 1px solid rgba(26, 109, 234, 0);\n    }\n\n    .toggleButton {\n        position: absolute;\n        width: 32px;\n        height: auto;\n        box-sizing: border-box;\n        text-align: center;\n        padding: 9px;\n        margin-left: -32px;\n        transform: rotate(180deg);\n        opacity: 0.6;\n        transition: opacity 200ms;\n    }\n\n    .toggleButton:hover {\n        opacity: 1;\n    }\n\n    .toggleButton.closed {\n        transform: rotate(0deg);\n    }\n\n    .toggleButton path {\n        fill: var(--color-white);\n    }\n\n    .typeIcon {\n        margin-right: 9px;\n        margin-left: -4px;\n    }\n\n    .typeIcon path {\n        fill: var(--color-white);\n    }\n\n    .typeIcon rect {\n        stroke: var(--color-white);\n    }\n\n    .title {\n        display: block;\n        verticalAlign: middle;\n    }\n\n    .titleField {\n        background-color: #b1b1b1;\n        position: absolute !important;\n        display: inline-block;\n        margin-left: ${30*(_this.data.depth-1)}px;\n        top: 4px;\n        left: 32px;\n        width: auto !important;\n        padding: 9px !important;\n        verticalAlign: middle;\n        fontWeight: bold;\n        border: 0;\n        outline: none;\n        z-index: 1;\n    }\n\n    .UILGraphNodeMenu {\n        position: absolute;\n        right: 0;\n    }\n\n    .visibilityButton {\n    }\n\n    .UILGraphGroupChildren {\n        overflow: hidden;\n        margin-top: -4px;\n    }\n\n`),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILGraphGroup"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILGraphGroupChildren(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,DragAndDrop),Inherit(_this,XComponent),_this.fragName="UILGraphGroupChildren",_this.contexts="Element,DragAndDrop",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"wrapper",children:[{_type:"div",refName:"items",children:[{view:"UILGraphLayer",data:"$params.data.children",layoutId:"$params.layoutId",_type:"ViewState",refName:"unnamed",children:[]}]},{_type:"div",refName:"dropTarget",children:[{_type:"div",refName:"highlight",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.setDragEnabled(!1),_this.items.classList()[_this.params.data.open?"remove":"add"]("hidden"),_this.bind(_this.params.data,"open",val=>_this.items?.classList?.()[val?"remove":"add"]("hidden")),_this.onDrop=function(dropId){_this.fire("UILGraph/MoveNode",{moveId:dropId,targetId:_this.params.data.id,type:"end-of-list"})},_this.element.goob(`\n    & > .wrapper > .items.hidden {\n        display: none;\n    }\n\n    & > .wrapper > .dropTarget {\n        margin-bottom: 0;\n        margin-left: ${32*_this.params.data.depth}px;\n        height: 6px;\n    }\n`),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILGraphGroupChildren"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILGraphLayer(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,DragAndDrop),Inherit(_this,XComponent),_this.fragName="UILGraphLayer",_this.contexts="ViewStateElement,Element,DragAndDrop",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{click:"$onClick",_type:"div",refName:"wrapper",children:[{_type:"div",refName:"line",children:[]},{_type:"div",refName:"dropTarget",children:[{_type:"div",refName:"highlight",children:[]}]},{tabIndex:1,_type:"a",refName:"header",children:[{_type:"div",refName:"typeIcon",children:[]},{tabIndex:1,_type:"div",refName:"title",children:[{_type:"div",_innerText:"$data.titleString",refName:"titleInner",children:[]},{value:"$data.name",_type:"input",refName:"titleField",children:[]}]},{type:"layer",data:"$data",_type:"UILGraphNodeMenu",refName:"nodemenu",children:[]}]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function detectCopyPaste(event){_this.data.focused&&!["input","textarea"].includes(document.activeElement.tagName.toLowerCase())&&("c"==event.key&&event.metaKey&&(_this.set("UIL/ContextMenu",{layoutId:_this.params.layoutId,targetId:_this.data.id,type:UILGraph.LAYER_TYPE,isStageLayout:_this.data.isStageLayout,fromKeyboard:!0}),_this.fire("GraphContextMenu/action",UILGraphContextMenu.COPY_LAYER)),"v"==event.key&&event.metaKey&&(_this.set("UIL/ContextMenu",{layoutId:_this.params.layoutId,targetId:_this.data.id,type:UILGraph.LAYER_TYPE,isStageLayout:_this.data.isStageLayout,fromKeyboard:!0}),_this.fire("GraphContextMenu/action",UILGraphContextMenu.PASTE_LAYER)),"Delete"!=event.key&&"Backspace"!=event.key||!event.metaKey||(_this.set("UIL/ContextMenu",{layoutId:_this.params.layoutId,targetId:_this.data.id,type:UILGraph.LAYER_TYPE,isStageLayout:_this.data.isStageLayout,fromKeyboard:!0}),_this.fire("GraphContextMenu/action",UILGraphContextMenu.DELETE)))}function onKey(event){return"enter"==event.key.toLowerCase()?function onTitleValidate(event){(function rename(name){let previousName=_this.data.name;_this.data.set("nameLabel",name),_this.title.text(_this.data.nameLabel),_this.titleField.val(_this.data.nameLabel),_this.events.fire(UILGraphNode.RENAMED,{layoutId:_this.data.layoutId,id:_this.data.id,name:previousName,value:_this.data.nameLabel}),_this.data.set("name",name),_this.name=name})(_this.titleField.val()),hideTitleEditor()}():"escape"==event.key.toLowerCase()?hideTitleEditor():void 0}function showTitleEditor(){_this.data.special||(_this.titleField.show(),_this.titleField.div.focus(),_this.titleField.div.select())}function hideTitleEditor(){_this.titleField.hide()}function openContextMenu(e){e.preventDefault(),_this.set("UIL/ContextMenu",{layoutId:_this.params.layoutId,targetId:_this.data.id,parentId:_this.data.parentId?.split(`sl_${_this.data.scene}_`)[1],name:_this.data.name,type:_this.data.special?UILGraph.SPECIAL_TYPE:UILGraph.LAYER_TYPE,isStageLayout:_this.data.isStageLayout})}_this.data.titleString=_this.data.label||_this.data.name,_this.titleField.hide(),_this.data.special&&(_this.typeIcon.hide(),_this.dropTarget.hide(),_this.setDragEnabled(!1)),_this.data.locked&&(_this.wrapper.css({pointerEvents:"none"}),_this.data.special||_this.setDragEnabled(!1)),function addHandlers(){_this.wrapper.div.addEventListener("contextmenu",openContextMenu),_this.wrapper.div.addEventListener("dblclick",showTitleEditor,!1),_this.titleField.div.addEventListener("keyup",onKey,!1),_this.titleField.div.addEventListener("blur",hideTitleEditor,!1),document.addEventListener("keydown",detectCopyPaste,!1)}(),_this.bind(_this.data,"locked",value=>{_this.wrapper.css({pointerEvents:value?"none":"auto"}),_this.data.special||_this.setDragEnabled(!value)}),_this.onDrop=function(dropId){_this.fire("UILGraph/MoveNode",{moveId:dropId,targetId:_this.data.id,type:"before"})},_this.wrapper.classList()[_this.data.focused?"add":"remove"]("focused"),_this.bind(_this.data,"focused",val=>{_this.wrapper?.classList()[val?"add":"remove"]("focused")}),"UILGraphLayout"==_this.parent.parent.fragName?_this.line.hide():_this.line.size(25,25).html(UILGraphLayout.LINE_ELBOW).css({left:12,top:2,position:"absolute"}),_this.onMounted=function(){_this.element.div.classList.add("UILGraphNode"),_this.header.css({paddingLeft:32*_this.data.depth+"px"})},_this.onClick=function(){_this.fire(`UIL/${_this.params.layoutId}/UILGraph/node/focused`,_this.data.id)},_this._bindOnDestroy(()=>{document.removeEventListener("keydown",detectCopyPaste,!1)}),_this.element.goob(`\n    position: relative;\n    height: auto;\n    width: 100%;\n    cursor: grab;\n\n    & > .wrapper {\n        width: 100%;\n        border: 1px solid transparent;\n        transition: border-color 200ms, background-color 200ms;\n\n    }\n\n    & > .wrapper:hover {\n        border: 1px solid #1A6DEA;\n    }\n\n    & > .wrapper:active {\n        cursor: grabbing !important;\n    }\n\n    & > .wrapper.focused {\n        background-color: #1A6DEA;\n    }\n\n    & > .wrapper.focused:hover {\n        border: 1px solid transparent;\n    }\n\n    & > .wrapper.dragging {\n        background-color: transparent;\n    }\n\n    & > .wrapper.dragging:hover {\n        border: 1px solid #1A6DEA;\n    }\n\n\n    & > .wrapper.focused.dragging {\n        background-color: transparent;\n    }\n\n    & > .wrapper.focused.dragging:hover {\n        border: 1px solid #1A6DEA;\n    }\n\n    .header {\n        color: var(--color-white);\n        display: flex;\n        flex-direction: row;\n        align-items: center;\n        width: 100%;\n        height: auto;\n        outline: none;\n        padding: 9px;\n        padding-left: 0;\n        box-sizing: border-box;\n        user-select: none;\n        padding-left: 32px;\n    }\n\n    .typeIcon {\n        height: 8px;\n        width: 8px;\n        border: 1px solid var(--color-neutral-90);\n        margin-left: 0 !important;\n        margin-right: 9px;\n    }\n\n    .UILGraphNodeMenu {\n        position: absolute;\n        right: 0;\n    }\n\n    .title {\n        display: block;\n        verticalAlign: middle;\n    }\n\n    .titleField {\n        background-color: #b1b1b1;\n        position: absolute !important;\n        display: inline-block;\n        margin-left: ${28*((_this.data.depth||1)-1)}px;\n        top: 2px;\n        left: 36px;\n        width: auto !important;\n        padding: 8px !important;\n        verticalAlign: middle;\n        fontWeight: bold;\n        border: 0;\n        outline: none;\n        z-index: 1;\n    }\n\n    & > .wrapper > .dropTarget {\n        margin-left: ${32*((_this.data.depth||1)-1)}px;\n    }\n\n`),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILGraphLayer"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILGraphLayout(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,DragAndDrop),Inherit(_this,XComponent),_this.fragName="UILGraphLayout",_this.contexts="Element,DragAndDrop",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];(async function(){function createStateArray(array){return new StateArray(array||[])}_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"wrapper",children:[{tabIndex:1,_type:"div",refName:"header",children:[{_type:"div",refName:"toggle",children:[]},{_type:"div",_innerText:"$params.name",refName:"title",children:[]}]},{_type:"div",refName:"children",children:[{_type:"div",refName:"viewstate",children:[{view:"$determineView",data:"$nodes",layoutId:"$id",getBridge:"$getBridge",bridge:"$groupBridge",layoutInstance:"$layoutInstance",_type:"ViewState",refName:"layers",children:[]}]},{_type:"div",refName:"dropTarget",children:[{_type:"div",refName:"highlight",children:[]}]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;var _isOpen=!1,_isFocused=!1,_saveEnabled=!1,_isGL=!0===_this.params.isGL,_layoutInstance=_this.params.layoutInstance,_isStageLayout=_layoutInstance.isStageLayout;function handleParentBinding(node){_this.bind(node,"parent",(val,prevValue)=>{val?_this.groupBridge.groups.forEach(n=>{n.id.includes(val)&&!n.children.includes(node)&&(n.children.push(node),_this.nodes.remove(node),1==n.children.length&&(node.sortIndex=0))}):prevValue&&_this.groupBridge.groups.forEach(n=>{n.id.includes(prevValue)&&(n.children.remove(node),_this.nodes.push(node),node.sortIndex=_this.nodes.length)})})}async function duplicateGroup({targetId:targetId}){if(!targetId)throw new Error("UIL: no targetId in duplicateGroup");const targetGroup=_this.groupBridge.groups.find(node=>node.id==targetId);if(!targetGroup)throw new Error(`UIL: no group found in the _this.groupBridge.groups for ${targetId}`);const{id:id}=targetGroup,groupLayers=[];_this.groupBridge.layers.forEach(node=>{node.parent===id&&groupLayers.push(node)});const groupDataKeys=UIL.sidebar.toolbar.getParentFolder()?.getChildrenControlIds(targetGroup.id);UILStorage.duplicateData(groupDataKeys,_this.groupBridge.groups.length);const newGroup=await _this.groupBridge.createGroup({groupName:`Copy of ${targetGroup.name}`});handleParentBinding(newGroup),_this.nodes.push(newGroup),healSort();for(let i=0;i<groupLayers.length;i++){const layer=groupLayers[i];await duplicateLayer({targetId:layer.id,groupId:newGroup.id})}}async function duplicateLayer({targetId:targetId,groupId:groupId=null}){if(!targetId)throw new Error("UIL: no targetId in duplicateLayer");const targetLayer=_this.groupBridge.layers.find(node=>node.id==targetId);if(!targetLayer)throw new Error(`UIL: no layer found in the _this.groupBridge.layers for ${targetId}`);const layerDataKeys=UIL.sidebar.toolbar.getParentFolder()?.getChildrenControlIds(targetLayer.id);UILStorage.duplicateData(layerDataKeys,_this.groupBridge.layers.length);let parent=null,layerName=`Copy of ${targetLayer.name}`;groupId?(parent=groupId,layerName=targetLayer.name):parent=targetLayer.parent?targetLayer.parent:null;const newNode=await _this.groupBridge.createLayer(parent,{layerName:layerName});parent&&(newNode.parent=parent),handleParentBinding(newNode),parent||_this.nodes.push(newNode),healSort()}function copyLayer({targetId:targetId}){if(!targetId)throw new Error("UIL: no targetId in copyLayer");const targetLayer=_this.groupBridge.layers.find(node=>node.id==targetId),parent=targetLayer.parent?targetLayer.parent:null;if(!targetLayer)throw new Error(`UIL: no layer found in the _this.groupBridge.layers for ${targetId}`);const layerDataKeys=UIL.sidebar.toolbar.getParentFolder()?.getChildrenControlIds(targetLayer.id),copyData=UILStorage.getDataForKeys(layerDataKeys),sceneName=_layoutInstance.name;navigator.clipboard.writeText(JSON.stringify({action:"UIL_COPY_LAYER",sceneName:sceneName,parent:parent,name:targetLayer.name,layerData:copyData}))}function copyGroup({targetId:targetId}){if(!targetId)throw new Error("UIL: no targetId in copyGroup");const targetGroup=_this.groupBridge.groups.find(node=>node.id==targetId),{id:id}=targetGroup;if(!targetGroup)throw new Error(`UIL: no group found in the _this.groupBridge.groups for ${targetId}`);const groupDataKeys=UIL.sidebar.toolbar.getParentFolder()?.getChildrenControlIds(targetGroup.id),groupData=UILStorage.getDataForKeys(groupDataKeys),sceneName=_layoutInstance.name,layersData=[];_this.groupBridge.layers.forEach(node=>{node.parent==id&&layersData.push({id:node.id,name:node.name,sceneName:sceneName,layerData:UILStorage.getDataForKeys(UIL.sidebar.toolbar.getParentFolder()?.getChildrenControlIds(node.id))})});const copyObject={action:"UIL_COPY_GROUP",sceneName:sceneName,groupData:{id:targetGroup.id,data:groupData,name:targetGroup.name},layersData:layersData};navigator.clipboard.writeText(JSON.stringify(copyObject))}async function pasteLayer({parentGroupId:parentGroupId,data:data=null}){const copyData=data||JSON.parse(await navigator.clipboard.readText());if(!data&&copyData&&"UIL_COPY_LAYER"!=copyData.action)return void alert("Didnt find any UIL data in your clipboard. Please copy a layer first.");const newSceneName=_layoutInstance.name,{layerData:layerData,name:name,sceneName:oldSceneName}=copyData,copyName=_this.groupBridge.layers.find(node=>node.name==name)?`Copy of ${name}`:name;layerData.forEach(item=>{item.key.endsWith("_name")&&(item.value=copyName)});const parentIndex=layerData.findIndex(item=>item.key.endsWith("_parent"));-1!==parentIndex&&layerData.splice(parentIndex,1),UILStorage.pasteLayerData({layerData:layerData,newLayerNumber:_this.groupBridge.layers.length,sceneName:newSceneName,oldSceneName:oldSceneName});const newNode=await _this.groupBridge.createLayer(parentGroupId||null,{layerName:copyName});parentGroupId&&(newNode.parent=parentGroupId),handleParentBinding(newNode),parentGroupId||_this.nodes.push(newNode),healSort()}async function pasteGroup({parentGroupId:parentGroupId}){const copyData=JSON.parse(await navigator.clipboard.readText());if(copyData&&"UIL_COPY_GROUP"!=copyData.action)return void alert("Didnt find any UIL data in your clipboard. Please copy a group first.");_layoutInstance.name;const{groupData:groupData,layersData:layersData,sceneName:oldSceneName}=copyData,newGroupName=_this.groupBridge.groups.find(node=>node.name==groupData.name)?`Copy of ${groupData.name}`:groupData.name,newGroup=await _this.groupBridge.createGroup({groupName:newGroupName});for(let i=0;i<layersData.length;i++){const layer=layersData[i];await pasteLayer({parentGroupId:newGroup.id,data:layer})}parentGroupId&&(newGroup.parent=parentGroupId),handleParentBinding(newGroup),_this.nodes.push(newGroup),healSort()}function deleteLayer({targetId:targetId}){if(!targetId)throw new Error("UIL: no targetId in deleteLayer");const targetLayer=_this.groupBridge.layers.find(node=>node.id==targetId);if(!targetLayer)throw new Error(`UIL: no layer found in the _this.groupBridge.layers for ${targetId}`);const additionalKeys=[`${targetLayer.firebaseKeyPrefix}_name`,`${targetLayer.firebaseKeyPrefix}_sortIndex`,`${targetLayer.firebaseKeyPrefix}_renderOrder`,`${targetLayer.firebaseKeyPrefix}_parent`],layerDataKeys=UIL.sidebar.toolbar.getParentFolder()?.getChildrenControlIds(targetLayer.id);let foundNode;if(UILStorage.deleteItemsWithKeys([...layerDataKeys,...additionalKeys]),_this.nodes.forEach(node=>{node.id==targetId&&(foundNode=node)}),foundNode&&!foundNode.parent){_this.groupBridge.deleteNode(foundNode)&&(_this.nodes.remove(foundNode),_this.nodes.forEach(node=>{node.sortIndex>foundNode.sortIndex&&(node.sortIndex-=1)}),_this.nodes.length?_this.set(`UIL/${_this.id}/UILGraph/node/focused`,_this.nodes[0].id):_this.set(`UIL/${_this.id}/UILGraph/node/focused`,null))}healSort()}async function deleteGroup({targetId:targetId}){if(!targetId)throw new Error("UIL: no targetId in deleteGroup");const targetGroup=_this.groupBridge.groups.find(node=>node.id==targetId);if(!targetGroup)throw new Error(`UIL: no group found in the _this.groupBridge.groups for ${targetId}`);const additionalKeys=[`${targetGroup.firebaseKeyPrefix||"INPUT_GROUP"}_name`,`${targetGroup.firebaseKeyPrefix}_sortIndex`,`${targetGroup.firebaseKeyPrefix}_renderOrder`,`${targetGroup.firebaseKeyPrefix}_parent`],groupDataKeys=UIL.sidebar.toolbar.getParentFolder()?.getChildrenControlIds(targetGroup.id);UILStorage.deleteItemsWithKeys([...groupDataKeys,...additionalKeys]),_this.groupBridge.deleteNode(targetGroup),_this.nodes.remove(targetGroup),healSort()}function addHandlers(){_this.header.div.addEventListener("contextmenu",openContextMenu),_this.bind(`UIL/${_this.id}/UILGraph/node/focused`,handleNodeFocused),_this.listen("GraphContextMenu/action",handleContextMenuAction),_this.listen("UILGraph/MoveNode",handleMoveNode),_this.events.sub(UILSocket.EDITOR_BRIDGE,onEditorBridgeMessage)}function handleMoveNode(e){const find=id=>{let found;return _this.groupBridge.all.forEach(node=>{node.id==id&&(found=node)}),found};let moveNode=find(e.moveId),targetNode=find(e.targetId);if(moveNode&&!(moveNode.parent&&moveNode.parent==targetNode?.parent||moveNode==targetNode||targetNode?.parent&&moveNode.id.includes(targetNode.parent)||targetNode?.children&&moveNode.children)){if("end-of-list"==e.type)if(targetNode)moveNode.parent=targetNode.id;else{let oldIndex=moveNode.sortIndex;_this.nodes.forEach(node=>{node.sortIndex>oldIndex&&(node.sortIndex-=1)}),moveNode.sortIndex=_this.nodes.length-1,moveNode.parent=null,_this.nodes.sort((a,b)=>a.sortIndex-b.sortIndex)}else{if("group"==moveNode.type&&"group"==targetNode?.type)return;if(targetNode?.parent)return moveNode.parent=targetNode.parent,_this.fire("UILGraph/MoveNode",e),void healSort();moveNode.parent=null;let oldIndex=moveNode.sortIndex;if(_this.nodes.forEach(node=>{node.sortIndex>oldIndex&&(node.sortIndex-=1)}),"before"==e.type){let newIndex=targetNode.sortIndex;_this.nodes.forEach(node=>{node.sortIndex>=newIndex&&(node.sortIndex+=1)}),moveNode.sortIndex=newIndex}_this.nodes.sort((a,b)=>a.sortIndex-b.sortIndex)}healSort(),_this.set(`UIL/${_this.id}/UILGraph/node/focused`,e.moveId)}}function healSort(){let lastIndex=-1;_this.nodes.forEach(node=>{let delta=node.sortIndex-lastIndex;delta>1&&(node.sortIndex-=delta-1),lastIndex=node.sortIndex})}async function onEditorBridgeMessage(e){if(e.layout&&e.layout===_this.name){if("create"==e.action){let layer=await _layoutInstance._createLayer(null);await _this.wait(100),_this.events.fire(UILGraphLayout.BRIDGE_CREATE,{layoutName:_layoutInstance.name,layerName:layer._sceneLayout.name,newName:e.layerName})}if("delete"==e.action){let node=find(e.layerName);_layoutInstance._deleteLayer(node.id,e.layerName,!0)&&_this.remove(node,!0)}if("eval"==e.action){let layer=await _layoutInstance.getLayer(e.layerName);eval("layer._sceneLayout."+e.code)}}}function openContextMenu(e){e.preventDefault(),_this.set("UIL/ContextMenu",{layoutId:_this.id,targetId:_this.id,type:_isStageLayout?UILGraph.STAGE_LAYOUT_TYPE:UILGraph.LAYOUT_TYPE,isStageLayout:_isStageLayout})}async function handleContextMenuAction(event){const context=_this.get("UIL/ContextMenu");if(context&&context.layoutId==_this.id)switch(event){case UILGraphContextMenu.DELETE:_this.groupBridge.groups.find(node=>node.id==context.targetId)?deleteGroup({targetId:context.targetId}):deleteLayer({targetId:context.targetId});break;case UILGraphContextMenu.ADD_LAYER:{const parent=context.targetId&&context.targetId!==_this.id?_this.groupBridge.groups.find(node=>node.id==context.targetId):null;_this.groupBridge.createLayer();let newNode=_this.groupBridge.layers[_this.groupBridge.layers.length-1];handleParentBinding(newNode),_this.nodes.push(newNode),healSort(),parent&&(newNode.parent=parent.id)}break;case UILGraphContextMenu.ADD_GROUP:{_this.groupBridge.createGroup();let newNode=_this.groupBridge.groups[_this.groupBridge.groups.length-1];handleParentBinding(newNode),_this.nodes.push(newNode),healSort()}break;case UILGraphContextMenu.COPY_GROUP:copyGroup({targetId:context.targetId});break;case UILGraphContextMenu.COPY_LAYER:copyLayer({targetId:context.targetId});break;case UILGraphContextMenu.COPY_LAYOUT:var dataToCopy={UIL_ID:window.UIL_ID,layout:context.layoutId,location:window.location.pathname.split("/").filter(Boolean)[0]};if(window.Platform&&Router){const world=await Platform.getRoute(Router.getStateString());dataToCopy.world=world}navigator.clipboard.writeText(JSON.stringify(dataToCopy));break;case UILGraphContextMenu.DUPLICATE_LAYER:duplicateLayer({targetId:context.targetId,parentId:context.parentId});break;case UILGraphContextMenu.DUPLICATE_GROUP:duplicateGroup({targetId:context.targetId,parentId:context.parentId});break;case UILGraphContextMenu.CINEMA:applyCinemaConfig();break;case UILGraphContextMenu.FIGMA:applyFigmaConfig();break;case UILGraphContextMenu.PASTE_LAYER:let parentId=null;context.name&&context.name.startsWith("group_")&&(parentId=context.name),pasteLayer({parentGroupId:parentId});break;case UILGraphContextMenu.PASTE_GROUP:let parentGroupId=null;context.name&&context.name.startsWith("group_")&&(parentGroupId=context.name),pasteGroup({parentGroupId:parentGroupId});break;case UILGraphContextMenu.PASTE_LAYOUT:return alert("The Paste Layout feature is not yet implemented.")}}function handleNodeFocused(val){let focusedNode;if(!val||!_this.nodes.length)return _this.set("UILGraphLayoutFocused","xxxxx"),UIL.sidebar.toolbar.filterSingle("xxxxx"),void _this.events.fire(UILGraphNode.FOCUSED,{name:"Config",layoutInstance:_layoutInstance});_this.nodes.forEach(node=>{node.focused=val==node.id,node.focused&&(focusedNode=node)}),focusedNode&&(UIL.sidebar.toolbar.filterSingle(val),Storage.set(`UIL:${_this.id}/Graph/focused`,val),Storage.set("UILGraphLayoutFocused",_this.id),_this.set("UILGraphLayoutFocused",_this.id),_this.events.fire(UILGraphNode.FOCUSED,{name:focusedNode.name,layoutInstance:_layoutInstance}))}_this.id=_this.params.id||`${_this.params.name.toLowerCase()}-${_this.params.uniq}`,_this.layoutInstance=_layoutInstance,_this.attachmentId=`${_this.params.name}-${_this.params.uniq}`,_this.addSpecial=_this.addLayer=_this.addGroup=_this.syncVisibility=_this.syncGroupNames=_this.open=_=>{},_this.getBridge=()=>_this.groupBridge,_this.groupBridge=await UILGroupBridge.createSceneLayout(_layoutInstance.name),_this.determineView=data=>"group"==data.type?UILGraphGroup:UILGraphLayer,_this.setDragEnabled(!1),_this.nodes=createStateArray(),_this.groupBridge.all.forEach(node=>{handleParentBinding(node),node.parent||_this.nodes.push(node)}),addHandlers(),_this.delayedCall(_=>{Storage.get("UILGraphLayoutFocused")==_this.id&&_this.set(`UIL/${_this.id}/UILGraph/node/focused`,Storage.get(`UIL:${_this.id}/Graph/focused`))},500),_this.onDrop=function(dropId){_this.fire("UILGraph/MoveNode",{moveId:dropId,targetId:null,type:"end-of-list"})},_this.bind("UILGraphLayoutFocused",id=>{id!=_this.id&&_this.groupBridge.all.forEach(node=>{node.focused=!1})}),_this.element.goob("\n    & {\n        position: relative;\n        width: 100%;\n        height: auto;\n        font-family: sans-serif;\n        font-size: 11px;\n    }\n\n    & > .wrapper {\n        background-color: #161616;\n    }\n\n    .header {\n        width: 100%;\n        height: auto;\n        outline: none;\n        display: block;\n        padding: 4px;\n        box-sizing: border-box;\n        user-select: none;\n    }\n\n    .toggle {\n        position: relative;\n        width: 2px;\n        height: 2px;\n        fontSize: 9ps;\n        text-align: center;\n        display: inline-block;\n        vertical-align: middle;\n        border: 1px solid #b1b1b1;\n        border-radius: 50%;\n        margin-left: 2px;\n    }\n\n    .title {\n        display: inline-block;\n        vertical-align: middle;\n        marginLeft: 6px;\n    }\n\n    .children {\n        overflow: hidden;\n        transition: filter 0.1s linear;\n        filter: brightness(0.8);\n    }\n    .children:hover {\n        filter: brightness(1.0);\n    }\n\n    .lastPseudoLayer {\n        height: 8px;\n    }\n\n    .dropTarget {\n        position: relative;\n        height: 15px;\n        width: 100%;\n        margin-bottom: -15px;\n    }\n\n    .dropTarget .highlight {\n        width: 100%;\n        height: 6px;\n        background: #1A6DEA;\n        opacity: 0;\n        transition: opacity 200ms;\n    }\n\n    .dropTarget.hover .highlight{\n        opacity: 1;\n    }\n\n    & > .wrapper > .children > .dropTarget {\n        margin-bottom: 0;\n    }\n\n    .iconButton {\n        width: 16px;\n        height: 16px;\n        cursor: pointer;\n        transition: opacity 200ms;\n        stroke: var(--color-white);\n        fill: var(--color-white);\n        opacity: 0.6;\n        margin: 2px;\n    }\n    \n    .iconButton rect {\n        fill: var(--color-white);\n    }\n    \n    .iconButton:hover {\n        opacity: 1;\n    }\n"),_this.onDestroy=_=>{_this.fire("UILGraphLayout/destroy",_this.attachmentId)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILGraphLayout"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))})()},"",()=>{UILGraphLayout.VISIBILE_ICON='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M8 10C9.1046 10 10 9.1046 10 8C10 6.8954 9.1046 6 8 6C6.8954 6 6 6.8954 6 8C6 9.1046 6.8954 10 8 10Z" stroke-width="0.75" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M14 8C12.7409 9.4955 10.4789 11 8 11C5.52113 11 3.25904 9.4955 2 8C3.53237 6.57913 5.32775 5 8 5C10.6723 5 12.4677 6.5791 14 8Z" stroke-width="0.75" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>',UILGraphLayout.INVISIBLE_ICON='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M3 3L13 13" stroke-width="0.833333" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M7.09535 7.32587C7.03396 7.47036 7 7.62933 7 7.79621C7 8.461 7.53893 8.99998 8.20377 8.99998C8.40481 8.99998 8.59434 8.9507 8.76095 8.86354" stroke-width="0.833333" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M5.27945 6C4.40054 6.56451 3.66836 7.36877 3 8.12613C3.98694 9.55876 5.76015 11 7.70328 11C8.51324 11 9.29372 10.7496 10 10.3538" stroke-width="0.833333" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M8 5C10.2269 5 11.7231 6.68437 13 8.2C12.8231 8.46896 12.6224 8.73824 12.4011 9" stroke-width="0.833333" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>',UILGraphLayout.LOCKED_ICON='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M10.6667 8H11.6C11.8209 8 12 8.16788 12 8.375V12.625C12 12.8321 11.8209 13 11.6 13H4.4C4.17909 13 4 12.8321 4 12.625V8.375C4 8.16788 4.17909 8 4.4 8H5.33333M10.6667 8V5.5C10.6667 4.66667 10.1333 3 8 3C5.86667 3 5.33333 4.66667 5.33333 5.5V8M10.6667 8H5.33333" stroke-width="0.937501" stroke-linecap="round" stroke-linejoin="round"/>\n    <rect x="4" y="8" width="8" height="5" />\n    </svg>\n    ',UILGraphLayout.UNLOCKED_ICON='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M10.6667 8H11.6C11.8209 8 12 8.16787 12 8.375V12.625C12 12.8321 11.8209 13 11.6 13H4.4C4.17909 13 4 12.8321 4 12.625V8.375C4 8.16787 4.17909 8 4.4 8H5.33333H10.6667ZM10.6667 8V5.5C10.6667 4.66667 10.1333 3 8 3C7.04247 3 6.40727 3.33577 5.99796 3.78125" stroke-width="0.750001" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>\n    \n    ',UILGraphLayout.SCENE_ICON='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M13.0009 8.00124C13.0009 8.59111 12.8984 9.1589 12.7107 9.6841C12.3622 10.6588 11.7218 11.4931 10.8938 12.0814C10.0768 12.6618 9.07846 13.0025 8.00125 13.0025C6.92403 13.0025 5.92567 12.6618 5.10869 12.0814C4.28067 11.4931 3.63876 10.6588 3.29178 9.6841C3.1041 9.1589 3.00158 8.59111 3.00158 8.00124C3.00158 7.32936 3.13406 6.68745 3.37537 6.10232C3.77598 5.12446 4.47782 4.30275 5.36577 3.75074C6.12913 3.27443 7.03286 3 8.00125 3C8.96964 3 9.87178 3.27443 10.6367 3.75074C11.5247 4.30275 12.2265 5.12446 12.6271 6.10232C12.8684 6.68745 13.0009 7.32936 13.0009 8.00124Z" stroke-width="0.75" stroke-miterlimit="10"/>\n    <path d="M8.00129 3C8.96968 3 9.87183 3.27443 10.6368 3.75074C10.3339 3.82644 10.0217 3.88795 9.69992 3.93685C9.15421 4.02044 8.58485 4.0646 7.99972 4.0646C7.41458 4.0646 6.84522 4.02044 6.29951 3.93685C5.97935 3.88795 5.66706 3.82487 5.36267 3.75074C6.12918 3.27443 7.0329 3 8.00129 3Z" stroke-width="0.75" stroke-miterlimit="10"/>\n    <path d="M12.6271 6.10232C12.0419 6.25373 11.4221 6.37675 10.777 6.46822C9.89537 6.59282 8.96484 6.66064 8.00118 6.66064C7.03752 6.66064 6.10698 6.59282 5.22534 6.46822C4.58027 6.37675 3.96044 6.25373 3.37531 6.10232C3.77591 5.12446 4.47776 4.30275 5.36571 3.75074C6.12906 3.27443 7.03279 3 8.00118 3C8.96957 3 9.87172 3.27443 10.6366 3.75074C11.5246 4.30275 12.2264 5.12446 12.6271 6.10232Z" stroke-width="0.75" stroke-miterlimit="10"/>\n    <path d="M8.00116 13.0009C6.92394 13.0009 5.92559 12.6603 5.10861 12.0799C5.44139 11.9868 5.78522 11.9111 6.14166 11.8512C6.73626 11.7518 7.35925 11.6982 8.00116 11.6982C8.64307 11.6982 9.26764 11.7518 9.86066 11.8512C10.2155 11.9111 10.5609 11.9868 10.8937 12.0799C10.0767 12.6603 9.07837 13.0009 8.00116 13.0009V13.0009Z" stroke-width="0.75" stroke-miterlimit="10"/>\n    <path d="M12.7107 9.6841C12.3621 10.6588 11.7218 11.4931 10.8938 12.0814C10.0768 12.6618 9.07844 13.0025 8.00122 13.0025C6.92401 13.0025 5.92565 12.6618 5.10867 12.0814C4.28065 11.4931 3.63874 10.6588 3.29176 9.6841C3.88951 9.52638 4.52353 9.39863 5.18595 9.30242C6.08021 9.17309 7.02337 9.1037 8.00122 9.1037C8.97907 9.1037 9.92381 9.17309 10.8165 9.30242C11.4789 9.39705 12.1129 9.52638 12.7107 9.6841V9.6841Z" stroke-width="0.75" stroke-miterlimit="10"/>\n    <path d="M7.99971 13.0025C9.61028 13.0025 10.9159 10.7634 10.9159 8.00124C10.9159 5.23913 9.61028 3 7.99971 3C6.38913 3 5.0835 5.23913 5.0835 8.00124C5.0835 10.7634 6.38913 13.0025 7.99971 13.0025Z" stroke-width="0.75" stroke-miterlimit="10"/>\n    <path d="M7.99967 3V13.0009" stroke-width="0.75" stroke-miterlimit="10"/></svg>',UILGraphLayout.GROUP_ICON='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <rect x="2.5" y="2.5" width="7" height="7" />\n    <path d="M14 14V6H11V11H6V14H14Z" />\n    </svg>',UILGraphLayout.ARROW_ICON='<svg width="6" class="arrow" height="4" viewBox="0 0 6 4" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M6 0L3 4L0 -2.62268e-07L6 0Z" />\n    </svg>',UILGraphLayout.LINE_ELBOW='<svg fill="#aaaaaa" width="20px" height="22px" viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg">\n    <path d="M210.82825,178.82861h-.00013l-48,48a3.99992,3.99992,0,0,1-5.65625-5.65722L198.34277,180H64a4.0002,4.0002,0,0,1-4-4V32a4,4,0,0,1,8,0V172H198.34277l-41.1709-41.17139a3.99992,3.99992,0,0,1,5.65625-5.65722l48,48h.00013a4.02834,4.02834,0,0,1,.49841.61035c.06543.09814.11047.20434.1665.30664a3.97146,3.97146,0,0,1,.20093.38183,3.91958,3.91958,0,0,1,.126.406c.03345.11377.07751.22266.10083.34033a4.01026,4.01026,0,0,1,0,1.5669c-.02332.11767-.06738.22656-.10083.34033a3.90157,3.90157,0,0,1-.126.406,3.94471,3.94471,0,0,1-.20093.38183c-.0559.1023-.10095.2085-.1665.30664A4.02834,4.02834,0,0,1,210.82825,178.82861Z"/>\n    </svg>'}),Class(function UILGraphNode(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILGraphNode",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILGraphNode"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()},"",()=>{UILGraphNode.FOCUSED="uilgraphnode_focused",UILGraphNode.BLURRED="uilgraphnode_blurred",UILGraphNode.RENAMED="uilgraphnode_renamed",UILGraphNode.TOGGLE_VISIBILITY="uilgraphnode_toggle_visibility"}),Class(function UILGraphNodeMenu(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILGraphNodeMenu",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"wrapper",children:[{className:"iconButton",click:"$onSceneClick",_type:"div",refName:"sceneButton",children:[]},{className:"iconButton",click:"$onLockClick",_type:"div",refName:"lockButton",children:[]},{className:"iconButton",click:"$onVisibilityClick",_type:"div",refName:"visibilityButton",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.sceneButton.hide(),_this.sceneButton.html(UILGraphLayout.SCENE_ICON),_this.sceneButton.classList()[_this.params.data.scenelayout?"remove":"add"]("hidden"),_this.lockButton.html(_this.params.data.locked?UILGraphLayout.LOCKED_ICON:UILGraphLayout.UNLOCKED_ICON),_this.visibilityButton.html(_this.params.data.visible?UILGraphLayout.VISIBILE_ICON:UILGraphLayout.INVISIBLE_ICON),_this.params.data.special&&_this.visibilityButton.classList().add("hidden"),_this.onLockClick=_=>_this.params.data.set("locked",!_this.params.data.locked),_this.onVisibilityClick=_=>_this.params.data.set("visible",!_this.params.data.visible),_this.onSceneClick=_=>window.location.search=`?p=${_this.params.data.scenelayout}&uil`,_this.onInit=function(){_this.lockButton.css({pointerEvents:"all"}),_this.bind(_this.params.data,"locked",value=>{_this.lockButton.html(value?UILGraphLayout.LOCKED_ICON:UILGraphLayout.UNLOCKED_ICON),_this.fire("UILGraph/LockNode",{id:_this.params.data.id,layoutId:_this.params.layoutId,value:value}),value&&_this.set(`UIL/${_this.params.layoutId}/UILGraph/node/focused`,null)}),_this.bind(_this.params.data,"visible",val=>{_this.visibilityButton?.html(val?UILGraphLayout.VISIBILE_ICON:UILGraphLayout.INVISIBLE_ICON),_this.events.fire(UILGraphNode.TOGGLE_VISIBILITY,{..._this.params.data.toJSON(),visible:val})})},_this.element.goob("\n    .wrapper {\n        display: flex;\n        margin-right: 5px;\n        color: var(--color-icon-default);\n        align-items: right;\n    }\n\n    .iconButton.hidden {\n        display: none;\n    }\n\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILGraphNodeMenu"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILHistoryDay(_data,_index,_params){const _this=this;Inherit(_this,Element),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="UILHistoryDay",_this.contexts="Element,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{click:"$onClick",_type:"div",refName:"day",children:[{className:"day__info",_type:"div",refName:"unnamed",children:[{_type:"span",_innerText:"$data.date",refName:"unnamed",children:[]},{_type:"span",_innerText:"$data.amount",refName:"unnamed",children:[]}]},{className:"day__icon",_type:"div",refName:"icon",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onInit=function(){!function initHTML(){_this.icon.html(UILHistoryDay.arrowRightIcon)}()},_this.onClick=function(){_this.parent.parent.onSelectDay(_this.data.date)},_this.element.goob("\n    .day {\n        display: flex;\n        font: var(--label4-medium);\n        font-size: 11px;\n        justify-content: center;\n        align-items: center;\n        width: 100%;\n        padding: 1rem;\n\n        border: 1px solid transparent;\n        border-bottom-color: var(--color-neutral-40);\n\n        &:hover {\n            border-color: var(--color-accent-50);\n\n            .day__icon > svg {\n                stroke: var(--font-color-base);\n            }\n        }\n\n        &__info {\n            flex-grow: 1;\n\n            > span {\n                display: inline-block;\n\n                &:last-child {\n                    margin-left: 0.2rem;\n                }\n            }\n        }\n\n        &__icon {\n            > svg {\n                display: block;\n\n                stroke: var(--color-neutral-70);\n\n                transition: stroke 0.17s ease-in-out;\n            }\n        }\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILHistoryDay"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()},_=>{UILHistoryDay.arrowRightIcon='\n        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M6 4L10 8L6 12" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n    '}),Class(function UILHistoryPaginationButton(_data,_index,_params){const _this=this;Inherit(_this,Element),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="UILHistoryPaginationButton",_this.contexts="Element,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{href:"#",click:"$handleClick",_type:"a",_innerText:"$data.label",refName:"btn",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function calculateDisplay(){let{pageCount:pageCount,maxButtonCount:maxButtonCount,index:index}=_this.data.toJSON();if(pageCount-=1,!(pageCount<=0||pageCount<=maxButtonCount-1)){if(_this.visibleButtonIndexes=[0,pageCount],0===_this.currentPageIndex&&_this.currentPageIndex===pageCount||_this.visibleButtonIndexes.push(_this.currentPageIndex),pageCount>maxButtonCount&&(1===index&&_this.currentPageIndex>1?setEllipsis("start"):removeEllipsis(),index===pageCount-1&&_this.currentPageIndex<=pageCount-2?setEllipsis("end"):removeEllipsis()),_this.visibleButtonIndexes=[...new Set(_this.visibleButtonIndexes)],_this.visibleButtonIndexes.length<maxButtonCount){let fillButtonCount=maxButtonCount-_this.visibleButtonIndexes.length;if(_this.currentPageIndex<=Math.ceil(pageCount/2))for(let i=0;i<fillButtonCount;i++)_this.visibleButtonIndexes.push(_this.currentPageIndex+(i+1)),fillButtonCount--;else if(_this.currentPageIndex>=Math.floor(pageCount/2))for(let i=0;i<fillButtonCount;i++)_this.visibleButtonIndexes.push(_this.currentPageIndex-(i+1)),fillButtonCount--}_this.hidden=!_this.visibleButtonIndexes.includes(index)}}function setEllipsis(position){const indexes={start:1,end:_this.data.pageCount-2};_this.data.label="...",_this.btn.classList().add("disabled"),_this.visibleButtonIndexes.push(indexes[position])}function removeEllipsis(){_this.btn.classList().remove("disabled")}function setActive(value){value?_this.btn.classList().add("active"):_this.btn.classList().remove("active")}function setDisplay(){_this.hidden?_this.element.classList().add("hidden"):_this.element.classList().remove("hidden")}_this.currentPageIndex=_this.data.currentPageIndex,_this.visibleButtonIndexes=[],_this.hidden=!1,calculateDisplay(),setDisplay(),setActive(_this.data.active),_this.onInit=()=>{!function initListeners(){_this.listen("UILHistoryTab/updatePaginationIndex",value=>{console.log("value: ",value),_this.currentPageIndex=value,calculateDisplay(),setDisplay()})}()},_this.data.bind("active",value=>{setActive(value)}),_this.handleClick=()=>{_this.data.callback(_this.data.index)},_this.element.goob("\n    & {\n        display: inline-block;\n        \n        &.hidden {\n            display: none;\n        }\n    }\n\n    .btn {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        min-width: 26px;\n\n        &.disabled {\n            pointer-events: none;\n        }\n    }\n\n    .has-first-ellipsis {\n        &:after {\n            content: '...';\n        }\n    }\n\n    .has-last-ellipsis {\n        &:before {\n            content: '...';\n        }\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILHistoryPaginationButton"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILHistoryPaginationControls(_data,_index,_params){const _this=this;Inherit(_this,Element),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="UILHistoryPaginationControls",_this.contexts="Element,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"pagination",_type:"nav",refName:"unnamed",children:[{href:"#",click:"$handlePreviousClick",_type:"a",_innerText:"$state.previousLabel",refName:"btn",children:[]},{_type:"div",refName:"paginationBtnWrapper",children:[{data:"$parent.paginatedData",view:"UILHistoryPaginationButton",_type:"ViewState",refName:"unnamed",children:[]}]},{href:"#",click:"$handleNextClick",_type:"a",_innerText:"$state.nextLabel",refName:"btn",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.createState(),_this.state.set("previousLabel","<"),_this.state.set("nextLabel",">"),_this.handlePreviousClick=()=>{_this.parent.updatePaginationIndex(_this.parent.state.currentPageIndex-1)},_this.handleNextClick=()=>{_this.parent.updatePaginationIndex(_this.parent.state.currentPageIndex+1)},_this.element.goob("\n    & {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n    }\n\n    .pagination,\n    .paginationBtnWrapper {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        gap: calc(var(--spacing-small) / 2);\n    }\n\n    .pagination {\n        background-color: var(--color-neutral-20);\n        justify-content: space-between;\n        padding: var(--spacing-small);\n        width: 100%;\n        overflow-x: auto;\n    }\n\n    .btn {\n        background-color: transparent;\n        color: var(--color-white);\n        border-radius: 4px;\n        display: block;\n        font: var(--label3-simi);\n        line-height: 1;\n        text-decoration: none;\n        padding: calc(var(--spacing-small) / 4) calc(var(--spacing-small) / 2);\n\n        &.active {\n            background-color: var(--color-action);\n        }\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILHistoryPaginationControls"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILHistoryRecord(_data,_index,_params){const _this=this;Inherit(_this,Element),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="UILHistoryRecord",_this.contexts="Element,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"span",refName:"metadata",children:[]},{_type:"span",_innerText:"$data.message",refName:"message",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onInit=function(){!function initHTML(){_this.metadata.text(`${_this.data.actorName} - ${_this.data.timeFormatted}`)}()},_this.element.goob("\n    & {\n        border-bottom: 1px solid var(--color-neutral-40);\n        padding: 0.75rem 1rem;\n        word-wrap: break-word;\n        overflow-wrap: break-word;\n        word-break: break-all;\n        hyphens: auto;\n    }\n\n    .metadata,\n    .message {\n        display: flex;\n        justify-content: flex-start;\n        align-items: flex-start;\n        line-height: 14.3px;\n    }\n    \n    .metadata {\n        margin-bottom: 0.24rem;     \n        font-weight: 600;\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILHistoryRecord"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILHistoryTab(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILHistoryTab",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"history__panel days__body",_type:"div",refName:"dayPanel",children:[{data:"$dayData",view:"UILHistoryDay",_type:"ViewState",refName:"unnamed",children:[]}]},{className:"history__panel records",_type:"div",refName:"recordsPanel",children:[{className:"records__header",_type:"header",refName:"unnamed",children:[{className:"records__back",_type:"div",refName:"recordsBack",children:[]},{className:"records__date",_type:"h3",_innerText:"Date",refName:"recordsDateLabel",children:[]}]},{className:"records__body",_type:"div",refName:"unnamed",children:[{data:"$activePageData",view:"UILHistoryRecord",_type:"ViewState",refName:"unnamed",children:[]}]},{_type:"footer",refName:"footer",children:[{data:"$paginatedData",_type:"UILHistoryPaginationControls",refName:"unnamed",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;const dayDataId=_this.params?.actorId?`${_this.params.actorId}-days`:"days",recordsDataId=_this.params?.actorId?`${_this.params.actorId}-records`:"records";function paginateRecords(data,recordsPerPage=20,maxButtonCount=7){const result=[],pageCount=Math.ceil(data.length/recordsPerPage);pageCount<=1?_this.footer.classList().add("hidden"):_this.footer.classList().remove("hidden");for(let i=0;i<pageCount;i++){const start=i*recordsPerPage,end=start+recordsPerPage,pageItems=data.slice(start,end);result.push({currentPageIndex:_this.state.currentPageIndex,pageCount:pageCount,maxButtonCount:maxButtonCount,active:i===_this.state.currentPageIndex,index:i,label:`${i+1}`,items:pageItems,callback:activeIndex=>updatePaginationIndex(activeIndex)})}return result}function updatePaginationIndex(activeIndex){activeIndex<0||activeIndex>=_this.paginatedData.length||(_this.state.set("currentPageIndex",activeIndex),_this.paginatedData.forEach((page,index)=>{page.active=index===activeIndex}),updateActivePageData())}function updateActivePageData(){_this.paginatedData.refresh(paginateRecords(_this.recordsData.toJSON())),_this.activePageData.refresh(_this.paginatedData[_this.state.currentPageIndex].items)}function getTime(unixTimestamp){const date=new Date(1e3*unixTimestamp),hours=date.getHours(),minutes=date.getMinutes();return`${hours%12||12}:${minutes<10?"0":""}${minutes} ${hours>=12?"PM":"AM"}`}_this.history=function getData(){const cleanHistory=UILStorage.getHistory(_this.params?.actorId).map(item=>({actorName:"",timeFormatted:getTime(item.change.time),...item.change}));return function groupByDay(list){let result={};return list.forEach(item=>{let date=function formatDate(time){const date=new Date(time),monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],monthIndex=date.getMonth(),day=date.getDate();return`${monthNames[monthIndex]} ${day}`}(1e3*item.time);result[date]||(result[date]=[]),result[date].push(item)}),result}(cleanHistory)}(),_this.dayData=Data.request(dayDataId,()=>Object.entries(_this.history).map(([k,v])=>({date:k,amount:`(${v.length})`})).reverse()),_this.recordsData=await Data.request(recordsDataId,()=>_this.history[Object.keys(_this.history)[0]]),_this.createState(),_this.state.set("currentPageIndex",0),_this.paginatedData=new StateArray(paginateRecords(_this.recordsData.toJSON())),_this.activePageData=new StateArray(_this.paginatedData[_this.state.currentPageIndex]?.items),_this.onMounted=()=>{!function initListeners(){_this.recordsBack.click(_this.showDaysPanel)}()},_this.onInit=async function(){!async function setActorsName(){const actors=await UILStorage.getUsers();for(let key in _this.history)_this.history[key]=_this.history[key].map(record=>{const actor=actors.find(a=>a.actorId===record.actor);return record.actorName=actor?.name||"",record})}(),function initHTML(){_this.recordsBack.html(UILHistoryTab.arrowLeftIcon)}()},_this.onSelectDay=day=>{!function updateRecordsData(day){_this.state.currentPageIndex=0,_this.recordsDateLabel.text(day),_this.recordsData.refresh([..._this.history[day]].reverse()),updateActivePageData()}(day),function showRecordsPanel(){_this.dayPanel.tween({x:"-100%"},500,"easeOutCubic"),_this.recordsPanel.tween({x:"-100%"},500,"easeOutCubic")}()},_this.updatePaginationIndex=updatePaginationIndex,_this.showDaysPanel=function(){_this.dayPanel.tween({x:0},500,"easeOutCubic"),_this.recordsPanel.tween({x:0},500,"easeOutCubic")},_this.element.goob("\n    & {\n        display: flex;\n        width: 100%;\n        height: 100%;\n        pointer-events: auto;\n        overflow: hidden;\n        padding-bottom: 40px;\n    }\n\n    .history {\n        &__panel {\n            width: 100%;\n            height: 100%;\n            flex-shrink: 0;\n            padding-bottom: 40px;\n        }\n    }\n\n    .days {\n        &__body {\n            height: 100%;\n            overflow: auto;\n        }\n    }\n\n    .records {\n        display: flex;\n        flex-direction: column;\n\n        &__header {\n            display: flex;\n            align-items: center;\n\n            border-bottom: 1px solid var(--color-neutral-40);\n        }\n\n        &__body {\n            flex-grow: 1;\n            overflow: auto;\n        }\n\n        &__back {\n            padding: 0.8125rem 1rem;\n\n            &:hover {\n                > svg { stroke: var(--font-color-base); }\n            }\n\n            > svg {\n                display: block;\n\n                stroke: var(--color-neutral-70);\n\n                transition: stroke 0.17s ease-in-out;\n            }\n        }\n\n        &__date {\n            flex-grow: 1;\n            margin: 0;\n            padding: 0.8125rem 1rem 0.8125rem 0;\n        }\n\n    }\n    \n    .footer {\n        position: absolute;\n        bottom: -1px;\n        width: 100%;\n\n        &.hidden {\n            display: none;\n        }\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILHistoryTab"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()},_=>{UILHistoryTab.arrowLeftIcon='\n        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M10 4L6 8L10 12" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n    '}),Class(function UILHistoryTabs(_params,...restArgs){const _this=this;Inherit(_this,UILBaseTabs),Inherit(_this,XComponent),_this.fragName="UILHistoryTabs",_this.contexts="UILBaseTabs",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.ready=!1,_this.createState(),_this.state.set("tabsData",new StateArray(_this.params)),_this.state.set("activeIndex",0),_this.element.goob("\n    & {}\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILHistoryTabs"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILInputButton(_data,_index,_params){const _this=this;Inherit(_this,Element),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="UILInputButton",_this.contexts="Element,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"button small",click:"$data.callback",_type:"button",_innerText:"$data.title",refName:"button",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILInputButton"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILInputNumber(_data,_index,_params){const _this=this;Inherit(_this,Element),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="UILInputNumber",_this.contexts="Element,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{type:"number",ariaLabelledBy:"$data.labelledBy",min:"$data.min",max:"$data.max",step:"$data.step",_type:"input",refName:"input",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let _timeout,_distance,_onMouseDownValue,onInit=_this.onInit,_editing=!1,_pointer=[0,0],_prevPointer=[0,0],_onInputCB=()=>{},_onFinishCB=()=>{};function setValue(value){if((value=parseFloat(value).toFixed(_this.data.precision)||0)<_this.data.min&&(value=_this.data.min),value>_this.data.max&&(value=_this.data.max),isNaN(Number(value)))return _this.value=0;_this.value=Number(value),_this.data.onInputCB(_this.value,_this.master)}function updateValueAndInput(value,showDecimals=!1){setValue(value);let displayValue=showDecimals?parseFloat(_this.value).toFixed(_this.data.precision):_this.value;_editing||(_this.input.div.value=displayValue)}function onBlur(){updateValueAndInput(_this.input.div.value,!0),onFinishChange(!0)}function onKeyUp(e){13===e.keyCode&&(e.altKey?(_this.master=!0,onInput(),_this.data.onFinishCB(_this.value,_this.master)):(setValue(_this.value),_this.data.onFinishCB(_this.value,_this.master)))}function onInput(){clearTimeout(_timeout),_timeout=setTimeout(finishInput,800),_editing=!0,_this.value=_this.input.div.value}function finishInput(){isNaN(_this.input.div.value)||(setValue(_this.input.div.value),onFinishChange())}function onFinishChange(force=!1){(_editing||force)&&(_editing=!1,clearTimeout(_timeout),_this.data.onFinishCB(_this.value,_this.master),updateValueAndInput(_this.input.div.value,!0),_this.master=!1)}function onMouseDown(e){(1===e.button||0===e.button&&e.metaKey||e.ctrlKey)&&(e.preventDefault(),_this.input.css({cursor:"col-resize"}),_distance=0,_onMouseDownValue=_this.value,_prevPointer=[e.screenX,e.screenY],document.addEventListener("mousemove",onMouseMove,!1),document.addEventListener("mouseup",onMouseUp,!1))}function onMouseMove(e){clearTimeout(_timeout),_editing=!0;let currentValue=_this.value;_pointer=[e.screenX,e.screenY],_distance+=_pointer[0]-_prevPointer[0]-(_pointer[1]-_prevPointer[1]);let value=Number(_onMouseDownValue)+.05*Number(_distance/(e.shiftKey?5:50));value=Math.min(_this.data.max,Math.max(_this.data.min,value)),_this.master=e.altKey,currentValue!==value&&function setValueDrag(value){void 0===value&&value===_this.input.div.value||(setValue(value),_this.input.div.value=_this.value.toFixed(_this.data.precision),clearTimeout(_this.dragCallback),_this.dragCallback=Timer.create(_=>_this.data.onFinishCB(_this.value,_this.master),100))}(value),_prevPointer=[e.screenX,e.screenY]}function onMouseUp(e){onFinishChange(),_this.input.css({cursor:""}),document.removeEventListener("mousemove",onMouseMove,!1),document.removeEventListener("mouseup",onMouseUp,!1)}_this.master,_this.dragCallback,_this.onMounted=()=>{updateValueAndInput(_this.data.value,!0)},function initListeners(){_this.input.div.addEventListener("mousedown",onMouseDown,!1),_this.input.div.addEventListener("keyup",onKeyUp,!1),_this.input.div.addEventListener("change",onFinishChange,!1),_this.input.div.addEventListener("blur",onBlur,!1),_this.input.div.addEventListener("input",onInput,!1)}(),_this.data.bind("value",value=>{updateValueAndInput(value)}),_this.getValue=()=>_this.value,_this.publicSetValue=value=>{_editing?setValue(value):updateValueAndInput(value)},_this.onInput=cb=>cb,_this.onFinish=cb=>cb,_this.forceUpdate=function(value){updateValueAndInput(value)},_this.onDestroy=function(){_this.input.div.removeEventListener("mousedown",onMouseDown,!1),_this.input.div.removeEventListener("change",onFinishChange,!1),_this.input.div.removeEventListener("blur",onBlur,!1),_this.input.div.removeEventListener("input",onInput,!1)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILInputNumber"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILMemory(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILMemory",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{data:"$statsData",view:"UILPerformanceItem",_type:"ViewState",refName:"unnamed",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.statsData=new StateArray(Object.entries(RenderCount.map).map(([key,value])=>({key:key,value:value}))),_this.startRender(function updateStats(){if(!_this.params.active)return;Object.entries(RenderCount.map).forEach(([key,value])=>{let isKeyMapped=!1;_this.statsData.forEach(d=>d.get("key")===key&&(isKeyMapped=!0)),isKeyMapped||_this.statsData.push({key:key,value:value})}),_this.statsData.forEach(d=>d.set("value",RenderCount.map[d.get("key")]))},10),RenderCount.active=!0,_this.element.goob("\n    & {\n        width: 100%;\n        padding: var(--spacing-small);\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILMemory"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILPanel(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILPanel",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"container",children:[{_type:"UILPanelToolbar",refName:"toolbar",children:[]},{id:"$params.title",options:"$folderOptions",_type:"UILFolder",refName:"folder",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.createState(),_this.state.set("historyIsOpen",!1),_this.ready=!1,_this.id=_this.params.title,_this.folderOptions={hideTitle:!0,drag:!1};let _hidden=!1;function toggleHistory(){_this.state.set("historyIsOpen",!_this.state.historyIsOpen),_this.state.historyIsOpen?_this.element.classList().add("open"):_this.element.classList().remove("open"),_this.fire("historyPanelToggle",_this.state.historyIsOpen)}function onKeydown(e){const tagName=e.target?.tagName?.toLowerCase()||"";if(e.ctrlKey||e.metaKey){if("h"==e.key&&e.shiftKey){if(`${document.activeElement.type}`.includes(["textarea","input","number"]))return;e.preventDefault(),_hidden?function show(){_this.element.visible(),_hidden=!1}():function hide(){_this.element.invisible(),_hidden=!0}()}"input"!==tagName&&"textarea"!==tagName&&("ArrowLeft"==e.key&&e.shiftKey&&(e.preventDefault(),_this.element.css({left:0,right:"auto"})),"ArrowRight"==e.key&&e.shiftKey&&(e.preventDefault(),_this.element.css({left:"auto",right:0})),"ArrowUp"!=e.key&&"ArrowDown"!=e.key||!e.shiftKey||(e.preventDefault(),_this.element.div.style.removeProperty("right"),_this.element.div.style.removeProperty("left")),"c"==e.key&&e.shiftKey&&(e.preventDefault(),_this.folder.forEachFolder(f=>f.close())),"o"==e.key&&e.shiftKey&&(e.preventDefault(),_this.folder.forEachFolder(f=>f.open())))}}_this.onMounted=()=>{_this.element.mouseEnabled(!0),_this.ready=!0,_this.params?.options?.hideToolbar&&_this.toolbar.element.hide(),function initListeners(){document.addEventListener("keydown",onKeydown,!1),"history"===_this.id&&(_this.element.show(),_this.bind("UILBaseTabs/toggle-history-panel",toggleHistory))}()},_this.element.classList().add("prevent_interaction3d"),_this.element.classList().add(_this.params.title),"offscreen"===_this.params?.options?.side&&_this.element.classList().add("offscreen"),_this.add=async function(child){return await _this.wait(()=>_this.ready),await defer(),_this.element.show(),child instanceof UILBaseTabs?(_this.element.div.prepend(child.element.div),_this):"global"===_this.id&&child instanceof UILFolder?(UIL.globalTabs.addGlobalFolder(child),_this):(_this.folder.add(child),_this)},_this.remove=function(x){return _this.folder.remove(x.id),_this},_this.get=function(id){return _this.folder.getChildById(id)},_this.find=function(id){return _this.folder.find(id)},_this.filter=function(str){return _this.folder.filter(str)},_this.enableSorting=function(key){return _this.folder.enableSorting&&_this.folder.enableSorting(key),_this},_this.eliminate=function(){_this.toolbar.eliminate(),document.removeEventListener("keydown",onKeydown,!1)},_this.element.div.style.cssText=`\n    --panel-width: ${_this.params?.options?.width||"300px"};\n    --panel-height: ${_this.params?.options?.height||"100vh"};\n    --panel-max-height: ${_this.params?.options?.maxHeight||"100vh"};\n    --timing: ${TweenManager._getEase("easeOutCubic")};\n`,_this.element.goob(`\n    & {\n        background-color: var(--panel-background-color);\n        width: var(--panel-width);\n        height: var(--panel-height);\n        max-height: var(--panel-max-height);\n        user-select: none;\n        position: absolute;\n        top: 0;\n        left: ${"left"===_this.params?.options?.side?"0":"auto"};\n        right: ${"left"!==_this.params?.options?.side?"0":"auto"};\n        opacity: 0.6;\n        transition: opacity 0.2s var(--timing);\n        pointer-events: all;\n        border-radius: ${"left"===_this.params?.options?.side?"0 20px 20px 0":"20px 0 0 20px"};\n        resize: both;\n        direction: ${"left"!==_this.params?.options?.side?"rtl":"ltr"};\n        overflow: hidden;\n\n        .container {\n            direction: ltr;\n            overflow-y: auto;\n            max-height: 100%;\n        }\n\n        &:hover {\n            opacity: 1;\n        }\n    }\n\n    &.history {\n        opacity: 1;\n        transform: translateX(calc(var(--panel-width) + 10px));\n        transition: transform 0.5s ease-out;\n\n        &.open {\n            transform: translateX(0);\n        }\n    }\n`),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILPanel"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILPanelToolbar(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILPanelToolbar",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"input",refName:"filterInput",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit,_state=new Map;function restoreFolderState(){_this.parent.folder.forEachFolder(folder=>{_state.get(folder)?folder.open():folder.close()}),_state.clear()}function onInput(e){if(!_this.filterInput.div.value.length)return restoreFolderState(),_this.parent.folder.showChildren();_this.parent.folder.filter(_this.filterInput.div.value)}function onFocus(){!function saveFolderState(){_this.parent.folder.forEachFolder(folder=>{_state.set(folder,folder.isOpen())})}(),_this.filterInput.css({border:"1px solid #37a1ef"})}function onBlur(){_this.filterInput.css({border:"1px solid #2e2e2e"})}function onKeyPressed(e){if(27===e.keyCode)return _this.filterInput.div.value="",restoreFolderState(),_this.parent.folder.showChildren()}_this.ready=!1,function initListeners(){_this.filterInput.div.addEventListener("input",onInput,!1),_this.filterInput.div.addEventListener("keydown",onKeyPressed,!1),_this.filterInput.div.addEventListener("focus",onFocus,!1),_this.filterInput.div.addEventListener("blur",onBlur,!1)}(),_this.onMounted=()=>{_this.ready=!0},_this.eliminate=function(){_this.filterInput.div.removeEventListener("input",onInput,!1),_this.filterInput.div.removeEventListener("keydown",onKeyPressed,!1),_this.filterInput.div.removeEventListener("focus",onFocus,!1),_this.filterInput.div.removeEventListener("blur",onBlur,!1)},_this.filter=function(text){_this.filterInput.div.value=text,onInput()},_this.filterSingle=async function(text){_this.filterInput.div.value=text,_this?.parent?.folder?.filterSingle(_this.filterInput.div.value)},_this.getDataForFolder=function(node_id){_this?.parent?.folder?.getChildrenIds(node_id)},_this.getParentFolder=function(){return _this?.parent?.folder},_this.hideAll=function(){_this.flag("init")||(_this.flag("init",!0),this.filterSingle("xxxxxx"))},_this.element.goob("\n    & {\n        background-color: var(--panel-background-color);\n        padding: calc(var(--spacing-small) / 2);\n        padding-bottom: 0;\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILPanelToolbar"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILPerformance(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILPerformance",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{data:"$statsData",view:"UILPerformanceItem",_type:"ViewState",refName:"unnamed",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.statsData=new StateArray(Object.entries(RenderStats.stats).map(([key,value])=>({key:key,value:value}))),_this.startRender(function updateStats(){if(RenderStats.active=_this.params.active,!_this.params.active)return;Object.entries(RenderStats.stats).forEach(([key,value])=>{let isKeyMapped=!1;_this.statsData.forEach(d=>d.get("key")===key&&(isKeyMapped=!0)),isKeyMapped||_this.statsData.push({key:key,value:value})}),_this.statsData.forEach(d=>d.set("value",RenderStats.stats[d.get("key")]))},10),_this.element.goob("\n    & {\n        width: 100%;\n        padding: var(--spacing-small);\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILPerformance"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILPerformanceItem(_data,_index,_params){const _this=this;Inherit(_this,ViewStateElement),Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILPerformanceItem",_this.contexts="ViewStateElement,Element",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"span",_innerText:"$data.key",refName:"unnamed",children:[]},{_type:"span",_innerText:"$data.value",refName:"unnamed",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.element.goob("\n    & {\n        display: flex;\n        font: var(--label3);\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: calc(var(--spacing-small) / 2);\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILPerformanceItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILSaveIndicator(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILSaveIndicator",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"uil-save-indicator",_type:"div",refName:"container",children:[{_type:"UILSpinner",refName:"spinner",children:[]},{_type:"span",_innerText:"\n                Saving...\n            ",refName:"unnamed",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.bind("UILStorage/saving",value=>{value?_this.element.classList().add("saving"):_this.element.classList().remove("saving")}),_this.element.goob("\n    & {\n        position: absolute;\n        bottom: 0;\n        left: 50%;\n        transform: translate(-50%, 140%);\n        transition: transform 0.2s ease-out;\n    }\n\n    &.saving {\n        transform: translate(-50%, 0);\n    }\n\n    .uil-save-indicator {\n        position: relative;\n        background-color: var(--color-highlight);\n        color: var(--color-primary-text);\n        padding: var(--spacing-small) var(--spacing-large);\n        border-radius: var(--border-radius);\n        border-bottom-left-radius: 0;\n        border-bottom-right-radius: 0;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: var(--spacing-small);\n    }\n\n    .spinner {\n        width: 20px;\n        height: 20px;\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILSaveIndicator"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILSpinner(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILSpinner",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{className:"spinner",_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"spinnercontainer",children:[{"aria-hidden":!0,viewBox:"0 0 50 50",_type:"svg",refName:"spinnersvg",children:[{cx:25,cy:25,r:19,stroke:"currentColor","stroke-width":2,fill:"none",_type:"circle",refName:"unnamed",children:[]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.element.goob("\n    @keyframes lrotate {\n        100% {\n            transform: rotate(360deg);\n        }\n    }\n\n    @keyframes ldash {\n        0% {\n            stroke-dasharray: 1, 122;\n            stroke-dashoffset: 0;\n        }\n      \n        50% {\n            stroke-dasharray: 122, 150;\n            stroke-dashoffset: 0;\n        }\n      \n        100% {\n            stroke-dasharray: 122, 150;\n            stroke-dashoffset: -122;\n        }\n    }\n\n    svg {\n        animation: lrotate 2s linear infinite;\n    }\n\n    circle {\n        animation: ldash 4s ease-in-out infinite;\n    }\n\n    & {\n        width: 20px;\n        height: 20px;\n        svg {\n          display: block;\n          position: relative;\n          width: 100%;\n          height: 100%;\n        }\n    \n        circle {\n            stroke-linecap: round;\n            stroke: currentColor;\n            vector-effect: non-scaling-stroke;\n        }\n    }\n\n    \n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILSpinner"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILTabs(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILTabs",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"header",refName:"tabsHeader",children:[{_type:"nav",refName:"nav",children:[{view:"UILTabsNavItem",data:"$state.tabsData",_type:"ViewState",refName:"unnamed",children:[]}]}]},{_type:"section",refName:"tabsContent",children:[{view:"UILTabsContentItem",data:"$state.tabsData",_type:"ViewState",refName:"unnamed",children:[]}]},{click:"$handleHistoryClick",_type:"button",refName:"historyButton",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.ready=!1,_this.createState(),_this.state.set("tabsData",new StateArray(_this.params)),_this.state.set("activeIndex",0),_this.state.set("historyLabel","History"),_this.state.bind("historyLabel",_this.historyButton),_this.onMounted=async()=>{_this.historyButton.hide(),function initListeners(){_this.bindState(_this.state,"activeIndex",value=>{!function updateActiveTab(){_this.state.tabsData.forEach((tab,index)=>{tab.active=_this.state.activeIndex===index}),_this.tabsContent.tween({x:-_this.element.div.offsetWidth*_this.state.activeIndex},200,"easeOutCubic")}()}),_this.bind("UILPanel/historyPanelToggle",value=>{value?_this.state.set("historyLabel","Hide History"):_this.state.set("historyLabel","History")})}(),_this.element.attr("style",`\n        --tab-content-width: 300px;\n        --tab-count: ${_this.state.tabsData.length};\n    `),_this.ready=!0},_this.listen("UILTabsNavItem/click",event=>{_this.state.tabsData.forEach((tab,index)=>{tab.id===event.id&&_this.state.set("activeIndex",index)})}),_this.handleHistoryClick=()=>{_this.fire("toggle-history-panel")},_this.setActiveTab=index=>{_this.state.set("activeIndex",index)},_this.addTab=tabData=>{},_this.removeTab=tabId=>{},_this.setDisabledTab=tabId=>{},_this.setHiddenTab=tabId=>{},_this.addGraph=graph=>{_this.state.tabsData.find(tab=>"playground"===tab.id).content=graph},_this.addGlobalFolder=folder=>{const tabData=_this.state.tabsData.find(tab=>"global"===tab.id);folder instanceof UILFolder&&(tabData.content instanceof UILFolder?folder=[tabData.content,folder]:Array.isArray(tabData.content)&&(folder=[...tabData.content,folder])),tabData.content=folder},_this.showHistoryButton=async()=>{await _this.wait(()=>_this.ready),await defer()},_this.element.goob("\n    & {\n        box-sizing: border-box;\n        color: #fff;\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n        position: relative;\n    }\n\n    .tabsHeader {\n        background-color: var(--panel-background-color);\n        border-bottom: var(--border);\n        font: var(--label3-semi);\n        padding-left: var(--spacing-small);\n    }\n    \n    .nav {\n        display: flex;\n        width: 100%;\n    }\n\n    .tabsContent {\n        display: flex;\n        width: calc(var(--tab-content-width) * var(--tab-count));\n        height: 100%;\n\n        .UILPanel.global & {\n            height: calc(100% - 39px);\n        }\n    }\n\n    .UILTabsContentItem {\n        width: var(--tab-content-width);\n    }\n\n    .historyButton {\n        background-color: var(--color-neutral-20);\n        border: none;\n        color: var(--color-neutral-70);\n        border-radius: 0;\n        width: 100%;\n        text-align-last: left;\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        padding: var(--spacing-small);\n\n        &:hover {\n            color: var(--color-white);\n        }\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILTabs"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILTabsContentItem(_data,_index,_params){const _this=this;Inherit(_this,Element),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="UILTabsContentItem",_this.contexts="Element,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"article",refName:"contentContainer",children:[{_type:"UILPanelToolbar",refName:"toolbar",children:[]},{id:"$data.label",options:"$folderOptions",_type:"UILFolder",refName:"folder",children:[]}]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.ready=!1,_this.folderOptions={hideTitle:!0,drag:!1},_this.onMounted=()=>{_this.ready=!0,_this.set("container",_this.contentContainer)},_this.data.bind("content",async value=>{value&&(await _this.wait(()=>_this.ready),await defer(),"function"==typeof value?(destroyToolbar(),destroyFolder(),function addHydraObject(hydraObject){_this.initClass(hydraObject,_this.data,[_this.contentContainer])}(value)):value instanceof UILFolder||value&&Array.isArray(value)?function addFolder(folders){Array.isArray(folders)||(folders=[folders]);folders.filter(folder=>!_folders.includes(folder)).forEach(folder=>{_folders.push(folder),_this.folder.add(folder)})}(value):"object"==typeof value&&(destroyToolbar(),destroyFolder(),function addHTML(markup){_this.contentContainer.add(markup)}(value)))});let _folders=[];function destroyToolbar(){_this.toolbar.destroy()}function destroyFolder(){_this.folder.destroy(),_folders=[]}_this.element.goob("\n    & {\n        height: 100%;\n        max-height: 100vh;\n        overflow-y: auto;\n        \n        .UILPanel.global & {\n            max-height: calc(100vh - 40px);\n            padding-bottom: 40px;\n        }\n    }\n\n    .UILPanel.history & {\n        .contentContainer {\n            height: 100%;\n        }\n    }\n    \n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILTabsContentItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILTabsIconNavItem(_data,_index,_params){const _this=this;Inherit(_this,Element),Inherit(_this,ViewStateElement),Inherit(_this,UILTabsNavItem),Inherit(_this,XComponent),_this.fragName="UILTabsIconNavItem",_this.contexts="Element,ViewStateElement,UILTabsNavItem",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.onInit=async()=>{await _this.wait(()=>_this.ready),await defer(),UILTabsIconNavItem.icons[_this.data.id]&&_this.tab.div.insertAdjacentHTML("afterbegin",`\n        <span class="icon">${UILTabsIconNavItem.icons[_this.data.id]}</span>`)},_this.element.goob("\n    & {\n        --icon-size: 16px;\n    }\n\n    .icon {\n        display: inline-block;\n        width: var(--icon-size);\n        height: var(--icon-size);\n    }\n\n\n    .tab {\n        color: var(--color-action--disabled);\n        display: flex;\n        font: var(--label3);\n        gap: calc(var(--spacing-small) / 2);\n        padding: var(--spacing-small) var(--spacing);\n        text-decoration: none;\n        position: relative;\n\n        &:after {\n            display: none;\n        }\n        \n        &.active {\n            background-color: var(--color-action);\n            color: var(--font-color-base);\n        }\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILTabsIconNavItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()},()=>{UILTabsIconNavItem.icons={image:'\n            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 16"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M14.167 2.4v11.2a.4.4 0 0 1-.4.4h-11.2a.4.4 0 0 1-.4-.4V2.4c0-.22.179-.4.4-.4h11.2a.4.4 0 0 1 .4.4Z"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="m2.167 10.667 4.666-2L14.167 12M10.833 6.667a1.333 1.333 0 1 1 0-2.667 1.333 1.333 0 0 1 0 2.667Z"/></svg>',geometry:'\n            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 16"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M14.5 10.667V5.333a1.333 1.333 0 0 0-.667-1.153L9.167 1.513a1.333 1.333 0 0 0-1.334 0L3.167 4.18A1.333 1.333 0 0 0 2.5 5.333v5.334a1.334 1.334 0 0 0 .667 1.153l4.666 2.667a1.334 1.334 0 0 0 1.334 0l4.666-2.667a1.333 1.333 0 0 0 .667-1.153Z"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M2.68 4.64 8.5 8.007l5.82-3.367M8.5 14.72V8"/></svg>',shader:'\n            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 16"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M14.833 2.4v11.2a.4.4 0 0 1-.4.4h-11.2a.4.4 0 0 1-.4-.4V2.4c0-.22.18-.4.4-.4h11.2c.221 0 .4.18.4.4Z"/><circle cx="6.167" cy="5.333" r=".667" fill="currentColor"/><circle cx="6.167" cy="8" r=".667" fill="currentColor"/><circle cx="6.167" cy="10.667" r=".667" fill="currentColor"/><circle cx="8.833" cy="5.333" r=".667" fill="currentColor"/><circle cx="8.833" cy="8" r=".667" fill="currentColor"/><circle cx="8.833" cy="10.667" r=".667" fill="currentColor"/><circle cx="11.5" cy="5.333" r=".667" fill="currentColor"/><circle cx="11.5" cy="8" r=".667" fill="currentColor"/><circle cx="11.5" cy="10.667" r=".667" fill="currentColor"/></svg>',video:'\n            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 16"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M14.167 2.4v11.2a.4.4 0 0 1-.4.4h-11.2a.4.4 0 0 1-.4-.4V2.4c0-.22.179-.4.4-.4h11.2a.4.4 0 0 1 .4.4Z"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M6.765 5.675a.4.4 0 0 0-.598.348v3.954a.4.4 0 0 0 .598.348l3.46-1.978a.4.4 0 0 0 0-.694l-3.46-1.978Z"/></svg>',audio:'\n            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M13 5s1 1 1 2.667c0 1.666-1 2.666-1 2.666"/><path stroke="currentColor" d="M1.333 9.238V6.762c0-.736.597-1.333 1.334-1.333H4.6c.13 0 .258-.039.367-.11l4-2.637A.667.667 0 0 1 10 3.238v9.524c0 .53-.59.849-1.034.556l-3.999-2.636a.667.667 0 0 0-.367-.11H2.667a1.333 1.333 0 0 1-1.334-1.334Z"/></svg>'}}),Class(function UILTabsNavItem(_data,_index,_params){const _this=this;Inherit(_this,Element),Inherit(_this,ViewStateElement),Inherit(_this,XComponent),_this.fragName="UILTabsNavItem",_this.contexts="Element,ViewStateElement",_this.data=_data,_this.index=_index,_this.params=_params,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{click:"$onClick",href:"$state.anchor",_type:"a",_innerText:"$data.label",refName:"tab",children:[]}]}),_this.createState(),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.createState(),_this.onMounted=()=>{_this.flag("isReady",!0)},_this.ready=_=>_this.wait("isReady"),_this.onInit=async()=>{await _this.wait(()=>_this.ready),await defer(),_this.state.set("anchor",`#${_this.data.id}`),function initListeners(){_this.data.bind("active",value=>{const action=value?"add":"remove";_this.tab.classList()[action]("active")})}()},_this.onClick=event=>{event.preventDefault(),_this.fire("click",{id:_this.data.id})},_this.element.goob("\n    & {\n        &:last-of-type {\n            .tab:after {\n                display: none;\n            }\n        }\n    }\n\n    .tab {\n        color: var(--color-action--disabled);\n        display: block;\n        font: var(--label3-semi);\n        padding: var(--spacing-small);\n        text-decoration: none;\n        position: relative;\n\n        &:after {\n            content: '';\n            display: block;\n            width: 1px;\n            height: 66%;\n            background-color: var(--color-neutral-40);\n            position: absolute;\n            right: 0;\n            top: 16.666%;\n        }\n        \n        &.active {\n            color: var(--font-color-base);\n        }\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILTabsNavItem"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function UILToolsTab(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="UILToolsTab",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"panel-publish-buttons",_type:"div",refName:"publishActions",children:[{_type:"div",refName:"publishButtons",children:[]},{_type:"div",refName:"status",children:[{_type:"UILSpinner",refName:"spinner",children:[]},{_type:"div",refName:"icon",children:[]},{className:"message",_type:"p",refName:"unnamed",children:[{_type:"span",refName:"icon",children:[]},{_type:"span",_innerText:"$state.message",refName:"unnamed",children:[]}]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function updateStatus(){let publishing=_this.getSync("UIL/publishing"),errorInfo=_this.getSync("UIL/publishError"),publishedType=_this.state.publishedType;errorInfo?(_this.icon.text("").show(),_this.state.message=`Publish error: ${errorInfo.error.message||errorInfo.error.toString()}`):publishing?(_this.icon.text("").hide(),_this.state.message=`Publishing to ${publishing.type}...`):publishedType&&(_this.icon.text("").show(),_this.state.message=`Successfully published to ${publishedType}.`),publishing?_this.spinner.element.show():_this.spinner.element.hide(),_this.state.showStatus=!!(publishing||errorInfo||publishedType)}_this.state.showStatus=!1,_this.onInit=async()=>{let envs=["staging","production"];if(Array.isArray(window.USE_PUBLISHED_UIL_FOR_ENVS)&&window.USE_PUBLISHED_UIL_FOR_ENVS.length)envs=window.USE_PUBLISHED_UIL_FOR_ENVS;else if(Hydra.LOCAL){let buildJson=await get("../Tools/build.json");Array.isArray(buildJson.USE_PUBLISHED_UIL_FOR_ENVS)&&buildJson.USE_PUBLISHED_UIL_FOR_ENVS.length&&(envs=buildJson.USE_PUBLISHED_UIL_FOR_ENVS)}_this.buttons=envs.map((environment,i)=>{let button=_this.publishButtons.create("button","button");return button.classList().add("small"),i===envs.length-1&&button.classList().add("solid"),button.text(`Publish to ${environment.capitalize()}`),button.click(()=>function handlePublishClick(environment){confirm(`Are you sure you want to publish UIL to ${environment}? Remember to save your changes first. (Cmd+S or Ctrl+S)`)&&function publish(type){_this.state.publishedType=type,_this.fire("UIL/publish",{type:type})}(environment)}(environment)),button})},_this.bind("UIL/publishing",function handlePublishingChange(publishing){_this.buttons.forEach(button=>{button.attr("disabled",publishing?"disabled":null)})}),_this.bind("UIL/publishing",updateStatus),_this.bind("UIL/publishError",updateStatus),_this.bind(_this.state,"showStatus",showStatus=>{showStatus?_this.status.show():_this.status.hide()}),_this.element.goob("\n    .panel-publish-buttons {\n        padding: var(--spacing);\n        .publishButtons {\n            display: flex;\n            flex-wrap: wrap;\n            gap: var(--spacing-small);\n\n            .button {\n                flex: 1;\n                &[disabled] {\n                    cursor: not-allowed !important;\n                }\n            }\n        }\n        .status {\n            margin-top: var(--spacing-small);\n            display: flex;\n            gap: var(--spacing-small);\n            align-items: center;\n        }\n        .message {\n            display: flex;\n            align-items: flex-start;\n            gap: var(--spacing-small);\n            margin: 0;\n        }\n    }\n"),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"UILToolsTab"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function VideoEmbed(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="VideoEmbed",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{className:"video-container",_type:"div",refName:"unnamed",children:[{id:"player",_type:"div",refName:"playerContainer",children:[]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;_this.state.setAll(_this.params.videoEmbed),_this.bind(_this.state,"url",async function handleUrl(url){if(!url)return;let youtubeId=YoutubeAPI.getVideoId(_this.state.url),vimeoUrl=VimeoAPI.getVideoUrl(_this.state.url);if(youtubeId){let YT=await YoutubeAPI.api();_this.player=new YT.Player(_this.playerContainer.div,{videoId:youtubeId,playerVars:{fs:1,cc_load_policy:1,playsinline:1,rel:0}})}else if(vimeoUrl){let Vimeo=await VimeoAPI.api();_this.player=new Vimeo.Player("player",{url:vimeoUrl})}else console.error("Invalid video URL, please provide a valid YouTube or Vimeo URL")}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"VideoEmbed"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function VideoPlayer(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,XComponent),_this.fragName="VideoPlayer",_this.contexts="Element",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"div",refName:"wrapper",children:[{className:"init-play-button",_type:"div",refName:"initButton",children:[]},{_type:"div",refName:"controls",children:[{className:"play-button",click:"$togglePlaying",role:"button",_type:"button",refName:"playButton",children:[{className:"play-button-icon",_type:"div",refName:"playButtonIcon",children:[]},{className:"pause-button-icon",_type:"div",refName:"pauseButtonIcon",children:[]}]},{className:"volume-button",role:"button",_type:"button",refName:"volumeButton",children:[{className:"speaker-wrapper",_type:"div",refName:"unnamed",children:[{id:"speaker",_type:"Sprite",refName:"unnamed",children:[]},{className:"speaker-alpha",_type:"div",refName:"speakerAlpha",children:[{id:"speaker",_type:"Sprite",refName:"unnamed",children:[]}]}]},{className:"volume-wrapper",_type:"div",refName:"volumeWrapper",children:[{className:"volume-slider",_type:"div",refName:"volumeSlider",children:[{className:"volume-slider-knob",_type:"div",refName:"volumeSliderKnob",children:[]}]}]}]},{className:"progress-bar",_type:"div",refName:"progressBar",children:[{className:"progress",_type:"div",refName:"progress",children:[]}]},{className:"fullscreen-button",click:"$toggleFullscreen",role:"button",_type:"button",refName:"fullscreenButton",children:[{id:"fullscreen",_type:"Sprite",refName:"unnamed",children:[]}]}]}]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function onVolumeOver(){showVolumeSlider()}function showVolumeSlider(){if(!_this.flag||_this.flag("isVolumeSliderVisible"))return hideVolumeTimer();_this.flag("isVolumeSliderVisible",!0),_this.volumeWrapper.visible().tween({opacity:1},150,"easeOutCubic")}function hideVolumeSlider(){_this.flag&&_this.flag("isVolumeSliderVisible")&&(_this.flag("isVolumeSliderVisible",!1),_this.volumeWrapper.tween({opacity:0},150,"easeOutCubic").onComplete(_=>{_this.volumeWrapper.invisible()}))}function onVolumeStart(){_this.flag&&(_this.volumeBounds=_this.volumeWrapper.div.getBoundingClientRect(),_this.volumeBounds.top>Mouse.y||_this.volumeBounds.bottom<Mouse.y||(_this.flag("isTouchingVolume",!0),onVolumeMove(),hideVolumeTimer()))}function onVolumeMove(){_this.flag&&_this.flag("isTouchingVolume")&&(_this.state.progress=Math.range(Mouse.y,_this.volumeBounds.bottom,_this.volumeBounds.top,0,1,!0),_this.video.volume=_this.state.progress,loop(),hideVolumeTimer())}function onVolumeEnd(){_this.flag&&(_this.flag("isTouchingVolume",!1),hideVolumeTimer(),Storage.set("preferedVolume",_this.state.progress))}function hideVolumeTimer(){_this.flag&&(clearTimeout(_this.volumeHideTimer),_this.volumeHideTimer=_this.delayedCall(hideVolumeSlider,3e3))}function onProgressStart(){if(_this.flag){if(_this.progressBounds=_this.progressBar.div.getBoundingClientRect(),Mouse.x<_this.progressBounds.left||Mouse.x>_this.progressBounds.right)return _this.flag("isTouchingProgress",!1);_this.flag("isTouchingProgress",!0),defer(onProgressMove)}}function onProgressMove(){if(!_this.flag||!_this.flag("isTouchingProgress"))return;let progress=Math.range(Mouse.x,_this.progressBounds.left,_this.progressBounds.right,0,1,!0);_this.video.seek(progress*_this.duration)}function onProgressEnd(){_this.flag&&_this.flag("isTouchingProgress",!1)}function loop(){_this.params.controls&&_this.flag&&(_this.progress.x=_this.time/_this.duration*100-100+"%",_this.progress.transform(),_this.video.playing?(_this.playButtonIcon.hide(),_this.pauseButtonIcon.show()):(_this.playButtonIcon.show(),_this.pauseButtonIcon.hide()),_this.speakerAlpha.css({width:`${Math.range(100*_this.state.progress,0,100,55,100)}%`}),_this.volumeSliderKnob.css({height:100*_this.state.progress+"%"}))}_this.state.progress=0,(async()=>{await async function initPlayer(){_this.responsiveVideo=_this.initClass(ResponsiveVideo,AppState.createLocal({loop:_this.params.loop,autoplay:!!_this.params.autoplay&&!!_this.params.muted,muted:!!_this.params.muted,preload:!0,controls:!1,videoWithMeta:_this.params.videoWithMeta}),[_this.wrapper]),await _this.responsiveVideo.wait("video"),_this.video=_this.responsiveVideo.video,_this.video.object.attr("width","auto"),_this.video.object.attr("height","auto"),["src","loop","autoplay","muted","play","pause","volume","playback","time","duration","canRender","canPlayThrough","paused","buffering","seek"].map(prop=>{Object.defineProperty(_this,prop,{set:v=>_this.video[prop]=v,get:()=>_this.video[prop]})})}(),function initControls(){if(!_this.params.controls)return _this.controls.hide();_this.controls.show(),_this.controls.bind(Device.mobile?"touchstart":"mousedown",onProgressStart),Stage.bind(Device.mobile?"touchmove":"mousemove",onProgressMove),Stage.bind(Device.mobile?"touchend":"mouseup",onProgressEnd),_this.volumeWrapper.css({opacity:0}).invisible(),_this.volumeButton.bind(Device.mobile?"touchstart":"mouseover",onVolumeOver),_this.volumeWrapper.bind(Device.mobile?"touchstart":"mousedown",onVolumeStart),_this.volumeWrapper.bind(Device.mobile?"touchmove":"mousemove",showVolumeSlider),Stage.bind(Device.mobile?"touchmove":"mousemove",onVolumeMove),Stage.bind(Device.mobile?"touchend":"mouseup",onVolumeEnd);let storedVolume=parseFloat(Storage.get("preferedVolume"));isNaN(storedVolume)||(_this.video.volume=storedVolume,_this.state.progress=storedVolume)}(),_this.startRender(loop)})(),_this.togglePlaying=function(){_this.video.playing?_this.video.pause():_this.video.play()},_this.toggleFullscreen=function(){_this.video.object.div?.requestFullscreen?.()||_this.video.object.div?.webkitEnterFullscreen?.()},_this.onDestroy=function(){Stage.unbind(Device.mobile?"touchmove":"mousemove",onProgressMove),Stage.unbind(Device.mobile?"touchend":"mouseup",onProgressEnd)},onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"VideoPlayer"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function VideoPlayerModal(_params,...restArgs){const _this=this;Inherit(_this,ModalView),Inherit(_this,XComponent),_this.fragName="VideoPlayerModal",_this.contexts="ModalView",_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let onInit=_this.onInit;function clearPlayer(){_this.player&&_this.player.destroy(),_this.player=null}_this.onOpen=_=>{Stage.add(_this.element),function createPlayer(){clearPlayer();let config=_this.params.data.modalMedia,altConfig=_this.params.data.coverMedia;if("video"===config.type)_this.player=_this.initClass(VideoPlayer,AppState.createLocal({videoWithMeta:config.video?config.video:altConfig.video,controls:!0}));else _this.player=_this.initClass(VideoEmbed,AppState.createLocal({videoEmbed:{url:config.youtubeUrl?config.youtubeUrl:config.vimeoUrl}}))}(),_this.element.show().css({opacity:0}).tween({opacity:1},1e3,"easeOutCubic"),_this.set("VideoPlayerModal/isOpen",!0)},_this.onClose=_=>{_this.set("VideoPlayerModal/isOpen",!1),_this.element.tween({opacity:0},1e3,"easeOutCubic").onComplete(_=>{_this.element.hide(),_this.parent&&_this.parent.element&&_this.parent.element.add(_this.element),clearPlayer()})},_this.element.hide(),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_promises=null,_this.flag?.("__ready",!0),onInit||"VideoPlayerModal"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()}),Class(function ViewController(_params,...restArgs){const _this=this;Inherit(_this,Element),Inherit(_this,Router,null,""),Inherit(_this,XComponent),_this.fragName="ViewController",_this.contexts='Element,Router, null, ""',_this.params=_params,_this.args=arguments,this.isFragment=!0;var _promises=[];!async function(){_this.element&&(_this.element.onMountedHook=_=>_this.onMounted?.()),_this.initClass(FragUIHelper,{_type:"UI",refName:"unnamed",children:[{_type:"HeaderController",refName:"unnamed",children:[]},{_type:"PageLoadProgress",refName:"ticker",children:[]},{_type:"PageTransition",refName:"transition",children:[]},{_type:"PreviewBanner",refName:"unnamed",children:[]},{_type:"CookieBanner",refName:"unnamed",children:[]}]}),_this.layout?.getAllLayers&&(_this.layers=await _this.layout.getAllLayers());let _currentView,onInit=_this.onInit;const _isHashRouter=Hydra.LOCAL||!Device.system.pushstate;let _deeplinkHash="";_this.set("Router/hash",_deeplinkHash);const lenisOptions={lerp:!1,duration:.8,easing:TweenManager.Interpolation.Quart.Out,syncTouch:!1,autoResize:!1};function getHashFromUrl(){let hash=window.location.hash;return hash&&hash.startsWith("#")&&(hash=hash.substring(1)),hash&&hash.startsWith("!")&&(hash=""),hash}function handleResize(){let transitioning=_this.getSync("transitioning");(!transitioning||transitioning>=2)&&Global.lenis.resize()}function handleBodyClick(e){let link=e.target.closest("[data-path]");if(link){if(_this.getSync("CMS/liveModeEnabled")&&_this.flag("liveModeNavigatePrevented")!==link)return _this.flag("liveModeNavigatePrevented",link,1e3),void e.preventDefault();let path=link.dataset.path;if(link.dataset.hash&&path.substring(0,path.indexOf("#"))===_this.getSync("Router/state"))_isHashRouter&&(e.preventDefault(),_this.fire("Router/hash",link.dataset.hash,!0));else{if(e.preventDefault(),link.getAttribute("disabled"))return;_deeplinkHash=link.dataset.hash||"",_deeplinkHash&&_isHashRouter&&(path=path.substring(0,path.indexOf("#")));let query=link.dataset.query||"";_this.navigate(path,query)}}}Global.lenis?Object.assign(Global.lenis.options,lenisOptions):Global.lenis=new Lenis(lenisOptions),_this.startRender(function updateScrollState(){Global.lenis.raf(2*Render.TIME)}),_this.h(document.documentElement).onResize(handleResize),_this._bindOnDestroy(()=>{_this.h(document.documentElement).offResize(handleResize)}),_this.bind("transitioning",function updateLenisStopped(){let stopped="number"==typeof _this.getSync("transitioning");_this.set("Global/lenisStopped",!!stopped)}),_this.bind("Global/lenisStopped",function handleLenisStoppedChange(stopped){stopped?Global.lenis.stop():Global.lenis.start()}),__body.bind("click",handleBodyClick),_this._bindOnDestroy(()=>{__body.unbind("click",handleBodyClick)}),_isHashRouter||__window.bind("hashchange",function handleLocationHashChange(){if(_this.flag("debounceHash"))return;_this.flag("debounceHash",!0,100),_this.fire("Router/hash",getHashFromUrl())}),_this.bind("Router/hash",async function handleHashChange(id){const requiresImmediate=Device.system.browser.includes(["firefox"]);requiresImmediate&&await defer();if(id){let element=document.getElementById(id);if(element){let offset=element.getBoundingClientRect().y;offset-=parseFloat(window.getComputedStyle(element).marginTop);let immediate=requiresImmediate,force=requiresImmediate;Global.lenis.start(),Global.lenis.scrollTo(Global.lenis.scroll+offset,{immediate:immediate,force:force})}else Config.DEV&&console.debug(`ViewController handleHashChange(${id}) element not found`)}else _this.getSync("transitioning")||(Global.lenis.start(),Global.lenis.scrollTo(0))}),_this.bind("CMS/preview",async function handlePreviewChange(preview,wasPreview){if(!preview&&wasPreview)return async function reloadPageContent(route){if(!_this.getSync("loadedFirstRoute"))return;await defer(),await CMS.ready(),_this.getSync("Router/state")!==route?_this.navigate(route):_this.setState(route,!0)}(_this.getSync("Router/state"))}),_this.navigate=(route,query)=>{_isHashRouter?(_this._____navigate(route),query&&history.replaceState(null,null,`?${query}#!/${route}`)):query?_this._____navigate(`${route}?${query}`):_this._____navigate(route)},_this.onRouteChange=async(from,to,path,params,route)=>{let redirectPath=CMS.redirect(path);if(!1!==redirectPath)return/^[a-zA-Z][a-zA-Z0-9+\-.]*:\/\//.test(redirectPath)?void window.location.replace(redirectPath):void _this.replace(redirectPath);_deeplinkHash||_isHashRouter||(_deeplinkHash=getHashFromUrl());let hashDidChange=(_this.getSync("Router/hash")||"")!==_deeplinkHash;hashDidChange&&AppState.getMap().set("Router/hash",_deeplinkHash),_this.unset("transitionComplete"),_this.fire("transitionBegin");let isFirstPage=!_this.getSync("loadedFirstRoute");isFirstPage||_this.ticker.start();let _navState,content,prevScroll=Global.lenis.scroll,prevView=_currentView;prevView&&(prevView.element.y=-prevScroll,prevView.element.css({position:"fixed"}).transform(),Global.lenis.scrollTo(0,{immediate:!0,force:!0})),_this.set("transitioning",1);try{let view;if(content=await Data.request("page",path),content.subsectionLinks&&_this.set("ViewController/subsectionLinks",content.subsectionLinks),"book"===content.viewType)view=BookPageView,_this.set("ViewController/HeaderType","book");else view=PageView,_this.set("ViewController/HeaderType","main");_currentView=_this.createFragment(view,AppState.createLocal({content:content})),_currentView.element.invisible(),_navState=content.navState?content.navState:"light";const settings=await _this.getSync("Global/siteSettings"),title=content?.meta?.title||content?.title;title&&_this.setTitle(`${title} | ${settings.metaSiteName}`),await _currentView.ready()}catch(e){content=404===e.type?await Data.request("page","404"):await Data.request("page","400"),_currentView=_this.createFragment(PageView,AppState.createLocal({content:content})),_currentView.element.invisible();const title=content?.meta?.title||content?.title;title&&_this.setTitle(title),await _currentView.ready()}if(_this.ticker.done(),_this.set("transitioning",2),_this.fire("ViewController/transitionMidway"),isFirstPage?(_this.set("loadedFirstRoute",!0),_currentView.element.css({visibility:""}),_this.element.visible()):await _this.transition.transition(_currentView,prevView),_this.set("ViewController/navState",_navState),prevView?.destroy?.(),hashDidChange&&(_this.fire("Router/hash",_deeplinkHash),_deeplinkHash=""),content&&"article"===content._type)MixpanelAnalytics.track("page_news-detail",{path:path,title:content.title});else{const trackEvent=""===path?"page_home":`page_${path}`;MixpanelAnalytics.track(trackEvent)}Global.lenis.start(),Global.lenis.resize(),_this.set("transitioning",!1),_this.set("transitionedFirstRoute",!0),_this.fire("transitionComplete")},_this.events.sub(Component.HMR_INSTANCE_RELOADED,async function({oldInstance:oldInstance,newInstance:newInstance}){}),_this.events.sub(ViewController.NAVIGATE,({route:route})=>{_this.navigate(route)}),_this.events.sub(ViewController.BACK,()=>{window.history.back()}),_this.events.sub(ViewController.REPLACE,({route:route})=>{_this.replaceState(route)}),onInit=_this.onInit===onInit?null:_this.onInit;for(let key in _this)if(_this[key]?.then){let store=_this[key];store.then(val=>_this[key]=val),_promises.push(store)}_promises.length&&await Promise.all(_promises),_this._initFragRoutes([{path:"*"},{path:"404"}]),_promises=null,_this.flag?.("__ready",!0),onInit||"ViewController"!==_this.fragName||!_this.onInit||_this.onInit.calledInit||(onInit=_this.onInit),onInit&&(onInit.calledInit||(onInit.calledInit=!0,onInit()))}()},()=>{ViewController.NAVIGATE="ViewController.NAVIGATE",ViewController.BACK="ViewController.BACK",ViewController.REPLACE="ViewController.REPLACE"}),Class(function Main(){let pristineContextLoss=!0;function onContextLoss(){pristineContextLoss&&(pristineContextLoss=!1,console.warn("context loss"))}!function(){if(Utils.query("performance"))return Performance.displayResults();!function init(){window._PROJECT_NAME_&&(Dev.pathName=`/${window._PROJECT_NAME_}/HTML/`,Dev.filesPath=Dev.pathName);if(UnsupportedRedirect.unsupported=function(){return!1},UnsupportedRedirect.requiresWebGL=!1,UnsupportedRedirect.unsupported()){if(!window.__WEBGL_CONTEXT_LOSS)return void window.location.replace(window._UNSUPPORTED_PAGE_);onContextLoss()}Events.emitter._addEvent(Events.WEBGL_CONTEXT_LOSS,onContextLoss),"object"==typeof Config&&(Config.DEV||"dev"===Config.ENV)||Hydra.LOCAL||(ImageDecoder.disableFallbackImage=!0,Assets.disableFallbackImage=!0,Utils3D.addTextureToCache("assets/images/_scenelayout/uv.jpg",Utils3D.getEmptyTexture()));if(GLUI.init(),Mobile.allowNativeScroll(),new URLSearchParams(window.location.search).has("p"))return AssetLoader.loadAssets(Assets.list().filter(["shaders"])).then(Playground.instance);Container.instance()}()}()});