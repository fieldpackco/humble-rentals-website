(()=>{var ap=Object.create;var Et=Object.defineProperty,sp=Object.defineProperties,pp=Object.getOwnPropertyDescriptor,lp=Object.getOwnPropertyDescriptors,up=Object.getOwnPropertyNames,ln=Object.getOwnPropertySymbols,fp=Object.getPrototypeOf,un=Object.prototype.hasOwnProperty,cp=Object.prototype.propertyIsEnumerable;var lo=(e,t,r)=>t in e?Et(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_=(e,t)=>{for(var r in t||(t={}))un.call(t,r)&&lo(e,r,t[r]);if(ln)for(var r of ln(t))cp.call(t,r)&&lo(e,r,t[r]);return e},V=(e,t)=>sp(e,lp(t)),fn=e=>Et(e,"__esModule",{value:!0});var Kt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),uo=(e,t)=>{fn(e);for(var r in t)Et(e,r,{get:t[r],enumerable:!0})},dp=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of up(t))!un.call(e,o)&&o!=="default"&&Et(e,o,{get:()=>t[o],enumerable:!(r=pp(t,o))||r.enumerable});return e},Gt=e=>dp(fn(Et(e!=null?ap(fp(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var d=(e,t,r)=>(lo(e,typeof t!="symbol"?t+"":t,r),r);var fi=Kt((Ej,ui)=>{var Au;ui.exports=Au=function(){function e(t,r,o,n){this.set(t,r,o,n)}return e.prototype.set=function(t,r,o,n){this._cx=3*t,this._bx=3*(o-t)-this._cx,this._ax=1-this._cx-this._bx,this._cy=3*r,this._by=3*(n-r)-this._cy,this._ay=1-this._cy-this._by},e.epsilon=1e-6,e.prototype._sampleCurveX=function(t){return((this._ax*t+this._bx)*t+this._cx)*t},e.prototype._sampleCurveY=function(t){return((this._ay*t+this._by)*t+this._cy)*t},e.prototype._sampleCurveDerivativeX=function(t){return(3*this._ax*t+2*this._bx)*t+this._cx},e.prototype._solveCurveX=function(t,r){var o,n,i,a,s,l;for(i=void 0,a=void 0,s=void 0,l=void 0,o=void 0,n=void 0,s=t,n=0;n<8;){if(l=this._sampleCurveX(s)-t,Math.abs(l)<r)return s;if(o=this._sampleCurveDerivativeX(s),Math.abs(o)<r)break;s=s-l/o,n++}if(i=0,a=1,s=t,s<i)return i;if(s>a)return a;for(;i<a;){if(l=this._sampleCurveX(s),Math.abs(l-t)<r)return s;t>l?i=s:a=s,s=(a-i)*.5+i}return s},e.prototype.solve=function(t,r){return this._sampleCurveY(this._solveCurveX(t,r))},e.prototype.solveSimple=function(t){return this._sampleCurveY(this._solveCurveX(t,1e-6))},e}()});var ks=Kt((eO,Cs)=>{var Lr,No;Lr=[];No=[];function Yh(e,t,r){var o,n,i,a,s,l,p,u;if(e===t)return 0;if(o=e.length,n=t.length,o===0)return n;if(n===0)return o;for(r&&(e=e.toLowerCase(),t=t.toLowerCase()),p=0;p<o;)No[p]=e.charCodeAt(p),Lr[p]=++p;for(u=0;u<n;)for(i=t.charCodeAt(u),a=s=u++,p=-1;++p<o;)l=i===No[p]?s:s+1,s=Lr[p],Lr[p]=a=s>a?l>a?a+1:l:l>s?s+1:l;return a}Cs.exports=Yh});var Rs=Kt((tO,Es)=>{var Ds=ks();function Xh(){var e,t,r,o,n,i=0,a=arguments[0],s=arguments[1],l=s.length,p=arguments[2];p&&(o=p.threshold,n=p.ignoreCase),o===void 0&&(o=0);for(var u=0;u<l;++u)n?t=Ds(a,s[u],!0):t=Ds(a,s[u]),t>a.length?e=1-t/s[u].length:e=1-t/a.length,e>i&&(i=e,r=s[u]);return i>=o?r:null}Es.exports=Xh});var qo=Kt((fw,zs)=>{"use strict";zs.exports=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var o,n,i;if(Array.isArray(t)){if(o=t.length,o!=r.length)return!1;for(n=o;n--!=0;)if(!e(t[n],r[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(i=Object.keys(t),o=i.length,o!==Object.keys(r).length)return!1;for(n=o;n--!=0;)if(!Object.prototype.hasOwnProperty.call(r,i[n]))return!1;for(n=o;n--!=0;){var a=i[n];if(!e(t[a],r[a]))return!1}return!0}return t!==t&&r!==r}});var pn={};uo(pn,{createRafDriver:()=>Ft,getProject:()=>np,notify:()=>pe,onChange:()=>Rr,setCoreRafDriver:()=>zr,types:()=>Yr,val:()=>ip});var sn={};uo(sn,{createRafDriver:()=>Ft,getProject:()=>np,notify:()=>pe,onChange:()=>Rr,setCoreRafDriver:()=>zr,types:()=>Yr,val:()=>ip});var mp=Array.isArray,$=mp;var hp=typeof window=="object"&&window&&window.Object===Object&&window,Ht=hp;var gp=typeof self=="object"&&self&&self.Object===Object&&self,yp=Ht||gp||Function("return this")(),N=yp;var bp=N.Symbol,W=bp;var cn=Object.prototype,Pp=cn.hasOwnProperty,jp=cn.toString,Rt=W?W.toStringTag:void 0;function _p(e){var t=Pp.call(e,Rt),r=e[Rt];try{e[Rt]=void 0;var o=!0}catch(i){}var n=jp.call(e);return o&&(t?e[Rt]=r:delete e[Rt]),n}var dn=_p;var vp=Object.prototype,Tp=vp.toString;function xp(e){return Tp.call(e)}var mn=xp;var Sp="[object Null]",Ip="[object Undefined]",hn=W?W.toStringTag:void 0;function Ap(e){return e==null?e===void 0?Ip:Sp:hn&&hn in Object(e)?dn(e):mn(e)}var X=Ap;function Op(e){return e!=null&&typeof e=="object"}var B=Op;var wp="[object Symbol]";function Cp(e){return typeof e=="symbol"||B(e)&&X(e)==wp}var Te=Cp;var kp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Dp=/^\w*$/;function Ep(e,t){if($(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||Te(e)?!0:Dp.test(e)||!kp.test(e)||t!=null&&e in Object(t)}var et=Ep;function Rp(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var M=Rp;var Vp="[object AsyncFunction]",Np="[object Function]",Lp="[object GeneratorFunction]",Mp="[object Proxy]";function $p(e){if(!M(e))return!1;var t=X(e);return t==Np||t==Lp||t==Vp||t==Mp}var Jt=$p;var Bp=N["__core-js_shared__"],Yt=Bp;var gn=function(){var e=/[^.]+$/.exec(Yt&&Yt.keys&&Yt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Fp(e){return!!gn&&gn in e}var yn=Fp;var Up=Function.prototype,qp=Up.toString;function zp(e){if(e!=null){try{return qp.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var me=zp;var Wp=/[\\^$.*+?()[\]{}|]/g,Kp=/^\[object .+?Constructor\]$/,Gp=Function.prototype,Hp=Object.prototype,Jp=Gp.toString,Yp=Hp.hasOwnProperty,Xp=RegExp("^"+Jp.call(Yp).replace(Wp,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Zp(e){if(!M(e)||yn(e))return!1;var t=Jt(e)?Xp:Kp;return t.test(me(e))}var bn=Zp;function Qp(e,t){return e==null?void 0:e[t]}var Pn=Qp;function el(e,t){var r=Pn(e,t);return bn(r)?r:void 0}var K=el;var tl=K(Object,"create"),he=tl;function rl(){this.__data__=he?he(null):{},this.size=0}var jn=rl;function ol(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var _n=ol;var nl="__lodash_hash_undefined__",il=Object.prototype,al=il.hasOwnProperty;function sl(e){var t=this.__data__;if(he){var r=t[e];return r===nl?void 0:r}return al.call(t,e)?t[e]:void 0}var vn=sl;var pl=Object.prototype,ll=pl.hasOwnProperty;function ul(e){var t=this.__data__;return he?t[e]!==void 0:ll.call(t,e)}var Tn=ul;var fl="__lodash_hash_undefined__";function cl(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=he&&t===void 0?fl:t,this}var xn=cl;function tt(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var o=e[t];this.set(o[0],o[1])}}tt.prototype.clear=jn;tt.prototype.delete=_n;tt.prototype.get=vn;tt.prototype.has=Tn;tt.prototype.set=xn;var fo=tt;function dl(){this.__data__=[],this.size=0}var Sn=dl;function ml(e,t){return e===t||e!==e&&t!==t}var rt=ml;function hl(e,t){for(var r=e.length;r--;)if(rt(e[r][0],t))return r;return-1}var xe=hl;var gl=Array.prototype,yl=gl.splice;function bl(e){var t=this.__data__,r=xe(t,e);if(r<0)return!1;var o=t.length-1;return r==o?t.pop():yl.call(t,r,1),--this.size,!0}var In=bl;function Pl(e){var t=this.__data__,r=xe(t,e);return r<0?void 0:t[r][1]}var An=Pl;function jl(e){return xe(this.__data__,e)>-1}var On=jl;function _l(e,t){var r=this.__data__,o=xe(r,e);return o<0?(++this.size,r.push([e,t])):r[o][1]=t,this}var wn=_l;function ot(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var o=e[t];this.set(o[0],o[1])}}ot.prototype.clear=Sn;ot.prototype.delete=In;ot.prototype.get=An;ot.prototype.has=On;ot.prototype.set=wn;var Se=ot;var vl=K(N,"Map"),Ie=vl;function Tl(){this.size=0,this.__data__={hash:new fo,map:new(Ie||Se),string:new fo}}var Cn=Tl;function xl(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var kn=xl;function Sl(e,t){var r=e.__data__;return kn(t)?r[typeof t=="string"?"string":"hash"]:r.map}var Ae=Sl;function Il(e){var t=Ae(this,e).delete(e);return this.size-=t?1:0,t}var Dn=Il;function Al(e){return Ae(this,e).get(e)}var En=Al;function Ol(e){return Ae(this,e).has(e)}var Rn=Ol;function wl(e,t){var r=Ae(this,e),o=r.size;return r.set(e,t),this.size+=r.size==o?0:1,this}var Vn=wl;function nt(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var o=e[t];this.set(o[0],o[1])}}nt.prototype.clear=Cn;nt.prototype.delete=Dn;nt.prototype.get=En;nt.prototype.has=Rn;nt.prototype.set=Vn;var Be=nt;var Cl="Expected a function";function co(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Cl);var r=function(){var o=arguments,n=t?t.apply(this,o):o[0],i=r.cache;if(i.has(n))return i.get(n);var a=e.apply(this,o);return r.cache=i.set(n,a)||i,a};return r.cache=new(co.Cache||Be),r}co.Cache=Be;var Nn=co;var kl=500;function Dl(e){var t=Nn(e,function(o){return r.size===kl&&r.clear(),o}),r=t.cache;return t}var Ln=Dl;var El=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Rl=/\\(\\)?/g,Vl=Ln(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(El,function(r,o,n,i){t.push(n?i.replace(Rl,"$1"):o||r)}),t}),Mn=Vl;function Nl(e,t){for(var r=-1,o=e==null?0:e.length,n=Array(o);++r<o;)n[r]=t(e[r],r,e);return n}var $n=Nl;var Ll=1/0,Bn=W?W.prototype:void 0,Fn=Bn?Bn.toString:void 0;function Un(e){if(typeof e=="string")return e;if($(e))return $n(e,Un)+"";if(Te(e))return Fn?Fn.call(e):"";var t=e+"";return t=="0"&&1/e==-Ll?"-0":t}var Xt=Un;function Ml(e){return e==null?"":Xt(e)}var Zt=Ml;function $l(e,t){return $(e)?e:et(e,t)?[e]:Mn(Zt(e))}var Oe=$l;var Bl=1/0;function Fl(e){if(typeof e=="string"||Te(e))return e;var t=e+"";return t=="0"&&1/e==-Bl?"-0":t}var re=Fl;function Ul(e,t){t=Oe(t,e);for(var r=0,o=t.length;e!=null&&r<o;)e=e[re(t[r++])];return r&&r==o?e:void 0}var it=Ul;function ql(e,t,r){var o=e==null?void 0:it(e,t);return o===void 0?r:o}var at=ql;function zl(e,t){return function(r){return e(t(r))}}var Qt=zl;var Wl=Qt(Object.getPrototypeOf,Object),st=Wl;var Kl="[object Object]",Gl=Function.prototype,Hl=Object.prototype,qn=Gl.toString,Jl=Hl.hasOwnProperty,Yl=qn.call(Object);function Xl(e){if(!B(e)||X(e)!=Kl)return!1;var t=st(e);if(t===null)return!0;var r=Jl.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&qn.call(r)==Yl}var Vt=Xl;function Zl(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var er=Zl;var mo=new WeakMap,zn=new WeakMap,Wn=Symbol("pointerMeta"),Ql={get(e,t){if(t===Wn)return mo.get(e);let r=zn.get(e);r||(r=new Map,zn.set(e,r));let o=r.get(t);if(o!==void 0)return o;let n=mo.get(e),i=Kn({root:n.root,path:[...n.path,t]});return r.set(t,i),i}},pt=e=>e[Wn],Z=e=>{let{root:t,path:r}=pt(e);return{root:t,path:r}};function Kn(e){var o;let t={root:e.root,path:(o=e.path)!=null?o:[]},r={};return mo.set(r,t),new Proxy(r,Ql)}var ge=Kn,ae=e=>e&&!!pt(e);function ho(e,t,r){return t.length===0?r(e):tr(e,t,r)}var tr=(e,t,r)=>{if(t.length===0)return r(e);if(Array.isArray(e)){let[o,...n]=t;o=parseInt(String(o),10),isNaN(o)&&(o=0);let i=e[o],a=tr(i,n,r);if(i===a)return e;let s=[...e];return s.splice(o,1,a),s}else if(typeof e=="object"&&e!==null){let[o,...n]=t,i=e[o],a=tr(i,n,r);return i===a?e:V(_({},e),{[o]:a})}else{let[o,...n]=t;return{[o]:tr(void 0,n,r)}}};var lt=class{constructor(){this._head=void 0}peek(){return this._head&&this._head.data}pop(){let t=this._head;if(!!t)return this._head=t.next,t.data}push(t){let r={next:this._head,data:t};this._head=r}};function we(e){return!!(e&&e.isPrism&&e.isPrism===!0)}function Gn(){let e=()=>{},t=new lt,r=e;return{type:"Dataverse_discoveryMechanism",startIgnoringDependencies:()=>{t.push(r)},stopIgnoringDependencies:()=>{t.peek()!==r||t.pop()},reportResolutionStart:p=>{let u=t.peek();u&&u(p),t.push(r)},reportResolutionEnd:p=>{t.pop()},pushCollector:p=>{t.push(p)},popCollector:p=>{if(t.peek()!==p)throw new Error("Popped collector is not on top of the stack");t.pop()}}}function eu(){let e="__dataverse_discoveryMechanism_sharedStack",t=typeof window!="undefined"||typeof window!="undefined"?window:{};if(t){let r=t[e];if(r&&typeof r=="object"&&r.type==="Dataverse_discoveryMechanism")return r;{let o=Gn();return t[e]=o,o}}else return Gn()}var{startIgnoringDependencies:ut,stopIgnoringDependencies:ft,reportResolutionEnd:Hn,reportResolutionStart:Jn,pushCollector:Yn,popCollector:Xn}=eu();var Zn=()=>{},Qn=class{constructor(t,r){this._fn=t;this._prismInstance=r;this._didMarkDependentsAsStale=!1;this._isFresh=!1;this._cacheOfDendencyValues=new Map;this._dependents=new Set;this._dependencies=new Set;this._possiblyStaleDeps=new Set;this._scope=new rr(this);this._lastValue=void 0;this._forciblySetToStale=!1;this._reactToDependencyGoingStale=t=>{this._possiblyStaleDeps.add(t),this._markAsStale()};for(let o of this._dependencies)o._addDependent(this._reactToDependencyGoingStale);ut(),this.getValue(),ft()}get hasDependents(){return this._dependents.size>0}removeDependent(t){this._dependents.delete(t)}addDependent(t){this._dependents.add(t)}destroy(){for(let t of this._dependencies)t._removeDependent(this._reactToDependencyGoingStale);ti(this._scope)}getValue(){if(!this._isFresh){let t=this._recalculate();this._lastValue=t,this._isFresh=!0,this._didMarkDependentsAsStale=!1,this._forciblySetToStale=!1}return this._lastValue}_recalculate(){let t;if(!this._forciblySetToStale&&this._possiblyStaleDeps.size>0){let n=!1;ut();for(let i of this._possiblyStaleDeps)if(this._cacheOfDendencyValues.get(i)!==i.getValue()){n=!0;break}if(ft(),this._possiblyStaleDeps.clear(),!n)return this._lastValue}let r=new Set;this._cacheOfDendencyValues.clear();let o=n=>{r.add(n),this._addDependency(n)};Yn(o),G.push(this._scope);try{t=this._fn()}catch(n){console.error(n)}finally{G.pop()!==this._scope&&console.warn("The Prism hook stack has slipped. This is a bug.")}Xn(o);for(let n of this._dependencies)r.has(n)||this._removeDependency(n);this._dependencies=r,ut();for(let n of r)this._cacheOfDendencyValues.set(n,n.getValue());return ft(),t}forceStale(){this._forciblySetToStale=!0,this._markAsStale()}_markAsStale(){if(!this._didMarkDependentsAsStale){this._didMarkDependentsAsStale=!0,this._isFresh=!1;for(let t of this._dependents)t(this._prismInstance)}}_addDependency(t){this._dependencies.has(t)||(this._dependencies.add(t),t._addDependent(this._reactToDependencyGoingStale))}_removeDependency(t){!this._dependencies.has(t)||(this._dependencies.delete(t),t._removeDependent(this._reactToDependencyGoingStale))}},tu={},ei=class{constructor(t){this._fn=t;this.isPrism=!0;this._state={hot:!1,handle:void 0}}get isHot(){return this._state.hot}onChange(t,r,o=!1){let n=()=>{t.onThisOrNextTick(a)},i=tu,a=()=>{let l=this.getValue();l!==i&&(i=l,r(l))};return this._addDependent(n),o&&(i=this.getValue(),r(i)),()=>{this._removeDependent(n),t.offThisOrNextTick(a),t.offNextTick(a)}}onStale(t){let r=()=>{this._removeDependent(o)},o=()=>t();return this._addDependent(o),r}keepHot(){return this.onStale(()=>{})}_addDependent(t){this._state.hot||this._goHot(),this._state.handle.addDependent(t)}_goHot(){let t=new Qn(this._fn,this);this._state={hot:!0,handle:t}}_removeDependent(t){let r=this._state;if(!r.hot)return;let o=r.handle;o.removeDependent(t),o.hasDependents||(this._state={hot:!1,handle:void 0},o.destroy())}getValue(){Jn(this);let t=this._state,r;return t.hot?r=t.handle.getValue():r=uu(this._fn),Hn(this),r}},rr=class{constructor(t){this._hotHandle=t;this._refs=new Map;this.isPrismScope=!0;this.subs={};this.effects=new Map;this.memos=new Map}ref(t,r){let o=this._refs.get(t);if(o!==void 0)return o;{let n={current:r};return this._refs.set(t,n),n}}effect(t,r,o){let n=this.effects.get(t);n===void 0&&(n={cleanup:Zn,deps:void 0},this.effects.set(t,n)),ri(n.deps,o)&&(n.cleanup(),ut(),n.cleanup=or(r,Zn).value,ft(),n.deps=o)}memo(t,r,o){let n=this.memos.get(t);return n===void 0&&(n={cachedValue:null,deps:void 0},this.memos.set(t,n)),ri(n.deps,o)&&(ut(),n.cachedValue=or(r,void 0).value,ft(),n.deps=o),n.cachedValue}state(t,r){let{value:o,setValue:n}=this.memo("state/"+t,()=>{let i={current:r};return{value:i,setValue:s=>{i.current=s,this._hotHandle.forceStale()}}},[]);return[o.current,n]}sub(t){return this.subs[t]||(this.subs[t]=new rr(this._hotHandle)),this.subs[t]}cleanupEffects(){for(let t of this.effects.values())or(t.cleanup,void 0);this.effects.clear()}source(t,r){let o="$$source/blah";return this.effect(o,()=>t(()=>{this._hotHandle.forceStale()}),[t]),r()}};function ti(e){for(let t of Object.values(e.subs))ti(t);e.cleanupEffects()}function or(e,t){try{return{value:e(),ok:!0}}catch(r){return setTimeout(function(){throw r}),{value:t,ok:!1}}}var G=new lt;function ru(e,t){let r=G.peek();if(!r)throw new Error("prism.ref() is called outside of a prism() call.");return r.ref(e,t)}function ou(e,t,r){let o=G.peek();if(!o)throw new Error("prism.effect() is called outside of a prism() call.");return o.effect(e,t,r)}function ri(e,t){if(e===void 0||t===void 0)return!0;let r=e.length;if(r!==t.length)return!0;for(let o=0;o<r;o++)if(e[o]!==t[o])return!0;return!1}function oi(e,t,r){let o=G.peek();if(!o)throw new Error("prism.memo() is called outside of a prism() call.");return o.memo(e,t,r)}function nu(e,t){let r=G.peek();if(!r)throw new Error("prism.state() is called outside of a prism() call.");return r.state(e,t)}function iu(){if(!G.peek())throw new Error("The parent function is called outside of a prism() call.")}function au(e,t){let r=G.peek();if(!r)throw new Error("prism.scope() is called outside of a prism() call.");let o=r.sub(e);G.push(o);let n=or(t,void 0).value;return G.pop(),n}function su(e,t,r){return oi(e,()=>se(t),r).getValue()}function pu(){return!!G.peek()}function lu(e,t){let r=G.peek();if(!r)throw new Error("prism.source() is called outside of a prism() call.");return r.source(e,t)}var se=e=>new ei(e),nr=class{effect(t,r,o){console.warn("prism.effect() does not run in cold prisms")}memo(t,r,o){return r()}state(t,r){return[r,()=>{}]}ref(t,r){return{current:r}}sub(t){return new nr}source(t,r){return r()}};function uu(e){let t=new nr;G.push(t);let r;try{r=e()}catch(o){console.error(o)}finally{G.pop()!==t&&console.warn("The Prism hook stack has slipped. This is a bug.")}return r}se.ref=ru;se.effect=ou;se.memo=oi;se.ensurePrism=iu;se.state=nu;se.scope=au;se.sub=su;se.inPrism=pu;se.source=lu;var g=se;var Ce;(function(o){o[o.Dict=0]="Dict",o[o.Array=1]="Array",o[o.Other=2]="Other"})(Ce||(Ce={}));var go=e=>Array.isArray(e)?1:Vt(e)?0:2,ni=(e,t,r=go(e))=>r===0&&typeof t=="string"||r===1&&fu(t)?e[t]:void 0,fu=e=>{let t=typeof e=="number"?e:parseInt(e,10);return!isNaN(t)&&t>=0&&t<1/0&&(t|0)===t},ir=class{constructor(t,r){this._parent=t;this._path=r;this.children=new Map;this.identityChangeListeners=new Set}addIdentityChangeListener(t){this.identityChangeListeners.add(t)}removeIdentityChangeListener(t){this.identityChangeListeners.delete(t),this._checkForGC()}removeChild(t){this.children.delete(t),this._checkForGC()}getChild(t){return this.children.get(t)}getOrCreateChild(t){let r=this.children.get(t);return r||(r=r=new ir(this,this._path.concat([t])),this.children.set(t,r)),r}_checkForGC(){this.identityChangeListeners.size>0||this.children.size>0||this._parent&&this._parent.removeChild(er(this._path))}},I=class{constructor(t){this.$$isPointerToPrismProvider=!0;this.pointer=ge({root:this,path:[]});this.prism=this.pointerToPrism(this.pointer);this._onPointerValueChange=(t,r)=>{let{path:o}=Z(t),n=this._getOrCreateScopeForPath(o);return n.identityChangeListeners.add(r),()=>{n.identityChangeListeners.delete(r)}};this._currentState=t,this._rootScope=new ir(void 0,[])}set(t){let r=this._currentState;this._currentState=t,this._checkUpdates(this._rootScope,r,t)}get(){return this._currentState}getByPointer(t){let r=ae(t)?t:t(this.pointer),o=Z(r).path;return this._getIn(o)}_getIn(t){return t.length===0?this.get():at(this.get(),t)}reduce(t){this.set(t(this.get()))}reduceByPointer(t,r){let o=ae(t)?t:t(this.pointer),n=Z(o).path,i=ho(this.get(),n,r);this.set(i)}setByPointer(t,r){this.reduceByPointer(t,()=>r)}_checkUpdates(t,r,o){if(r===o)return;for(let a of t.identityChangeListeners)a(o);if(t.children.size===0)return;let n=go(r),i=go(o);if(!(n===2&&n===i))for(let[a,s]of t.children){let l=ni(r,a,n),p=ni(o,a,i);this._checkUpdates(s,l,p)}}_getOrCreateScopeForPath(t){let r=this._rootScope;for(let o of t)r=r.getOrCreateChild(o);return r}pointerToPrism(t){let{path:r}=Z(t),o=i=>this._onPointerValueChange(t,i),n=()=>this._getIn(r);return g(()=>g.source(o,n))}};var ii=new WeakMap;function cu(e){return typeof e=="object"&&e!==null&&e.$$isPointerToPrismProvider===!0}var ke=e=>{let t=pt(e),r=ii.get(t);if(!r){let o=t.root;if(!cu(o))throw new Error("Cannot run pointerToPrism() on a pointer whose root is not an PointerToPrismProvider");r=o.pointerToPrism(e),ii.set(t,r)}return r};var j=e=>ae(e)?ke(e).getValue():we(e)?e.getValue():e;var du=60*3,ct=class{constructor(t){this._conf=t;this._ticking=!1;this._dormant=!0;this._numberOfDormantTicks=0;this.__ticks=0;this._scheduledForThisOrNextTick=new Set,this._scheduledForNextTick=new Set,this._timeAtCurrentTick=0}get dormant(){return this._dormant}onThisOrNextTick(t){this._scheduledForThisOrNextTick.add(t),this._dormant&&this._goActive()}onNextTick(t){this._scheduledForNextTick.add(t),this._dormant&&this._goActive()}offThisOrNextTick(t){this._scheduledForThisOrNextTick.delete(t)}offNextTick(t){this._scheduledForNextTick.delete(t)}get time(){return this._ticking?this._timeAtCurrentTick:performance.now()}_goActive(){var t,r;!this._dormant||(this._dormant=!1,(r=(t=this._conf)==null?void 0:t.onActive)==null||r.call(t))}_goDormant(){var t,r;this._dormant||(this._dormant=!0,this._numberOfDormantTicks=0,(r=(t=this._conf)==null?void 0:t.onDormant)==null||r.call(t))}tick(t=performance.now()){if(this.__ticks++,!this._dormant&&this._scheduledForNextTick.size===0&&this._scheduledForThisOrNextTick.size===0&&(this._numberOfDormantTicks++,this._numberOfDormantTicks>=du)){this._goDormant();return}this._ticking=!0,this._timeAtCurrentTick=t;for(let r of this._scheduledForNextTick)this._scheduledForThisOrNextTick.add(r);this._scheduledForNextTick.clear(),this._tick(0),this._ticking=!1}_tick(t){let r=this.time;if(t>10&&console.warn("_tick() recursing for 10 times"),t>100)throw new Error("Maximum recursion limit for _tick()");let o=this._scheduledForThisOrNextTick;this._scheduledForThisOrNextTick=new Set;for(let n of o)n(r);if(this._scheduledForThisOrNextTick.size>0)return this._tick(t+1)}};var Fe=class{constructor(t){this.$$isPointerToPrismProvider=!0;this._currentPointerBox=new I(t),this.pointer=ge({root:this,path:[]})}setPointer(t){this._currentPointerBox.set(t)}pointerToPrism(t){let{path:r}=pt(t);return g(()=>{let o=this._currentPointerBox.prism.getValue(),n=r.reduce((i,a)=>i[a],o);return j(n)})}};var ai=class{constructor(){d(this,"atom",new I({projects:{}}))}add(t,r){this.atom.setByPointer(o=>o.projects[t],r)}get(t){return this.atom.get().projects[t]}has(t){return!!this.get(t)}remove(t){this.atom.setByPointer(r=>r.projects[t],void 0)}},mu=new ai,Ue=mu;var si=new WeakMap;function T(e){return si.get(e)}function ue(e,t){si.set(e,t)}var ar=[];function sr(e,t){return t.length===0?e:at(e,t)}var De=class{constructor(){d(this,"_values",{})}get(t,r){if(this.has(t))return this._values[t];{let o=r();return this._values[t]=o,o}}has(t){return this._values.hasOwnProperty(t)}};var hu=function(){try{var e=K(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),yo=hu;function gu(e,t,r){t=="__proto__"&&yo?yo(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var dt=gu;var yu=Object.prototype,bu=yu.hasOwnProperty;function Pu(e,t,r){var o=e[t];(!(bu.call(e,t)&&rt(o,r))||r===void 0&&!(t in e))&&dt(e,t,r)}var mt=Pu;var ju=9007199254740991,_u=/^(?:0|[1-9]\d*)$/;function vu(e,t){var r=typeof e;return t=t==null?ju:t,!!t&&(r=="number"||r!="symbol"&&_u.test(e))&&e>-1&&e%1==0&&e<t}var ht=vu;function Tu(e,t,r,o){if(!M(e))return e;t=Oe(t,e);for(var n=-1,i=t.length,a=i-1,s=e;s!=null&&++n<i;){var l=re(t[n]),p=r;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(n!=a){var u=s[l];p=o?o(u,l,s):void 0,p===void 0&&(p=M(u)?u:ht(t[n+1])?[]:{})}mt(s,l,p),s=s[l]}return e}var pi=Tu;function xu(e,t,r){return e==null?e:pi(e,t,r)}var li=xu;var bo=new WeakMap;function Po(e){return jo(e)}function jo(e){if(bo.has(e))return bo.get(e);let t=e.type==="compound"?Iu(e):e.type==="enum"?Su(e):e.default;return bo.set(e,t),t}function Su(e){let t={$case:e.defaultCase};for(let[r,o]of Object.entries(e.cases))t[r]=jo(o);return t}function Iu(e){let t={};for(let[r,o]of Object.entries(e.props))t[r]=jo(o);return t}var ci=Gt(fi());function _o(e,t,r){return g(()=>{let o=j(t);return g.memo("driver",()=>o?o.type==="BasicKeyframedTrack"?Ou(e,o,r):(e.logger.error("Track type not yet supported."),g(()=>{})):g(()=>{}),[o]).getValue()})}function Ou(e,t,r){return g(()=>{let o=g.ref("state",{started:!1}),n=o.current,i=r.getValue();return(!n.started||i<n.validFrom||n.validTo<=i)&&(o.current=n=wu(e,r,t)),n.der.getValue()})}var di=g(()=>{});function wu(e,t,r){let o=t.getValue();if(r.keyframes.length===0)return{started:!0,validFrom:-1/0,validTo:1/0,der:di};let n=0;for(;;){let i=r.keyframes[n];if(!i)return qe.error;let a=n===r.keyframes.length-1;if(o<i.position)return n===0?qe.beforeFirstKeyframe(i):qe.error;if(i.position===o)return a?qe.lastKeyframe(i):qe.between(i,r.keyframes[n+1],t);if(n===r.keyframes.length-1)return qe.lastKeyframe(i);{let s=n+1;if(r.keyframes[s].position<=o){n=s;continue}else return qe.between(i,r.keyframes[n+1],t)}}}var qe={beforeFirstKeyframe(e){return{started:!0,validFrom:-1/0,validTo:e.position,der:g(()=>({left:e.value,progression:0}))}},lastKeyframe(e){return{started:!0,validFrom:e.position,validTo:1/0,der:g(()=>({left:e.value,progression:0}))}},between(e,t,r){if(!e.connectedRight)return{started:!0,validFrom:e.position,validTo:t.position,der:g(()=>({left:e.value,progression:0}))};let o=i=>(i-e.position)/(t.position-e.position);if(!e.type||e.type==="bezier"){let i=new ci.default(e.handles[2],e.handles[3],t.handles[0],t.handles[1]),a=g(()=>{let s=o(r.getValue()),l=i.solveSimple(s);return{left:e.value,right:t.value,progression:l}});return{started:!0,validFrom:e.position,validTo:t.position,der:a}}let n=g(()=>{let i=o(r.getValue()),a=Math.floor(i);return{left:e.value,right:t.value,progression:a}});return{started:!0,validFrom:e.position,validTo:t.position,der:n}},error:{started:!0,validFrom:-1/0,validTo:1/0,der:di}};function gt(e,t,r){let n=r.get(e);if(n&&n.override===t)return n.merged;let i=_({},e);for(let a of Object.keys(t)){let s=t[a],l=e[a];i[a]=typeof s=="object"&&typeof l=="object"?gt(l,s,r):s===void 0?l:s}return r.set(e,{override:t,merged:i}),i}function ze(e,t){let r=e;for(let o of t)r=r[o];return r}var mi=(e,t)=>{let r=g.memo(e,()=>new I(t),[]);return r.set(t),r};var Cu=/\s/;function ku(e){for(var t=e.length;t--&&Cu.test(e.charAt(t)););return t}var hi=ku;var Du=/^\s+/;function Eu(e){return e&&e.slice(0,hi(e)+1).replace(Du,"")}var gi=Eu;var yi=0/0,Ru=/^[-+]0x[0-9a-f]+$/i,Vu=/^0b[01]+$/i,Nu=/^0o[0-7]+$/i,Lu=parseInt;function Mu(e){if(typeof e=="number")return e;if(Te(e))return yi;if(M(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=M(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=gi(e);var r=Vu.test(e);return r||Nu.test(e)?Lu(e.slice(2),r?2:8):Ru.test(e)?yi:+e}var ye=Mu;var bi=1/0,$u=17976931348623157e292;function Bu(e){if(!e)return e===0?e:0;if(e=ye(e),e===bi||e===-bi){var t=e<0?-1:1;return t*$u}return e===e?e:0}var Pi=Bu;function Fu(e){var t=Pi(e),r=t%1;return t===t?r?t-r:t:0}var pr=Fu;function Uu(e){return e}var ji=Uu;var qu=K(N,"WeakMap"),lr=qu;var _i=Object.create,zu=function(){function e(){}return function(t){if(!M(t))return{};if(_i)return _i(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),vi=zu;function Wu(e,t){var r=-1,o=e.length;for(t||(t=Array(o));++r<o;)t[r]=e[r];return t}var Ti=Wu;function Ku(e,t){for(var r=-1,o=e==null?0:e.length;++r<o&&t(e[r],r,e)!==!1;);return e}var xi=Ku;function Gu(e,t,r,o){var n=!r;r||(r={});for(var i=-1,a=t.length;++i<a;){var s=t[i],l=o?o(r[s],e[s],s,r,e):void 0;l===void 0&&(l=e[s]),n?dt(r,s,l):mt(r,s,l)}return r}var Ee=Gu;var Hu=9007199254740991;function Ju(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Hu}var yt=Ju;function Yu(e){return e!=null&&yt(e.length)&&!Jt(e)}var ur=Yu;var Xu=Object.prototype;function Zu(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Xu;return e===r}var bt=Zu;function Qu(e,t){for(var r=-1,o=Array(e);++r<e;)o[r]=t(r);return o}var Si=Qu;var ef="[object Arguments]";function tf(e){return B(e)&&X(e)==ef}var vo=tf;var Ii=Object.prototype,rf=Ii.hasOwnProperty,of=Ii.propertyIsEnumerable,nf=vo(function(){return arguments}())?vo:function(e){return B(e)&&rf.call(e,"callee")&&!of.call(e,"callee")},fr=nf;function af(){return!1}var Ai=af;var Oi=typeof exports=="object"&&exports&&!exports.nodeType&&exports,wi=Oi&&typeof module=="object"&&module&&!module.nodeType&&module,sf=wi&&wi.exports===Oi,Ci=sf?N.Buffer:void 0,pf=Ci?Ci.isBuffer:void 0,lf=pf||Ai,We=lf;var uf="[object Arguments]",ff="[object Array]",cf="[object Boolean]",df="[object Date]",mf="[object Error]",hf="[object Function]",gf="[object Map]",yf="[object Number]",bf="[object Object]",Pf="[object RegExp]",jf="[object Set]",_f="[object String]",vf="[object WeakMap]",Tf="[object ArrayBuffer]",xf="[object DataView]",Sf="[object Float32Array]",If="[object Float64Array]",Af="[object Int8Array]",Of="[object Int16Array]",wf="[object Int32Array]",Cf="[object Uint8Array]",kf="[object Uint8ClampedArray]",Df="[object Uint16Array]",Ef="[object Uint32Array]",E={};E[Sf]=E[If]=E[Af]=E[Of]=E[wf]=E[Cf]=E[kf]=E[Df]=E[Ef]=!0;E[uf]=E[ff]=E[Tf]=E[cf]=E[xf]=E[df]=E[mf]=E[hf]=E[gf]=E[yf]=E[bf]=E[Pf]=E[jf]=E[_f]=E[vf]=!1;function Rf(e){return B(e)&&yt(e.length)&&!!E[X(e)]}var ki=Rf;function Vf(e){return function(t){return e(t)}}var Pt=Vf;var Di=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Nt=Di&&typeof module=="object"&&module&&!module.nodeType&&module,Nf=Nt&&Nt.exports===Di,To=Nf&&Ht.process,Lf=function(){try{var e=Nt&&Nt.require&&Nt.require("util").types;return e||To&&To.binding&&To.binding("util")}catch(t){}}(),be=Lf;var Ei=be&&be.isTypedArray,Mf=Ei?Pt(Ei):ki,cr=Mf;var $f=Object.prototype,Bf=$f.hasOwnProperty;function Ff(e,t){var r=$(e),o=!r&&fr(e),n=!r&&!o&&We(e),i=!r&&!o&&!n&&cr(e),a=r||o||n||i,s=a?Si(e.length,String):[],l=s.length;for(var p in e)(t||Bf.call(e,p))&&!(a&&(p=="length"||n&&(p=="offset"||p=="parent")||i&&(p=="buffer"||p=="byteLength"||p=="byteOffset")||ht(p,l)))&&s.push(p);return s}var dr=Ff;var Uf=Qt(Object.keys,Object),Ri=Uf;var qf=Object.prototype,zf=qf.hasOwnProperty;function Wf(e){if(!bt(e))return Ri(e);var t=[];for(var r in Object(e))zf.call(e,r)&&r!="constructor"&&t.push(r);return t}var Vi=Wf;function Kf(e){return ur(e)?dr(e):Vi(e)}var fe=Kf;function Gf(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var Ni=Gf;var Hf=Object.prototype,Jf=Hf.hasOwnProperty;function Yf(e){if(!M(e))return Ni(e);var t=bt(e),r=[];for(var o in e)o=="constructor"&&(t||!Jf.call(e,o))||r.push(o);return r}var Li=Yf;function Xf(e){return ur(e)?dr(e,!0):Li(e)}var jt=Xf;function Zf(e,t){for(var r=-1,o=t.length,n=e.length;++r<o;)e[n+r]=t[r];return e}var mr=Zf;function Qf(e,t,r){var o=-1,n=e.length;t<0&&(t=-t>n?0:n+t),r=r>n?n:r,r<0&&(r+=n),n=t>r?0:r-t>>>0,t>>>=0;for(var i=Array(n);++o<n;)i[o]=e[o+t];return i}var hr=Qf;function ec(e,t,r){var o=e.length;return r=r===void 0?o:r,!t&&r>=o?e:hr(e,t,r)}var Mi=ec;var tc="\\ud800-\\udfff",rc="\\u0300-\\u036f",oc="\\ufe20-\\ufe2f",nc="\\u20d0-\\u20ff",ic=rc+oc+nc,ac="\\ufe0e\\ufe0f",sc="\\u200d",pc=RegExp("["+sc+tc+ic+ac+"]");function lc(e){return pc.test(e)}var _t=lc;function uc(e){return e.split("")}var $i=uc;var Bi="\\ud800-\\udfff",fc="\\u0300-\\u036f",cc="\\ufe20-\\ufe2f",dc="\\u20d0-\\u20ff",mc=fc+cc+dc,hc="\\ufe0e\\ufe0f",gc="["+Bi+"]",xo="["+mc+"]",So="\\ud83c[\\udffb-\\udfff]",yc="(?:"+xo+"|"+So+")",Fi="[^"+Bi+"]",Ui="(?:\\ud83c[\\udde6-\\uddff]){2}",qi="[\\ud800-\\udbff][\\udc00-\\udfff]",bc="\\u200d",zi=yc+"?",Wi="["+hc+"]?",Pc="(?:"+bc+"(?:"+[Fi,Ui,qi].join("|")+")"+Wi+zi+")*",jc=Wi+zi+Pc,_c="(?:"+[Fi+xo+"?",xo,Ui,qi,gc].join("|")+")",vc=RegExp(So+"(?="+So+")|"+_c+jc,"g");function Tc(e){return e.match(vc)||[]}var Ki=Tc;function xc(e){return _t(e)?Ki(e):$i(e)}var Gi=xc;function Sc(e,t,r){return e===e&&(r!==void 0&&(e=e<=r?e:r),t!==void 0&&(e=e>=t?e:t)),e}var Hi=Sc;function Ic(e,t,r){return r===void 0&&(r=t,t=void 0),r!==void 0&&(r=ye(r),r=r===r?r:0),t!==void 0&&(t=ye(t),t=t===t?t:0),Hi(ye(e),t,r)}var Lt=Ic;function Ac(){this.__data__=new Se,this.size=0}var Ji=Ac;function Oc(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var Yi=Oc;function wc(e){return this.__data__.get(e)}var Xi=wc;function Cc(e){return this.__data__.has(e)}var Zi=Cc;var kc=200;function Dc(e,t){var r=this.__data__;if(r instanceof Se){var o=r.__data__;if(!Ie||o.length<kc-1)return o.push([e,t]),this.size=++r.size,this;r=this.__data__=new Be(o)}return r.set(e,t),this.size=r.size,this}var Qi=Dc;function vt(e){var t=this.__data__=new Se(e);this.size=t.size}vt.prototype.clear=Ji;vt.prototype.delete=Yi;vt.prototype.get=Xi;vt.prototype.has=Zi;vt.prototype.set=Qi;var Re=vt;function Ec(e,t){return e&&Ee(t,fe(t),e)}var ea=Ec;function Rc(e,t){return e&&Ee(t,jt(t),e)}var ta=Rc;var ra=typeof exports=="object"&&exports&&!exports.nodeType&&exports,oa=ra&&typeof module=="object"&&module&&!module.nodeType&&module,Vc=oa&&oa.exports===ra,na=Vc?N.Buffer:void 0,ia=na?na.allocUnsafe:void 0;function Nc(e,t){if(t)return e.slice();var r=e.length,o=ia?ia(r):new e.constructor(r);return e.copy(o),o}var aa=Nc;function Lc(e,t){for(var r=-1,o=e==null?0:e.length,n=0,i=[];++r<o;){var a=e[r];t(a,r,e)&&(i[n++]=a)}return i}var sa=Lc;function Mc(){return[]}var gr=Mc;var $c=Object.prototype,Bc=$c.propertyIsEnumerable,pa=Object.getOwnPropertySymbols,Fc=pa?function(e){return e==null?[]:(e=Object(e),sa(pa(e),function(t){return Bc.call(e,t)}))}:gr,Tt=Fc;function Uc(e,t){return Ee(e,Tt(e),t)}var la=Uc;var qc=Object.getOwnPropertySymbols,zc=qc?function(e){for(var t=[];e;)mr(t,Tt(e)),e=st(e);return t}:gr,yr=zc;function Wc(e,t){return Ee(e,yr(e),t)}var ua=Wc;function Kc(e,t,r){var o=t(e);return $(e)?o:mr(o,r(e))}var br=Kc;function Gc(e){return br(e,fe,Tt)}var Mt=Gc;function Hc(e){return br(e,jt,yr)}var fa=Hc;var Jc=K(N,"DataView"),Pr=Jc;var Yc=K(N,"Promise"),jr=Yc;var Xc=K(N,"Set"),_r=Xc;var ca="[object Map]",Zc="[object Object]",da="[object Promise]",ma="[object Set]",ha="[object WeakMap]",ga="[object DataView]",Qc=me(Pr),ed=me(Ie),td=me(jr),rd=me(_r),od=me(lr),Ke=X;(Pr&&Ke(new Pr(new ArrayBuffer(1)))!=ga||Ie&&Ke(new Ie)!=ca||jr&&Ke(jr.resolve())!=da||_r&&Ke(new _r)!=ma||lr&&Ke(new lr)!=ha)&&(Ke=function(e){var t=X(e),r=t==Zc?e.constructor:void 0,o=r?me(r):"";if(o)switch(o){case Qc:return ga;case ed:return ca;case td:return da;case rd:return ma;case od:return ha}return t});var Pe=Ke;var nd=Object.prototype,id=nd.hasOwnProperty;function ad(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&id.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var ya=ad;var sd=N.Uint8Array,xt=sd;function pd(e){var t=new e.constructor(e.byteLength);return new xt(t).set(new xt(e)),t}var St=pd;function ld(e,t){var r=t?St(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var ba=ld;var ud=/\w*$/;function fd(e){var t=new e.constructor(e.source,ud.exec(e));return t.lastIndex=e.lastIndex,t}var Pa=fd;var ja=W?W.prototype:void 0,_a=ja?ja.valueOf:void 0;function cd(e){return _a?Object(_a.call(e)):{}}var va=cd;function dd(e,t){var r=t?St(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var Ta=dd;var md="[object Boolean]",hd="[object Date]",gd="[object Map]",yd="[object Number]",bd="[object RegExp]",Pd="[object Set]",jd="[object String]",_d="[object Symbol]",vd="[object ArrayBuffer]",Td="[object DataView]",xd="[object Float32Array]",Sd="[object Float64Array]",Id="[object Int8Array]",Ad="[object Int16Array]",Od="[object Int32Array]",wd="[object Uint8Array]",Cd="[object Uint8ClampedArray]",kd="[object Uint16Array]",Dd="[object Uint32Array]";function Ed(e,t,r){var o=e.constructor;switch(t){case vd:return St(e);case md:case hd:return new o(+e);case Td:return ba(e,r);case xd:case Sd:case Id:case Ad:case Od:case wd:case Cd:case kd:case Dd:return Ta(e,r);case gd:return new o;case yd:case jd:return new o(e);case bd:return Pa(e);case Pd:return new o;case _d:return va(e)}}var xa=Ed;function Rd(e){return typeof e.constructor=="function"&&!bt(e)?vi(st(e)):{}}var Sa=Rd;var Vd="[object Map]";function Nd(e){return B(e)&&Pe(e)==Vd}var Ia=Nd;var Aa=be&&be.isMap,Ld=Aa?Pt(Aa):Ia,Oa=Ld;var Md="[object Set]";function $d(e){return B(e)&&Pe(e)==Md}var wa=$d;var Ca=be&&be.isSet,Bd=Ca?Pt(Ca):wa,ka=Bd;var Fd=1,Ud=2,qd=4,Da="[object Arguments]",zd="[object Array]",Wd="[object Boolean]",Kd="[object Date]",Gd="[object Error]",Ea="[object Function]",Hd="[object GeneratorFunction]",Jd="[object Map]",Yd="[object Number]",Ra="[object Object]",Xd="[object RegExp]",Zd="[object Set]",Qd="[object String]",em="[object Symbol]",tm="[object WeakMap]",rm="[object ArrayBuffer]",om="[object DataView]",nm="[object Float32Array]",im="[object Float64Array]",am="[object Int8Array]",sm="[object Int16Array]",pm="[object Int32Array]",lm="[object Uint8Array]",um="[object Uint8ClampedArray]",fm="[object Uint16Array]",cm="[object Uint32Array]",C={};C[Da]=C[zd]=C[rm]=C[om]=C[Wd]=C[Kd]=C[nm]=C[im]=C[am]=C[sm]=C[pm]=C[Jd]=C[Yd]=C[Ra]=C[Xd]=C[Zd]=C[Qd]=C[em]=C[lm]=C[um]=C[fm]=C[cm]=!0;C[Gd]=C[Ea]=C[tm]=!1;function vr(e,t,r,o,n,i){var a,s=t&Fd,l=t&Ud,p=t&qd;if(r&&(a=n?r(e,o,n,i):r(e)),a!==void 0)return a;if(!M(e))return e;var u=$(e);if(u){if(a=ya(e),!s)return Ti(e,a)}else{var c=Pe(e),m=c==Ea||c==Hd;if(We(e))return aa(e,s);if(c==Ra||c==Da||m&&!n){if(a=l||m?{}:Sa(e),!s)return l?ua(e,ta(a,e)):la(e,ea(a,e))}else{if(!C[c])return n?e:{};a=xa(e,c,s)}}i||(i=new Re);var f=i.get(e);if(f)return f;i.set(e,a),ka(e)?e.forEach(function(b){a.add(vr(b,t,r,b,e,i))}):Oa(e)&&e.forEach(function(b,P){a.set(P,vr(b,t,r,P,e,i))});var y=p?l?fa:Mt:l?jt:fe,v=u?void 0:y(e);return xi(v||e,function(b,P){v&&(P=b,b=e[P]),mt(a,P,vr(b,t,r,P,e,i))}),a}var Va=vr;var dm=1,mm=4;function hm(e){return Va(e,dm|mm)}var Io=hm;var gm="__lodash_hash_undefined__";function ym(e){return this.__data__.set(e,gm),this}var Na=ym;function bm(e){return this.__data__.has(e)}var La=bm;function Tr(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Be;++t<r;)this.add(e[t])}Tr.prototype.add=Tr.prototype.push=Na;Tr.prototype.has=La;var Ma=Tr;function Pm(e,t){for(var r=-1,o=e==null?0:e.length;++r<o;)if(t(e[r],r,e))return!0;return!1}var $a=Pm;function jm(e,t){return e.has(t)}var Ba=jm;var _m=1,vm=2;function Tm(e,t,r,o,n,i){var a=r&_m,s=e.length,l=t.length;if(s!=l&&!(a&&l>s))return!1;var p=i.get(e),u=i.get(t);if(p&&u)return p==t&&u==e;var c=-1,m=!0,f=r&vm?new Ma:void 0;for(i.set(e,t),i.set(t,e);++c<s;){var y=e[c],v=t[c];if(o)var b=a?o(v,y,c,t,e,i):o(y,v,c,e,t,i);if(b!==void 0){if(b)continue;m=!1;break}if(f){if(!$a(t,function(P,x){if(!Ba(f,x)&&(y===P||n(y,P,r,o,i)))return f.push(x)})){m=!1;break}}else if(!(y===v||n(y,v,r,o,i))){m=!1;break}}return i.delete(e),i.delete(t),m}var xr=Tm;function xm(e){var t=-1,r=Array(e.size);return e.forEach(function(o,n){r[++t]=[n,o]}),r}var Fa=xm;function Sm(e){var t=-1,r=Array(e.size);return e.forEach(function(o){r[++t]=o}),r}var Ua=Sm;var Im=1,Am=2,Om="[object Boolean]",wm="[object Date]",Cm="[object Error]",km="[object Map]",Dm="[object Number]",Em="[object RegExp]",Rm="[object Set]",Vm="[object String]",Nm="[object Symbol]",Lm="[object ArrayBuffer]",Mm="[object DataView]",qa=W?W.prototype:void 0,Ao=qa?qa.valueOf:void 0;function $m(e,t,r,o,n,i,a){switch(r){case Mm:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Lm:return!(e.byteLength!=t.byteLength||!i(new xt(e),new xt(t)));case Om:case wm:case Dm:return rt(+e,+t);case Cm:return e.name==t.name&&e.message==t.message;case Em:case Vm:return e==t+"";case km:var s=Fa;case Rm:var l=o&Im;if(s||(s=Ua),e.size!=t.size&&!l)return!1;var p=a.get(e);if(p)return p==t;o|=Am,a.set(e,t);var u=xr(s(e),s(t),o,n,i,a);return a.delete(e),u;case Nm:if(Ao)return Ao.call(e)==Ao.call(t)}return!1}var za=$m;var Bm=1,Fm=Object.prototype,Um=Fm.hasOwnProperty;function qm(e,t,r,o,n,i){var a=r&Bm,s=Mt(e),l=s.length,p=Mt(t),u=p.length;if(l!=u&&!a)return!1;for(var c=l;c--;){var m=s[c];if(!(a?m in t:Um.call(t,m)))return!1}var f=i.get(e),y=i.get(t);if(f&&y)return f==t&&y==e;var v=!0;i.set(e,t),i.set(t,e);for(var b=a;++c<l;){m=s[c];var P=e[m],x=t[m];if(o)var O=a?o(x,P,m,t,e,i):o(P,x,m,e,t,i);if(!(O===void 0?P===x||n(P,x,r,o,i):O)){v=!1;break}b||(b=m=="constructor")}if(v&&!b){var U=e.constructor,q=t.constructor;U!=q&&"constructor"in e&&"constructor"in t&&!(typeof U=="function"&&U instanceof U&&typeof q=="function"&&q instanceof q)&&(v=!1)}return i.delete(e),i.delete(t),v}var Wa=qm;var zm=1,Ka="[object Arguments]",Ga="[object Array]",Sr="[object Object]",Wm=Object.prototype,Ha=Wm.hasOwnProperty;function Km(e,t,r,o,n,i){var a=$(e),s=$(t),l=a?Ga:Pe(e),p=s?Ga:Pe(t);l=l==Ka?Sr:l,p=p==Ka?Sr:p;var u=l==Sr,c=p==Sr,m=l==p;if(m&&We(e)){if(!We(t))return!1;a=!0,u=!1}if(m&&!u)return i||(i=new Re),a||cr(e)?xr(e,t,r,o,n,i):za(e,t,l,r,o,n,i);if(!(r&zm)){var f=u&&Ha.call(e,"__wrapped__"),y=c&&Ha.call(t,"__wrapped__");if(f||y){var v=f?e.value():e,b=y?t.value():t;return i||(i=new Re),n(v,b,r,o,i)}}return m?(i||(i=new Re),Wa(e,t,r,o,n,i)):!1}var Ja=Km;function Ya(e,t,r,o,n){return e===t?!0:e==null||t==null||!B(e)&&!B(t)?e!==e&&t!==t:Ja(e,t,r,o,Ya,n)}var Ir=Ya;var Gm=1,Hm=2;function Jm(e,t,r,o){var n=r.length,i=n,a=!o;if(e==null)return!i;for(e=Object(e);n--;){var s=r[n];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++n<i;){s=r[n];var l=s[0],p=e[l],u=s[1];if(a&&s[2]){if(p===void 0&&!(l in e))return!1}else{var c=new Re;if(o)var m=o(p,u,l,e,t,c);if(!(m===void 0?Ir(u,p,Gm|Hm,o,c):m))return!1}}return!0}var Xa=Jm;function Ym(e){return e===e&&!M(e)}var Ar=Ym;function Xm(e){for(var t=fe(e),r=t.length;r--;){var o=t[r],n=e[o];t[r]=[o,n,Ar(n)]}return t}var Za=Xm;function Zm(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var Or=Zm;function Qm(e){var t=Za(e);return t.length==1&&t[0][2]?Or(t[0][0],t[0][1]):function(r){return r===e||Xa(r,e,t)}}var Qa=Qm;function eh(e,t){return e!=null&&t in Object(e)}var es=eh;function th(e,t,r){t=Oe(t,e);for(var o=-1,n=t.length,i=!1;++o<n;){var a=re(t[o]);if(!(i=e!=null&&r(e,a)))break;e=e[a]}return i||++o!=n?i:(n=e==null?0:e.length,!!n&&yt(n)&&ht(a,n)&&($(e)||fr(e)))}var ts=th;function rh(e,t){return e!=null&&ts(e,t,es)}var rs=rh;var oh=1,nh=2;function ih(e,t){return et(e)&&Ar(t)?Or(re(e),t):function(r){var o=at(r,e);return o===void 0&&o===t?rs(r,e):Ir(t,o,oh|nh)}}var os=ih;function ah(e){return function(t){return t==null?void 0:t[e]}}var wr=ah;function sh(e){return function(t){return it(t,e)}}var ns=sh;function ph(e){return et(e)?wr(re(e)):ns(e)}var is=ph;function lh(e){return typeof e=="function"?e:e==null?ji:typeof e=="object"?$(e)?os(e[0],e[1]):Qa(e):is(e)}var as=lh;function uh(e){return function(t,r,o){for(var n=-1,i=Object(t),a=o(t),s=a.length;s--;){var l=a[e?s:++n];if(r(i[l],l,i)===!1)break}return t}}var ss=uh;var fh=ss(),ps=fh;function ch(e,t){return e&&ps(e,t,fe)}var ls=ch;var dh=function(){return N.Date.now()},Cr=dh;var mh="Expected a function",hh=Math.max,gh=Math.min;function yh(e,t,r){var o,n,i,a,s,l,p=0,u=!1,c=!1,m=!0;if(typeof e!="function")throw new TypeError(mh);t=ye(t)||0,M(r)&&(u=!!r.leading,c="maxWait"in r,i=c?hh(ye(r.maxWait)||0,t):i,m="trailing"in r?!!r.trailing:m);function f(A){var z=o,J=n;return o=n=void 0,p=A,a=e.apply(J,z),a}function y(A){return p=A,s=setTimeout(P,t),u?f(A):a}function v(A){var z=A-l,J=A-p,le=t-z;return c?gh(le,i-J):le}function b(A){var z=A-l,J=A-p;return l===void 0||z>=t||z<0||c&&J>=i}function P(){var A=Cr();if(b(A))return x(A);s=setTimeout(P,v(A))}function x(A){return s=void 0,m&&o?f(A):(o=n=void 0,a)}function O(){s!==void 0&&clearTimeout(s),p=0,o=l=n=s=void 0}function U(){return s===void 0?a:x(Cr())}function q(){var A=Cr(),z=b(A);if(o=arguments,n=this,l=A,z){if(s===void 0)return y(l);if(c)return clearTimeout(s),s=setTimeout(P,t),f(l)}return s===void 0&&(s=setTimeout(P,t)),a}return q.cancel=O,q.flush=U,q}var Oo=yh;function bh(e,t){return t.length<2?e:it(e,hr(t,0,-1))}var us=bh;function Ph(e){return typeof e=="number"&&e==pr(e)}var wo=Ph;function jh(e,t){var r={};return t=as(t,3),ls(e,function(o,n,i){dt(r,n,t(o,n,i))}),r}var Co=jh;function _h(e,t){return t=Oe(t,e),e=us(e,t),e==null||delete e[re(er(t))]}var fs=_h;var vh=9007199254740991,Th=Math.floor;function xh(e,t){var r="";if(!e||t<1||t>vh)return r;do t%2&&(r+=e),t=Th(t/2),t&&(e+=e);while(t);return r}var ko=xh;var Sh=wr("length"),cs=Sh;var ds="\\ud800-\\udfff",Ih="\\u0300-\\u036f",Ah="\\ufe20-\\ufe2f",Oh="\\u20d0-\\u20ff",wh=Ih+Ah+Oh,Ch="\\ufe0e\\ufe0f",kh="["+ds+"]",Do="["+wh+"]",Eo="\\ud83c[\\udffb-\\udfff]",Dh="(?:"+Do+"|"+Eo+")",ms="[^"+ds+"]",hs="(?:\\ud83c[\\udde6-\\uddff]){2}",gs="[\\ud800-\\udbff][\\udc00-\\udfff]",Eh="\\u200d",ys=Dh+"?",bs="["+Ch+"]?",Rh="(?:"+Eh+"(?:"+[ms,hs,gs].join("|")+")"+bs+ys+")*",Vh=bs+ys+Rh,Nh="(?:"+[ms+Do+"?",Do,hs,gs,kh].join("|")+")",Ps=RegExp(Eo+"(?="+Eo+")|"+Nh+Vh,"g");function Lh(e){for(var t=Ps.lastIndex=0;Ps.test(e);)++t;return t}var js=Lh;function Mh(e){return _t(e)?js(e):cs(e)}var kr=Mh;var $h=Math.ceil;function Bh(e,t){t=t===void 0?" ":Xt(t);var r=t.length;if(r<2)return r?ko(t,e):t;var o=ko(t,$h(e/kr(t)));return _t(t)?Mi(Gi(o),0,e).join(""):o.slice(0,e)}var _s=Bh;function Fh(e,t,r){e=Zt(e),t=pr(t);var o=t?kr(e):0;return t&&o<t?_s(t-o,r)+e:e}var Ge=Fh;function Uh(e,t){return e==null?!0:fs(e,t)}var Dr=Uh;var vs=5*1e3,Er=class{constructor(t){d(this,"_cache",new De);d(this,"_keepHotUntapDebounce");ue(this,t)}get type(){return"Theatre_SheetObject_PublicAPI"}get props(){return T(this).propsP}get sheet(){return T(this).sheet.publicApi}get project(){return T(this).sheet.project.publicApi}get address(){return _({},T(this).address)}_valuesPrism(){return this._cache.get("_valuesPrism",()=>{let t=T(this);return g(()=>j(t.getValues().getValue()))})}onValuesChange(t,r){return Rr(this._valuesPrism(),t,r)}get value(){let t=this._valuesPrism();if(vs!=null){if(!t.isHot){this._keepHotUntapDebounce!=null&&this._keepHotUntapDebounce.flush();let r=t.keepHot();this._keepHotUntapDebounce=Oo(()=>{r(),this._keepHotUntapDebounce=void 0},vs)}this._keepHotUntapDebounce&&this._keepHotUntapDebounce()}return t.getValue()}set initialValue(t){T(this).setInitialValue(t)}};function Ro(e){let t=new WeakMap;return r=>(t.has(r)||t.set(r,e(r)),t.get(r))}function It(e){return e.type==="compound"||e.type==="enum"}function $t(e,t){if(!e)return;let[r,...o]=t;if(r===void 0)return e;if(!It(e))return;let n=e.type==="enum"?e.cases[r]:e.props[r];return $t(n,o)}function Ts(e){return!It(e)}var qh=Ro(e=>{if(e.type==="enum")throw new Error("Not implemented yet for enums");for(let t in e.props){let r=e.props[t];if(It(r)){if(qh(r))return!0}else return!0}return!1});var Vr=class{constructor(t,r,o){this.sheet=t;this.template=r;this.nativeObject=o;d(this,"$$isPointerToPrismProvider",!0);d(this,"address");d(this,"publicApi");d(this,"_initialValue",new I({}));d(this,"_cache",new De);d(this,"_logger");d(this,"_internalUtilCtx");this._logger=t._logger.named("SheetObject",r.address.objectKey),this._logger._trace("creating object"),this._internalUtilCtx={logger:this._logger.utilFor.internal()},this.address=V(_({},r.address),{sheetInstanceId:t.address.sheetInstanceId}),this.publicApi=new Er(this)}get type(){return"Theatre_SheetObject"}getValues(){return this._cache.get("getValues()",()=>g(()=>{let t=j(this.template.getDefaultValues()),r=j(this._initialValue.pointer),o=g.memo("withInitialCache",()=>new WeakMap,[]),n=gt(t,r,o),i=j(this.template.getStaticValues()),a=g.memo("withStatics",()=>new WeakMap,[]),l=gt(n,i,a),p;{let c=g.memo("seq",()=>this.getSequencedValues(),[]),m=g.memo("withSeqsCache",()=>new WeakMap,[]);p=j(j(c)),l=gt(l,p,m)}return mi("finalAtom",l).pointer}))}getValueByPointer(t){let r=j(this.getValues()),{path:o}=Z(t);return j(ze(r,o))}pointerToPrism(t){let{path:r}=Z(t);return g(()=>{let o=j(this.getValues());return j(ze(o,r))})}getSequencedValues(){return g(()=>{let t=g.memo("tracksToProcess",()=>this.template.getArrayOfValidSequenceTracks(),[]),r=j(t),o=new I({}),n=j(this.template.configPointer);return g.effect("processTracks",()=>{let i=[];for(let{trackId:a,pathToProp:s}of r){let l=this._trackIdToPrism(a),p=$t(n,s),u=p.deserializeAndSanitize,c=p.interpolate,m=()=>{let y=l.getValue();if(!y)return o.setByPointer(O=>ze(O,s),void 0);let v=u(y.left),b=v===void 0?p.default:v;if(y.right===void 0)return o.setByPointer(O=>ze(O,s),b);let P=u(y.right),x=P===void 0?p.default:P;return o.setByPointer(O=>ze(O,s),c(b,x,y.progression))},f=l.onStale(m);m(),i.push(f)}return()=>{for(let a of i)a()}},[n,...r]),o.pointer})}_trackIdToPrism(t){let r=this.template.project.pointers.historic.sheetsById[this.address.sheetId].sequence.tracksByObject[this.address.objectKey].trackData[t],o=this.sheet.getSequence().positionPrism;return _o(this._internalUtilCtx,r,o)}get propsP(){return this._cache.get("propsP",()=>ge({root:this,path:[]}))}validateValue(t,r){}setInitialValue(t){this.validateValue(this.propsP,t),this._initialValue.set(t)}};function k(e){return function(r,o){return e(r,o())}}var F;(function(o){o[o.GENERAL=1]="GENERAL",o[o.TODO=2]="TODO",o[o.TROUBLESHOOTING=4]="TROUBLESHOOTING"})(F||(F={}));var R;(function(o){o[o.INTERNAL=8]="INTERNAL",o[o.DEV=16]="DEV",o[o.PUBLIC=32]="PUBLIC"})(R||(R={}));var S;(function(n){n[n.TRACE=64]="TRACE",n[n.DEBUG=128]="DEBUG",n[n.WARN=256]="WARN",n[n.ERROR=512]="ERROR"})(S||(S={}));var h;(function(f){f[f.ERROR_PUBLIC=545]="ERROR_PUBLIC",f[f.ERROR_DEV=529]="ERROR_DEV",f[f._HMM=524]="_HMM",f[f._TODO=522]="_TODO",f[f._ERROR=521]="_ERROR",f[f.WARN_PUBLIC=289]="WARN_PUBLIC",f[f.WARN_DEV=273]="WARN_DEV",f[f._KAPOW=268]="_KAPOW",f[f._WARN=265]="_WARN",f[f.DEBUG_DEV=145]="DEBUG_DEV",f[f._DEBUG=137]="_DEBUG",f[f.TRACE_DEV=81]="TRACE_DEV",f[f._TRACE=73]="_TRACE"})(h||(h={}));var Q={_hmm:ee(524),_todo:ee(522),_error:ee(521),errorDev:ee(529),errorPublic:ee(545),_kapow:ee(268),_warn:ee(265),warnDev:ee(273),warnPublic:ee(289),_debug:ee(137),debugDev:ee(145),_trace:ee(73),traceDev:ee(81)};function ee(e){return Object.freeze({audience:He(e,8)?"internal":He(e,16)?"dev":"public",category:He(e,4)?"troubleshooting":He(e,2)?"todo":"general",level:He(e,512)?512:He(e,256)?256:He(e,128)?128:64})}function He(e,t){return(e&t)===t}function D(e,t){return((t&32)==32?!0:(t&16)==16?e.dev:(t&8)==8?e.internal:!1)&&e.min<=t}var je={loggingConsoleStyle:!0,loggerConsoleStyle:!0,includes:Object.freeze({internal:!1,dev:!1,min:256}),filtered:function(){},include:function(){return{}},create:null,creatExt:null,named(e,t,r){return this.create({names:[...e.names,{name:t,key:r}]})},style:{bold:void 0,italic:void 0,cssMemo:new Map([["",""]]),collapseOnRE:/[a-z- ]+/g,color:void 0,collapsed(e){if(e.length<5)return e;let t=e.replace(this.collapseOnRE,"");return this.cssMemo.has(t)||this.cssMemo.set(t,this.css(e)),t},css(e){var o,n,i,a;let t=this.cssMemo.get(e);if(t)return t;let r=`color:${(n=(o=this.color)==null?void 0:o.call(this,e))!=null?n:`hsl(${(e.charCodeAt(0)+e.charCodeAt(e.length-1))%360}, 100%, 60%)`}`;return((i=this.bold)==null?void 0:i.test(e))&&(r+=";font-weight:600"),((a=this.italic)==null?void 0:a.test(e))&&(r+=";font-style:italic"),this.cssMemo.set(e,r),r}}};function Bt(e=console,t={}){let r=V(_({},je),{includes:_({},je.includes)}),o={styled:Kh.bind(r,e),noStyle:Hh.bind(r,e)},n=Wh.bind(r);function i(){return r.loggingConsoleStyle&&r.loggerConsoleStyle?o.styled:o.noStyle}return r.create=i(),{configureLogger(a){var s;a==="console"?(r.loggerConsoleStyle=je.loggerConsoleStyle,r.create=i()):a.type==="console"?(r.loggerConsoleStyle=(s=a.style)!=null?s:je.loggerConsoleStyle,r.create=i()):a.type==="keyed"?(r.creatExt=l=>a.keyed(l.names),r.create=n):a.type==="named"&&(r.creatExt=zh.bind(null,a.named),r.create=n)},configureLogging(a){var s,l,p,u,c;r.includes.dev=(s=a.dev)!=null?s:je.includes.dev,r.includes.internal=(l=a.internal)!=null?l:je.includes.internal,r.includes.min=(p=a.min)!=null?p:je.includes.min,r.include=(u=a.include)!=null?u:je.include,r.loggingConsoleStyle=(c=a.consoleStyle)!=null?c:je.loggingConsoleStyle,r.create=i()},getLogger(){return r.create({names:[]})}}}function zh(e,t){let r=[];for(let{name:o,key:n}of t.names)r.push(n==null?o:`${o} (${n})`);return e(r)}function Wh(e){let t=_(_({},this.includes),this.include(e)),r=this.filtered,o=this.named.bind(this,e),n=this.creatExt(e),i=D(t,524),a=D(t,522),s=D(t,521),l=D(t,529),p=D(t,545),u=D(t,265),c=D(t,268),m=D(t,273),f=D(t,289),y=D(t,137),v=D(t,145),b=D(t,73),P=D(t,81),x=i?n.error.bind(n,Q._hmm):r.bind(e,524),O=a?n.error.bind(n,Q._todo):r.bind(e,522),U=s?n.error.bind(n,Q._error):r.bind(e,521),q=l?n.error.bind(n,Q.errorDev):r.bind(e,529),A=p?n.error.bind(n,Q.errorPublic):r.bind(e,545),z=c?n.warn.bind(n,Q._kapow):r.bind(e,268),J=u?n.warn.bind(n,Q._warn):r.bind(e,265),le=m?n.warn.bind(n,Q.warnDev):r.bind(e,273),Ve=f?n.warn.bind(n,Q.warnPublic):r.bind(e,273),Ne=y?n.debug.bind(n,Q._debug):r.bind(e,137),Le=v?n.debug.bind(n,Q.debugDev):r.bind(e,145),Me=b?n.trace.bind(n,Q._trace):r.bind(e,73),$e=P?n.trace.bind(n,Q.traceDev):r.bind(e,81),L={_hmm:x,_todo:O,_error:U,errorDev:q,errorPublic:A,_kapow:z,_warn:J,warnDev:le,warnPublic:Ve,_debug:Ne,debugDev:Le,_trace:Me,traceDev:$e,lazy:{_hmm:i?k(x):x,_todo:a?k(O):O,_error:s?k(U):U,errorDev:l?k(q):q,errorPublic:p?k(A):A,_kapow:c?k(z):z,_warn:u?k(J):J,warnDev:m?k(le):le,warnPublic:f?k(Ve):Ve,_debug:y?k(Ne):Ne,debugDev:v?k(Le):Le,_trace:b?k(Me):Me,traceDev:P?k($e):$e},named:o,utilFor:{internal(){return{debug:L._debug,error:L._error,warn:L._warn,trace:L._trace,named(Y,w){return L.named(Y,w).utilFor.internal()}}},dev(){return{debug:L.debugDev,error:L.errorDev,warn:L.warnDev,trace:L.traceDev,named(Y,w){return L.named(Y,w).utilFor.dev()}}},public(){return{error:L.errorPublic,warn:L.warnPublic,debug(Y,w){L._warn(`(public "debug" filtered out) ${Y}`,w)},trace(Y,w){L._warn(`(public "trace" filtered out) ${Y}`,w)},named(Y,w){return L.named(Y,w).utilFor.public()}}}}};return L}function Kh(e,t){let r=_(_({},this.includes),this.include(t)),o=[],n="";for(let l=0;l<t.names.length;l++){let{name:p,key:u}=t.names[l];if(n+=` %c${p}`,o.push(this.style.css(p)),u!=null){let c=`%c#${u}`;n+=c,o.push(this.style.css(c))}}let i=this.filtered,a=this.named.bind(this,t),s=[n,...o];return xs(i,t,r,e,s,Gh(s),a)}function Gh(e){let t=e.slice(0);for(let r=1;r<t.length;r++)t[r]+=";background-color:#e0005a;padding:2px;color:white";return t}function Hh(e,t){let r=_(_({},this.includes),this.include(t)),o="";for(let s=0;s<t.names.length;s++){let{name:l,key:p}=t.names[s];o+=` ${l}`,p!=null&&(o+=`#${p}`)}let n=this.filtered,i=this.named.bind(this,t),a=[o];return xs(n,t,r,e,a,a,i)}function xs(e,t,r,o,n,i,a){let s=D(r,524),l=D(r,522),p=D(r,521),u=D(r,529),c=D(r,545),m=D(r,265),f=D(r,268),y=D(r,273),v=D(r,289),b=D(r,137),P=D(r,145),x=D(r,73),O=D(r,81),U=s?o.error.bind(o,...n):e.bind(t,524),q=l?o.error.bind(o,...n):e.bind(t,522),A=p?o.error.bind(o,...n):e.bind(t,521),z=u?o.error.bind(o,...n):e.bind(t,529),J=c?o.error.bind(o,...n):e.bind(t,545),le=f?o.warn.bind(o,...i):e.bind(t,268),Ve=m?o.warn.bind(o,...n):e.bind(t,265),Ne=y?o.warn.bind(o,...n):e.bind(t,273),Le=v?o.warn.bind(o,...n):e.bind(t,273),Me=b?o.info.bind(o,...n):e.bind(t,137),$e=P?o.info.bind(o,...n):e.bind(t,145),L=x?o.debug.bind(o,...n):e.bind(t,73),Y=O?o.debug.bind(o,...n):e.bind(t,81),w={_hmm:U,_todo:q,_error:A,errorDev:z,errorPublic:J,_kapow:le,_warn:Ve,warnDev:Ne,warnPublic:Le,_debug:Me,debugDev:$e,_trace:L,traceDev:Y,lazy:{_hmm:s?k(U):U,_todo:l?k(q):q,_error:p?k(A):A,errorDev:u?k(z):z,errorPublic:c?k(J):J,_kapow:f?k(le):le,_warn:m?k(Ve):Ve,warnDev:y?k(Ne):Ne,warnPublic:v?k(Le):Le,_debug:b?k(Me):Me,debugDev:P?k($e):$e,_trace:x?k(L):L,traceDev:O?k(Y):Y},named:a,utilFor:{internal(){return{debug:w._debug,error:w._error,warn:w._warn,trace:w._trace,named(ce,de){return w.named(ce,de).utilFor.internal()}}},dev(){return{debug:w.debugDev,error:w.errorDev,warn:w.warnDev,trace:w.traceDev,named(ce,de){return w.named(ce,de).utilFor.dev()}}},public(){return{error:w.errorPublic,warn:w.warnPublic,debug(ce,de){w._warn(`(public "debug" filtered out) ${ce}`,de)},trace(ce,de){w._warn(`(public "trace" filtered out) ${ce}`,de)},named(ce,de){return w.named(ce,de).utilFor.public()}}}}};return w}var Ss=Bt(console,{_debug:function(){},_error:function(){}});Ss.configureLogging({dev:!0,min:S.TRACE});var At=Ss.getLogger().named("Theatre.js (default logger)").utilFor.dev();var Is=new WeakMap;function Vo(e){let t=Is.get(e);if(t)return t;let r=new Map;return Is.set(e,r),As([],e,r),r}function As(e,t,r){for(let[o,n]of Object.entries(t.props))if(!It(n)){let i=[...e,o];r.set(JSON.stringify(i),r.size),Os(i,n,r)}for(let[o,n]of Object.entries(t.props))if(It(n)){let i=[...e,o];r.set(JSON.stringify(i),r.size),Os(i,n,r)}}function Os(e,t,r){if(t.type==="compound")As(e,t,r);else{if(t.type==="enum")throw new Error("Enums aren't supported yet");r.set(JSON.stringify(e),r.size)}}function ws(e){return typeof e=="object"&&e!==null&&Object.keys(e).length===0}var Nr=class{constructor(t,r,o,n,i){this.sheetTemplate=t;d(this,"address");d(this,"type","Theatre_SheetObjectTemplate");d(this,"_config");d(this,"_temp_actions_atom");d(this,"_cache",new De);d(this,"project");d(this,"pointerToSheetState");d(this,"pointerToStaticOverrides");this.address=V(_({},t.address),{objectKey:r}),this._config=new I(n),this._temp_actions_atom=new I(i),this.project=t.project,this.pointerToSheetState=this.sheetTemplate.project.pointers.historic.sheetsById[this.address.sheetId],this.pointerToStaticOverrides=this.pointerToSheetState.staticOverrides.byObject[this.address.objectKey]}get staticConfig(){return this._config.get()}get configPointer(){return this._config.pointer}get _temp_actions(){return this._temp_actions_atom.get()}get _temp_actionsPointer(){return this._temp_actions_atom.pointer}createInstance(t,r,o){return this._config.set(o),new Vr(t,this,r)}reconfigure(t){this._config.set(t)}_temp_setActions(t){this._temp_actions_atom.set(t)}getDefaultValues(){return this._cache.get("getDefaultValues()",()=>g(()=>{let t=j(this.configPointer);return Po(t)}))}getStaticValues(){return this._cache.get("getStaticValues",()=>g(()=>{var n;let t=(n=j(this.pointerToStaticOverrides))!=null?n:{};return j(this.configPointer).deserializeAndSanitize(t)||{}}))}getArrayOfValidSequenceTracks(){return this._cache.get("getArrayOfValidSequenceTracks",()=>g(()=>{let t=this.project.pointers.historic.sheetsById[this.address.sheetId],r=j(t.sequence.tracksByObject[this.address.objectKey].trackIdByPropPath);if(!r)return ar;let o=[];if(!r)return ar;let n=j(this.configPointer),i=Object.entries(r);for(let[s,l]of i){let p=Jh(s);if(!p)continue;let u=$t(n,p);!(u&&Ts(u))||o.push({pathToProp:p,trackId:l})}let a=Vo(n);return o.sort((s,l)=>{let p=s.pathToProp,u=l.pathToProp,c=a.get(JSON.stringify(p)),m=a.get(JSON.stringify(u));return c>m?1:-1}),o.length===0?ar:o}))}getMapOfValidSequenceTracks_forStudio(){return this._cache.get("getMapOfValidSequenceTracks_forStudio",()=>g(()=>{let t=j(this.getArrayOfValidSequenceTracks()),r={};for(let{pathToProp:o,trackId:n}of t)li(r,o,n);return r}))}getStaticButNotSequencedOverrides(){return this._cache.get("getStaticButNotSequencedOverrides",()=>g(()=>{let t=j(this.getStaticValues()),r=j(this.getArrayOfValidSequenceTracks()),o=Io(t);for(let{pathToProp:n}of r){Dr(o,n);let i=n.slice(0,-1);for(;i.length>0;){let a=sr(o,i);if(!ws(a))break;Dr(o,i),i=i.slice(0,-1)}}if(!ws(o))return o}))}getDefaultsAtPointer(t){let{path:r}=Z(t),o=this.getDefaultValues().getValue();return sr(o,r)}};function Jh(e){try{return JSON.parse(e)}catch(t){At.warn(`property ${JSON.stringify(e)} cannot be parsed. Skipping.`);return}}var Zh=Gt(Rs());var Vs=class extends Error{},oe=class extends Vs{};function ne(){let e,t,r=new Promise((n,i)=>{e=a=>{n(a),o.status="resolved"},t=a=>{i(a),o.status="rejected"}}),o={resolve:e,reject:t,promise:r,status:"pending"};return o}var Qh=()=>{},Ot=Qh;var Mr=class{constructor(){d(this,"_stopPlayCallback",Ot);d(this,"_state",new I({position:0,playing:!1}));d(this,"statePointer");this.statePointer=this._state.pointer}destroy(){}pause(){this._stopPlayCallback(),this.playing=!1,this._stopPlayCallback=Ot}gotoPosition(t){this._updatePositionInState(t)}_updatePositionInState(t){this._state.setByPointer(r=>r.position,t)}getCurrentPosition(){return this._state.get().position}get playing(){return this._state.get().playing}set playing(t){this._state.setByPointer(r=>r.playing,t)}play(t,r,o,n,i){this.playing&&this.pause(),this.playing=!0;let a=r[1]-r[0];{let f=this.getCurrentPosition();f<r[0]||f>r[1]?n==="normal"||n==="alternate"?this._updatePositionInState(r[0]):(n==="reverse"||n==="alternateReverse")&&this._updatePositionInState(r[1]):n==="normal"||n==="alternate"?f===r[1]&&this._updatePositionInState(r[0]):f===r[0]&&this._updatePositionInState(r[1])}let s=ne(),l=i.time,p=a*t,u=this.getCurrentPosition()-r[0];(n==="reverse"||n==="alternateReverse")&&(u=r[1]-this.getCurrentPosition());let c=f=>{let v=Math.max(f-l,0)/1e3,b=Math.min(v*o+u,p);if(b!==p){let P=Math.floor(b/a),x=b/a%1*a;if(n!=="normal")if(n==="reverse")x=a-x;else{let O=P%2==0;n==="alternate"?O||(x=a-x):O&&(x=a-x)}this._updatePositionInState(x+r[0]),m()}else{if(n==="normal")this._updatePositionInState(r[1]);else if(n==="reverse")this._updatePositionInState(r[0]);else{let P=(t-1)%2==0;n==="alternate"?P?this._updatePositionInState(r[1]):this._updatePositionInState(r[0]):P?this._updatePositionInState(r[0]):this._updatePositionInState(r[1])}this.playing=!1,s.resolve(!0)}};this._stopPlayCallback=()=>{i.offThisOrNextTick(c),i.offNextTick(c),this.playing&&s.resolve(!1)};let m=()=>i.onNextTick(c);return i.onThisOrNextTick(c),s.promise}playDynamicRange(t,r){this.playing&&this.pause(),this.playing=!0;let o=ne(),n=t.keepHot();o.promise.then(n,n);let i=r.time,a=l=>{let p=Math.max(l-i,0);i=l;let u=p/1e3,c=this.getCurrentPosition(),m=t.getValue();if(c<m[0]||c>m[1])this.gotoPosition(m[0]);else{let f=c+u;f>m[1]&&(f=m[0]+(f-m[1])),this.gotoPosition(f)}s()};this._stopPlayCallback=()=>{r.offThisOrNextTick(a),r.offNextTick(a),o.resolve(!1)};let s=()=>r.onNextTick(a);return r.onThisOrNextTick(a),o.promise}};var Ns="__TheatreJS_StudioBundle",$r="__TheatreJS_CoreBundle",Ls="__TheatreJS_Notifications";var Br=e=>(...t)=>{var r;switch(e){case"success":{At.debug(t.slice(0,2).join(`
`));break}case"info":{At.debug(t.slice(0,2).join(`
`));break}case"warning":{At.warn(t.slice(0,2).join(`
`));break}case"error":}return typeof window!="undefined"?(r=window[Ls])==null?void 0:r.notify[e](...t):void 0},pe={warning:Br("warning"),success:Br("success"),info:Br("info"),error:Br("error")};typeof window!="undefined"&&(window.addEventListener("error",e=>{pe.error("An error occurred",`<pre>${e.message}</pre>

See **console** for details.`)}),window.addEventListener("unhandledrejection",e=>{pe.error("An error occurred",`<pre>${e.reason}</pre>

See **console** for details.`)}));var Fr=class{constructor(t,r,o){this._decodedBuffer=t;this._audioContext=r;this._nodeDestination=o;d(this,"_mainGain");d(this,"_state",new I({position:0,playing:!1}));d(this,"statePointer");d(this,"_stopPlayCallback",Ot);this.statePointer=this._state.pointer,this._mainGain=this._audioContext.createGain(),this._mainGain.connect(this._nodeDestination)}playDynamicRange(t,r){let o=ne();this._playing&&this.pause(),this._playing=!0;let n,i=()=>{n==null||n(),n=this._loopInRange(t.getValue(),r).stop},a=t.onStale(i);return i(),this._stopPlayCallback=()=>{n==null||n(),a(),o.resolve(!1)},o.promise}_loopInRange(t,r){let o=1,n=this.getCurrentPosition(),i=t[1]-t[0];n<t[0]||n>t[1]?this._updatePositionInState(t[0]):n===t[1]&&this._updatePositionInState(t[0]),n=this.getCurrentPosition();let a=this._audioContext.createBufferSource();a.buffer=this._decodedBuffer,a.connect(this._mainGain),a.playbackRate.value=o,a.loop=!0,a.loopStart=t[0],a.loopEnd=t[1];let s=r.time,l=n-t[0];a.start(0,n);let p=m=>{let b=(Math.max(m-s,0)/1e3*o+l)/i%1*i;this._updatePositionInState(b+t[0]),u()},u=()=>r.onNextTick(p);return r.onThisOrNextTick(p),{stop:()=>{a.stop(),a.disconnect(),r.offThisOrNextTick(p),r.offNextTick(p)}}}get _playing(){return this._state.get().playing}set _playing(t){this._state.setByPointer(r=>r.playing,t)}destroy(){}pause(){this._stopPlayCallback(),this._playing=!1,this._stopPlayCallback=Ot}gotoPosition(t){this._updatePositionInState(t)}_updatePositionInState(t){this._state.reduce(r=>V(_({},r),{position:t}))}getCurrentPosition(){return this._state.get().position}play(t,r,o,n,i){this._playing&&this.pause(),this._playing=!0;let a=this.getCurrentPosition(),s=r[1]-r[0];if(n!=="normal")throw new oe(`Audio-controlled sequences can only be played in the "normal" direction. '${n}' given.`);a<r[0]||a>r[1]?this._updatePositionInState(r[0]):a===r[1]&&this._updatePositionInState(r[0]),a=this.getCurrentPosition();let l=ne(),p=this._audioContext.createBufferSource();p.buffer=this._decodedBuffer,p.connect(this._mainGain),p.playbackRate.value=o,t>1e3&&(pe.warning("Can't play sequences with audio more than 1000 times",`The sequence will still play, but only 1000 times. The \`iterationCount: ${t}\` provided to \`sequence.play()\`
is too high for a sequence with audio.

To fix this, either set \`iterationCount\` to a lower value, or remove the audio from the sequence.`,[{url:"https://www.theatrejs.com/docs/latest/manual/audio",title:"Using Audio"},{url:"https://www.theatrejs.com/docs/latest/api/core#sequence.attachaudio",title:"Audio API"}]),t=1e3),t>1&&(p.loop=!0,p.loopStart=r[0],p.loopEnd=r[1]);let u=i.time,c=a-r[0],m=s*t;p.start(0,a,m-c);let f=b=>{let x=Math.max(b-u,0)/1e3,O=Math.min(x*o+c,m);if(O!==m){let U=O/s%1*s;this._updatePositionInState(U+r[0]),v()}else this._updatePositionInState(r[1]),this._playing=!1,y(),l.resolve(!0)},y=()=>{p.stop(),p.disconnect()};this._stopPlayCallback=()=>{y(),i.offThisOrNextTick(f),i.offNextTick(f),this._playing&&l.resolve(!1)};let v=()=>i.onNextTick(f);return i.onThisOrNextTick(f),l.promise}};var Ms=0;function Ft(e){var i;let t=a=>{r.tick(a)},r=new ct({onActive(){var a;(a=e==null?void 0:e.start)==null||a.call(e)},onDormant(){var a;(a=e==null?void 0:e.stop)==null||a.call(e)}}),o={tick:t,id:Ms++,name:(i=e==null?void 0:e.name)!=null?i:`CustomRafDriver-${Ms}`,type:"Theatre_RafDriver_PublicAPI"},n={type:"Theatre_RafDriver_PrivateAPI",publicApi:o,ticker:r,start:e==null?void 0:e.start,stop:e==null?void 0:e.stop};return ue(o,n),o}function eg(){let e=null,o=Ft({name:"DefaultCoreRafDriver",start:()=>{if(typeof window!="undefined"){let n=i=>{o.tick(i),e=window.requestAnimationFrame(n)};e=window.requestAnimationFrame(n)}else o.tick(0),setTimeout(()=>o.tick(1),0)},stop:()=>{typeof window!="undefined"&&e!==null&&window.cancelAnimationFrame(e)}});return o}var Ur;function Lo(){return Ur||zr(eg()),Ur}function qr(){return Lo().ticker}function zr(e){if(Ur)throw new Error("`setCoreRafDriver()` is already called.");Ur=T(e)}var Wr=class{get type(){return"Theatre_Sequence_PublicAPI"}constructor(t){ue(this,t)}play(t){let r=T(this);if(r._project.isReady()){let o=(t==null?void 0:t.rafDriver)?T(t.rafDriver).ticker:qr();return r.play(t!=null?t:{},o)}else{let o=ne();return o.resolve(!0),o.promise}}pause(){T(this).pause()}get position(){return T(this).position}set position(t){T(this).position=t}async attachAudio(t){let{audioContext:r,destinationNode:o,decodedBuffer:n,gainNode:i}=await tg(t),a=new Fr(n,r,i);return T(this).replacePlaybackController(a),{audioContext:r,destinationNode:o,decodedBuffer:n,gainNode:i}}get pointer(){return T(this).pointer}};async function tg(e){function t(){if(e.audioContext)return Promise.resolve(e.audioContext);let p=new AudioContext;return p.state==="running"||typeof window=="undefined"?Promise.resolve(p):new Promise(u=>{let c=()=>{p.resume()},m=["mousedown","keydown","touchstart"],f={capture:!0,passive:!1};m.forEach(y=>{window.addEventListener(y,c,f)}),p.addEventListener("statechange",()=>{p.state==="running"&&(m.forEach(y=>{window.removeEventListener(y,c,f)}),u(p))})})}async function r(){if(e.source instanceof AudioBuffer)return e.source;let p=ne();if(typeof e.source!="string")throw new Error("Error validating arguments to sequence.attachAudio(). args.source must either be a string or an instance of AudioBuffer.");let u;try{u=await fetch(e.source)}catch(y){throw console.error(y),new Error(`Could not fetch '${e.source}'. Network error logged above.`)}let c;try{c=await u.arrayBuffer()}catch(y){throw console.error(y),new Error(`Could not read '${e.source}' as an arrayBuffer.`)}(await o).decodeAudioData(c,p.resolve,p.reject);let f;try{f=await p.promise}catch(y){throw console.error(y),new Error(`Could not decode ${e.source} as an audio file.`)}return f}let o=t(),n=r(),[i,a]=await Promise.all([o,n]),s=e.destinationNode||i.destination,l=i.createGain();return l.connect(s),{audioContext:i,decodedBuffer:a,gainNode:l,destinationNode:s}}var Kr=class{constructor(t,r,o,n,i){this._project=t;this._sheet=r;this._lengthD=o;this._subUnitsPerUnitD=n;d(this,"address");d(this,"publicApi");d(this,"_playbackControllerBox");d(this,"_prismOfStatePointer");d(this,"_positionD");d(this,"_positionFormatterD");d(this,"_playableRangeD");d(this,"pointer",ge({root:this,path:[]}));d(this,"$$isPointerToPrismProvider",!0);d(this,"_logger");d(this,"closestGridPosition",t=>{let r=this.subUnitsPerUnit,o=1/r;return parseFloat((Math.round(t/o)*o).toFixed(3))});this._logger=t._logger.named("Sheet",r.address.sheetId).named("Instance",r.address.sheetInstanceId),this.address=V(_({},this._sheet.address),{sequenceName:"default"}),this.publicApi=new Wr(this),this._playbackControllerBox=new I(i!=null?i:new Mr),this._prismOfStatePointer=g(()=>this._playbackControllerBox.prism.getValue().statePointer),this._positionD=g(()=>{let a=this._prismOfStatePointer.getValue();return j(a.position)}),this._positionFormatterD=g(()=>{let a=j(this._subUnitsPerUnitD);return new $s(a)})}pointerToPrism(t){let{path:r}=Z(t);if(r.length===0)return g(()=>({length:j(this.pointer.length),playing:j(this.pointer.playing),position:j(this.pointer.position)}));if(r.length>1)return g(()=>{});let[o]=r;return o==="length"?this._lengthD:o==="position"?this._positionD:o==="playing"?g(()=>j(this._prismOfStatePointer.getValue().playing)):g(()=>{})}get positionFormatter(){return this._positionFormatterD.getValue()}get prismOfStatePointer(){return this._prismOfStatePointer}get length(){return this._lengthD.getValue()}get positionPrism(){return this._positionD}get position(){return this._playbackControllerBox.get().getCurrentPosition()}get subUnitsPerUnit(){return this._subUnitsPerUnitD.getValue()}get positionSnappedToGrid(){return this.closestGridPosition(this.position)}set position(t){let r=t;this.pause(),r>this.length&&(r=this.length);let o=this.length;this._playbackControllerBox.get().gotoPosition(r>o?o:r)}getDurationCold(){return this._lengthD.getValue()}get playing(){return j(this._playbackControllerBox.get().statePointer.playing)}_makeRangeFromSequenceTemplate(){return g(()=>[0,j(this._lengthD)])}playDynamicRange(t,r){return this._playbackControllerBox.get().playDynamicRange(t,r)}async play(t,r){let o=this.length,n=t&&t.range?t.range:[0,o],i=t&&typeof t.iterationCount=="number"?t.iterationCount:1,a=t&&typeof t.rate!="undefined"?t.rate:1,s=t&&t.direction?t.direction:"normal";return await this._play(i,[n[0],n[1]],a,s,r)}_play(t,r,o,n,i){return this._playbackControllerBox.get().play(t,r,o,n,i)}pause(){this._playbackControllerBox.get().pause()}replacePlaybackController(t){this.pause();let r=this._playbackControllerBox.get();this._playbackControllerBox.set(t);let o=r.getCurrentPosition();r.destroy(),t.gotoPosition(o)}},$s=class{constructor(t){this._fps=t}formatSubUnitForGrid(t){let r=t%1,o=1/this._fps;return Math.round(r/o)+"f"}formatFullUnitForGrid(t){let r=t,o="";r>=wt&&(o+=Math.floor(r/wt)+"h",r=r%wt),r>=Ye&&(o+=Math.floor(r/Ye)+"m",r=r%Ye),r>=Je&&(o+=Math.floor(r/Je)+"s",r=r%Je);let n=1/this._fps;return r>=n&&(o+=Math.floor(r/n)+"f",r=r%n),o.length===0?"0s":o}formatForPlayhead(t){let r=t,o="";if(r>=wt){let i=Math.floor(r/wt);o+=Ge(i.toString(),2,"0")+"h",r=r%wt}if(r>=Ye){let i=Math.floor(r/Ye);o+=Ge(i.toString(),2,"0")+"m",r=r%Ye}else o.length>0&&(o+="00m");if(r>=Je){let i=Math.floor(r/Je);o+=Ge(i.toString(),2,"0")+"s",r=r%Je}else o+="00s";let n=1/this._fps;if(r>=n){let i=Math.round(r/n);o+=Ge(i.toString(),2,"0")+"f",r=r%n}else r/n>.98?(o+=Ge(1 .toString(),2,"0")+"f",r=r%n):o+="00f";return o.length===0?"00s00f":o}formatBasic(t){return t.toFixed(2)+"s"}},Je=1,Ye=Je*60,wt=Ye*60;var Yr={};uo(Yr,{boolean:()=>Fo,compound:()=>Ut,image:()=>sg,number:()=>Bo,rgba:()=>cg,string:()=>Uo,stringLiteral:()=>yg});function Gr(e,t){return e.length<=t?e:e.substr(0,t-3)+"..."}var rg=e=>typeof e=="string"?`string("${Gr(e,10)}")`:typeof e=="number"?`number(${Gr(String(e),10)})`:e===null?"null":e===void 0?"undefined":typeof e=="boolean"?String(e):Array.isArray(e)?"array":typeof e=="object"?"object":"unknown",Ct=rg;function og(e,{removeAlphaIfOpaque:t=!1}={}){let r=(e.a*255|1<<8).toString(16).slice(1);return`#${(e.r*255|1<<8).toString(16).slice(1)+(e.g*255|1<<8).toString(16).slice(1)+(e.b*255|1<<8).toString(16).slice(1)+(t&&r==="ff"?"":r)}`}function Hr(e){return V(_({},e),{toString(){return og(this,{removeAlphaIfOpaque:!0})}})}function ng(e){return Object.fromEntries(Object.entries(e).map(([t,r])=>[t,Lt(r,0,1)]))}function Bs(e){function t(r){return r>=.0031308?1.055*r**(1/2.4)-.055:12.92*r}return ng({r:t(e.r),g:t(e.g),b:t(e.b),a:e.a})}function Mo(e){function t(r){return r>=.04045?((r+.055)/(1+.055))**2.4:r/12.92}return{r:t(e.r),g:t(e.g),b:t(e.b),a:e.a}}function $o(e){let t=.4122214708*e.r+.5363325363*e.g+.0514459929*e.b,r=.2119034982*e.r+.6806995451*e.g+.1073969566*e.b,o=.0883024619*e.r+.2817188376*e.g+.6299787005*e.b,n=Math.cbrt(t),i=Math.cbrt(r),a=Math.cbrt(o);return{L:.2104542553*n+.793617785*i-.0040720468*a,a:1.9779984951*n-2.428592205*i+.4505937099*a,b:.0259040371*n+.7827717662*i-.808675766*a,alpha:e.a}}function Fs(e){let t=e.L+.3963377774*e.a+.2158037573*e.b,r=e.L-.1055613458*e.a-.0638541728*e.b,o=e.L-.0894841775*e.a-1.291485548*e.b,n=t*t*t,i=r*r*r,a=o*o*o;return{r:4.0767416621*n-3.3077115913*i+.2309699292*a,g:-1.2684380046*n+2.6097574011*i-.3413193965*a,b:-.0041960863*n-.7034186147*i+1.707614701*a,a:e.alpha}}var _e=Symbol("TheatrePropType_Basic");function Us(e){return typeof e=="object"&&!!e&&e[_e]==="TheatrePropType"}function ig(e){if(typeof e=="number")return Bo(e);if(typeof e=="boolean")return Fo(e);if(typeof e=="string")return Uo(e);if(typeof e=="object"&&!!e){if(Us(e))return e;if(Vt(e))return Ut(e);throw new oe(`This value is not a valid prop type: ${Ct(e)}`)}else throw new oe(`This value is not a valid prop type: ${Ct(e)}`)}function qs(e){let t={};for(let r of Object.keys(e)){let o=e[r];Us(o)?t[r]=o:t[r]=ig(o)}return t}var ag=(e,t)=>{},Ut=(e,t={})=>{ag("t.compound(props, opts)",t);let r=qs(e),o=new WeakMap;return{type:"compound",props:r,valueType:null,[_e]:"TheatrePropType",label:t.label,default:Co(r,i=>i.default),deserializeAndSanitize:i=>{if(typeof i!="object"||!i)return;if(o.has(i))return o.get(i);let a={},s=!1;for(let[l,p]of Object.entries(r))if(Object.prototype.hasOwnProperty.call(i,l)){let u=p.deserializeAndSanitize(i[l]);u!=null&&(s=!0,a[l]=u)}if(o.set(i,a),s)return a}}},sg=(e,t={})=>{let r=(o,n,i)=>{var s;let a=(s=t.interpolate)!=null?s:Jr;return{type:"image",id:a(o.id,n.id,i)}};return{type:"image",default:{type:"image",id:e},valueType:null,[_e]:"TheatrePropType",label:t.label,interpolate:r,deserializeAndSanitize:pg}},pg=e=>{if(!e)return;let t=!0;if(typeof e.id!="string"&&![null,void 0].includes(e.id)&&(t=!1),e.type!=="image"&&(t=!1),!!t)return e},Bo=(e,t={})=>{var r;return V(_({type:"number",valueType:0,default:e,[_e]:"TheatrePropType"},t||{}),{label:t.label,nudgeFn:(r=t.nudgeFn)!=null?r:bg,nudgeMultiplier:typeof t.nudgeMultiplier=="number"?t.nudgeMultiplier:void 0,interpolate:fg,deserializeAndSanitize:lg(t.range)})},lg=e=>e?t=>{if(!!(typeof t=="number"&&isFinite(t)))return Lt(t,e[0],e[1])}:ug,ug=e=>typeof e=="number"&&isFinite(e)?e:void 0,fg=(e,t,r)=>e+r*(t-e),cg=(e={r:0,g:0,b:0,a:1},t={})=>{let r={};for(let o of["r","g","b","a"])r[o]=Math.min(Math.max(e[o],0),1);return{type:"rgba",valueType:null,default:Hr(r),[_e]:"TheatrePropType",label:t.label,interpolate:mg,deserializeAndSanitize:dg}},dg=e=>{if(!e)return;let t=!0;for(let o of["r","g","b","a"])(!Object.prototype.hasOwnProperty.call(e,o)||typeof e[o]!="number")&&(t=!1);if(!t)return;let r={};for(let o of["r","g","b","a"])r[o]=Math.min(Math.max(e[o],0),1);return Hr(r)},mg=(e,t,r)=>{let o=$o(Mo(e)),n=$o(Mo(t)),i={L:(1-r)*o.L+r*n.L,a:(1-r)*o.a+r*n.a,b:(1-r)*o.b+r*n.b,alpha:(1-r)*o.alpha+r*n.alpha},a=Bs(Fs(i));return Hr(a)},Fo=(e,t={})=>{var r;return{type:"boolean",default:e,valueType:null,[_e]:"TheatrePropType",label:t.label,interpolate:(r=t.interpolate)!=null?r:Jr,deserializeAndSanitize:hg}},hg=e=>typeof e=="boolean"?e:void 0;function Jr(e){return e}var Uo=(e,t={})=>{var r;return{type:"string",default:e,valueType:null,[_e]:"TheatrePropType",label:t.label,interpolate:(r=t.interpolate)!=null?r:Jr,deserializeAndSanitize:gg}};function gg(e){return typeof e=="string"?e:void 0}function yg(e,t,r={}){var o,n;return{type:"stringLiteral",default:e,valuesAndLabels:_({},t),[_e]:"TheatrePropType",valueType:null,as:(o=r.as)!=null?o:"menu",label:r.label,interpolate:(n=r.interpolate)!=null?n:Jr,deserializeAndSanitize(i){if(typeof i=="string"&&Object.prototype.hasOwnProperty.call(t,i))return i}}}var bg=({config:e,deltaX:t,deltaFraction:r,magnitude:o})=>{var i;let{range:n}=e;return!e.nudgeMultiplier&&n&&!n.includes(1/0)&&!n.includes(-1/0)?r*(n[1]-n[0])*o:t*o*((i=e.nudgeMultiplier)!=null?i:1)};var Pg=e=>e.replace(/^[\s\/]*/,"").replace(/[\s\/]*$/,"").replace(/\s*\/\s*/g," / "),jg=e=>{if(typeof e!="string")return`it is not a string. (it is a ${typeof e})`;let t=e.split(/\//);if(t.length===0)return"it is empty.";for(let r=0;r<t.length;r++){let o=t[r].trim();if(o.length===0)return`the component #${r+1} is empty.`;if(o.length>64)return`the component '${o}' must have 64 characters or less.`}};function qt(e,t){let r=Pg(e);return r}var yw=Gt(qo());var jw=new WeakMap,Xr=class{get type(){return"Theatre_Sheet_PublicAPI"}constructor(t){ue(this,t)}object(t,r,o){let n=T(this),i=qt(t,"sheet.object"),a=n.getObject(i),s=null,l=o==null?void 0:o.__actions__THIS_API_IS_UNSTABLE_AND_WILL_CHANGE_IN_THE_NEXT_VERSION;if(a)return l&&a.template._temp_setActions(l),a.publicApi;{let p=Ut(r);return n.createObject(i,s,p,l).publicApi}}get sequence(){return T(this).getSequence().publicApi}get project(){return T(this).project.publicApi}get address(){return _({},T(this).address)}detachObject(t){let r=T(this),o=qt(t,`sheet.deleteObject("${t}")`);if(!r.getObject(o)){pe.warning(`Couldn't delete object "${o}"`,`There is no object with key "${o}".

To fix this, make sure you are calling \`sheet.deleteObject("${o}")\` with the correct key.`),console.warn(`Object key "${o}" does not exist.`);return}r.deleteObject(o)}};var Zr=class{constructor(t,r){this.template=t;this.instanceId=r;d(this,"_objects",new I({}));d(this,"_sequence");d(this,"address");d(this,"publicApi");d(this,"project");d(this,"objectsP",this._objects.pointer);d(this,"type","Theatre_Sheet");d(this,"_logger");this._logger=t.project._logger.named("Sheet",r),this._logger._trace("creating sheet"),this.project=t.project,this.address=V(_({},t.address),{sheetInstanceId:this.instanceId}),this.publicApi=new Xr(this)}createObject(t,r,o,n={}){let a=this.template.getObjectTemplate(t,r,o,n).createInstance(this,r,o);return this._objects.setByPointer(s=>s[t],a),a}getObject(t){return this._objects.get()[t]}deleteObject(t){this._objects.reduce(r=>{let o=_({},r);return delete o[t],o})}getSequence(){if(!this._sequence){let t=g(()=>{let o=j(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.length);return _g(o)}),r=g(()=>{let o=j(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.subUnitsPerUnit);return vg(o)});this._sequence=new Kr(this.template.project,this,t,r)}return this._sequence}},_g=e=>typeof e=="number"&&isFinite(e)&&e>0?e:10,vg=e=>typeof e=="number"&&wo(e)&&e>=1&&e<=1e3?e:30;var Qr=class{constructor(t,r){this.project=t;d(this,"type","Theatre_SheetTemplate");d(this,"address");d(this,"_instances",new I({}));d(this,"instancesP",this._instances.pointer);d(this,"_objectTemplates",new I({}));d(this,"objectTemplatesP",this._objectTemplates.pointer);this.address=V(_({},t.address),{sheetId:r})}getInstance(t){let r=this._instances.get()[t];return r||(r=new Zr(this,t),this._instances.setByPointer(o=>o[t],r)),r}getObjectTemplate(t,r,o,n){let i=this._objectTemplates.get()[t];return i||(i=new Nr(this,t,r,o,n),this._objectTemplates.setByPointer(a=>a[t],i)),i}};var Tg=e=>new Promise(t=>setTimeout(t,e)),Ws=Tg;function ie(e){for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];if(!1)var n,i;throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(a){return"'"+a+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Xe(e){return!!e&&!!e[H]}function Ze(e){return!!e&&(function(t){if(!t||typeof t!="object")return!1;var r=Object.getPrototypeOf(t);if(r===null)return!0;var o=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return o===Object||typeof o=="function"&&Function.toString.call(o)===kg}(e)||Array.isArray(e)||!!e[rp]||!!e.constructor[rp]||Wo(e)||Ko(e))}function Ks(e){return Xe(e)||ie(23,e),e[H].t}function zt(e,t,r){r===void 0&&(r=!1),kt(e)===0?(r?Object.keys:nn)(e).forEach(function(o){r&&typeof o=="symbol"||t(o,e[o],e)}):e.forEach(function(o,n){return t(n,o,e)})}function kt(e){var t=e[H];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:Wo(e)?2:Ko(e)?3:0}function zo(e,t){return kt(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function xg(e,t){return kt(e)===2?e.get(t):e[t]}function Gs(e,t,r){var o=kt(e);o===2?e.set(t,r):o===3?(e.delete(t),e.add(r)):e[t]=r}function Sg(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function Wo(e){return wg&&e instanceof Map}function Ko(e){return Cg&&e instanceof Set}function Qe(e){return e.o||e.t}function Go(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=Dg(e);delete t[H];for(var r=nn(t),o=0;o<r.length;o++){var n=r[o],i=t[n];i.writable===!1&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[n]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[n]})}return Object.create(Object.getPrototypeOf(e),t)}function Ho(e,t){return t===void 0&&(t=!1),Jo(e)||Xe(e)||!Ze(e)||(kt(e)>1&&(e.set=e.add=e.clear=e.delete=Ig),Object.freeze(e),t&&zt(e,function(r,o){return Ho(o,!0)},!0)),e}function Ig(){ie(2)}function Jo(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function ve(e){var t=Eg[e];return t||ie(18,e),t}function Hs(){return Wt}function Yo(e,t){t&&(ve("Patches"),e.u=[],e.s=[],e.v=t)}function eo(e){Xo(e),e.p.forEach(Ag),e.p=null}function Xo(e){e===Wt&&(Wt=e.l)}function Js(e){return Wt={p:[],l:Wt,h:e,m:!0,_:0}}function Ag(e){var t=e[H];t.i===0||t.i===1?t.j():t.O=!0}function Zo(e,t){t._=t.p.length;var r=t.p[0],o=e!==void 0&&e!==r;return t.h.g||ve("ES5").S(t,e,o),o?(r[H].P&&(eo(t),ie(4)),Ze(e)&&(e=to(t,e),t.l||ro(t,e)),t.u&&ve("Patches").M(r[H],e,t.u,t.s)):e=to(t,r,[]),eo(t),t.u&&t.v(t.u,t.s),e!==tp?e:void 0}function to(e,t,r){if(Jo(t))return t;var o=t[H];if(!o)return zt(t,function(i,a){return Ys(e,o,t,i,a,r)},!0),t;if(o.A!==e)return t;if(!o.P)return ro(e,o.t,!0),o.t;if(!o.I){o.I=!0,o.A._--;var n=o.i===4||o.i===5?o.o=Go(o.k):o.o;zt(o.i===3?new Set(n):n,function(i,a){return Ys(e,o,n,i,a,r)}),ro(e,n,!1),r&&e.u&&ve("Patches").R(o,r,e.u,e.s)}return o.o}function Ys(e,t,r,o,n,i){if(Xe(n)){var a=to(e,n,i&&t&&t.i!==3&&!zo(t.D,o)?i.concat(o):void 0);if(Gs(r,o,a),!Xe(a))return;e.m=!1}if(Ze(n)&&!Jo(n)){if(!e.h.F&&e._<1)return;to(e,n),t&&t.A.l||ro(e,n)}}function ro(e,t,r){r===void 0&&(r=!1),e.h.F&&e.m&&Ho(t,r)}function Qo(e,t){var r=e[H];return(r?Qe(r):e)[t]}function Xs(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var o=Object.getOwnPropertyDescriptor(r,t);if(o)return o;r=Object.getPrototypeOf(r)}}function en(e){e.P||(e.P=!0,e.l&&en(e.l))}function tn(e){e.o||(e.o=Go(e.t))}function rn(e,t,r){var o=Wo(t)?ve("MapSet").N(t,r):Ko(t)?ve("MapSet").T(t,r):e.g?function(n,i){var a=Array.isArray(n),s={i:a?1:0,A:i?i.A:Hs(),P:!1,I:!1,D:{},l:i,t:n,k:null,o:null,j:null,C:!1},l=s,p=oo;a&&(l=[s],p=no);var u=Proxy.revocable(l,p),c=u.revoke,m=u.proxy;return s.k=m,s.j=c,m}(t,r):ve("ES5").J(t,r);return(r?r.A:Hs()).p.push(o),o}function Og(e){return Xe(e)||ie(22,e),function t(r){if(!Ze(r))return r;var o,n=r[H],i=kt(r);if(n){if(!n.P&&(n.i<4||!ve("ES5").K(n)))return n.t;n.I=!0,o=Zs(r,i),n.I=!1}else o=Zs(r,i);return zt(o,function(a,s){n&&xg(n.t,a)===s||Gs(o,a,t(s))}),i===3?new Set(o):o}(e)}function Zs(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return Go(e)}var Qs,Wt,on=typeof Symbol!="undefined"&&typeof Symbol("x")=="symbol",wg=typeof Map!="undefined",Cg=typeof Set!="undefined",ep=typeof Proxy!="undefined"&&Proxy.revocable!==void 0&&typeof Reflect!="undefined",tp=on?Symbol.for("immer-nothing"):((Qs={})["immer-nothing"]=!0,Qs),rp=on?Symbol.for("immer-draftable"):"__$immer_draftable",H=on?Symbol.for("immer-state"):"__$immer_state",Dw=typeof Symbol!="undefined"&&Symbol.iterator||"@@iterator";var kg=""+Object.prototype.constructor,nn=typeof Reflect!="undefined"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,Dg=Object.getOwnPropertyDescriptors||function(e){var t={};return nn(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},Eg={},oo={get:function(e,t){if(t===H)return e;var r=Qe(e);if(!zo(r,t))return function(n,i,a){var s,l=Xs(i,a);return l?"value"in l?l.value:(s=l.get)===null||s===void 0?void 0:s.call(n.k):void 0}(e,r,t);var o=r[t];return e.I||!Ze(o)?o:o===Qo(e.t,t)?(tn(e),e.o[t]=rn(e.A.h,o,e)):o},has:function(e,t){return t in Qe(e)},ownKeys:function(e){return Reflect.ownKeys(Qe(e))},set:function(e,t,r){var o=Xs(Qe(e),t);if(o==null?void 0:o.set)return o.set.call(e.k,r),!0;if(!e.P){var n=Qo(Qe(e),t),i=n==null?void 0:n[H];if(i&&i.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(Sg(r,n)&&(r!==void 0||zo(e.t,t)))return!0;tn(e),en(e)}return e.o[t]===r&&typeof r!="number"&&(r!==void 0||t in e.o)||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return Qo(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,tn(e),en(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=Qe(e),o=Reflect.getOwnPropertyDescriptor(r,t);return o&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:o.enumerable,value:r[t]}},defineProperty:function(){ie(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){ie(12)}},no={};zt(oo,function(e,t){no[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),no.deleteProperty=function(e,t){return oo.deleteProperty.call(this,e[0],t)},no.set=function(e,t,r){return oo.set.call(this,e[0],t,r,e[0])};var Rg=function(){function e(r){var o=this;this.g=ep,this.F=!0,this.produce=function(n,i,a){if(typeof n=="function"&&typeof i!="function"){var s=i;i=n;var l=o;return function(f){var y=this;f===void 0&&(f=s);for(var v=arguments.length,b=Array(v>1?v-1:0),P=1;P<v;P++)b[P-1]=arguments[P];return l.produce(f,function(x){var O;return(O=i).call.apply(O,[y,x].concat(b))})}}var p;if(typeof i!="function"&&ie(6),a!==void 0&&typeof a!="function"&&ie(7),Ze(n)){var u=Js(o),c=rn(o,n,void 0),m=!0;try{p=i(c),m=!1}finally{m?eo(u):Xo(u)}return typeof Promise!="undefined"&&p instanceof Promise?p.then(function(f){return Yo(u,a),Zo(f,u)},function(f){throw eo(u),f}):(Yo(u,a),Zo(p,u))}if(!n||typeof n!="object")return(p=i(n))===tp?void 0:(p===void 0&&(p=n),o.F&&Ho(p,!0),p);ie(21,n)},this.produceWithPatches=function(n,i){return typeof n=="function"?function(l){for(var p=arguments.length,u=Array(p>1?p-1:0),c=1;c<p;c++)u[c-1]=arguments[c];return o.produceWithPatches(l,function(m){return n.apply(void 0,[m].concat(u))})}:[o.produce(n,i,function(l,p){a=l,s=p}),a,s];var a,s},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){Ze(r)||ie(8),Xe(r)&&(r=Og(r));var o=Js(this),n=rn(this,r,void 0);return n[H].C=!0,Xo(o),n},t.finishDraft=function(r,o){var n=r&&r[H],i=n.A;return Yo(i,o),Zo(void 0,i)},t.setAutoFreeze=function(r){this.F=r},t.setUseProxies=function(r){r&&!ep&&ie(20),this.g=r},t.applyPatches=function(r,o){var n;for(n=o.length-1;n>=0;n--){var i=o[n];if(i.path.length===0&&i.op==="replace"){r=i.value;break}}var a=ve("Patches").$;return Xe(r)?a(r,o):this.produce(r,function(s){return a(s,o.slice(n+1))})},e}(),te=new Rg,Ew=te.produce,Rw=te.produceWithPatches.bind(te),Vw=te.setAutoFreeze.bind(te),Nw=te.setUseProxies.bind(te),Lw=te.applyPatches.bind(te),Mw=te.createDraft.bind(te),$w=te.finishDraft.bind(te);var Vg={currentProjectStateDefinitionVersion:"0.4.0"},Dt=Vg;async function an(e,t,r){await Ws(0),e.transaction(({drafts:o})=>{var u;let n=t.address.projectId;o.ephemeral.coreByProject[n]={lastExportedObject:null,loadingState:{type:"loading"}},o.ahistoric.coreByProject[n]={ahistoricStuff:""};function i(){o.ephemeral.coreByProject[n].loadingState={type:"loaded"},o.historic.coreByProject[n]={sheetsById:{},definitionVersion:Dt.currentProjectStateDefinitionVersion,revisionHistory:[]}}function a(c){o.ephemeral.coreByProject[n].loadingState={type:"loaded"},o.historic.coreByProject[n]=c}function s(){o.ephemeral.coreByProject[n].loadingState={type:"loaded"}}function l(c){o.ephemeral.coreByProject[n].loadingState={type:"browserStateIsNotBasedOnDiskState",onDiskState:c}}let p=(u=Ks(o.historic))==null?void 0:u.coreByProject[t.address.projectId];p?r&&p.revisionHistory.indexOf(r.revisionHistory[0])==-1?l(r):s():r?a(r):i()})}function op(){}function io(e){var i,a;let t=((i=e==null?void 0:e.logging)==null?void 0:i.internal)?(a=e.logging.min)!=null?a:S.WARN:1/0,r=t<=S.DEBUG,o=t<=S.ERROR,n=Bt(void 0,{_debug:r?console.debug.bind(console,"_coreLogger(TheatreInternalLogger) debug"):op,_error:o?console.error.bind(console,"_coreLogger(TheatreInternalLogger) error"):op});if(e){let{logger:s,logging:l}=e;s&&n.configureLogger(s),l?n.configureLogging(l):n.configureLogging({dev:!1})}return n.getLogger().named("Theatre")}var ao=class{constructor(t,r={},o){this.config=r;this.publicApi=o;d(this,"pointers");d(this,"_pointerProxies");d(this,"address");d(this,"_studioReadyDeferred");d(this,"_assetStorageReadyDeferred");d(this,"_readyPromise");d(this,"_sheetTemplates",new I({}));d(this,"sheetTemplatesP",this._sheetTemplates.pointer);d(this,"_studio");d(this,"assetStorage");d(this,"type","Theatre_Project");d(this,"_logger");var i;this._logger=io({logging:{dev:!0}}).named("Project",t),this._logger.traceDev("creating project"),this.address={projectId:t};let n=new I({ahistoric:{ahistoricStuff:""},historic:(i=r.state)!=null?i:{sheetsById:{},definitionVersion:Dt.currentProjectStateDefinitionVersion,revisionHistory:[]},ephemeral:{loadingState:{type:"loaded"},lastExportedObject:null}});this._assetStorageReadyDeferred=ne(),this.assetStorage={getAssetUrl:a=>{var s;return`${(s=r.assets)==null?void 0:s.baseUrl}/${a}`},createAsset:()=>{throw new Error("Please wait for Project.ready to use assets.")}},this._pointerProxies={historic:new Fe(n.pointer.historic),ahistoric:new Fe(n.pointer.ahistoric),ephemeral:new Fe(n.pointer.ephemeral)},this.pointers={historic:this._pointerProxies.historic.pointer,ahistoric:this._pointerProxies.ahistoric.pointer,ephemeral:this._pointerProxies.ephemeral.pointer},Ue.add(t,this),this._studioReadyDeferred=ne(),this._readyPromise=Promise.all([this._studioReadyDeferred.promise,this._assetStorageReadyDeferred.promise]).then(()=>{}),r.state?setTimeout(()=>{this._studio||(this._studioReadyDeferred.resolve(void 0),this._assetStorageReadyDeferred.resolve(void 0),this._logger._trace("ready deferred resolved with no state"))},0):typeof window=="undefined"?console.error(`Argument config.state in Theatre.getProject("${t}", config) is empty. You can safely ignore this message if you're developing a Next.js/Remix project in development mode. But if you are shipping to your end-users, then you need to set config.state, otherwise your project's state will be empty and nothing will animate. Learn more at https://www.theatrejs.com/docs/latest/manual/projects#state`):setTimeout(()=>{if(!this._studio)throw new Error(`Argument config.state in Theatre.getProject("${t}", config) is empty. This is fine while you are using @theatre/core along with @theatre/studio. But since @theatre/studio is not loaded, the state of project "${t}" will be empty.

To fix this, you need to add @theatre/studio into the bundle and export the project's state. Learn how to do that at https://www.theatrejs.com/docs/latest/manual/projects#state
`)},1e3)}attachToStudio(t){if(this._studio){if(this._studio!==t)throw new Error(`Project ${this.address.projectId} is already attached to studio ${this._studio.address.studioId}`);console.warn(`Project ${this.address.projectId} is already attached to studio ${this._studio.address.studioId}`);return}this._studio=t,t.initialized.then(async()=>{var r;await an(t,this,this.config.state),this._pointerProxies.historic.setPointer(t.atomP.historic.coreByProject[this.address.projectId]),this._pointerProxies.ahistoric.setPointer(t.atomP.ahistoric.coreByProject[this.address.projectId]),this._pointerProxies.ephemeral.setPointer(t.atomP.ephemeral.coreByProject[this.address.projectId]),t.createAssetStorage(this,(r=this.config.assets)==null?void 0:r.baseUrl).then(o=>{this.assetStorage=o,this._assetStorageReadyDeferred.resolve(void 0)}),this._studioReadyDeferred.resolve(void 0)})}get isAttachedToStudio(){return!!this._studio}get ready(){return this._readyPromise}isReady(){return this._studioReadyDeferred.status==="resolved"&&this._assetStorageReadyDeferred.status==="resolved"}getOrCreateSheet(t,r="default"){let o=this._sheetTemplates.get()[t];return o||(o=new Qr(this,t),this._sheetTemplates.reduce(n=>V(_({},n),{[t]:o}))),o.getInstance(r)}destroy(){if(this._studio){console.warn(`Project ${this.address.projectId} is attached to studio ${this._studio.address.studioId} so will not be destroyed`);return}Ue.remove(this.address.projectId)}};var so=class{get type(){return"Theatre_Project_PublicAPI"}constructor(t,r={}){ue(this,new ao(t,r,this))}get ready(){return T(this).ready}get isReady(){return T(this).isReady()}get address(){return _({},T(this).address)}getAssetUrl(t){if(!this.isReady){console.error("Calling `project.getAssetUrl()` before `project.ready` is resolved, will always return `undefined`. Either use `project.ready.then(() => project.getAssetUrl())` or `await project.ready` before calling `project.getAssetUrl()`.");return}return t.id?T(this).assetStorage.getAssetUrl(t.id):void 0}sheet(t,r="default"){let o=qt(t,"project.sheet");return T(this).getOrCreateSheet(o,r).publicApi}destroy(){T(this).destroy()}};var jC=Gt(qo());function np(e,t={}){let r=Ue.get(e);if(r)return r.publicApi;let n=io().named("Project",e);return t.state?(Lg(e,t.state),n._debug("deep validated config.state on disk")):n._debug("no config.state"),new so(e,t)}var Ng=(e,t)=>{if(Array.isArray(t)||t==null||t.definitionVersion!==Dt.currentProjectStateDefinitionVersion)throw new oe(`Error validating conf.state in Theatre.getProject(${JSON.stringify(e)}, conf). The state seems to be formatted in a way that is unreadable to Theatre.js. Read more at https://www.theatrejs.com/docs/latest/manual/projects#state`)},Lg=(e,t)=>{Ng(e,t)};function Rr(e,t,r){let o=r?T(r).ticker:qr();if(ae(e))return ke(e).onChange(o,t,!0);if(we(e))return e.onChange(o,t,!0);throw new Error("Called onChange(p) where p is neither a pointer nor a prism.")}function ip(e){if(ae(e))return ke(e).getValue();throw new Error("Called val(p) where p is not a pointer.")}var po=class{constructor(){d(this,"_studio")}get type(){return"Theatre_CoreBundle"}get version(){return"0.6.1-dev.5"}getBitsForStudio(t,r){if(this._studio)throw new Error("@theatre/core is already attached to @theatre/studio");this._studio=t;let o={projectsP:Ue.atom.pointer.projects,privateAPI:T,coreExports:sn,getCoreRafDriver:Lo};r(o)}};Mg();function Mg(){if(typeof window=="undefined")return;let e=window[$r];if(typeof e!="undefined")throw typeof e=="object"&&e&&typeof e.version=="string"?new Error(`It seems that the module '@theatre/core' is loaded more than once. This could have two possible causes:
1. You might have two separate versions of Theatre.js in node_modules.
2. Or this might be a bundling misconfiguration, in case you're using a bundler like Webpack/ESBuild/Rollup.

Note that it **is okay** to import '@theatre/core' multiple times. But those imports should point to the same module.`):new Error(`The variable window.${$r} seems to be already set by a module other than @theatre/core.`);let t=new po;window[$r]=t;let r=window[Ns];r&&r!==null&&r.type==="Theatre_StudioBundle"&&r.registerCoreBundle(t)}window.Theatre={core:pn,get studio(){alert("Theatre.studio is only available in the core-and-studio.js bundle. You're using the core-only.min.js bundle.")}};})();
/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
